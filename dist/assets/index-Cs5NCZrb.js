(function(){const v=document.createElement("link").relList;if(v&&v.supports&&v.supports("modulepreload"))return;for(const V of document.querySelectorAll('link[rel="modulepreload"]'))A(V);new MutationObserver(V=>{for(const B of V)if(B.type==="childList")for(const Y of B.addedNodes)Y.tagName==="LINK"&&Y.rel==="modulepreload"&&A(Y)}).observe(document,{childList:!0,subtree:!0});function y(V){const B={};return V.integrity&&(B.integrity=V.integrity),V.referrerPolicy&&(B.referrerPolicy=V.referrerPolicy),V.crossOrigin==="use-credentials"?B.credentials="include":V.crossOrigin==="anonymous"?B.credentials="omit":B.credentials="same-origin",B}function A(V){if(V.ep)return;V.ep=!0;const B=y(V);fetch(V.href,B)}})();const YW="modulepreload",XW=function(S){return"/"+S},qV={},QW=function(v,y,A){let V=Promise.resolve();if(y&&y.length>0){let Y=function(Q){return Promise.all(Q.map(ht=>Promise.resolve(ht).then(Et=>({status:"fulfilled",value:Et}),Et=>({status:"rejected",reason:Et}))))};document.getElementsByTagName("link");const et=document.querySelector("meta[property=csp-nonce]"),J=(et==null?void 0:et.nonce)||(et==null?void 0:et.getAttribute("nonce"));V=Y(y.map(Q=>{if(Q=XW(Q),Q in qV)return;qV[Q]=!0;const ht=Q.endsWith(".css"),Et=ht?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${Q}"]${Et}`))return;const vt=document.createElement("link");if(vt.rel=ht?"stylesheet":YW,ht||(vt.as="script"),vt.crossOrigin="",vt.href=Q,J&&vt.setAttribute("nonce",J),document.head.appendChild(vt),ht)return new Promise((Ft,xt)=>{vt.addEventListener("load",Ft),vt.addEventListener("error",()=>xt(new Error(`Unable to preload CSS for ${Q}`)))})}))}function B(Y){const et=new Event("vite:preloadError",{cancelable:!0});if(et.payload=Y,window.dispatchEvent(et),!et.defaultPrevented)throw Y}return V.then(Y=>{for(const et of Y||[])et.status==="rejected"&&B(et.reason);return v().catch(B)})};var KI=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Fb(S){return S&&S.__esModule&&Object.prototype.hasOwnProperty.call(S,"default")?S.default:S}var YI={exports:{}},Sv={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var KV;function JW(){if(KV)return Sv;KV=1;var S=Symbol.for("react.transitional.element"),v=Symbol.for("react.fragment");function y(A,V,B){var Y=null;if(B!==void 0&&(Y=""+B),V.key!==void 0&&(Y=""+V.key),"key"in V){B={};for(var et in V)et!=="key"&&(B[et]=V[et])}else B=V;return V=B.ref,{$$typeof:S,type:A,key:Y,ref:V!==void 0?V:null,props:B}}return Sv.Fragment=v,Sv.jsx=y,Sv.jsxs=y,Sv}var YV;function ZW(){return YV||(YV=1,YI.exports=JW()),YI.exports}var H=ZW(),XI={exports:{}},Tv={},QI={exports:{}},JI={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var XV;function $W(){return XV||(XV=1,function(S){function v(St,kt){var te=St.length;St.push(kt);t:for(;0<te;){var Ne=te-1>>>1,tt=St[Ne];if(0<V(tt,kt))St[Ne]=kt,St[te]=tt,te=Ne;else break t}}function y(St){return St.length===0?null:St[0]}function A(St){if(St.length===0)return null;var kt=St[0],te=St.pop();if(te!==kt){St[0]=te;t:for(var Ne=0,tt=St.length,Lt=tt>>>1;Ne<Lt;){var Gt=2*(Ne+1)-1,Ht=St[Gt],re=Gt+1,dn=St[re];if(0>V(Ht,te))re<tt&&0>V(dn,Ht)?(St[Ne]=dn,St[re]=te,Ne=re):(St[Ne]=Ht,St[Gt]=te,Ne=Gt);else if(re<tt&&0>V(dn,te))St[Ne]=dn,St[re]=te,Ne=re;else break t}}return kt}function V(St,kt){var te=St.sortIndex-kt.sortIndex;return te!==0?te:St.id-kt.id}if(S.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var B=performance;S.unstable_now=function(){return B.now()}}else{var Y=Date,et=Y.now();S.unstable_now=function(){return Y.now()-et}}var J=[],Q=[],ht=1,Et=null,vt=3,Ft=!1,xt=!1,Oe=!1,Ue=!1,vn=typeof setTimeout=="function"?setTimeout:null,fn=typeof clearTimeout=="function"?clearTimeout:null,Be=typeof setImmediate<"u"?setImmediate:null;function fe(St){for(var kt=y(Q);kt!==null;){if(kt.callback===null)A(Q);else if(kt.startTime<=St)A(Q),kt.sortIndex=kt.expirationTime,v(J,kt);else break;kt=y(Q)}}function Ae(St){if(Oe=!1,fe(St),!xt)if(y(J)!==null)xt=!0,xn||(xn=!0,qt());else{var kt=y(Q);kt!==null&&ne(Ae,kt.startTime-St)}}var xn=!1,ue=-1,ln=5,yn=-1;function si(){return Ue?!0:!(S.unstable_now()-yn<ln)}function wi(){if(Ue=!1,xn){var St=S.unstable_now();yn=St;var kt=!0;try{t:{xt=!1,Oe&&(Oe=!1,fn(ue),ue=-1),Ft=!0;var te=vt;try{e:{for(fe(St),Et=y(J);Et!==null&&!(Et.expirationTime>St&&si());){var Ne=Et.callback;if(typeof Ne=="function"){Et.callback=null,vt=Et.priorityLevel;var tt=Ne(Et.expirationTime<=St);if(St=S.unstable_now(),typeof tt=="function"){Et.callback=tt,fe(St),kt=!0;break e}Et===y(J)&&A(J),fe(St)}else A(J);Et=y(J)}if(Et!==null)kt=!0;else{var Lt=y(Q);Lt!==null&&ne(Ae,Lt.startTime-St),kt=!1}}break t}finally{Et=null,vt=te,Ft=!1}kt=void 0}}finally{kt?qt():xn=!1}}}var qt;if(typeof Be=="function")qt=function(){Be(wi)};else if(typeof MessageChannel<"u"){var oe=new MessageChannel,Kt=oe.port2;oe.port1.onmessage=wi,qt=function(){Kt.postMessage(null)}}else qt=function(){vn(wi,0)};function ne(St,kt){ue=vn(function(){St(S.unstable_now())},kt)}S.unstable_IdlePriority=5,S.unstable_ImmediatePriority=1,S.unstable_LowPriority=4,S.unstable_NormalPriority=3,S.unstable_Profiling=null,S.unstable_UserBlockingPriority=2,S.unstable_cancelCallback=function(St){St.callback=null},S.unstable_forceFrameRate=function(St){0>St||125<St?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ln=0<St?Math.floor(1e3/St):5},S.unstable_getCurrentPriorityLevel=function(){return vt},S.unstable_next=function(St){switch(vt){case 1:case 2:case 3:var kt=3;break;default:kt=vt}var te=vt;vt=kt;try{return St()}finally{vt=te}},S.unstable_requestPaint=function(){Ue=!0},S.unstable_runWithPriority=function(St,kt){switch(St){case 1:case 2:case 3:case 4:case 5:break;default:St=3}var te=vt;vt=St;try{return kt()}finally{vt=te}},S.unstable_scheduleCallback=function(St,kt,te){var Ne=S.unstable_now();switch(typeof te=="object"&&te!==null?(te=te.delay,te=typeof te=="number"&&0<te?Ne+te:Ne):te=Ne,St){case 1:var tt=-1;break;case 2:tt=250;break;case 5:tt=1073741823;break;case 4:tt=1e4;break;default:tt=5e3}return tt=te+tt,St={id:ht++,callback:kt,priorityLevel:St,startTime:te,expirationTime:tt,sortIndex:-1},te>Ne?(St.sortIndex=te,v(Q,St),y(J)===null&&St===y(Q)&&(Oe?(fn(ue),ue=-1):Oe=!0,ne(Ae,te-Ne))):(St.sortIndex=tt,v(J,St),xt||Ft||(xt=!0,xn||(xn=!0,qt()))),St},S.unstable_shouldYield=si,S.unstable_wrapCallback=function(St){var kt=vt;return function(){var te=vt;vt=kt;try{return St.apply(this,arguments)}finally{vt=te}}}}(JI)),JI}var QV;function tz(){return QV||(QV=1,QI.exports=$W()),QI.exports}var ZI={exports:{}},$e={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var JV;function ez(){if(JV)return $e;JV=1;var S=Symbol.for("react.transitional.element"),v=Symbol.for("react.portal"),y=Symbol.for("react.fragment"),A=Symbol.for("react.strict_mode"),V=Symbol.for("react.profiler"),B=Symbol.for("react.consumer"),Y=Symbol.for("react.context"),et=Symbol.for("react.forward_ref"),J=Symbol.for("react.suspense"),Q=Symbol.for("react.memo"),ht=Symbol.for("react.lazy"),Et=Symbol.iterator;function vt(tt){return tt===null||typeof tt!="object"?null:(tt=Et&&tt[Et]||tt["@@iterator"],typeof tt=="function"?tt:null)}var Ft={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},xt=Object.assign,Oe={};function Ue(tt,Lt,Gt){this.props=tt,this.context=Lt,this.refs=Oe,this.updater=Gt||Ft}Ue.prototype.isReactComponent={},Ue.prototype.setState=function(tt,Lt){if(typeof tt!="object"&&typeof tt!="function"&&tt!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,tt,Lt,"setState")},Ue.prototype.forceUpdate=function(tt){this.updater.enqueueForceUpdate(this,tt,"forceUpdate")};function vn(){}vn.prototype=Ue.prototype;function fn(tt,Lt,Gt){this.props=tt,this.context=Lt,this.refs=Oe,this.updater=Gt||Ft}var Be=fn.prototype=new vn;Be.constructor=fn,xt(Be,Ue.prototype),Be.isPureReactComponent=!0;var fe=Array.isArray,Ae={H:null,A:null,T:null,S:null,V:null},xn=Object.prototype.hasOwnProperty;function ue(tt,Lt,Gt,Ht,re,dn){return Gt=dn.ref,{$$typeof:S,type:tt,key:Lt,ref:Gt!==void 0?Gt:null,props:dn}}function ln(tt,Lt){return ue(tt.type,Lt,void 0,void 0,void 0,tt.props)}function yn(tt){return typeof tt=="object"&&tt!==null&&tt.$$typeof===S}function si(tt){var Lt={"=":"=0",":":"=2"};return"$"+tt.replace(/[=:]/g,function(Gt){return Lt[Gt]})}var wi=/\/+/g;function qt(tt,Lt){return typeof tt=="object"&&tt!==null&&tt.key!=null?si(""+tt.key):Lt.toString(36)}function oe(){}function Kt(tt){switch(tt.status){case"fulfilled":return tt.value;case"rejected":throw tt.reason;default:switch(typeof tt.status=="string"?tt.then(oe,oe):(tt.status="pending",tt.then(function(Lt){tt.status==="pending"&&(tt.status="fulfilled",tt.value=Lt)},function(Lt){tt.status==="pending"&&(tt.status="rejected",tt.reason=Lt)})),tt.status){case"fulfilled":return tt.value;case"rejected":throw tt.reason}}throw tt}function ne(tt,Lt,Gt,Ht,re){var dn=typeof tt;(dn==="undefined"||dn==="boolean")&&(tt=null);var me=!1;if(tt===null)me=!0;else switch(dn){case"bigint":case"string":case"number":me=!0;break;case"object":switch(tt.$$typeof){case S:case v:me=!0;break;case ht:return me=tt._init,ne(me(tt._payload),Lt,Gt,Ht,re)}}if(me)return re=re(tt),me=Ht===""?"."+qt(tt,0):Ht,fe(re)?(Gt="",me!=null&&(Gt=me.replace(wi,"$&/")+"/"),ne(re,Lt,Gt,"",function(xr){return xr})):re!=null&&(yn(re)&&(re=ln(re,Gt+(re.key==null||tt&&tt.key===re.key?"":(""+re.key).replace(wi,"$&/")+"/")+me)),Lt.push(re)),1;me=0;var Ji=Ht===""?".":Ht+":";if(fe(tt))for(var Fn=0;Fn<tt.length;Fn++)Ht=tt[Fn],dn=Ji+qt(Ht,Fn),me+=ne(Ht,Lt,Gt,dn,re);else if(Fn=vt(tt),typeof Fn=="function")for(tt=Fn.call(tt),Fn=0;!(Ht=tt.next()).done;)Ht=Ht.value,dn=Ji+qt(Ht,Fn++),me+=ne(Ht,Lt,Gt,dn,re);else if(dn==="object"){if(typeof tt.then=="function")return ne(Kt(tt),Lt,Gt,Ht,re);throw Lt=String(tt),Error("Objects are not valid as a React child (found: "+(Lt==="[object Object]"?"object with keys {"+Object.keys(tt).join(", ")+"}":Lt)+"). If you meant to render a collection of children, use an array instead.")}return me}function St(tt,Lt,Gt){if(tt==null)return tt;var Ht=[],re=0;return ne(tt,Ht,"","",function(dn){return Lt.call(Gt,dn,re++)}),Ht}function kt(tt){if(tt._status===-1){var Lt=tt._result;Lt=Lt(),Lt.then(function(Gt){(tt._status===0||tt._status===-1)&&(tt._status=1,tt._result=Gt)},function(Gt){(tt._status===0||tt._status===-1)&&(tt._status=2,tt._result=Gt)}),tt._status===-1&&(tt._status=0,tt._result=Lt)}if(tt._status===1)return tt._result.default;throw tt._result}var te=typeof reportError=="function"?reportError:function(tt){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Lt=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof tt=="object"&&tt!==null&&typeof tt.message=="string"?String(tt.message):String(tt),error:tt});if(!window.dispatchEvent(Lt))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",tt);return}console.error(tt)};function Ne(){}return $e.Children={map:St,forEach:function(tt,Lt,Gt){St(tt,function(){Lt.apply(this,arguments)},Gt)},count:function(tt){var Lt=0;return St(tt,function(){Lt++}),Lt},toArray:function(tt){return St(tt,function(Lt){return Lt})||[]},only:function(tt){if(!yn(tt))throw Error("React.Children.only expected to receive a single React element child.");return tt}},$e.Component=Ue,$e.Fragment=y,$e.Profiler=V,$e.PureComponent=fn,$e.StrictMode=A,$e.Suspense=J,$e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Ae,$e.__COMPILER_RUNTIME={__proto__:null,c:function(tt){return Ae.H.useMemoCache(tt)}},$e.cache=function(tt){return function(){return tt.apply(null,arguments)}},$e.cloneElement=function(tt,Lt,Gt){if(tt==null)throw Error("The argument must be a React element, but you passed "+tt+".");var Ht=xt({},tt.props),re=tt.key,dn=void 0;if(Lt!=null)for(me in Lt.ref!==void 0&&(dn=void 0),Lt.key!==void 0&&(re=""+Lt.key),Lt)!xn.call(Lt,me)||me==="key"||me==="__self"||me==="__source"||me==="ref"&&Lt.ref===void 0||(Ht[me]=Lt[me]);var me=arguments.length-2;if(me===1)Ht.children=Gt;else if(1<me){for(var Ji=Array(me),Fn=0;Fn<me;Fn++)Ji[Fn]=arguments[Fn+2];Ht.children=Ji}return ue(tt.type,re,void 0,void 0,dn,Ht)},$e.createContext=function(tt){return tt={$$typeof:Y,_currentValue:tt,_currentValue2:tt,_threadCount:0,Provider:null,Consumer:null},tt.Provider=tt,tt.Consumer={$$typeof:B,_context:tt},tt},$e.createElement=function(tt,Lt,Gt){var Ht,re={},dn=null;if(Lt!=null)for(Ht in Lt.key!==void 0&&(dn=""+Lt.key),Lt)xn.call(Lt,Ht)&&Ht!=="key"&&Ht!=="__self"&&Ht!=="__source"&&(re[Ht]=Lt[Ht]);var me=arguments.length-2;if(me===1)re.children=Gt;else if(1<me){for(var Ji=Array(me),Fn=0;Fn<me;Fn++)Ji[Fn]=arguments[Fn+2];re.children=Ji}if(tt&&tt.defaultProps)for(Ht in me=tt.defaultProps,me)re[Ht]===void 0&&(re[Ht]=me[Ht]);return ue(tt,dn,void 0,void 0,null,re)},$e.createRef=function(){return{current:null}},$e.forwardRef=function(tt){return{$$typeof:et,render:tt}},$e.isValidElement=yn,$e.lazy=function(tt){return{$$typeof:ht,_payload:{_status:-1,_result:tt},_init:kt}},$e.memo=function(tt,Lt){return{$$typeof:Q,type:tt,compare:Lt===void 0?null:Lt}},$e.startTransition=function(tt){var Lt=Ae.T,Gt={};Ae.T=Gt;try{var Ht=tt(),re=Ae.S;re!==null&&re(Gt,Ht),typeof Ht=="object"&&Ht!==null&&typeof Ht.then=="function"&&Ht.then(Ne,te)}catch(dn){te(dn)}finally{Ae.T=Lt}},$e.unstable_useCacheRefresh=function(){return Ae.H.useCacheRefresh()},$e.use=function(tt){return Ae.H.use(tt)},$e.useActionState=function(tt,Lt,Gt){return Ae.H.useActionState(tt,Lt,Gt)},$e.useCallback=function(tt,Lt){return Ae.H.useCallback(tt,Lt)},$e.useContext=function(tt){return Ae.H.useContext(tt)},$e.useDebugValue=function(){},$e.useDeferredValue=function(tt,Lt){return Ae.H.useDeferredValue(tt,Lt)},$e.useEffect=function(tt,Lt,Gt){var Ht=Ae.H;if(typeof Gt=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return Ht.useEffect(tt,Lt)},$e.useId=function(){return Ae.H.useId()},$e.useImperativeHandle=function(tt,Lt,Gt){return Ae.H.useImperativeHandle(tt,Lt,Gt)},$e.useInsertionEffect=function(tt,Lt){return Ae.H.useInsertionEffect(tt,Lt)},$e.useLayoutEffect=function(tt,Lt){return Ae.H.useLayoutEffect(tt,Lt)},$e.useMemo=function(tt,Lt){return Ae.H.useMemo(tt,Lt)},$e.useOptimistic=function(tt,Lt){return Ae.H.useOptimistic(tt,Lt)},$e.useReducer=function(tt,Lt,Gt){return Ae.H.useReducer(tt,Lt,Gt)},$e.useRef=function(tt){return Ae.H.useRef(tt)},$e.useState=function(tt){return Ae.H.useState(tt)},$e.useSyncExternalStore=function(tt,Lt,Gt){return Ae.H.useSyncExternalStore(tt,Lt,Gt)},$e.useTransition=function(){return Ae.H.useTransition()},$e.version="19.1.0",$e}var ZV;function yO(){return ZV||(ZV=1,ZI.exports=ez()),ZI.exports}var $I={exports:{}},Qr={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $V;function nz(){if($V)return Qr;$V=1;var S=yO();function v(J){var Q="https://react.dev/errors/"+J;if(1<arguments.length){Q+="?args[]="+encodeURIComponent(arguments[1]);for(var ht=2;ht<arguments.length;ht++)Q+="&args[]="+encodeURIComponent(arguments[ht])}return"Minified React error #"+J+"; visit "+Q+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function y(){}var A={d:{f:y,r:function(){throw Error(v(522))},D:y,C:y,L:y,m:y,X:y,S:y,M:y},p:0,findDOMNode:null},V=Symbol.for("react.portal");function B(J,Q,ht){var Et=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:V,key:Et==null?null:""+Et,children:J,containerInfo:Q,implementation:ht}}var Y=S.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function et(J,Q){if(J==="font")return"";if(typeof Q=="string")return Q==="use-credentials"?Q:""}return Qr.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=A,Qr.createPortal=function(J,Q){var ht=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Q||Q.nodeType!==1&&Q.nodeType!==9&&Q.nodeType!==11)throw Error(v(299));return B(J,Q,null,ht)},Qr.flushSync=function(J){var Q=Y.T,ht=A.p;try{if(Y.T=null,A.p=2,J)return J()}finally{Y.T=Q,A.p=ht,A.d.f()}},Qr.preconnect=function(J,Q){typeof J=="string"&&(Q?(Q=Q.crossOrigin,Q=typeof Q=="string"?Q==="use-credentials"?Q:"":void 0):Q=null,A.d.C(J,Q))},Qr.prefetchDNS=function(J){typeof J=="string"&&A.d.D(J)},Qr.preinit=function(J,Q){if(typeof J=="string"&&Q&&typeof Q.as=="string"){var ht=Q.as,Et=et(ht,Q.crossOrigin),vt=typeof Q.integrity=="string"?Q.integrity:void 0,Ft=typeof Q.fetchPriority=="string"?Q.fetchPriority:void 0;ht==="style"?A.d.S(J,typeof Q.precedence=="string"?Q.precedence:void 0,{crossOrigin:Et,integrity:vt,fetchPriority:Ft}):ht==="script"&&A.d.X(J,{crossOrigin:Et,integrity:vt,fetchPriority:Ft,nonce:typeof Q.nonce=="string"?Q.nonce:void 0})}},Qr.preinitModule=function(J,Q){if(typeof J=="string")if(typeof Q=="object"&&Q!==null){if(Q.as==null||Q.as==="script"){var ht=et(Q.as,Q.crossOrigin);A.d.M(J,{crossOrigin:ht,integrity:typeof Q.integrity=="string"?Q.integrity:void 0,nonce:typeof Q.nonce=="string"?Q.nonce:void 0})}}else Q==null&&A.d.M(J)},Qr.preload=function(J,Q){if(typeof J=="string"&&typeof Q=="object"&&Q!==null&&typeof Q.as=="string"){var ht=Q.as,Et=et(ht,Q.crossOrigin);A.d.L(J,ht,{crossOrigin:Et,integrity:typeof Q.integrity=="string"?Q.integrity:void 0,nonce:typeof Q.nonce=="string"?Q.nonce:void 0,type:typeof Q.type=="string"?Q.type:void 0,fetchPriority:typeof Q.fetchPriority=="string"?Q.fetchPriority:void 0,referrerPolicy:typeof Q.referrerPolicy=="string"?Q.referrerPolicy:void 0,imageSrcSet:typeof Q.imageSrcSet=="string"?Q.imageSrcSet:void 0,imageSizes:typeof Q.imageSizes=="string"?Q.imageSizes:void 0,media:typeof Q.media=="string"?Q.media:void 0})}},Qr.preloadModule=function(J,Q){if(typeof J=="string")if(Q){var ht=et(Q.as,Q.crossOrigin);A.d.m(J,{as:typeof Q.as=="string"&&Q.as!=="script"?Q.as:void 0,crossOrigin:ht,integrity:typeof Q.integrity=="string"?Q.integrity:void 0})}else A.d.m(J)},Qr.requestFormReset=function(J){A.d.r(J)},Qr.unstable_batchedUpdates=function(J,Q){return J(Q)},Qr.useFormState=function(J,Q,ht){return Y.H.useFormState(J,Q,ht)},Qr.useFormStatus=function(){return Y.H.useHostTransitionStatus()},Qr.version="19.1.0",Qr}var tj;function Dj(){if(tj)return $I.exports;tj=1;function S(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(S)}catch(v){console.error(v)}}return S(),$I.exports=nz(),$I.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ej;function iz(){if(ej)return Tv;ej=1;var S=tz(),v=yO(),y=Dj();function A(a){var o="https://react.dev/errors/"+a;if(1<arguments.length){o+="?args[]="+encodeURIComponent(arguments[1]);for(var u=2;u<arguments.length;u++)o+="&args[]="+encodeURIComponent(arguments[u])}return"Minified React error #"+a+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function V(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function B(a){var o=a,u=a;if(a.alternate)for(;o.return;)o=o.return;else{a=o;do o=a,(o.flags&4098)!==0&&(u=o.return),a=o.return;while(a)}return o.tag===3?u:null}function Y(a){if(a.tag===13){var o=a.memoizedState;if(o===null&&(a=a.alternate,a!==null&&(o=a.memoizedState)),o!==null)return o.dehydrated}return null}function et(a){if(B(a)!==a)throw Error(A(188))}function J(a){var o=a.alternate;if(!o){if(o=B(a),o===null)throw Error(A(188));return o!==a?null:a}for(var u=a,f=o;;){var g=u.return;if(g===null)break;var R=g.alternate;if(R===null){if(f=g.return,f!==null){u=f;continue}break}if(g.child===R.child){for(R=g.child;R;){if(R===u)return et(g),a;if(R===f)return et(g),o;R=R.sibling}throw Error(A(188))}if(u.return!==f.return)u=g,f=R;else{for(var x=!1,j=g.child;j;){if(j===u){x=!0,u=g,f=R;break}if(j===f){x=!0,f=g,u=R;break}j=j.sibling}if(!x){for(j=R.child;j;){if(j===u){x=!0,u=R,f=g;break}if(j===f){x=!0,f=R,u=g;break}j=j.sibling}if(!x)throw Error(A(189))}}if(u.alternate!==f)throw Error(A(190))}if(u.tag!==3)throw Error(A(188));return u.stateNode.current===u?a:o}function Q(a){var o=a.tag;if(o===5||o===26||o===27||o===6)return a;for(a=a.child;a!==null;){if(o=Q(a),o!==null)return o;a=a.sibling}return null}var ht=Object.assign,Et=Symbol.for("react.element"),vt=Symbol.for("react.transitional.element"),Ft=Symbol.for("react.portal"),xt=Symbol.for("react.fragment"),Oe=Symbol.for("react.strict_mode"),Ue=Symbol.for("react.profiler"),vn=Symbol.for("react.provider"),fn=Symbol.for("react.consumer"),Be=Symbol.for("react.context"),fe=Symbol.for("react.forward_ref"),Ae=Symbol.for("react.suspense"),xn=Symbol.for("react.suspense_list"),ue=Symbol.for("react.memo"),ln=Symbol.for("react.lazy"),yn=Symbol.for("react.activity"),si=Symbol.for("react.memo_cache_sentinel"),wi=Symbol.iterator;function qt(a){return a===null||typeof a!="object"?null:(a=wi&&a[wi]||a["@@iterator"],typeof a=="function"?a:null)}var oe=Symbol.for("react.client.reference");function Kt(a){if(a==null)return null;if(typeof a=="function")return a.$$typeof===oe?null:a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case xt:return"Fragment";case Ue:return"Profiler";case Oe:return"StrictMode";case Ae:return"Suspense";case xn:return"SuspenseList";case yn:return"Activity"}if(typeof a=="object")switch(a.$$typeof){case Ft:return"Portal";case Be:return(a.displayName||"Context")+".Provider";case fn:return(a._context.displayName||"Context")+".Consumer";case fe:var o=a.render;return a=a.displayName,a||(a=o.displayName||o.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case ue:return o=a.displayName||null,o!==null?o:Kt(a.type)||"Memo";case ln:o=a._payload,a=a._init;try{return Kt(a(o))}catch{}}return null}var ne=Array.isArray,St=v.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,kt=y.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,te={pending:!1,data:null,method:null,action:null},Ne=[],tt=-1;function Lt(a){return{current:a}}function Gt(a){0>tt||(a.current=Ne[tt],Ne[tt]=null,tt--)}function Ht(a,o){tt++,Ne[tt]=a.current,a.current=o}var re=Lt(null),dn=Lt(null),me=Lt(null),Ji=Lt(null);function Fn(a,o){switch(Ht(me,o),Ht(dn,a),Ht(re,null),o.nodeType){case 9:case 11:a=(a=o.documentElement)&&(a=a.namespaceURI)?kT(a):0;break;default:if(a=o.tagName,o=o.namespaceURI)o=kT(o),a=LT(o,a);else switch(a){case"svg":a=1;break;case"math":a=2;break;default:a=0}}Gt(re),Ht(re,a)}function xr(){Gt(re),Gt(dn),Gt(me)}function Ua(a){a.memoizedState!==null&&Ht(Ji,a);var o=re.current,u=LT(o,a.type);o!==u&&(Ht(dn,a),Ht(re,u))}function Ys(a){dn.current===a&&(Gt(re),Gt(dn)),Ji.current===a&&(Gt(Ji),_h._currentValue=te)}var us=Object.prototype.hasOwnProperty,ha=S.unstable_scheduleCallback,Ll=S.unstable_cancelCallback,dp=S.unstable_shouldYield,Va=S.unstable_requestPaint,sr=S.unstable_now,Ei=S.unstable_getCurrentPriorityLevel,Ui=S.unstable_ImmediatePriority,Xs=S.unstable_UserBlockingPriority,Mo=S.unstable_NormalPriority,Ym=S.unstable_LowPriority,uu=S.unstable_IdlePriority,Ut=S.log,ge=S.unstable_setDisableYieldValue,Gn=null,We=null;function oi(a){if(typeof Ut=="function"&&ge(a),We&&typeof We.setStrictMode=="function")try{We.setStrictMode(Gn,a)}catch{}}var gi=Math.clz32?Math.clz32:Ml,Qs=Math.log,xl=Math.LN2;function Ml(a){return a>>>=0,a===0?32:31-(Qs(a)/xl|0)|0}var Js=256,Rr=4194304;function pa(a){var o=a&42;if(o!==0)return o;switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return a&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return a}}function Uo(a,o,u){var f=a.pendingLanes;if(f===0)return 0;var g=0,R=a.suspendedLanes,x=a.pingedLanes;a=a.warmLanes;var j=f&134217727;return j!==0?(f=j&~R,f!==0?g=pa(f):(x&=j,x!==0?g=pa(x):u||(u=j&~a,u!==0&&(g=pa(u))))):(j=f&~R,j!==0?g=pa(j):x!==0?g=pa(x):u||(u=f&~a,u!==0&&(g=pa(u)))),g===0?0:o!==0&&o!==g&&(o&R)===0&&(R=g&-g,u=o&-o,R>=u||R===32&&(u&4194048)!==0)?o:g}function Zs(a,o){return(a.pendingLanes&~(a.suspendedLanes&~a.pingedLanes)&o)===0}function hs(a,o){switch(a){case 1:case 2:case 4:case 8:case 64:return o+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function hu(){var a=Js;return Js<<=1,(Js&4194048)===0&&(Js=256),a}function Dv(){var a=Rr;return Rr<<=1,(Rr&62914560)===0&&(Rr=4194304),a}function Xm(a){for(var o=[],u=0;31>u;u++)o.push(a);return o}function pu(a,o){a.pendingLanes|=o,o!==268435456&&(a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0)}function Gb(a,o,u,f,g,R){var x=a.pendingLanes;a.pendingLanes=u,a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0,a.expiredLanes&=u,a.entangledLanes&=u,a.errorRecoveryDisabledLanes&=u,a.shellSuspendCounter=0;var j=a.entanglements,X=a.expirationTimes,ct=a.hiddenUpdates;for(u=x&~u;0<u;){var Rt=31-gi(u),Nt=1<<Rt;j[Rt]=0,X[Rt]=-1;var _t=ct[Rt];if(_t!==null)for(ct[Rt]=null,Rt=0;Rt<_t.length;Rt++){var gt=_t[Rt];gt!==null&&(gt.lane&=-536870913)}u&=~Nt}f!==0&&Ul(a,f,0),R!==0&&g===0&&a.tag!==0&&(a.suspendedLanes|=R&~(x&~o))}function Ul(a,o,u){a.pendingLanes|=o,a.suspendedLanes&=~o;var f=31-gi(o);a.entangledLanes|=o,a.entanglements[f]=a.entanglements[f]|1073741824|u&4194090}function Pv(a,o){var u=a.entangledLanes|=o;for(a=a.entanglements;u;){var f=31-gi(u),g=1<<f;g&o|a[f]&o&&(a[f]|=o),u&=~g}}function Vo(a){switch(a){case 2:a=1;break;case 8:a=4;break;case 32:a=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:a=128;break;case 268435456:a=134217728;break;default:a=0}return a}function Qm(a){return a&=-a,2<a?8<a?(a&134217727)!==0?32:268435456:8:2}function kv(){var a=kt.p;return a!==0?a:(a=window.event,a===void 0?32:ZT(a.type))}function Hb(a,o){var u=kt.p;try{return kt.p=a,o()}finally{kt.p=u}}var vi=Math.random().toString(36).slice(2),fr="__reactFiber$"+vi,Mr="__reactProps$"+vi,$s="__reactContainer$"+vi,up="__reactEvents$"+vi,Lv="__reactListeners$"+vi,xv="__reactHandles$"+vi,Mv="__reactResources$"+vi,Vl="__reactMarker$"+vi;function hp(a){delete a[fr],delete a[Mr],delete a[up],delete a[Lv],delete a[xv]}function jl(a){var o=a[fr];if(o)return o;for(var u=a.parentNode;u;){if(o=u[$s]||u[fr]){if(u=o.alternate,o.child!==null||u!==null&&u.child!==null)for(a=VT(a);a!==null;){if(u=a[fr])return u;a=VT(a)}return o}a=u,u=a.parentNode}return null}function Bl(a){if(a=a[fr]||a[$s]){var o=a.tag;if(o===5||o===6||o===13||o===26||o===27||o===3)return a}return null}function fu(a){var o=a.tag;if(o===5||o===26||o===27||o===6)return a.stateNode;throw Error(A(33))}function Mc(a){var o=a[Mv];return o||(o=a[Mv]={hoistableStyles:new Map,hoistableScripts:new Map}),o}function Vi(a){a[Vl]=!0}var pp=new Set,Jm={};function fa(a,o){Fl(a,o),Fl(a+"Capture",o)}function Fl(a,o){for(Jm[a]=o,a=0;a<o.length;a++)pp.add(o[a])}var Wb=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),ja={},Uv={};function zb(a){return us.call(Uv,a)?!0:us.call(ja,a)?!1:Wb.test(a)?Uv[a]=!0:(ja[a]=!0,!1)}function ci(a,o,u){if(zb(o))if(u===null)a.removeAttribute(o);else{switch(typeof u){case"undefined":case"function":case"symbol":a.removeAttribute(o);return;case"boolean":var f=o.toLowerCase().slice(0,5);if(f!=="data-"&&f!=="aria-"){a.removeAttribute(o);return}}a.setAttribute(o,""+u)}}function fp(a,o,u){if(u===null)a.removeAttribute(o);else{switch(typeof u){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(o);return}a.setAttribute(o,""+u)}}function to(a,o,u,f){if(f===null)a.removeAttribute(u);else{switch(typeof f){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(u);return}a.setAttributeNS(o,u,""+f)}}var Zm,Vv;function jo(a){if(Zm===void 0)try{throw Error()}catch(u){var o=u.stack.trim().match(/\n( *(at )?)/);Zm=o&&o[1]||"",Vv=-1<u.stack.indexOf(`
    at`)?" (<anonymous>)":-1<u.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Zm+a+Vv}var $m=!1;function mp(a,o){if(!a||$m)return"";$m=!0;var u=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var f={DetermineComponentFrameRoot:function(){try{if(o){var Nt=function(){throw Error()};if(Object.defineProperty(Nt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Nt,[])}catch(gt){var _t=gt}Reflect.construct(a,[],Nt)}else{try{Nt.call()}catch(gt){_t=gt}a.call(Nt.prototype)}}else{try{throw Error()}catch(gt){_t=gt}(Nt=a())&&typeof Nt.catch=="function"&&Nt.catch(function(){})}}catch(gt){if(gt&&_t&&typeof gt.stack=="string")return[gt.stack,_t.stack]}return[null,null]}};f.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var g=Object.getOwnPropertyDescriptor(f.DetermineComponentFrameRoot,"name");g&&g.configurable&&Object.defineProperty(f.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var R=f.DetermineComponentFrameRoot(),x=R[0],j=R[1];if(x&&j){var X=x.split(`
`),ct=j.split(`
`);for(g=f=0;f<X.length&&!X[f].includes("DetermineComponentFrameRoot");)f++;for(;g<ct.length&&!ct[g].includes("DetermineComponentFrameRoot");)g++;if(f===X.length||g===ct.length)for(f=X.length-1,g=ct.length-1;1<=f&&0<=g&&X[f]!==ct[g];)g--;for(;1<=f&&0<=g;f--,g--)if(X[f]!==ct[g]){if(f!==1||g!==1)do if(f--,g--,0>g||X[f]!==ct[g]){var Rt=`
`+X[f].replace(" at new "," at ");return a.displayName&&Rt.includes("<anonymous>")&&(Rt=Rt.replace("<anonymous>",a.displayName)),Rt}while(1<=f&&0<=g);break}}}finally{$m=!1,Error.prepareStackTrace=u}return(u=a?a.displayName||a.name:"")?jo(u):""}function qb(a){switch(a.tag){case 26:case 27:case 5:return jo(a.type);case 16:return jo("Lazy");case 13:return jo("Suspense");case 19:return jo("SuspenseList");case 0:case 15:return mp(a.type,!1);case 11:return mp(a.type.render,!1);case 1:return mp(a.type,!0);case 31:return jo("Activity");default:return""}}function jv(a){try{var o="";do o+=qb(a),a=a.return;while(a);return o}catch(u){return`
Error generating stack: `+u.message+`
`+u.stack}}function ma(a){switch(typeof a){case"bigint":case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function Uc(a){var o=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function t_(a){var o=Uc(a)?"checked":"value",u=Object.getOwnPropertyDescriptor(a.constructor.prototype,o),f=""+a[o];if(!a.hasOwnProperty(o)&&typeof u<"u"&&typeof u.get=="function"&&typeof u.set=="function"){var g=u.get,R=u.set;return Object.defineProperty(a,o,{configurable:!0,get:function(){return g.call(this)},set:function(x){f=""+x,R.call(this,x)}}),Object.defineProperty(a,o,{enumerable:u.enumerable}),{getValue:function(){return f},setValue:function(x){f=""+x},stopTracking:function(){a._valueTracker=null,delete a[o]}}}}function _p(a){a._valueTracker||(a._valueTracker=t_(a))}function Mn(a){if(!a)return!1;var o=a._valueTracker;if(!o)return!0;var u=o.getValue(),f="";return a&&(f=Uc(a)?a.checked?"true":"false":a.value),a=f,a!==u?(o.setValue(a),!0):!1}function Ep(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}var Bv=/[\n"\\]/g;function Zr(a){return a.replace(Bv,function(o){return"\\"+o.charCodeAt(0).toString(16)+" "})}function e_(a,o,u,f,g,R,x,j){a.name="",x!=null&&typeof x!="function"&&typeof x!="symbol"&&typeof x!="boolean"?a.type=x:a.removeAttribute("type"),o!=null?x==="number"?(o===0&&a.value===""||a.value!=o)&&(a.value=""+ma(o)):a.value!==""+ma(o)&&(a.value=""+ma(o)):x!=="submit"&&x!=="reset"||a.removeAttribute("value"),o!=null?n_(a,x,ma(o)):u!=null?n_(a,x,ma(u)):f!=null&&a.removeAttribute("value"),g==null&&R!=null&&(a.defaultChecked=!!R),g!=null&&(a.checked=g&&typeof g!="function"&&typeof g!="symbol"),j!=null&&typeof j!="function"&&typeof j!="symbol"&&typeof j!="boolean"?a.name=""+ma(j):a.removeAttribute("name")}function Fv(a,o,u,f,g,R,x,j){if(R!=null&&typeof R!="function"&&typeof R!="symbol"&&typeof R!="boolean"&&(a.type=R),o!=null||u!=null){if(!(R!=="submit"&&R!=="reset"||o!=null))return;u=u!=null?""+ma(u):"",o=o!=null?""+ma(o):u,j||o===a.value||(a.value=o),a.defaultValue=o}f=f??g,f=typeof f!="function"&&typeof f!="symbol"&&!!f,a.checked=j?a.checked:!!f,a.defaultChecked=!!f,x!=null&&typeof x!="function"&&typeof x!="symbol"&&typeof x!="boolean"&&(a.name=x)}function n_(a,o,u){o==="number"&&Ep(a.ownerDocument)===a||a.defaultValue===""+u||(a.defaultValue=""+u)}function Gl(a,o,u,f){if(a=a.options,o){o={};for(var g=0;g<u.length;g++)o["$"+u[g]]=!0;for(u=0;u<a.length;u++)g=o.hasOwnProperty("$"+a[u].value),a[u].selected!==g&&(a[u].selected=g),g&&f&&(a[u].defaultSelected=!0)}else{for(u=""+ma(u),o=null,g=0;g<a.length;g++){if(a[g].value===u){a[g].selected=!0,f&&(a[g].defaultSelected=!0);return}o!==null||a[g].disabled||(o=a[g])}o!==null&&(o.selected=!0)}}function Gv(a,o,u){if(o!=null&&(o=""+ma(o),o!==a.value&&(a.value=o),u==null)){a.defaultValue!==o&&(a.defaultValue=o);return}a.defaultValue=u!=null?""+ma(u):""}function Hv(a,o,u,f){if(o==null){if(f!=null){if(u!=null)throw Error(A(92));if(ne(f)){if(1<f.length)throw Error(A(93));f=f[0]}u=f}u==null&&(u=""),o=u}u=ma(o),a.defaultValue=u,f=a.textContent,f===u&&f!==""&&f!==null&&(a.value=f)}function Bo(a,o){if(o){var u=a.firstChild;if(u&&u===a.lastChild&&u.nodeType===3){u.nodeValue=o;return}}a.textContent=o}var Wv=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function gp(a,o,u){var f=o.indexOf("--")===0;u==null||typeof u=="boolean"||u===""?f?a.setProperty(o,""):o==="float"?a.cssFloat="":a[o]="":f?a.setProperty(o,u):typeof u!="number"||u===0||Wv.has(o)?o==="float"?a.cssFloat=u:a[o]=(""+u).trim():a[o]=u+"px"}function zv(a,o,u){if(o!=null&&typeof o!="object")throw Error(A(62));if(a=a.style,u!=null){for(var f in u)!u.hasOwnProperty(f)||o!=null&&o.hasOwnProperty(f)||(f.indexOf("--")===0?a.setProperty(f,""):f==="float"?a.cssFloat="":a[f]="");for(var g in o)f=o[g],o.hasOwnProperty(g)&&u[g]!==f&&gp(a,g,f)}else for(var R in o)o.hasOwnProperty(R)&&gp(a,R,o[R])}function mu(a){if(a.indexOf("-")===-1)return!1;switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Kb=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),qv=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function vp(a){return qv.test(""+a)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":a}var i_=null;function r_(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var Hl=null,Wl=null;function Kv(a){var o=Bl(a);if(o&&(a=o.stateNode)){var u=a[Mr]||null;t:switch(a=o.stateNode,o.type){case"input":if(e_(a,u.value,u.defaultValue,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name),o=u.name,u.type==="radio"&&o!=null){for(u=a;u.parentNode;)u=u.parentNode;for(u=u.querySelectorAll('input[name="'+Zr(""+o)+'"][type="radio"]'),o=0;o<u.length;o++){var f=u[o];if(f!==a&&f.form===a.form){var g=f[Mr]||null;if(!g)throw Error(A(90));e_(f,g.value,g.defaultValue,g.defaultValue,g.checked,g.defaultChecked,g.type,g.name)}}for(o=0;o<u.length;o++)f=u[o],f.form===a.form&&Mn(f)}break t;case"textarea":Gv(a,u.value,u.defaultValue);break t;case"select":o=u.value,o!=null&&Gl(a,!!u.multiple,o,!1)}}}var a_=!1;function Yv(a,o,u){if(a_)return a(o,u);a_=!0;try{var f=a(o);return f}finally{if(a_=!1,(Hl!==null||Wl!==null)&&(ul(),Hl&&(o=Hl,a=Wl,Wl=Hl=null,Kv(o),a)))for(o=0;o<a.length;o++)Kv(a[o])}}function zl(a,o){var u=a.stateNode;if(u===null)return null;var f=u[Mr]||null;if(f===null)return null;u=f[o];t:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(f=!f.disabled)||(a=a.type,f=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!f;break t;default:a=!1}if(a)return null;if(u&&typeof u!="function")throw Error(A(231,o,typeof u));return u}var eo=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),s_=!1;if(eo)try{var _u={};Object.defineProperty(_u,"passive",{get:function(){s_=!0}}),window.addEventListener("test",_u,_u),window.removeEventListener("test",_u,_u)}catch{s_=!1}var _a=null,o_=null,Sp=null;function Xv(){if(Sp)return Sp;var a,o=o_,u=o.length,f,g="value"in _a?_a.value:_a.textContent,R=g.length;for(a=0;a<u&&o[a]===g[a];a++);var x=u-a;for(f=1;f<=x&&o[u-f]===g[R-f];f++);return Sp=g.slice(a,1<f?1-f:void 0)}function Tp(a){var o=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&o===13&&(a=13)):a=o,a===10&&(a=13),32<=a||a===13?a:0}function Eu(){return!0}function Qv(){return!1}function Ur(a){function o(u,f,g,R,x){this._reactName=u,this._targetInst=g,this.type=f,this.nativeEvent=R,this.target=x,this.currentTarget=null;for(var j in a)a.hasOwnProperty(j)&&(u=a[j],this[j]=u?u(R):R[j]);return this.isDefaultPrevented=(R.defaultPrevented!=null?R.defaultPrevented:R.returnValue===!1)?Eu:Qv,this.isPropagationStopped=Qv,this}return ht(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var u=this.nativeEvent;u&&(u.preventDefault?u.preventDefault():typeof u.returnValue!="unknown"&&(u.returnValue=!1),this.isDefaultPrevented=Eu)},stopPropagation:function(){var u=this.nativeEvent;u&&(u.stopPropagation?u.stopPropagation():typeof u.cancelBubble!="unknown"&&(u.cancelBubble=!0),this.isPropagationStopped=Eu)},persist:function(){},isPersistent:Eu}),o}var Vc={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ba=Ur(Vc),mr=ht({},Vc,{view:0,detail:0}),Jv=Ur(mr),c_,l_,gu,Zi=ht({},mr,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:p_,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==gu&&(gu&&a.type==="mousemove"?(c_=a.screenX-gu.screenX,l_=a.screenY-gu.screenY):l_=c_=0,gu=a),c_)},movementY:function(a){return"movementY"in a?a.movementY:l_}}),Zv=Ur(Zi),Yb=ht({},Zi,{dataTransfer:0}),Xb=Ur(Yb),yp=ht({},mr,{relatedTarget:0}),Rp=Ur(yp),Qb=ht({},Vc,{animationName:0,elapsedTime:0,pseudoElement:0}),d_=Ur(Qb),Jb=ht({},Vc,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),u_=Ur(Jb),h_=ht({},Vc,{data:0}),bp=Ur(h_),Zb={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},$b={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},jc={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function vu(a){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(a):(a=jc[a])?!!o[a]:!1}function p_(){return vu}var tC=ht({},mr,{key:function(a){if(a.key){var o=Zb[a.key]||a.key;if(o!=="Unidentified")return o}return a.type==="keypress"?(a=Tp(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?$b[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:p_,charCode:function(a){return a.type==="keypress"?Tp(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?Tp(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),eC=Ur(tC),nC=ht({},Zi,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),$v=Ur(nC),ql=ht({},mr,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:p_}),iC=Ur(ql),Kl=ht({},Vc,{propertyName:0,elapsedTime:0,pseudoElement:0}),tS=Ur(Kl),rC=ht({},Zi,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),Le=Ur(rC),aC=ht({},Vc,{newState:0,oldState:0}),sC=Ur(aC),oC=[9,13,27,32],f_=eo&&"CompositionEvent"in window,Bc=null;eo&&"documentMode"in document&&(Bc=document.documentMode);var cC=eo&&"TextEvent"in window&&!Bc,eS=eo&&(!f_||Bc&&8<Bc&&11>=Bc),nS=" ",Cp=!1;function iS(a,o){switch(a){case"keyup":return oC.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function rS(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var Fc=!1;function lC(a,o){switch(a){case"compositionend":return rS(o);case"keypress":return o.which!==32?null:(Cp=!0,nS);case"textInput":return a=o.data,a===nS&&Cp?null:a;default:return null}}function Fo(a,o){if(Fc)return a==="compositionend"||!f_&&iS(a,o)?(a=Xv(),Sp=o_=_a=null,Fc=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return eS&&o.locale!=="ko"?null:o.data;default:return null}}var dC={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function aS(a){var o=a&&a.nodeName&&a.nodeName.toLowerCase();return o==="input"?!!dC[a.type]:o==="textarea"}function sS(a,o,u,f){Hl?Wl?Wl.push(f):Wl=[f]:Hl=f,o=lh(o,"onChange"),0<o.length&&(u=new Ba("onChange","change",null,u,f),a.push({event:u,listeners:o}))}var Yl=null,Gc=null;function uC(a){Rf(a,0)}function Ap(a){var o=fu(a);if(Mn(o))return a}function oS(a,o){if(a==="change")return o}var $r=!1;if(eo){var m_;if(eo){var __="oninput"in document;if(!__){var cS=document.createElement("div");cS.setAttribute("oninput","return;"),__=typeof cS.oninput=="function"}m_=__}else m_=!1;$r=m_&&(!document.documentMode||9<document.documentMode)}function lS(){Yl&&(Yl.detachEvent("onpropertychange",E_),Gc=Yl=null)}function E_(a){if(a.propertyName==="value"&&Ap(Gc)){var o=[];sS(o,Gc,a,r_(a)),Yv(uC,o)}}function hC(a,o,u){a==="focusin"?(lS(),Yl=o,Gc=u,Yl.attachEvent("onpropertychange",E_)):a==="focusout"&&lS()}function pC(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return Ap(Gc)}function dS(a,o){if(a==="click")return Ap(o)}function g_(a,o){if(a==="input"||a==="change")return Ap(o)}function fC(a,o){return a===o&&(a!==0||1/a===1/o)||a!==a&&o!==o}var ta=typeof Object.is=="function"?Object.is:fC;function Go(a,o){if(ta(a,o))return!0;if(typeof a!="object"||a===null||typeof o!="object"||o===null)return!1;var u=Object.keys(a),f=Object.keys(o);if(u.length!==f.length)return!1;for(f=0;f<u.length;f++){var g=u[f];if(!us.call(o,g)||!ta(a[g],o[g]))return!1}return!0}function uS(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function hS(a,o){var u=uS(a);a=0;for(var f;u;){if(u.nodeType===3){if(f=a+u.textContent.length,a<=o&&f>=o)return{node:u,offset:o-a};a=f}t:{for(;u;){if(u.nextSibling){u=u.nextSibling;break t}u=u.parentNode}u=void 0}u=uS(u)}}function pS(a,o){return a&&o?a===o?!0:a&&a.nodeType===3?!1:o&&o.nodeType===3?pS(a,o.parentNode):"contains"in a?a.contains(o):a.compareDocumentPosition?!!(a.compareDocumentPosition(o)&16):!1:!1}function no(a){a=a!=null&&a.ownerDocument!=null&&a.ownerDocument.defaultView!=null?a.ownerDocument.defaultView:window;for(var o=Ep(a.document);o instanceof a.HTMLIFrameElement;){try{var u=typeof o.contentWindow.location.href=="string"}catch{u=!1}if(u)a=o.contentWindow;else break;o=Ep(a.document)}return o}function v_(a){var o=a&&a.nodeName&&a.nodeName.toLowerCase();return o&&(o==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||o==="textarea"||a.contentEditable==="true")}var mC=eo&&"documentMode"in document&&11>=document.documentMode,ji=null,S_=null,Su=null,T_=!1;function fS(a,o,u){var f=u.window===u?u.document:u.nodeType===9?u:u.ownerDocument;T_||ji==null||ji!==Ep(f)||(f=ji,"selectionStart"in f&&v_(f)?f={start:f.selectionStart,end:f.selectionEnd}:(f=(f.ownerDocument&&f.ownerDocument.defaultView||window).getSelection(),f={anchorNode:f.anchorNode,anchorOffset:f.anchorOffset,focusNode:f.focusNode,focusOffset:f.focusOffset}),Su&&Go(Su,f)||(Su=f,f=lh(S_,"onSelect"),0<f.length&&(o=new Ba("onSelect","select",null,o,u),a.push({event:o,listeners:f}),o.target=ji)))}function Ho(a,o){var u={};return u[a.toLowerCase()]=o.toLowerCase(),u["Webkit"+a]="webkit"+o,u["Moz"+a]="moz"+o,u}var Xl={animationend:Ho("Animation","AnimationEnd"),animationiteration:Ho("Animation","AnimationIteration"),animationstart:Ho("Animation","AnimationStart"),transitionrun:Ho("Transition","TransitionRun"),transitionstart:Ho("Transition","TransitionStart"),transitioncancel:Ho("Transition","TransitionCancel"),transitionend:Ho("Transition","TransitionEnd")},y_={},mS={};eo&&(mS=document.createElement("div").style,"AnimationEvent"in window||(delete Xl.animationend.animation,delete Xl.animationiteration.animation,delete Xl.animationstart.animation),"TransitionEvent"in window||delete Xl.transitionend.transition);function Wo(a){if(y_[a])return y_[a];if(!Xl[a])return a;var o=Xl[a],u;for(u in o)if(o.hasOwnProperty(u)&&u in mS)return y_[a]=o[u];return a}var _S=Wo("animationend"),ES=Wo("animationiteration"),wp=Wo("animationstart"),R_=Wo("transitionrun"),_C=Wo("transitionstart"),mt=Wo("transitioncancel"),gS=Wo("transitionend"),vS=new Map,b_="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");b_.push("scrollEnd");function Fa(a,o){vS.set(a,o),fa(o,[a])}var C_=new WeakMap;function ea(a,o){if(typeof a=="object"&&a!==null){var u=C_.get(a);return u!==void 0?u:(o={value:a,source:o,stack:jv(o)},C_.set(a,o),o)}return{value:a,source:o,stack:jv(o)}}var Ea=[],Ql=0,A_=0;function Hc(){for(var a=Ql,o=A_=Ql=0;o<a;){var u=Ea[o];Ea[o++]=null;var f=Ea[o];Ea[o++]=null;var g=Ea[o];Ea[o++]=null;var R=Ea[o];if(Ea[o++]=null,f!==null&&g!==null){var x=f.pending;x===null?g.next=g:(g.next=x.next,x.next=g),f.pending=g}R!==0&&Tu(u,g,R)}}function zo(a,o,u,f){Ea[Ql++]=a,Ea[Ql++]=o,Ea[Ql++]=u,Ea[Ql++]=f,A_|=f,a.lanes|=f,a=a.alternate,a!==null&&(a.lanes|=f)}function w_(a,o,u,f){return zo(a,o,u,f),Zl(a)}function Jl(a,o){return zo(a,null,null,o),Zl(a)}function Tu(a,o,u){a.lanes|=u;var f=a.alternate;f!==null&&(f.lanes|=u);for(var g=!1,R=a.return;R!==null;)R.childLanes|=u,f=R.alternate,f!==null&&(f.childLanes|=u),R.tag===22&&(a=R.stateNode,a===null||a._visibility&1||(g=!0)),a=R,R=R.return;return a.tag===3?(R=a.stateNode,g&&o!==null&&(g=31-gi(u),a=R.hiddenUpdates,f=a[g],f===null?a[g]=[o]:f.push(o),o.lane=u|536870912),R):null}function Zl(a){if(50<sh)throw sh=0,bE=null,Error(A(185));for(var o=a.return;o!==null;)a=o,o=a.return;return a.tag===3?a.stateNode:null}var io={};function EC(a,o,u,f){this.tag=a,this.key=u,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=f,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function na(a,o,u,f){return new EC(a,o,u,f)}function I_(a){return a=a.prototype,!(!a||!a.isReactComponent)}function ro(a,o){var u=a.alternate;return u===null?(u=na(a.tag,o,a.key,a.mode),u.elementType=a.elementType,u.type=a.type,u.stateNode=a.stateNode,u.alternate=a,a.alternate=u):(u.pendingProps=o,u.type=a.type,u.flags=0,u.subtreeFlags=0,u.deletions=null),u.flags=a.flags&65011712,u.childLanes=a.childLanes,u.lanes=a.lanes,u.child=a.child,u.memoizedProps=a.memoizedProps,u.memoizedState=a.memoizedState,u.updateQueue=a.updateQueue,o=a.dependencies,u.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},u.sibling=a.sibling,u.index=a.index,u.ref=a.ref,u.refCleanup=a.refCleanup,u}function Ip(a,o){a.flags&=65011714;var u=a.alternate;return u===null?(a.childLanes=0,a.lanes=o,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=u.childLanes,a.lanes=u.lanes,a.child=u.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=u.memoizedProps,a.memoizedState=u.memoizedState,a.updateQueue=u.updateQueue,a.type=u.type,o=u.dependencies,a.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext}),a}function Op(a,o,u,f,g,R){var x=0;if(f=a,typeof a=="function")I_(a)&&(x=1);else if(typeof a=="string")x=tg(a,u,re.current)?26:a==="html"||a==="head"||a==="body"?27:5;else t:switch(a){case yn:return a=na(31,u,o,g),a.elementType=yn,a.lanes=R,a;case xt:return qo(u.children,g,R,o);case Oe:x=8,g|=24;break;case Ue:return a=na(12,u,o,g|2),a.elementType=Ue,a.lanes=R,a;case Ae:return a=na(13,u,o,g),a.elementType=Ae,a.lanes=R,a;case xn:return a=na(19,u,o,g),a.elementType=xn,a.lanes=R,a;default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case vn:case Be:x=10;break t;case fn:x=9;break t;case fe:x=11;break t;case ue:x=14;break t;case ln:x=16,f=null;break t}x=29,u=Error(A(130,a===null?"null":typeof a,"")),f=null}return o=na(x,u,o,g),o.elementType=a,o.type=f,o.lanes=R,o}function qo(a,o,u,f){return a=na(7,a,f,o),a.lanes=u,a}function Vr(a,o,u){return a=na(6,a,null,o),a.lanes=u,a}function O_(a,o,u){return o=na(4,a.children!==null?a.children:[],a.key,o),o.lanes=u,o.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},o}var ps=[],$l=0,Np=null,Dp=0,ia=[],ga=0,Wc=null,ao=1,Ga="";function zc(a,o){ps[$l++]=Dp,ps[$l++]=Np,Np=a,Dp=o}function N_(a,o,u){ia[ga++]=ao,ia[ga++]=Ga,ia[ga++]=Wc,Wc=a;var f=ao;a=Ga;var g=32-gi(f)-1;f&=~(1<<g),u+=1;var R=32-gi(o)+g;if(30<R){var x=g-g%5;R=(f&(1<<x)-1).toString(32),f>>=x,g-=x,ao=1<<32-gi(o)+g|u<<g|f,Ga=R+a}else ao=1<<R|u<<g|f,Ga=a}function Pp(a){a.return!==null&&(zc(a,1),N_(a,1,0))}function D_(a){for(;a===Np;)Np=ps[--$l],ps[$l]=null,Dp=ps[--$l],ps[$l]=null;for(;a===Wc;)Wc=ia[--ga],ia[ga]=null,Ga=ia[--ga],ia[ga]=null,ao=ia[--ga],ia[ga]=null}var _r=null,Zn=null,Rn=!1,qc=null,fs=!1,P_=Error(A(519));function Kc(a){var o=Error(A(418,""));throw Ru(ea(o,a)),P_}function k_(a){var o=a.stateNode,u=a.type,f=a.memoizedProps;switch(o[fr]=a,o[Mr]=f,u){case"dialog":Xe("cancel",o),Xe("close",o);break;case"iframe":case"object":case"embed":Xe("load",o);break;case"video":case"audio":for(u=0;u<wd.length;u++)Xe(wd[u],o);break;case"source":Xe("error",o);break;case"img":case"image":case"link":Xe("error",o),Xe("load",o);break;case"details":Xe("toggle",o);break;case"input":Xe("invalid",o),Fv(o,f.value,f.defaultValue,f.checked,f.defaultChecked,f.type,f.name,!0),_p(o);break;case"select":Xe("invalid",o);break;case"textarea":Xe("invalid",o),Hv(o,f.value,f.defaultValue,f.children),_p(o)}u=f.children,typeof u!="string"&&typeof u!="number"&&typeof u!="bigint"||o.textContent===""+u||f.suppressHydrationWarning===!0||wf(o.textContent,u)?(f.popover!=null&&(Xe("beforetoggle",o),Xe("toggle",o)),f.onScroll!=null&&Xe("scroll",o),f.onScrollEnd!=null&&Xe("scrollend",o),f.onClick!=null&&(o.onclick=dh),o=!0):o=!1,o||Kc(a)}function kp(a){for(_r=a.return;_r;)switch(_r.tag){case 5:case 13:fs=!1;return;case 27:case 3:fs=!0;return;default:_r=_r.return}}function yu(a){if(a!==_r)return!1;if(!Rn)return kp(a),Rn=!0,!1;var o=a.tag,u;if((u=o!==3&&o!==27)&&((u=o===5)&&(u=a.type,u=!(u!=="form"&&u!=="button")||KE(a.type,a.memoizedProps)),u=!u),u&&Zn&&Kc(a),kp(a),o===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(A(317));t:{for(a=a.nextSibling,o=0;a;){if(a.nodeType===8)if(u=a.data,u==="/$"){if(o===0){Zn=Ja(a.nextSibling);break t}o--}else u!=="$"&&u!=="$!"&&u!=="$?"||o++;a=a.nextSibling}Zn=null}}else o===27?(o=Zn,dc(a.type)?(a=QE,QE=null,Zn=a):Zn=o):Zn=_r?Ja(a.stateNode.nextSibling):null;return!0}function Yc(){Zn=_r=null,Rn=!1}function SS(){var a=qc;return a!==null&&(Hi===null?Hi=a:Hi.push.apply(Hi,a),qc=null),a}function Ru(a){qc===null?qc=[a]:qc.push(a)}var L_=Lt(null),Xc=null,so=null;function Ko(a,o,u){Ht(L_,o._currentValue),o._currentValue=u}function oo(a){a._currentValue=L_.current,Gt(L_)}function x_(a,o,u){for(;a!==null;){var f=a.alternate;if((a.childLanes&o)!==o?(a.childLanes|=o,f!==null&&(f.childLanes|=o)):f!==null&&(f.childLanes&o)!==o&&(f.childLanes|=o),a===u)break;a=a.return}}function M_(a,o,u,f){var g=a.child;for(g!==null&&(g.return=a);g!==null;){var R=g.dependencies;if(R!==null){var x=g.child;R=R.firstContext;t:for(;R!==null;){var j=R;R=g;for(var X=0;X<o.length;X++)if(j.context===o[X]){R.lanes|=u,j=R.alternate,j!==null&&(j.lanes|=u),x_(R.return,u,a),f||(x=null);break t}R=j.next}}else if(g.tag===18){if(x=g.return,x===null)throw Error(A(341));x.lanes|=u,R=x.alternate,R!==null&&(R.lanes|=u),x_(x,u,a),x=null}else x=g.child;if(x!==null)x.return=g;else for(x=g;x!==null;){if(x===a){x=null;break}if(g=x.sibling,g!==null){g.return=x.return,x=g;break}x=x.return}g=x}}function bu(a,o,u,f){a=null;for(var g=o,R=!1;g!==null;){if(!R){if((g.flags&524288)!==0)R=!0;else if((g.flags&262144)!==0)break}if(g.tag===10){var x=g.alternate;if(x===null)throw Error(A(387));if(x=x.memoizedProps,x!==null){var j=g.type;ta(g.pendingProps.value,x.value)||(a!==null?a.push(j):a=[j])}}else if(g===Ji.current){if(x=g.alternate,x===null)throw Error(A(387));x.memoizedState.memoizedState!==g.memoizedState.memoizedState&&(a!==null?a.push(_h):a=[_h])}g=g.return}a!==null&&M_(o,a,u,f),o.flags|=262144}function Lp(a){for(a=a.firstContext;a!==null;){if(!ta(a.context._currentValue,a.memoizedValue))return!0;a=a.next}return!1}function ms(a){Xc=a,so=null,a=a.dependencies,a!==null&&(a.firstContext=null)}function Bi(a){return TS(Xc,a)}function td(a,o){return Xc===null&&ms(a),TS(a,o)}function TS(a,o){var u=o._currentValue;if(o={context:o,memoizedValue:u,next:null},so===null){if(a===null)throw Error(A(308));so=o,a.dependencies={lanes:0,firstContext:o},a.flags|=524288}else so=so.next=o;return u}var gC=typeof AbortController<"u"?AbortController:function(){var a=[],o=this.signal={aborted:!1,addEventListener:function(u,f){a.push(f)}};this.abort=function(){o.aborted=!0,a.forEach(function(u){return u()})}},vC=S.unstable_scheduleCallback,yS=S.unstable_NormalPriority,Ii={$$typeof:Be,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Cu(){return{controller:new gC,data:new Map,refCount:0}}function Au(a){a.refCount--,a.refCount===0&&vC(yS,function(){a.controller.abort()})}var wu=null,Qc=0,ed=0,nd=null;function SC(a,o){if(wu===null){var u=wu=[];Qc=0,ed=Ad(),nd={status:"pending",value:void 0,then:function(f){u.push(f)}}}return Qc++,o.then(RS,RS),o}function RS(){if(--Qc===0&&wu!==null){nd!==null&&(nd.status="fulfilled");var a=wu;wu=null,ed=0,nd=null;for(var o=0;o<a.length;o++)(0,a[o])()}}function TC(a,o){var u=[],f={status:"pending",value:null,reason:null,then:function(g){u.push(g)}};return a.then(function(){f.status="fulfilled",f.value=o;for(var g=0;g<u.length;g++)(0,u[g])(o)},function(g){for(f.status="rejected",f.reason=g,g=0;g<u.length;g++)(0,u[g])(void 0)}),f}var bS=St.S;St.S=function(a,o){typeof o=="object"&&o!==null&&typeof o.then=="function"&&SC(a,o),bS!==null&&bS(a,o)};var Yo=Lt(null);function U_(){var a=Yo.current;return a!==null?a:Yn.pooledCache}function xp(a,o){o===null?Ht(Yo,Yo.current):Ht(Yo,o.pool)}function CS(){var a=U_();return a===null?null:{parent:Ii._currentValue,pool:a}}var Jc=Error(A(460)),AS=Error(A(474)),Mp=Error(A(542)),id={then:function(){}};function wS(a){return a=a.status,a==="fulfilled"||a==="rejected"}function Up(){}function IS(a,o,u){switch(u=a[u],u===void 0?a.push(o):u!==o&&(o.then(Up,Up),o=u),o.status){case"fulfilled":return o.value;case"rejected":throw a=o.reason,NS(a),a;default:if(typeof o.status=="string")o.then(Up,Up);else{if(a=Yn,a!==null&&100<a.shellSuspendCounter)throw Error(A(482));a=o,a.status="pending",a.then(function(f){if(o.status==="pending"){var g=o;g.status="fulfilled",g.value=f}},function(f){if(o.status==="pending"){var g=o;g.status="rejected",g.reason=f}})}switch(o.status){case"fulfilled":return o.value;case"rejected":throw a=o.reason,NS(a),a}throw Iu=o,Jc}}var Iu=null;function OS(){if(Iu===null)throw Error(A(459));var a=Iu;return Iu=null,a}function NS(a){if(a===Jc||a===Mp)throw Error(A(483))}var Ha=!1;function Vp(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function V_(a,o){a=a.updateQueue,o.updateQueue===a&&(o.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,callbacks:null})}function Xo(a){return{lane:a,tag:0,payload:null,callback:null,next:null}}function co(a,o,u){var f=a.updateQueue;if(f===null)return null;if(f=f.shared,(bn&2)!==0){var g=f.pending;return g===null?o.next=o:(o.next=g.next,g.next=o),f.pending=o,o=Zl(a),Tu(a,null,u),o}return zo(a,f,o,u),Zl(a)}function Ou(a,o,u){if(o=o.updateQueue,o!==null&&(o=o.shared,(u&4194048)!==0)){var f=o.lanes;f&=a.pendingLanes,u|=f,o.lanes=u,Pv(a,u)}}function j_(a,o){var u=a.updateQueue,f=a.alternate;if(f!==null&&(f=f.updateQueue,u===f)){var g=null,R=null;if(u=u.firstBaseUpdate,u!==null){do{var x={lane:u.lane,tag:u.tag,payload:u.payload,callback:null,next:null};R===null?g=R=x:R=R.next=x,u=u.next}while(u!==null);R===null?g=R=o:R=R.next=o}else g=R=o;u={baseState:f.baseState,firstBaseUpdate:g,lastBaseUpdate:R,shared:f.shared,callbacks:f.callbacks},a.updateQueue=u;return}a=u.lastBaseUpdate,a===null?u.firstBaseUpdate=o:a.next=o,u.lastBaseUpdate=o}var B_=!1;function Zc(){if(B_){var a=nd;if(a!==null)throw a}}function $c(a,o,u,f){B_=!1;var g=a.updateQueue;Ha=!1;var R=g.firstBaseUpdate,x=g.lastBaseUpdate,j=g.shared.pending;if(j!==null){g.shared.pending=null;var X=j,ct=X.next;X.next=null,x===null?R=ct:x.next=ct,x=X;var Rt=a.alternate;Rt!==null&&(Rt=Rt.updateQueue,j=Rt.lastBaseUpdate,j!==x&&(j===null?Rt.firstBaseUpdate=ct:j.next=ct,Rt.lastBaseUpdate=X))}if(R!==null){var Nt=g.baseState;x=0,Rt=ct=X=null,j=R;do{var _t=j.lane&-536870913,gt=_t!==j.lane;if(gt?(un&_t)===_t:(f&_t)===_t){_t!==0&&_t===ed&&(B_=!0),Rt!==null&&(Rt=Rt.next={lane:0,tag:j.tag,payload:j.payload,callback:null,next:null});t:{var we=a,_e=j;_t=o;var Vn=u;switch(_e.tag){case 1:if(we=_e.payload,typeof we=="function"){Nt=we.call(Vn,Nt,_t);break t}Nt=we;break t;case 3:we.flags=we.flags&-65537|128;case 0:if(we=_e.payload,_t=typeof we=="function"?we.call(Vn,Nt,_t):we,_t==null)break t;Nt=ht({},Nt,_t);break t;case 2:Ha=!0}}_t=j.callback,_t!==null&&(a.flags|=64,gt&&(a.flags|=8192),gt=g.callbacks,gt===null?g.callbacks=[_t]:gt.push(_t))}else gt={lane:_t,tag:j.tag,payload:j.payload,callback:j.callback,next:null},Rt===null?(ct=Rt=gt,X=Nt):Rt=Rt.next=gt,x|=_t;if(j=j.next,j===null){if(j=g.shared.pending,j===null)break;gt=j,j=gt.next,gt.next=null,g.lastBaseUpdate=gt,g.shared.pending=null}}while(!0);Rt===null&&(X=Nt),g.baseState=X,g.firstBaseUpdate=ct,g.lastBaseUpdate=Rt,R===null&&(g.shared.lanes=0),Ya|=x,a.lanes=x,a.memoizedState=Nt}}function F_(a,o){if(typeof a!="function")throw Error(A(191,a));a.call(o)}function jp(a,o){var u=a.callbacks;if(u!==null)for(a.callbacks=null,a=0;a<u.length;a++)F_(u[a],o)}var tl=Lt(null),Nu=Lt(0);function Du(a,o){a=ys,Ht(Nu,a),Ht(tl,o),ys=a|o.baseLanes}function el(){Ht(Nu,ys),Ht(tl,tl.current)}function G_(){ys=Nu.current,Gt(tl),Gt(Nu)}var Qo=0,ze=null,Un=null,Oi=null,Pu=!1,rd=!1,nl=!1,Bp=0,ku=0,ad=null,yC=0;function hi(){throw Error(A(321))}function Jo(a,o){if(o===null)return!1;for(var u=0;u<o.length&&u<a.length;u++)if(!ta(a[u],o[u]))return!1;return!0}function H_(a,o,u,f,g,R){return Qo=R,ze=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,St.H=a===null||a.memoizedState===null?il:$o,nl=!1,R=u(f,g),nl=!1,rd&&(R=PS(o,u,f,g)),DS(a),R}function DS(a){St.H=ra;var o=Un!==null&&Un.next!==null;if(Qo=0,Oi=Un=ze=null,Pu=!1,ku=0,ad=null,o)throw Error(A(300));a===null||$i||(a=a.dependencies,a!==null&&Lp(a)&&($i=!0))}function PS(a,o,u,f){ze=a;var g=0;do{if(rd&&(ad=null),ku=0,rd=!1,25<=g)throw Error(A(301));if(g+=1,Oi=Un=null,a.updateQueue!=null){var R=a.updateQueue;R.lastEffect=null,R.events=null,R.stores=null,R.memoCache!=null&&(R.memoCache.index=0)}St.H=JS,R=o(u,f)}while(rd);return R}function kS(){var a=St.H,o=a.useState()[0];return o=typeof o.then=="function"?Lu(o):o,a=a.useState()[0],(Un!==null?Un.memoizedState:null)!==a&&(ze.flags|=1024),o}function W_(){var a=Bp!==0;return Bp=0,a}function Fp(a,o,u){o.updateQueue=a.updateQueue,o.flags&=-2053,a.lanes&=~u}function z_(a){if(Pu){for(a=a.memoizedState;a!==null;){var o=a.queue;o!==null&&(o.pending=null),a=a.next}Pu=!1}Qo=0,Oi=Un=ze=null,rd=!1,ku=Bp=0,ad=null}function jr(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Oi===null?ze.memoizedState=Oi=a:Oi=Oi.next=a,Oi}function Ni(){if(Un===null){var a=ze.alternate;a=a!==null?a.memoizedState:null}else a=Un.next;var o=Oi===null?ze.memoizedState:Oi.next;if(o!==null)Oi=o,Un=a;else{if(a===null)throw ze.alternate===null?Error(A(467)):Error(A(310));Un=a,a={memoizedState:Un.memoizedState,baseState:Un.baseState,baseQueue:Un.baseQueue,queue:Un.queue,next:null},Oi===null?ze.memoizedState=Oi=a:Oi=Oi.next=a}return Oi}function sd(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Lu(a){var o=ku;return ku+=1,ad===null&&(ad=[]),a=IS(ad,a,o),o=ze,(Oi===null?o.memoizedState:Oi.next)===null&&(o=o.alternate,St.H=o===null||o.memoizedState===null?il:$o),a}function Gp(a){if(a!==null&&typeof a=="object"){if(typeof a.then=="function")return Lu(a);if(a.$$typeof===Be)return Bi(a)}throw Error(A(438,String(a)))}function q_(a){var o=null,u=ze.updateQueue;if(u!==null&&(o=u.memoCache),o==null){var f=ze.alternate;f!==null&&(f=f.updateQueue,f!==null&&(f=f.memoCache,f!=null&&(o={data:f.data.map(function(g){return g.slice()}),index:0})))}if(o==null&&(o={data:[],index:0}),u===null&&(u=sd(),ze.updateQueue=u),u.memoCache=o,u=o.data[o.index],u===void 0)for(u=o.data[o.index]=Array(a),f=0;f<a;f++)u[f]=si;return o.index++,u}function lo(a,o){return typeof o=="function"?o(a):o}function Hp(a){var o=Ni();return K_(o,Un,a)}function K_(a,o,u){var f=a.queue;if(f===null)throw Error(A(311));f.lastRenderedReducer=u;var g=a.baseQueue,R=f.pending;if(R!==null){if(g!==null){var x=g.next;g.next=R.next,R.next=x}o.baseQueue=g=R,f.pending=null}if(R=a.baseState,g===null)a.memoizedState=R;else{o=g.next;var j=x=null,X=null,ct=o,Rt=!1;do{var Nt=ct.lane&-536870913;if(Nt!==ct.lane?(un&Nt)===Nt:(Qo&Nt)===Nt){var _t=ct.revertLane;if(_t===0)X!==null&&(X=X.next={lane:0,revertLane:0,action:ct.action,hasEagerState:ct.hasEagerState,eagerState:ct.eagerState,next:null}),Nt===ed&&(Rt=!0);else if((Qo&_t)===_t){ct=ct.next,_t===ed&&(Rt=!0);continue}else Nt={lane:0,revertLane:ct.revertLane,action:ct.action,hasEagerState:ct.hasEagerState,eagerState:ct.eagerState,next:null},X===null?(j=X=Nt,x=R):X=X.next=Nt,ze.lanes|=_t,Ya|=_t;Nt=ct.action,nl&&u(R,Nt),R=ct.hasEagerState?ct.eagerState:u(R,Nt)}else _t={lane:Nt,revertLane:ct.revertLane,action:ct.action,hasEagerState:ct.hasEagerState,eagerState:ct.eagerState,next:null},X===null?(j=X=_t,x=R):X=X.next=_t,ze.lanes|=Nt,Ya|=Nt;ct=ct.next}while(ct!==null&&ct!==o);if(X===null?x=R:X.next=j,!ta(R,a.memoizedState)&&($i=!0,Rt&&(u=nd,u!==null)))throw u;a.memoizedState=R,a.baseState=x,a.baseQueue=X,f.lastRenderedState=R}return g===null&&(f.lanes=0),[a.memoizedState,f.dispatch]}function xu(a){var o=Ni(),u=o.queue;if(u===null)throw Error(A(311));u.lastRenderedReducer=a;var f=u.dispatch,g=u.pending,R=o.memoizedState;if(g!==null){u.pending=null;var x=g=g.next;do R=a(R,x.action),x=x.next;while(x!==g);ta(R,o.memoizedState)||($i=!0),o.memoizedState=R,o.baseQueue===null&&(o.baseState=R),u.lastRenderedState=R}return[R,f]}function LS(a,o,u){var f=ze,g=Ni(),R=Rn;if(R){if(u===void 0)throw Error(A(407));u=u()}else u=o();var x=!ta((Un||g).memoizedState,u);x&&(g.memoizedState=u,$i=!0),g=g.queue;var j=X_.bind(null,f,g,a);if(ld(2048,8,j,[a]),g.getSnapshot!==o||x||Oi!==null&&Oi.memoizedState.tag&1){if(f.flags|=2048,cd(9,Wp(),xS.bind(null,f,g,u,o),null),Yn===null)throw Error(A(349));R||(Qo&124)!==0||Y_(f,o,u)}return u}function Y_(a,o,u){a.flags|=16384,a={getSnapshot:o,value:u},o=ze.updateQueue,o===null?(o=sd(),ze.updateQueue=o,o.stores=[a]):(u=o.stores,u===null?o.stores=[a]:u.push(a))}function xS(a,o,u,f){o.value=u,o.getSnapshot=f,MS(o)&&US(a)}function X_(a,o,u){return u(function(){MS(o)&&US(a)})}function MS(a){var o=a.getSnapshot;a=a.value;try{var u=o();return!ta(a,u)}catch{return!0}}function US(a){var o=Jl(a,2);o!==null&&Gr(o,a,2)}function Q_(a){var o=jr();if(typeof a=="function"){var u=a;if(a=u(),nl){oi(!0);try{u()}finally{oi(!1)}}}return o.memoizedState=o.baseState=a,o.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:lo,lastRenderedState:a},o}function VS(a,o,u,f){return a.baseState=u,K_(a,Un,typeof f=="function"?f:lo)}function RC(a,o,u,f,g){if(Gu(a))throw Error(A(485));if(a=o.action,a!==null){var R={payload:g,action:a,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(x){R.listeners.push(x)}};St.T!==null?u(!0):R.isTransition=!1,f(R),u=o.pending,u===null?(R.next=o.pending=R,jS(o,R)):(R.next=u.next,o.pending=u.next=R)}}function jS(a,o){var u=o.action,f=o.payload,g=a.state;if(o.isTransition){var R=St.T,x={};St.T=x;try{var j=u(g,f),X=St.S;X!==null&&X(x,j),J_(a,o,j)}catch(ct){Z_(a,o,ct)}finally{St.T=R}}else try{R=u(g,f),J_(a,o,R)}catch(ct){Z_(a,o,ct)}}function J_(a,o,u){u!==null&&typeof u=="object"&&typeof u.then=="function"?u.then(function(f){BS(a,o,f)},function(f){return Z_(a,o,f)}):BS(a,o,u)}function BS(a,o,u){o.status="fulfilled",o.value=u,$_(o),a.state=u,o=a.pending,o!==null&&(u=o.next,u===o?a.pending=null:(u=u.next,o.next=u,jS(a,u)))}function Z_(a,o,u){var f=a.pending;if(a.pending=null,f!==null){f=f.next;do o.status="rejected",o.reason=u,$_(o),o=o.next;while(o!==f)}a.action=null}function $_(a){a=a.listeners;for(var o=0;o<a.length;o++)(0,a[o])()}function FS(a,o){return o}function Mu(a,o){if(Rn){var u=Yn.formState;if(u!==null){t:{var f=ze;if(Rn){if(Zn){e:{for(var g=Zn,R=fs;g.nodeType!==8;){if(!R){g=null;break e}if(g=Ja(g.nextSibling),g===null){g=null;break e}}R=g.data,g=R==="F!"||R==="F"?g:null}if(g){Zn=Ja(g.nextSibling),f=g.data==="F!";break t}}Kc(f)}f=!1}f&&(o=u[0])}}return u=jr(),u.memoizedState=u.baseState=o,f={pending:null,lanes:0,dispatch:null,lastRenderedReducer:FS,lastRenderedState:o},u.queue=f,u=Xp.bind(null,ze,f),f.dispatch=u,f=Q_(!1),R=sE.bind(null,ze,!1,f.queue),f=jr(),g={state:o,dispatch:null,action:a,pending:null},f.queue=g,u=RC.bind(null,ze,g,R,u),g.dispatch=u,f.memoizedState=a,[o,u,!1]}function tE(a){var o=Ni();return od(o,Un,a)}function od(a,o,u){if(o=K_(a,o,FS)[0],a=Hp(lo)[0],typeof o=="object"&&o!==null&&typeof o.then=="function")try{var f=Lu(o)}catch(x){throw x===Jc?Mp:x}else f=o;o=Ni();var g=o.queue,R=g.dispatch;return u!==o.memoizedState&&(ze.flags|=2048,cd(9,Wp(),bC.bind(null,g,u),null)),[f,R,a]}function bC(a,o){a.action=o}function GS(a){var o=Ni(),u=Un;if(u!==null)return od(o,u,a);Ni(),o=o.memoizedState,u=Ni();var f=u.queue.dispatch;return u.memoizedState=a,[o,f,!1]}function cd(a,o,u,f){return a={tag:a,create:u,deps:f,inst:o,next:null},o=ze.updateQueue,o===null&&(o=sd(),ze.updateQueue=o),u=o.lastEffect,u===null?o.lastEffect=a.next=a:(f=u.next,u.next=a,a.next=f,o.lastEffect=a),a}function Wp(){return{destroy:void 0,resource:void 0}}function Uu(){return Ni().memoizedState}function zp(a,o,u,f){var g=jr();f=f===void 0?null:f,ze.flags|=a,g.memoizedState=cd(1|o,Wp(),u,f)}function ld(a,o,u,f){var g=Ni();f=f===void 0?null:f;var R=g.memoizedState.inst;Un!==null&&f!==null&&Jo(f,Un.memoizedState.deps)?g.memoizedState=cd(o,R,u,f):(ze.flags|=a,g.memoizedState=cd(1|o,R,u,f))}function qp(a,o){zp(8390656,8,a,o)}function Kp(a,o){ld(2048,8,a,o)}function HS(a,o){return ld(4,2,a,o)}function WS(a,o){return ld(4,4,a,o)}function zS(a,o){if(typeof o=="function"){a=a();var u=o(a);return function(){typeof u=="function"?u():o(null)}}if(o!=null)return a=a(),o.current=a,function(){o.current=null}}function qS(a,o,u){u=u!=null?u.concat([a]):null,ld(4,4,zS.bind(null,o,a),u)}function eE(){}function Vu(a,o){var u=Ni();o=o===void 0?null:o;var f=u.memoizedState;return o!==null&&Jo(o,f[1])?f[0]:(u.memoizedState=[a,o],a)}function KS(a,o){var u=Ni();o=o===void 0?null:o;var f=u.memoizedState;if(o!==null&&Jo(o,f[1]))return f[0];if(f=a(),nl){oi(!0);try{a()}finally{oi(!1)}}return u.memoizedState=[f,o],f}function Zo(a,o,u){return u===void 0||(Qo&1073741824)!==0?a.memoizedState=o:(a.memoizedState=u,a=ff(),ze.lanes|=a,Ya|=a,u)}function Yp(a,o,u,f){return ta(u,o)?u:tl.current!==null?(a=Zo(a,u,f),ta(a,o)||($i=!0),a):(Qo&42)===0?($i=!0,a.memoizedState=u):(a=ff(),ze.lanes|=a,Ya|=a,o)}function ju(a,o,u,f,g){var R=kt.p;kt.p=R!==0&&8>R?R:8;var x=St.T,j={};St.T=j,sE(a,!1,o,u);try{var X=g(),ct=St.S;if(ct!==null&&ct(j,X),X!==null&&typeof X=="object"&&typeof X.then=="function"){var Rt=TC(X,f);Fu(a,o,Rt,sa(a))}else Fu(a,o,f,sa(a))}catch(Nt){Fu(a,o,{then:function(){},status:"rejected",reason:Nt},sa())}finally{kt.p=R,St.T=x}}function Bu(){}function dd(a,o,u,f){if(a.tag!==5)throw Error(A(476));var g=YS(a).queue;ju(a,g,o,te,u===null?Bu:function(){return nE(a),u(f)})}function YS(a){var o=a.memoizedState;if(o!==null)return o;o={memoizedState:te,baseState:te,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:lo,lastRenderedState:te},next:null};var u={};return o.next={memoizedState:u,baseState:u,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:lo,lastRenderedState:u},next:null},a.memoizedState=o,a=a.alternate,a!==null&&(a.memoizedState=o),o}function nE(a){var o=YS(a).next.queue;Fu(a,o,{},sa())}function iE(){return Bi(_h)}function rE(){return Ni().memoizedState}function XS(){return Ni().memoizedState}function CC(a){for(var o=a.return;o!==null;){switch(o.tag){case 24:case 3:var u=sa();a=Xo(u);var f=co(o,a,u);f!==null&&(Gr(f,o,u),Ou(f,o,u)),o={cache:Cu()},a.payload=o;return}o=o.return}}function aE(a,o,u){var f=sa();u={lane:f,revertLane:0,action:u,hasEagerState:!1,eagerState:null,next:null},Gu(a)?Qp(o,u):(u=w_(a,o,u,f),u!==null&&(Gr(u,a,f),QS(u,o,f)))}function Xp(a,o,u){var f=sa();Fu(a,o,u,f)}function Fu(a,o,u,f){var g={lane:f,revertLane:0,action:u,hasEagerState:!1,eagerState:null,next:null};if(Gu(a))Qp(o,g);else{var R=a.alternate;if(a.lanes===0&&(R===null||R.lanes===0)&&(R=o.lastRenderedReducer,R!==null))try{var x=o.lastRenderedState,j=R(x,u);if(g.hasEagerState=!0,g.eagerState=j,ta(j,x))return zo(a,o,g,0),Yn===null&&Hc(),!1}catch{}finally{}if(u=w_(a,o,g,f),u!==null)return Gr(u,a,f),QS(u,o,f),!0}return!1}function sE(a,o,u,f){if(f={lane:2,revertLane:Ad(),action:f,hasEagerState:!1,eagerState:null,next:null},Gu(a)){if(o)throw Error(A(479))}else o=w_(a,u,f,2),o!==null&&Gr(o,a,2)}function Gu(a){var o=a.alternate;return a===ze||o!==null&&o===ze}function Qp(a,o){rd=Pu=!0;var u=a.pending;u===null?o.next=o:(o.next=u.next,u.next=o),a.pending=o}function QS(a,o,u){if((u&4194048)!==0){var f=o.lanes;f&=a.pendingLanes,u|=f,o.lanes=u,Pv(a,u)}}var ra={readContext:Bi,use:Gp,useCallback:hi,useContext:hi,useEffect:hi,useImperativeHandle:hi,useLayoutEffect:hi,useInsertionEffect:hi,useMemo:hi,useReducer:hi,useRef:hi,useState:hi,useDebugValue:hi,useDeferredValue:hi,useTransition:hi,useSyncExternalStore:hi,useId:hi,useHostTransitionStatus:hi,useFormState:hi,useActionState:hi,useOptimistic:hi,useMemoCache:hi,useCacheRefresh:hi},il={readContext:Bi,use:Gp,useCallback:function(a,o){return jr().memoizedState=[a,o===void 0?null:o],a},useContext:Bi,useEffect:qp,useImperativeHandle:function(a,o,u){u=u!=null?u.concat([a]):null,zp(4194308,4,zS.bind(null,o,a),u)},useLayoutEffect:function(a,o){return zp(4194308,4,a,o)},useInsertionEffect:function(a,o){zp(4,2,a,o)},useMemo:function(a,o){var u=jr();o=o===void 0?null:o;var f=a();if(nl){oi(!0);try{a()}finally{oi(!1)}}return u.memoizedState=[f,o],f},useReducer:function(a,o,u){var f=jr();if(u!==void 0){var g=u(o);if(nl){oi(!0);try{u(o)}finally{oi(!1)}}}else g=o;return f.memoizedState=f.baseState=g,a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:g},f.queue=a,a=a.dispatch=aE.bind(null,ze,a),[f.memoizedState,a]},useRef:function(a){var o=jr();return a={current:a},o.memoizedState=a},useState:function(a){a=Q_(a);var o=a.queue,u=Xp.bind(null,ze,o);return o.dispatch=u,[a.memoizedState,u]},useDebugValue:eE,useDeferredValue:function(a,o){var u=jr();return Zo(u,a,o)},useTransition:function(){var a=Q_(!1);return a=ju.bind(null,ze,a.queue,!0,!1),jr().memoizedState=a,[!1,a]},useSyncExternalStore:function(a,o,u){var f=ze,g=jr();if(Rn){if(u===void 0)throw Error(A(407));u=u()}else{if(u=o(),Yn===null)throw Error(A(349));(un&124)!==0||Y_(f,o,u)}g.memoizedState=u;var R={value:u,getSnapshot:o};return g.queue=R,qp(X_.bind(null,f,R,a),[a]),f.flags|=2048,cd(9,Wp(),xS.bind(null,f,R,u,o),null),u},useId:function(){var a=jr(),o=Yn.identifierPrefix;if(Rn){var u=Ga,f=ao;u=(f&~(1<<32-gi(f)-1)).toString(32)+u,o="«"+o+"R"+u,u=Bp++,0<u&&(o+="H"+u.toString(32)),o+="»"}else u=yC++,o="«"+o+"r"+u.toString(32)+"»";return a.memoizedState=o},useHostTransitionStatus:iE,useFormState:Mu,useActionState:Mu,useOptimistic:function(a){var o=jr();o.memoizedState=o.baseState=a;var u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return o.queue=u,o=sE.bind(null,ze,!0,u),u.dispatch=o,[a,o]},useMemoCache:q_,useCacheRefresh:function(){return jr().memoizedState=CC.bind(null,ze)}},$o={readContext:Bi,use:Gp,useCallback:Vu,useContext:Bi,useEffect:Kp,useImperativeHandle:qS,useInsertionEffect:HS,useLayoutEffect:WS,useMemo:KS,useReducer:Hp,useRef:Uu,useState:function(){return Hp(lo)},useDebugValue:eE,useDeferredValue:function(a,o){var u=Ni();return Yp(u,Un.memoizedState,a,o)},useTransition:function(){var a=Hp(lo)[0],o=Ni().memoizedState;return[typeof a=="boolean"?a:Lu(a),o]},useSyncExternalStore:LS,useId:rE,useHostTransitionStatus:iE,useFormState:tE,useActionState:tE,useOptimistic:function(a,o){var u=Ni();return VS(u,Un,a,o)},useMemoCache:q_,useCacheRefresh:XS},JS={readContext:Bi,use:Gp,useCallback:Vu,useContext:Bi,useEffect:Kp,useImperativeHandle:qS,useInsertionEffect:HS,useLayoutEffect:WS,useMemo:KS,useReducer:xu,useRef:Uu,useState:function(){return xu(lo)},useDebugValue:eE,useDeferredValue:function(a,o){var u=Ni();return Un===null?Zo(u,a,o):Yp(u,Un.memoizedState,a,o)},useTransition:function(){var a=xu(lo)[0],o=Ni().memoizedState;return[typeof a=="boolean"?a:Lu(a),o]},useSyncExternalStore:LS,useId:rE,useHostTransitionStatus:iE,useFormState:GS,useActionState:GS,useOptimistic:function(a,o){var u=Ni();return Un!==null?VS(u,Un,a,o):(u.baseState=a,[a,u.queue.dispatch])},useMemoCache:q_,useCacheRefresh:XS},rl=null,Wa=0;function ud(a){var o=Wa;return Wa+=1,rl===null&&(rl=[]),IS(rl,a,o)}function Hu(a,o){o=o.props.ref,a.ref=o!==void 0?o:null}function Wu(a,o){throw o.$$typeof===Et?Error(A(525)):(a=Object.prototype.toString.call(o),Error(A(31,a==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":a)))}function ZS(a){var o=a._init;return o(a._payload)}function oE(a){function o(st,nt){if(a){var lt=st.deletions;lt===null?(st.deletions=[nt],st.flags|=16):lt.push(nt)}}function u(st,nt){if(!a)return null;for(;nt!==null;)o(st,nt),nt=nt.sibling;return null}function f(st){for(var nt=new Map;st!==null;)st.key!==null?nt.set(st.key,st):nt.set(st.index,st),st=st.sibling;return nt}function g(st,nt){return st=ro(st,nt),st.index=0,st.sibling=null,st}function R(st,nt,lt){return st.index=lt,a?(lt=st.alternate,lt!==null?(lt=lt.index,lt<nt?(st.flags|=67108866,nt):lt):(st.flags|=67108866,nt)):(st.flags|=1048576,nt)}function x(st){return a&&st.alternate===null&&(st.flags|=67108866),st}function j(st,nt,lt,At){return nt===null||nt.tag!==6?(nt=Vr(lt,st.mode,At),nt.return=st,nt):(nt=g(nt,lt),nt.return=st,nt)}function X(st,nt,lt,At){var Zt=lt.type;return Zt===xt?Rt(st,nt,lt.props.children,At,lt.key):nt!==null&&(nt.elementType===Zt||typeof Zt=="object"&&Zt!==null&&Zt.$$typeof===ln&&ZS(Zt)===nt.type)?(nt=g(nt,lt.props),Hu(nt,lt),nt.return=st,nt):(nt=Op(lt.type,lt.key,lt.props,null,st.mode,At),Hu(nt,lt),nt.return=st,nt)}function ct(st,nt,lt,At){return nt===null||nt.tag!==4||nt.stateNode.containerInfo!==lt.containerInfo||nt.stateNode.implementation!==lt.implementation?(nt=O_(lt,st.mode,At),nt.return=st,nt):(nt=g(nt,lt.children||[]),nt.return=st,nt)}function Rt(st,nt,lt,At,Zt){return nt===null||nt.tag!==7?(nt=qo(lt,st.mode,At,Zt),nt.return=st,nt):(nt=g(nt,lt),nt.return=st,nt)}function Nt(st,nt,lt){if(typeof nt=="string"&&nt!==""||typeof nt=="number"||typeof nt=="bigint")return nt=Vr(""+nt,st.mode,lt),nt.return=st,nt;if(typeof nt=="object"&&nt!==null){switch(nt.$$typeof){case vt:return lt=Op(nt.type,nt.key,nt.props,null,st.mode,lt),Hu(lt,nt),lt.return=st,lt;case Ft:return nt=O_(nt,st.mode,lt),nt.return=st,nt;case ln:var At=nt._init;return nt=At(nt._payload),Nt(st,nt,lt)}if(ne(nt)||qt(nt))return nt=qo(nt,st.mode,lt,null),nt.return=st,nt;if(typeof nt.then=="function")return Nt(st,ud(nt),lt);if(nt.$$typeof===Be)return Nt(st,td(st,nt),lt);Wu(st,nt)}return null}function _t(st,nt,lt,At){var Zt=nt!==null?nt.key:null;if(typeof lt=="string"&&lt!==""||typeof lt=="number"||typeof lt=="bigint")return Zt!==null?null:j(st,nt,""+lt,At);if(typeof lt=="object"&&lt!==null){switch(lt.$$typeof){case vt:return lt.key===Zt?X(st,nt,lt,At):null;case Ft:return lt.key===Zt?ct(st,nt,lt,At):null;case ln:return Zt=lt._init,lt=Zt(lt._payload),_t(st,nt,lt,At)}if(ne(lt)||qt(lt))return Zt!==null?null:Rt(st,nt,lt,At,null);if(typeof lt.then=="function")return _t(st,nt,ud(lt),At);if(lt.$$typeof===Be)return _t(st,nt,td(st,lt),At);Wu(st,lt)}return null}function gt(st,nt,lt,At,Zt){if(typeof At=="string"&&At!==""||typeof At=="number"||typeof At=="bigint")return st=st.get(lt)||null,j(nt,st,""+At,Zt);if(typeof At=="object"&&At!==null){switch(At.$$typeof){case vt:return st=st.get(At.key===null?lt:At.key)||null,X(nt,st,At,Zt);case Ft:return st=st.get(At.key===null?lt:At.key)||null,ct(nt,st,At,Zt);case ln:var en=At._init;return At=en(At._payload),gt(st,nt,lt,At,Zt)}if(ne(At)||qt(At))return st=st.get(lt)||null,Rt(nt,st,At,Zt,null);if(typeof At.then=="function")return gt(st,nt,lt,ud(At),Zt);if(At.$$typeof===Be)return gt(st,nt,lt,td(nt,At),Zt);Wu(nt,At)}return null}function we(st,nt,lt,At){for(var Zt=null,en=null,ce=nt,ye=nt=0,nr=null;ce!==null&&ye<lt.length;ye++){ce.index>ye?(nr=ce,ce=null):nr=ce.sibling;var mn=_t(st,ce,lt[ye],At);if(mn===null){ce===null&&(ce=nr);break}a&&ce&&mn.alternate===null&&o(st,ce),nt=R(mn,nt,ye),en===null?Zt=mn:en.sibling=mn,en=mn,ce=nr}if(ye===lt.length)return u(st,ce),Rn&&zc(st,ye),Zt;if(ce===null){for(;ye<lt.length;ye++)ce=Nt(st,lt[ye],At),ce!==null&&(nt=R(ce,nt,ye),en===null?Zt=ce:en.sibling=ce,en=ce);return Rn&&zc(st,ye),Zt}for(ce=f(ce);ye<lt.length;ye++)nr=gt(ce,st,ye,lt[ye],At),nr!==null&&(a&&nr.alternate!==null&&ce.delete(nr.key===null?ye:nr.key),nt=R(nr,nt,ye),en===null?Zt=nr:en.sibling=nr,en=nr);return a&&ce.forEach(function(fo){return o(st,fo)}),Rn&&zc(st,ye),Zt}function _e(st,nt,lt,At){if(lt==null)throw Error(A(151));for(var Zt=null,en=null,ce=nt,ye=nt=0,nr=null,mn=lt.next();ce!==null&&!mn.done;ye++,mn=lt.next()){ce.index>ye?(nr=ce,ce=null):nr=ce.sibling;var fo=_t(st,ce,mn.value,At);if(fo===null){ce===null&&(ce=nr);break}a&&ce&&fo.alternate===null&&o(st,ce),nt=R(fo,nt,ye),en===null?Zt=fo:en.sibling=fo,en=fo,ce=nr}if(mn.done)return u(st,ce),Rn&&zc(st,ye),Zt;if(ce===null){for(;!mn.done;ye++,mn=lt.next())mn=Nt(st,mn.value,At),mn!==null&&(nt=R(mn,nt,ye),en===null?Zt=mn:en.sibling=mn,en=mn);return Rn&&zc(st,ye),Zt}for(ce=f(ce);!mn.done;ye++,mn=lt.next())mn=gt(ce,st,ye,mn.value,At),mn!==null&&(a&&mn.alternate!==null&&ce.delete(mn.key===null?ye:mn.key),nt=R(mn,nt,ye),en===null?Zt=mn:en.sibling=mn,en=mn);return a&&ce.forEach(function(c0){return o(st,c0)}),Rn&&zc(st,ye),Zt}function Vn(st,nt,lt,At){if(typeof lt=="object"&&lt!==null&&lt.type===xt&&lt.key===null&&(lt=lt.props.children),typeof lt=="object"&&lt!==null){switch(lt.$$typeof){case vt:t:{for(var Zt=lt.key;nt!==null;){if(nt.key===Zt){if(Zt=lt.type,Zt===xt){if(nt.tag===7){u(st,nt.sibling),At=g(nt,lt.props.children),At.return=st,st=At;break t}}else if(nt.elementType===Zt||typeof Zt=="object"&&Zt!==null&&Zt.$$typeof===ln&&ZS(Zt)===nt.type){u(st,nt.sibling),At=g(nt,lt.props),Hu(At,lt),At.return=st,st=At;break t}u(st,nt);break}else o(st,nt);nt=nt.sibling}lt.type===xt?(At=qo(lt.props.children,st.mode,At,lt.key),At.return=st,st=At):(At=Op(lt.type,lt.key,lt.props,null,st.mode,At),Hu(At,lt),At.return=st,st=At)}return x(st);case Ft:t:{for(Zt=lt.key;nt!==null;){if(nt.key===Zt)if(nt.tag===4&&nt.stateNode.containerInfo===lt.containerInfo&&nt.stateNode.implementation===lt.implementation){u(st,nt.sibling),At=g(nt,lt.children||[]),At.return=st,st=At;break t}else{u(st,nt);break}else o(st,nt);nt=nt.sibling}At=O_(lt,st.mode,At),At.return=st,st=At}return x(st);case ln:return Zt=lt._init,lt=Zt(lt._payload),Vn(st,nt,lt,At)}if(ne(lt))return we(st,nt,lt,At);if(qt(lt)){if(Zt=qt(lt),typeof Zt!="function")throw Error(A(150));return lt=Zt.call(lt),_e(st,nt,lt,At)}if(typeof lt.then=="function")return Vn(st,nt,ud(lt),At);if(lt.$$typeof===Be)return Vn(st,nt,td(st,lt),At);Wu(st,lt)}return typeof lt=="string"&&lt!==""||typeof lt=="number"||typeof lt=="bigint"?(lt=""+lt,nt!==null&&nt.tag===6?(u(st,nt.sibling),At=g(nt,lt),At.return=st,st=At):(u(st,nt),At=Vr(lt,st.mode,At),At.return=st,st=At),x(st)):u(st,nt)}return function(st,nt,lt,At){try{Wa=0;var Zt=Vn(st,nt,lt,At);return rl=null,Zt}catch(ce){if(ce===Jc||ce===Mp)throw ce;var en=na(29,ce,null,st.mode);return en.lanes=At,en.return=st,en}finally{}}}var al=oE(!0),$S=oE(!1),Fi=Lt(null),_s=null;function tc(a){var o=a.alternate;Ht(Gi,Gi.current&1),Ht(Fi,a),_s===null&&(o===null||tl.current!==null||o.memoizedState!==null)&&(_s=a)}function tT(a){if(a.tag===22){if(Ht(Gi,Gi.current),Ht(Fi,a),_s===null){var o=a.alternate;o!==null&&o.memoizedState!==null&&(_s=a)}}else ec()}function ec(){Ht(Gi,Gi.current),Ht(Fi,Fi.current)}function Es(a){Gt(Fi),_s===a&&(_s=null),Gt(Gi)}var Gi=Lt(0);function hd(a){for(var o=a;o!==null;){if(o.tag===13){var u=o.memoizedState;if(u!==null&&(u=u.dehydrated,u===null||u.data==="$?"||Of(u)))return o}else if(o.tag===19&&o.memoizedProps.revealOrder!==void 0){if((o.flags&128)!==0)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===a)break;for(;o.sibling===null;){if(o.return===null||o.return===a)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}function Jp(a,o,u,f){o=a.memoizedState,u=u(f,o),u=u==null?o:ht({},o,u),a.memoizedState=u,a.lanes===0&&(a.updateQueue.baseState=u)}var cE={enqueueSetState:function(a,o,u){a=a._reactInternals;var f=sa(),g=Xo(f);g.payload=o,u!=null&&(g.callback=u),o=co(a,g,f),o!==null&&(Gr(o,a,f),Ou(o,a,f))},enqueueReplaceState:function(a,o,u){a=a._reactInternals;var f=sa(),g=Xo(f);g.tag=1,g.payload=o,u!=null&&(g.callback=u),o=co(a,g,f),o!==null&&(Gr(o,a,f),Ou(o,a,f))},enqueueForceUpdate:function(a,o){a=a._reactInternals;var u=sa(),f=Xo(u);f.tag=2,o!=null&&(f.callback=o),o=co(a,f,u),o!==null&&(Gr(o,a,u),Ou(o,a,u))}};function lE(a,o,u,f,g,R,x){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(f,R,x):o.prototype&&o.prototype.isPureReactComponent?!Go(u,f)||!Go(g,R):!0}function eT(a,o,u,f){a=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(u,f),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(u,f),o.state!==a&&cE.enqueueReplaceState(o,o.state,null)}function sl(a,o){var u=o;if("ref"in o){u={};for(var f in o)f!=="ref"&&(u[f]=o[f])}if(a=a.defaultProps){u===o&&(u=ht({},u));for(var g in a)u[g]===void 0&&(u[g]=a[g])}return u}var Zp=typeof reportError=="function"?reportError:function(a){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var o=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof a=="object"&&a!==null&&typeof a.message=="string"?String(a.message):String(a),error:a});if(!window.dispatchEvent(o))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",a);return}console.error(a)};function nT(a){Zp(a)}function iT(a){console.error(a)}function rT(a){Zp(a)}function $p(a,o){try{var u=a.onUncaughtError;u(o.value,{componentStack:o.stack})}catch(f){setTimeout(function(){throw f})}}function dE(a,o,u){try{var f=a.onCaughtError;f(u.value,{componentStack:u.stack,errorBoundary:o.tag===1?o.stateNode:null})}catch(g){setTimeout(function(){throw g})}}function za(a,o,u){return u=Xo(u),u.tag=3,u.payload={element:null},u.callback=function(){$p(a,o)},u}function aT(a){return a=Xo(a),a.tag=3,a}function sT(a,o,u,f){var g=u.type.getDerivedStateFromError;if(typeof g=="function"){var R=f.value;a.payload=function(){return g(R)},a.callback=function(){dE(o,u,f)}}var x=u.stateNode;x!==null&&typeof x.componentDidCatch=="function"&&(a.callback=function(){dE(o,u,f),typeof g!="function"&&(ho===null?ho=new Set([this]):ho.add(this));var j=f.stack;this.componentDidCatch(f.value,{componentStack:j!==null?j:""})})}function AC(a,o,u,f,g){if(u.flags|=32768,f!==null&&typeof f=="object"&&typeof f.then=="function"){if(o=u.alternate,o!==null&&bu(o,u,g,!0),u=Fi.current,u!==null){switch(u.tag){case 13:return _s===null?fl():u.alternate===null&&li===0&&(li=3),u.flags&=-257,u.flags|=65536,u.lanes=g,f===id?u.flags|=16384:(o=u.updateQueue,o===null?u.updateQueue=new Set([f]):o.add(f),bd(a,f,g)),!1;case 22:return u.flags|=65536,f===id?u.flags|=16384:(o=u.updateQueue,o===null?(o={transitions:null,markerInstances:null,retryQueue:new Set([f])},u.updateQueue=o):(u=o.retryQueue,u===null?o.retryQueue=new Set([f]):u.add(f)),bd(a,f,g)),!1}throw Error(A(435,u.tag))}return bd(a,f,g),fl(),!1}if(Rn)return o=Fi.current,o!==null?((o.flags&65536)===0&&(o.flags|=256),o.flags|=65536,o.lanes=g,f!==P_&&(a=Error(A(422),{cause:f}),Ru(ea(a,u)))):(f!==P_&&(o=Error(A(423),{cause:f}),Ru(ea(o,u))),a=a.current.alternate,a.flags|=65536,g&=-g,a.lanes|=g,f=ea(f,u),g=za(a.stateNode,f,g),j_(a,g),li!==4&&(li=2)),!1;var R=Error(A(520),{cause:f});if(R=ea(R,u),vd===null?vd=[R]:vd.push(R),li!==4&&(li=2),o===null)return!0;f=ea(f,u),u=o;do{switch(u.tag){case 3:return u.flags|=65536,a=g&-g,u.lanes|=a,a=za(u.stateNode,f,a),j_(u,a),!1;case 1:if(o=u.type,R=u.stateNode,(u.flags&128)===0&&(typeof o.getDerivedStateFromError=="function"||R!==null&&typeof R.componentDidCatch=="function"&&(ho===null||!ho.has(R))))return u.flags|=65536,g&=-g,u.lanes|=g,g=aT(g),sT(g,a,u,f),j_(u,g),!1}u=u.return}while(u!==null);return!1}var oT=Error(A(461)),$i=!1;function or(a,o,u,f){o.child=a===null?$S(o,null,u,f):al(o,a.child,u,f)}function tf(a,o,u,f,g){u=u.render;var R=o.ref;if("ref"in f){var x={};for(var j in f)j!=="ref"&&(x[j]=f[j])}else x=f;return ms(o),f=H_(a,o,u,x,R,g),j=W_(),a!==null&&!$i?(Fp(a,o,g),gs(a,o,g)):(Rn&&j&&Pp(o),o.flags|=1,or(a,o,f,g),o.child)}function cT(a,o,u,f,g){if(a===null){var R=u.type;return typeof R=="function"&&!I_(R)&&R.defaultProps===void 0&&u.compare===null?(o.tag=15,o.type=R,lT(a,o,R,f,g)):(a=Op(u.type,null,f,o,o.mode,g),a.ref=o.ref,a.return=o,o.child=a)}if(R=a.child,!nf(a,g)){var x=R.memoizedProps;if(u=u.compare,u=u!==null?u:Go,u(x,f)&&a.ref===o.ref)return gs(a,o,g)}return o.flags|=1,a=ro(R,f),a.ref=o.ref,a.return=o,o.child=a}function lT(a,o,u,f,g){if(a!==null){var R=a.memoizedProps;if(Go(R,f)&&a.ref===o.ref)if($i=!1,o.pendingProps=f=R,nf(a,g))(a.flags&131072)!==0&&($i=!0);else return o.lanes=a.lanes,gs(a,o,g)}return uE(a,o,u,f,g)}function dT(a,o,u){var f=o.pendingProps,g=f.children,R=a!==null?a.memoizedState:null;if(f.mode==="hidden"){if((o.flags&128)!==0){if(f=R!==null?R.baseLanes|u:u,a!==null){for(g=o.child=a.child,R=0;g!==null;)R=R|g.lanes|g.childLanes,g=g.sibling;o.childLanes=R&~f}else o.childLanes=0,o.child=null;return uT(a,o,f,u)}if((u&536870912)!==0)o.memoizedState={baseLanes:0,cachePool:null},a!==null&&xp(o,R!==null?R.cachePool:null),R!==null?Du(o,R):el(),tT(o);else return o.lanes=o.childLanes=536870912,uT(a,o,R!==null?R.baseLanes|u:u,u)}else R!==null?(xp(o,R.cachePool),Du(o,R),ec(),o.memoizedState=null):(a!==null&&xp(o,null),el(),ec());return or(a,o,g,u),o.child}function uT(a,o,u,f){var g=U_();return g=g===null?null:{parent:Ii._currentValue,pool:g},o.memoizedState={baseLanes:u,cachePool:g},a!==null&&xp(o,null),el(),tT(o),a!==null&&bu(a,o,f,!0),null}function ef(a,o){var u=o.ref;if(u===null)a!==null&&a.ref!==null&&(o.flags|=4194816);else{if(typeof u!="function"&&typeof u!="object")throw Error(A(284));(a===null||a.ref!==u)&&(o.flags|=4194816)}}function uE(a,o,u,f,g){return ms(o),u=H_(a,o,u,f,void 0,g),f=W_(),a!==null&&!$i?(Fp(a,o,g),gs(a,o,g)):(Rn&&f&&Pp(o),o.flags|=1,or(a,o,u,g),o.child)}function hE(a,o,u,f,g,R){return ms(o),o.updateQueue=null,u=PS(o,f,u,g),DS(a),f=W_(),a!==null&&!$i?(Fp(a,o,R),gs(a,o,R)):(Rn&&f&&Pp(o),o.flags|=1,or(a,o,u,R),o.child)}function pE(a,o,u,f,g){if(ms(o),o.stateNode===null){var R=io,x=u.contextType;typeof x=="object"&&x!==null&&(R=Bi(x)),R=new u(f,R),o.memoizedState=R.state!==null&&R.state!==void 0?R.state:null,R.updater=cE,o.stateNode=R,R._reactInternals=o,R=o.stateNode,R.props=f,R.state=o.memoizedState,R.refs={},Vp(o),x=u.contextType,R.context=typeof x=="object"&&x!==null?Bi(x):io,R.state=o.memoizedState,x=u.getDerivedStateFromProps,typeof x=="function"&&(Jp(o,u,x,f),R.state=o.memoizedState),typeof u.getDerivedStateFromProps=="function"||typeof R.getSnapshotBeforeUpdate=="function"||typeof R.UNSAFE_componentWillMount!="function"&&typeof R.componentWillMount!="function"||(x=R.state,typeof R.componentWillMount=="function"&&R.componentWillMount(),typeof R.UNSAFE_componentWillMount=="function"&&R.UNSAFE_componentWillMount(),x!==R.state&&cE.enqueueReplaceState(R,R.state,null),$c(o,f,R,g),Zc(),R.state=o.memoizedState),typeof R.componentDidMount=="function"&&(o.flags|=4194308),f=!0}else if(a===null){R=o.stateNode;var j=o.memoizedProps,X=sl(u,j);R.props=X;var ct=R.context,Rt=u.contextType;x=io,typeof Rt=="object"&&Rt!==null&&(x=Bi(Rt));var Nt=u.getDerivedStateFromProps;Rt=typeof Nt=="function"||typeof R.getSnapshotBeforeUpdate=="function",j=o.pendingProps!==j,Rt||typeof R.UNSAFE_componentWillReceiveProps!="function"&&typeof R.componentWillReceiveProps!="function"||(j||ct!==x)&&eT(o,R,f,x),Ha=!1;var _t=o.memoizedState;R.state=_t,$c(o,f,R,g),Zc(),ct=o.memoizedState,j||_t!==ct||Ha?(typeof Nt=="function"&&(Jp(o,u,Nt,f),ct=o.memoizedState),(X=Ha||lE(o,u,X,f,_t,ct,x))?(Rt||typeof R.UNSAFE_componentWillMount!="function"&&typeof R.componentWillMount!="function"||(typeof R.componentWillMount=="function"&&R.componentWillMount(),typeof R.UNSAFE_componentWillMount=="function"&&R.UNSAFE_componentWillMount()),typeof R.componentDidMount=="function"&&(o.flags|=4194308)):(typeof R.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=f,o.memoizedState=ct),R.props=f,R.state=ct,R.context=x,f=X):(typeof R.componentDidMount=="function"&&(o.flags|=4194308),f=!1)}else{R=o.stateNode,V_(a,o),x=o.memoizedProps,Rt=sl(u,x),R.props=Rt,Nt=o.pendingProps,_t=R.context,ct=u.contextType,X=io,typeof ct=="object"&&ct!==null&&(X=Bi(ct)),j=u.getDerivedStateFromProps,(ct=typeof j=="function"||typeof R.getSnapshotBeforeUpdate=="function")||typeof R.UNSAFE_componentWillReceiveProps!="function"&&typeof R.componentWillReceiveProps!="function"||(x!==Nt||_t!==X)&&eT(o,R,f,X),Ha=!1,_t=o.memoizedState,R.state=_t,$c(o,f,R,g),Zc();var gt=o.memoizedState;x!==Nt||_t!==gt||Ha||a!==null&&a.dependencies!==null&&Lp(a.dependencies)?(typeof j=="function"&&(Jp(o,u,j,f),gt=o.memoizedState),(Rt=Ha||lE(o,u,Rt,f,_t,gt,X)||a!==null&&a.dependencies!==null&&Lp(a.dependencies))?(ct||typeof R.UNSAFE_componentWillUpdate!="function"&&typeof R.componentWillUpdate!="function"||(typeof R.componentWillUpdate=="function"&&R.componentWillUpdate(f,gt,X),typeof R.UNSAFE_componentWillUpdate=="function"&&R.UNSAFE_componentWillUpdate(f,gt,X)),typeof R.componentDidUpdate=="function"&&(o.flags|=4),typeof R.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof R.componentDidUpdate!="function"||x===a.memoizedProps&&_t===a.memoizedState||(o.flags|=4),typeof R.getSnapshotBeforeUpdate!="function"||x===a.memoizedProps&&_t===a.memoizedState||(o.flags|=1024),o.memoizedProps=f,o.memoizedState=gt),R.props=f,R.state=gt,R.context=X,f=Rt):(typeof R.componentDidUpdate!="function"||x===a.memoizedProps&&_t===a.memoizedState||(o.flags|=4),typeof R.getSnapshotBeforeUpdate!="function"||x===a.memoizedProps&&_t===a.memoizedState||(o.flags|=1024),f=!1)}return R=f,ef(a,o),f=(o.flags&128)!==0,R||f?(R=o.stateNode,u=f&&typeof u.getDerivedStateFromError!="function"?null:R.render(),o.flags|=1,a!==null&&f?(o.child=al(o,a.child,null,g),o.child=al(o,null,u,g)):or(a,o,u,g),o.memoizedState=R.state,a=o.child):a=gs(a,o,g),a}function hT(a,o,u,f){return Yc(),o.flags|=256,or(a,o,u,f),o.child}var fE={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function pd(a){return{baseLanes:a,cachePool:CS()}}function zu(a,o,u){return a=a!==null?a.childLanes&~u:0,o&&(a|=Sa),a}function mE(a,o,u){var f=o.pendingProps,g=!1,R=(o.flags&128)!==0,x;if((x=R)||(x=a!==null&&a.memoizedState===null?!1:(Gi.current&2)!==0),x&&(g=!0,o.flags&=-129),x=(o.flags&32)!==0,o.flags&=-33,a===null){if(Rn){if(g?tc(o):ec(),Rn){var j=Zn,X;if(X=j){t:{for(X=j,j=fs;X.nodeType!==8;){if(!j){j=null;break t}if(X=Ja(X.nextSibling),X===null){j=null;break t}}j=X}j!==null?(o.memoizedState={dehydrated:j,treeContext:Wc!==null?{id:ao,overflow:Ga}:null,retryLane:536870912,hydrationErrors:null},X=na(18,null,null,0),X.stateNode=j,X.return=o,o.child=X,_r=o,Zn=null,X=!0):X=!1}X||Kc(o)}if(j=o.memoizedState,j!==null&&(j=j.dehydrated,j!==null))return Of(j)?o.lanes=32:o.lanes=536870912,null;Es(o)}return j=f.children,f=f.fallback,g?(ec(),g=o.mode,j=qu({mode:"hidden",children:j},g),f=qo(f,g,u,null),j.return=o,f.return=o,j.sibling=f,o.child=j,g=o.child,g.memoizedState=pd(u),g.childLanes=zu(a,x,u),o.memoizedState=fE,f):(tc(o),fd(o,j))}if(X=a.memoizedState,X!==null&&(j=X.dehydrated,j!==null)){if(R)o.flags&256?(tc(o),o.flags&=-257,o=_E(a,o,u)):o.memoizedState!==null?(ec(),o.child=a.child,o.flags|=128,o=null):(ec(),g=f.fallback,j=o.mode,f=qu({mode:"visible",children:f.children},j),g=qo(g,j,u,null),g.flags|=2,f.return=o,g.return=o,f.sibling=g,o.child=f,al(o,a.child,null,u),f=o.child,f.memoizedState=pd(u),f.childLanes=zu(a,x,u),o.memoizedState=fE,o=g);else if(tc(o),Of(j)){if(x=j.nextSibling&&j.nextSibling.dataset,x)var ct=x.dgst;x=ct,f=Error(A(419)),f.stack="",f.digest=x,Ru({value:f,source:null,stack:null}),o=_E(a,o,u)}else if($i||bu(a,o,u,!1),x=(u&a.childLanes)!==0,$i||x){if(x=Yn,x!==null&&(f=u&-u,f=(f&42)!==0?1:Vo(f),f=(f&(x.suspendedLanes|u))!==0?0:f,f!==0&&f!==X.retryLane))throw X.retryLane=f,Jl(a,f),Gr(x,a,f),oT;j.data==="$?"||fl(),o=_E(a,o,u)}else j.data==="$?"?(o.flags|=192,o.child=a.child,o=null):(a=X.treeContext,Zn=Ja(j.nextSibling),_r=o,Rn=!0,qc=null,fs=!1,a!==null&&(ia[ga++]=ao,ia[ga++]=Ga,ia[ga++]=Wc,ao=a.id,Ga=a.overflow,Wc=o),o=fd(o,f.children),o.flags|=4096);return o}return g?(ec(),g=f.fallback,j=o.mode,X=a.child,ct=X.sibling,f=ro(X,{mode:"hidden",children:f.children}),f.subtreeFlags=X.subtreeFlags&65011712,ct!==null?g=ro(ct,g):(g=qo(g,j,u,null),g.flags|=2),g.return=o,f.return=o,f.sibling=g,o.child=f,f=g,g=o.child,j=a.child.memoizedState,j===null?j=pd(u):(X=j.cachePool,X!==null?(ct=Ii._currentValue,X=X.parent!==ct?{parent:ct,pool:ct}:X):X=CS(),j={baseLanes:j.baseLanes|u,cachePool:X}),g.memoizedState=j,g.childLanes=zu(a,x,u),o.memoizedState=fE,f):(tc(o),u=a.child,a=u.sibling,u=ro(u,{mode:"visible",children:f.children}),u.return=o,u.sibling=null,a!==null&&(x=o.deletions,x===null?(o.deletions=[a],o.flags|=16):x.push(a)),o.child=u,o.memoizedState=null,u)}function fd(a,o){return o=qu({mode:"visible",children:o},a.mode),o.return=a,a.child=o}function qu(a,o){return a=na(22,a,null,o),a.lanes=0,a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},a}function _E(a,o,u){return al(o,a.child,null,u),a=fd(o,o.pendingProps.children),a.flags|=2,o.memoizedState=null,a}function EE(a,o,u){a.lanes|=o;var f=a.alternate;f!==null&&(f.lanes|=o),x_(a.return,o,u)}function md(a,o,u,f,g){var R=a.memoizedState;R===null?a.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:f,tail:u,tailMode:g}:(R.isBackwards=o,R.rendering=null,R.renderingStartTime=0,R.last=f,R.tail=u,R.tailMode=g)}function pT(a,o,u){var f=o.pendingProps,g=f.revealOrder,R=f.tail;if(or(a,o,f.children,u),f=Gi.current,(f&2)!==0)f=f&1|2,o.flags|=128;else{if(a!==null&&(a.flags&128)!==0)t:for(a=o.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&EE(a,u,o);else if(a.tag===19)EE(a,u,o);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===o)break t;for(;a.sibling===null;){if(a.return===null||a.return===o)break t;a=a.return}a.sibling.return=a.return,a=a.sibling}f&=1}switch(Ht(Gi,f),g){case"forwards":for(u=o.child,g=null;u!==null;)a=u.alternate,a!==null&&hd(a)===null&&(g=u),u=u.sibling;u=g,u===null?(g=o.child,o.child=null):(g=u.sibling,u.sibling=null),md(o,!1,g,u,R);break;case"backwards":for(u=null,g=o.child,o.child=null;g!==null;){if(a=g.alternate,a!==null&&hd(a)===null){o.child=g;break}a=g.sibling,g.sibling=u,u=g,g=a}md(o,!0,u,null,R);break;case"together":md(o,!1,null,null,void 0);break;default:o.memoizedState=null}return o.child}function gs(a,o,u){if(a!==null&&(o.dependencies=a.dependencies),Ya|=o.lanes,(u&o.childLanes)===0)if(a!==null){if(bu(a,o,u,!1),(u&o.childLanes)===0)return null}else return null;if(a!==null&&o.child!==a.child)throw Error(A(153));if(o.child!==null){for(a=o.child,u=ro(a,a.pendingProps),o.child=u,u.return=o;a.sibling!==null;)a=a.sibling,u=u.sibling=ro(a,a.pendingProps),u.return=o;u.sibling=null}return o.child}function nf(a,o){return(a.lanes&o)!==0?!0:(a=a.dependencies,!!(a!==null&&Lp(a)))}function wC(a,o,u){switch(o.tag){case 3:Fn(o,o.stateNode.containerInfo),Ko(o,Ii,a.memoizedState.cache),Yc();break;case 27:case 5:Ua(o);break;case 4:Fn(o,o.stateNode.containerInfo);break;case 10:Ko(o,o.type,o.memoizedProps.value);break;case 13:var f=o.memoizedState;if(f!==null)return f.dehydrated!==null?(tc(o),o.flags|=128,null):(u&o.child.childLanes)!==0?mE(a,o,u):(tc(o),a=gs(a,o,u),a!==null?a.sibling:null);tc(o);break;case 19:var g=(a.flags&128)!==0;if(f=(u&o.childLanes)!==0,f||(bu(a,o,u,!1),f=(u&o.childLanes)!==0),g){if(f)return pT(a,o,u);o.flags|=128}if(g=o.memoizedState,g!==null&&(g.rendering=null,g.tail=null,g.lastEffect=null),Ht(Gi,Gi.current),f)break;return null;case 22:case 23:return o.lanes=0,dT(a,o,u);case 24:Ko(o,Ii,a.memoizedState.cache)}return gs(a,o,u)}function Ku(a,o,u){if(a!==null)if(a.memoizedProps!==o.pendingProps)$i=!0;else{if(!nf(a,u)&&(o.flags&128)===0)return $i=!1,wC(a,o,u);$i=(a.flags&131072)!==0}else $i=!1,Rn&&(o.flags&1048576)!==0&&N_(o,Dp,o.index);switch(o.lanes=0,o.tag){case 16:t:{a=o.pendingProps;var f=o.elementType,g=f._init;if(f=g(f._payload),o.type=f,typeof f=="function")I_(f)?(a=sl(f,a),o.tag=1,o=pE(null,o,f,a,u)):(o.tag=0,o=uE(null,o,f,a,u));else{if(f!=null){if(g=f.$$typeof,g===fe){o.tag=11,o=tf(null,o,f,a,u);break t}else if(g===ue){o.tag=14,o=cT(null,o,f,a,u);break t}}throw o=Kt(f)||f,Error(A(306,o,""))}}return o;case 0:return uE(a,o,o.type,o.pendingProps,u);case 1:return f=o.type,g=sl(f,o.pendingProps),pE(a,o,f,g,u);case 3:t:{if(Fn(o,o.stateNode.containerInfo),a===null)throw Error(A(387));f=o.pendingProps;var R=o.memoizedState;g=R.element,V_(a,o),$c(o,f,null,u);var x=o.memoizedState;if(f=x.cache,Ko(o,Ii,f),f!==R.cache&&M_(o,[Ii],u,!0),Zc(),f=x.element,R.isDehydrated)if(R={element:f,isDehydrated:!1,cache:x.cache},o.updateQueue.baseState=R,o.memoizedState=R,o.flags&256){o=hT(a,o,f,u);break t}else if(f!==g){g=ea(Error(A(424)),o),Ru(g),o=hT(a,o,f,u);break t}else{switch(a=o.stateNode.containerInfo,a.nodeType){case 9:a=a.body;break;default:a=a.nodeName==="HTML"?a.ownerDocument.body:a}for(Zn=Ja(a.firstChild),_r=o,Rn=!0,qc=null,fs=!0,u=$S(o,null,f,u),o.child=u;u;)u.flags=u.flags&-3|4096,u=u.sibling}else{if(Yc(),f===g){o=gs(a,o,u);break t}or(a,o,f,u)}o=o.child}return o;case 26:return ef(a,o),a===null?(u=HT(o.type,null,o.pendingProps,null))?o.memoizedState=u:Rn||(u=o.type,a=o.pendingProps,f=If(me.current).createElement(u),f[fr]=o,f[Mr]=a,er(f,u,a),Vi(f),o.stateNode=f):o.memoizedState=HT(o.type,a.memoizedProps,o.pendingProps,a.memoizedState),null;case 27:return Ua(o),a===null&&Rn&&(f=o.stateNode=jT(o.type,o.pendingProps,me.current),_r=o,fs=!0,g=Zn,dc(o.type)?(QE=g,Zn=Ja(f.firstChild)):Zn=g),or(a,o,o.pendingProps.children,u),ef(a,o),a===null&&(o.flags|=4194304),o.child;case 5:return a===null&&Rn&&((g=f=Zn)&&(f=zC(f,o.type,o.pendingProps,fs),f!==null?(o.stateNode=f,_r=o,Zn=Ja(f.firstChild),fs=!1,g=!0):g=!1),g||Kc(o)),Ua(o),g=o.type,R=o.pendingProps,x=a!==null?a.memoizedProps:null,f=R.children,KE(g,R)?f=null:x!==null&&KE(g,x)&&(o.flags|=32),o.memoizedState!==null&&(g=H_(a,o,kS,null,null,u),_h._currentValue=g),ef(a,o),or(a,o,f,u),o.child;case 6:return a===null&&Rn&&((a=u=Zn)&&(u=qC(u,o.pendingProps,fs),u!==null?(o.stateNode=u,_r=o,Zn=null,a=!0):a=!1),a||Kc(o)),null;case 13:return mE(a,o,u);case 4:return Fn(o,o.stateNode.containerInfo),f=o.pendingProps,a===null?o.child=al(o,null,f,u):or(a,o,f,u),o.child;case 11:return tf(a,o,o.type,o.pendingProps,u);case 7:return or(a,o,o.pendingProps,u),o.child;case 8:return or(a,o,o.pendingProps.children,u),o.child;case 12:return or(a,o,o.pendingProps.children,u),o.child;case 10:return f=o.pendingProps,Ko(o,o.type,f.value),or(a,o,f.children,u),o.child;case 9:return g=o.type._context,f=o.pendingProps.children,ms(o),g=Bi(g),f=f(g),o.flags|=1,or(a,o,f,u),o.child;case 14:return cT(a,o,o.type,o.pendingProps,u);case 15:return lT(a,o,o.type,o.pendingProps,u);case 19:return pT(a,o,u);case 31:return f=o.pendingProps,u=o.mode,f={mode:f.mode,children:f.children},a===null?(u=qu(f,u),u.ref=o.ref,o.child=u,u.return=o,o=u):(u=ro(a.child,f),u.ref=o.ref,o.child=u,u.return=o,o=u),o;case 22:return dT(a,o,u);case 24:return ms(o),f=Bi(Ii),a===null?(g=U_(),g===null&&(g=Yn,R=Cu(),g.pooledCache=R,R.refCount++,R!==null&&(g.pooledCacheLanes|=u),g=R),o.memoizedState={parent:f,cache:g},Vp(o),Ko(o,Ii,g)):((a.lanes&u)!==0&&(V_(a,o),$c(o,null,null,u),Zc()),g=a.memoizedState,R=o.memoizedState,g.parent!==f?(g={parent:f,cache:f},o.memoizedState=g,o.lanes===0&&(o.memoizedState=o.updateQueue.baseState=g),Ko(o,Ii,f)):(f=R.cache,Ko(o,Ii,f),f!==g.cache&&M_(o,[Ii],u,!0))),or(a,o,o.pendingProps.children,u),o.child;case 29:throw o.pendingProps}throw Error(A(156,o.tag))}function vs(a){a.flags|=4}function fT(a,o){if(o.type!=="stylesheet"||(o.state.loading&4)!==0)a.flags&=-16777217;else if(a.flags|=16777216,!qT(o)){if(o=Fi.current,o!==null&&((un&4194048)===un?_s!==null:(un&62914560)!==un&&(un&536870912)===0||o!==_s))throw Iu=id,AS;a.flags|=8192}}function rf(a,o){o!==null&&(a.flags|=4),a.flags&16384&&(o=a.tag!==22?Dv():536870912,a.lanes|=o,dl|=o)}function Yu(a,o){if(!Rn)switch(a.tailMode){case"hidden":o=a.tail;for(var u=null;o!==null;)o.alternate!==null&&(u=o),o=o.sibling;u===null?a.tail=null:u.sibling=null;break;case"collapsed":u=a.tail;for(var f=null;u!==null;)u.alternate!==null&&(f=u),u=u.sibling;f===null?o||a.tail===null?a.tail=null:a.tail.sibling=null:f.sibling=null}}function Kn(a){var o=a.alternate!==null&&a.alternate.child===a.child,u=0,f=0;if(o)for(var g=a.child;g!==null;)u|=g.lanes|g.childLanes,f|=g.subtreeFlags&65011712,f|=g.flags&65011712,g.return=a,g=g.sibling;else for(g=a.child;g!==null;)u|=g.lanes|g.childLanes,f|=g.subtreeFlags,f|=g.flags,g.return=a,g=g.sibling;return a.subtreeFlags|=f,a.childLanes=u,o}function IC(a,o,u){var f=o.pendingProps;switch(D_(o),o.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Kn(o),null;case 1:return Kn(o),null;case 3:return u=o.stateNode,f=null,a!==null&&(f=a.memoizedState.cache),o.memoizedState.cache!==f&&(o.flags|=2048),oo(Ii),xr(),u.pendingContext&&(u.context=u.pendingContext,u.pendingContext=null),(a===null||a.child===null)&&(yu(o)?vs(o):a===null||a.memoizedState.isDehydrated&&(o.flags&256)===0||(o.flags|=1024,SS())),Kn(o),null;case 26:return u=o.memoizedState,a===null?(vs(o),u!==null?(Kn(o),fT(o,u)):(Kn(o),o.flags&=-16777217)):u?u!==a.memoizedState?(vs(o),Kn(o),fT(o,u)):(Kn(o),o.flags&=-16777217):(a.memoizedProps!==f&&vs(o),Kn(o),o.flags&=-16777217),null;case 27:Ys(o),u=me.current;var g=o.type;if(a!==null&&o.stateNode!=null)a.memoizedProps!==f&&vs(o);else{if(!f){if(o.stateNode===null)throw Error(A(166));return Kn(o),null}a=re.current,yu(o)?k_(o):(a=jT(g,f,u),o.stateNode=a,vs(o))}return Kn(o),null;case 5:if(Ys(o),u=o.type,a!==null&&o.stateNode!=null)a.memoizedProps!==f&&vs(o);else{if(!f){if(o.stateNode===null)throw Error(A(166));return Kn(o),null}if(a=re.current,yu(o))k_(o);else{switch(g=If(me.current),a){case 1:a=g.createElementNS("http://www.w3.org/2000/svg",u);break;case 2:a=g.createElementNS("http://www.w3.org/1998/Math/MathML",u);break;default:switch(u){case"svg":a=g.createElementNS("http://www.w3.org/2000/svg",u);break;case"math":a=g.createElementNS("http://www.w3.org/1998/Math/MathML",u);break;case"script":a=g.createElement("div"),a.innerHTML="<script><\/script>",a=a.removeChild(a.firstChild);break;case"select":a=typeof f.is=="string"?g.createElement("select",{is:f.is}):g.createElement("select"),f.multiple?a.multiple=!0:f.size&&(a.size=f.size);break;default:a=typeof f.is=="string"?g.createElement(u,{is:f.is}):g.createElement(u)}}a[fr]=o,a[Mr]=f;t:for(g=o.child;g!==null;){if(g.tag===5||g.tag===6)a.appendChild(g.stateNode);else if(g.tag!==4&&g.tag!==27&&g.child!==null){g.child.return=g,g=g.child;continue}if(g===o)break t;for(;g.sibling===null;){if(g.return===null||g.return===o)break t;g=g.return}g.sibling.return=g.return,g=g.sibling}o.stateNode=a;t:switch(er(a,u,f),u){case"button":case"input":case"select":case"textarea":a=!!f.autoFocus;break t;case"img":a=!0;break t;default:a=!1}a&&vs(o)}}return Kn(o),o.flags&=-16777217,null;case 6:if(a&&o.stateNode!=null)a.memoizedProps!==f&&vs(o);else{if(typeof f!="string"&&o.stateNode===null)throw Error(A(166));if(a=me.current,yu(o)){if(a=o.stateNode,u=o.memoizedProps,f=null,g=_r,g!==null)switch(g.tag){case 27:case 5:f=g.memoizedProps}a[fr]=o,a=!!(a.nodeValue===u||f!==null&&f.suppressHydrationWarning===!0||wf(a.nodeValue,u)),a||Kc(o)}else a=If(a).createTextNode(f),a[fr]=o,o.stateNode=a}return Kn(o),null;case 13:if(f=o.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(g=yu(o),f!==null&&f.dehydrated!==null){if(a===null){if(!g)throw Error(A(318));if(g=o.memoizedState,g=g!==null?g.dehydrated:null,!g)throw Error(A(317));g[fr]=o}else Yc(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;Kn(o),g=!1}else g=SS(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=g),g=!0;if(!g)return o.flags&256?(Es(o),o):(Es(o),null)}if(Es(o),(o.flags&128)!==0)return o.lanes=u,o;if(u=f!==null,a=a!==null&&a.memoizedState!==null,u){f=o.child,g=null,f.alternate!==null&&f.alternate.memoizedState!==null&&f.alternate.memoizedState.cachePool!==null&&(g=f.alternate.memoizedState.cachePool.pool);var R=null;f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(R=f.memoizedState.cachePool.pool),R!==g&&(f.flags|=2048)}return u!==a&&u&&(o.child.flags|=8192),rf(o,o.updateQueue),Kn(o),null;case 4:return xr(),a===null&&Cf(o.stateNode.containerInfo),Kn(o),null;case 10:return oo(o.type),Kn(o),null;case 19:if(Gt(Gi),g=o.memoizedState,g===null)return Kn(o),null;if(f=(o.flags&128)!==0,R=g.rendering,R===null)if(f)Yu(g,!1);else{if(li!==0||a!==null&&(a.flags&128)!==0)for(a=o.child;a!==null;){if(R=hd(a),R!==null){for(o.flags|=128,Yu(g,!1),a=R.updateQueue,o.updateQueue=a,rf(o,a),o.subtreeFlags=0,a=u,u=o.child;u!==null;)Ip(u,a),u=u.sibling;return Ht(Gi,Gi.current&1|2),o.child}a=a.sibling}g.tail!==null&&sr()>Sd&&(o.flags|=128,f=!0,Yu(g,!1),o.lanes=4194304)}else{if(!f)if(a=hd(R),a!==null){if(o.flags|=128,f=!0,a=a.updateQueue,o.updateQueue=a,rf(o,a),Yu(g,!0),g.tail===null&&g.tailMode==="hidden"&&!R.alternate&&!Rn)return Kn(o),null}else 2*sr()-g.renderingStartTime>Sd&&u!==536870912&&(o.flags|=128,f=!0,Yu(g,!1),o.lanes=4194304);g.isBackwards?(R.sibling=o.child,o.child=R):(a=g.last,a!==null?a.sibling=R:o.child=R,g.last=R)}return g.tail!==null?(o=g.tail,g.rendering=o,g.tail=o.sibling,g.renderingStartTime=sr(),o.sibling=null,a=Gi.current,Ht(Gi,f?a&1|2:a&1),o):(Kn(o),null);case 22:case 23:return Es(o),G_(),f=o.memoizedState!==null,a!==null?a.memoizedState!==null!==f&&(o.flags|=8192):f&&(o.flags|=8192),f?(u&536870912)!==0&&(o.flags&128)===0&&(Kn(o),o.subtreeFlags&6&&(o.flags|=8192)):Kn(o),u=o.updateQueue,u!==null&&rf(o,u.retryQueue),u=null,a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(u=a.memoizedState.cachePool.pool),f=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(f=o.memoizedState.cachePool.pool),f!==u&&(o.flags|=2048),a!==null&&Gt(Yo),null;case 24:return u=null,a!==null&&(u=a.memoizedState.cache),o.memoizedState.cache!==u&&(o.flags|=2048),oo(Ii),Kn(o),null;case 25:return null;case 30:return null}throw Error(A(156,o.tag))}function OC(a,o){switch(D_(o),o.tag){case 1:return a=o.flags,a&65536?(o.flags=a&-65537|128,o):null;case 3:return oo(Ii),xr(),a=o.flags,(a&65536)!==0&&(a&128)===0?(o.flags=a&-65537|128,o):null;case 26:case 27:case 5:return Ys(o),null;case 13:if(Es(o),a=o.memoizedState,a!==null&&a.dehydrated!==null){if(o.alternate===null)throw Error(A(340));Yc()}return a=o.flags,a&65536?(o.flags=a&-65537|128,o):null;case 19:return Gt(Gi),null;case 4:return xr(),null;case 10:return oo(o.type),null;case 22:case 23:return Es(o),G_(),a!==null&&Gt(Yo),a=o.flags,a&65536?(o.flags=a&-65537|128,o):null;case 24:return oo(Ii),null;case 25:return null;default:return null}}function mT(a,o){switch(D_(o),o.tag){case 3:oo(Ii),xr();break;case 26:case 27:case 5:Ys(o);break;case 4:xr();break;case 13:Es(o);break;case 19:Gt(Gi);break;case 10:oo(o.type);break;case 22:case 23:Es(o),G_(),a!==null&&Gt(Yo);break;case 24:oo(Ii)}}function _d(a,o){try{var u=o.updateQueue,f=u!==null?u.lastEffect:null;if(f!==null){var g=f.next;u=g;do{if((u.tag&a)===a){f=void 0;var R=u.create,x=u.inst;f=R(),x.destroy=f}u=u.next}while(u!==g)}}catch(j){Hn(o,o.return,j)}}function nc(a,o,u){try{var f=o.updateQueue,g=f!==null?f.lastEffect:null;if(g!==null){var R=g.next;f=R;do{if((f.tag&a)===a){var x=f.inst,j=x.destroy;if(j!==void 0){x.destroy=void 0,g=o;var X=u,ct=j;try{ct()}catch(Rt){Hn(g,X,Rt)}}}f=f.next}while(f!==R)}}catch(Rt){Hn(o,o.return,Rt)}}function _T(a){var o=a.updateQueue;if(o!==null){var u=a.stateNode;try{jp(o,u)}catch(f){Hn(a,a.return,f)}}}function af(a,o,u){u.props=sl(a.type,a.memoizedProps),u.state=a.memoizedState;try{u.componentWillUnmount()}catch(f){Hn(a,o,f)}}function Xu(a,o){try{var u=a.ref;if(u!==null){switch(a.tag){case 26:case 27:case 5:var f=a.stateNode;break;case 30:f=a.stateNode;break;default:f=a.stateNode}typeof u=="function"?a.refCleanup=u(f):u.current=f}}catch(g){Hn(a,o,g)}}function va(a,o){var u=a.ref,f=a.refCleanup;if(u!==null)if(typeof f=="function")try{f()}catch(g){Hn(a,o,g)}finally{a.refCleanup=null,a=a.alternate,a!=null&&(a.refCleanup=null)}else if(typeof u=="function")try{u(null)}catch(g){Hn(a,o,g)}else u.current=null}function ET(a){var o=a.type,u=a.memoizedProps,f=a.stateNode;try{t:switch(o){case"button":case"input":case"select":case"textarea":u.autoFocus&&f.focus();break t;case"img":u.src?f.src=u.src:u.srcSet&&(f.srcset=u.srcSet)}}catch(g){Hn(a,a.return,g)}}function sf(a,o,u){try{var f=a.stateNode;BC(f,a.type,u,o),f[Mr]=o}catch(g){Hn(a,a.return,g)}}function gT(a){return a.tag===5||a.tag===3||a.tag===26||a.tag===27&&dc(a.type)||a.tag===4}function gE(a){t:for(;;){for(;a.sibling===null;){if(a.return===null||gT(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.tag===27&&dc(a.type)||a.flags&2||a.child===null||a.tag===4)continue t;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function of(a,o,u){var f=a.tag;if(f===5||f===6)a=a.stateNode,o?(u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u).insertBefore(a,o):(o=u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u,o.appendChild(a),u=u._reactRootContainer,u!=null||o.onclick!==null||(o.onclick=dh));else if(f!==4&&(f===27&&dc(a.type)&&(u=a.stateNode,o=null),a=a.child,a!==null))for(of(a,o,u),a=a.sibling;a!==null;)of(a,o,u),a=a.sibling}function cf(a,o,u){var f=a.tag;if(f===5||f===6)a=a.stateNode,o?u.insertBefore(a,o):u.appendChild(a);else if(f!==4&&(f===27&&dc(a.type)&&(u=a.stateNode),a=a.child,a!==null))for(cf(a,o,u),a=a.sibling;a!==null;)cf(a,o,u),a=a.sibling}function vT(a){var o=a.stateNode,u=a.memoizedProps;try{for(var f=a.type,g=o.attributes;g.length;)o.removeAttributeNode(g[0]);er(o,f,u),o[fr]=a,o[Mr]=u}catch(R){Hn(a,a.return,R)}}var Ss=!1,pi=!1,Qu=!1,ST=typeof WeakSet=="function"?WeakSet:Set,tr=null;function Ju(a,o){if(a=a.containerInfo,qE=Mf,a=no(a),v_(a)){if("selectionStart"in a)var u={start:a.selectionStart,end:a.selectionEnd};else t:{u=(u=a.ownerDocument)&&u.defaultView||window;var f=u.getSelection&&u.getSelection();if(f&&f.rangeCount!==0){u=f.anchorNode;var g=f.anchorOffset,R=f.focusNode;f=f.focusOffset;try{u.nodeType,R.nodeType}catch{u=null;break t}var x=0,j=-1,X=-1,ct=0,Rt=0,Nt=a,_t=null;e:for(;;){for(var gt;Nt!==u||g!==0&&Nt.nodeType!==3||(j=x+g),Nt!==R||f!==0&&Nt.nodeType!==3||(X=x+f),Nt.nodeType===3&&(x+=Nt.nodeValue.length),(gt=Nt.firstChild)!==null;)_t=Nt,Nt=gt;for(;;){if(Nt===a)break e;if(_t===u&&++ct===g&&(j=x),_t===R&&++Rt===f&&(X=x),(gt=Nt.nextSibling)!==null)break;Nt=_t,_t=Nt.parentNode}Nt=gt}u=j===-1||X===-1?null:{start:j,end:X}}else u=null}u=u||{start:0,end:0}}else u=null;for(Dd={focusedElem:a,selectionRange:u},Mf=!1,tr=o;tr!==null;)if(o=tr,a=o.child,(o.subtreeFlags&1024)!==0&&a!==null)a.return=o,tr=a;else for(;tr!==null;){switch(o=tr,R=o.alternate,a=o.flags,o.tag){case 0:break;case 11:case 15:break;case 1:if((a&1024)!==0&&R!==null){a=void 0,u=o,g=R.memoizedProps,R=R.memoizedState,f=u.stateNode;try{var we=sl(u.type,g,u.elementType===u.type);a=f.getSnapshotBeforeUpdate(we,R),f.__reactInternalSnapshotBeforeUpdate=a}catch(_e){Hn(u,u.return,_e)}}break;case 3:if((a&1024)!==0){if(a=o.stateNode.containerInfo,u=a.nodeType,u===9)XE(a);else if(u===1)switch(a.nodeName){case"HEAD":case"HTML":case"BODY":XE(a);break;default:a.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((a&1024)!==0)throw Error(A(163))}if(a=o.sibling,a!==null){a.return=o.return,tr=a;break}tr=o.return}}function vE(a,o,u){var f=u.flags;switch(u.tag){case 0:case 11:case 15:Cr(a,u),f&4&&_d(5,u);break;case 1:if(Cr(a,u),f&4)if(a=u.stateNode,o===null)try{a.componentDidMount()}catch(x){Hn(u,u.return,x)}else{var g=sl(u.type,o.memoizedProps);o=o.memoizedState;try{a.componentDidUpdate(g,o,a.__reactInternalSnapshotBeforeUpdate)}catch(x){Hn(u,u.return,x)}}f&64&&_T(u),f&512&&Xu(u,u.return);break;case 3:if(Cr(a,u),f&64&&(a=u.updateQueue,a!==null)){if(o=null,u.child!==null)switch(u.child.tag){case 27:case 5:o=u.child.stateNode;break;case 1:o=u.child.stateNode}try{jp(a,o)}catch(x){Hn(u,u.return,x)}}break;case 27:o===null&&f&4&&vT(u);case 26:case 5:Cr(a,u),o===null&&f&4&&ET(u),f&512&&Xu(u,u.return);break;case 12:Cr(a,u);break;case 13:Cr(a,u),f&4&&TT(a,u),f&64&&(a=u.memoizedState,a!==null&&(a=a.dehydrated,a!==null&&(u=xC.bind(null,u),KC(a,u))));break;case 22:if(f=u.memoizedState!==null||Ss,!f){o=o!==null&&o.memoizedState!==null||pi,g=Ss;var R=pi;Ss=f,(pi=o)&&!R?Fr(a,u,(u.subtreeFlags&8772)!==0):Cr(a,u),Ss=g,pi=R}break;case 30:break;default:Cr(a,u)}}function Ed(a){var o=a.alternate;o!==null&&(a.alternate=null,Ed(o)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(o=a.stateNode,o!==null&&hp(o)),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}var Dn=null,br=!1;function qa(a,o,u){for(u=u.child;u!==null;)Zu(a,o,u),u=u.sibling}function Zu(a,o,u){if(We&&typeof We.onCommitFiberUnmount=="function")try{We.onCommitFiberUnmount(Gn,u)}catch{}switch(u.tag){case 26:pi||va(u,o),qa(a,o,u),u.memoizedState?u.memoizedState.count--:u.stateNode&&(u=u.stateNode,u.parentNode.removeChild(u));break;case 27:pi||va(u,o);var f=Dn,g=br;dc(u.type)&&(Dn=u.stateNode,br=!1),qa(a,o,u),uh(u.stateNode),Dn=f,br=g;break;case 5:pi||va(u,o);case 6:if(f=Dn,g=br,Dn=null,qa(a,o,u),Dn=f,br=g,Dn!==null)if(br)try{(Dn.nodeType===9?Dn.body:Dn.nodeName==="HTML"?Dn.ownerDocument.body:Dn).removeChild(u.stateNode)}catch(R){Hn(u,o,R)}else try{Dn.removeChild(u.stateNode)}catch(R){Hn(u,o,R)}break;case 18:Dn!==null&&(br?(a=Dn,UT(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,u.stateNode),Th(a)):UT(Dn,u.stateNode));break;case 4:f=Dn,g=br,Dn=u.stateNode.containerInfo,br=!0,qa(a,o,u),Dn=f,br=g;break;case 0:case 11:case 14:case 15:pi||nc(2,u,o),pi||nc(4,u,o),qa(a,o,u);break;case 1:pi||(va(u,o),f=u.stateNode,typeof f.componentWillUnmount=="function"&&af(u,o,f)),qa(a,o,u);break;case 21:qa(a,o,u);break;case 22:pi=(f=pi)||u.memoizedState!==null,qa(a,o,u),pi=f;break;default:qa(a,o,u)}}function TT(a,o){if(o.memoizedState===null&&(a=o.alternate,a!==null&&(a=a.memoizedState,a!==null&&(a=a.dehydrated,a!==null))))try{Th(a)}catch(u){Hn(o,o.return,u)}}function NC(a){switch(a.tag){case 13:case 19:var o=a.stateNode;return o===null&&(o=a.stateNode=new ST),o;case 22:return a=a.stateNode,o=a._retryCache,o===null&&(o=a._retryCache=new ST),o;default:throw Error(A(435,a.tag))}}function SE(a,o){var u=NC(a);o.forEach(function(f){var g=MC.bind(null,a,f);u.has(f)||(u.add(f),f.then(g,g))})}function Br(a,o){var u=o.deletions;if(u!==null)for(var f=0;f<u.length;f++){var g=u[f],R=a,x=o,j=x;t:for(;j!==null;){switch(j.tag){case 27:if(dc(j.type)){Dn=j.stateNode,br=!1;break t}break;case 5:Dn=j.stateNode,br=!1;break t;case 3:case 4:Dn=j.stateNode.containerInfo,br=!0;break t}j=j.return}if(Dn===null)throw Error(A(160));Zu(R,x,g),Dn=null,br=!1,R=g.alternate,R!==null&&(R.return=null),g.return=null}if(o.subtreeFlags&13878)for(o=o.child;o!==null;)yT(o,a),o=o.sibling}var Ka=null;function yT(a,o){var u=a.alternate,f=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:Br(o,a),aa(a),f&4&&(nc(3,a,a.return),_d(3,a),nc(5,a,a.return));break;case 1:Br(o,a),aa(a),f&512&&(pi||u===null||va(u,u.return)),f&64&&Ss&&(a=a.updateQueue,a!==null&&(f=a.callbacks,f!==null&&(u=a.shared.hiddenCallbacks,a.shared.hiddenCallbacks=u===null?f:u.concat(f))));break;case 26:var g=Ka;if(Br(o,a),aa(a),f&512&&(pi||u===null||va(u,u.return)),f&4){var R=u!==null?u.memoizedState:null;if(f=a.memoizedState,u===null)if(f===null)if(a.stateNode===null){t:{f=a.type,u=a.memoizedProps,g=g.ownerDocument||g;e:switch(f){case"title":R=g.getElementsByTagName("title")[0],(!R||R[Vl]||R[fr]||R.namespaceURI==="http://www.w3.org/2000/svg"||R.hasAttribute("itemprop"))&&(R=g.createElement(f),g.head.insertBefore(R,g.querySelector("head > title"))),er(R,f,u),R[fr]=a,Vi(R),f=R;break t;case"link":var x=$E("link","href",g).get(f+(u.href||""));if(x){for(var j=0;j<x.length;j++)if(R=x[j],R.getAttribute("href")===(u.href==null||u.href===""?null:u.href)&&R.getAttribute("rel")===(u.rel==null?null:u.rel)&&R.getAttribute("title")===(u.title==null?null:u.title)&&R.getAttribute("crossorigin")===(u.crossOrigin==null?null:u.crossOrigin)){x.splice(j,1);break e}}R=g.createElement(f),er(R,f,u),g.head.appendChild(R);break;case"meta":if(x=$E("meta","content",g).get(f+(u.content||""))){for(j=0;j<x.length;j++)if(R=x[j],R.getAttribute("content")===(u.content==null?null:""+u.content)&&R.getAttribute("name")===(u.name==null?null:u.name)&&R.getAttribute("property")===(u.property==null?null:u.property)&&R.getAttribute("http-equiv")===(u.httpEquiv==null?null:u.httpEquiv)&&R.getAttribute("charset")===(u.charSet==null?null:u.charSet)){x.splice(j,1);break e}}R=g.createElement(f),er(R,f,u),g.head.appendChild(R);break;default:throw Error(A(468,f))}R[fr]=a,Vi(R),f=R}a.stateNode=f}else zT(g,a.type,a.stateNode);else a.stateNode=Pf(g,f,a.memoizedProps);else R!==f?(R===null?u.stateNode!==null&&(u=u.stateNode,u.parentNode.removeChild(u)):R.count--,f===null?zT(g,a.type,a.stateNode):Pf(g,f,a.memoizedProps)):f===null&&a.stateNode!==null&&sf(a,a.memoizedProps,u.memoizedProps)}break;case 27:Br(o,a),aa(a),f&512&&(pi||u===null||va(u,u.return)),u!==null&&f&4&&sf(a,a.memoizedProps,u.memoizedProps);break;case 5:if(Br(o,a),aa(a),f&512&&(pi||u===null||va(u,u.return)),a.flags&32){g=a.stateNode;try{Bo(g,"")}catch(gt){Hn(a,a.return,gt)}}f&4&&a.stateNode!=null&&(g=a.memoizedProps,sf(a,g,u!==null?u.memoizedProps:g)),f&1024&&(Qu=!0);break;case 6:if(Br(o,a),aa(a),f&4){if(a.stateNode===null)throw Error(A(162));f=a.memoizedProps,u=a.stateNode;try{u.nodeValue=f}catch(gt){Hn(a,a.return,gt)}}break;case 3:if(Lf=null,g=Ka,Ka=Nf(o.containerInfo),Br(o,a),Ka=g,aa(a),f&4&&u!==null&&u.memoizedState.isDehydrated)try{Th(o.containerInfo)}catch(gt){Hn(a,a.return,gt)}Qu&&(Qu=!1,lf(a));break;case 4:f=Ka,Ka=Nf(a.stateNode.containerInfo),Br(o,a),aa(a),Ka=f;break;case 12:Br(o,a),aa(a);break;case 13:Br(o,a),aa(a),a.child.flags&8192&&a.memoizedState!==null!=(u!==null&&u.memoizedState!==null)&&(ih=sr()),f&4&&(f=a.updateQueue,f!==null&&(a.updateQueue=null,SE(a,f)));break;case 22:g=a.memoizedState!==null;var X=u!==null&&u.memoizedState!==null,ct=Ss,Rt=pi;if(Ss=ct||g,pi=Rt||X,Br(o,a),pi=Rt,Ss=ct,aa(a),f&8192)t:for(o=a.stateNode,o._visibility=g?o._visibility&-2:o._visibility|1,g&&(u===null||X||Ss||pi||ol(a)),u=null,o=a;;){if(o.tag===5||o.tag===26){if(u===null){X=u=o;try{if(R=X.stateNode,g)x=R.style,typeof x.setProperty=="function"?x.setProperty("display","none","important"):x.display="none";else{j=X.stateNode;var Nt=X.memoizedProps.style,_t=Nt!=null&&Nt.hasOwnProperty("display")?Nt.display:null;j.style.display=_t==null||typeof _t=="boolean"?"":(""+_t).trim()}}catch(gt){Hn(X,X.return,gt)}}}else if(o.tag===6){if(u===null){X=o;try{X.stateNode.nodeValue=g?"":X.memoizedProps}catch(gt){Hn(X,X.return,gt)}}}else if((o.tag!==22&&o.tag!==23||o.memoizedState===null||o===a)&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===a)break t;for(;o.sibling===null;){if(o.return===null||o.return===a)break t;u===o&&(u=null),o=o.return}u===o&&(u=null),o.sibling.return=o.return,o=o.sibling}f&4&&(f=a.updateQueue,f!==null&&(u=f.retryQueue,u!==null&&(f.retryQueue=null,SE(a,u))));break;case 19:Br(o,a),aa(a),f&4&&(f=a.updateQueue,f!==null&&(a.updateQueue=null,SE(a,f)));break;case 30:break;case 21:break;default:Br(o,a),aa(a)}}function aa(a){var o=a.flags;if(o&2){try{for(var u,f=a.return;f!==null;){if(gT(f)){u=f;break}f=f.return}if(u==null)throw Error(A(160));switch(u.tag){case 27:var g=u.stateNode,R=gE(a);cf(a,R,g);break;case 5:var x=u.stateNode;u.flags&32&&(Bo(x,""),u.flags&=-33);var j=gE(a);cf(a,j,x);break;case 3:case 4:var X=u.stateNode.containerInfo,ct=gE(a);of(a,ct,X);break;default:throw Error(A(161))}}catch(Rt){Hn(a,a.return,Rt)}a.flags&=-3}o&4096&&(a.flags&=-4097)}function lf(a){if(a.subtreeFlags&1024)for(a=a.child;a!==null;){var o=a;lf(o),o.tag===5&&o.flags&1024&&o.stateNode.reset(),a=a.sibling}}function Cr(a,o){if(o.subtreeFlags&8772)for(o=o.child;o!==null;)vE(a,o.alternate,o),o=o.sibling}function ol(a){for(a=a.child;a!==null;){var o=a;switch(o.tag){case 0:case 11:case 14:case 15:nc(4,o,o.return),ol(o);break;case 1:va(o,o.return);var u=o.stateNode;typeof u.componentWillUnmount=="function"&&af(o,o.return,u),ol(o);break;case 27:uh(o.stateNode);case 26:case 5:va(o,o.return),ol(o);break;case 22:o.memoizedState===null&&ol(o);break;case 30:ol(o);break;default:ol(o)}a=a.sibling}}function Fr(a,o,u){for(u=u&&(o.subtreeFlags&8772)!==0,o=o.child;o!==null;){var f=o.alternate,g=a,R=o,x=R.flags;switch(R.tag){case 0:case 11:case 15:Fr(g,R,u),_d(4,R);break;case 1:if(Fr(g,R,u),f=R,g=f.stateNode,typeof g.componentDidMount=="function")try{g.componentDidMount()}catch(ct){Hn(f,f.return,ct)}if(f=R,g=f.updateQueue,g!==null){var j=f.stateNode;try{var X=g.shared.hiddenCallbacks;if(X!==null)for(g.shared.hiddenCallbacks=null,g=0;g<X.length;g++)F_(X[g],j)}catch(ct){Hn(f,f.return,ct)}}u&&x&64&&_T(R),Xu(R,R.return);break;case 27:vT(R);case 26:case 5:Fr(g,R,u),u&&f===null&&x&4&&ET(R),Xu(R,R.return);break;case 12:Fr(g,R,u);break;case 13:Fr(g,R,u),u&&x&4&&TT(g,R);break;case 22:R.memoizedState===null&&Fr(g,R,u),Xu(R,R.return);break;case 30:break;default:Fr(g,R,u)}o=o.sibling}}function df(a,o){var u=null;a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(u=a.memoizedState.cachePool.pool),a=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(a=o.memoizedState.cachePool.pool),a!==u&&(a!=null&&a.refCount++,u!=null&&Au(u))}function Ar(a,o){a=null,o.alternate!==null&&(a=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==a&&(o.refCount++,a!=null&&Au(a))}function Ts(a,o,u,f){if(o.subtreeFlags&10256)for(o=o.child;o!==null;)RT(a,o,u,f),o=o.sibling}function RT(a,o,u,f){var g=o.flags;switch(o.tag){case 0:case 11:case 15:Ts(a,o,u,f),g&2048&&_d(9,o);break;case 1:Ts(a,o,u,f);break;case 3:Ts(a,o,u,f),g&2048&&(a=null,o.alternate!==null&&(a=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==a&&(o.refCount++,a!=null&&Au(a)));break;case 12:if(g&2048){Ts(a,o,u,f),a=o.stateNode;try{var R=o.memoizedProps,x=R.id,j=R.onPostCommit;typeof j=="function"&&j(x,o.alternate===null?"mount":"update",a.passiveEffectDuration,-0)}catch(X){Hn(o,o.return,X)}}else Ts(a,o,u,f);break;case 13:Ts(a,o,u,f);break;case 23:break;case 22:R=o.stateNode,x=o.alternate,o.memoizedState!==null?R._visibility&2?Ts(a,o,u,f):$u(a,o):R._visibility&2?Ts(a,o,u,f):(R._visibility|=2,cl(a,o,u,f,(o.subtreeFlags&10256)!==0)),g&2048&&df(x,o);break;case 24:Ts(a,o,u,f),g&2048&&Ar(o.alternate,o);break;default:Ts(a,o,u,f)}}function cl(a,o,u,f,g){for(g=g&&(o.subtreeFlags&10256)!==0,o=o.child;o!==null;){var R=a,x=o,j=u,X=f,ct=x.flags;switch(x.tag){case 0:case 11:case 15:cl(R,x,j,X,g),_d(8,x);break;case 23:break;case 22:var Rt=x.stateNode;x.memoizedState!==null?Rt._visibility&2?cl(R,x,j,X,g):$u(R,x):(Rt._visibility|=2,cl(R,x,j,X,g)),g&&ct&2048&&df(x.alternate,x);break;case 24:cl(R,x,j,X,g),g&&ct&2048&&Ar(x.alternate,x);break;default:cl(R,x,j,X,g)}o=o.sibling}}function $u(a,o){if(o.subtreeFlags&10256)for(o=o.child;o!==null;){var u=a,f=o,g=f.flags;switch(f.tag){case 22:$u(u,f),g&2048&&df(f.alternate,f);break;case 24:$u(u,f),g&2048&&Ar(f.alternate,f);break;default:$u(u,f)}o=o.sibling}}var gd=8192;function ll(a){if(a.subtreeFlags&gd)for(a=a.child;a!==null;)bT(a),a=a.sibling}function bT(a){switch(a.tag){case 26:ll(a),a.flags&gd&&a.memoizedState!==null&&i0(Ka,a.memoizedState,a.memoizedProps);break;case 5:ll(a);break;case 3:case 4:var o=Ka;Ka=Nf(a.stateNode.containerInfo),ll(a),Ka=o;break;case 22:a.memoizedState===null&&(o=a.alternate,o!==null&&o.memoizedState!==null?(o=gd,gd=16777216,ll(a),gd=o):ll(a));break;default:ll(a)}}function TE(a){var o=a.alternate;if(o!==null&&(a=o.child,a!==null)){o.child=null;do o=a.sibling,a.sibling=null,a=o;while(a!==null)}}function th(a){var o=a.deletions;if((a.flags&16)!==0){if(o!==null)for(var u=0;u<o.length;u++){var f=o[u];tr=f,hf(f,a)}TE(a)}if(a.subtreeFlags&10256)for(a=a.child;a!==null;)CT(a),a=a.sibling}function CT(a){switch(a.tag){case 0:case 11:case 15:th(a),a.flags&2048&&nc(9,a,a.return);break;case 3:th(a);break;case 12:th(a);break;case 22:var o=a.stateNode;a.memoizedState!==null&&o._visibility&2&&(a.return===null||a.return.tag!==13)?(o._visibility&=-3,uf(a)):th(a);break;default:th(a)}}function uf(a){var o=a.deletions;if((a.flags&16)!==0){if(o!==null)for(var u=0;u<o.length;u++){var f=o[u];tr=f,hf(f,a)}TE(a)}for(a=a.child;a!==null;){switch(o=a,o.tag){case 0:case 11:case 15:nc(8,o,o.return),uf(o);break;case 22:u=o.stateNode,u._visibility&2&&(u._visibility&=-3,uf(o));break;default:uf(o)}a=a.sibling}}function hf(a,o){for(;tr!==null;){var u=tr;switch(u.tag){case 0:case 11:case 15:nc(8,u,o);break;case 23:case 22:if(u.memoizedState!==null&&u.memoizedState.cachePool!==null){var f=u.memoizedState.cachePool.pool;f!=null&&f.refCount++}break;case 24:Au(u.memoizedState.cache)}if(f=u.child,f!==null)f.return=u,tr=f;else t:for(u=a;tr!==null;){f=tr;var g=f.sibling,R=f.return;if(Ed(f),f===u){tr=null;break t}if(g!==null){g.return=R,tr=g;break t}tr=R}}}var yE={getCacheForType:function(a){var o=Bi(Ii),u=o.data.get(a);return u===void 0&&(u=a(),o.data.set(a,u)),u}},DC=typeof WeakMap=="function"?WeakMap:Map,bn=0,Yn=null,tn=null,un=0,Cn=0,cr=null,uo=!1,ic=!1,eh=!1,ys=0,li=0,Ya=0,rc=0,RE=0,Sa=0,dl=0,vd=null,Hi=null,nh=!1,ih=0,Sd=1/0,rh=null,ho=null,lr=0,ac=null,Xa=null,Td=0,pf=0,ah=null,AT=null,sh=0,bE=null;function sa(){if((bn&2)!==0&&un!==0)return un&-un;if(St.T!==null){var a=ed;return a!==0?a:Ad()}return kv()}function ff(){Sa===0&&(Sa=(un&536870912)===0||Rn?hu():536870912);var a=Fi.current;return a!==null&&(a.flags|=32),Sa}function Gr(a,o,u){(a===Yn&&(Cn===2||Cn===9)||a.cancelPendingCommit!==null)&&(hl(a,0),Rs(a,un,Sa,!1)),pu(a,u),((bn&2)===0||a!==Yn)&&(a===Yn&&((bn&2)===0&&(rc|=u),li===4&&Rs(a,un,Sa,!1)),Ta(a))}function CE(a,o,u){if((bn&6)!==0)throw Error(A(327));var f=!u&&(o&124)===0&&(o&a.expiredLanes)===0||Zs(a,o),g=f?kC(a,o):wE(a,o,!0),R=f;do{if(g===0){ic&&!f&&Rs(a,o,0,!1);break}else{if(u=a.current.alternate,R&&!mf(u)){g=wE(a,o,!1),R=!1;continue}if(g===2){if(R=o,a.errorRecoveryDisabledLanes&R)var x=0;else x=a.pendingLanes&-536870913,x=x!==0?x:x&536870912?536870912:0;if(x!==0){o=x;t:{var j=a;g=vd;var X=j.current.memoizedState.isDehydrated;if(X&&(hl(j,x).flags|=256),x=wE(j,x,!1),x!==2){if(eh&&!X){j.errorRecoveryDisabledLanes|=R,rc|=R,g=4;break t}R=Hi,Hi=g,R!==null&&(Hi===null?Hi=R:Hi.push.apply(Hi,R))}g=x}if(R=!1,g!==2)continue}}if(g===1){hl(a,0),Rs(a,o,0,!0);break}t:{switch(f=a,R=g,R){case 0:case 1:throw Error(A(345));case 4:if((o&4194048)!==o)break;case 6:Rs(f,o,Sa,!uo);break t;case 2:Hi=null;break;case 3:case 5:break;default:throw Error(A(329))}if((o&62914560)===o&&(g=ih+300-sr(),10<g)){if(Rs(f,o,Sa,!uo),Uo(f,0,!0)!==0)break t;f.timeoutHandle=xT(AE.bind(null,f,u,Hi,rh,nh,o,Sa,rc,dl,uo,R,2,-0,0),g);break t}AE(f,u,Hi,rh,nh,o,Sa,rc,dl,uo,R,0,-0,0)}}break}while(!0);Ta(a)}function AE(a,o,u,f,g,R,x,j,X,ct,Rt,Nt,_t,gt){if(a.timeoutHandle=-1,Nt=o.subtreeFlags,(Nt&8192||(Nt&16785408)===16785408)&&(ph={stylesheets:null,count:0,unsuspend:n0},bT(o),Nt=KT(),Nt!==null)){a.cancelPendingCommit=Nt(IT.bind(null,a,o,R,u,f,g,x,j,X,Rt,1,_t,gt)),Rs(a,R,x,!ct);return}IT(a,o,R,u,f,g,x,j,X)}function mf(a){for(var o=a;;){var u=o.tag;if((u===0||u===11||u===15)&&o.flags&16384&&(u=o.updateQueue,u!==null&&(u=u.stores,u!==null)))for(var f=0;f<u.length;f++){var g=u[f],R=g.getSnapshot;g=g.value;try{if(!ta(R(),g))return!1}catch{return!1}}if(u=o.child,o.subtreeFlags&16384&&u!==null)u.return=o,o=u;else{if(o===a)break;for(;o.sibling===null;){if(o.return===null||o.return===a)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function Rs(a,o,u,f){o&=~RE,o&=~rc,a.suspendedLanes|=o,a.pingedLanes&=~o,f&&(a.warmLanes|=o),f=a.expirationTimes;for(var g=o;0<g;){var R=31-gi(g),x=1<<R;f[R]=-1,g&=~x}u!==0&&Ul(a,u,o)}function ul(){return(bn&6)===0?(oh(0),!1):!0}function yd(){if(tn!==null){if(Cn===0)var a=tn.return;else a=tn,so=Xc=null,z_(a),rl=null,Wa=0,a=tn;for(;a!==null;)mT(a.alternate,a),a=a.return;tn=null}}function hl(a,o){var u=a.timeoutHandle;u!==-1&&(a.timeoutHandle=-1,GC(u)),u=a.cancelPendingCommit,u!==null&&(a.cancelPendingCommit=null,u()),yd(),Yn=a,tn=u=ro(a.current,null),un=o,Cn=0,cr=null,uo=!1,ic=Zs(a,o),eh=!1,dl=Sa=RE=rc=Ya=li=0,Hi=vd=null,nh=!1,(o&8)!==0&&(o|=o&32);var f=a.entangledLanes;if(f!==0)for(a=a.entanglements,f&=o;0<f;){var g=31-gi(f),R=1<<g;o|=a[g],f&=~R}return ys=o,Hc(),u}function pl(a,o){ze=null,St.H=ra,o===Jc||o===Mp?(o=OS(),Cn=3):o===AS?(o=OS(),Cn=4):Cn=o===oT?8:o!==null&&typeof o=="object"&&typeof o.then=="function"?6:1,cr=o,tn===null&&(li=1,$p(a,ea(o,a.current)))}function sc(){var a=St.H;return St.H=ra,a===null?ra:a}function wT(){var a=St.A;return St.A=yE,a}function fl(){li=4,uo||(un&4194048)!==un&&Fi.current!==null||(ic=!0),(Ya&134217727)===0&&(rc&134217727)===0||Yn===null||Rs(Yn,un,Sa,!1)}function wE(a,o,u){var f=bn;bn|=2;var g=sc(),R=wT();(Yn!==a||un!==o)&&(rh=null,hl(a,o)),o=!1;var x=li;t:do try{if(Cn!==0&&tn!==null){var j=tn,X=cr;switch(Cn){case 8:yd(),x=6;break t;case 3:case 2:case 9:case 6:Fi.current===null&&(o=!0);var ct=Cn;if(Cn=0,cr=null,ml(a,j,X,ct),u&&ic){x=0;break t}break;default:ct=Cn,Cn=0,cr=null,ml(a,j,X,ct)}}PC(),x=li;break}catch(Rt){pl(a,Rt)}while(!0);return o&&a.shellSuspendCounter++,so=Xc=null,bn=f,St.H=g,St.A=R,tn===null&&(Yn=null,un=0,Hc()),x}function PC(){for(;tn!==null;)IE(tn)}function kC(a,o){var u=bn;bn|=2;var f=sc(),g=wT();Yn!==a||un!==o?(rh=null,Sd=sr()+500,hl(a,o)):ic=Zs(a,o);t:do try{if(Cn!==0&&tn!==null){o=tn;var R=cr;e:switch(Cn){case 1:Cn=0,cr=null,ml(a,o,R,1);break;case 2:case 9:if(wS(R)){Cn=0,cr=null,_f(o);break}o=function(){Cn!==2&&Cn!==9||Yn!==a||(Cn=7),Ta(a)},R.then(o,o);break t;case 3:Cn=7;break t;case 4:Cn=5;break t;case 7:wS(R)?(Cn=0,cr=null,_f(o)):(Cn=0,cr=null,ml(a,o,R,7));break;case 5:var x=null;switch(tn.tag){case 26:x=tn.memoizedState;case 5:case 27:var j=tn;if(!x||qT(x)){Cn=0,cr=null;var X=j.sibling;if(X!==null)tn=X;else{var ct=j.return;ct!==null?(tn=ct,Ef(ct)):tn=null}break e}}Cn=0,cr=null,ml(a,o,R,5);break;case 6:Cn=0,cr=null,ml(a,o,R,6);break;case 8:yd(),li=6;break t;default:throw Error(A(462))}}LC();break}catch(Rt){pl(a,Rt)}while(!0);return so=Xc=null,St.H=f,St.A=g,bn=u,tn!==null?0:(Yn=null,un=0,Hc(),li)}function LC(){for(;tn!==null&&!dp();)IE(tn)}function IE(a){var o=Ku(a.alternate,a,ys);a.memoizedProps=a.pendingProps,o===null?Ef(a):tn=o}function _f(a){var o=a,u=o.alternate;switch(o.tag){case 15:case 0:o=hE(u,o,o.pendingProps,o.type,void 0,un);break;case 11:o=hE(u,o,o.pendingProps,o.type.render,o.ref,un);break;case 5:z_(o);default:mT(u,o),o=tn=Ip(o,ys),o=Ku(u,o,ys)}a.memoizedProps=a.pendingProps,o===null?Ef(a):tn=o}function ml(a,o,u,f){so=Xc=null,z_(o),rl=null,Wa=0;var g=o.return;try{if(AC(a,g,o,u,un)){li=1,$p(a,ea(u,a.current)),tn=null;return}}catch(R){if(g!==null)throw tn=g,R;li=1,$p(a,ea(u,a.current)),tn=null;return}o.flags&32768?(Rn||f===1?a=!0:ic||(un&536870912)!==0?a=!1:(uo=a=!0,(f===2||f===9||f===3||f===6)&&(f=Fi.current,f!==null&&f.tag===13&&(f.flags|=16384))),OE(o,a)):Ef(o)}function Ef(a){var o=a;do{if((o.flags&32768)!==0){OE(o,uo);return}a=o.return;var u=IC(o.alternate,o,ys);if(u!==null){tn=u;return}if(o=o.sibling,o!==null){tn=o;return}tn=o=a}while(o!==null);li===0&&(li=5)}function OE(a,o){do{var u=OC(a.alternate,a);if(u!==null){u.flags&=32767,tn=u;return}if(u=a.return,u!==null&&(u.flags|=32768,u.subtreeFlags=0,u.deletions=null),!o&&(a=a.sibling,a!==null)){tn=a;return}tn=a=u}while(a!==null);li=6,tn=null}function IT(a,o,u,f,g,R,x,j,X){a.cancelPendingCommit=null;do gf();while(lr!==0);if((bn&6)!==0)throw Error(A(327));if(o!==null){if(o===a.current)throw Error(A(177));if(R=o.lanes|o.childLanes,R|=A_,Gb(a,u,R,x,j,X),a===Yn&&(tn=Yn=null,un=0),Xa=o,ac=a,Td=u,pf=R,ah=g,AT=f,(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?(a.callbackNode=null,a.callbackPriority=0,UC(Mo,function(){return vf(),null})):(a.callbackNode=null,a.callbackPriority=0),f=(o.flags&13878)!==0,(o.subtreeFlags&13878)!==0||f){f=St.T,St.T=null,g=kt.p,kt.p=2,x=bn,bn|=4;try{Ju(a,o,u)}finally{bn=x,kt.p=g,St.T=f}}lr=1,Rd(),Qa(),NE()}}function Rd(){if(lr===1){lr=0;var a=ac,o=Xa,u=(o.flags&13878)!==0;if((o.subtreeFlags&13878)!==0||u){u=St.T,St.T=null;var f=kt.p;kt.p=2;var g=bn;bn|=4;try{yT(o,a);var R=Dd,x=no(a.containerInfo),j=R.focusedElem,X=R.selectionRange;if(x!==j&&j&&j.ownerDocument&&pS(j.ownerDocument.documentElement,j)){if(X!==null&&v_(j)){var ct=X.start,Rt=X.end;if(Rt===void 0&&(Rt=ct),"selectionStart"in j)j.selectionStart=ct,j.selectionEnd=Math.min(Rt,j.value.length);else{var Nt=j.ownerDocument||document,_t=Nt&&Nt.defaultView||window;if(_t.getSelection){var gt=_t.getSelection(),we=j.textContent.length,_e=Math.min(X.start,we),Vn=X.end===void 0?_e:Math.min(X.end,we);!gt.extend&&_e>Vn&&(x=Vn,Vn=_e,_e=x);var st=hS(j,_e),nt=hS(j,Vn);if(st&&nt&&(gt.rangeCount!==1||gt.anchorNode!==st.node||gt.anchorOffset!==st.offset||gt.focusNode!==nt.node||gt.focusOffset!==nt.offset)){var lt=Nt.createRange();lt.setStart(st.node,st.offset),gt.removeAllRanges(),_e>Vn?(gt.addRange(lt),gt.extend(nt.node,nt.offset)):(lt.setEnd(nt.node,nt.offset),gt.addRange(lt))}}}}for(Nt=[],gt=j;gt=gt.parentNode;)gt.nodeType===1&&Nt.push({element:gt,left:gt.scrollLeft,top:gt.scrollTop});for(typeof j.focus=="function"&&j.focus(),j=0;j<Nt.length;j++){var At=Nt[j];At.element.scrollLeft=At.left,At.element.scrollTop=At.top}}Mf=!!qE,Dd=qE=null}finally{bn=g,kt.p=f,St.T=u}}a.current=o,lr=2}}function Qa(){if(lr===2){lr=0;var a=ac,o=Xa,u=(o.flags&8772)!==0;if((o.subtreeFlags&8772)!==0||u){u=St.T,St.T=null;var f=kt.p;kt.p=2;var g=bn;bn|=4;try{vE(a,o.alternate,o)}finally{bn=g,kt.p=f,St.T=u}}lr=3}}function NE(){if(lr===4||lr===3){lr=0,Va();var a=ac,o=Xa,u=Td,f=AT;(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?lr=5:(lr=0,Xa=ac=null,OT(a,a.pendingLanes));var g=a.pendingLanes;if(g===0&&(ho=null),Qm(u),o=o.stateNode,We&&typeof We.onCommitFiberRoot=="function")try{We.onCommitFiberRoot(Gn,o,void 0,(o.current.flags&128)===128)}catch{}if(f!==null){o=St.T,g=kt.p,kt.p=2,St.T=null;try{for(var R=a.onRecoverableError,x=0;x<f.length;x++){var j=f[x];R(j.value,{componentStack:j.stack})}}finally{St.T=o,kt.p=g}}(Td&3)!==0&&gf(),Ta(a),g=a.pendingLanes,(u&4194090)!==0&&(g&42)!==0?a===bE?sh++:(sh=0,bE=a):sh=0,oh(0)}}function OT(a,o){(a.pooledCacheLanes&=o)===0&&(o=a.pooledCache,o!=null&&(a.pooledCache=null,Au(o)))}function gf(a){return Rd(),Qa(),NE(),vf()}function vf(){if(lr!==5)return!1;var a=ac,o=pf;pf=0;var u=Qm(Td),f=St.T,g=kt.p;try{kt.p=32>u?32:u,St.T=null,u=ah,ah=null;var R=ac,x=Td;if(lr=0,Xa=ac=null,Td=0,(bn&6)!==0)throw Error(A(331));var j=bn;if(bn|=4,CT(R.current),RT(R,R.current,x,u),bn=j,oh(0,!1),We&&typeof We.onPostCommitFiberRoot=="function")try{We.onPostCommitFiberRoot(Gn,R)}catch{}return!0}finally{kt.p=g,St.T=f,OT(a,o)}}function DE(a,o,u){o=ea(u,o),o=za(a.stateNode,o,2),a=co(a,o,2),a!==null&&(pu(a,2),Ta(a))}function Hn(a,o,u){if(a.tag===3)DE(a,a,u);else for(;o!==null;){if(o.tag===3){DE(o,a,u);break}else if(o.tag===1){var f=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof f.componentDidCatch=="function"&&(ho===null||!ho.has(f))){a=ea(u,a),u=aT(2),f=co(o,u,2),f!==null&&(sT(u,f,o,a),pu(f,2),Ta(f));break}}o=o.return}}function bd(a,o,u){var f=a.pingCache;if(f===null){f=a.pingCache=new DC;var g=new Set;f.set(o,g)}else g=f.get(o),g===void 0&&(g=new Set,f.set(o,g));g.has(u)||(eh=!0,g.add(u),a=oc.bind(null,a,o,u),o.then(a,a))}function oc(a,o,u){var f=a.pingCache;f!==null&&f.delete(o),a.pingedLanes|=a.suspendedLanes&u,a.warmLanes&=~u,Yn===a&&(un&u)===u&&(li===4||li===3&&(un&62914560)===un&&300>sr()-ih?(bn&2)===0&&hl(a,0):RE|=u,dl===un&&(dl=0)),Ta(a)}function Cd(a,o){o===0&&(o=Dv()),a=Jl(a,o),a!==null&&(pu(a,o),Ta(a))}function xC(a){var o=a.memoizedState,u=0;o!==null&&(u=o.retryLane),Cd(a,u)}function MC(a,o){var u=0;switch(a.tag){case 13:var f=a.stateNode,g=a.memoizedState;g!==null&&(u=g.retryLane);break;case 19:f=a.stateNode;break;case 22:f=a.stateNode._retryCache;break;default:throw Error(A(314))}f!==null&&f.delete(o),Cd(a,u)}function UC(a,o){return ha(a,o)}var Sf=null,cc=null,PE=!1,Tf=!1,kE=!1,lc=0;function Ta(a){a!==cc&&a.next===null&&(cc===null?Sf=cc=a:cc=cc.next=a),Tf=!0,PE||(PE=!0,DT())}function oh(a,o){if(!kE&&Tf){kE=!0;do for(var u=!1,f=Sf;f!==null;){if(a!==0){var g=f.pendingLanes;if(g===0)var R=0;else{var x=f.suspendedLanes,j=f.pingedLanes;R=(1<<31-gi(42|a)+1)-1,R&=g&~(x&~j),R=R&201326741?R&201326741|1:R?R|2:0}R!==0&&(u=!0,xE(f,R))}else R=un,R=Uo(f,f===Yn?R:0,f.cancelPendingCommit!==null||f.timeoutHandle!==-1),(R&3)===0||Zs(f,R)||(u=!0,xE(f,R));f=f.next}while(u);kE=!1}}function VC(){NT()}function NT(){Tf=PE=!1;var a=0;lc!==0&&(FC()&&(a=lc),lc=0);for(var o=sr(),u=null,f=Sf;f!==null;){var g=f.next,R=LE(f,o);R===0?(f.next=null,u===null?Sf=g:u.next=g,g===null&&(cc=u)):(u=f,(a!==0||(R&3)!==0)&&(Tf=!0)),f=g}oh(a)}function LE(a,o){for(var u=a.suspendedLanes,f=a.pingedLanes,g=a.expirationTimes,R=a.pendingLanes&-62914561;0<R;){var x=31-gi(R),j=1<<x,X=g[x];X===-1?((j&u)===0||(j&f)!==0)&&(g[x]=hs(j,o)):X<=o&&(a.expiredLanes|=j),R&=~j}if(o=Yn,u=un,u=Uo(a,a===o?u:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),f=a.callbackNode,u===0||a===o&&(Cn===2||Cn===9)||a.cancelPendingCommit!==null)return f!==null&&f!==null&&Ll(f),a.callbackNode=null,a.callbackPriority=0;if((u&3)===0||Zs(a,u)){if(o=u&-u,o===a.callbackPriority)return o;switch(f!==null&&Ll(f),Qm(u)){case 2:case 8:u=Xs;break;case 32:u=Mo;break;case 268435456:u=uu;break;default:u=Mo}return f=yf.bind(null,a),u=ha(u,f),a.callbackPriority=o,a.callbackNode=u,o}return f!==null&&f!==null&&Ll(f),a.callbackPriority=2,a.callbackNode=null,2}function yf(a,o){if(lr!==0&&lr!==5)return a.callbackNode=null,a.callbackPriority=0,null;var u=a.callbackNode;if(gf()&&a.callbackNode!==u)return null;var f=un;return f=Uo(a,a===Yn?f:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),f===0?null:(CE(a,f,o),LE(a,sr()),a.callbackNode!=null&&a.callbackNode===u?yf.bind(null,a):null)}function xE(a,o){if(gf())return null;CE(a,o,!0)}function DT(){HC(function(){(bn&6)!==0?ha(Ui,VC):NT()})}function Ad(){return lc===0&&(lc=hu()),lc}function ME(a){return a==null||typeof a=="symbol"||typeof a=="boolean"?null:typeof a=="function"?a:vp(""+a)}function PT(a,o){var u=o.ownerDocument.createElement("input");return u.name=o.name,u.value=o.value,a.id&&u.setAttribute("form",a.id),o.parentNode.insertBefore(u,o),a=new FormData(a),u.parentNode.removeChild(u),a}function UE(a,o,u,f,g){if(o==="submit"&&u&&u.stateNode===g){var R=ME((g[Mr]||null).action),x=f.submitter;x&&(o=(o=x[Mr]||null)?ME(o.formAction):x.getAttribute("formAction"),o!==null&&(R=o,x=null));var j=new Ba("action","action",null,f,g);a.push({event:j,listeners:[{instance:null,listener:function(){if(f.defaultPrevented){if(lc!==0){var X=x?PT(g,x):new FormData(g);dd(u,{pending:!0,data:X,method:g.method,action:R},null,X)}}else typeof R=="function"&&(j.preventDefault(),X=x?PT(g,x):new FormData(g),dd(u,{pending:!0,data:X,method:g.method,action:R},R,X))},currentTarget:g}]})}}for(var VE=0;VE<b_.length;VE++){var jE=b_[VE],ch=jE.toLowerCase(),BE=jE[0].toUpperCase()+jE.slice(1);Fa(ch,"on"+BE)}Fa(_S,"onAnimationEnd"),Fa(ES,"onAnimationIteration"),Fa(wp,"onAnimationStart"),Fa("dblclick","onDoubleClick"),Fa("focusin","onFocus"),Fa("focusout","onBlur"),Fa(R_,"onTransitionRun"),Fa(_C,"onTransitionStart"),Fa(mt,"onTransitionCancel"),Fa(gS,"onTransitionEnd"),Fl("onMouseEnter",["mouseout","mouseover"]),Fl("onMouseLeave",["mouseout","mouseover"]),Fl("onPointerEnter",["pointerout","pointerover"]),Fl("onPointerLeave",["pointerout","pointerover"]),fa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),fa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),fa("onBeforeInput",["compositionend","keypress","textInput","paste"]),fa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),fa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),fa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var wd="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),FE=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(wd));function Rf(a,o){o=(o&4)!==0;for(var u=0;u<a.length;u++){var f=a[u],g=f.event;f=f.listeners;t:{var R=void 0;if(o)for(var x=f.length-1;0<=x;x--){var j=f[x],X=j.instance,ct=j.currentTarget;if(j=j.listener,X!==R&&g.isPropagationStopped())break t;R=j,g.currentTarget=ct;try{R(g)}catch(Rt){Zp(Rt)}g.currentTarget=null,R=X}else for(x=0;x<f.length;x++){if(j=f[x],X=j.instance,ct=j.currentTarget,j=j.listener,X!==R&&g.isPropagationStopped())break t;R=j,g.currentTarget=ct;try{R(g)}catch(Rt){Zp(Rt)}g.currentTarget=null,R=X}}}}function Xe(a,o){var u=o[up];u===void 0&&(u=o[up]=new Set);var f=a+"__bubble";u.has(f)||(HE(o,a,2,!1),u.add(f))}function GE(a,o,u){var f=0;o&&(f|=4),HE(u,a,f,o)}var bf="_reactListening"+Math.random().toString(36).slice(2);function Cf(a){if(!a[bf]){a[bf]=!0,pp.forEach(function(u){u!=="selectionchange"&&(FE.has(u)||GE(u,!1,a),GE(u,!0,a))});var o=a.nodeType===9?a:a.ownerDocument;o===null||o[bf]||(o[bf]=!0,GE("selectionchange",!1,o))}}function HE(a,o,u,f){switch(ZT(o)){case 2:var g=a0;break;case 8:g=s0;break;default:g=Uf}u=g.bind(null,o,u,a),g=void 0,!s_||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(g=!0),f?g!==void 0?a.addEventListener(o,u,{capture:!0,passive:g}):a.addEventListener(o,u,!0):g!==void 0?a.addEventListener(o,u,{passive:g}):a.addEventListener(o,u,!1)}function Af(a,o,u,f,g){var R=f;if((o&1)===0&&(o&2)===0&&f!==null)t:for(;;){if(f===null)return;var x=f.tag;if(x===3||x===4){var j=f.stateNode.containerInfo;if(j===g)break;if(x===4)for(x=f.return;x!==null;){var X=x.tag;if((X===3||X===4)&&x.stateNode.containerInfo===g)return;x=x.return}for(;j!==null;){if(x=jl(j),x===null)return;if(X=x.tag,X===5||X===6||X===26||X===27){f=R=x;continue t}j=j.parentNode}}f=f.return}Yv(function(){var ct=R,Rt=r_(u),Nt=[];t:{var _t=vS.get(a);if(_t!==void 0){var gt=Ba,we=a;switch(a){case"keypress":if(Tp(u)===0)break t;case"keydown":case"keyup":gt=eC;break;case"focusin":we="focus",gt=Rp;break;case"focusout":we="blur",gt=Rp;break;case"beforeblur":case"afterblur":gt=Rp;break;case"click":if(u.button===2)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":gt=Zv;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":gt=Xb;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":gt=iC;break;case _S:case ES:case wp:gt=d_;break;case gS:gt=tS;break;case"scroll":case"scrollend":gt=Jv;break;case"wheel":gt=Le;break;case"copy":case"cut":case"paste":gt=u_;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":gt=$v;break;case"toggle":case"beforetoggle":gt=sC}var _e=(o&4)!==0,Vn=!_e&&(a==="scroll"||a==="scrollend"),st=_e?_t!==null?_t+"Capture":null:_t;_e=[];for(var nt=ct,lt;nt!==null;){var At=nt;if(lt=At.stateNode,At=At.tag,At!==5&&At!==26&&At!==27||lt===null||st===null||(At=zl(nt,st),At!=null&&_e.push(Id(nt,At,lt))),Vn)break;nt=nt.return}0<_e.length&&(_t=new gt(_t,we,null,u,Rt),Nt.push({event:_t,listeners:_e}))}}if((o&7)===0){t:{if(_t=a==="mouseover"||a==="pointerover",gt=a==="mouseout"||a==="pointerout",_t&&u!==i_&&(we=u.relatedTarget||u.fromElement)&&(jl(we)||we[$s]))break t;if((gt||_t)&&(_t=Rt.window===Rt?Rt:(_t=Rt.ownerDocument)?_t.defaultView||_t.parentWindow:window,gt?(we=u.relatedTarget||u.toElement,gt=ct,we=we?jl(we):null,we!==null&&(Vn=B(we),_e=we.tag,we!==Vn||_e!==5&&_e!==27&&_e!==6)&&(we=null)):(gt=null,we=ct),gt!==we)){if(_e=Zv,At="onMouseLeave",st="onMouseEnter",nt="mouse",(a==="pointerout"||a==="pointerover")&&(_e=$v,At="onPointerLeave",st="onPointerEnter",nt="pointer"),Vn=gt==null?_t:fu(gt),lt=we==null?_t:fu(we),_t=new _e(At,nt+"leave",gt,u,Rt),_t.target=Vn,_t.relatedTarget=lt,At=null,jl(Rt)===ct&&(_e=new _e(st,nt+"enter",we,u,Rt),_e.target=lt,_e.relatedTarget=Vn,At=_e),Vn=At,gt&&we)e:{for(_e=gt,st=we,nt=0,lt=_e;lt;lt=Od(lt))nt++;for(lt=0,At=st;At;At=Od(At))lt++;for(;0<nt-lt;)_e=Od(_e),nt--;for(;0<lt-nt;)st=Od(st),lt--;for(;nt--;){if(_e===st||st!==null&&_e===st.alternate)break e;_e=Od(_e),st=Od(st)}_e=null}else _e=null;gt!==null&&WE(Nt,_t,gt,_e,!1),we!==null&&Vn!==null&&WE(Nt,Vn,we,_e,!0)}}t:{if(_t=ct?fu(ct):window,gt=_t.nodeName&&_t.nodeName.toLowerCase(),gt==="select"||gt==="input"&&_t.type==="file")var Zt=oS;else if(aS(_t))if($r)Zt=g_;else{Zt=pC;var en=hC}else gt=_t.nodeName,!gt||gt.toLowerCase()!=="input"||_t.type!=="checkbox"&&_t.type!=="radio"?ct&&mu(ct.elementType)&&(Zt=oS):Zt=dS;if(Zt&&(Zt=Zt(a,ct))){sS(Nt,Zt,u,Rt);break t}en&&en(a,_t,ct),a==="focusout"&&ct&&_t.type==="number"&&ct.memoizedProps.value!=null&&n_(_t,"number",_t.value)}switch(en=ct?fu(ct):window,a){case"focusin":(aS(en)||en.contentEditable==="true")&&(ji=en,S_=ct,Su=null);break;case"focusout":Su=S_=ji=null;break;case"mousedown":T_=!0;break;case"contextmenu":case"mouseup":case"dragend":T_=!1,fS(Nt,u,Rt);break;case"selectionchange":if(mC)break;case"keydown":case"keyup":fS(Nt,u,Rt)}var ce;if(f_)t:{switch(a){case"compositionstart":var ye="onCompositionStart";break t;case"compositionend":ye="onCompositionEnd";break t;case"compositionupdate":ye="onCompositionUpdate";break t}ye=void 0}else Fc?iS(a,u)&&(ye="onCompositionEnd"):a==="keydown"&&u.keyCode===229&&(ye="onCompositionStart");ye&&(eS&&u.locale!=="ko"&&(Fc||ye!=="onCompositionStart"?ye==="onCompositionEnd"&&Fc&&(ce=Xv()):(_a=Rt,o_="value"in _a?_a.value:_a.textContent,Fc=!0)),en=lh(ct,ye),0<en.length&&(ye=new bp(ye,a,null,u,Rt),Nt.push({event:ye,listeners:en}),ce?ye.data=ce:(ce=rS(u),ce!==null&&(ye.data=ce)))),(ce=cC?lC(a,u):Fo(a,u))&&(ye=lh(ct,"onBeforeInput"),0<ye.length&&(en=new bp("onBeforeInput","beforeinput",null,u,Rt),Nt.push({event:en,listeners:ye}),en.data=ce)),UE(Nt,a,ct,u,Rt)}Rf(Nt,o)})}function Id(a,o,u){return{instance:a,listener:o,currentTarget:u}}function lh(a,o){for(var u=o+"Capture",f=[];a!==null;){var g=a,R=g.stateNode;if(g=g.tag,g!==5&&g!==26&&g!==27||R===null||(g=zl(a,u),g!=null&&f.unshift(Id(a,g,R)),g=zl(a,o),g!=null&&f.push(Id(a,g,R))),a.tag===3)return f;a=a.return}return[]}function Od(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5&&a.tag!==27);return a||null}function WE(a,o,u,f,g){for(var R=o._reactName,x=[];u!==null&&u!==f;){var j=u,X=j.alternate,ct=j.stateNode;if(j=j.tag,X!==null&&X===f)break;j!==5&&j!==26&&j!==27||ct===null||(X=ct,g?(ct=zl(u,R),ct!=null&&x.unshift(Id(u,ct,X))):g||(ct=zl(u,R),ct!=null&&x.push(Id(u,ct,X)))),u=u.return}x.length!==0&&a.push({event:o,listeners:x})}var jC=/\r\n?/g,Nd=/\u0000|\uFFFD/g;function _l(a){return(typeof a=="string"?a:""+a).replace(jC,`
`).replace(Nd,"")}function wf(a,o){return o=_l(o),_l(a)===o}function dh(){}function Pn(a,o,u,f,g,R){switch(u){case"children":typeof f=="string"?o==="body"||o==="textarea"&&f===""||Bo(a,f):(typeof f=="number"||typeof f=="bigint")&&o!=="body"&&Bo(a,""+f);break;case"className":fp(a,"class",f);break;case"tabIndex":fp(a,"tabindex",f);break;case"dir":case"role":case"viewBox":case"width":case"height":fp(a,u,f);break;case"style":zv(a,f,R);break;case"data":if(o!=="object"){fp(a,"data",f);break}case"src":case"href":if(f===""&&(o!=="a"||u!=="href")){a.removeAttribute(u);break}if(f==null||typeof f=="function"||typeof f=="symbol"||typeof f=="boolean"){a.removeAttribute(u);break}f=vp(""+f),a.setAttribute(u,f);break;case"action":case"formAction":if(typeof f=="function"){a.setAttribute(u,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof R=="function"&&(u==="formAction"?(o!=="input"&&Pn(a,o,"name",g.name,g,null),Pn(a,o,"formEncType",g.formEncType,g,null),Pn(a,o,"formMethod",g.formMethod,g,null),Pn(a,o,"formTarget",g.formTarget,g,null)):(Pn(a,o,"encType",g.encType,g,null),Pn(a,o,"method",g.method,g,null),Pn(a,o,"target",g.target,g,null)));if(f==null||typeof f=="symbol"||typeof f=="boolean"){a.removeAttribute(u);break}f=vp(""+f),a.setAttribute(u,f);break;case"onClick":f!=null&&(a.onclick=dh);break;case"onScroll":f!=null&&Xe("scroll",a);break;case"onScrollEnd":f!=null&&Xe("scrollend",a);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(A(61));if(u=f.__html,u!=null){if(g.children!=null)throw Error(A(60));a.innerHTML=u}}break;case"multiple":a.multiple=f&&typeof f!="function"&&typeof f!="symbol";break;case"muted":a.muted=f&&typeof f!="function"&&typeof f!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(f==null||typeof f=="function"||typeof f=="boolean"||typeof f=="symbol"){a.removeAttribute("xlink:href");break}u=vp(""+f),a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",u);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":f!=null&&typeof f!="function"&&typeof f!="symbol"?a.setAttribute(u,""+f):a.removeAttribute(u);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":f&&typeof f!="function"&&typeof f!="symbol"?a.setAttribute(u,""):a.removeAttribute(u);break;case"capture":case"download":f===!0?a.setAttribute(u,""):f!==!1&&f!=null&&typeof f!="function"&&typeof f!="symbol"?a.setAttribute(u,f):a.removeAttribute(u);break;case"cols":case"rows":case"size":case"span":f!=null&&typeof f!="function"&&typeof f!="symbol"&&!isNaN(f)&&1<=f?a.setAttribute(u,f):a.removeAttribute(u);break;case"rowSpan":case"start":f==null||typeof f=="function"||typeof f=="symbol"||isNaN(f)?a.removeAttribute(u):a.setAttribute(u,f);break;case"popover":Xe("beforetoggle",a),Xe("toggle",a),ci(a,"popover",f);break;case"xlinkActuate":to(a,"http://www.w3.org/1999/xlink","xlink:actuate",f);break;case"xlinkArcrole":to(a,"http://www.w3.org/1999/xlink","xlink:arcrole",f);break;case"xlinkRole":to(a,"http://www.w3.org/1999/xlink","xlink:role",f);break;case"xlinkShow":to(a,"http://www.w3.org/1999/xlink","xlink:show",f);break;case"xlinkTitle":to(a,"http://www.w3.org/1999/xlink","xlink:title",f);break;case"xlinkType":to(a,"http://www.w3.org/1999/xlink","xlink:type",f);break;case"xmlBase":to(a,"http://www.w3.org/XML/1998/namespace","xml:base",f);break;case"xmlLang":to(a,"http://www.w3.org/XML/1998/namespace","xml:lang",f);break;case"xmlSpace":to(a,"http://www.w3.org/XML/1998/namespace","xml:space",f);break;case"is":ci(a,"is",f);break;case"innerText":case"textContent":break;default:(!(2<u.length)||u[0]!=="o"&&u[0]!=="O"||u[1]!=="n"&&u[1]!=="N")&&(u=Kb.get(u)||u,ci(a,u,f))}}function zE(a,o,u,f,g,R){switch(u){case"style":zv(a,f,R);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(A(61));if(u=f.__html,u!=null){if(g.children!=null)throw Error(A(60));a.innerHTML=u}}break;case"children":typeof f=="string"?Bo(a,f):(typeof f=="number"||typeof f=="bigint")&&Bo(a,""+f);break;case"onScroll":f!=null&&Xe("scroll",a);break;case"onScrollEnd":f!=null&&Xe("scrollend",a);break;case"onClick":f!=null&&(a.onclick=dh);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Jm.hasOwnProperty(u))t:{if(u[0]==="o"&&u[1]==="n"&&(g=u.endsWith("Capture"),o=u.slice(2,g?u.length-7:void 0),R=a[Mr]||null,R=R!=null?R[u]:null,typeof R=="function"&&a.removeEventListener(o,R,g),typeof f=="function")){typeof R!="function"&&R!==null&&(u in a?a[u]=null:a.hasAttribute(u)&&a.removeAttribute(u)),a.addEventListener(o,f,g);break t}u in a?a[u]=f:f===!0?a.setAttribute(u,""):ci(a,u,f)}}}function er(a,o,u){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Xe("error",a),Xe("load",a);var f=!1,g=!1,R;for(R in u)if(u.hasOwnProperty(R)){var x=u[R];if(x!=null)switch(R){case"src":f=!0;break;case"srcSet":g=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(A(137,o));default:Pn(a,o,R,x,u,null)}}g&&Pn(a,o,"srcSet",u.srcSet,u,null),f&&Pn(a,o,"src",u.src,u,null);return;case"input":Xe("invalid",a);var j=R=x=g=null,X=null,ct=null;for(f in u)if(u.hasOwnProperty(f)){var Rt=u[f];if(Rt!=null)switch(f){case"name":g=Rt;break;case"type":x=Rt;break;case"checked":X=Rt;break;case"defaultChecked":ct=Rt;break;case"value":R=Rt;break;case"defaultValue":j=Rt;break;case"children":case"dangerouslySetInnerHTML":if(Rt!=null)throw Error(A(137,o));break;default:Pn(a,o,f,Rt,u,null)}}Fv(a,R,j,X,ct,x,g,!1),_p(a);return;case"select":Xe("invalid",a),f=x=R=null;for(g in u)if(u.hasOwnProperty(g)&&(j=u[g],j!=null))switch(g){case"value":R=j;break;case"defaultValue":x=j;break;case"multiple":f=j;default:Pn(a,o,g,j,u,null)}o=R,u=x,a.multiple=!!f,o!=null?Gl(a,!!f,o,!1):u!=null&&Gl(a,!!f,u,!0);return;case"textarea":Xe("invalid",a),R=g=f=null;for(x in u)if(u.hasOwnProperty(x)&&(j=u[x],j!=null))switch(x){case"value":f=j;break;case"defaultValue":g=j;break;case"children":R=j;break;case"dangerouslySetInnerHTML":if(j!=null)throw Error(A(91));break;default:Pn(a,o,x,j,u,null)}Hv(a,f,g,R),_p(a);return;case"option":for(X in u)if(u.hasOwnProperty(X)&&(f=u[X],f!=null))switch(X){case"selected":a.selected=f&&typeof f!="function"&&typeof f!="symbol";break;default:Pn(a,o,X,f,u,null)}return;case"dialog":Xe("beforetoggle",a),Xe("toggle",a),Xe("cancel",a),Xe("close",a);break;case"iframe":case"object":Xe("load",a);break;case"video":case"audio":for(f=0;f<wd.length;f++)Xe(wd[f],a);break;case"image":Xe("error",a),Xe("load",a);break;case"details":Xe("toggle",a);break;case"embed":case"source":case"link":Xe("error",a),Xe("load",a);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ct in u)if(u.hasOwnProperty(ct)&&(f=u[ct],f!=null))switch(ct){case"children":case"dangerouslySetInnerHTML":throw Error(A(137,o));default:Pn(a,o,ct,f,u,null)}return;default:if(mu(o)){for(Rt in u)u.hasOwnProperty(Rt)&&(f=u[Rt],f!==void 0&&zE(a,o,Rt,f,u,void 0));return}}for(j in u)u.hasOwnProperty(j)&&(f=u[j],f!=null&&Pn(a,o,j,f,u,null))}function BC(a,o,u,f){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var g=null,R=null,x=null,j=null,X=null,ct=null,Rt=null;for(gt in u){var Nt=u[gt];if(u.hasOwnProperty(gt)&&Nt!=null)switch(gt){case"checked":break;case"value":break;case"defaultValue":X=Nt;default:f.hasOwnProperty(gt)||Pn(a,o,gt,null,f,Nt)}}for(var _t in f){var gt=f[_t];if(Nt=u[_t],f.hasOwnProperty(_t)&&(gt!=null||Nt!=null))switch(_t){case"type":R=gt;break;case"name":g=gt;break;case"checked":ct=gt;break;case"defaultChecked":Rt=gt;break;case"value":x=gt;break;case"defaultValue":j=gt;break;case"children":case"dangerouslySetInnerHTML":if(gt!=null)throw Error(A(137,o));break;default:gt!==Nt&&Pn(a,o,_t,gt,f,Nt)}}e_(a,x,j,X,ct,Rt,R,g);return;case"select":gt=x=j=_t=null;for(R in u)if(X=u[R],u.hasOwnProperty(R)&&X!=null)switch(R){case"value":break;case"multiple":gt=X;default:f.hasOwnProperty(R)||Pn(a,o,R,null,f,X)}for(g in f)if(R=f[g],X=u[g],f.hasOwnProperty(g)&&(R!=null||X!=null))switch(g){case"value":_t=R;break;case"defaultValue":j=R;break;case"multiple":x=R;default:R!==X&&Pn(a,o,g,R,f,X)}o=j,u=x,f=gt,_t!=null?Gl(a,!!u,_t,!1):!!f!=!!u&&(o!=null?Gl(a,!!u,o,!0):Gl(a,!!u,u?[]:"",!1));return;case"textarea":gt=_t=null;for(j in u)if(g=u[j],u.hasOwnProperty(j)&&g!=null&&!f.hasOwnProperty(j))switch(j){case"value":break;case"children":break;default:Pn(a,o,j,null,f,g)}for(x in f)if(g=f[x],R=u[x],f.hasOwnProperty(x)&&(g!=null||R!=null))switch(x){case"value":_t=g;break;case"defaultValue":gt=g;break;case"children":break;case"dangerouslySetInnerHTML":if(g!=null)throw Error(A(91));break;default:g!==R&&Pn(a,o,x,g,f,R)}Gv(a,_t,gt);return;case"option":for(var we in u)if(_t=u[we],u.hasOwnProperty(we)&&_t!=null&&!f.hasOwnProperty(we))switch(we){case"selected":a.selected=!1;break;default:Pn(a,o,we,null,f,_t)}for(X in f)if(_t=f[X],gt=u[X],f.hasOwnProperty(X)&&_t!==gt&&(_t!=null||gt!=null))switch(X){case"selected":a.selected=_t&&typeof _t!="function"&&typeof _t!="symbol";break;default:Pn(a,o,X,_t,f,gt)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var _e in u)_t=u[_e],u.hasOwnProperty(_e)&&_t!=null&&!f.hasOwnProperty(_e)&&Pn(a,o,_e,null,f,_t);for(ct in f)if(_t=f[ct],gt=u[ct],f.hasOwnProperty(ct)&&_t!==gt&&(_t!=null||gt!=null))switch(ct){case"children":case"dangerouslySetInnerHTML":if(_t!=null)throw Error(A(137,o));break;default:Pn(a,o,ct,_t,f,gt)}return;default:if(mu(o)){for(var Vn in u)_t=u[Vn],u.hasOwnProperty(Vn)&&_t!==void 0&&!f.hasOwnProperty(Vn)&&zE(a,o,Vn,void 0,f,_t);for(Rt in f)_t=f[Rt],gt=u[Rt],!f.hasOwnProperty(Rt)||_t===gt||_t===void 0&&gt===void 0||zE(a,o,Rt,_t,f,gt);return}}for(var st in u)_t=u[st],u.hasOwnProperty(st)&&_t!=null&&!f.hasOwnProperty(st)&&Pn(a,o,st,null,f,_t);for(Nt in f)_t=f[Nt],gt=u[Nt],!f.hasOwnProperty(Nt)||_t===gt||_t==null&&gt==null||Pn(a,o,Nt,_t,f,gt)}var qE=null,Dd=null;function If(a){return a.nodeType===9?a:a.ownerDocument}function kT(a){switch(a){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function LT(a,o){if(a===0)switch(o){case"svg":return 1;case"math":return 2;default:return 0}return a===1&&o==="foreignObject"?0:a}function KE(a,o){return a==="textarea"||a==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.children=="bigint"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var YE=null;function FC(){var a=window.event;return a&&a.type==="popstate"?a===YE?!1:(YE=a,!0):(YE=null,!1)}var xT=typeof setTimeout=="function"?setTimeout:void 0,GC=typeof clearTimeout=="function"?clearTimeout:void 0,MT=typeof Promise=="function"?Promise:void 0,HC=typeof queueMicrotask=="function"?queueMicrotask:typeof MT<"u"?function(a){return MT.resolve(null).then(a).catch(WC)}:xT;function WC(a){setTimeout(function(){throw a})}function dc(a){return a==="head"}function UT(a,o){var u=o,f=0,g=0;do{var R=u.nextSibling;if(a.removeChild(u),R&&R.nodeType===8)if(u=R.data,u==="/$"){if(0<f&&8>f){u=f;var x=a.ownerDocument;if(u&1&&uh(x.documentElement),u&2&&uh(x.body),u&4)for(u=x.head,uh(u),x=u.firstChild;x;){var j=x.nextSibling,X=x.nodeName;x[Vl]||X==="SCRIPT"||X==="STYLE"||X==="LINK"&&x.rel.toLowerCase()==="stylesheet"||u.removeChild(x),x=j}}if(g===0){a.removeChild(R),Th(o);return}g--}else u==="$"||u==="$?"||u==="$!"?g++:f=u.charCodeAt(0)-48;else f=0;u=R}while(u);Th(o)}function XE(a){var o=a.firstChild;for(o&&o.nodeType===10&&(o=o.nextSibling);o;){var u=o;switch(o=o.nextSibling,u.nodeName){case"HTML":case"HEAD":case"BODY":XE(u),hp(u);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(u.rel.toLowerCase()==="stylesheet")continue}a.removeChild(u)}}function zC(a,o,u,f){for(;a.nodeType===1;){var g=u;if(a.nodeName.toLowerCase()!==o.toLowerCase()){if(!f&&(a.nodeName!=="INPUT"||a.type!=="hidden"))break}else if(f){if(!a[Vl])switch(o){case"meta":if(!a.hasAttribute("itemprop"))break;return a;case"link":if(R=a.getAttribute("rel"),R==="stylesheet"&&a.hasAttribute("data-precedence"))break;if(R!==g.rel||a.getAttribute("href")!==(g.href==null||g.href===""?null:g.href)||a.getAttribute("crossorigin")!==(g.crossOrigin==null?null:g.crossOrigin)||a.getAttribute("title")!==(g.title==null?null:g.title))break;return a;case"style":if(a.hasAttribute("data-precedence"))break;return a;case"script":if(R=a.getAttribute("src"),(R!==(g.src==null?null:g.src)||a.getAttribute("type")!==(g.type==null?null:g.type)||a.getAttribute("crossorigin")!==(g.crossOrigin==null?null:g.crossOrigin))&&R&&a.hasAttribute("async")&&!a.hasAttribute("itemprop"))break;return a;default:return a}}else if(o==="input"&&a.type==="hidden"){var R=g.name==null?null:""+g.name;if(g.type==="hidden"&&a.getAttribute("name")===R)return a}else return a;if(a=Ja(a.nextSibling),a===null)break}return null}function qC(a,o,u){if(o==="")return null;for(;a.nodeType!==3;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!u||(a=Ja(a.nextSibling),a===null))return null;return a}function Of(a){return a.data==="$!"||a.data==="$?"&&a.ownerDocument.readyState==="complete"}function KC(a,o){var u=a.ownerDocument;if(a.data!=="$?"||u.readyState==="complete")o();else{var f=function(){o(),u.removeEventListener("DOMContentLoaded",f)};u.addEventListener("DOMContentLoaded",f),a._reactRetry=f}}function Ja(a){for(;a!=null;a=a.nextSibling){var o=a.nodeType;if(o===1||o===3)break;if(o===8){if(o=a.data,o==="$"||o==="$!"||o==="$?"||o==="F!"||o==="F")break;if(o==="/$")return null}}return a}var QE=null;function VT(a){a=a.previousSibling;for(var o=0;a;){if(a.nodeType===8){var u=a.data;if(u==="$"||u==="$!"||u==="$?"){if(o===0)return a;o--}else u==="/$"&&o++}a=a.previousSibling}return null}function jT(a,o,u){switch(o=If(u),a){case"html":if(a=o.documentElement,!a)throw Error(A(452));return a;case"head":if(a=o.head,!a)throw Error(A(453));return a;case"body":if(a=o.body,!a)throw Error(A(454));return a;default:throw Error(A(451))}}function uh(a){for(var o=a.attributes;o.length;)a.removeAttributeNode(o[0]);hp(a)}var ya=new Map,BT=new Set;function Nf(a){return typeof a.getRootNode=="function"?a.getRootNode():a.nodeType===9?a:a.ownerDocument}var po=kt.d;kt.d={f:YC,r:XC,D:QC,C:JC,L:ZC,m:GT,X:t0,S:$C,M:e0};function YC(){var a=po.f(),o=ul();return a||o}function XC(a){var o=Bl(a);o!==null&&o.tag===5&&o.type==="form"?nE(o):po.r(a)}var Pd=typeof document>"u"?null:document;function FT(a,o,u){var f=Pd;if(f&&typeof o=="string"&&o){var g=Zr(o);g='link[rel="'+a+'"][href="'+g+'"]',typeof u=="string"&&(g+='[crossorigin="'+u+'"]'),BT.has(g)||(BT.add(g),a={rel:a,crossOrigin:u,href:o},f.querySelector(g)===null&&(o=f.createElement("link"),er(o,"link",a),Vi(o),f.head.appendChild(o)))}}function QC(a){po.D(a),FT("dns-prefetch",a,null)}function JC(a,o){po.C(a,o),FT("preconnect",a,o)}function ZC(a,o,u){po.L(a,o,u);var f=Pd;if(f&&a&&o){var g='link[rel="preload"][as="'+Zr(o)+'"]';o==="image"&&u&&u.imageSrcSet?(g+='[imagesrcset="'+Zr(u.imageSrcSet)+'"]',typeof u.imageSizes=="string"&&(g+='[imagesizes="'+Zr(u.imageSizes)+'"]')):g+='[href="'+Zr(a)+'"]';var R=g;switch(o){case"style":R=kd(a);break;case"script":R=xd(a)}ya.has(R)||(a=ht({rel:"preload",href:o==="image"&&u&&u.imageSrcSet?void 0:a,as:o},u),ya.set(R,a),f.querySelector(g)!==null||o==="style"&&f.querySelector(Ld(R))||o==="script"&&f.querySelector(hh(R))||(o=f.createElement("link"),er(o,"link",a),Vi(o),f.head.appendChild(o)))}}function GT(a,o){po.m(a,o);var u=Pd;if(u&&a){var f=o&&typeof o.as=="string"?o.as:"script",g='link[rel="modulepreload"][as="'+Zr(f)+'"][href="'+Zr(a)+'"]',R=g;switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":R=xd(a)}if(!ya.has(R)&&(a=ht({rel:"modulepreload",href:a},o),ya.set(R,a),u.querySelector(g)===null)){switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(u.querySelector(hh(R)))return}f=u.createElement("link"),er(f,"link",a),Vi(f),u.head.appendChild(f)}}}function $C(a,o,u){po.S(a,o,u);var f=Pd;if(f&&a){var g=Mc(f).hoistableStyles,R=kd(a);o=o||"default";var x=g.get(R);if(!x){var j={loading:0,preload:null};if(x=f.querySelector(Ld(R)))j.loading=5;else{a=ht({rel:"stylesheet",href:a,"data-precedence":o},u),(u=ya.get(R))&&JE(a,u);var X=x=f.createElement("link");Vi(X),er(X,"link",a),X._p=new Promise(function(ct,Rt){X.onload=ct,X.onerror=Rt}),X.addEventListener("load",function(){j.loading|=1}),X.addEventListener("error",function(){j.loading|=2}),j.loading|=4,kf(x,o,f)}x={type:"stylesheet",instance:x,count:1,state:j},g.set(R,x)}}}function t0(a,o){po.X(a,o);var u=Pd;if(u&&a){var f=Mc(u).hoistableScripts,g=xd(a),R=f.get(g);R||(R=u.querySelector(hh(g)),R||(a=ht({src:a,async:!0},o),(o=ya.get(g))&&ZE(a,o),R=u.createElement("script"),Vi(R),er(R,"link",a),u.head.appendChild(R)),R={type:"script",instance:R,count:1,state:null},f.set(g,R))}}function e0(a,o){po.M(a,o);var u=Pd;if(u&&a){var f=Mc(u).hoistableScripts,g=xd(a),R=f.get(g);R||(R=u.querySelector(hh(g)),R||(a=ht({src:a,async:!0,type:"module"},o),(o=ya.get(g))&&ZE(a,o),R=u.createElement("script"),Vi(R),er(R,"link",a),u.head.appendChild(R)),R={type:"script",instance:R,count:1,state:null},f.set(g,R))}}function HT(a,o,u,f){var g=(g=me.current)?Nf(g):null;if(!g)throw Error(A(446));switch(a){case"meta":case"title":return null;case"style":return typeof u.precedence=="string"&&typeof u.href=="string"?(o=kd(u.href),u=Mc(g).hoistableStyles,f=u.get(o),f||(f={type:"style",instance:null,count:0,state:null},u.set(o,f)),f):{type:"void",instance:null,count:0,state:null};case"link":if(u.rel==="stylesheet"&&typeof u.href=="string"&&typeof u.precedence=="string"){a=kd(u.href);var R=Mc(g).hoistableStyles,x=R.get(a);if(x||(g=g.ownerDocument||g,x={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},R.set(a,x),(R=g.querySelector(Ld(a)))&&!R._p&&(x.instance=R,x.state.loading=5),ya.has(a)||(u={rel:"preload",as:"style",href:u.href,crossOrigin:u.crossOrigin,integrity:u.integrity,media:u.media,hrefLang:u.hrefLang,referrerPolicy:u.referrerPolicy},ya.set(a,u),R||WT(g,a,u,x.state))),o&&f===null)throw Error(A(528,""));return x}if(o&&f!==null)throw Error(A(529,""));return null;case"script":return o=u.async,u=u.src,typeof u=="string"&&o&&typeof o!="function"&&typeof o!="symbol"?(o=xd(u),u=Mc(g).hoistableScripts,f=u.get(o),f||(f={type:"script",instance:null,count:0,state:null},u.set(o,f)),f):{type:"void",instance:null,count:0,state:null};default:throw Error(A(444,a))}}function kd(a){return'href="'+Zr(a)+'"'}function Ld(a){return'link[rel="stylesheet"]['+a+"]"}function Df(a){return ht({},a,{"data-precedence":a.precedence,precedence:null})}function WT(a,o,u,f){a.querySelector('link[rel="preload"][as="style"]['+o+"]")?f.loading=1:(o=a.createElement("link"),f.preload=o,o.addEventListener("load",function(){return f.loading|=1}),o.addEventListener("error",function(){return f.loading|=2}),er(o,"link",u),Vi(o),a.head.appendChild(o))}function xd(a){return'[src="'+Zr(a)+'"]'}function hh(a){return"script[async]"+a}function Pf(a,o,u){if(o.count++,o.instance===null)switch(o.type){case"style":var f=a.querySelector('style[data-href~="'+Zr(u.href)+'"]');if(f)return o.instance=f,Vi(f),f;var g=ht({},u,{"data-href":u.href,"data-precedence":u.precedence,href:null,precedence:null});return f=(a.ownerDocument||a).createElement("style"),Vi(f),er(f,"style",g),kf(f,u.precedence,a),o.instance=f;case"stylesheet":g=kd(u.href);var R=a.querySelector(Ld(g));if(R)return o.state.loading|=4,o.instance=R,Vi(R),R;f=Df(u),(g=ya.get(g))&&JE(f,g),R=(a.ownerDocument||a).createElement("link"),Vi(R);var x=R;return x._p=new Promise(function(j,X){x.onload=j,x.onerror=X}),er(R,"link",f),o.state.loading|=4,kf(R,u.precedence,a),o.instance=R;case"script":return R=xd(u.src),(g=a.querySelector(hh(R)))?(o.instance=g,Vi(g),g):(f=u,(g=ya.get(R))&&(f=ht({},u),ZE(f,g)),a=a.ownerDocument||a,g=a.createElement("script"),Vi(g),er(g,"link",f),a.head.appendChild(g),o.instance=g);case"void":return null;default:throw Error(A(443,o.type))}else o.type==="stylesheet"&&(o.state.loading&4)===0&&(f=o.instance,o.state.loading|=4,kf(f,u.precedence,a));return o.instance}function kf(a,o,u){for(var f=u.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),g=f.length?f[f.length-1]:null,R=g,x=0;x<f.length;x++){var j=f[x];if(j.dataset.precedence===o)R=j;else if(R!==g)break}R?R.parentNode.insertBefore(a,R.nextSibling):(o=u.nodeType===9?u.head:u,o.insertBefore(a,o.firstChild))}function JE(a,o){a.crossOrigin==null&&(a.crossOrigin=o.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=o.referrerPolicy),a.title==null&&(a.title=o.title)}function ZE(a,o){a.crossOrigin==null&&(a.crossOrigin=o.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=o.referrerPolicy),a.integrity==null&&(a.integrity=o.integrity)}var Lf=null;function $E(a,o,u){if(Lf===null){var f=new Map,g=Lf=new Map;g.set(u,f)}else g=Lf,f=g.get(u),f||(f=new Map,g.set(u,f));if(f.has(a))return f;for(f.set(a,null),u=u.getElementsByTagName(a),g=0;g<u.length;g++){var R=u[g];if(!(R[Vl]||R[fr]||a==="link"&&R.getAttribute("rel")==="stylesheet")&&R.namespaceURI!=="http://www.w3.org/2000/svg"){var x=R.getAttribute(o)||"";x=a+x;var j=f.get(x);j?j.push(R):f.set(x,[R])}}return f}function zT(a,o,u){a=a.ownerDocument||a,a.head.insertBefore(u,o==="title"?a.querySelector("head > title"):null)}function tg(a,o,u){if(u===1||o.itemProp!=null)return!1;switch(a){case"meta":case"title":return!0;case"style":if(typeof o.precedence!="string"||typeof o.href!="string"||o.href==="")break;return!0;case"link":if(typeof o.rel!="string"||typeof o.href!="string"||o.href===""||o.onLoad||o.onError)break;switch(o.rel){case"stylesheet":return a=o.disabled,typeof o.precedence=="string"&&a==null;default:return!0}case"script":if(o.async&&typeof o.async!="function"&&typeof o.async!="symbol"&&!o.onLoad&&!o.onError&&o.src&&typeof o.src=="string")return!0}return!1}function qT(a){return!(a.type==="stylesheet"&&(a.state.loading&3)===0)}var ph=null;function n0(){}function i0(a,o,u){if(ph===null)throw Error(A(475));var f=ph;if(o.type==="stylesheet"&&(typeof u.media!="string"||matchMedia(u.media).matches!==!1)&&(o.state.loading&4)===0){if(o.instance===null){var g=kd(u.href),R=a.querySelector(Ld(g));if(R){a=R._p,a!==null&&typeof a=="object"&&typeof a.then=="function"&&(f.count++,f=xf.bind(f),a.then(f,f)),o.state.loading|=4,o.instance=R,Vi(R);return}R=a.ownerDocument||a,u=Df(u),(g=ya.get(g))&&JE(u,g),R=R.createElement("link"),Vi(R);var x=R;x._p=new Promise(function(j,X){x.onload=j,x.onerror=X}),er(R,"link",u),o.instance=R}f.stylesheets===null&&(f.stylesheets=new Map),f.stylesheets.set(o,a),(a=o.state.preload)&&(o.state.loading&3)===0&&(f.count++,o=xf.bind(f),a.addEventListener("load",o),a.addEventListener("error",o))}}function KT(){if(ph===null)throw Error(A(475));var a=ph;return a.stylesheets&&a.count===0&&mh(a,a.stylesheets),0<a.count?function(o){var u=setTimeout(function(){if(a.stylesheets&&mh(a,a.stylesheets),a.unsuspend){var f=a.unsuspend;a.unsuspend=null,f()}},6e4);return a.unsuspend=o,function(){a.unsuspend=null,clearTimeout(u)}}:null}function xf(){if(this.count--,this.count===0){if(this.stylesheets)mh(this,this.stylesheets);else if(this.unsuspend){var a=this.unsuspend;this.unsuspend=null,a()}}}var fh=null;function mh(a,o){a.stylesheets=null,a.unsuspend!==null&&(a.count++,fh=new Map,o.forEach(r0,a),fh=null,xf.call(a))}function r0(a,o){if(!(o.state.loading&4)){var u=fh.get(a);if(u)var f=u.get(null);else{u=new Map,fh.set(a,u);for(var g=a.querySelectorAll("link[data-precedence],style[data-precedence]"),R=0;R<g.length;R++){var x=g[R];(x.nodeName==="LINK"||x.getAttribute("media")!=="not all")&&(u.set(x.dataset.precedence,x),f=x)}f&&u.set(null,f)}g=o.instance,x=g.getAttribute("data-precedence"),R=u.get(x)||f,R===f&&u.set(null,g),u.set(x,g),this.count++,f=xf.bind(this),g.addEventListener("load",f),g.addEventListener("error",f),R?R.parentNode.insertBefore(g,R.nextSibling):(a=a.nodeType===9?a.head:a,a.insertBefore(g,a.firstChild)),o.state.loading|=4}}var _h={$$typeof:Be,Provider:null,Consumer:null,_currentValue:te,_currentValue2:te,_threadCount:0};function YT(a,o,u,f,g,R,x,j){this.tag=1,this.containerInfo=a,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Xm(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Xm(0),this.hiddenUpdates=Xm(null),this.identifierPrefix=f,this.onUncaughtError=g,this.onCaughtError=R,this.onRecoverableError=x,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=j,this.incompleteTransitions=new Map}function XT(a,o,u,f,g,R,x,j,X,ct,Rt,Nt){return a=new YT(a,o,u,x,j,X,ct,Nt),o=1,R===!0&&(o|=24),R=na(3,null,null,o),a.current=R,R.stateNode=a,o=Cu(),o.refCount++,a.pooledCache=o,o.refCount++,R.memoizedState={element:f,isDehydrated:u,cache:o},Vp(R),a}function eg(a){return a?(a=io,a):io}function ng(a,o,u,f,g,R){g=eg(g),f.context===null?f.context=g:f.pendingContext=g,f=Xo(o),f.payload={element:u},R=R===void 0?null:R,R!==null&&(f.callback=R),u=co(a,f,o),u!==null&&(Gr(u,a,o),Ou(u,a,o))}function QT(a,o){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var u=a.retryLane;a.retryLane=u!==0&&u<o?u:o}}function ig(a,o){QT(a,o),(a=a.alternate)&&QT(a,o)}function JT(a){if(a.tag===13){var o=Jl(a,67108864);o!==null&&Gr(o,a,67108864),ig(a,67108864)}}var Mf=!0;function a0(a,o,u,f){var g=St.T;St.T=null;var R=kt.p;try{kt.p=2,Uf(a,o,u,f)}finally{kt.p=R,St.T=g}}function s0(a,o,u,f){var g=St.T;St.T=null;var R=kt.p;try{kt.p=8,Uf(a,o,u,f)}finally{kt.p=R,St.T=g}}function Uf(a,o,u,f){if(Mf){var g=Eh(f);if(g===null)Af(a,o,f,gh,u),ag(a,f);else if($T(g,a,o,u,f))f.stopPropagation();else if(ag(a,f),o&4&&-1<wr.indexOf(a)){for(;g!==null;){var R=Bl(g);if(R!==null)switch(R.tag){case 3:if(R=R.stateNode,R.current.memoizedState.isDehydrated){var x=pa(R.pendingLanes);if(x!==0){var j=R;for(j.pendingLanes|=2,j.entangledLanes|=2;x;){var X=1<<31-gi(x);j.entanglements[1]|=X,x&=~X}Ta(R),(bn&6)===0&&(Sd=sr()+500,oh(0))}}break;case 13:j=Jl(R,2),j!==null&&Gr(j,R,2),ul(),ig(R,2)}if(R=Eh(f),R===null&&Af(a,o,f,gh,u),R===g)break;g=R}g!==null&&f.stopPropagation()}else Af(a,o,f,null,u)}}function Eh(a){return a=r_(a),Tt(a)}var gh=null;function Tt(a){if(gh=null,a=jl(a),a!==null){var o=B(a);if(o===null)a=null;else{var u=o.tag;if(u===13){if(a=Y(o),a!==null)return a;a=null}else if(u===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;a=null}else o!==a&&(a=null)}}return gh=a,null}function ZT(a){switch(a){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Ei()){case Ui:return 2;case Xs:return 8;case Mo:case Ym:return 32;case uu:return 268435456;default:return 32}default:return 32}}var rg=!1,uc=null,hc=null,pc=null,El=new Map,vh=new Map,fc=[],wr="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function ag(a,o){switch(a){case"focusin":case"focusout":uc=null;break;case"dragenter":case"dragleave":hc=null;break;case"mouseover":case"mouseout":pc=null;break;case"pointerover":case"pointerout":El.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":vh.delete(o.pointerId)}}function Sh(a,o,u,f,g,R){return a===null||a.nativeEvent!==R?(a={blockedOn:o,domEventName:u,eventSystemFlags:f,nativeEvent:R,targetContainers:[g]},o!==null&&(o=Bl(o),o!==null&&JT(o)),a):(a.eventSystemFlags|=f,o=a.targetContainers,g!==null&&o.indexOf(g)===-1&&o.push(g),a)}function $T(a,o,u,f,g){switch(o){case"focusin":return uc=Sh(uc,a,o,u,f,g),!0;case"dragenter":return hc=Sh(hc,a,o,u,f,g),!0;case"mouseover":return pc=Sh(pc,a,o,u,f,g),!0;case"pointerover":var R=g.pointerId;return El.set(R,Sh(El.get(R)||null,a,o,u,f,g)),!0;case"gotpointercapture":return R=g.pointerId,vh.set(R,Sh(vh.get(R)||null,a,o,u,f,g)),!0}return!1}function ty(a){var o=jl(a.target);if(o!==null){var u=B(o);if(u!==null){if(o=u.tag,o===13){if(o=Y(u),o!==null){a.blockedOn=o,Hb(a.priority,function(){if(u.tag===13){var f=sa();f=Vo(f);var g=Jl(u,f);g!==null&&Gr(g,u,f),ig(u,f)}});return}}else if(o===3&&u.stateNode.current.memoizedState.isDehydrated){a.blockedOn=u.tag===3?u.stateNode.containerInfo:null;return}}}a.blockedOn=null}function Md(a){if(a.blockedOn!==null)return!1;for(var o=a.targetContainers;0<o.length;){var u=Eh(a.nativeEvent);if(u===null){u=a.nativeEvent;var f=new u.constructor(u.type,u);i_=f,u.target.dispatchEvent(f),i_=null}else return o=Bl(u),o!==null&&JT(o),a.blockedOn=u,!1;o.shift()}return!0}function sg(a,o,u){Md(a)&&u.delete(o)}function ey(){rg=!1,uc!==null&&Md(uc)&&(uc=null),hc!==null&&Md(hc)&&(hc=null),pc!==null&&Md(pc)&&(pc=null),El.forEach(sg),vh.forEach(sg)}function Vf(a,o){a.blockedOn===o&&(a.blockedOn=null,rg||(rg=!0,S.unstable_scheduleCallback(S.unstable_NormalPriority,ey)))}var jf=null;function og(a){jf!==a&&(jf=a,S.unstable_scheduleCallback(S.unstable_NormalPriority,function(){jf===a&&(jf=null);for(var o=0;o<a.length;o+=3){var u=a[o],f=a[o+1],g=a[o+2];if(typeof f!="function"){if(Tt(f||u)===null)continue;break}var R=Bl(u);R!==null&&(a.splice(o,3),o-=3,dd(R,{pending:!0,data:g,method:u.method,action:f},f,g))}}))}function Th(a){function o(X){return Vf(X,a)}uc!==null&&Vf(uc,a),hc!==null&&Vf(hc,a),pc!==null&&Vf(pc,a),El.forEach(o),vh.forEach(o);for(var u=0;u<fc.length;u++){var f=fc[u];f.blockedOn===a&&(f.blockedOn=null)}for(;0<fc.length&&(u=fc[0],u.blockedOn===null);)ty(u),u.blockedOn===null&&fc.shift();if(u=(a.ownerDocument||a).$$reactFormReplay,u!=null)for(f=0;f<u.length;f+=3){var g=u[f],R=u[f+1],x=g[Mr]||null;if(typeof R=="function")x||og(u);else if(x){var j=null;if(R&&R.hasAttribute("formAction")){if(g=R,x=R[Mr]||null)j=x.formAction;else if(Tt(g)!==null)continue}else j=x.action;typeof j=="function"?u[f+1]=j:(u.splice(f,3),f-=3),og(u)}}}function cg(a){this._internalRoot=a}yh.prototype.render=cg.prototype.render=function(a){var o=this._internalRoot;if(o===null)throw Error(A(409));var u=o.current,f=sa();ng(u,f,a,o,null,null)},yh.prototype.unmount=cg.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var o=a.containerInfo;ng(a.current,2,null,a,null,null),ul(),o[$s]=null}};function yh(a){this._internalRoot=a}yh.prototype.unstable_scheduleHydration=function(a){if(a){var o=kv();a={blockedOn:null,target:a,priority:o};for(var u=0;u<fc.length&&o!==0&&o<fc[u].priority;u++);fc.splice(u,0,a),u===0&&ty(a)}};var ny=v.version;if(ny!=="19.1.0")throw Error(A(527,ny,"19.1.0"));kt.findDOMNode=function(a){var o=a._reactInternals;if(o===void 0)throw typeof a.render=="function"?Error(A(188)):(a=Object.keys(a).join(","),Error(A(268,a)));return a=J(o),a=a!==null?Q(a):null,a=a===null?null:a.stateNode,a};var o0={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:St,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Rh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Rh.isDisabled&&Rh.supportsFiber)try{Gn=Rh.inject(o0),We=Rh}catch{}}return Tv.createRoot=function(a,o){if(!V(a))throw Error(A(299));var u=!1,f="",g=nT,R=iT,x=rT,j=null;return o!=null&&(o.unstable_strictMode===!0&&(u=!0),o.identifierPrefix!==void 0&&(f=o.identifierPrefix),o.onUncaughtError!==void 0&&(g=o.onUncaughtError),o.onCaughtError!==void 0&&(R=o.onCaughtError),o.onRecoverableError!==void 0&&(x=o.onRecoverableError),o.unstable_transitionCallbacks!==void 0&&(j=o.unstable_transitionCallbacks)),o=XT(a,1,!1,null,null,u,f,g,R,x,j,null),a[$s]=o.current,Cf(a),new cg(o)},Tv.hydrateRoot=function(a,o,u){if(!V(a))throw Error(A(299));var f=!1,g="",R=nT,x=iT,j=rT,X=null,ct=null;return u!=null&&(u.unstable_strictMode===!0&&(f=!0),u.identifierPrefix!==void 0&&(g=u.identifierPrefix),u.onUncaughtError!==void 0&&(R=u.onUncaughtError),u.onCaughtError!==void 0&&(x=u.onCaughtError),u.onRecoverableError!==void 0&&(j=u.onRecoverableError),u.unstable_transitionCallbacks!==void 0&&(X=u.unstable_transitionCallbacks),u.formState!==void 0&&(ct=u.formState)),o=XT(a,1,!0,o,u??null,f,g,R,x,j,X,ct),o.context=eg(null),u=o.current,f=sa(),f=Vo(f),g=Xo(f),g.callback=null,co(u,g,f),u=f,o.current.lanes=u,pu(o,u),Ta(o),a[$s]=o.current,Cf(a),new yh(o)},Tv.version="19.1.0",Tv}var nj;function rz(){if(nj)return XI.exports;nj=1;function S(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(S)}catch(v){console.error(v)}}return S(),XI.exports=iz(),XI.exports}var az=rz();const ap="1.24.2";var xc=[],zs=[],sz=Uint8Array,tO="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var Hm=0,oz=tO.length;Hm<oz;++Hm)xc[Hm]=tO[Hm],zs[tO.charCodeAt(Hm)]=Hm;zs[45]=62;zs[95]=63;function cz(S){var v=S.length;if(v%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var y=S.indexOf("=");y===-1&&(y=v);var A=y===v?0:4-y%4;return[y,A]}function lz(S,v,y){return(v+y)*3/4-y}function Av(S){var v,y=cz(S),A=y[0],V=y[1],B=new sz(lz(S,A,V)),Y=0,et=V>0?A-4:A,J;for(J=0;J<et;J+=4)v=zs[S.charCodeAt(J)]<<18|zs[S.charCodeAt(J+1)]<<12|zs[S.charCodeAt(J+2)]<<6|zs[S.charCodeAt(J+3)],B[Y++]=v>>16&255,B[Y++]=v>>8&255,B[Y++]=v&255;return V===2&&(v=zs[S.charCodeAt(J)]<<2|zs[S.charCodeAt(J+1)]>>4,B[Y++]=v&255),V===1&&(v=zs[S.charCodeAt(J)]<<10|zs[S.charCodeAt(J+1)]<<4|zs[S.charCodeAt(J+2)]>>2,B[Y++]=v>>8&255,B[Y++]=v&255),B}function dz(S){return xc[S>>18&63]+xc[S>>12&63]+xc[S>>6&63]+xc[S&63]}function uz(S,v,y){for(var A,V=[],B=v;B<y;B+=3)A=(S[B]<<16&16711680)+(S[B+1]<<8&65280)+(S[B+2]&255),V.push(dz(A));return V.join("")}function wv(S){for(var v,y=S.length,A=y%3,V=[],B=16383,Y=0,et=y-A;Y<et;Y+=B)V.push(uz(S,Y,Y+B>et?et:Y+B));return A===1?(v=S[y-1],V.push(xc[v>>2]+xc[v<<4&63]+"==")):A===2&&(v=(S[y-2]<<8)+S[y-1],V.push(xc[v>>10]+xc[v>>4&63]+xc[v<<2&63]+"=")),V.join("")}function Ma(S){if(S===void 0)return{};if(!kj(S))throw new Error(`The arguments to a Convex function must be an object. Received: ${S}`);return S}function Pj(S){if(typeof S>"u")throw new Error("Client created with undefined deployment address. If you used an environment variable, check that it's set.");if(typeof S!="string")throw new Error(`Invalid deployment address: found ${S}".`);if(!(S.startsWith("http:")||S.startsWith("https:")))throw new Error(`Invalid deployment address: Must start with "https://" or "http://". Found "${S}".`);try{new URL(S)}catch{throw new Error(`Invalid deployment address: "${S}" is not a valid URL. If you believe this URL is correct, use the \`skipConvexDeploymentUrlCheck\` option to bypass this.`)}if(S.endsWith(".convex.site"))throw new Error(`Invalid deployment address: "${S}" ends with .convex.site, which is used for HTTP Actions. Convex deployment URLs typically end with .convex.cloud? If you believe this URL is correct, use the \`skipConvexDeploymentUrlCheck\` option to bypass this.`)}function kj(S){var V;const v=typeof S=="object",y=Object.getPrototypeOf(S),A=y===null||y===Object.prototype||((V=y==null?void 0:y.constructor)==null?void 0:V.name)==="Object";return v&&A}const Lj=!0,qm=BigInt("-9223372036854775808"),RO=BigInt("9223372036854775807"),pO=BigInt("0"),hz=BigInt("8"),pz=BigInt("256");function xj(S){return Number.isNaN(S)||!Number.isFinite(S)||Object.is(S,-0)}function fz(S){S<pO&&(S-=qm+qm);let v=S.toString(16);v.length%2===1&&(v="0"+v);const y=new Uint8Array(new ArrayBuffer(8));let A=0;for(const V of v.match(/.{2}/g).reverse())y.set([parseInt(V,16)],A++),S>>=hz;return wv(y)}function mz(S){const v=Av(S);if(v.byteLength!==8)throw new Error(`Received ${v.byteLength} bytes, expected 8 for $integer`);let y=pO,A=pO;for(const V of v)y+=BigInt(V)*pz**A,A++;return y>RO&&(y+=qm+qm),y}function _z(S){if(S<qm||RO<S)throw new Error(`BigInt ${S} does not fit into a 64-bit signed integer.`);const v=new ArrayBuffer(8);return new DataView(v).setBigInt64(0,S,!0),wv(new Uint8Array(v))}function Ez(S){const v=Av(S);if(v.byteLength!==8)throw new Error(`Received ${v.byteLength} bytes, expected 8 for $integer`);return new DataView(v.buffer).getBigInt64(0,!0)}const gz=DataView.prototype.setBigInt64?_z:fz,vz=DataView.prototype.getBigInt64?Ez:mz,ij=1024;function Mj(S){if(S.length>ij)throw new Error(`Field name ${S} exceeds maximum field name length ${ij}.`);if(S.startsWith("$"))throw new Error(`Field name ${S} starts with a '$', which is reserved.`);for(let v=0;v<S.length;v+=1){const y=S.charCodeAt(v);if(y<32||y>=127)throw new Error(`Field name ${S} has invalid character '${S[v]}': Field names can only contain non-control ASCII characters`)}}function xo(S){if(S===null||typeof S=="boolean"||typeof S=="number"||typeof S=="string")return S;if(Array.isArray(S))return S.map(A=>xo(A));if(typeof S!="object")throw new Error(`Unexpected type of ${S}`);const v=Object.entries(S);if(v.length===1){const A=v[0][0];if(A==="$bytes"){if(typeof S.$bytes!="string")throw new Error(`Malformed $bytes field on ${S}`);return Av(S.$bytes).buffer}if(A==="$integer"){if(typeof S.$integer!="string")throw new Error(`Malformed $integer field on ${S}`);return vz(S.$integer)}if(A==="$float"){if(typeof S.$float!="string")throw new Error(`Malformed $float field on ${S}`);const V=Av(S.$float);if(V.byteLength!==8)throw new Error(`Received ${V.byteLength} bytes, expected 8 for $float`);const Y=new DataView(V.buffer).getFloat64(0,Lj);if(!xj(Y))throw new Error(`Float ${Y} should be encoded as a number`);return Y}if(A==="$set")throw new Error("Received a Set which is no longer supported as a Convex type.");if(A==="$map")throw new Error("Received a Map which is no longer supported as a Convex type.")}const y={};for(const[A,V]of Object.entries(S))Mj(A),y[A]=xo(V);return y}function bv(S){return JSON.stringify(S,(v,y)=>y===void 0?"undefined":typeof y=="bigint"?`${y.toString()}n`:y)}function fO(S,v,y,A){var Y;if(S===void 0){const et=y&&` (present at path ${y} in original object ${bv(v)})`;throw new Error(`undefined is not a valid Convex value${et}. To learn about Convex's supported types, see https://docs.convex.dev/using/types.`)}if(S===null)return S;if(typeof S=="bigint"){if(S<qm||RO<S)throw new Error(`BigInt ${S} does not fit into a 64-bit signed integer.`);return{$integer:gz(S)}}if(typeof S=="number")if(xj(S)){const et=new ArrayBuffer(8);return new DataView(et).setFloat64(0,S,Lj),{$float:wv(new Uint8Array(et))}}else return S;if(typeof S=="boolean"||typeof S=="string")return S;if(S instanceof ArrayBuffer)return{$bytes:wv(new Uint8Array(S))};if(Array.isArray(S))return S.map((et,J)=>fO(et,v,y+`[${J}]`));if(S instanceof Set)throw new Error(eO(y,"Set",[...S],v));if(S instanceof Map)throw new Error(eO(y,"Map",[...S],v));if(!kj(S)){const et=(Y=S==null?void 0:S.constructor)==null?void 0:Y.name,J=et?`${et} `:"";throw new Error(eO(y,J,S,v))}const V={},B=Object.entries(S);B.sort(([et,J],[Q,ht])=>et===Q?0:et<Q?-1:1);for(const[et,J]of B)J!==void 0&&(Mj(et),V[et]=fO(J,v,y+`.${et}`));return V}function eO(S,v,y,A){return S?`${v}${bv(y)} is not a supported Convex type (present at path ${S} in original object ${bv(A)}). To learn about Convex's supported types, see https://docs.convex.dev/using/types.`:`${v}${bv(y)} is not a supported Convex type.`}function Ks(S){return fO(S,S,"")}var Sz=Object.defineProperty,Tz=(S,v,y)=>v in S?Sz(S,v,{enumerable:!0,configurable:!0,writable:!0,value:y}):S[v]=y,nO=(S,v,y)=>Tz(S,typeof v!="symbol"?v+"":v,y),rj,aj;const yz=Symbol.for("ConvexError");class op extends(aj=Error,rj=yz,aj){constructor(v){super(typeof v=="string"?v:bv(v)),nO(this,"name","ConvexError"),nO(this,"data"),nO(this,rj,!0),this.data=v}}const Uj=()=>Array.from({length:4},()=>0);Uj();Uj();var Rz=Object.defineProperty,bz=(S,v,y)=>v in S?Rz(S,v,{enumerable:!0,configurable:!0,writable:!0,value:y}):S[v]=y,sj=(S,v,y)=>bz(S,typeof v!="symbol"?v+"":v,y);const Cz="color:rgb(0, 145, 255)";function Vj(S){switch(S){case"query":return"Q";case"mutation":return"M";case"action":return"A";case"any":return"?"}}class jj{constructor(v){sj(this,"_onLogLineFuncs"),sj(this,"_verbose"),this._onLogLineFuncs={},this._verbose=v.verbose}addLogLineListener(v){let y=Math.random().toString(36).substring(2,15);for(let A=0;A<10&&this._onLogLineFuncs[y]!==void 0;A++)y=Math.random().toString(36).substring(2,15);return this._onLogLineFuncs[y]=v,()=>{delete this._onLogLineFuncs[y]}}logVerbose(...v){if(this._verbose)for(const y of Object.values(this._onLogLineFuncs))y("debug",`${new Date().toISOString()}`,...v)}log(...v){for(const y of Object.values(this._onLogLineFuncs))y("info",...v)}warn(...v){for(const y of Object.values(this._onLogLineFuncs))y("warn",...v)}error(...v){for(const y of Object.values(this._onLogLineFuncs))y("error",...v)}}function bO(S){const v=new jj(S);return v.addLogLineListener((y,...A)=>{switch(y){case"debug":console.debug(...A);break;case"info":console.log(...A);break;case"warn":console.warn(...A);break;case"error":console.error(...A);break;default:console.log(...A)}}),v}function CO(S){return new jj(S)}function du(S,v,y,A,V){const B=Vj(y);if(typeof V=="object"&&(V=`ConvexError ${JSON.stringify(V.errorData,null,2)}`),v==="info"){const Y=V.match(/^\[.*?\] /);if(Y===null){S.error(`[CONVEX ${B}(${A})] Could not parse console.log`);return}const et=V.slice(1,Y[0].length-2),J=V.slice(Y[0].length);S.log(`%c[CONVEX ${B}(${A})] [${et}]`,Cz,J)}else S.error(`[CONVEX ${B}(${A})] ${V}`)}function Az(S,v){const y=`[CONVEX FATAL ERROR] ${v}`;return S.error(y),new Error(y)}function zm(S,v,y){return`[CONVEX ${Vj(S)}(${v})] ${y.errorMessage}
  Called by client`}function mO(S,v){return v.data=S.errorData,v}function Mb(S){const v=S.split(":");let y,A;return v.length===1?(y=v[0],A="default"):(y=v.slice(0,v.length-1).join(":"),A=v[v.length-1]),y.endsWith(".js")&&(y=y.slice(0,-3)),`${y}:${A}`}function cp(S,v){return JSON.stringify({udfPath:Mb(S),args:Ks(v)})}var wz=Object.defineProperty,Iz=(S,v,y)=>v in S?wz(S,v,{enumerable:!0,configurable:!0,writable:!0,value:y}):S[v]=y,kc=(S,v,y)=>Iz(S,typeof v!="symbol"?v+"":v,y);class Oz{constructor(){kc(this,"nextQueryId"),kc(this,"querySetVersion"),kc(this,"querySet"),kc(this,"queryIdToToken"),kc(this,"identityVersion"),kc(this,"auth"),kc(this,"outstandingQueriesOlderThanRestart"),kc(this,"outstandingAuthOlderThanRestart"),kc(this,"paused"),kc(this,"pendingQuerySetModifications"),this.nextQueryId=0,this.querySetVersion=0,this.identityVersion=0,this.querySet=new Map,this.queryIdToToken=new Map,this.outstandingQueriesOlderThanRestart=new Set,this.outstandingAuthOlderThanRestart=!1,this.paused=!1,this.pendingQuerySetModifications=new Map}hasSyncedPastLastReconnect(){return this.outstandingQueriesOlderThanRestart.size===0&&!this.outstandingAuthOlderThanRestart}markAuthCompletion(){this.outstandingAuthOlderThanRestart=!1}subscribe(v,y,A,V){const B=Mb(v),Y=cp(B,y),et=this.querySet.get(Y);if(et!==void 0)return et.numSubscribers+=1,{queryToken:Y,modification:null,unsubscribe:()=>this.removeSubscriber(Y)};{const J=this.nextQueryId++,Q={id:J,canonicalizedUdfPath:B,args:y,numSubscribers:1,journal:A,componentPath:V};this.querySet.set(Y,Q),this.queryIdToToken.set(J,Y);const ht=this.querySetVersion,Et=this.querySetVersion+1,vt={type:"Add",queryId:J,udfPath:B,args:[Ks(y)],journal:A,componentPath:V};return this.paused?this.pendingQuerySetModifications.set(J,vt):this.querySetVersion=Et,{queryToken:Y,modification:{type:"ModifyQuerySet",baseVersion:ht,newVersion:Et,modifications:[vt]},unsubscribe:()=>this.removeSubscriber(Y)}}}transition(v){for(const y of v.modifications)switch(y.type){case"QueryUpdated":case"QueryFailed":{this.outstandingQueriesOlderThanRestart.delete(y.queryId);const A=y.journal;if(A!==void 0){const V=this.queryIdToToken.get(y.queryId);V!==void 0&&(this.querySet.get(V).journal=A)}break}case"QueryRemoved":{this.outstandingQueriesOlderThanRestart.delete(y.queryId);break}default:throw new Error(`Invalid modification ${y.type}`)}}queryId(v,y){const A=Mb(v),V=cp(A,y),B=this.querySet.get(V);return B!==void 0?B.id:null}isCurrentOrNewerAuthVersion(v){return v>=this.identityVersion}setAuth(v){this.auth={tokenType:"User",value:v};const y=this.identityVersion;return this.paused||(this.identityVersion=y+1),{type:"Authenticate",baseVersion:y,...this.auth}}setAdminAuth(v,y){const A={tokenType:"Admin",value:v,impersonating:y};this.auth=A;const V=this.identityVersion;return this.paused||(this.identityVersion=V+1),{type:"Authenticate",baseVersion:V,...A}}clearAuth(){this.auth=void 0,this.markAuthCompletion();const v=this.identityVersion;return this.paused||(this.identityVersion=v+1),{type:"Authenticate",tokenType:"None",baseVersion:v}}hasAuth(){return!!this.auth}isNewAuth(v){var y;return((y=this.auth)==null?void 0:y.value)!==v}queryPath(v){const y=this.queryIdToToken.get(v);return y?this.querySet.get(y).canonicalizedUdfPath:null}queryArgs(v){const y=this.queryIdToToken.get(v);return y?this.querySet.get(y).args:null}queryToken(v){return this.queryIdToToken.get(v)??null}queryJournal(v){var y;return(y=this.querySet.get(v))==null?void 0:y.journal}restart(v){this.unpause(),this.outstandingQueriesOlderThanRestart.clear();const y=[];for(const B of this.querySet.values()){const Y={type:"Add",queryId:B.id,udfPath:B.canonicalizedUdfPath,args:[Ks(B.args)],journal:B.journal,componentPath:B.componentPath};y.push(Y),v.has(B.id)||this.outstandingQueriesOlderThanRestart.add(B.id)}this.querySetVersion=1;const A={type:"ModifyQuerySet",baseVersion:0,newVersion:1,modifications:y};if(!this.auth)return this.identityVersion=0,[A,void 0];this.outstandingAuthOlderThanRestart=!0;const V={type:"Authenticate",baseVersion:0,...this.auth};return this.identityVersion=1,[A,V]}pause(){this.paused=!0}resume(){const v=this.pendingQuerySetModifications.size>0?{type:"ModifyQuerySet",baseVersion:this.querySetVersion,newVersion:++this.querySetVersion,modifications:Array.from(this.pendingQuerySetModifications.values())}:void 0,y=this.auth!==void 0?{type:"Authenticate",baseVersion:this.identityVersion++,...this.auth}:void 0;return this.unpause(),[v,y]}unpause(){this.paused=!1,this.pendingQuerySetModifications.clear()}removeSubscriber(v){const y=this.querySet.get(v);if(y.numSubscribers>1)return y.numSubscribers-=1,null;{this.querySet.delete(v),this.queryIdToToken.delete(y.id),this.outstandingQueriesOlderThanRestart.delete(y.id);const A=this.querySetVersion,V=this.querySetVersion+1,B={type:"Remove",queryId:y.id};return this.paused?this.pendingQuerySetModifications.has(y.id)?this.pendingQuerySetModifications.delete(y.id):this.pendingQuerySetModifications.set(y.id,B):this.querySetVersion=V,{type:"ModifyQuerySet",baseVersion:A,newVersion:V,modifications:[B]}}}}var Nz=Object.defineProperty,Dz=(S,v,y)=>v in S?Nz(S,v,{enumerable:!0,configurable:!0,writable:!0,value:y}):S[v]=y,Ab=(S,v,y)=>Dz(S,typeof v!="symbol"?v+"":v,y);class Pz{constructor(v){this.logger=v,Ab(this,"inflightRequests"),Ab(this,"requestsOlderThanRestart"),Ab(this,"inflightMutationsCount",0),Ab(this,"inflightActionsCount",0),this.inflightRequests=new Map,this.requestsOlderThanRestart=new Set}request(v,y){return new Promise(V=>{const B=y?"Requested":"NotSent";this.inflightRequests.set(v.requestId,{message:v,status:{status:B,requestedAt:new Date,onResult:V}}),v.type==="Mutation"?this.inflightMutationsCount++:v.type==="Action"&&this.inflightActionsCount++})}onResponse(v){const y=this.inflightRequests.get(v.requestId);if(y===void 0||y.status.status==="Completed")return null;const A=y.message.type==="Mutation"?"mutation":"action",V=y.message.udfPath;for(const J of v.logLines)du(this.logger,"info",A,V,J);const B=y.status;let Y,et;if(v.success)Y={success:!0,logLines:v.logLines,value:xo(v.result)},et=()=>B.onResult(Y);else{const J=v.result,{errorData:Q}=v;du(this.logger,"error",A,V,J),Y={success:!1,errorMessage:J,errorData:Q!==void 0?xo(Q):void 0,logLines:v.logLines},et=()=>B.onResult(Y)}return v.type==="ActionResponse"||!v.success?(et(),this.inflightRequests.delete(v.requestId),this.requestsOlderThanRestart.delete(v.requestId),y.message.type==="Action"?this.inflightActionsCount--:y.message.type==="Mutation"&&this.inflightMutationsCount--,{requestId:v.requestId,result:Y}):(y.status={status:"Completed",result:Y,ts:v.ts,onResolve:et},null)}removeCompleted(v){const y=new Map;for(const[A,V]of this.inflightRequests.entries()){const B=V.status;B.status==="Completed"&&B.ts.lessThanOrEqual(v)&&(B.onResolve(),y.set(A,B.result),V.message.type==="Mutation"?this.inflightMutationsCount--:V.message.type==="Action"&&this.inflightActionsCount--,this.inflightRequests.delete(A),this.requestsOlderThanRestart.delete(A))}return y}restart(){this.requestsOlderThanRestart=new Set(this.inflightRequests.keys());const v=[];for(const[y,A]of this.inflightRequests){if(A.status.status==="NotSent"){A.status.status="Requested",v.push(A.message);continue}if(A.message.type==="Mutation")v.push(A.message);else if(A.message.type==="Action"){if(this.inflightRequests.delete(y),this.requestsOlderThanRestart.delete(y),this.inflightActionsCount--,A.status.status==="Completed")throw new Error("Action should never be in 'Completed' state");A.status.onResult({success:!1,errorMessage:"Connection lost while action was in flight",logLines:[]})}}return v}resume(){const v=[];for(const[,y]of this.inflightRequests)if(y.status.status==="NotSent"){y.status.status="Requested",v.push(y.message);continue}return v}hasIncompleteRequests(){for(const v of this.inflightRequests.values())if(v.status.status==="Requested")return!0;return!1}hasInflightRequests(){return this.inflightRequests.size>0}hasSyncedPastLastReconnect(){return this.requestsOlderThanRestart.size===0}timeOfOldestInflightRequest(){if(this.inflightRequests.size===0)return null;let v=Date.now();for(const y of this.inflightRequests.values())y.status.status!=="Completed"&&y.status.requestedAt.getTime()<v&&(v=y.status.requestedAt.getTime());return new Date(v)}inflightMutations(){return this.inflightMutationsCount}inflightActions(){return this.inflightActionsCount}}const Iv=Symbol.for("functionName"),kz=Symbol.for("toReferencePath");function Lz(S){return S[kz]??null}function xz(S){return S.startsWith("function://")}function Mz(S){let v;if(typeof S=="string")xz(S)?v={functionHandle:S}:v={name:S};else if(S[Iv])v={name:S[Iv]};else{const y=Lz(S);if(!y)throw new Error(`${S} is not a functionReference`);v={reference:y}}return v}function Lr(S){const v=Mz(S);if(v.name===void 0)throw v.functionHandle!==void 0?new Error(`Expected function reference like "api.file.func" or "internal.file.func", but received function handle ${v.functionHandle}`):v.reference!==void 0?new Error(`Expected function reference in the current component like "api.file.func" or "internal.file.func", but received reference ${v.reference}`):new Error(`Expected function reference like "api.file.func" or "internal.file.func", but received ${JSON.stringify(v)}`);if(typeof S=="string")return S;const y=S[Iv];if(!y)throw new Error(`${S} is not a functionReference`);return y}function Bj(S){return{[Iv]:S}}function Fj(S=[]){const v={get(y,A){if(typeof A=="string"){const V=[...S,A];return Fj(V)}else if(A===Iv){if(S.length<2){const Y=["api",...S].join(".");throw new Error(`API path is expected to be of the form \`api.moduleName.functionName\`. Found: \`${Y}\``)}const V=S.slice(0,-1).join("/"),B=S[S.length-1];return B==="default"?V:V+":"+B}else return A===Symbol.toStringTag?"FunctionReference":void 0}};return new Proxy({},v)}const Uz=Fj();var Vz=Object.defineProperty,jz=(S,v,y)=>v in S?Vz(S,v,{enumerable:!0,configurable:!0,writable:!0,value:y}):S[v]=y,Ub=(S,v,y)=>jz(S,typeof v!="symbol"?v+"":v,y);class Ov{constructor(v){Ub(this,"queryResults"),Ub(this,"modifiedQueries"),this.queryResults=v,this.modifiedQueries=[]}getQuery(v,...y){const A=Ma(y[0]),V=Lr(v),B=this.queryResults.get(cp(V,A));if(B!==void 0)return Ov.queryValue(B.result)}getAllQueries(v){const y=[],A=Lr(v);for(const V of this.queryResults.values())V.udfPath===Mb(A)&&y.push({args:V.args,value:Ov.queryValue(V.result)});return y}setQuery(v,y,A){const V=Ma(y),B=Lr(v),Y=cp(B,V);let et;A===void 0?et=void 0:et={success:!0,value:A,logLines:[]};const J={udfPath:B,args:V,result:et};this.queryResults.set(Y,J),this.modifiedQueries.push(Y)}static queryValue(v){if(v!==void 0)return v.success?v.value:void 0}}class Bz{constructor(){Ub(this,"queryResults"),Ub(this,"optimisticUpdates"),this.queryResults=new Map,this.optimisticUpdates=[]}ingestQueryResultsFromServer(v,y){this.optimisticUpdates=this.optimisticUpdates.filter(Y=>!y.has(Y.mutationId));const A=this.queryResults;this.queryResults=new Map(v);const V=new Ov(this.queryResults);for(const Y of this.optimisticUpdates)Y.update(V);const B=[];for(const[Y,et]of this.queryResults){const J=A.get(Y);(J===void 0||J.result!==et.result)&&B.push(Y)}return B}applyOptimisticUpdate(v,y){this.optimisticUpdates.push({update:v,mutationId:y});const A=new Ov(this.queryResults);return v(A),A.modifiedQueries}queryResult(v){const y=this.queryResults.get(v);if(y===void 0)return;const A=y.result;if(A!==void 0){if(A.success)return A.value;throw A.errorData!==void 0?mO(A,new op(zm("query",y.udfPath,A))):new Error(zm("query",y.udfPath,A))}}hasQueryResult(v){return this.queryResults.get(v)!==void 0}queryLogs(v){var A;const y=this.queryResults.get(v);return(A=y==null?void 0:y.result)==null?void 0:A.logLines}}var Fz=Object.defineProperty,Gz=(S,v,y)=>v in S?Fz(S,v,{enumerable:!0,configurable:!0,writable:!0,value:y}):S[v]=y,iO=(S,v,y)=>Gz(S,typeof v!="symbol"?v+"":v,y);class ds{constructor(v,y){iO(this,"low"),iO(this,"high"),iO(this,"__isUnsignedLong__"),this.low=v|0,this.high=y|0,this.__isUnsignedLong__=!0}static isLong(v){return(v&&v.__isUnsignedLong__)===!0}static fromBytesLE(v){return new ds(v[0]|v[1]<<8|v[2]<<16|v[3]<<24,v[4]|v[5]<<8|v[6]<<16|v[7]<<24)}toBytesLE(){const v=this.high,y=this.low;return[y&255,y>>>8&255,y>>>16&255,y>>>24,v&255,v>>>8&255,v>>>16&255,v>>>24]}static fromNumber(v){return isNaN(v)||v<0?oj:v>=Hz?Wz:new ds(v%Cv|0,v/Cv|0)}toString(){return(BigInt(this.high)*BigInt(Cv)+BigInt(this.low)).toString()}equals(v){return ds.isLong(v)||(v=ds.fromValue(v)),this.high>>>31===1&&v.high>>>31===1?!1:this.high===v.high&&this.low===v.low}notEquals(v){return!this.equals(v)}comp(v){return ds.isLong(v)||(v=ds.fromValue(v)),this.equals(v)?0:v.high>>>0>this.high>>>0||v.high===this.high&&v.low>>>0>this.low>>>0?-1:1}lessThanOrEqual(v){return this.comp(v)<=0}static fromValue(v){return typeof v=="number"?ds.fromNumber(v):new ds(v.low,v.high)}}const oj=new ds(0,0),cj=65536,Cv=cj*cj,Hz=Cv*Cv,Wz=new ds(-1,-1);var zz=Object.defineProperty,qz=(S,v,y)=>v in S?zz(S,v,{enumerable:!0,configurable:!0,writable:!0,value:y}):S[v]=y,wb=(S,v,y)=>qz(S,typeof v!="symbol"?v+"":v,y);class lj{constructor(v,y){wb(this,"version"),wb(this,"remoteQuerySet"),wb(this,"queryPath"),wb(this,"logger"),this.version={querySet:0,ts:ds.fromNumber(0),identity:0},this.remoteQuerySet=new Map,this.queryPath=v,this.logger=y}transition(v){const y=v.startVersion;if(this.version.querySet!==y.querySet||this.version.ts.notEquals(y.ts)||this.version.identity!==y.identity)throw new Error(`Invalid start version: ${y.ts.toString()}:${y.querySet}`);for(const A of v.modifications)switch(A.type){case"QueryUpdated":{const V=this.queryPath(A.queryId);if(V)for(const Y of A.logLines)du(this.logger,"info","query",V,Y);const B=xo(A.value??null);this.remoteQuerySet.set(A.queryId,{success:!0,value:B,logLines:A.logLines});break}case"QueryFailed":{const V=this.queryPath(A.queryId);if(V)for(const Y of A.logLines)du(this.logger,"info","query",V,Y);const{errorData:B}=A;this.remoteQuerySet.set(A.queryId,{success:!1,errorMessage:A.errorMessage,errorData:B!==void 0?xo(B):void 0,logLines:A.logLines});break}case"QueryRemoved":{this.remoteQuerySet.delete(A.queryId);break}default:throw new Error(`Invalid modification ${A.type}`)}this.version=v.endVersion}remoteQueryResults(){return this.remoteQuerySet}timestamp(){return this.version.ts}}function rO(S){const v=Av(S);return ds.fromBytesLE(Array.from(v))}function Kz(S){const v=new Uint8Array(S.toBytesLE());return wv(v)}function Yz(S){switch(S.type){case"FatalError":case"AuthError":case"ActionResponse":case"Ping":return{...S};case"MutationResponse":return S.success?{...S,ts:rO(S.ts)}:{...S};case"Transition":return{...S,startVersion:{...S.startVersion,ts:rO(S.startVersion.ts)},endVersion:{...S.endVersion,ts:rO(S.endVersion.ts)}}}}function Xz(S){switch(S.type){case"Authenticate":case"ModifyQuerySet":case"Mutation":case"Action":case"Event":return{...S};case"Connect":return S.maxObservedTimestamp!==void 0?{...S,maxObservedTimestamp:Kz(S.maxObservedTimestamp)}:{...S,maxObservedTimestamp:void 0}}}var Qz=Object.defineProperty,Jz=(S,v,y)=>v in S?Qz(S,v,{enumerable:!0,configurable:!0,writable:!0,value:y}):S[v]=y,ua=(S,v,y)=>Jz(S,typeof v!="symbol"?v+"":v,y);const Zz=1e3,$z=1001,tq=1005,eq=4040;class nq{constructor(v,y,A,V){ua(this,"socket"),ua(this,"connectionCount"),ua(this,"_hasEverConnected",!1),ua(this,"lastCloseReason"),ua(this,"initialBackoff"),ua(this,"maxBackoff"),ua(this,"retries"),ua(this,"serverInactivityThreshold"),ua(this,"reconnectDueToServerInactivityTimeout"),ua(this,"uri"),ua(this,"onOpen"),ua(this,"onResume"),ua(this,"onMessage"),ua(this,"webSocketConstructor"),ua(this,"logger"),this.webSocketConstructor=A,this.socket={state:"disconnected"},this.connectionCount=0,this.lastCloseReason="InitialConnect",this.initialBackoff=100,this.maxBackoff=16e3,this.retries=0,this.serverInactivityThreshold=3e4,this.reconnectDueToServerInactivityTimeout=null,this.uri=v,this.onOpen=y.onOpen,this.onResume=y.onResume,this.onMessage=y.onMessage,this.logger=V,this.connect()}setSocketState(v){this.socket=v,this._logVerbose(`socket state changed: ${this.socket.state}, paused: ${"paused"in this.socket?this.socket.paused:void 0}`)}connect(){if(this.socket.state==="terminated")return;if(this.socket.state!=="disconnected"&&this.socket.state!=="stopped")throw new Error("Didn't start connection from disconnected state: "+this.socket.state);const v=new this.webSocketConstructor(this.uri);this._logVerbose("constructed WebSocket"),this.setSocketState({state:"connecting",ws:v,paused:"no"}),this.resetServerInactivityTimeout(),v.onopen=()=>{if(this.logger.logVerbose("begin ws.onopen"),this.socket.state!=="connecting")throw new Error("onopen called with socket not in connecting state");this.setSocketState({state:"ready",ws:v,paused:this.socket.paused==="yes"?"uninitialized":"no"}),this.resetServerInactivityTimeout(),this.socket.paused==="no"&&(this._hasEverConnected=!0,this.onOpen({connectionCount:this.connectionCount,lastCloseReason:this.lastCloseReason})),this.lastCloseReason!=="InitialConnect"&&this.logger.log("WebSocket reconnected"),this.connectionCount+=1,this.lastCloseReason=null},v.onerror=y=>{const A=y.message;this.logger.log(`WebSocket error: ${A}`)},v.onmessage=y=>{this.resetServerInactivityTimeout();const A=Yz(JSON.parse(y.data));this._logVerbose(`received ws message with type ${A.type}`),this.onMessage(A).hasSyncedPastLastReconnect&&(this.retries=0)},v.onclose=y=>{if(this._logVerbose("begin ws.onclose"),this.lastCloseReason===null&&(this.lastCloseReason=y.reason??"OnCloseInvoked"),y.code!==Zz&&y.code!==$z&&y.code!==tq&&y.code!==eq){let A=`WebSocket closed with code ${y.code}`;y.reason&&(A+=`: ${y.reason}`),this.logger.log(A)}this.scheduleReconnect()}}socketState(){return this.socket.state}sendMessage(v){const y={type:v.type,...v.type==="Authenticate"&&v.tokenType==="User"?{value:`...${v.value.slice(-7)}`}:{}};if(this.socket.state==="ready"&&this.socket.paused==="no"){const A=Xz(v),V=JSON.stringify(A);try{this.socket.ws.send(V)}catch(B){this.logger.log(`Failed to send message on WebSocket, reconnecting: ${B}`),this.closeAndReconnect("FailedToSendMessage")}return this._logVerbose(`sent message with type ${v.type}: ${JSON.stringify(y)}`),!0}return this._logVerbose(`message not sent (socket state: ${this.socket.state}, paused: ${"paused"in this.socket?this.socket.paused:void 0}): ${JSON.stringify(y)}`),!1}resetServerInactivityTimeout(){this.socket.state!=="terminated"&&(this.reconnectDueToServerInactivityTimeout!==null&&(clearTimeout(this.reconnectDueToServerInactivityTimeout),this.reconnectDueToServerInactivityTimeout=null),this.reconnectDueToServerInactivityTimeout=setTimeout(()=>{this.closeAndReconnect("InactiveServer")},this.serverInactivityThreshold))}scheduleReconnect(){this.socket={state:"disconnected"};const v=this.nextBackoff();this.logger.log(`Attempting reconnect in ${v}ms`),setTimeout(()=>this.connect(),v)}closeAndReconnect(v){switch(this._logVerbose(`begin closeAndReconnect with reason ${v}`),this.socket.state){case"disconnected":case"terminated":case"stopped":return;case"connecting":case"ready":{this.lastCloseReason=v,this.close(),this.scheduleReconnect();return}default:this.socket}}close(){switch(this.socket.state){case"disconnected":case"terminated":case"stopped":return Promise.resolve();case"connecting":{const v=this.socket.ws;return new Promise(y=>{v.onclose=()=>{this._logVerbose("Closed after connecting"),y()},v.onopen=()=>{this._logVerbose("Opened after connecting"),v.close()}})}case"ready":{this._logVerbose("ws.close called");const v=this.socket.ws,y=new Promise(A=>{v.onclose=()=>{A()}});return v.close(),y}default:return this.socket,Promise.resolve()}}terminate(){switch(this.reconnectDueToServerInactivityTimeout&&clearTimeout(this.reconnectDueToServerInactivityTimeout),this.socket.state){case"terminated":case"stopped":case"disconnected":case"connecting":case"ready":{const v=this.close();return this.setSocketState({state:"terminated"}),v}default:throw this.socket,new Error(`Invalid websocket state: ${this.socket.state}`)}}stop(){switch(this.socket.state){case"terminated":return Promise.resolve();case"connecting":case"stopped":case"disconnected":case"ready":{const v=this.close();return this.socket={state:"stopped"},v}default:return this.socket,Promise.resolve()}}tryRestart(){switch(this.socket.state){case"stopped":break;case"terminated":case"connecting":case"ready":case"disconnected":this.logger.logVerbose("Restart called without stopping first");return;default:this.socket}this.connect()}pause(){switch(this.socket.state){case"disconnected":case"stopped":case"terminated":return;case"connecting":case"ready":{this.socket={...this.socket,paused:"yes"};return}default:{this.socket;return}}}resume(){switch(this.socket.state){case"connecting":this.socket={...this.socket,paused:"no"};return;case"ready":this.socket.paused==="uninitialized"?(this.socket={...this.socket,paused:"no"},this.onOpen({connectionCount:this.connectionCount,lastCloseReason:this.lastCloseReason})):this.socket.paused==="yes"&&(this.socket={...this.socket,paused:"no"},this.onResume());return;case"terminated":case"stopped":case"disconnected":return;default:this.socket}this.connect()}connectionState(){return{isConnected:this.socket.state==="ready",hasEverConnected:this._hasEverConnected,connectionCount:this.connectionCount,connectionRetries:this.retries}}_logVerbose(v){this.logger.logVerbose(v)}nextBackoff(){const v=this.initialBackoff*Math.pow(2,this.retries);this.retries+=1;const y=Math.min(v,this.maxBackoff),A=y*(Math.random()-.5);return y+A}}function iq(){return rq()}function rq(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,S=>{const v=Math.random()*16|0;return(S==="x"?v:v&3|8).toString(16)})}class yv extends Error{}yv.prototype.name="InvalidTokenError";function aq(S){return decodeURIComponent(atob(S).replace(/(.)/g,(v,y)=>{let A=y.charCodeAt(0).toString(16).toUpperCase();return A.length<2&&(A="0"+A),"%"+A}))}function sq(S){let v=S.replace(/-/g,"+").replace(/_/g,"/");switch(v.length%4){case 0:break;case 2:v+="==";break;case 3:v+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return aq(v)}catch{return atob(v)}}function oq(S,v){if(typeof S!="string")throw new yv("Invalid token specified: must be a string");v||(v={});const y=v.header===!0?0:1,A=S.split(".")[y];if(typeof A!="string")throw new yv(`Invalid token specified: missing part #${y+1}`);let V;try{V=sq(A)}catch(B){throw new yv(`Invalid token specified: invalid base64 for part #${y+1} (${B.message})`)}try{return JSON.parse(V)}catch(B){throw new yv(`Invalid token specified: invalid json for part #${y+1} (${B.message})`)}}var cq=Object.defineProperty,lq=(S,v,y)=>v in S?cq(S,v,{enumerable:!0,configurable:!0,writable:!0,value:y}):S[v]=y,Ws=(S,v,y)=>lq(S,typeof v!="symbol"?v+"":v,y);const dq=20*24*60*60*1e3,dj=2;class uq{constructor(v,y,A){Ws(this,"authState",{state:"noAuth"}),Ws(this,"configVersion",0),Ws(this,"syncState"),Ws(this,"authenticate"),Ws(this,"stopSocket"),Ws(this,"tryRestartSocket"),Ws(this,"pauseSocket"),Ws(this,"resumeSocket"),Ws(this,"clearAuth"),Ws(this,"logger"),Ws(this,"refreshTokenLeewaySeconds"),Ws(this,"tokenConfirmationAttempts",0),this.syncState=v,this.authenticate=y.authenticate,this.stopSocket=y.stopSocket,this.tryRestartSocket=y.tryRestartSocket,this.pauseSocket=y.pauseSocket,this.resumeSocket=y.resumeSocket,this.clearAuth=y.clearAuth,this.logger=A.logger,this.refreshTokenLeewaySeconds=A.refreshTokenLeewaySeconds}async setConfig(v,y){this.resetAuthState(),this._logVerbose("pausing WS for auth token fetch"),this.pauseSocket();const A=await this.fetchTokenAndGuardAgainstRace(v,{forceRefreshToken:!1});A.isFromOutdatedConfig||(A.value?(this.setAuthState({state:"waitingForServerConfirmationOfCachedToken",config:{fetchToken:v,onAuthChange:y},hasRetried:!1}),this.authenticate(A.value)):(this.setAuthState({state:"initialRefetch",config:{fetchToken:v,onAuthChange:y}}),await this.refetchToken()),this._logVerbose("resuming WS after auth token fetch"),this.resumeSocket())}onTransition(v){if(this.syncState.isCurrentOrNewerAuthVersion(v.endVersion.identity)&&!(v.endVersion.identity<=v.startVersion.identity)){if(this.authState.state==="waitingForServerConfirmationOfCachedToken"){this._logVerbose("server confirmed auth token is valid"),this.refetchToken(),this.authState.config.onAuthChange(!0);return}this.authState.state==="waitingForServerConfirmationOfFreshToken"&&(this._logVerbose("server confirmed new auth token is valid"),this.scheduleTokenRefetch(this.authState.token),this.tokenConfirmationAttempts=0,this.authState.hadAuth||this.authState.config.onAuthChange(!0))}}onAuthError(v){if(v.authUpdateAttempted===!1&&(this.authState.state==="waitingForServerConfirmationOfFreshToken"||this.authState.state==="waitingForServerConfirmationOfCachedToken")){this._logVerbose("ignoring non-auth token expired error");return}const{baseVersion:y}=v;if(!this.syncState.isCurrentOrNewerAuthVersion(y+1)){this._logVerbose("ignoring auth error for previous auth attempt");return}this.tryToReauthenticate(v)}async tryToReauthenticate(v){if(this._logVerbose(`attempting to reauthenticate: ${v.error}`),this.authState.state==="noAuth"||this.authState.state==="waitingForServerConfirmationOfFreshToken"&&this.tokenConfirmationAttempts>=dj){this.logger.error(`Failed to authenticate: "${v.error}", check your server auth config`),this.syncState.hasAuth()&&this.syncState.clearAuth(),this.authState.state!=="noAuth"&&this.setAndReportAuthFailed(this.authState.config.onAuthChange);return}this.authState.state==="waitingForServerConfirmationOfFreshToken"&&(this.tokenConfirmationAttempts++,this._logVerbose(`retrying reauthentication, ${dj-this.tokenConfirmationAttempts} attempts remaining`)),await this.stopSocket();const y=await this.fetchTokenAndGuardAgainstRace(this.authState.config.fetchToken,{forceRefreshToken:!0});y.isFromOutdatedConfig||(y.value&&this.syncState.isNewAuth(y.value)?(this.authenticate(y.value),this.setAuthState({state:"waitingForServerConfirmationOfFreshToken",config:this.authState.config,token:y.value,hadAuth:this.authState.state==="notRefetching"||this.authState.state==="waitingForScheduledRefetch"})):(this._logVerbose("reauthentication failed, could not fetch a new token"),this.syncState.hasAuth()&&this.syncState.clearAuth(),this.setAndReportAuthFailed(this.authState.config.onAuthChange)),this.tryRestartSocket())}async refetchToken(){if(this.authState.state==="noAuth")return;this._logVerbose("refetching auth token");const v=await this.fetchTokenAndGuardAgainstRace(this.authState.config.fetchToken,{forceRefreshToken:!0});v.isFromOutdatedConfig||(v.value?this.syncState.isNewAuth(v.value)?(this.setAuthState({state:"waitingForServerConfirmationOfFreshToken",hadAuth:this.syncState.hasAuth(),token:v.value,config:this.authState.config}),this.authenticate(v.value)):this.setAuthState({state:"notRefetching",config:this.authState.config}):(this._logVerbose("refetching token failed"),this.syncState.hasAuth()&&this.clearAuth(),this.setAndReportAuthFailed(this.authState.config.onAuthChange)),this._logVerbose("restarting WS after auth token fetch (if currently stopped)"),this.tryRestartSocket())}scheduleTokenRefetch(v){if(this.authState.state==="noAuth")return;const y=this.decodeToken(v);if(!y){this.logger.error("Auth token is not a valid JWT, cannot refetch the token");return}const{iat:A,exp:V}=y;if(!A||!V){this.logger.error("Auth token does not have required fields, cannot refetch the token");return}const B=V-A;if(B<=2){this.logger.error("Auth token does not live long enough, cannot refetch the token");return}let Y=Math.min(dq,(B-this.refreshTokenLeewaySeconds)*1e3);Y<=0&&(this.logger.warn(`Refetching auth token immediately, configured leeway ${this.refreshTokenLeewaySeconds}s is larger than the token's lifetime ${B}s`),Y=0);const et=setTimeout(()=>{this._logVerbose("running scheduled token refetch"),this.refetchToken()},Y);this.setAuthState({state:"waitingForScheduledRefetch",refetchTokenTimeoutId:et,config:this.authState.config}),this._logVerbose(`scheduled preemptive auth token refetching in ${Y}ms`)}async fetchTokenAndGuardAgainstRace(v,y){const A=++this.configVersion;this._logVerbose(`fetching token with config version ${A}`);const V=await v(y);return this.configVersion!==A?(this._logVerbose(`stale config version, expected ${A}, got ${this.configVersion}`),{isFromOutdatedConfig:!0}):{isFromOutdatedConfig:!1,value:V}}stop(){this.resetAuthState(),this.configVersion++,this._logVerbose(`config version bumped to ${this.configVersion}`)}setAndReportAuthFailed(v){v(!1),this.resetAuthState()}resetAuthState(){this.setAuthState({state:"noAuth"})}setAuthState(v){const y=v.state==="waitingForServerConfirmationOfFreshToken"?{hadAuth:v.hadAuth,state:v.state,token:`...${v.token.slice(-7)}`}:{state:v.state};switch(this._logVerbose(`setting auth state to ${JSON.stringify(y)}`),v.state){case"waitingForScheduledRefetch":case"notRefetching":case"noAuth":this.tokenConfirmationAttempts=0;break}this.authState.state==="waitingForScheduledRefetch"&&(clearTimeout(this.authState.refetchTokenTimeoutId),this.syncState.markAuthCompletion()),this.authState=v}decodeToken(v){try{return oq(v)}catch(y){return this._logVerbose(`Error decoding token: ${y instanceof Error?y.message:"Unknown error"}`),null}}_logVerbose(v){this.logger.logVerbose(`${v} [v${this.configVersion}]`)}}const hq=["convexClientConstructed","convexWebSocketOpen","convexFirstMessageReceived"];function pq(S,v){const y={sessionId:v};typeof performance>"u"||!performance.mark||performance.mark(S,{detail:y})}function fq(S){let v=S.name.slice(6);return v=v.charAt(0).toLowerCase()+v.slice(1),{name:v,startTime:S.startTime}}function mq(S){if(typeof performance>"u"||!performance.getEntriesByName)return[];const v=[];for(const y of hq){const A=performance.getEntriesByName(y).filter(V=>V.entryType==="mark").filter(V=>V.detail.sessionId===S);v.push(...A)}return v.map(fq)}var _q=Object.defineProperty,Eq=(S,v,y)=>v in S?_q(S,v,{enumerable:!0,configurable:!0,writable:!0,value:y}):S[v]=y,Jr=(S,v,y)=>Eq(S,typeof v!="symbol"?v+"":v,y);class gq{constructor(v,y,A){if(Jr(this,"address"),Jr(this,"state"),Jr(this,"requestManager"),Jr(this,"webSocketManager"),Jr(this,"authenticationManager"),Jr(this,"remoteQuerySet"),Jr(this,"optimisticQueryResults"),Jr(this,"_transitionHandlerCounter",0),Jr(this,"_nextRequestId"),Jr(this,"_onTransitionFns",new Map),Jr(this,"_sessionId"),Jr(this,"firstMessageReceived",!1),Jr(this,"debug"),Jr(this,"logger"),Jr(this,"maxObservedTimestamp"),Jr(this,"mark",vt=>{this.debug&&pq(vt,this.sessionId)}),typeof v=="object")throw new Error("Passing a ClientConfig object is no longer supported. Pass the URL of the Convex deployment as a string directly.");(A==null?void 0:A.skipConvexDeploymentUrlCheck)!==!0&&Pj(v),A={...A};const V=A.authRefreshTokenLeewaySeconds??2;let B=A.webSocketConstructor;if(!B&&typeof WebSocket>"u")throw new Error("No WebSocket global variable defined! To use Convex in an environment without WebSocket try the HTTP client: https://docs.convex.dev/api/classes/browser.ConvexHttpClient");B=B||WebSocket,this.debug=A.reportDebugInfoToConvex??!1,this.address=v,this.logger=A.logger===!1?CO({verbose:A.verbose??!1}):A.logger!==!0&&A.logger?A.logger:bO({verbose:A.verbose??!1});const Y=v.search("://");if(Y===-1)throw new Error("Provided address was not an absolute URL.");const et=v.substring(Y+3),J=v.substring(0,Y);let Q;if(J==="http")Q="ws";else if(J==="https")Q="wss";else throw new Error(`Unknown parent protocol ${J}`);const ht=`${Q}://${et}/api/${ap}/sync`;this.state=new Oz,this.remoteQuerySet=new lj(vt=>this.state.queryPath(vt),this.logger),this.requestManager=new Pz(this.logger),this.authenticationManager=new uq(this.state,{authenticate:vt=>{const Ft=this.state.setAuth(vt);return this.webSocketManager.sendMessage(Ft),Ft.baseVersion},stopSocket:()=>this.webSocketManager.stop(),tryRestartSocket:()=>this.webSocketManager.tryRestart(),pauseSocket:()=>{this.webSocketManager.pause(),this.state.pause()},resumeSocket:()=>this.webSocketManager.resume(),clearAuth:()=>{this.clearAuth()}},{logger:this.logger,refreshTokenLeewaySeconds:V}),this.optimisticQueryResults=new Bz,this.addOnTransitionHandler(vt=>{y(vt.queries.map(Ft=>Ft.token))}),this._nextRequestId=0,this._sessionId=iq();const{unsavedChangesWarning:Et}=A;if(typeof window>"u"||typeof window.addEventListener>"u"){if(Et===!0)throw new Error("unsavedChangesWarning requested, but window.addEventListener not found! Remove {unsavedChangesWarning: true} from Convex client options.")}else Et!==!1&&window.addEventListener("beforeunload",vt=>{if(this.requestManager.hasIncompleteRequests()){vt.preventDefault();const Ft="Are you sure you want to leave? Your changes may not be saved.";return(vt||window.event).returnValue=Ft,Ft}});this.webSocketManager=new nq(ht,{onOpen:vt=>{this.mark("convexWebSocketOpen"),this.webSocketManager.sendMessage({...vt,type:"Connect",sessionId:this._sessionId,maxObservedTimestamp:this.maxObservedTimestamp});const Ft=new Set(this.remoteQuerySet.remoteQueryResults().keys());this.remoteQuerySet=new lj(Ue=>this.state.queryPath(Ue),this.logger);const[xt,Oe]=this.state.restart(Ft);Oe&&this.webSocketManager.sendMessage(Oe),this.webSocketManager.sendMessage(xt);for(const Ue of this.requestManager.restart())this.webSocketManager.sendMessage(Ue)},onResume:()=>{const[vt,Ft]=this.state.resume();Ft&&this.webSocketManager.sendMessage(Ft),vt&&this.webSocketManager.sendMessage(vt);for(const xt of this.requestManager.resume())this.webSocketManager.sendMessage(xt)},onMessage:vt=>{switch(this.firstMessageReceived||(this.firstMessageReceived=!0,this.mark("convexFirstMessageReceived"),this.reportMarks()),vt.type){case"Transition":{this.observedTimestamp(vt.endVersion.ts),this.authenticationManager.onTransition(vt),this.remoteQuerySet.transition(vt),this.state.transition(vt);const Ft=this.requestManager.removeCompleted(this.remoteQuerySet.timestamp());this.notifyOnQueryResultChanges(Ft);break}case"MutationResponse":{vt.success&&this.observedTimestamp(vt.ts);const Ft=this.requestManager.onResponse(vt);Ft!==null&&this.notifyOnQueryResultChanges(new Map([[Ft.requestId,Ft.result]]));break}case"ActionResponse":{this.requestManager.onResponse(vt);break}case"AuthError":{this.authenticationManager.onAuthError(vt);break}case"FatalError":{const Ft=Az(this.logger,vt.error);throw this.webSocketManager.terminate(),Ft}}return{hasSyncedPastLastReconnect:this.hasSyncedPastLastReconnect()}}},B,this.logger),this.mark("convexClientConstructed")}hasSyncedPastLastReconnect(){return this.requestManager.hasSyncedPastLastReconnect()||this.state.hasSyncedPastLastReconnect()}observedTimestamp(v){(this.maxObservedTimestamp===void 0||this.maxObservedTimestamp.lessThanOrEqual(v))&&(this.maxObservedTimestamp=v)}getMaxObservedTimestamp(){return this.maxObservedTimestamp}notifyOnQueryResultChanges(v){const y=this.remoteQuerySet.remoteQueryResults(),A=new Map;for(const[B,Y]of y){const et=this.state.queryToken(B);if(et!==null){const J={result:Y,udfPath:this.state.queryPath(B),args:this.state.queryArgs(B)};A.set(et,J)}}const V=this.optimisticQueryResults.ingestQueryResultsFromServer(A,new Set(v.keys()));this.handleTransition({queries:V.map(B=>({token:B,modification:{kind:"Updated",result:A.get(B).result}})),reflectedMutations:Array.from(v).map(([B,Y])=>({requestId:B,result:Y})),timestamp:this.remoteQuerySet.timestamp()})}handleTransition(v){for(const y of this._onTransitionFns.values())y(v)}addOnTransitionHandler(v){const y=this._transitionHandlerCounter++;return this._onTransitionFns.set(y,v),()=>this._onTransitionFns.delete(y)}setAuth(v,y){this.authenticationManager.setConfig(v,y)}hasAuth(){return this.state.hasAuth()}setAdminAuth(v,y){const A=this.state.setAdminAuth(v,y);this.webSocketManager.sendMessage(A)}clearAuth(){const v=this.state.clearAuth();this.webSocketManager.sendMessage(v)}subscribe(v,y,A){const V=Ma(y),{modification:B,queryToken:Y,unsubscribe:et}=this.state.subscribe(v,V,A==null?void 0:A.journal,A==null?void 0:A.componentPath);return B!==null&&this.webSocketManager.sendMessage(B),{queryToken:Y,unsubscribe:()=>{const J=et();J&&this.webSocketManager.sendMessage(J)}}}localQueryResult(v,y){const A=Ma(y),V=cp(v,A);return this.optimisticQueryResults.queryResult(V)}localQueryResultByToken(v){return this.optimisticQueryResults.queryResult(v)}hasLocalQueryResultByToken(v){return this.optimisticQueryResults.hasQueryResult(v)}localQueryLogs(v,y){const A=Ma(y),V=cp(v,A);return this.optimisticQueryResults.queryLogs(V)}queryJournal(v,y){const A=Ma(y),V=cp(v,A);return this.state.queryJournal(V)}connectionState(){const v=this.webSocketManager.connectionState();return{hasInflightRequests:this.requestManager.hasInflightRequests(),isWebSocketConnected:v.isConnected,hasEverConnected:v.hasEverConnected,connectionCount:v.connectionCount,connectionRetries:v.connectionRetries,timeOfOldestInflightRequest:this.requestManager.timeOfOldestInflightRequest(),inflightMutations:this.requestManager.inflightMutations(),inflightActions:this.requestManager.inflightActions()}}async mutation(v,y,A){const V=await this.mutationInternal(v,y,A);if(!V.success)throw V.errorData!==void 0?mO(V,new op(zm("mutation",v,V))):new Error(zm("mutation",v,V));return V.value}async mutationInternal(v,y,A,V){const{mutationPromise:B}=this.enqueueMutation(v,y,A,V);return B}enqueueMutation(v,y,A,V){const B=Ma(y);this.tryReportLongDisconnect();const Y=this.nextRequestId;if(this._nextRequestId++,A!==void 0){const ht=A.optimisticUpdate;if(ht!==void 0){const Et=xt=>{ht(xt,B)},Ft=this.optimisticQueryResults.applyOptimisticUpdate(Et,Y).map(xt=>{const Oe=this.localQueryResultByToken(xt);return{token:xt,modification:{kind:"Updated",result:Oe===void 0?void 0:{success:!0,value:Oe,logLines:[]}}}});this.handleTransition({queries:Ft,reflectedMutations:[],timestamp:this.remoteQuerySet.timestamp()})}}const et={type:"Mutation",requestId:Y,udfPath:v,componentPath:V,args:[Ks(B)]},J=this.webSocketManager.sendMessage(et),Q=this.requestManager.request(et,J);return{requestId:Y,mutationPromise:Q}}async action(v,y){const A=await this.actionInternal(v,y);if(!A.success)throw A.errorData!==void 0?mO(A,new op(zm("action",v,A))):new Error(zm("action",v,A));return A.value}async actionInternal(v,y,A){const V=Ma(y),B=this.nextRequestId;this._nextRequestId++,this.tryReportLongDisconnect();const Y={type:"Action",requestId:B,udfPath:v,componentPath:A,args:[Ks(V)]},et=this.webSocketManager.sendMessage(Y);return this.requestManager.request(Y,et)}async close(){return this.authenticationManager.stop(),this.webSocketManager.terminate()}get url(){return this.address}get nextRequestId(){return this._nextRequestId}get sessionId(){return this._sessionId}reportMarks(){if(this.debug){const v=mq(this.sessionId);this.webSocketManager.sendMessage({type:"Event",eventType:"ClientConnect",event:v})}}tryReportLongDisconnect(){if(!this.debug)return;const v=this.connectionState().timeOfOldestInflightRequest;if(v===null||Date.now()-v.getTime()<=60*1e3)return;const y=`${this.address}/api/debug_event`;fetch(y,{method:"POST",headers:{"Content-Type":"application/json","Convex-Client":`npm-${ap}`},body:JSON.stringify({event:"LongWebsocketDisconnect"})}).then(A=>{A.ok||this.logger.warn("Analytics request failed with response:",A.body)}).catch(A=>{this.logger.warn("Analytics response failed with error:",A)})}}var vq=Object.defineProperty,Sq=(S,v,y)=>v in S?vq(S,v,{enumerable:!0,configurable:!0,writable:!0,value:y}):S[v]=y,ip=(S,v,y)=>Sq(S,typeof v!="symbol"?v+"":v,y);const Ib=560;class Tq{constructor(v,y){if(ip(this,"address"),ip(this,"auth"),ip(this,"adminAuth"),ip(this,"encodedTsPromise"),ip(this,"debug"),ip(this,"fetchOptions"),ip(this,"logger"),typeof y=="boolean")throw new Error("skipConvexDeploymentUrlCheck as the second argument is no longer supported. Please pass an options object, `{ skipConvexDeploymentUrlCheck: true }`.");(y??{}).skipConvexDeploymentUrlCheck!==!0&&Pj(v),this.logger=(y==null?void 0:y.logger)===!1?CO({verbose:!1}):(y==null?void 0:y.logger)!==!0&&(y!=null&&y.logger)?y.logger:bO({verbose:!1}),this.address=v,this.debug=!0}backendUrl(){return`${this.address}/api`}get url(){return this.address}setAuth(v){this.clearAuth(),this.auth=v}setAdminAuth(v,y){if(this.clearAuth(),y!==void 0){const A=new TextEncoder().encode(JSON.stringify(y)),V=btoa(String.fromCodePoint(...A));this.adminAuth=`${v}:${V}`}else this.adminAuth=v}clearAuth(){this.auth=void 0,this.adminAuth=void 0}setDebug(v){this.debug=v}setFetchOptions(v){this.fetchOptions=v}async consistentQuery(v,...y){const A=Ma(y[0]),V=this.getTimestamp();return await this.queryInner(v,A,{timestampPromise:V})}async getTimestamp(){return this.encodedTsPromise?this.encodedTsPromise:this.encodedTsPromise=this.getTimestampInner()}async getTimestampInner(){const v=fetch,y={"Content-Type":"application/json","Convex-Client":`npm-${ap}`},A=await v(`${this.address}/api/query_ts`,{...this.fetchOptions,method:"POST",headers:y});if(!A.ok)throw new Error(await A.text());const{ts:V}=await A.json();return V}async query(v,...y){const A=Ma(y[0]);return await this.queryInner(v,A,{})}async queryInner(v,y,A){const V=Lr(v),B=[Ks(y)],Y={"Content-Type":"application/json","Convex-Client":`npm-${ap}`};this.adminAuth?Y.Authorization=`Convex ${this.adminAuth}`:this.auth&&(Y.Authorization=`Bearer ${this.auth}`);const et=fetch,J=A.timestampPromise?await A.timestampPromise:void 0,Q=JSON.stringify({path:V,format:"convex_encoded_json",args:B,...J?{ts:J}:{}}),ht=J?`${this.address}/api/query_at_ts`:`${this.address}/api/query`,Et=await et(ht,{...this.fetchOptions,body:Q,method:"POST",headers:Y});if(!Et.ok&&Et.status!==Ib)throw new Error(await Et.text());const vt=await Et.json();if(this.debug)for(const Ft of vt.logLines??[])du(this.logger,"info","query",V,Ft);switch(vt.status){case"success":return xo(vt.value);case"error":throw vt.errorData!==void 0?Ob(vt.errorData,new op(vt.errorMessage)):new Error(vt.errorMessage);default:throw new Error(`Invalid response: ${JSON.stringify(vt)}`)}}async mutation(v,...y){const A=Ma(y[0]),V=Lr(v),B=JSON.stringify({path:V,format:"convex_encoded_json",args:[Ks(A)]}),Y={"Content-Type":"application/json","Convex-Client":`npm-${ap}`};this.adminAuth?Y.Authorization=`Convex ${this.adminAuth}`:this.auth&&(Y.Authorization=`Bearer ${this.auth}`);const J=await fetch(`${this.address}/api/mutation`,{...this.fetchOptions,body:B,method:"POST",headers:Y});if(!J.ok&&J.status!==Ib)throw new Error(await J.text());const Q=await J.json();if(this.debug)for(const ht of Q.logLines??[])du(this.logger,"info","mutation",V,ht);switch(Q.status){case"success":return xo(Q.value);case"error":throw Q.errorData!==void 0?Ob(Q.errorData,new op(Q.errorMessage)):new Error(Q.errorMessage);default:throw new Error(`Invalid response: ${JSON.stringify(Q)}`)}}async action(v,...y){const A=Ma(y[0]),V=Lr(v),B=JSON.stringify({path:V,format:"convex_encoded_json",args:[Ks(A)]}),Y={"Content-Type":"application/json","Convex-Client":`npm-${ap}`};this.adminAuth?Y.Authorization=`Convex ${this.adminAuth}`:this.auth&&(Y.Authorization=`Bearer ${this.auth}`);const J=await fetch(`${this.address}/api/action`,{...this.fetchOptions,body:B,method:"POST",headers:Y});if(!J.ok&&J.status!==Ib)throw new Error(await J.text());const Q=await J.json();if(this.debug)for(const ht of Q.logLines??[])du(this.logger,"info","action",V,ht);switch(Q.status){case"success":return xo(Q.value);case"error":throw Q.errorData!==void 0?Ob(Q.errorData,new op(Q.errorMessage)):new Error(Q.errorMessage);default:throw new Error(`Invalid response: ${JSON.stringify(Q)}`)}}async function(v,y,...A){const V=Ma(A[0]),B=typeof v=="string"?v:Lr(v),Y=JSON.stringify({componentPath:y,path:B,format:"convex_encoded_json",args:Ks(V)}),et={"Content-Type":"application/json","Convex-Client":`npm-${ap}`};this.adminAuth?et.Authorization=`Convex ${this.adminAuth}`:this.auth&&(et.Authorization=`Bearer ${this.auth}`);const Q=await fetch(`${this.address}/api/function`,{...this.fetchOptions,body:Y,method:"POST",headers:et});if(!Q.ok&&Q.status!==Ib)throw new Error(await Q.text());const ht=await Q.json();if(this.debug)for(const Et of ht.logLines??[])du(this.logger,"info","any",B,Et);switch(ht.status){case"success":return xo(ht.value);case"error":throw ht.errorData!==void 0?Ob(ht.errorData,new op(ht.errorMessage)):new Error(ht.errorMessage);default:throw new Error(`Invalid response: ${JSON.stringify(ht)}`)}}}function Ob(S,v){return v.data=xo(S),v}var Ot=yO();const kr=Fb(Ot);var yq=Object.defineProperty,Rq=(S,v,y)=>v in S?yq(S,v,{enumerable:!0,configurable:!0,writable:!0,value:y}):S[v]=y,lu=(S,v,y)=>Rq(S,typeof v!="symbol"?v+"":v,y);if(typeof kr>"u")throw new Error("Required dependency 'react' not found");function Gj(S,v,y){function A(V){return wq(V),v.mutation(S,V,{optimisticUpdate:y})}return A.withOptimisticUpdate=function(B){if(y!==void 0)throw new Error(`Already specified optimistic update for mutation ${Lr(S)}`);return Gj(S,v,B)},A}class bq{constructor(v,y){if(lu(this,"address"),lu(this,"cachedSync"),lu(this,"listeners"),lu(this,"options"),lu(this,"closed",!1),lu(this,"_logger"),lu(this,"adminAuth"),lu(this,"fakeUserIdentity"),v===void 0)throw new Error("No address provided to ConvexReactClient.\nIf trying to deploy to production, make sure to follow all the instructions found at https://docs.convex.dev/production/hosting/\nIf running locally, make sure to run `convex dev` and ensure the .env.local file is populated.");if(typeof v!="string")throw new Error(`ConvexReactClient requires a URL like 'https://happy-otter-123.convex.cloud', received something of type ${typeof v} instead.`);if(!v.includes("://"))throw new Error("Provided address was not an absolute URL.");this.address=v,this.listeners=new Map,this._logger=(y==null?void 0:y.logger)===!1?CO({verbose:(y==null?void 0:y.verbose)??!1}):(y==null?void 0:y.logger)!==!0&&(y!=null&&y.logger)?y.logger:bO({verbose:(y==null?void 0:y.verbose)??!1}),this.options={...y,logger:this._logger}}get sync(){if(this.closed)throw new Error("ConvexReactClient has already been closed.");return this.cachedSync?this.cachedSync:(this.cachedSync=new gq(this.address,v=>this.transition(v),this.options),this.adminAuth&&this.cachedSync.setAdminAuth(this.adminAuth,this.fakeUserIdentity),this.cachedSync)}setAuth(v,y){if(typeof v=="string")throw new Error("Passing a string to ConvexReactClient.setAuth is no longer supported, please upgrade to passing in an async function to handle reauthentication.");this.sync.setAuth(v,y??(()=>{}))}clearAuth(){this.sync.clearAuth()}setAdminAuth(v,y){if(this.adminAuth=v,this.fakeUserIdentity=y,this.closed)throw new Error("ConvexReactClient has already been closed.");this.cachedSync&&this.sync.setAdminAuth(v,y)}watchQuery(v,...y){const[A,V]=y,B=Lr(v);return{onUpdate:Y=>{const{queryToken:et,unsubscribe:J}=this.sync.subscribe(B,A,V),Q=this.listeners.get(et);return Q!==void 0?Q.add(Y):this.listeners.set(et,new Set([Y])),()=>{if(this.closed)return;const ht=this.listeners.get(et);ht.delete(Y),ht.size===0&&this.listeners.delete(et),J()}},localQueryResult:()=>{if(this.cachedSync)return this.cachedSync.localQueryResult(B,A)},localQueryLogs:()=>{if(this.cachedSync)return this.cachedSync.localQueryLogs(B,A)},journal:()=>{if(this.cachedSync)return this.cachedSync.queryJournal(B,A)}}}mutation(v,...y){const[A,V]=y,B=Lr(v);return this.sync.mutation(B,A,V)}action(v,...y){const A=Lr(v);return this.sync.action(A,...y)}query(v,...y){const A=this.watchQuery(v,...y),V=A.localQueryResult();return V!==void 0?Promise.resolve(V):new Promise((B,Y)=>{const et=A.onUpdate(()=>{et();try{B(A.localQueryResult())}catch(J){Y(J)}})})}connectionState(){return this.sync.connectionState()}get logger(){return this._logger}async close(){if(this.closed=!0,this.listeners=new Map,this.cachedSync){const v=this.cachedSync;this.cachedSync=void 0,await v.close()}}transition(v){for(const y of v){const A=this.listeners.get(y);if(A)for(const V of A)V()}}}const AO=kr.createContext(void 0);function Cq(){return Ot.useContext(AO)}const Aq=({client:S,children:v})=>kr.createElement(AO.Provider,{value:S},v);function Qi(S,...v){const y=v[0]==="skip",A=v[0]==="skip"?{}:Ma(v[0]),V=typeof S=="string"?Bj(S):S,B=Lr(V),Y=Ot.useMemo(()=>y?{}:{query:{query:V,args:A}},[JSON.stringify(Ks(A)),B,y]),J=Pq(Y).query;if(J instanceof Error)throw J;return J}function Mi(S){const v=typeof S=="string"?Bj(S):S,y=Ot.useContext(AO);if(y===void 0)throw new Error("Could not find Convex client! `useMutation` must be used in the React component tree under `ConvexProvider`. Did you forget it? See https://docs.convex.dev/quick-start#set-up-convex-in-your-react-app");return Ot.useMemo(()=>Gj(v,y),[y,Lr(v)])}function wq(S){if(typeof S=="object"&&S!==null&&"bubbles"in S&&"persist"in S&&"isDefaultPrevented"in S)throw new Error("Convex function called with SyntheticEvent object. Did you use a Convex function as an event handler directly? Event handlers like onClick receive an event object as their first argument. These SyntheticEvent objects are not valid Convex values. Try wrapping the function like `const handler = () => myMutation();` and using `handler` in the event handler.")}var Iq=Object.defineProperty,Oq=(S,v,y)=>v in S?Iq(S,v,{enumerable:!0,configurable:!0,writable:!0,value:y}):S[v]=y,aO=(S,v,y)=>Oq(S,typeof v!="symbol"?v+"":v,y);class Nq{constructor(v){aO(this,"createWatch"),aO(this,"queries"),aO(this,"listeners"),this.createWatch=v,this.queries={},this.listeners=new Set}setQueries(v){for(const y of Object.keys(v)){const{query:A,args:V}=v[y];if(Lr(A),this.queries[y]===void 0)this.addQuery(y,A,V);else{const B=this.queries[y];(Lr(A)!==Lr(B.query)||JSON.stringify(Ks(V))!==JSON.stringify(Ks(B.args)))&&(this.removeQuery(y),this.addQuery(y,A,V))}}for(const y of Object.keys(this.queries))v[y]===void 0&&this.removeQuery(y)}subscribe(v){return this.listeners.add(v),()=>{this.listeners.delete(v)}}getLocalResults(v){const y={};for(const A of Object.keys(v)){const{query:V,args:B}=v[A];Lr(V);const Y=this.createWatch(V,B);let et;try{et=Y.localQueryResult()}catch(J){if(J instanceof Error)et=J;else throw J}y[A]=et}return y}setCreateWatch(v){this.createWatch=v;for(const y of Object.keys(this.queries)){const{query:A,args:V,watch:B}=this.queries[y],Y=B.journal();this.removeQuery(y),this.addQuery(y,A,V,Y)}}destroy(){for(const v of Object.keys(this.queries))this.removeQuery(v);this.listeners=new Set}addQuery(v,y,A,V){if(this.queries[v]!==void 0)throw new Error(`Tried to add a new query with identifier ${v} when it already exists.`);const B=this.createWatch(y,A,V),Y=B.onUpdate(()=>this.notifyListeners());this.queries[v]={query:y,args:A,watch:B,unsubscribe:Y}}removeQuery(v){const y=this.queries[v];if(y===void 0)throw new Error(`No query found with identifier ${v}.`);y.unsubscribe(),delete this.queries[v]}notifyListeners(){for(const v of this.listeners)v()}}function Dq({getCurrentValue:S,subscribe:v}){const[y,A]=Ot.useState(()=>({getCurrentValue:S,subscribe:v,value:S()}));let V=y.value;return(y.getCurrentValue!==S||y.subscribe!==v)&&(V=S(),A({getCurrentValue:S,subscribe:v,value:V})),Ot.useEffect(()=>{let B=!1;const Y=()=>{B||A(J=>{if(J.getCurrentValue!==S||J.subscribe!==v)return J;const Q=S();return J.value===Q?J:{...J,value:Q}})},et=v(Y);return Y(),()=>{B=!0,et()}},[S,v]),V}function Pq(S){const v=Cq();if(v===void 0)throw new Error("Could not find Convex client! `useQuery` must be used in the React component tree under `ConvexProvider`. Did you forget it? See https://docs.convex.dev/quick-start#set-up-convex-in-your-react-app");const y=Ot.useMemo(()=>(A,V,B)=>v.watchQuery(A,V,{journal:B}),[v]);return kq(S,y)}function kq(S,v){const[y]=Ot.useState(()=>new Nq(v));y.createWatch!==v&&y.setCreateWatch(v),Ot.useEffect(()=>()=>y.destroy(),[y]);const A=Ot.useMemo(()=>({getCurrentValue:()=>y.getLocalResults(S),subscribe:V=>(y.setQueries(S),y.subscribe(V))}),[y,S]);return Dq(A)}const Hj=Ot.createContext(void 0);function wO(){const S=Ot.useContext(Hj);if(S===void 0)throw new Error("Could not find `ConvexProviderWithAuth` (or `ConvexProviderWithClerk` or `ConvexProviderWithAuth0`) as an ancestor component. This component may be missing, or you might have two instances of the `convex/react` module loaded in your project.");return S}function Lq({children:S,client:v,useAuth:y}){const{isLoading:A,isAuthenticated:V,fetchAccessToken:B}=y(),[Y,et]=Ot.useState(null);return A&&Y!==null&&et(null),!A&&!V&&Y!==!1&&et(!1),kr.createElement(Hj.Provider,{value:{isLoading:Y===null,isAuthenticated:V&&(Y??!1)}},kr.createElement(xq,{authProviderAuthenticated:V,fetchAccessToken:B,authProviderLoading:A,client:v,setIsConvexAuthenticated:et}),kr.createElement(Aq,{client:v},S),kr.createElement(Mq,{authProviderAuthenticated:V,fetchAccessToken:B,authProviderLoading:A,client:v,setIsConvexAuthenticated:et}))}function xq({authProviderAuthenticated:S,fetchAccessToken:v,authProviderLoading:y,client:A,setIsConvexAuthenticated:V}){return Ot.useEffect(()=>{let B=!0;if(S)return A.setAuth(v,Y=>{B&&V(()=>Y)}),()=>{B=!1,V(Y=>Y?!1:null)}},[S,v,y,A,V]),null}function Mq({authProviderAuthenticated:S,fetchAccessToken:v,authProviderLoading:y,client:A,setIsConvexAuthenticated:V}){return Ot.useEffect(()=>{if(S)return()=>{A.clearAuth(),V(()=>null)}},[S,v,y,A,V]),null}function Uq({children:S}){const{isLoading:v,isAuthenticated:y}=wO();return v||!y?null:kr.createElement(kr.Fragment,null,S)}function Vq({children:S}){const{isLoading:v,isAuthenticated:y}=wO();return v||y?null:kr.createElement(kr.Fragment,null,S)}const Wj=Ot.createContext(void 0),zj=Ot.createContext(void 0);function jq(){return Ot.useContext(zj)}const Bq=Ot.createContext(null),sO="__convexAuthOAuthVerifier",Nb="__convexAuthJWT",Db="__convexAuthRefreshToken",uj="__convexAuthServerStateFetchTime";function Fq({client:S,serverState:v,onChange:y,storage:A,storageNamespace:V,replaceURL:B,children:Y}){const et=Ot.useRef((v==null?void 0:v._state.token)??null),[J,Q]=Ot.useState(et.current===null),[ht,Et]=Ot.useState(et.current),vt=S.verbose??!1,Ft=Ot.useCallback(oe=>{vt&&console.debug(`${new Date().toISOString()} ${oe}`)},[vt]),{storageSet:xt,storageGet:Oe,storageRemove:Ue,storageKey:vn}=Gq(A,V),[fn,Be]=Ot.useState(!1),fe=Ot.useCallback(async oe=>{const Kt=et.current!==null;let ne;if(oe.tokens===null)et.current=null,oe.shouldStore&&(await Ue(Nb),await Ue(Db)),ne=null;else{const{token:St}=oe.tokens;if(et.current=St,oe.shouldStore){const{refreshToken:kt}=oe.tokens;await xt(Nb,St),await xt(Db,kt)}ne=St}Kt!==(ne!==null)&&await(y==null?void 0:y()),Et(ne),Q(!1)},[xt,Ue]);Ot.useEffect(()=>{const oe=async Kt=>{if(fn){Kt.preventDefault();const ne="Are you sure you want to leave? Your changes may not be saved.";return Kt.returnValue=!0,ne}};return hj("beforeunload",oe),()=>{pj("beforeunload",oe)}}),Ot.useEffect(()=>{const oe=Kt=>{(async()=>{if(Kt.storageArea===A&&Kt.key===vn(Nb)){const ne=Kt.newValue;Ft(`synced access token, is null: ${ne===null}`),await fe({shouldStore:!1,tokens:ne===null?null:{token:ne}})}})()};return hj("storage",oe),()=>pj("storage",oe)},[fe]);const Ae=Ot.useCallback(async oe=>{const{tokens:Kt}=await S.unauthenticatedCall("auth:signIn","code"in oe?{params:{code:oe.code},verifier:oe.verifier}:oe);return Ft(`retrieved tokens, is null: ${Kt===null}`),await fe({shouldStore:!0,tokens:Kt??null}),Kt!==null},[S,fe]),xn=Ot.useCallback(async(oe,Kt)=>{const ne=Kt instanceof FormData?Array.from(Kt.entries()).reduce((te,[Ne,tt])=>(te[Ne]=tt,te),{}):Kt??{},St=await Oe(sO)??void 0;await Ue(sO);const kt=await S.authenticatedCall("auth:signIn",{provider:oe,params:ne,verifier:St});if(kt.redirect!==void 0){const te=new URL(kt.redirect);return await xt(sO,kt.verifier),window.location!==void 0&&(window.location.href=te.toString()),{signingIn:!1,redirect:te}}else if(kt.tokens!==void 0){const{tokens:te}=kt;return Ft(`signed in and got tokens, is null: ${te===null}`),await fe({shouldStore:!0,tokens:te}),{signingIn:kt.tokens!==null}}return{signingIn:!1}},[S,fe,Oe]),ue=Ot.useCallback(async()=>{try{await S.authenticatedCall("auth:signOut")}catch{}Ft("signed out, erasing tokens"),await fe({shouldStore:!0,tokens:null})},[fe,S]),ln=Ot.useCallback(async({forceRefreshToken:oe})=>{if(oe){const Kt=et.current;return await Wq(Db,async()=>{const ne=et.current;if(ne!==Kt)return Ft(`returning synced token, is null: ${ne===null}`),ne;const St=await Oe(Db)??null;return St!==null?(Be(!0),await Ae({refreshToken:St}).finally(()=>{Be(!1)}),Ft(`returning retrieved token, is null: ${ne===null}`),et.current):(Be(!1),Ft("returning null, there is no refresh token"),null)})}return et.current},[Ae,ue,Oe]),yn=Ot.useRef(!1);Ot.useEffect(()=>{if(A===void 0)throw new Error("`localStorage` is not available in this environment, set the `storage` prop on `ConvexAuthProvider`!");const oe=async()=>{const ne=await Oe(Nb)??null;Ft(`retrieved token from storage, is null: ${ne===null}`),await fe({shouldStore:!1,tokens:ne===null?null:{token:ne}})};if(v!==void 0){const ne=Oe(uj),St=kt=>{if(!kt||v._timeFetched>+kt){const{token:te,refreshToken:Ne}=v._state,tt=te===null||Ne===null?null:{token:te,refreshToken:Ne};xt(uj,v._timeFetched.toString()),fe({tokens:tt,shouldStore:!0})}else oe()};ne instanceof Promise?ne.then(St):St(ne);return}const Kt=typeof(window==null?void 0:window.location)<"u"?new URLSearchParams(window.location.search).get("code"):null;if(yn.current||Kt){if(Kt&&!yn.current){yn.current=!0;const ne=new URL(window.location.href);ne.searchParams.delete("code"),(async()=>(await B(ne.pathname+ne.search+ne.hash),await xn(void 0,{code:Kt}),yn.current=!1))()}}else oe()},[S,Oe]);const si=Ot.useMemo(()=>({signIn:xn,signOut:ue}),[xn,ue]),wi=ht!==null,qt=Ot.useMemo(()=>({isLoading:J,isAuthenticated:wi,fetchAccessToken:ln}),[ln,J,wi]);return H.jsx(zj.Provider,{value:qt,children:H.jsx(Wj.Provider,{value:si,children:H.jsx(Bq.Provider,{value:ht,children:Y})})})}function Gq(S,v){const y=Hq(),A=Ot.useMemo(()=>S??y(),[S]),V=v.replace(/[^a-zA-Z0-9]/g,""),B=Ot.useCallback(Q=>`${Q}_${V}`,[v]),Y=Ot.useCallback((Q,ht)=>A.setItem(B(Q),ht),[A,B]),et=Ot.useCallback(Q=>A.getItem(B(Q)),[A,B]),J=Ot.useCallback(Q=>A.removeItem(B(Q)),[A,B]);return{storageSet:Y,storageGet:et,storageRemove:J,storageKey:B}}function Hq(){const[S,v]=Ot.useState({});return()=>({getItem:y=>S[y],setItem:(y,A)=>{v(V=>({...V,[y]:A}))},removeItem:y=>{v(A=>{const{[y]:V,...B}=A;return B})}})}async function Wq(S,v){var A;const y=(A=window==null?void 0:window.navigator)==null?void 0:A.locks;return y!==void 0?await y.request(S,v):await zq(S,v)}function Pb(S){globalThis.__convexAuthMutexes===void 0&&(globalThis.__convexAuthMutexes={});let v=globalThis.__convexAuthMutexes[S];return v===void 0&&(globalThis.__convexAuthMutexes[S]={currentlyRunning:null,waiting:[]}),v=globalThis.__convexAuthMutexes[S],v}function oO(S,v){globalThis.__convexAuthMutexes[S]=v}async function qj(S,v){const y=Pb(S);y.currentlyRunning===null?oO(S,{currentlyRunning:v().finally(()=>{const A=Pb(S).waiting.shift();Pb(S).currentlyRunning=null,oO(S,{...Pb(S),currentlyRunning:A===void 0?null:qj(S,A)})}),waiting:[]}):oO(S,{...y,waiting:[...y.waiting,v]})}async function zq(S,v){return new Promise((A,V)=>{qj(S,()=>v().then(Y=>A(Y)).catch(Y=>V(Y)))})}function hj(S,v,y){var A;(A=window.addEventListener)==null||A.call(window,S,v,y)}function pj(S,v,y){var A;(A=window.removeEventListener)==null||A.call(window,S,v,y)}function Kj(){return Ot.useContext(Wj)}function qq(S){const{client:v,storage:y,storageNamespace:A,replaceURL:V,children:B}=S,Y=Ot.useMemo(()=>{var et;return{authenticatedCall(J,Q){return v.action(J,Q)},unauthenticatedCall(J,Q){return new Tq(v.address).action(J,Q)},verbose:(et=v.options)==null?void 0:et.verbose}},[v]);return H.jsx(Fq,{client:Y,storage:y??(typeof window>"u"||window==null?void 0:window.localStorage),storageNamespace:A??v.address,replaceURL:V??(et=>{window.history.replaceState({},"",et)}),children:H.jsx(Lq,{client:v,useAuth:jq,children:B})})}const He=Uz;Dj();function Kq(S){if(typeof document>"u")return;let v=document.head||document.getElementsByTagName("head")[0],y=document.createElement("style");y.type="text/css",v.appendChild(y),y.styleSheet?y.styleSheet.cssText=S:y.appendChild(document.createTextNode(S))}Array(12).fill(0);let _O=1;class Yq{constructor(){this.subscribe=v=>(this.subscribers.push(v),()=>{const y=this.subscribers.indexOf(v);this.subscribers.splice(y,1)}),this.publish=v=>{this.subscribers.forEach(y=>y(v))},this.addToast=v=>{this.publish(v),this.toasts=[...this.toasts,v]},this.create=v=>{var y;const{message:A,...V}=v,B=typeof(v==null?void 0:v.id)=="number"||((y=v.id)==null?void 0:y.length)>0?v.id:_O++,Y=this.toasts.find(J=>J.id===B),et=v.dismissible===void 0?!0:v.dismissible;return this.dismissedToasts.has(B)&&this.dismissedToasts.delete(B),Y?this.toasts=this.toasts.map(J=>J.id===B?(this.publish({...J,...v,id:B,title:A}),{...J,...v,id:B,dismissible:et,title:A}):J):this.addToast({title:A,...V,dismissible:et,id:B}),B},this.dismiss=v=>(v?(this.dismissedToasts.add(v),requestAnimationFrame(()=>this.subscribers.forEach(y=>y({id:v,dismiss:!0})))):this.toasts.forEach(y=>{this.subscribers.forEach(A=>A({id:y.id,dismiss:!0}))}),v),this.message=(v,y)=>this.create({...y,message:v}),this.error=(v,y)=>this.create({...y,message:v,type:"error"}),this.success=(v,y)=>this.create({...y,type:"success",message:v}),this.info=(v,y)=>this.create({...y,type:"info",message:v}),this.warning=(v,y)=>this.create({...y,type:"warning",message:v}),this.loading=(v,y)=>this.create({...y,type:"loading",message:v}),this.promise=(v,y)=>{if(!y)return;let A;y.loading!==void 0&&(A=this.create({...y,promise:v,type:"loading",message:y.loading,description:typeof y.description!="function"?y.description:void 0}));const V=Promise.resolve(v instanceof Function?v():v);let B=A!==void 0,Y;const et=V.then(async Q=>{if(Y=["resolve",Q],kr.isValidElement(Q))B=!1,this.create({id:A,type:"default",message:Q});else if(Qq(Q)&&!Q.ok){B=!1;const Et=typeof y.error=="function"?await y.error(`HTTP error! status: ${Q.status}`):y.error,vt=typeof y.description=="function"?await y.description(`HTTP error! status: ${Q.status}`):y.description,xt=typeof Et=="object"&&!kr.isValidElement(Et)?Et:{message:Et};this.create({id:A,type:"error",description:vt,...xt})}else if(Q instanceof Error){B=!1;const Et=typeof y.error=="function"?await y.error(Q):y.error,vt=typeof y.description=="function"?await y.description(Q):y.description,xt=typeof Et=="object"&&!kr.isValidElement(Et)?Et:{message:Et};this.create({id:A,type:"error",description:vt,...xt})}else if(y.success!==void 0){B=!1;const Et=typeof y.success=="function"?await y.success(Q):y.success,vt=typeof y.description=="function"?await y.description(Q):y.description,xt=typeof Et=="object"&&!kr.isValidElement(Et)?Et:{message:Et};this.create({id:A,type:"success",description:vt,...xt})}}).catch(async Q=>{if(Y=["reject",Q],y.error!==void 0){B=!1;const ht=typeof y.error=="function"?await y.error(Q):y.error,Et=typeof y.description=="function"?await y.description(Q):y.description,Ft=typeof ht=="object"&&!kr.isValidElement(ht)?ht:{message:ht};this.create({id:A,type:"error",description:Et,...Ft})}}).finally(()=>{B&&(this.dismiss(A),A=void 0),y.finally==null||y.finally.call(y)}),J=()=>new Promise((Q,ht)=>et.then(()=>Y[0]==="reject"?ht(Y[1]):Q(Y[1])).catch(ht));return typeof A!="string"&&typeof A!="number"?{unwrap:J}:Object.assign(A,{unwrap:J})},this.custom=(v,y)=>{const A=(y==null?void 0:y.id)||_O++;return this.create({jsx:v(A),id:A,...y}),A},this.getActiveToasts=()=>this.toasts.filter(v=>!this.dismissedToasts.has(v.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}}const qs=new Yq,Xq=(S,v)=>{const y=(v==null?void 0:v.id)||_O++;return qs.addToast({title:S,...v,id:y}),y},Qq=S=>S&&typeof S=="object"&&"ok"in S&&typeof S.ok=="boolean"&&"status"in S&&typeof S.status=="number",Jq=Xq,Zq=()=>qs.toasts,$q=()=>qs.getActiveToasts(),tK=Object.assign(Jq,{success:qs.success,info:qs.info,warning:qs.warning,error:qs.error,custom:qs.custom,message:qs.message,promise:qs.promise,dismiss:qs.dismiss,loading:qs.loading},{getHistory:Zq,getToasts:$q});Kq("[data-sonner-toaster][dir=ltr],html[dir=ltr]{--toast-icon-margin-start:-3px;--toast-icon-margin-end:4px;--toast-svg-margin-start:-1px;--toast-svg-margin-end:0px;--toast-button-margin-start:auto;--toast-button-margin-end:0;--toast-close-button-start:0;--toast-close-button-end:unset;--toast-close-button-transform:translate(-35%, -35%)}[data-sonner-toaster][dir=rtl],html[dir=rtl]{--toast-icon-margin-start:4px;--toast-icon-margin-end:-3px;--toast-svg-margin-start:0px;--toast-svg-margin-end:-1px;--toast-button-margin-start:0;--toast-button-margin-end:auto;--toast-close-button-start:unset;--toast-close-button-end:0;--toast-close-button-transform:translate(35%, -35%)}[data-sonner-toaster]{position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1:hsl(0, 0%, 99%);--gray2:hsl(0, 0%, 97.3%);--gray3:hsl(0, 0%, 95.1%);--gray4:hsl(0, 0%, 93%);--gray5:hsl(0, 0%, 90.9%);--gray6:hsl(0, 0%, 88.7%);--gray7:hsl(0, 0%, 85.8%);--gray8:hsl(0, 0%, 78%);--gray9:hsl(0, 0%, 56.1%);--gray10:hsl(0, 0%, 52.3%);--gray11:hsl(0, 0%, 43.5%);--gray12:hsl(0, 0%, 9%);--border-radius:8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:0;z-index:999999999;transition:transform .4s ease}[data-sonner-toaster][data-lifted=true]{transform:translateY(-8px)}@media (hover:none) and (pointer:coarse){[data-sonner-toaster][data-lifted=true]{transform:none}}[data-sonner-toaster][data-x-position=right]{right:var(--offset-right)}[data-sonner-toaster][data-x-position=left]{left:var(--offset-left)}[data-sonner-toaster][data-x-position=center]{left:50%;transform:translateX(-50%)}[data-sonner-toaster][data-y-position=top]{top:var(--offset-top)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--offset-bottom)}[data-sonner-toast]{--y:translateY(100%);--lift-amount:calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:0;overflow-wrap:anywhere}[data-sonner-toast][data-styled=true]{padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px rgba(0,0,0,.1);width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}[data-sonner-toast]:focus-visible{box-shadow:0 4px 12px rgba(0,0,0,.1),0 0 0 2px rgba(0,0,0,.2)}[data-sonner-toast][data-y-position=top]{top:0;--y:translateY(-100%);--lift:1;--lift-amount:calc(1 * var(--gap))}[data-sonner-toast][data-y-position=bottom]{bottom:0;--y:translateY(100%);--lift:-1;--lift-amount:calc(var(--lift) * var(--gap))}[data-sonner-toast][data-styled=true] [data-description]{font-weight:400;line-height:1.4;color:#3f3f3f}[data-rich-colors=true][data-sonner-toast][data-styled=true] [data-description]{color:inherit}[data-sonner-toaster][data-sonner-theme=dark] [data-description]{color:#e8e8e8}[data-sonner-toast][data-styled=true] [data-title]{font-weight:500;line-height:1.5;color:inherit}[data-sonner-toast][data-styled=true] [data-icon]{display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}[data-sonner-toast][data-promise=true] [data-icon]>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}[data-sonner-toast][data-styled=true] [data-icon]>*{flex-shrink:0}[data-sonner-toast][data-styled=true] [data-icon] svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}[data-sonner-toast][data-styled=true] [data-content]{display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;font-weight:500;cursor:pointer;outline:0;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}[data-sonner-toast][data-styled=true] [data-button]:focus-visible{box-shadow:0 0 0 2px rgba(0,0,0,.4)}[data-sonner-toast][data-styled=true] [data-button]:first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}[data-sonner-toast][data-styled=true] [data-cancel]{color:var(--normal-text);background:rgba(0,0,0,.08)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast][data-styled=true] [data-cancel]{background:rgba(255,255,255,.3)}[data-sonner-toast][data-styled=true] [data-close-button]{position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);background:var(--normal-bg);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast][data-styled=true] [data-close-button]:focus-visible{box-shadow:0 4px 12px rgba(0,0,0,.1),0 0 0 2px rgba(0,0,0,.2)}[data-sonner-toast][data-styled=true] [data-disabled=true]{cursor:not-allowed}[data-sonner-toast][data-styled=true]:hover [data-close-button]:hover{background:var(--gray2);border-color:var(--gray5)}[data-sonner-toast][data-swiping=true]::before{content:'';position:absolute;left:-100%;right:-100%;height:100%;z-index:-1}[data-sonner-toast][data-y-position=top][data-swiping=true]::before{bottom:50%;transform:scaleY(3) translateY(50%)}[data-sonner-toast][data-y-position=bottom][data-swiping=true]::before{top:50%;transform:scaleY(3) translateY(-50%)}[data-sonner-toast][data-swiping=false][data-removed=true]::before{content:'';position:absolute;inset:0;transform:scaleY(2)}[data-sonner-toast][data-expanded=true]::after{content:'';position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}[data-sonner-toast][data-mounted=true]{--y:translateY(0);opacity:1}[data-sonner-toast][data-expanded=false][data-front=false]{--scale:var(--toasts-before) * 0.05 + 1;--y:translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}[data-sonner-toast]>*{transition:opacity .4s}[data-sonner-toast][data-x-position=right]{right:0}[data-sonner-toast][data-x-position=left]{left:0}[data-sonner-toast][data-expanded=false][data-front=false][data-styled=true]>*{opacity:0}[data-sonner-toast][data-visible=false]{opacity:0;pointer-events:none}[data-sonner-toast][data-mounted=true][data-expanded=true]{--y:translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}[data-sonner-toast][data-removed=true][data-front=true][data-swipe-out=false]{--y:translateY(calc(var(--lift) * -100%));opacity:0}[data-sonner-toast][data-removed=true][data-front=false][data-swipe-out=false][data-expanded=true]{--y:translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}[data-sonner-toast][data-removed=true][data-front=false][data-swipe-out=false][data-expanded=false]{--y:translateY(40%);opacity:0;transition:transform .5s,opacity .2s}[data-sonner-toast][data-removed=true][data-front=false]::before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y,0)) translateX(var(--swipe-amount-x,0));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{from{transform:var(--y) translateX(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translateX(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{from{transform:var(--y) translateX(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translateX(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{from{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{from{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width:600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-sonner-theme=light]{--normal-bg:#fff;--normal-border:var(--gray4);--normal-text:var(--gray12);--success-bg:hsl(143, 85%, 96%);--success-border:hsl(145, 92%, 87%);--success-text:hsl(140, 100%, 27%);--info-bg:hsl(208, 100%, 97%);--info-border:hsl(221, 91%, 93%);--info-text:hsl(210, 92%, 45%);--warning-bg:hsl(49, 100%, 97%);--warning-border:hsl(49, 91%, 84%);--warning-text:hsl(31, 92%, 45%);--error-bg:hsl(359, 100%, 97%);--error-border:hsl(359, 100%, 94%);--error-text:hsl(360, 100%, 45%)}[data-sonner-toaster][data-sonner-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg:#000;--normal-border:hsl(0, 0%, 20%);--normal-text:var(--gray1)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg:#fff;--normal-border:var(--gray3);--normal-text:var(--gray12)}[data-sonner-toaster][data-sonner-theme=dark]{--normal-bg:#000;--normal-bg-hover:hsl(0, 0%, 12%);--normal-border:hsl(0, 0%, 20%);--normal-border-hover:hsl(0, 0%, 25%);--normal-text:var(--gray1);--success-bg:hsl(150, 100%, 6%);--success-border:hsl(147, 100%, 12%);--success-text:hsl(150, 86%, 65%);--info-bg:hsl(215, 100%, 6%);--info-border:hsl(223, 43%, 17%);--info-text:hsl(216, 87%, 65%);--warning-bg:hsl(64, 100%, 6%);--warning-border:hsl(60, 100%, 9%);--warning-text:hsl(46, 87%, 65%);--error-bg:hsl(358, 76%, 10%);--error-border:hsl(357, 89%, 16%);--error-text:hsl(358, 100%, 81%)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size:16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:first-child{animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}100%{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}100%{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}100%{opacity:.15}}@media (prefers-reduced-motion){.sonner-loading-bar,[data-sonner-toast],[data-sonner-toast]>*{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}");function eK(){const{signIn:S}=Kj(),[v,y]=Ot.useState("signIn"),[A,V]=Ot.useState(!1);return H.jsxs("div",{className:"w-full",children:[H.jsxs("form",{className:"flex flex-col gap-form-field",onSubmit:B=>{B.preventDefault(),V(!0);const Y=new FormData(B.target);Y.set("flow",v),S("password",Y).catch(et=>{let J="";et.message.includes("Invalid password")?J="Invalid password. Please try again.":J=v==="signIn"?"Could not sign in, did you mean to sign up?":"Could not sign up, did you mean to sign in?",tK.error(J),V(!1)})},children:[H.jsx("input",{className:"auth-input-field",type:"email",name:"email",placeholder:"Email",required:!0}),H.jsx("input",{className:"auth-input-field",type:"password",name:"password",placeholder:"Password",required:!0}),H.jsx("button",{className:"auth-button",type:"submit",disabled:A,children:v==="signIn"?"Sign in":"Sign up"}),H.jsxs("div",{className:"text-center text-sm text-secondary",children:[H.jsx("span",{children:v==="signIn"?"Don't have an account? ":"Already have an account? "}),H.jsx("button",{type:"button",className:"text-primary hover:text-primary-hover hover:underline font-medium cursor-pointer",onClick:()=>y(v==="signIn"?"signUp":"signIn"),children:v==="signIn"?"Sign up instead":"Sign in instead"})]})]}),H.jsxs("div",{className:"flex items-center justify-center my-3",children:[H.jsx("hr",{className:"my-4 grow border-gray-200"}),H.jsx("span",{className:"mx-4 text-secondary",children:"or"}),H.jsx("hr",{className:"my-4 grow border-gray-200"})]}),H.jsx("button",{className:"auth-button",onClick:()=>void S("anonymous"),children:"Sign in anonymously"})]})}function nK({onEnterRoom:S}){const v=Qi(He.rooms.list)??[],[y,A]=Ot.useState(!1);return H.jsxs("div",{className:"p-4",children:[H.jsxs("div",{className:"flex justify-between items-center mb-4",children:[H.jsx("h1",{className:"text-2xl font-bold text-purple-800",children:"الغرف المتاحة"}),H.jsx("button",{onClick:()=>A(!0),className:"bg-purple-600 text-white px-4 py-2 rounded-lg font-semibold",children:"إنشاء غرفة"})]}),H.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:v.map(V=>H.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 flex flex-col items-center text-center cursor-pointer",onClick:()=>S(V._id),children:[H.jsx("img",{src:V.image,alt:V.name,className:"w-24 h-24 rounded-full object-cover mb-2"}),H.jsx("h2",{className:"font-bold text-purple-900",children:V.name}),H.jsxs("p",{className:"text-sm text-gray-600",children:["بواسطة ",V.ownerName]})]},V._id))}),y&&H.jsx(iK,{onClose:()=>A(!1),onEnterRoom:S})]})}function iK({onClose:S,onEnterRoom:v}){const y=Mi(He.rooms.create),[A,V]=Ot.useState(""),[B,Y]=Ot.useState(""),[et,J]=Ot.useState(!1),Q=async ht=>{ht.preventDefault(),J(!0);const Et=await y({name:A,image:B});J(!1),S(),v(Et)};return H.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50",children:H.jsxs("div",{className:"bg-white p-6 rounded-lg w-full max-w-sm mx-4",children:[H.jsx("h2",{className:"text-xl font-bold mb-4 text-purple-800 text-center",children:"إنشاء غرفة جديدة"}),H.jsxs("form",{onSubmit:Q,className:"space-y-4",children:[H.jsx("input",{type:"text",placeholder:"اسم الغرفة",value:A,onChange:ht=>V(ht.target.value),required:!0,className:"w-full p-2 border border-purple-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"}),H.jsx("input",{type:"text",placeholder:"رابط صورة الغرفة",value:B,onChange:ht=>Y(ht.target.value),required:!0,className:"w-full p-2 border border-purple-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"}),H.jsxs("div",{className:"flex justify-end gap-2",children:[H.jsx("button",{type:"button",onClick:S,className:"bg-gray-300 px-4 py-2 rounded-lg font-semibold",children:"إغلاق"}),H.jsx("button",{type:"submit",disabled:et,className:"bg-purple-600 text-white px-4 py-2 rounded-lg font-semibold disabled:bg-gray-400",children:et?"جاري الإنشاء...":"إنشاء"})]})]})]})})}var cO={exports:{}},lO,fj;function rK(){if(fj)return lO;fj=1;var S="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return lO=S,lO}var dO,mj;function aK(){if(mj)return dO;mj=1;var S=rK();function v(){}function y(){}return y.resetWarningCache=v,dO=function(){function A(Y,et,J,Q,ht,Et){if(Et!==S){var vt=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw vt.name="Invariant Violation",vt}}A.isRequired=A;function V(){return A}var B={array:A,bigint:A,bool:A,func:A,number:A,object:A,string:A,symbol:A,any:A,arrayOf:V,element:A,elementType:A,instanceOf:V,node:A,objectOf:V,oneOf:V,oneOfType:V,shape:V,exact:V,checkPropTypes:y,resetWarningCache:v};return B.PropTypes=B,B},dO}var _j;function sK(){return _j||(_j=1,cO.exports=aK()()),cO.exports}var oK=sK();const ii=Fb(oK);function lp(S,v,y,A){function V(B){return B instanceof y?B:new y(function(Y){Y(B)})}return new(y||(y=Promise))(function(B,Y){function et(ht){try{Q(A.next(ht))}catch(Et){Y(Et)}}function J(ht){try{Q(A.throw(ht))}catch(Et){Y(Et)}}function Q(ht){ht.done?B(ht.value):V(ht.value).then(et,J)}Q((A=A.apply(S,v||[])).next())})}const cK=new Map([["1km","application/vnd.1000minds.decision-model+xml"],["3dml","text/vnd.in3d.3dml"],["3ds","image/x-3ds"],["3g2","video/3gpp2"],["3gp","video/3gp"],["3gpp","video/3gpp"],["3mf","model/3mf"],["7z","application/x-7z-compressed"],["7zip","application/x-7z-compressed"],["123","application/vnd.lotus-1-2-3"],["aab","application/x-authorware-bin"],["aac","audio/x-acc"],["aam","application/x-authorware-map"],["aas","application/x-authorware-seg"],["abw","application/x-abiword"],["ac","application/vnd.nokia.n-gage.ac+xml"],["ac3","audio/ac3"],["acc","application/vnd.americandynamics.acc"],["ace","application/x-ace-compressed"],["acu","application/vnd.acucobol"],["acutc","application/vnd.acucorp"],["adp","audio/adpcm"],["aep","application/vnd.audiograph"],["afm","application/x-font-type1"],["afp","application/vnd.ibm.modcap"],["ahead","application/vnd.ahead.space"],["ai","application/pdf"],["aif","audio/x-aiff"],["aifc","audio/x-aiff"],["aiff","audio/x-aiff"],["air","application/vnd.adobe.air-application-installer-package+zip"],["ait","application/vnd.dvb.ait"],["ami","application/vnd.amiga.ami"],["amr","audio/amr"],["apk","application/vnd.android.package-archive"],["apng","image/apng"],["appcache","text/cache-manifest"],["application","application/x-ms-application"],["apr","application/vnd.lotus-approach"],["arc","application/x-freearc"],["arj","application/x-arj"],["asc","application/pgp-signature"],["asf","video/x-ms-asf"],["asm","text/x-asm"],["aso","application/vnd.accpac.simply.aso"],["asx","video/x-ms-asf"],["atc","application/vnd.acucorp"],["atom","application/atom+xml"],["atomcat","application/atomcat+xml"],["atomdeleted","application/atomdeleted+xml"],["atomsvc","application/atomsvc+xml"],["atx","application/vnd.antix.game-component"],["au","audio/x-au"],["avi","video/x-msvideo"],["avif","image/avif"],["aw","application/applixware"],["azf","application/vnd.airzip.filesecure.azf"],["azs","application/vnd.airzip.filesecure.azs"],["azv","image/vnd.airzip.accelerator.azv"],["azw","application/vnd.amazon.ebook"],["b16","image/vnd.pco.b16"],["bat","application/x-msdownload"],["bcpio","application/x-bcpio"],["bdf","application/x-font-bdf"],["bdm","application/vnd.syncml.dm+wbxml"],["bdoc","application/x-bdoc"],["bed","application/vnd.realvnc.bed"],["bh2","application/vnd.fujitsu.oasysprs"],["bin","application/octet-stream"],["blb","application/x-blorb"],["blorb","application/x-blorb"],["bmi","application/vnd.bmi"],["bmml","application/vnd.balsamiq.bmml+xml"],["bmp","image/bmp"],["book","application/vnd.framemaker"],["box","application/vnd.previewsystems.box"],["boz","application/x-bzip2"],["bpk","application/octet-stream"],["bpmn","application/octet-stream"],["bsp","model/vnd.valve.source.compiled-map"],["btif","image/prs.btif"],["buffer","application/octet-stream"],["bz","application/x-bzip"],["bz2","application/x-bzip2"],["c","text/x-c"],["c4d","application/vnd.clonk.c4group"],["c4f","application/vnd.clonk.c4group"],["c4g","application/vnd.clonk.c4group"],["c4p","application/vnd.clonk.c4group"],["c4u","application/vnd.clonk.c4group"],["c11amc","application/vnd.cluetrust.cartomobile-config"],["c11amz","application/vnd.cluetrust.cartomobile-config-pkg"],["cab","application/vnd.ms-cab-compressed"],["caf","audio/x-caf"],["cap","application/vnd.tcpdump.pcap"],["car","application/vnd.curl.car"],["cat","application/vnd.ms-pki.seccat"],["cb7","application/x-cbr"],["cba","application/x-cbr"],["cbr","application/x-cbr"],["cbt","application/x-cbr"],["cbz","application/x-cbr"],["cc","text/x-c"],["cco","application/x-cocoa"],["cct","application/x-director"],["ccxml","application/ccxml+xml"],["cdbcmsg","application/vnd.contact.cmsg"],["cda","application/x-cdf"],["cdf","application/x-netcdf"],["cdfx","application/cdfx+xml"],["cdkey","application/vnd.mediastation.cdkey"],["cdmia","application/cdmi-capability"],["cdmic","application/cdmi-container"],["cdmid","application/cdmi-domain"],["cdmio","application/cdmi-object"],["cdmiq","application/cdmi-queue"],["cdr","application/cdr"],["cdx","chemical/x-cdx"],["cdxml","application/vnd.chemdraw+xml"],["cdy","application/vnd.cinderella"],["cer","application/pkix-cert"],["cfs","application/x-cfs-compressed"],["cgm","image/cgm"],["chat","application/x-chat"],["chm","application/vnd.ms-htmlhelp"],["chrt","application/vnd.kde.kchart"],["cif","chemical/x-cif"],["cii","application/vnd.anser-web-certificate-issue-initiation"],["cil","application/vnd.ms-artgalry"],["cjs","application/node"],["cla","application/vnd.claymore"],["class","application/octet-stream"],["clkk","application/vnd.crick.clicker.keyboard"],["clkp","application/vnd.crick.clicker.palette"],["clkt","application/vnd.crick.clicker.template"],["clkw","application/vnd.crick.clicker.wordbank"],["clkx","application/vnd.crick.clicker"],["clp","application/x-msclip"],["cmc","application/vnd.cosmocaller"],["cmdf","chemical/x-cmdf"],["cml","chemical/x-cml"],["cmp","application/vnd.yellowriver-custom-menu"],["cmx","image/x-cmx"],["cod","application/vnd.rim.cod"],["coffee","text/coffeescript"],["com","application/x-msdownload"],["conf","text/plain"],["cpio","application/x-cpio"],["cpp","text/x-c"],["cpt","application/mac-compactpro"],["crd","application/x-mscardfile"],["crl","application/pkix-crl"],["crt","application/x-x509-ca-cert"],["crx","application/x-chrome-extension"],["cryptonote","application/vnd.rig.cryptonote"],["csh","application/x-csh"],["csl","application/vnd.citationstyles.style+xml"],["csml","chemical/x-csml"],["csp","application/vnd.commonspace"],["csr","application/octet-stream"],["css","text/css"],["cst","application/x-director"],["csv","text/csv"],["cu","application/cu-seeme"],["curl","text/vnd.curl"],["cww","application/prs.cww"],["cxt","application/x-director"],["cxx","text/x-c"],["dae","model/vnd.collada+xml"],["daf","application/vnd.mobius.daf"],["dart","application/vnd.dart"],["dataless","application/vnd.fdsn.seed"],["davmount","application/davmount+xml"],["dbf","application/vnd.dbf"],["dbk","application/docbook+xml"],["dcr","application/x-director"],["dcurl","text/vnd.curl.dcurl"],["dd2","application/vnd.oma.dd2+xml"],["ddd","application/vnd.fujixerox.ddd"],["ddf","application/vnd.syncml.dmddf+xml"],["dds","image/vnd.ms-dds"],["deb","application/x-debian-package"],["def","text/plain"],["deploy","application/octet-stream"],["der","application/x-x509-ca-cert"],["dfac","application/vnd.dreamfactory"],["dgc","application/x-dgc-compressed"],["dic","text/x-c"],["dir","application/x-director"],["dis","application/vnd.mobius.dis"],["disposition-notification","message/disposition-notification"],["dist","application/octet-stream"],["distz","application/octet-stream"],["djv","image/vnd.djvu"],["djvu","image/vnd.djvu"],["dll","application/octet-stream"],["dmg","application/x-apple-diskimage"],["dmn","application/octet-stream"],["dmp","application/vnd.tcpdump.pcap"],["dms","application/octet-stream"],["dna","application/vnd.dna"],["doc","application/msword"],["docm","application/vnd.ms-word.template.macroEnabled.12"],["docx","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],["dot","application/msword"],["dotm","application/vnd.ms-word.template.macroEnabled.12"],["dotx","application/vnd.openxmlformats-officedocument.wordprocessingml.template"],["dp","application/vnd.osgi.dp"],["dpg","application/vnd.dpgraph"],["dra","audio/vnd.dra"],["drle","image/dicom-rle"],["dsc","text/prs.lines.tag"],["dssc","application/dssc+der"],["dtb","application/x-dtbook+xml"],["dtd","application/xml-dtd"],["dts","audio/vnd.dts"],["dtshd","audio/vnd.dts.hd"],["dump","application/octet-stream"],["dvb","video/vnd.dvb.file"],["dvi","application/x-dvi"],["dwd","application/atsc-dwd+xml"],["dwf","model/vnd.dwf"],["dwg","image/vnd.dwg"],["dxf","image/vnd.dxf"],["dxp","application/vnd.spotfire.dxp"],["dxr","application/x-director"],["ear","application/java-archive"],["ecelp4800","audio/vnd.nuera.ecelp4800"],["ecelp7470","audio/vnd.nuera.ecelp7470"],["ecelp9600","audio/vnd.nuera.ecelp9600"],["ecma","application/ecmascript"],["edm","application/vnd.novadigm.edm"],["edx","application/vnd.novadigm.edx"],["efif","application/vnd.picsel"],["ei6","application/vnd.pg.osasli"],["elc","application/octet-stream"],["emf","image/emf"],["eml","message/rfc822"],["emma","application/emma+xml"],["emotionml","application/emotionml+xml"],["emz","application/x-msmetafile"],["eol","audio/vnd.digital-winds"],["eot","application/vnd.ms-fontobject"],["eps","application/postscript"],["epub","application/epub+zip"],["es","application/ecmascript"],["es3","application/vnd.eszigno3+xml"],["esa","application/vnd.osgi.subsystem"],["esf","application/vnd.epson.esf"],["et3","application/vnd.eszigno3+xml"],["etx","text/x-setext"],["eva","application/x-eva"],["evy","application/x-envoy"],["exe","application/octet-stream"],["exi","application/exi"],["exp","application/express"],["exr","image/aces"],["ext","application/vnd.novadigm.ext"],["ez","application/andrew-inset"],["ez2","application/vnd.ezpix-album"],["ez3","application/vnd.ezpix-package"],["f","text/x-fortran"],["f4v","video/mp4"],["f77","text/x-fortran"],["f90","text/x-fortran"],["fbs","image/vnd.fastbidsheet"],["fcdt","application/vnd.adobe.formscentral.fcdt"],["fcs","application/vnd.isac.fcs"],["fdf","application/vnd.fdf"],["fdt","application/fdt+xml"],["fe_launch","application/vnd.denovo.fcselayout-link"],["fg5","application/vnd.fujitsu.oasysgp"],["fgd","application/x-director"],["fh","image/x-freehand"],["fh4","image/x-freehand"],["fh5","image/x-freehand"],["fh7","image/x-freehand"],["fhc","image/x-freehand"],["fig","application/x-xfig"],["fits","image/fits"],["flac","audio/x-flac"],["fli","video/x-fli"],["flo","application/vnd.micrografx.flo"],["flv","video/x-flv"],["flw","application/vnd.kde.kivio"],["flx","text/vnd.fmi.flexstor"],["fly","text/vnd.fly"],["fm","application/vnd.framemaker"],["fnc","application/vnd.frogans.fnc"],["fo","application/vnd.software602.filler.form+xml"],["for","text/x-fortran"],["fpx","image/vnd.fpx"],["frame","application/vnd.framemaker"],["fsc","application/vnd.fsc.weblaunch"],["fst","image/vnd.fst"],["ftc","application/vnd.fluxtime.clip"],["fti","application/vnd.anser-web-funds-transfer-initiation"],["fvt","video/vnd.fvt"],["fxp","application/vnd.adobe.fxp"],["fxpl","application/vnd.adobe.fxp"],["fzs","application/vnd.fuzzysheet"],["g2w","application/vnd.geoplan"],["g3","image/g3fax"],["g3w","application/vnd.geospace"],["gac","application/vnd.groove-account"],["gam","application/x-tads"],["gbr","application/rpki-ghostbusters"],["gca","application/x-gca-compressed"],["gdl","model/vnd.gdl"],["gdoc","application/vnd.google-apps.document"],["geo","application/vnd.dynageo"],["geojson","application/geo+json"],["gex","application/vnd.geometry-explorer"],["ggb","application/vnd.geogebra.file"],["ggt","application/vnd.geogebra.tool"],["ghf","application/vnd.groove-help"],["gif","image/gif"],["gim","application/vnd.groove-identity-message"],["glb","model/gltf-binary"],["gltf","model/gltf+json"],["gml","application/gml+xml"],["gmx","application/vnd.gmx"],["gnumeric","application/x-gnumeric"],["gpg","application/gpg-keys"],["gph","application/vnd.flographit"],["gpx","application/gpx+xml"],["gqf","application/vnd.grafeq"],["gqs","application/vnd.grafeq"],["gram","application/srgs"],["gramps","application/x-gramps-xml"],["gre","application/vnd.geometry-explorer"],["grv","application/vnd.groove-injector"],["grxml","application/srgs+xml"],["gsf","application/x-font-ghostscript"],["gsheet","application/vnd.google-apps.spreadsheet"],["gslides","application/vnd.google-apps.presentation"],["gtar","application/x-gtar"],["gtm","application/vnd.groove-tool-message"],["gtw","model/vnd.gtw"],["gv","text/vnd.graphviz"],["gxf","application/gxf"],["gxt","application/vnd.geonext"],["gz","application/gzip"],["gzip","application/gzip"],["h","text/x-c"],["h261","video/h261"],["h263","video/h263"],["h264","video/h264"],["hal","application/vnd.hal+xml"],["hbci","application/vnd.hbci"],["hbs","text/x-handlebars-template"],["hdd","application/x-virtualbox-hdd"],["hdf","application/x-hdf"],["heic","image/heic"],["heics","image/heic-sequence"],["heif","image/heif"],["heifs","image/heif-sequence"],["hej2","image/hej2k"],["held","application/atsc-held+xml"],["hh","text/x-c"],["hjson","application/hjson"],["hlp","application/winhlp"],["hpgl","application/vnd.hp-hpgl"],["hpid","application/vnd.hp-hpid"],["hps","application/vnd.hp-hps"],["hqx","application/mac-binhex40"],["hsj2","image/hsj2"],["htc","text/x-component"],["htke","application/vnd.kenameaapp"],["htm","text/html"],["html","text/html"],["hvd","application/vnd.yamaha.hv-dic"],["hvp","application/vnd.yamaha.hv-voice"],["hvs","application/vnd.yamaha.hv-script"],["i2g","application/vnd.intergeo"],["icc","application/vnd.iccprofile"],["ice","x-conference/x-cooltalk"],["icm","application/vnd.iccprofile"],["ico","image/x-icon"],["ics","text/calendar"],["ief","image/ief"],["ifb","text/calendar"],["ifm","application/vnd.shana.informed.formdata"],["iges","model/iges"],["igl","application/vnd.igloader"],["igm","application/vnd.insors.igm"],["igs","model/iges"],["igx","application/vnd.micrografx.igx"],["iif","application/vnd.shana.informed.interchange"],["img","application/octet-stream"],["imp","application/vnd.accpac.simply.imp"],["ims","application/vnd.ms-ims"],["in","text/plain"],["ini","text/plain"],["ink","application/inkml+xml"],["inkml","application/inkml+xml"],["install","application/x-install-instructions"],["iota","application/vnd.astraea-software.iota"],["ipfix","application/ipfix"],["ipk","application/vnd.shana.informed.package"],["irm","application/vnd.ibm.rights-management"],["irp","application/vnd.irepository.package+xml"],["iso","application/x-iso9660-image"],["itp","application/vnd.shana.informed.formtemplate"],["its","application/its+xml"],["ivp","application/vnd.immervision-ivp"],["ivu","application/vnd.immervision-ivu"],["jad","text/vnd.sun.j2me.app-descriptor"],["jade","text/jade"],["jam","application/vnd.jam"],["jar","application/java-archive"],["jardiff","application/x-java-archive-diff"],["java","text/x-java-source"],["jhc","image/jphc"],["jisp","application/vnd.jisp"],["jls","image/jls"],["jlt","application/vnd.hp-jlyt"],["jng","image/x-jng"],["jnlp","application/x-java-jnlp-file"],["joda","application/vnd.joost.joda-archive"],["jp2","image/jp2"],["jpe","image/jpeg"],["jpeg","image/jpeg"],["jpf","image/jpx"],["jpg","image/jpeg"],["jpg2","image/jp2"],["jpgm","video/jpm"],["jpgv","video/jpeg"],["jph","image/jph"],["jpm","video/jpm"],["jpx","image/jpx"],["js","application/javascript"],["json","application/json"],["json5","application/json5"],["jsonld","application/ld+json"],["jsonl","application/jsonl"],["jsonml","application/jsonml+json"],["jsx","text/jsx"],["jxr","image/jxr"],["jxra","image/jxra"],["jxrs","image/jxrs"],["jxs","image/jxs"],["jxsc","image/jxsc"],["jxsi","image/jxsi"],["jxss","image/jxss"],["kar","audio/midi"],["karbon","application/vnd.kde.karbon"],["kdb","application/octet-stream"],["kdbx","application/x-keepass2"],["key","application/x-iwork-keynote-sffkey"],["kfo","application/vnd.kde.kformula"],["kia","application/vnd.kidspiration"],["kml","application/vnd.google-earth.kml+xml"],["kmz","application/vnd.google-earth.kmz"],["kne","application/vnd.kinar"],["knp","application/vnd.kinar"],["kon","application/vnd.kde.kontour"],["kpr","application/vnd.kde.kpresenter"],["kpt","application/vnd.kde.kpresenter"],["kpxx","application/vnd.ds-keypoint"],["ksp","application/vnd.kde.kspread"],["ktr","application/vnd.kahootz"],["ktx","image/ktx"],["ktx2","image/ktx2"],["ktz","application/vnd.kahootz"],["kwd","application/vnd.kde.kword"],["kwt","application/vnd.kde.kword"],["lasxml","application/vnd.las.las+xml"],["latex","application/x-latex"],["lbd","application/vnd.llamagraphics.life-balance.desktop"],["lbe","application/vnd.llamagraphics.life-balance.exchange+xml"],["les","application/vnd.hhe.lesson-player"],["less","text/less"],["lgr","application/lgr+xml"],["lha","application/octet-stream"],["link66","application/vnd.route66.link66+xml"],["list","text/plain"],["list3820","application/vnd.ibm.modcap"],["listafp","application/vnd.ibm.modcap"],["litcoffee","text/coffeescript"],["lnk","application/x-ms-shortcut"],["log","text/plain"],["lostxml","application/lost+xml"],["lrf","application/octet-stream"],["lrm","application/vnd.ms-lrm"],["ltf","application/vnd.frogans.ltf"],["lua","text/x-lua"],["luac","application/x-lua-bytecode"],["lvp","audio/vnd.lucent.voice"],["lwp","application/vnd.lotus-wordpro"],["lzh","application/octet-stream"],["m1v","video/mpeg"],["m2a","audio/mpeg"],["m2v","video/mpeg"],["m3a","audio/mpeg"],["m3u","text/plain"],["m3u8","application/vnd.apple.mpegurl"],["m4a","audio/x-m4a"],["m4p","application/mp4"],["m4s","video/iso.segment"],["m4u","application/vnd.mpegurl"],["m4v","video/x-m4v"],["m13","application/x-msmediaview"],["m14","application/x-msmediaview"],["m21","application/mp21"],["ma","application/mathematica"],["mads","application/mads+xml"],["maei","application/mmt-aei+xml"],["mag","application/vnd.ecowin.chart"],["maker","application/vnd.framemaker"],["man","text/troff"],["manifest","text/cache-manifest"],["map","application/json"],["mar","application/octet-stream"],["markdown","text/markdown"],["mathml","application/mathml+xml"],["mb","application/mathematica"],["mbk","application/vnd.mobius.mbk"],["mbox","application/mbox"],["mc1","application/vnd.medcalcdata"],["mcd","application/vnd.mcd"],["mcurl","text/vnd.curl.mcurl"],["md","text/markdown"],["mdb","application/x-msaccess"],["mdi","image/vnd.ms-modi"],["mdx","text/mdx"],["me","text/troff"],["mesh","model/mesh"],["meta4","application/metalink4+xml"],["metalink","application/metalink+xml"],["mets","application/mets+xml"],["mfm","application/vnd.mfmp"],["mft","application/rpki-manifest"],["mgp","application/vnd.osgeo.mapguide.package"],["mgz","application/vnd.proteus.magazine"],["mid","audio/midi"],["midi","audio/midi"],["mie","application/x-mie"],["mif","application/vnd.mif"],["mime","message/rfc822"],["mj2","video/mj2"],["mjp2","video/mj2"],["mjs","application/javascript"],["mk3d","video/x-matroska"],["mka","audio/x-matroska"],["mkd","text/x-markdown"],["mks","video/x-matroska"],["mkv","video/x-matroska"],["mlp","application/vnd.dolby.mlp"],["mmd","application/vnd.chipnuts.karaoke-mmd"],["mmf","application/vnd.smaf"],["mml","text/mathml"],["mmr","image/vnd.fujixerox.edmics-mmr"],["mng","video/x-mng"],["mny","application/x-msmoney"],["mobi","application/x-mobipocket-ebook"],["mods","application/mods+xml"],["mov","video/quicktime"],["movie","video/x-sgi-movie"],["mp2","audio/mpeg"],["mp2a","audio/mpeg"],["mp3","audio/mpeg"],["mp4","video/mp4"],["mp4a","audio/mp4"],["mp4s","application/mp4"],["mp4v","video/mp4"],["mp21","application/mp21"],["mpc","application/vnd.mophun.certificate"],["mpd","application/dash+xml"],["mpe","video/mpeg"],["mpeg","video/mpeg"],["mpg","video/mpeg"],["mpg4","video/mp4"],["mpga","audio/mpeg"],["mpkg","application/vnd.apple.installer+xml"],["mpm","application/vnd.blueice.multipass"],["mpn","application/vnd.mophun.application"],["mpp","application/vnd.ms-project"],["mpt","application/vnd.ms-project"],["mpy","application/vnd.ibm.minipay"],["mqy","application/vnd.mobius.mqy"],["mrc","application/marc"],["mrcx","application/marcxml+xml"],["ms","text/troff"],["mscml","application/mediaservercontrol+xml"],["mseed","application/vnd.fdsn.mseed"],["mseq","application/vnd.mseq"],["msf","application/vnd.epson.msf"],["msg","application/vnd.ms-outlook"],["msh","model/mesh"],["msi","application/x-msdownload"],["msl","application/vnd.mobius.msl"],["msm","application/octet-stream"],["msp","application/octet-stream"],["msty","application/vnd.muvee.style"],["mtl","model/mtl"],["mts","model/vnd.mts"],["mus","application/vnd.musician"],["musd","application/mmt-usd+xml"],["musicxml","application/vnd.recordare.musicxml+xml"],["mvb","application/x-msmediaview"],["mvt","application/vnd.mapbox-vector-tile"],["mwf","application/vnd.mfer"],["mxf","application/mxf"],["mxl","application/vnd.recordare.musicxml"],["mxmf","audio/mobile-xmf"],["mxml","application/xv+xml"],["mxs","application/vnd.triscape.mxs"],["mxu","video/vnd.mpegurl"],["n-gage","application/vnd.nokia.n-gage.symbian.install"],["n3","text/n3"],["nb","application/mathematica"],["nbp","application/vnd.wolfram.player"],["nc","application/x-netcdf"],["ncx","application/x-dtbncx+xml"],["nfo","text/x-nfo"],["ngdat","application/vnd.nokia.n-gage.data"],["nitf","application/vnd.nitf"],["nlu","application/vnd.neurolanguage.nlu"],["nml","application/vnd.enliven"],["nnd","application/vnd.noblenet-directory"],["nns","application/vnd.noblenet-sealer"],["nnw","application/vnd.noblenet-web"],["npx","image/vnd.net-fpx"],["nq","application/n-quads"],["nsc","application/x-conference"],["nsf","application/vnd.lotus-notes"],["nt","application/n-triples"],["ntf","application/vnd.nitf"],["numbers","application/x-iwork-numbers-sffnumbers"],["nzb","application/x-nzb"],["oa2","application/vnd.fujitsu.oasys2"],["oa3","application/vnd.fujitsu.oasys3"],["oas","application/vnd.fujitsu.oasys"],["obd","application/x-msbinder"],["obgx","application/vnd.openblox.game+xml"],["obj","model/obj"],["oda","application/oda"],["odb","application/vnd.oasis.opendocument.database"],["odc","application/vnd.oasis.opendocument.chart"],["odf","application/vnd.oasis.opendocument.formula"],["odft","application/vnd.oasis.opendocument.formula-template"],["odg","application/vnd.oasis.opendocument.graphics"],["odi","application/vnd.oasis.opendocument.image"],["odm","application/vnd.oasis.opendocument.text-master"],["odp","application/vnd.oasis.opendocument.presentation"],["ods","application/vnd.oasis.opendocument.spreadsheet"],["odt","application/vnd.oasis.opendocument.text"],["oga","audio/ogg"],["ogex","model/vnd.opengex"],["ogg","audio/ogg"],["ogv","video/ogg"],["ogx","application/ogg"],["omdoc","application/omdoc+xml"],["onepkg","application/onenote"],["onetmp","application/onenote"],["onetoc","application/onenote"],["onetoc2","application/onenote"],["opf","application/oebps-package+xml"],["opml","text/x-opml"],["oprc","application/vnd.palm"],["opus","audio/ogg"],["org","text/x-org"],["osf","application/vnd.yamaha.openscoreformat"],["osfpvg","application/vnd.yamaha.openscoreformat.osfpvg+xml"],["osm","application/vnd.openstreetmap.data+xml"],["otc","application/vnd.oasis.opendocument.chart-template"],["otf","font/otf"],["otg","application/vnd.oasis.opendocument.graphics-template"],["oth","application/vnd.oasis.opendocument.text-web"],["oti","application/vnd.oasis.opendocument.image-template"],["otp","application/vnd.oasis.opendocument.presentation-template"],["ots","application/vnd.oasis.opendocument.spreadsheet-template"],["ott","application/vnd.oasis.opendocument.text-template"],["ova","application/x-virtualbox-ova"],["ovf","application/x-virtualbox-ovf"],["owl","application/rdf+xml"],["oxps","application/oxps"],["oxt","application/vnd.openofficeorg.extension"],["p","text/x-pascal"],["p7a","application/x-pkcs7-signature"],["p7b","application/x-pkcs7-certificates"],["p7c","application/pkcs7-mime"],["p7m","application/pkcs7-mime"],["p7r","application/x-pkcs7-certreqresp"],["p7s","application/pkcs7-signature"],["p8","application/pkcs8"],["p10","application/x-pkcs10"],["p12","application/x-pkcs12"],["pac","application/x-ns-proxy-autoconfig"],["pages","application/x-iwork-pages-sffpages"],["pas","text/x-pascal"],["paw","application/vnd.pawaafile"],["pbd","application/vnd.powerbuilder6"],["pbm","image/x-portable-bitmap"],["pcap","application/vnd.tcpdump.pcap"],["pcf","application/x-font-pcf"],["pcl","application/vnd.hp-pcl"],["pclxl","application/vnd.hp-pclxl"],["pct","image/x-pict"],["pcurl","application/vnd.curl.pcurl"],["pcx","image/x-pcx"],["pdb","application/x-pilot"],["pde","text/x-processing"],["pdf","application/pdf"],["pem","application/x-x509-user-cert"],["pfa","application/x-font-type1"],["pfb","application/x-font-type1"],["pfm","application/x-font-type1"],["pfr","application/font-tdpfr"],["pfx","application/x-pkcs12"],["pgm","image/x-portable-graymap"],["pgn","application/x-chess-pgn"],["pgp","application/pgp"],["php","application/x-httpd-php"],["php3","application/x-httpd-php"],["php4","application/x-httpd-php"],["phps","application/x-httpd-php-source"],["phtml","application/x-httpd-php"],["pic","image/x-pict"],["pkg","application/octet-stream"],["pki","application/pkixcmp"],["pkipath","application/pkix-pkipath"],["pkpass","application/vnd.apple.pkpass"],["pl","application/x-perl"],["plb","application/vnd.3gpp.pic-bw-large"],["plc","application/vnd.mobius.plc"],["plf","application/vnd.pocketlearn"],["pls","application/pls+xml"],["pm","application/x-perl"],["pml","application/vnd.ctc-posml"],["png","image/png"],["pnm","image/x-portable-anymap"],["portpkg","application/vnd.macports.portpkg"],["pot","application/vnd.ms-powerpoint"],["potm","application/vnd.ms-powerpoint.presentation.macroEnabled.12"],["potx","application/vnd.openxmlformats-officedocument.presentationml.template"],["ppa","application/vnd.ms-powerpoint"],["ppam","application/vnd.ms-powerpoint.addin.macroEnabled.12"],["ppd","application/vnd.cups-ppd"],["ppm","image/x-portable-pixmap"],["pps","application/vnd.ms-powerpoint"],["ppsm","application/vnd.ms-powerpoint.slideshow.macroEnabled.12"],["ppsx","application/vnd.openxmlformats-officedocument.presentationml.slideshow"],["ppt","application/powerpoint"],["pptm","application/vnd.ms-powerpoint.presentation.macroEnabled.12"],["pptx","application/vnd.openxmlformats-officedocument.presentationml.presentation"],["pqa","application/vnd.palm"],["prc","application/x-pilot"],["pre","application/vnd.lotus-freelance"],["prf","application/pics-rules"],["provx","application/provenance+xml"],["ps","application/postscript"],["psb","application/vnd.3gpp.pic-bw-small"],["psd","application/x-photoshop"],["psf","application/x-font-linux-psf"],["pskcxml","application/pskc+xml"],["pti","image/prs.pti"],["ptid","application/vnd.pvi.ptid1"],["pub","application/x-mspublisher"],["pvb","application/vnd.3gpp.pic-bw-var"],["pwn","application/vnd.3m.post-it-notes"],["pya","audio/vnd.ms-playready.media.pya"],["pyv","video/vnd.ms-playready.media.pyv"],["qam","application/vnd.epson.quickanime"],["qbo","application/vnd.intu.qbo"],["qfx","application/vnd.intu.qfx"],["qps","application/vnd.publishare-delta-tree"],["qt","video/quicktime"],["qwd","application/vnd.quark.quarkxpress"],["qwt","application/vnd.quark.quarkxpress"],["qxb","application/vnd.quark.quarkxpress"],["qxd","application/vnd.quark.quarkxpress"],["qxl","application/vnd.quark.quarkxpress"],["qxt","application/vnd.quark.quarkxpress"],["ra","audio/x-realaudio"],["ram","audio/x-pn-realaudio"],["raml","application/raml+yaml"],["rapd","application/route-apd+xml"],["rar","application/x-rar"],["ras","image/x-cmu-raster"],["rcprofile","application/vnd.ipunplugged.rcprofile"],["rdf","application/rdf+xml"],["rdz","application/vnd.data-vision.rdz"],["relo","application/p2p-overlay+xml"],["rep","application/vnd.businessobjects"],["res","application/x-dtbresource+xml"],["rgb","image/x-rgb"],["rif","application/reginfo+xml"],["rip","audio/vnd.rip"],["ris","application/x-research-info-systems"],["rl","application/resource-lists+xml"],["rlc","image/vnd.fujixerox.edmics-rlc"],["rld","application/resource-lists-diff+xml"],["rm","audio/x-pn-realaudio"],["rmi","audio/midi"],["rmp","audio/x-pn-realaudio-plugin"],["rms","application/vnd.jcp.javame.midlet-rms"],["rmvb","application/vnd.rn-realmedia-vbr"],["rnc","application/relax-ng-compact-syntax"],["rng","application/xml"],["roa","application/rpki-roa"],["roff","text/troff"],["rp9","application/vnd.cloanto.rp9"],["rpm","audio/x-pn-realaudio-plugin"],["rpss","application/vnd.nokia.radio-presets"],["rpst","application/vnd.nokia.radio-preset"],["rq","application/sparql-query"],["rs","application/rls-services+xml"],["rsa","application/x-pkcs7"],["rsat","application/atsc-rsat+xml"],["rsd","application/rsd+xml"],["rsheet","application/urc-ressheet+xml"],["rss","application/rss+xml"],["rtf","text/rtf"],["rtx","text/richtext"],["run","application/x-makeself"],["rusd","application/route-usd+xml"],["rv","video/vnd.rn-realvideo"],["s","text/x-asm"],["s3m","audio/s3m"],["saf","application/vnd.yamaha.smaf-audio"],["sass","text/x-sass"],["sbml","application/sbml+xml"],["sc","application/vnd.ibm.secure-container"],["scd","application/x-msschedule"],["scm","application/vnd.lotus-screencam"],["scq","application/scvp-cv-request"],["scs","application/scvp-cv-response"],["scss","text/x-scss"],["scurl","text/vnd.curl.scurl"],["sda","application/vnd.stardivision.draw"],["sdc","application/vnd.stardivision.calc"],["sdd","application/vnd.stardivision.impress"],["sdkd","application/vnd.solent.sdkm+xml"],["sdkm","application/vnd.solent.sdkm+xml"],["sdp","application/sdp"],["sdw","application/vnd.stardivision.writer"],["sea","application/octet-stream"],["see","application/vnd.seemail"],["seed","application/vnd.fdsn.seed"],["sema","application/vnd.sema"],["semd","application/vnd.semd"],["semf","application/vnd.semf"],["senmlx","application/senml+xml"],["sensmlx","application/sensml+xml"],["ser","application/java-serialized-object"],["setpay","application/set-payment-initiation"],["setreg","application/set-registration-initiation"],["sfd-hdstx","application/vnd.hydrostatix.sof-data"],["sfs","application/vnd.spotfire.sfs"],["sfv","text/x-sfv"],["sgi","image/sgi"],["sgl","application/vnd.stardivision.writer-global"],["sgm","text/sgml"],["sgml","text/sgml"],["sh","application/x-sh"],["shar","application/x-shar"],["shex","text/shex"],["shf","application/shf+xml"],["shtml","text/html"],["sid","image/x-mrsid-image"],["sieve","application/sieve"],["sig","application/pgp-signature"],["sil","audio/silk"],["silo","model/mesh"],["sis","application/vnd.symbian.install"],["sisx","application/vnd.symbian.install"],["sit","application/x-stuffit"],["sitx","application/x-stuffitx"],["siv","application/sieve"],["skd","application/vnd.koan"],["skm","application/vnd.koan"],["skp","application/vnd.koan"],["skt","application/vnd.koan"],["sldm","application/vnd.ms-powerpoint.slide.macroenabled.12"],["sldx","application/vnd.openxmlformats-officedocument.presentationml.slide"],["slim","text/slim"],["slm","text/slim"],["sls","application/route-s-tsid+xml"],["slt","application/vnd.epson.salt"],["sm","application/vnd.stepmania.stepchart"],["smf","application/vnd.stardivision.math"],["smi","application/smil"],["smil","application/smil"],["smv","video/x-smv"],["smzip","application/vnd.stepmania.package"],["snd","audio/basic"],["snf","application/x-font-snf"],["so","application/octet-stream"],["spc","application/x-pkcs7-certificates"],["spdx","text/spdx"],["spf","application/vnd.yamaha.smaf-phrase"],["spl","application/x-futuresplash"],["spot","text/vnd.in3d.spot"],["spp","application/scvp-vp-response"],["spq","application/scvp-vp-request"],["spx","audio/ogg"],["sql","application/x-sql"],["src","application/x-wais-source"],["srt","application/x-subrip"],["sru","application/sru+xml"],["srx","application/sparql-results+xml"],["ssdl","application/ssdl+xml"],["sse","application/vnd.kodak-descriptor"],["ssf","application/vnd.epson.ssf"],["ssml","application/ssml+xml"],["sst","application/octet-stream"],["st","application/vnd.sailingtracker.track"],["stc","application/vnd.sun.xml.calc.template"],["std","application/vnd.sun.xml.draw.template"],["stf","application/vnd.wt.stf"],["sti","application/vnd.sun.xml.impress.template"],["stk","application/hyperstudio"],["stl","model/stl"],["stpx","model/step+xml"],["stpxz","model/step-xml+zip"],["stpz","model/step+zip"],["str","application/vnd.pg.format"],["stw","application/vnd.sun.xml.writer.template"],["styl","text/stylus"],["stylus","text/stylus"],["sub","text/vnd.dvb.subtitle"],["sus","application/vnd.sus-calendar"],["susp","application/vnd.sus-calendar"],["sv4cpio","application/x-sv4cpio"],["sv4crc","application/x-sv4crc"],["svc","application/vnd.dvb.service"],["svd","application/vnd.svd"],["svg","image/svg+xml"],["svgz","image/svg+xml"],["swa","application/x-director"],["swf","application/x-shockwave-flash"],["swi","application/vnd.aristanetworks.swi"],["swidtag","application/swid+xml"],["sxc","application/vnd.sun.xml.calc"],["sxd","application/vnd.sun.xml.draw"],["sxg","application/vnd.sun.xml.writer.global"],["sxi","application/vnd.sun.xml.impress"],["sxm","application/vnd.sun.xml.math"],["sxw","application/vnd.sun.xml.writer"],["t","text/troff"],["t3","application/x-t3vm-image"],["t38","image/t38"],["taglet","application/vnd.mynfc"],["tao","application/vnd.tao.intent-module-archive"],["tap","image/vnd.tencent.tap"],["tar","application/x-tar"],["tcap","application/vnd.3gpp2.tcap"],["tcl","application/x-tcl"],["td","application/urc-targetdesc+xml"],["teacher","application/vnd.smart.teacher"],["tei","application/tei+xml"],["teicorpus","application/tei+xml"],["tex","application/x-tex"],["texi","application/x-texinfo"],["texinfo","application/x-texinfo"],["text","text/plain"],["tfi","application/thraud+xml"],["tfm","application/x-tex-tfm"],["tfx","image/tiff-fx"],["tga","image/x-tga"],["tgz","application/x-tar"],["thmx","application/vnd.ms-officetheme"],["tif","image/tiff"],["tiff","image/tiff"],["tk","application/x-tcl"],["tmo","application/vnd.tmobile-livetv"],["toml","application/toml"],["torrent","application/x-bittorrent"],["tpl","application/vnd.groove-tool-template"],["tpt","application/vnd.trid.tpt"],["tr","text/troff"],["tra","application/vnd.trueapp"],["trig","application/trig"],["trm","application/x-msterminal"],["ts","video/mp2t"],["tsd","application/timestamped-data"],["tsv","text/tab-separated-values"],["ttc","font/collection"],["ttf","font/ttf"],["ttl","text/turtle"],["ttml","application/ttml+xml"],["twd","application/vnd.simtech-mindmapper"],["twds","application/vnd.simtech-mindmapper"],["txd","application/vnd.genomatix.tuxedo"],["txf","application/vnd.mobius.txf"],["txt","text/plain"],["u8dsn","message/global-delivery-status"],["u8hdr","message/global-headers"],["u8mdn","message/global-disposition-notification"],["u8msg","message/global"],["u32","application/x-authorware-bin"],["ubj","application/ubjson"],["udeb","application/x-debian-package"],["ufd","application/vnd.ufdl"],["ufdl","application/vnd.ufdl"],["ulx","application/x-glulx"],["umj","application/vnd.umajin"],["unityweb","application/vnd.unity"],["uoml","application/vnd.uoml+xml"],["uri","text/uri-list"],["uris","text/uri-list"],["urls","text/uri-list"],["usdz","model/vnd.usdz+zip"],["ustar","application/x-ustar"],["utz","application/vnd.uiq.theme"],["uu","text/x-uuencode"],["uva","audio/vnd.dece.audio"],["uvd","application/vnd.dece.data"],["uvf","application/vnd.dece.data"],["uvg","image/vnd.dece.graphic"],["uvh","video/vnd.dece.hd"],["uvi","image/vnd.dece.graphic"],["uvm","video/vnd.dece.mobile"],["uvp","video/vnd.dece.pd"],["uvs","video/vnd.dece.sd"],["uvt","application/vnd.dece.ttml+xml"],["uvu","video/vnd.uvvu.mp4"],["uvv","video/vnd.dece.video"],["uvva","audio/vnd.dece.audio"],["uvvd","application/vnd.dece.data"],["uvvf","application/vnd.dece.data"],["uvvg","image/vnd.dece.graphic"],["uvvh","video/vnd.dece.hd"],["uvvi","image/vnd.dece.graphic"],["uvvm","video/vnd.dece.mobile"],["uvvp","video/vnd.dece.pd"],["uvvs","video/vnd.dece.sd"],["uvvt","application/vnd.dece.ttml+xml"],["uvvu","video/vnd.uvvu.mp4"],["uvvv","video/vnd.dece.video"],["uvvx","application/vnd.dece.unspecified"],["uvvz","application/vnd.dece.zip"],["uvx","application/vnd.dece.unspecified"],["uvz","application/vnd.dece.zip"],["vbox","application/x-virtualbox-vbox"],["vbox-extpack","application/x-virtualbox-vbox-extpack"],["vcard","text/vcard"],["vcd","application/x-cdlink"],["vcf","text/x-vcard"],["vcg","application/vnd.groove-vcard"],["vcs","text/x-vcalendar"],["vcx","application/vnd.vcx"],["vdi","application/x-virtualbox-vdi"],["vds","model/vnd.sap.vds"],["vhd","application/x-virtualbox-vhd"],["vis","application/vnd.visionary"],["viv","video/vnd.vivo"],["vlc","application/videolan"],["vmdk","application/x-virtualbox-vmdk"],["vob","video/x-ms-vob"],["vor","application/vnd.stardivision.writer"],["vox","application/x-authorware-bin"],["vrml","model/vrml"],["vsd","application/vnd.visio"],["vsf","application/vnd.vsf"],["vss","application/vnd.visio"],["vst","application/vnd.visio"],["vsw","application/vnd.visio"],["vtf","image/vnd.valve.source.texture"],["vtt","text/vtt"],["vtu","model/vnd.vtu"],["vxml","application/voicexml+xml"],["w3d","application/x-director"],["wad","application/x-doom"],["wadl","application/vnd.sun.wadl+xml"],["war","application/java-archive"],["wasm","application/wasm"],["wav","audio/x-wav"],["wax","audio/x-ms-wax"],["wbmp","image/vnd.wap.wbmp"],["wbs","application/vnd.criticaltools.wbs+xml"],["wbxml","application/wbxml"],["wcm","application/vnd.ms-works"],["wdb","application/vnd.ms-works"],["wdp","image/vnd.ms-photo"],["weba","audio/webm"],["webapp","application/x-web-app-manifest+json"],["webm","video/webm"],["webmanifest","application/manifest+json"],["webp","image/webp"],["wg","application/vnd.pmi.widget"],["wgt","application/widget"],["wks","application/vnd.ms-works"],["wm","video/x-ms-wm"],["wma","audio/x-ms-wma"],["wmd","application/x-ms-wmd"],["wmf","image/wmf"],["wml","text/vnd.wap.wml"],["wmlc","application/wmlc"],["wmls","text/vnd.wap.wmlscript"],["wmlsc","application/vnd.wap.wmlscriptc"],["wmv","video/x-ms-wmv"],["wmx","video/x-ms-wmx"],["wmz","application/x-msmetafile"],["woff","font/woff"],["woff2","font/woff2"],["word","application/msword"],["wpd","application/vnd.wordperfect"],["wpl","application/vnd.ms-wpl"],["wps","application/vnd.ms-works"],["wqd","application/vnd.wqd"],["wri","application/x-mswrite"],["wrl","model/vrml"],["wsc","message/vnd.wfa.wsc"],["wsdl","application/wsdl+xml"],["wspolicy","application/wspolicy+xml"],["wtb","application/vnd.webturbo"],["wvx","video/x-ms-wvx"],["x3d","model/x3d+xml"],["x3db","model/x3d+fastinfoset"],["x3dbz","model/x3d+binary"],["x3dv","model/x3d-vrml"],["x3dvz","model/x3d+vrml"],["x3dz","model/x3d+xml"],["x32","application/x-authorware-bin"],["x_b","model/vnd.parasolid.transmit.binary"],["x_t","model/vnd.parasolid.transmit.text"],["xaml","application/xaml+xml"],["xap","application/x-silverlight-app"],["xar","application/vnd.xara"],["xav","application/xcap-att+xml"],["xbap","application/x-ms-xbap"],["xbd","application/vnd.fujixerox.docuworks.binder"],["xbm","image/x-xbitmap"],["xca","application/xcap-caps+xml"],["xcs","application/calendar+xml"],["xdf","application/xcap-diff+xml"],["xdm","application/vnd.syncml.dm+xml"],["xdp","application/vnd.adobe.xdp+xml"],["xdssc","application/dssc+xml"],["xdw","application/vnd.fujixerox.docuworks"],["xel","application/xcap-el+xml"],["xenc","application/xenc+xml"],["xer","application/patch-ops-error+xml"],["xfdf","application/vnd.adobe.xfdf"],["xfdl","application/vnd.xfdl"],["xht","application/xhtml+xml"],["xhtml","application/xhtml+xml"],["xhvml","application/xv+xml"],["xif","image/vnd.xiff"],["xl","application/excel"],["xla","application/vnd.ms-excel"],["xlam","application/vnd.ms-excel.addin.macroEnabled.12"],["xlc","application/vnd.ms-excel"],["xlf","application/xliff+xml"],["xlm","application/vnd.ms-excel"],["xls","application/vnd.ms-excel"],["xlsb","application/vnd.ms-excel.sheet.binary.macroEnabled.12"],["xlsm","application/vnd.ms-excel.sheet.macroEnabled.12"],["xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],["xlt","application/vnd.ms-excel"],["xltm","application/vnd.ms-excel.template.macroEnabled.12"],["xltx","application/vnd.openxmlformats-officedocument.spreadsheetml.template"],["xlw","application/vnd.ms-excel"],["xm","audio/xm"],["xml","application/xml"],["xns","application/xcap-ns+xml"],["xo","application/vnd.olpc-sugar"],["xop","application/xop+xml"],["xpi","application/x-xpinstall"],["xpl","application/xproc+xml"],["xpm","image/x-xpixmap"],["xpr","application/vnd.is-xpr"],["xps","application/vnd.ms-xpsdocument"],["xpw","application/vnd.intercon.formnet"],["xpx","application/vnd.intercon.formnet"],["xsd","application/xml"],["xsl","application/xml"],["xslt","application/xslt+xml"],["xsm","application/vnd.syncml+xml"],["xspf","application/xspf+xml"],["xul","application/vnd.mozilla.xul+xml"],["xvm","application/xv+xml"],["xvml","application/xv+xml"],["xwd","image/x-xwindowdump"],["xyz","chemical/x-xyz"],["xz","application/x-xz"],["yaml","text/yaml"],["yang","application/yang"],["yin","application/yin+xml"],["yml","text/yaml"],["ymp","text/x-suse-ymp"],["z","application/x-compress"],["z1","application/x-zmachine"],["z2","application/x-zmachine"],["z3","application/x-zmachine"],["z4","application/x-zmachine"],["z5","application/x-zmachine"],["z6","application/x-zmachine"],["z7","application/x-zmachine"],["z8","application/x-zmachine"],["zaz","application/vnd.zzazz.deck+xml"],["zip","application/zip"],["zir","application/vnd.zul"],["zirz","application/vnd.zul"],["zmm","application/vnd.handheld-entertainment+xml"],["zsh","text/x-scriptzsh"]]);function Km(S,v,y){const A=lK(S),{webkitRelativePath:V}=S,B=typeof v=="string"?v:typeof V=="string"&&V.length>0?V:`./${S.name}`;return typeof A.path!="string"&&Ej(A,"path",B),Ej(A,"relativePath",B),A}function lK(S){const{name:v}=S;if(v&&v.lastIndexOf(".")!==-1&&!S.type){const A=v.split(".").pop().toLowerCase(),V=cK.get(A);V&&Object.defineProperty(S,"type",{value:V,writable:!1,configurable:!1,enumerable:!0})}return S}function Ej(S,v,y){Object.defineProperty(S,v,{value:y,writable:!1,configurable:!1,enumerable:!0})}const dK=[".DS_Store","Thumbs.db"];function uK(S){return lp(this,void 0,void 0,function*(){return Vb(S)&&hK(S.dataTransfer)?_K(S.dataTransfer,S.type):pK(S)?fK(S):Array.isArray(S)&&S.every(v=>"getFile"in v&&typeof v.getFile=="function")?mK(S):[]})}function hK(S){return Vb(S)}function pK(S){return Vb(S)&&Vb(S.target)}function Vb(S){return typeof S=="object"&&S!==null}function fK(S){return EO(S.target.files).map(v=>Km(v))}function mK(S){return lp(this,void 0,void 0,function*(){return(yield Promise.all(S.map(y=>y.getFile()))).map(y=>Km(y))})}function _K(S,v){return lp(this,void 0,void 0,function*(){if(S.items){const y=EO(S.items).filter(V=>V.kind==="file");if(v!=="drop")return y;const A=yield Promise.all(y.map(EK));return gj(Yj(A))}return gj(EO(S.files).map(y=>Km(y)))})}function gj(S){return S.filter(v=>dK.indexOf(v.name)===-1)}function EO(S){if(S===null)return[];const v=[];for(let y=0;y<S.length;y++){const A=S[y];v.push(A)}return v}function EK(S){if(typeof S.webkitGetAsEntry!="function")return vj(S);const v=S.webkitGetAsEntry();return v&&v.isDirectory?Xj(v):vj(S,v)}function Yj(S){return S.reduce((v,y)=>[...v,...Array.isArray(y)?Yj(y):[y]],[])}function vj(S,v){return lp(this,void 0,void 0,function*(){var y;if(globalThis.isSecureContext&&typeof S.getAsFileSystemHandle=="function"){const B=yield S.getAsFileSystemHandle();if(B===null)throw new Error(`${S} is not a File`);if(B!==void 0){const Y=yield B.getFile();return Y.handle=B,Km(Y)}}const A=S.getAsFile();if(!A)throw new Error(`${S} is not a File`);return Km(A,(y=v==null?void 0:v.fullPath)!==null&&y!==void 0?y:void 0)})}function gK(S){return lp(this,void 0,void 0,function*(){return S.isDirectory?Xj(S):vK(S)})}function Xj(S){const v=S.createReader();return new Promise((y,A)=>{const V=[];function B(){v.readEntries(Y=>lp(this,void 0,void 0,function*(){if(Y.length){const et=Promise.all(Y.map(gK));V.push(et),B()}else try{const et=yield Promise.all(V);y(et)}catch(et){A(et)}}),Y=>{A(Y)})}B()})}function vK(S){return lp(this,void 0,void 0,function*(){return new Promise((v,y)=>{S.file(A=>{const V=Km(A,S.fullPath);v(V)},A=>{y(A)})})})}var kb={},Sj;function SK(){return Sj||(Sj=1,kb.__esModule=!0,kb.default=function(S,v){if(S&&v){var y=Array.isArray(v)?v:v.split(",");if(y.length===0)return!0;var A=S.name||"",V=(S.type||"").toLowerCase(),B=V.replace(/\/.*$/,"");return y.some(function(Y){var et=Y.trim().toLowerCase();return et.charAt(0)==="."?A.toLowerCase().endsWith(et):et.endsWith("/*")?B===et.replace(/\/.*$/,""):V===et})}return!0}),kb}var TK=SK();const uO=Fb(TK);function Tj(S){return bK(S)||RK(S)||Jj(S)||yK()}function yK(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function RK(S){if(typeof Symbol<"u"&&S[Symbol.iterator]!=null||S["@@iterator"]!=null)return Array.from(S)}function bK(S){if(Array.isArray(S))return gO(S)}function yj(S,v){var y=Object.keys(S);if(Object.getOwnPropertySymbols){var A=Object.getOwnPropertySymbols(S);v&&(A=A.filter(function(V){return Object.getOwnPropertyDescriptor(S,V).enumerable})),y.push.apply(y,A)}return y}function Rj(S){for(var v=1;v<arguments.length;v++){var y=arguments[v]!=null?arguments[v]:{};v%2?yj(Object(y),!0).forEach(function(A){Qj(S,A,y[A])}):Object.getOwnPropertyDescriptors?Object.defineProperties(S,Object.getOwnPropertyDescriptors(y)):yj(Object(y)).forEach(function(A){Object.defineProperty(S,A,Object.getOwnPropertyDescriptor(y,A))})}return S}function Qj(S,v,y){return v in S?Object.defineProperty(S,v,{value:y,enumerable:!0,configurable:!0,writable:!0}):S[v]=y,S}function Nv(S,v){return wK(S)||AK(S,v)||Jj(S,v)||CK()}function CK(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Jj(S,v){if(S){if(typeof S=="string")return gO(S,v);var y=Object.prototype.toString.call(S).slice(8,-1);if(y==="Object"&&S.constructor&&(y=S.constructor.name),y==="Map"||y==="Set")return Array.from(S);if(y==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(y))return gO(S,v)}}function gO(S,v){(v==null||v>S.length)&&(v=S.length);for(var y=0,A=new Array(v);y<v;y++)A[y]=S[y];return A}function AK(S,v){var y=S==null?null:typeof Symbol<"u"&&S[Symbol.iterator]||S["@@iterator"];if(y!=null){var A=[],V=!0,B=!1,Y,et;try{for(y=y.call(S);!(V=(Y=y.next()).done)&&(A.push(Y.value),!(v&&A.length===v));V=!0);}catch(J){B=!0,et=J}finally{try{!V&&y.return!=null&&y.return()}finally{if(B)throw et}}return A}}function wK(S){if(Array.isArray(S))return S}var IK=typeof uO=="function"?uO:uO.default,OK="file-invalid-type",NK="file-too-large",DK="file-too-small",PK="too-many-files",kK=function(){var v=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",y=v.split(","),A=y.length>1?"one of ".concat(y.join(", ")):y[0];return{code:OK,message:"File type must be ".concat(A)}},bj=function(v){return{code:NK,message:"File is larger than ".concat(v," ").concat(v===1?"byte":"bytes")}},Cj=function(v){return{code:DK,message:"File is smaller than ".concat(v," ").concat(v===1?"byte":"bytes")}},LK={code:PK,message:"Too many files"};function Zj(S,v){var y=S.type==="application/x-moz-file"||IK(S,v);return[y,y?null:kK(v)]}function $j(S,v,y){if(sp(S.size))if(sp(v)&&sp(y)){if(S.size>y)return[!1,bj(y)];if(S.size<v)return[!1,Cj(v)]}else{if(sp(v)&&S.size<v)return[!1,Cj(v)];if(sp(y)&&S.size>y)return[!1,bj(y)]}return[!0,null]}function sp(S){return S!=null}function xK(S){var v=S.files,y=S.accept,A=S.minSize,V=S.maxSize,B=S.multiple,Y=S.maxFiles,et=S.validator;return!B&&v.length>1||B&&Y>=1&&v.length>Y?!1:v.every(function(J){var Q=Zj(J,y),ht=Nv(Q,1),Et=ht[0],vt=$j(J,A,V),Ft=Nv(vt,1),xt=Ft[0],Oe=et?et(J):null;return Et&&xt&&!Oe})}function jb(S){return typeof S.isPropagationStopped=="function"?S.isPropagationStopped():typeof S.cancelBubble<"u"?S.cancelBubble:!1}function Lb(S){return S.dataTransfer?Array.prototype.some.call(S.dataTransfer.types,function(v){return v==="Files"||v==="application/x-moz-file"}):!!S.target&&!!S.target.files}function Aj(S){S.preventDefault()}function MK(S){return S.indexOf("MSIE")!==-1||S.indexOf("Trident/")!==-1}function UK(S){return S.indexOf("Edge/")!==-1}function VK(){var S=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.navigator.userAgent;return MK(S)||UK(S)}function Lc(){for(var S=arguments.length,v=new Array(S),y=0;y<S;y++)v[y]=arguments[y];return function(A){for(var V=arguments.length,B=new Array(V>1?V-1:0),Y=1;Y<V;Y++)B[Y-1]=arguments[Y];return v.some(function(et){return!jb(A)&&et&&et.apply(void 0,[A].concat(B)),jb(A)})}}function jK(){return"showOpenFilePicker"in window}function BK(S){if(sp(S)){var v=Object.entries(S).filter(function(y){var A=Nv(y,2),V=A[0],B=A[1],Y=!0;return tB(V)||(console.warn('Skipped "'.concat(V,'" because it is not a valid MIME type. Check https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types/Common_types for a list of valid MIME types.')),Y=!1),(!Array.isArray(B)||!B.every(eB))&&(console.warn('Skipped "'.concat(V,'" because an invalid file extension was provided.')),Y=!1),Y}).reduce(function(y,A){var V=Nv(A,2),B=V[0],Y=V[1];return Rj(Rj({},y),{},Qj({},B,Y))},{});return[{description:"Files",accept:v}]}return S}function FK(S){if(sp(S))return Object.entries(S).reduce(function(v,y){var A=Nv(y,2),V=A[0],B=A[1];return[].concat(Tj(v),[V],Tj(B))},[]).filter(function(v){return tB(v)||eB(v)}).join(",")}function GK(S){return S instanceof DOMException&&(S.name==="AbortError"||S.code===S.ABORT_ERR)}function HK(S){return S instanceof DOMException&&(S.name==="SecurityError"||S.code===S.SECURITY_ERR)}function tB(S){return S==="audio/*"||S==="video/*"||S==="image/*"||S==="text/*"||S==="application/*"||/\w+\/[-+.\w]+/g.test(S)}function eB(S){return/^.*\.[\w]+$/.test(S)}var WK=["children"],zK=["open"],qK=["refKey","role","onKeyDown","onFocus","onBlur","onClick","onDragEnter","onDragOver","onDragLeave","onDrop"],KK=["refKey","onChange","onClick"];function YK(S){return JK(S)||QK(S)||nB(S)||XK()}function XK(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function QK(S){if(typeof Symbol<"u"&&S[Symbol.iterator]!=null||S["@@iterator"]!=null)return Array.from(S)}function JK(S){if(Array.isArray(S))return vO(S)}function hO(S,v){return tY(S)||$K(S,v)||nB(S,v)||ZK()}function ZK(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function nB(S,v){if(S){if(typeof S=="string")return vO(S,v);var y=Object.prototype.toString.call(S).slice(8,-1);if(y==="Object"&&S.constructor&&(y=S.constructor.name),y==="Map"||y==="Set")return Array.from(S);if(y==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(y))return vO(S,v)}}function vO(S,v){(v==null||v>S.length)&&(v=S.length);for(var y=0,A=new Array(v);y<v;y++)A[y]=S[y];return A}function $K(S,v){var y=S==null?null:typeof Symbol<"u"&&S[Symbol.iterator]||S["@@iterator"];if(y!=null){var A=[],V=!0,B=!1,Y,et;try{for(y=y.call(S);!(V=(Y=y.next()).done)&&(A.push(Y.value),!(v&&A.length===v));V=!0);}catch(J){B=!0,et=J}finally{try{!V&&y.return!=null&&y.return()}finally{if(B)throw et}}return A}}function tY(S){if(Array.isArray(S))return S}function wj(S,v){var y=Object.keys(S);if(Object.getOwnPropertySymbols){var A=Object.getOwnPropertySymbols(S);v&&(A=A.filter(function(V){return Object.getOwnPropertyDescriptor(S,V).enumerable})),y.push.apply(y,A)}return y}function Ai(S){for(var v=1;v<arguments.length;v++){var y=arguments[v]!=null?arguments[v]:{};v%2?wj(Object(y),!0).forEach(function(A){SO(S,A,y[A])}):Object.getOwnPropertyDescriptors?Object.defineProperties(S,Object.getOwnPropertyDescriptors(y)):wj(Object(y)).forEach(function(A){Object.defineProperty(S,A,Object.getOwnPropertyDescriptor(y,A))})}return S}function SO(S,v,y){return v in S?Object.defineProperty(S,v,{value:y,enumerable:!0,configurable:!0,writable:!0}):S[v]=y,S}function Bb(S,v){if(S==null)return{};var y=eY(S,v),A,V;if(Object.getOwnPropertySymbols){var B=Object.getOwnPropertySymbols(S);for(V=0;V<B.length;V++)A=B[V],!(v.indexOf(A)>=0)&&Object.prototype.propertyIsEnumerable.call(S,A)&&(y[A]=S[A])}return y}function eY(S,v){if(S==null)return{};var y={},A=Object.keys(S),V,B;for(B=0;B<A.length;B++)V=A[B],!(v.indexOf(V)>=0)&&(y[V]=S[V]);return y}var IO=Ot.forwardRef(function(S,v){var y=S.children,A=Bb(S,WK),V=OO(A),B=V.open,Y=Bb(V,zK);return Ot.useImperativeHandle(v,function(){return{open:B}},[B]),kr.createElement(Ot.Fragment,null,y(Ai(Ai({},Y),{},{open:B})))});IO.displayName="Dropzone";var iB={disabled:!1,getFilesFromEvent:uK,maxSize:1/0,minSize:0,multiple:!0,maxFiles:0,preventDropOnDocument:!0,noClick:!1,noKeyboard:!1,noDrag:!1,noDragEventsBubbling:!1,validator:null,useFsAccessApi:!1,autoFocus:!1};IO.defaultProps=iB;IO.propTypes={children:ii.func,accept:ii.objectOf(ii.arrayOf(ii.string)),multiple:ii.bool,preventDropOnDocument:ii.bool,noClick:ii.bool,noKeyboard:ii.bool,noDrag:ii.bool,noDragEventsBubbling:ii.bool,minSize:ii.number,maxSize:ii.number,maxFiles:ii.number,disabled:ii.bool,getFilesFromEvent:ii.func,onFileDialogCancel:ii.func,onFileDialogOpen:ii.func,useFsAccessApi:ii.bool,autoFocus:ii.bool,onDragEnter:ii.func,onDragLeave:ii.func,onDragOver:ii.func,onDrop:ii.func,onDropAccepted:ii.func,onDropRejected:ii.func,onError:ii.func,validator:ii.func};var TO={isFocused:!1,isFileDialogActive:!1,isDragActive:!1,isDragAccept:!1,isDragReject:!1,acceptedFiles:[],fileRejections:[]};function OO(){var S=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},v=Ai(Ai({},iB),S),y=v.accept,A=v.disabled,V=v.getFilesFromEvent,B=v.maxSize,Y=v.minSize,et=v.multiple,J=v.maxFiles,Q=v.onDragEnter,ht=v.onDragLeave,Et=v.onDragOver,vt=v.onDrop,Ft=v.onDropAccepted,xt=v.onDropRejected,Oe=v.onFileDialogCancel,Ue=v.onFileDialogOpen,vn=v.useFsAccessApi,fn=v.autoFocus,Be=v.preventDropOnDocument,fe=v.noClick,Ae=v.noKeyboard,xn=v.noDrag,ue=v.noDragEventsBubbling,ln=v.onError,yn=v.validator,si=Ot.useMemo(function(){return FK(y)},[y]),wi=Ot.useMemo(function(){return BK(y)},[y]),qt=Ot.useMemo(function(){return typeof Ue=="function"?Ue:Ij},[Ue]),oe=Ot.useMemo(function(){return typeof Oe=="function"?Oe:Ij},[Oe]),Kt=Ot.useRef(null),ne=Ot.useRef(null),St=Ot.useReducer(nY,TO),kt=hO(St,2),te=kt[0],Ne=kt[1],tt=te.isFocused,Lt=te.isFileDialogActive,Gt=Ot.useRef(typeof window<"u"&&window.isSecureContext&&vn&&jK()),Ht=function(){!Gt.current&&Lt&&setTimeout(function(){if(ne.current){var ge=ne.current.files;ge.length||(Ne({type:"closeDialog"}),oe())}},300)};Ot.useEffect(function(){return window.addEventListener("focus",Ht,!1),function(){window.removeEventListener("focus",Ht,!1)}},[ne,Lt,oe,Gt]);var re=Ot.useRef([]),dn=function(ge){Kt.current&&Kt.current.contains(ge.target)||(ge.preventDefault(),re.current=[])};Ot.useEffect(function(){return Be&&(document.addEventListener("dragover",Aj,!1),document.addEventListener("drop",dn,!1)),function(){Be&&(document.removeEventListener("dragover",Aj),document.removeEventListener("drop",dn))}},[Kt,Be]),Ot.useEffect(function(){return!A&&fn&&Kt.current&&Kt.current.focus(),function(){}},[Kt,fn,A]);var me=Ot.useCallback(function(Ut){ln?ln(Ut):console.error(Ut)},[ln]),Ji=Ot.useCallback(function(Ut){Ut.preventDefault(),Ut.persist(),Xs(Ut),re.current=[].concat(YK(re.current),[Ut.target]),Lb(Ut)&&Promise.resolve(V(Ut)).then(function(ge){if(!(jb(Ut)&&!ue)){var Gn=ge.length,We=Gn>0&&xK({files:ge,accept:si,minSize:Y,maxSize:B,multiple:et,maxFiles:J,validator:yn}),oi=Gn>0&&!We;Ne({isDragAccept:We,isDragReject:oi,isDragActive:!0,type:"setDraggedFiles"}),Q&&Q(Ut)}}).catch(function(ge){return me(ge)})},[V,Q,me,ue,si,Y,B,et,J,yn]),Fn=Ot.useCallback(function(Ut){Ut.preventDefault(),Ut.persist(),Xs(Ut);var ge=Lb(Ut);if(ge&&Ut.dataTransfer)try{Ut.dataTransfer.dropEffect="copy"}catch{}return ge&&Et&&Et(Ut),!1},[Et,ue]),xr=Ot.useCallback(function(Ut){Ut.preventDefault(),Ut.persist(),Xs(Ut);var ge=re.current.filter(function(We){return Kt.current&&Kt.current.contains(We)}),Gn=ge.indexOf(Ut.target);Gn!==-1&&ge.splice(Gn,1),re.current=ge,!(ge.length>0)&&(Ne({type:"setDraggedFiles",isDragActive:!1,isDragAccept:!1,isDragReject:!1}),Lb(Ut)&&ht&&ht(Ut))},[Kt,ht,ue]),Ua=Ot.useCallback(function(Ut,ge){var Gn=[],We=[];Ut.forEach(function(oi){var gi=Zj(oi,si),Qs=hO(gi,2),xl=Qs[0],Ml=Qs[1],Js=$j(oi,Y,B),Rr=hO(Js,2),pa=Rr[0],Uo=Rr[1],Zs=yn?yn(oi):null;if(xl&&pa&&!Zs)Gn.push(oi);else{var hs=[Ml,Uo];Zs&&(hs=hs.concat(Zs)),We.push({file:oi,errors:hs.filter(function(hu){return hu})})}}),(!et&&Gn.length>1||et&&J>=1&&Gn.length>J)&&(Gn.forEach(function(oi){We.push({file:oi,errors:[LK]})}),Gn.splice(0)),Ne({acceptedFiles:Gn,fileRejections:We,isDragReject:We.length>0,type:"setFiles"}),vt&&vt(Gn,We,ge),We.length>0&&xt&&xt(We,ge),Gn.length>0&&Ft&&Ft(Gn,ge)},[Ne,et,si,Y,B,J,vt,Ft,xt,yn]),Ys=Ot.useCallback(function(Ut){Ut.preventDefault(),Ut.persist(),Xs(Ut),re.current=[],Lb(Ut)&&Promise.resolve(V(Ut)).then(function(ge){jb(Ut)&&!ue||Ua(ge,Ut)}).catch(function(ge){return me(ge)}),Ne({type:"reset"})},[V,Ua,me,ue]),us=Ot.useCallback(function(){if(Gt.current){Ne({type:"openDialog"}),qt();var Ut={multiple:et,types:wi};window.showOpenFilePicker(Ut).then(function(ge){return V(ge)}).then(function(ge){Ua(ge,null),Ne({type:"closeDialog"})}).catch(function(ge){GK(ge)?(oe(ge),Ne({type:"closeDialog"})):HK(ge)?(Gt.current=!1,ne.current?(ne.current.value=null,ne.current.click()):me(new Error("Cannot open the file picker because the https://developer.mozilla.org/en-US/docs/Web/API/File_System_Access_API is not supported and no <input> was provided."))):me(ge)});return}ne.current&&(Ne({type:"openDialog"}),qt(),ne.current.value=null,ne.current.click())},[Ne,qt,oe,vn,Ua,me,wi,et]),ha=Ot.useCallback(function(Ut){!Kt.current||!Kt.current.isEqualNode(Ut.target)||(Ut.key===" "||Ut.key==="Enter"||Ut.keyCode===32||Ut.keyCode===13)&&(Ut.preventDefault(),us())},[Kt,us]),Ll=Ot.useCallback(function(){Ne({type:"focus"})},[]),dp=Ot.useCallback(function(){Ne({type:"blur"})},[]),Va=Ot.useCallback(function(){fe||(VK()?setTimeout(us,0):us())},[fe,us]),sr=function(ge){return A?null:ge},Ei=function(ge){return Ae?null:sr(ge)},Ui=function(ge){return xn?null:sr(ge)},Xs=function(ge){ue&&ge.stopPropagation()},Mo=Ot.useMemo(function(){return function(){var Ut=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},ge=Ut.refKey,Gn=ge===void 0?"ref":ge,We=Ut.role,oi=Ut.onKeyDown,gi=Ut.onFocus,Qs=Ut.onBlur,xl=Ut.onClick,Ml=Ut.onDragEnter,Js=Ut.onDragOver,Rr=Ut.onDragLeave,pa=Ut.onDrop,Uo=Bb(Ut,qK);return Ai(Ai(SO({onKeyDown:Ei(Lc(oi,ha)),onFocus:Ei(Lc(gi,Ll)),onBlur:Ei(Lc(Qs,dp)),onClick:sr(Lc(xl,Va)),onDragEnter:Ui(Lc(Ml,Ji)),onDragOver:Ui(Lc(Js,Fn)),onDragLeave:Ui(Lc(Rr,xr)),onDrop:Ui(Lc(pa,Ys)),role:typeof We=="string"&&We!==""?We:"presentation"},Gn,Kt),!A&&!Ae?{tabIndex:0}:{}),Uo)}},[Kt,ha,Ll,dp,Va,Ji,Fn,xr,Ys,Ae,xn,A]),Ym=Ot.useCallback(function(Ut){Ut.stopPropagation()},[]),uu=Ot.useMemo(function(){return function(){var Ut=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},ge=Ut.refKey,Gn=ge===void 0?"ref":ge,We=Ut.onChange,oi=Ut.onClick,gi=Bb(Ut,KK),Qs=SO({accept:si,multiple:et,type:"file",style:{border:0,clip:"rect(0, 0, 0, 0)",clipPath:"inset(50%)",height:"1px",margin:"0 -1px -1px 0",overflow:"hidden",padding:0,position:"absolute",width:"1px",whiteSpace:"nowrap"},onChange:sr(Lc(We,Ys)),onClick:sr(Lc(oi,Ym)),tabIndex:-1},Gn,ne);return Ai(Ai({},Qs),gi)}},[ne,y,et,Ys,A]);return Ai(Ai({},te),{},{isFocused:tt&&!A,getRootProps:Mo,getInputProps:uu,rootRef:Kt,inputRef:ne,open:sr(us)})}function nY(S,v){switch(v.type){case"focus":return Ai(Ai({},S),{},{isFocused:!0});case"blur":return Ai(Ai({},S),{},{isFocused:!1});case"openDialog":return Ai(Ai({},TO),{},{isFileDialogActive:!0});case"closeDialog":return Ai(Ai({},S),{},{isFileDialogActive:!1});case"setDraggedFiles":return Ai(Ai({},S),{},{isDragActive:v.isDragActive,isDragAccept:v.isDragAccept,isDragReject:v.isDragReject});case"setFiles":return Ai(Ai({},S),{},{acceptedFiles:v.acceptedFiles,fileRejections:v.fileRejections,isDragReject:v.isDragReject});case"reset":return Ai({},TO);default:return S}}function Ij(){}function iY({post:S}){var ht;const v=Qi(He.users.getUserProfile),y=Mi(He.posts.react),A=Mi(He.posts.comment),[V,B]=Ot.useState(!1),[Y,et]=Ot.useState(""),J=(ht=S.reactions.find(Et=>Et.userId===(v==null?void 0:v.userId)))==null?void 0:ht.type,Q=async Et=>{Et.preventDefault(),Y&&(await A({postId:S._id,text:Y}),et(""))};return H.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[H.jsxs("div",{className:"flex items-center mb-2",children:[H.jsx("img",{src:S.authorImage??`https://ui-avatars.com/api/?name=${S.authorName}`,alt:S.authorName,className:"w-10 h-10 rounded-full mr-2"}),H.jsx("span",{className:"font-bold",children:S.authorName})]}),H.jsx("p",{className:"mb-2",children:S.text}),S.imageUrl&&H.jsx("img",{src:S.imageUrl,alt:"post",className:"rounded-lg w-full object-cover"}),H.jsxs("div",{className:"flex justify-between items-center mt-2 text-gray-500",children:[H.jsx("div",{children:Object.entries(S.reactions.reduce((Et,vt)=>(Et[vt.type]=(Et[vt.type]||0)+1,Et),{})).map(([Et,vt])=>H.jsxs("span",{className:"mr-2",children:[{like:"👍",love:"❤️",laugh:"😂",sad:"😢"}[Et]," ",vt]},Et))}),H.jsxs("button",{onClick:()=>B(!V),children:[S.commentCount," تعليقات"]})]}),H.jsx("div",{className:"border-t my-2"}),H.jsxs("div",{className:"flex justify-around",children:[["like","love","laugh","sad"].map(Et=>H.jsx("button",{onClick:()=>y({postId:S._id,type:Et}),className:`w-full text-center py-1 ${J===Et?"text-purple-600 font-bold":""}`,children:{like:"أعجبني",love:"أحببته",laugh:"أضحكني",sad:"أحزنني"}[Et]},Et)),H.jsx("button",{onClick:()=>B(!V),className:"w-full text-center py-1",children:"تعليق"})]}),V&&H.jsxs("div",{className:"border-t mt-2 pt-2",children:[S.comments.map(Et=>H.jsxs("div",{className:"flex items-start mb-2",children:[H.jsx("img",{src:Et.authorImage??`https://ui-avatars.com/api/?name=${Et.authorName}`,alt:Et.authorName,className:"w-8 h-8 rounded-full mr-2"}),H.jsxs("div",{children:[H.jsx("span",{className:"font-bold",children:Et.authorName}),H.jsx("p",{children:Et.text})]})]},Et._id)),H.jsxs("form",{onSubmit:Q,className:"flex mt-2",children:[H.jsx("input",{type:"text",value:Y,onChange:Et=>et(Et.target.value),placeholder:"أضف تعليق...",className:"flex-grow p-2 border rounded-l-lg"}),H.jsx("button",{type:"submit",className:"bg-purple-600 text-white px-4 rounded-r-lg",children:"نشر"})]})]})]})}function rY(){const S=Qi(He.posts.list)??[],v=Mi(He.posts.create),y=Mi(He.users.generateUploadUrl),[A,V]=Ot.useState(""),[B,Y]=Ot.useState(null),[et,J]=Ot.useState(!1),{getRootProps:Q,getInputProps:ht}=OO({accept:{"image/*":[]},onDrop:vt=>{Y(vt[0])}}),Et=async vt=>{if(vt.preventDefault(),!A)return;J(!0);let Ft;if(B){const xt=await y(),Oe=await fetch(xt,{method:"POST",headers:{"Content-Type":B.type},body:B}),{storageId:Ue}=await Oe.json();Ft=Ue}await v({text:A,imageId:Ft}),V(""),Y(null),J(!1)};return H.jsxs("div",{className:"p-4 space-y-4",children:[H.jsxs("form",{onSubmit:Et,className:"bg-white p-4 rounded-lg shadow space-y-2",children:[H.jsx("textarea",{value:A,onChange:vt=>V(vt.target.value),placeholder:"ماذا يدور في ذهنك؟",className:"w-full p-2 border rounded-lg"}),H.jsxs("div",{...Q(),className:"border-2 border-dashed border-gray-300 rounded-lg p-4 text-center cursor-pointer hover:bg-gray-50",children:[H.jsx("input",{...ht()}),B?H.jsx("p",{className:"text-purple-700",children:B.name}):H.jsx("p",{className:"text-gray-500",children:"إضافة صورة"})]}),H.jsx("button",{type:"submit",disabled:et,className:"w-full bg-purple-600 text-white p-2 rounded-lg font-semibold disabled:bg-gray-400",children:et?"جاري النشر...":"نشر"})]}),H.jsx("div",{className:"space-y-4",children:S.map(vt=>H.jsx(iY,{post:vt},vt._id))})]})}function aY(){const{isAuthenticated:S}=wO(),{signOut:v}=Kj();return S?H.jsx("button",{className:"px-4 py-2 rounded bg-white text-secondary border border-gray-200 font-semibold hover:bg-gray-50 hover:text-secondary-hover transition-colors shadow-sm hover:shadow",onClick:()=>void v(),children:"Sign out"}):null}function sY(){const S=Mi(He.users.completeProfile),v=Mi(He.users.generateUploadUrl),[y,A]=Ot.useState(""),[V,B]=Ot.useState("male"),[Y,et]=Ot.useState(""),[J,Q]=Ot.useState(""),[ht,Et]=Ot.useState(null),[vt,Ft]=Ot.useState(!1),{getRootProps:xt,getInputProps:Oe}=OO({accept:{"image/*":[]},onDrop:vn=>{Et(vn[0])}}),Ue=async vn=>{vn.preventDefault(),Ft(!0);let fn;if(ht){const Be=await v(),fe=await fetch(Be,{method:"POST",headers:{"Content-Type":ht.type},body:ht}),{storageId:Ae}=await fe.json();fn=Ae}await S({name:y,gender:V,birthDate:Y,country:J,imageId:fn})};return H.jsxs("div",{className:"flex flex-col items-center justify-center h-screen p-4 bg-purple-50",children:[H.jsx("h1",{className:"text-2xl font-bold text-purple-800 mb-4",children:"أكمل ملفك الشخصي"}),H.jsxs("form",{onSubmit:Ue,className:"w-full max-w-sm space-y-4 bg-white p-6 rounded-lg shadow-md",children:[H.jsxs("div",{...xt(),className:"border-2 border-dashed border-purple-400 rounded-lg p-4 text-center cursor-pointer hover:bg-purple-100",children:[H.jsx("input",{...Oe()}),ht?H.jsx("p",{className:"text-purple-800",children:ht.name}):H.jsx("p",{className:"text-gray-500",children:"اسحب وأفلت صورة الملف الشخصي هنا، أو انقر للاختيار"})]}),H.jsx("input",{type:"text",placeholder:"الاسم",value:y,onChange:vn=>A(vn.target.value),required:!0,className:"w-full p-2 border border-purple-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"}),H.jsxs("select",{value:V,onChange:vn=>B(vn.target.value),className:"w-full p-2 border border-purple-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500",children:[H.jsx("option",{value:"male",children:"ذكر"}),H.jsx("option",{value:"female",children:"أنثى"})]}),H.jsx("input",{type:"date",value:Y,onChange:vn=>et(vn.target.value),required:!0,className:"w-full p-2 border border-purple-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"}),H.jsx("input",{type:"text",placeholder:"الدولة",value:J,onChange:vn=>Q(vn.target.value),required:!0,className:"w-full p-2 border border-purple-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"}),H.jsx("button",{type:"submit",disabled:vt,className:"w-full bg-purple-600 text-white p-2 rounded-lg font-semibold disabled:bg-gray-400",children:vt?"جاري الحفظ...":"حفظ الملف الشخصي"})]})]})}function oY({targetUserId:S,roomId:v,onClose:y}){var xn,ue;const A=Qi(He.users.getUserPopupInfo,{userId:S}),V=Qi(He.rooms.get,{id:v}),B=Qi(He.users.getUserProfile),Y=Mi(He.users.follow),et=Mi(He.users.unfollow),J=Mi(He.rooms.appointAdmin),Q=Mi(He.rooms.removeAdmin),ht=Mi(He.rooms.kickUser),Et=Mi(He.rooms.banUser),[vt,Ft]=Ot.useState(60);if(!A||!V||!B)return null;const xt=B.userId===S,Oe=V.ownerId===B.userId,Ue=((xn=V.admins)==null?void 0:xn.includes(B.userId))??!1,vn=((ue=V.admins)==null?void 0:ue.includes(S))??!1,fn=V.ownerId===S,Be=(Oe||Ue)&&!fn,fe=()=>{Et({roomId:v,userId:S,durationMinutes:vt}),y()},Ae=()=>{ht({roomId:v,userId:S}),y()};return H.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50",onClick:y,children:H.jsxs("div",{className:"bg-white rounded-lg p-4 w-80 text-center text-gray-800",onClick:ln=>ln.stopPropagation(),children:[H.jsx("img",{src:A.imageUrl??`https://ui-avatars.com/api/?name=${A.name}`,alt:A.name??"",className:"w-20 h-20 rounded-full mx-auto border-4 border-purple-400"}),H.jsx("h2",{className:"text-xl font-bold mt-2",children:A.name}),H.jsxs("p",{className:"text-gray-500",children:["ID: ",A.displayId]}),H.jsxs("div",{className:"flex justify-center items-center gap-4 my-2",children:[H.jsxs("span",{className:"bg-purple-200 text-purple-800 px-2 py-1 rounded-full text-sm",children:["Lv. ",A.level]}),A.isVip&&H.jsx("span",{className:"bg-yellow-400 text-yellow-900 px-2 py-1 rounded-full text-sm font-bold",children:"VIP"})]}),H.jsx("div",{className:"flex flex-col gap-2 my-4",children:!xt&&(A.isFollowing?H.jsx("button",{onClick:()=>et({userId:S}),className:"bg-gray-300 py-2 rounded-lg",children:"إلغاء المتابعة"}):H.jsx("button",{onClick:()=>Y({userId:S}),className:"bg-purple-600 text-white py-2 rounded-lg",children:"متابعة"}))}),!xt&&Be&&H.jsxs("div",{className:"border-t pt-4",children:[H.jsx("h3",{className:"font-bold text-lg",children:"أدوات المشرف"}),H.jsxs("div",{className:"flex flex-col gap-2 mt-2",children:[Oe&&(vn?H.jsx("button",{onClick:()=>Q({roomId:v,userId:S}),className:"bg-orange-500 text-white py-2 rounded-lg",children:"إزالة كمشرف"}):H.jsx("button",{onClick:()=>J({roomId:v,userId:S}),className:"bg-green-500 text-white py-2 rounded-lg",children:"تعيين كمشرف"})),H.jsx("button",{onClick:Ae,className:"bg-yellow-500 text-white py-2 rounded-lg",children:"طرد من المقعد"}),H.jsxs("div",{className:"flex gap-2",children:[H.jsxs("select",{value:vt,onChange:ln=>Ft(parseInt(ln.target.value)),className:"p-2 border rounded-lg flex-grow",children:[H.jsx("option",{value:1,children:"دقيقة"}),H.jsx("option",{value:10,children:"10 دقائق"}),H.jsx("option",{value:60,children:"ساعة"}),H.jsx("option",{value:1440,children:"يوم"})]}),H.jsx("button",{onClick:fe,className:"bg-red-500 text-white py-2 px-4 rounded-lg",children:"حظر"})]})]})]}),H.jsx("button",{onClick:y,className:"mt-4 text-gray-500",children:"إغلاق"})]})})}function cY({roomId:S,onClose:v,seatedUsers:y}){const A=Qi(He.gifts.list)??[],V=Mi(He.chat.sendGift),[B,Y]=Ot.useState(null),[et,J]=Ot.useState("all"),Q=async()=>{B&&(await V({roomId:S,giftId:B,recipientId:et==="all"?void 0:et}),v())};return H.jsxs("div",{className:"absolute bottom-16 left-0 right-0 bg-purple-200 p-4 rounded-t-lg z-20",children:[H.jsx("h3",{className:"font-bold text-center mb-2 text-purple-800",children:"إرسال هدية"}),H.jsx("div",{className:"grid grid-cols-4 gap-2 mb-2 max-h-40 overflow-y-auto",children:A.map(ht=>H.jsxs("button",{onClick:()=>Y(ht._id),className:`p-1 rounded-lg ${B===ht._id?"bg-purple-400 ring-2 ring-purple-600":"bg-white"}`,children:[H.jsx("img",{src:ht.url,alt:ht.name,className:"w-12 h-12 mx-auto"}),H.jsxs("p",{className:"text-xs text-center text-purple-900",children:[ht.price," عملة"]})]},ht._id))}),H.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[H.jsx("label",{className:"font-semibold text-purple-800",children:"إلى:"}),H.jsxs("select",{value:et,onChange:ht=>J(ht.target.value),className:"flex-grow p-1 rounded border border-purple-400",children:[H.jsx("option",{value:"all",children:"الجميع"}),y.map(ht=>ht&&H.jsx("option",{value:ht.userId,children:ht.name},ht.userId))]})]}),H.jsxs("div",{className:"flex justify-around",children:[H.jsx("button",{onClick:v,className:"px-4 py-2 rounded bg-gray-300 font-semibold",children:"إلغاء"}),H.jsx("button",{onClick:Q,disabled:!B,className:"px-4 py-2 rounded bg-purple-600 text-white font-semibold disabled:bg-gray-400",children:"إرسال"})]})]})}var xb={exports:{}},lY=xb.exports,Oj;function dY(){return Oj||(Oj=1,function(S,v){(function(y,A){S.exports=A()})(lY,function(){function y(t,e){return e.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(i){if(i!=="default"&&!(i in t)){var r=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(t,i,r.get?r:{enumerable:!0,get:function(){return n[i]}})}})}),Object.freeze(t)}var A=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof KI<"u"?KI:typeof self<"u"?self:{};function V(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var B=function(t){try{return!!t()}catch{return!0}},Y=!B(function(){var t=(function(){}).bind();return typeof t!="function"||t.hasOwnProperty("prototype")}),et=Y,J=Function.prototype,Q=J.call,ht=et&&J.bind.bind(Q,Q),Et=et?ht:function(t){return function(){return Q.apply(t,arguments)}},vt=Et({}.isPrototypeOf),Ft=function(t){return t&&t.Math===Math&&t},xt=Ft(typeof globalThis=="object"&&globalThis)||Ft(typeof window=="object"&&window)||Ft(typeof self=="object"&&self)||Ft(typeof A=="object"&&A)||Ft(typeof A=="object"&&A)||function(){return this}()||Function("return this")(),Oe=Y,Ue=Function.prototype,vn=Ue.apply,fn=Ue.call,Be=typeof Reflect=="object"&&Reflect.apply||(Oe?fn.bind(vn):function(){return fn.apply(vn,arguments)}),fe=Et,Ae=fe({}.toString),xn=fe("".slice),ue=function(t){return xn(Ae(t),8,-1)},ln=ue,yn=Et,si=function(t){if(ln(t)==="Function")return yn(t)},wi=typeof document=="object"&&document.all,qt=wi===void 0&&wi!==void 0?function(t){return typeof t=="function"||t===wi}:function(t){return typeof t=="function"},oe={},Kt=!B(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),ne=Y,St=Function.prototype.call,kt=ne?St.bind(St):function(){return St.apply(St,arguments)},te={},Ne={}.propertyIsEnumerable,tt=Object.getOwnPropertyDescriptor,Lt=tt&&!Ne.call({1:2},1);te.f=Lt?function(t){var e=tt(this,t);return!!e&&e.enumerable}:Ne;var Gt,Ht,re=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},dn=B,me=ue,Ji=Object,Fn=Et("".split),xr=dn(function(){return!Ji("z").propertyIsEnumerable(0)})?function(t){return me(t)==="String"?Fn(t,""):Ji(t)}:Ji,Ua=function(t){return t==null},Ys=Ua,us=TypeError,ha=function(t){if(Ys(t))throw new us("Can't call method on "+t);return t},Ll=xr,dp=ha,Va=function(t){return Ll(dp(t))},sr=qt,Ei=function(t){return typeof t=="object"?t!==null:sr(t)},Ui={},Xs=Ui,Mo=xt,Ym=qt,uu=function(t){return Ym(t)?t:void 0},Ut=function(t,e){return arguments.length<2?uu(Xs[t])||uu(Mo[t]):Xs[t]&&Xs[t][e]||Mo[t]&&Mo[t][e]},ge=xt.navigator,Gn=ge&&ge.userAgent,We=Gn?String(Gn):"",oi=xt,gi=We,Qs=oi.process,xl=oi.Deno,Ml=Qs&&Qs.versions||xl&&xl.version,Js=Ml&&Ml.v8;Js&&(Ht=(Gt=Js.split("."))[0]>0&&Gt[0]<4?1:+(Gt[0]+Gt[1])),!Ht&&gi&&(!(Gt=gi.match(/Edge\/(\d+)/))||Gt[1]>=74)&&(Gt=gi.match(/Chrome\/(\d+)/))&&(Ht=+Gt[1]);var Rr=Ht,pa=Rr,Uo=B,Zs=xt.String,hs=!!Object.getOwnPropertySymbols&&!Uo(function(){var t=Symbol("symbol detection");return!Zs(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&pa&&pa<41}),hu=hs&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Dv=Ut,Xm=qt,pu=vt,Gb=Object,Ul=hu?function(t){return typeof t=="symbol"}:function(t){var e=Dv("Symbol");return Xm(e)&&pu(e.prototype,Gb(t))},Pv=String,Vo=function(t){try{return Pv(t)}catch{return"Object"}},Qm=qt,kv=Vo,Hb=TypeError,vi=function(t){if(Qm(t))return t;throw new Hb(kv(t)+" is not a function")},fr=vi,Mr=Ua,$s=function(t,e){var n=t[e];return Mr(n)?void 0:fr(n)},up=kt,Lv=qt,xv=Ei,Mv=TypeError,Vl={exports:{}},hp=xt,jl=Object.defineProperty,Bl=xt,fu=function(t,e){try{jl(hp,t,{value:e,configurable:!0,writable:!0})}catch{hp[t]=e}return e},Mc="__core-js_shared__",Vi=Vl.exports=Bl[Mc]||fu(Mc,{});(Vi.versions||(Vi.versions=[])).push({version:"3.42.0",mode:"pure",copyright:"© 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.42.0/LICENSE",source:"https://github.com/zloirock/core-js"});var pp=Vl.exports,Jm=pp,fa=function(t,e){return Jm[t]||(Jm[t]=e||{})},Fl=ha,Wb=Object,ja=function(t){return Wb(Fl(t))},Uv=ja,zb=Et({}.hasOwnProperty),ci=Object.hasOwn||function(t,e){return zb(Uv(t),e)},fp=Et,to=0,Zm=Math.random(),Vv=fp(1 .toString),jo=function(t){return"Symbol("+(t===void 0?"":t)+")_"+Vv(++to+Zm,36)},$m=fa,mp=ci,qb=jo,jv=hs,ma=hu,Uc=xt.Symbol,t_=$m("wks"),_p=ma?Uc.for||Uc:Uc&&Uc.withoutSetter||qb,Mn=function(t){return mp(t_,t)||(t_[t]=jv&&mp(Uc,t)?Uc[t]:_p("Symbol."+t)),t_[t]},Ep=kt,Bv=Ei,Zr=Ul,e_=$s,Fv=function(t,e){var n,i;if(Lv(n=t.toString)&&!xv(i=up(n,t))||Lv(n=t.valueOf)&&!xv(i=up(n,t)))return i;throw new Mv("Can't convert object to primitive value")},n_=TypeError,Gl=Mn("toPrimitive"),Gv=function(t,e){if(!Bv(t)||Zr(t))return t;var n,i=e_(t,Gl);if(i){if(n=Ep(i,t,e),!Bv(n)||Zr(n))return n;throw new n_("Can't convert object to primitive value")}return Fv(t)},Hv=Ul,Bo=function(t){var e=Gv(t,"string");return Hv(e)?e:e+""},Wv=Ei,gp=xt.document,zv=Wv(gp)&&Wv(gp.createElement),mu=function(t){return zv?gp.createElement(t):{}},Kb=mu,qv=!Kt&&!B(function(){return Object.defineProperty(Kb("div"),"a",{get:function(){return 7}}).a!==7}),vp=Kt,i_=kt,r_=te,Hl=re,Wl=Va,Kv=Bo,a_=ci,Yv=qv,zl=Object.getOwnPropertyDescriptor;oe.f=vp?zl:function(t,e){if(t=Wl(t),e=Kv(e),Yv)try{return zl(t,e)}catch{}if(a_(t,e))return Hl(!i_(r_.f,t,e),t[e])};var eo=B,s_=qt,_u=/#|\.prototype\./,_a=function(t,e){var n=Sp[o_(t)];return n===Tp||n!==Xv&&(s_(e)?eo(e):!!e)},o_=_a.normalize=function(t){return String(t).replace(_u,".").toLowerCase()},Sp=_a.data={},Xv=_a.NATIVE="N",Tp=_a.POLYFILL="P",Eu=_a,Qv=vi,Ur=Y,Vc=si(si.bind),Ba=function(t,e){return Qv(t),e===void 0?t:Ur?Vc(t,e):function(){return t.apply(e,arguments)}},mr={},Jv=Kt&&B(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),c_=Ei,l_=String,gu=TypeError,Zi=function(t){if(c_(t))return t;throw new gu(l_(t)+" is not an object")},Zv=Kt,Yb=qv,Xb=Jv,yp=Zi,Rp=Bo,Qb=TypeError,d_=Object.defineProperty,Jb=Object.getOwnPropertyDescriptor,u_="enumerable",h_="configurable",bp="writable";mr.f=Zv?Xb?function(t,e,n){if(yp(t),e=Rp(e),yp(n),typeof t=="function"&&e==="prototype"&&"value"in n&&bp in n&&!n[bp]){var i=Jb(t,e);i&&i[bp]&&(t[e]=n.value,n={configurable:h_ in n?n[h_]:i[h_],enumerable:u_ in n?n[u_]:i[u_],writable:!1})}return d_(t,e,n)}:d_:function(t,e,n){if(yp(t),e=Rp(e),yp(n),Yb)try{return d_(t,e,n)}catch{}if("get"in n||"set"in n)throw new Qb("Accessors not supported");return"value"in n&&(t[e]=n.value),t};var Zb=mr,$b=re,jc=Kt?function(t,e,n){return Zb.f(t,e,$b(1,n))}:function(t,e,n){return t[e]=n,t},vu=xt,p_=Be,tC=si,eC=qt,nC=oe.f,$v=Eu,ql=Ui,iC=Ba,Kl=jc,tS=ci,rC=function(t){var e=function(n,i,r){if(this instanceof e){switch(arguments.length){case 0:return new t;case 1:return new t(n);case 2:return new t(n,i)}return new t(n,i,r)}return p_(t,this,arguments)};return e.prototype=t.prototype,e},Le=function(t,e){var n,i,r,s,c,l,d,h,p,m=t.target,_=t.global,E=t.stat,I=t.proto,C=_?vu:E?vu[m]:vu[m]&&vu[m].prototype,w=_?ql:ql[m]||Kl(ql,m,{})[m],D=w.prototype;for(s in e)i=!(n=$v(_?s:m+(E?".":"#")+s,t.forced))&&C&&tS(C,s),l=w[s],i&&(d=t.dontCallGetSet?(p=nC(C,s))&&p.value:C[s]),c=i&&d?d:e[s],(n||I||typeof l!=typeof c)&&(h=t.bind&&i?iC(c,vu):t.wrap&&i?rC(c):I&&eC(c)?tC(c):c,(t.sham||c&&c.sham||l&&l.sham)&&Kl(h,"sham",!0),Kl(w,s,h),I&&(tS(ql,r=m+"Prototype")||Kl(ql,r,{}),Kl(ql[r],s,c),t.real&&D&&(n||!D[s])&&Kl(D,s,c)))},aC=Math.ceil,sC=Math.floor,oC=Math.trunc||function(t){var e=+t;return(e>0?sC:aC)(e)},f_=oC,Bc=function(t){var e=+t;return e!=e||e===0?0:f_(e)},cC=Bc,eS=Math.max,nS=Math.min,Cp=function(t,e){var n=cC(t);return n<0?eS(n+e,0):nS(n,e)},iS=Bc,rS=Math.min,Fc=function(t){var e=iS(t);return e>0?rS(e,9007199254740991):0},lC=Fc,Fo=function(t){return lC(t.length)},dC=Va,aS=Cp,sS=Fo,Yl=function(t){return function(e,n,i){var r=dC(e),s=sS(r);if(s===0)return!t&&-1;var c,l=aS(i,s);if(t&&n!=n){for(;s>l;)if((c=r[l++])!=c)return!0}else for(;s>l;l++)if((t||l in r)&&r[l]===n)return t||l||0;return!t&&-1}},Gc={includes:Yl(!0),indexOf:Yl(!1)},uC=Gc.includes;Le({target:"Array",proto:!0,forced:B(function(){return!Array(1).includes()})},{includes:function(t){return uC(this,t,arguments.length>1?arguments[1]:void 0)}});var Ap=xt,oS=Ui,$r=function(t,e){var n=oS[t+"Prototype"],i=n&&n[e];if(i)return i;var r=Ap[t],s=r&&r.prototype;return s&&s[e]},m_=$r("Array","includes"),__=Ei,cS=ue,lS=Mn("match"),E_=function(t){var e;return __(t)&&((e=t[lS])!==void 0?!!e:cS(t)==="RegExp")},hC=E_,pC=TypeError,dS={};dS[Mn("toStringTag")]="z";var g_=String(dS)==="[object z]",fC=g_,ta=qt,Go=ue,uS=Mn("toStringTag"),hS=Object,pS=Go(function(){return arguments}())==="Arguments",no=fC?Go:function(t){var e,n,i;return t===void 0?"Undefined":t===null?"Null":typeof(n=function(r,s){try{return r[s]}catch{}}(e=hS(t),uS))=="string"?n:pS?Go(e):(i=Go(e))==="Object"&&ta(e.callee)?"Arguments":i},v_=no,mC=String,ji=function(t){if(v_(t)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return mC(t)},S_=Mn("match"),Su=Le,T_=function(t){if(hC(t))throw new pC("The method doesn't accept regular expressions");return t},fS=ha,Ho=ji,Xl=function(t){var e=/./;try{"/./"[t](e)}catch{try{return e[S_]=!1,"/./"[t](e)}catch{}}return!1},y_=Et("".indexOf);Su({target:"String",proto:!0,forced:!Xl("includes")},{includes:function(t){return!!~y_(Ho(fS(this)),Ho(T_(t)),arguments.length>1?arguments[1]:void 0)}});var mS=$r("String","includes"),Wo=vt,_S=m_,ES=mS,wp=Array.prototype,R_=String.prototype,_C=function(t){var e=t.includes;return t===wp||Wo(wp,t)&&e===wp.includes?_S:typeof t=="string"||t===R_||Wo(R_,t)&&e===R_.includes?ES:e},mt=V(_C),gS=vi,vS=ja,b_=xr,Fa=Fo,C_=TypeError,ea="Reduce of empty array with no initial value",Ea=function(t){return function(e,n,i,r){var s=vS(e),c=b_(s),l=Fa(s);if(gS(n),l===0&&i<2)throw new C_(ea);var d=t?l-1:0,h=t?-1:1;if(i<2)for(;;){if(d in c){r=c[d],d+=h;break}if(d+=h,t?d<0:l<=d)throw new C_(ea)}for(;t?d>=0:l>d;d+=h)d in c&&(r=n(r,c[d],d,s));return r}},Ql={left:Ea(!1)},A_=B,Hc=function(t,e){var n=[][t];return!!n&&A_(function(){n.call(null,e||function(){return 1},1)})},zo=xt,w_=We,Jl=ue,Tu=function(t){return w_.slice(0,t.length)===t},Zl=Tu("Bun/")?"BUN":Tu("Cloudflare-Workers")?"CLOUDFLARE":Tu("Deno/")?"DENO":Tu("Node.js/")?"NODE":zo.Bun&&typeof Bun.version=="string"?"BUN":zo.Deno&&typeof Deno.version=="object"?"DENO":Jl(zo.process)==="process"?"NODE":zo.window&&zo.document?"BROWSER":"REST",io=Zl==="NODE",EC=Ql.left;Le({target:"Array",proto:!0,forced:!io&&Rr>79&&Rr<83||!Hc("reduce")},{reduce:function(t){var e=arguments.length;return EC(this,t,e,e>1?arguments[1]:void 0)}});var na=$r("Array","reduce"),I_=vt,ro=na,Ip=Array.prototype,Op=function(t){var e=t.reduce;return t===Ip||I_(Ip,t)&&e===Ip.reduce?ro:e},qo=Op,Vr=V(qo),O_=ue,ps=Array.isArray||function(t){return O_(t)==="Array"},$l=Le,Np=ps,Dp=Et([].reverse),ia=[1,2];$l({target:"Array",proto:!0,forced:String(ia)===String(ia.reverse())},{reverse:function(){return Np(this)&&(this.length=this.length),Dp(this)}});var ga=$r("Array","reverse"),Wc=vt,ao=ga,Ga=Array.prototype,zc=function(t){var e=t.reverse;return t===Ga||Wc(Ga,t)&&e===Ga.reverse?ao:e},N_=zc,Pp=V(N_),D_=jo,_r=fa("keys"),Zn=function(t){return _r[t]||(_r[t]=D_(t))},Rn=!B(function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}),qc=ci,fs=qt,P_=ja,Kc=Rn,k_=Zn("IE_PROTO"),kp=Object,yu=kp.prototype,Yc=Kc?kp.getPrototypeOf:function(t){var e=P_(t);if(qc(e,k_))return e[k_];var n=e.constructor;return fs(n)&&e instanceof n?n.prototype:e instanceof kp?yu:null},SS=Et,Ru=vi,L_=Ei,Xc=function(t){return L_(t)||t===null},so=String,Ko=TypeError,oo=function(t,e,n){try{return SS(Ru(Object.getOwnPropertyDescriptor(t,e)[n]))}catch{}},x_=Ei,M_=ha,bu=function(t){if(Xc(t))return t;throw new Ko("Can't set "+so(t)+" as a prototype")},Lp=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,n={};try{(t=oo(Object.prototype,"__proto__","set"))(n,[]),e=n instanceof Array}catch{}return function(i,r){return M_(i),bu(r),x_(i)&&(e?t(i,r):i.__proto__=r),i}}():void 0),ms={},Bi={},td=ci,TS=Va,gC=Gc.indexOf,vC=Bi,yS=Et([].push),Ii=function(t,e){var n,i=TS(t),r=0,s=[];for(n in i)!td(vC,n)&&td(i,n)&&yS(s,n);for(;e.length>r;)td(i,n=e[r++])&&(~gC(s,n)||yS(s,n));return s},Cu=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Au=Ii,wu=Cu.concat("length","prototype");ms.f=Object.getOwnPropertyNames||function(t){return Au(t,wu)};var Qc={};Qc.f=Object.getOwnPropertySymbols;var ed=Ut,nd=ms,SC=Qc,RS=Zi,TC=Et([].concat),bS=ed("Reflect","ownKeys")||function(t){var e=nd.f(RS(t)),n=SC.f;return n?TC(e,n(t)):e},Yo=ci,U_=bS,xp=oe,CS=mr,Jc={},AS=Ii,Mp=Cu,id=Object.keys||function(t){return AS(t,Mp)},wS=Kt,Up=Jv,IS=mr,Iu=Zi,OS=Va,NS=id;Jc.f=wS&&!Up?Object.defineProperties:function(t,e){Iu(t);for(var n,i=OS(e),r=NS(e),s=r.length,c=0;s>c;)IS.f(t,n=r[c++],i[n]);return t};var Ha,Vp=Ut("document","documentElement"),V_=Zi,Xo=Jc,co=Cu,Ou=Bi,j_=Vp,B_=mu,Zc="prototype",$c="script",F_=Zn("IE_PROTO"),jp=function(){},tl=function(t){return"<"+$c+">"+t+"</"+$c+">"},Nu=function(t){t.write(tl("")),t.close();var e=t.parentWindow.Object;return t=null,e},Du=function(){try{Ha=new ActiveXObject("htmlfile")}catch{}var t,e,n;Du=typeof document<"u"?document.domain&&Ha?Nu(Ha):(e=B_("iframe"),n="java"+$c+":",e.style.display="none",j_.appendChild(e),e.src=String(n),(t=e.contentWindow.document).open(),t.write(tl("document.F=Object")),t.close(),t.F):Nu(Ha);for(var i=co.length;i--;)delete Du[Zc][co[i]];return Du()};Ou[F_]=!0;var el=Object.create||function(t,e){var n;return t!==null?(jp[Zc]=V_(t),n=new jp,jp[Zc]=null,n[F_]=t):n=Du(),e===void 0?n:Xo.f(n,e)},G_=Ei,Qo=jc,ze=Error,Un=Et("".replace),Oi=String(new ze("zxcasd").stack),Pu=/\n\s*at [^:]*:[^\n]*/,rd=Pu.test(Oi),nl=re,Bp=!B(function(){var t=new Error("a");return!("stack"in t)||(Object.defineProperty(t,"stack",nl(1,7)),t.stack!==7)}),ku=jc,ad=function(t,e){if(rd&&typeof t=="string"&&!ze.prepareStackTrace)for(;e--;)t=Un(t,Pu,"");return t},yC=Bp,hi=Error.captureStackTrace,Jo={},H_=Jo,DS=Mn("iterator"),PS=Array.prototype,kS=function(t){return t!==void 0&&(H_.Array===t||PS[DS]===t)},W_=no,Fp=$s,z_=Ua,jr=Jo,Ni=Mn("iterator"),sd=function(t){if(!z_(t))return Fp(t,Ni)||Fp(t,"@@iterator")||jr[W_(t)]},Lu=kt,Gp=vi,q_=Zi,lo=Vo,Hp=sd,K_=TypeError,xu=function(t,e){var n=arguments.length<2?Hp(t):e;if(Gp(n))return q_(Lu(n,t));throw new K_(lo(t)+" is not iterable")},LS=kt,Y_=Zi,xS=$s,X_=function(t,e,n){var i,r;Y_(t);try{if(!(i=xS(t,"return"))){if(e==="throw")throw n;return n}i=LS(i,t)}catch(s){r=!0,i=s}if(e==="throw")throw n;if(r)throw i;return Y_(i),n},MS=Ba,US=kt,Q_=Zi,VS=Vo,RC=kS,jS=Fo,J_=vt,BS=xu,Z_=sd,$_=X_,FS=TypeError,Mu=function(t,e){this.stopped=t,this.result=e},tE=Mu.prototype,od=function(t,e,n){var i,r,s,c,l,d,h,p=n&&n.that,m=!(!n||!n.AS_ENTRIES),_=!(!n||!n.IS_RECORD),E=!(!n||!n.IS_ITERATOR),I=!(!n||!n.INTERRUPTED),C=MS(e,p),w=function(N){return i&&$_(i,"normal",N),new Mu(!0,N)},D=function(N){return m?(Q_(N),I?C(N[0],N[1],w):C(N[0],N[1])):I?C(N,w):C(N)};if(_)i=t.iterator;else if(E)i=t;else{if(!(r=Z_(t)))throw new FS(VS(t)+" is not iterable");if(RC(r)){for(s=0,c=jS(t);c>s;s++)if((l=D(t[s]))&&J_(tE,l))return l;return new Mu(!1)}i=BS(t,r)}for(d=_?t.next:i.next;!(h=US(d,i)).done;){try{l=D(h.value)}catch(N){$_(i,"throw",N)}if(typeof l=="object"&&l&&J_(tE,l))return l}return new Mu(!1)},bC=ji,GS=Le,cd=vt,Wp=Yc,Uu=Lp,zp=function(t,e,n){for(var i=U_(e),r=CS.f,s=xp.f,c=0;c<i.length;c++){var l=i[c];Yo(t,l)||n&&Yo(n,l)||r(t,l,s(e,l))}},ld=el,qp=jc,Kp=re,HS=function(t,e){G_(e)&&"cause"in e&&Qo(t,"cause",e.cause)},WS=function(t,e,n,i){yC&&(hi?hi(t,e):ku(t,"stack",ad(n,i)))},zS=od,qS=function(t,e){return t===void 0?arguments.length<2?"":e:bC(t)},eE=Mn("toStringTag"),Vu=Error,KS=[].push,Zo=function(t,e){var n,i=cd(Yp,this);Uu?n=Uu(new Vu,i?Wp(this):Yp):(n=i?this:ld(Yp),qp(n,eE,"Error")),e!==void 0&&qp(n,"message",qS(e)),WS(n,Zo,n.stack,1),arguments.length>2&&HS(n,arguments[2]);var r=[];return zS(t,KS,{that:r}),qp(n,"errors",r),n};Uu?Uu(Zo,Vu):zp(Zo,Vu,{name:!0});var Yp=Zo.prototype=ld(Vu.prototype,{constructor:Kp(1,Zo),message:Kp(1,""),name:Kp(1,"AggregateError")});GS({global:!0},{AggregateError:Zo});var ju,Bu,dd,YS=qt,nE=xt.WeakMap,iE=YS(nE)&&/native code/.test(String(nE)),rE=xt,XS=Ei,CC=jc,aE=ci,Xp=pp,Fu=Zn,sE=Bi,Gu="Object already initialized",Qp=rE.TypeError,QS=rE.WeakMap;if(iE||Xp.state){var ra=Xp.state||(Xp.state=new QS);ra.get=ra.get,ra.has=ra.has,ra.set=ra.set,ju=function(t,e){if(ra.has(t))throw new Qp(Gu);return e.facade=t,ra.set(t,e),e},Bu=function(t){return ra.get(t)||{}},dd=function(t){return ra.has(t)}}else{var il=Fu("state");sE[il]=!0,ju=function(t,e){if(aE(t,il))throw new Qp(Gu);return e.facade=t,CC(t,il,e),e},Bu=function(t){return aE(t,il)?t[il]:{}},dd=function(t){return aE(t,il)}}var $o,JS,rl,Wa={set:ju,get:Bu,has:dd,enforce:function(t){return dd(t)?Bu(t):ju(t,{})},getterFor:function(t){return function(e){var n;if(!XS(e)||(n=Bu(e)).type!==t)throw new Qp("Incompatible receiver, "+t+" required");return n}}},ud=Kt,Hu=ci,Wu=Function.prototype,ZS=ud&&Object.getOwnPropertyDescriptor,oE=Hu(Wu,"name"),al={PROPER:oE&&(function(){}).name==="something",CONFIGURABLE:oE&&(!ud||ud&&ZS(Wu,"name").configurable)},$S=jc,Fi=function(t,e,n,i){return i&&i.enumerable?t[e]=n:$S(t,e,n),t},_s=B,tc=qt,tT=Ei,ec=el,Es=Yc,Gi=Fi,hd=Mn("iterator"),Jp=!1;[].keys&&("next"in(rl=[].keys())?(JS=Es(Es(rl)))!==Object.prototype&&($o=JS):Jp=!0);var cE=!tT($o)||_s(function(){var t={};return $o[hd].call(t)!==t});tc(($o=cE?{}:ec($o))[hd])||Gi($o,hd,function(){return this});var lE={IteratorPrototype:$o,BUGGY_SAFARI_ITERATORS:Jp},eT=no,sl=g_?{}.toString:function(){return"[object "+eT(this)+"]"},Zp=g_,nT=mr.f,iT=jc,rT=ci,$p=sl,dE=Mn("toStringTag"),za=function(t,e,n,i){var r=n?t:t&&t.prototype;r&&(rT(r,dE)||nT(r,dE,{configurable:!0,value:e}),i&&!Zp&&iT(r,"toString",$p))},aT=lE.IteratorPrototype,sT=el,AC=re,oT=za,$i=Jo,or=function(){return this},tf=function(t,e,n,i){var r=e+" Iterator";return t.prototype=sT(aT,{next:AC(+!i,n)}),oT(t,r,!1,!0),$i[r]=or,t},cT=Le,lT=kt,dT=al,uT=tf,ef=Yc,uE=za,hE=Fi,pE=Jo,hT=lE,fE=dT.PROPER,pd=hT.BUGGY_SAFARI_ITERATORS,zu=Mn("iterator"),mE="keys",fd="values",qu="entries",_E=function(){return this},EE=function(t,e,n,i,r,s,c){uT(n,e,i);var l,d,h,p=function(D){if(D===r&&C)return C;if(!pd&&D&&D in E)return E[D];switch(D){case mE:case fd:case qu:return function(){return new n(this,D)}}return function(){return new n(this)}},m=e+" Iterator",_=!1,E=t.prototype,I=E[zu]||E["@@iterator"]||r&&E[r],C=!pd&&I||p(r),w=e==="Array"&&E.entries||I;if(w&&(l=ef(w.call(new t)))!==Object.prototype&&l.next&&(uE(l,m,!0,!0),pE[m]=_E),fE&&r===fd&&I&&I.name!==fd&&(_=!0,C=function(){return lT(I,this)}),r)if(d={values:p(fd),keys:s?C:p(mE),entries:p(qu)},c)for(h in d)(pd||_||!(h in E))&&hE(E,h,d[h]);else cT({target:e,proto:!0,forced:pd||_},d);return c&&E[zu]!==C&&hE(E,zu,C,{}),pE[e]=C,d},md=function(t,e){return{value:t,done:e}},pT=Va,gs=Jo,nf=Wa;mr.f;var wC=EE,Ku=md,vs="Array Iterator",fT=nf.set,rf=nf.getterFor(vs);wC(Array,"Array",function(t,e){fT(this,{type:vs,target:pT(t),index:0,kind:e})},function(){var t=rf(this),e=t.target,n=t.index++;if(!e||n>=e.length)return t.target=null,Ku(void 0,!0);switch(t.kind){case"keys":return Ku(n,!1);case"values":return Ku(e[n],!1)}return Ku([n,e[n]],!1)},"values"),gs.Arguments=gs.Array;var Yu=mr,Kn=function(t,e,n){return Yu.f(t,e,n)},IC=Ut,OC=Kn,mT=Kt,_d=Mn("species"),nc=vt,_T=TypeError,af=function(t,e){if(nc(e,t))return t;throw new _T("Incorrect invocation")},Xu=qt,va=pp,ET=Et(Function.toString);Xu(va.inspectSource)||(va.inspectSource=function(t){return ET(t)});var sf=va.inspectSource,gT=Et,gE=B,of=qt,cf=no,vT=sf,Ss=function(){},pi=Ut("Reflect","construct"),Qu=/^\s*(?:class|function)\b/,ST=gT(Qu.exec),tr=!Qu.test(Ss),Ju=function(t){if(!of(t))return!1;try{return pi(Ss,[],t),!0}catch{return!1}},vE=function(t){if(!of(t))return!1;switch(cf(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return tr||!!ST(Qu,vT(t))}catch{return!0}};vE.sham=!0;var Ed,Dn,br,qa,Zu=!pi||gE(function(){var t;return Ju(Ju.call)||!Ju(Object)||!Ju(function(){t=!0})||t})?vE:Ju,TT=Zu,NC=Vo,SE=TypeError,Br=Zi,Ka=function(t){if(TT(t))return t;throw new SE(NC(t)+" is not a constructor")},yT=Ua,aa=Mn("species"),lf=function(t,e){var n,i=Br(t).constructor;return i===void 0||yT(n=Br(i)[aa])?e:Ka(n)},Cr=Et([].slice),ol=TypeError,Fr=function(t,e){if(t<e)throw new ol("Not enough arguments");return t},df=/(?:ipad|iphone|ipod).*applewebkit/i.test(We),Ar=xt,Ts=Be,RT=Ba,cl=qt,$u=ci,gd=B,ll=Vp,bT=Cr,TE=mu,th=Fr,CT=df,uf=io,hf=Ar.setImmediate,yE=Ar.clearImmediate,DC=Ar.process,bn=Ar.Dispatch,Yn=Ar.Function,tn=Ar.MessageChannel,un=Ar.String,Cn=0,cr={},uo="onreadystatechange";gd(function(){Ed=Ar.location});var ic=function(t){if($u(cr,t)){var e=cr[t];delete cr[t],e()}},eh=function(t){return function(){ic(t)}},ys=function(t){ic(t.data)},li=function(t){Ar.postMessage(un(t),Ed.protocol+"//"+Ed.host)};hf&&yE||(hf=function(t){th(arguments.length,1);var e=cl(t)?t:Yn(t),n=bT(arguments,1);return cr[++Cn]=function(){Ts(e,void 0,n)},Dn(Cn),Cn},yE=function(t){delete cr[t]},uf?Dn=function(t){DC.nextTick(eh(t))}:bn&&bn.now?Dn=function(t){bn.now(eh(t))}:tn&&!CT?(qa=(br=new tn).port2,br.port1.onmessage=ys,Dn=RT(qa.postMessage,qa)):Ar.addEventListener&&cl(Ar.postMessage)&&!Ar.importScripts&&Ed&&Ed.protocol!=="file:"&&!gd(li)?(Dn=li,Ar.addEventListener("message",ys,!1)):Dn=uo in TE("script")?function(t){ll.appendChild(TE("script"))[uo]=function(){ll.removeChild(this),ic(t)}}:function(t){setTimeout(eh(t),0)});var Ya={set:hf,clear:yE},rc=xt,RE=Kt,Sa=Object.getOwnPropertyDescriptor,dl=function(t){if(!RE)return rc[t];var e=Sa(rc,t);return e&&e.value},vd=function(){this.head=null,this.tail=null};vd.prototype={add:function(t){var e={item:t,next:null},n=this.tail;n?n.next=e:this.head=e,this.tail=e},get:function(){var t=this.head;if(t)return(this.head=t.next)===null&&(this.tail=null),t.item}};var Hi,nh,ih,Sd,rh,ho=vd,lr=/ipad|iphone|ipod/i.test(We)&&typeof Pebble<"u",ac=/web0s(?!.*chrome)/i.test(We),Xa=xt,Td=dl,pf=Ba,ah=Ya.set,AT=ho,sh=df,bE=lr,sa=ac,ff=io,Gr=Xa.MutationObserver||Xa.WebKitMutationObserver,CE=Xa.document,AE=Xa.process,mf=Xa.Promise,Rs=Td("queueMicrotask");if(!Rs){var ul=new AT,yd=function(){var t,e;for(ff&&(t=AE.domain)&&t.exit();e=ul.get();)try{e()}catch(n){throw ul.head&&Hi(),n}t&&t.enter()};sh||ff||sa||!Gr||!CE?!bE&&mf&&mf.resolve?((Sd=mf.resolve(void 0)).constructor=mf,rh=pf(Sd.then,Sd),Hi=function(){rh(yd)}):ff?Hi=function(){AE.nextTick(yd)}:(ah=pf(ah,Xa),Hi=function(){ah(yd)}):(nh=!0,ih=CE.createTextNode(""),new Gr(yd).observe(ih,{characterData:!0}),Hi=function(){ih.data=nh=!nh}),Rs=function(t){ul.head||Hi(),ul.add(t)}}var hl=Rs,pl=function(t){try{return{error:!1,value:t()}}catch(e){return{error:!0,value:e}}},sc=xt.Promise,wT=xt,fl=sc,wE=qt,PC=Eu,kC=sf,LC=Mn,IE=Zl,_f=Rr,ml=fl&&fl.prototype,Ef=LC("species"),OE=wE(wT.PromiseRejectionEvent),IT=PC("Promise",function(){var t=kC(fl),e=t!==String(fl);if(!e&&_f===66||!ml.catch||!ml.finally)return!0;if(!_f||_f<51||!/native code/.test(t)){var n=new fl(function(r){r(1)}),i=function(r){r(function(){},function(){})};if((n.constructor={})[Ef]=i,!(n.then(function(){})instanceof i))return!0}return!(e||IE!=="BROWSER"&&IE!=="DENO"||OE)}),Rd={CONSTRUCTOR:IT,REJECTION_EVENT:OE},Qa={},NE=vi,OT=TypeError,gf=function(t){var e,n;this.promise=new t(function(i,r){if(e!==void 0||n!==void 0)throw new OT("Bad Promise constructor");e=i,n=r}),this.resolve=NE(e),this.reject=NE(n)};Qa.f=function(t){return new gf(t)};var vf,DE,Hn=Le,bd=io,oc=xt,Cd=kt,xC=Fi,MC=za,UC=function(t){var e=IC(t);mT&&e&&!e[_d]&&OC(e,_d,{configurable:!0,get:function(){return this}})},Sf=vi,cc=qt,PE=Ei,Tf=af,kE=lf,lc=Ya.set,Ta=hl,oh=function(t,e){try{arguments.length===1?console.error(t):console.error(t,e)}catch{}},VC=pl,NT=ho,LE=Wa,yf=sc,xE=Rd,DT=Qa,Ad="Promise",ME=xE.CONSTRUCTOR,PT=xE.REJECTION_EVENT,UE=LE.getterFor(Ad),VE=LE.set,jE=yf&&yf.prototype,ch=yf,BE=jE,wd=oc.TypeError,FE=oc.document,Rf=oc.process,Xe=DT.f,GE=Xe,bf=!!(FE&&FE.createEvent&&oc.dispatchEvent),Cf="unhandledrejection",HE=function(t){var e;return!(!PE(t)||!cc(e=t.then))&&e},Af=function(t,e){var n,i,r,s=e.value,c=e.state===1,l=c?t.ok:t.fail,d=t.resolve,h=t.reject,p=t.domain;try{l?(c||(e.rejection===2&&jC(e),e.rejection=1),l===!0?n=s:(p&&p.enter(),n=l(s),p&&(p.exit(),r=!0)),n===t.promise?h(new wd("Promise-chain cycle")):(i=HE(n))?Cd(i,n,d,h):d(n)):h(s)}catch(m){p&&!r&&p.exit(),h(m)}},Id=function(t,e){t.notified||(t.notified=!0,Ta(function(){for(var n,i=t.reactions;n=i.get();)Af(n,t);t.notified=!1,e&&!t.rejection&&Od(t)}))},lh=function(t,e,n){var i,r;bf?((i=FE.createEvent("Event")).promise=e,i.reason=n,i.initEvent(t,!1,!0),oc.dispatchEvent(i)):i={promise:e,reason:n},!PT&&(r=oc["on"+t])?r(i):t===Cf&&oh("Unhandled promise rejection",n)},Od=function(t){Cd(lc,oc,function(){var e,n=t.facade,i=t.value;if(WE(t)&&(e=VC(function(){bd?Rf.emit("unhandledRejection",i,n):lh(Cf,n,i)}),t.rejection=bd||WE(t)?2:1,e.error))throw e.value})},WE=function(t){return t.rejection!==1&&!t.parent},jC=function(t){Cd(lc,oc,function(){var e=t.facade;bd?Rf.emit("rejectionHandled",e):lh("rejectionhandled",e,t.value)})},Nd=function(t,e,n){return function(i){t(e,i,n)}},_l=function(t,e,n){t.done||(t.done=!0,n&&(t=n),t.value=e,t.state=2,Id(t,!0))},wf=function(t,e,n){if(!t.done){t.done=!0,n&&(t=n);try{if(t.facade===e)throw new wd("Promise can't be resolved itself");var i=HE(e);i?Ta(function(){var r={done:!1};try{Cd(i,e,Nd(wf,r,t),Nd(_l,r,t))}catch(s){_l(r,s,t)}}):(t.value=e,t.state=1,Id(t,!1))}catch(r){_l({done:!1},r,t)}}};ME&&(BE=(ch=function(t){Tf(this,BE),Sf(t),Cd(vf,this);var e=UE(this);try{t(Nd(wf,e),Nd(_l,e))}catch(n){_l(e,n)}}).prototype,(vf=function(t){VE(this,{type:Ad,done:!1,notified:!1,parent:!1,reactions:new NT,rejection:!1,state:0,value:null})}).prototype=xC(BE,"then",function(t,e){var n=UE(this),i=Xe(kE(this,ch));return n.parent=!0,i.ok=!cc(t)||t,i.fail=cc(e)&&e,i.domain=bd?Rf.domain:void 0,n.state===0?n.reactions.add(i):Ta(function(){Af(i,n)}),i.promise}),DE=function(){var t=new vf,e=UE(t);this.promise=t,this.resolve=Nd(wf,e),this.reject=Nd(_l,e)},DT.f=Xe=function(t){return t===ch||t===void 0?new DE(t):GE(t)}),Hn({global:!0,wrap:!0,forced:ME},{Promise:ch}),MC(ch,Ad,!1,!0),UC(Ad);var dh=Mn("iterator"),Pn=!1;try{var zE=0,er={next:function(){return{done:!!zE++}},return:function(){Pn=!0}};er[dh]=function(){return this},Array.from(er,function(){throw 2})}catch{}var BC=sc,qE=function(t,e){try{if(!e&&!Pn)return!1}catch{return!1}var n=!1;try{var i={};i[dh]=function(){return{next:function(){return{done:n=!0}}}},t(i)}catch{}return n},Dd=Rd.CONSTRUCTOR||!qE(function(t){BC.all(t).then(void 0,function(){})}),If=kt,kT=vi,LT=Qa,KE=pl,YE=od;Le({target:"Promise",stat:!0,forced:Dd},{all:function(t){var e=this,n=LT.f(e),i=n.resolve,r=n.reject,s=KE(function(){var c=kT(e.resolve),l=[],d=0,h=1;YE(t,function(p){var m=d++,_=!1;h++,If(c,e,p).then(function(E){_||(_=!0,l[m]=E,--h||i(l))},r)}),--h||i(l)});return s.error&&r(s.value),n.promise}});var FC=Le,xT=Rd.CONSTRUCTOR;sc&&sc.prototype,FC({target:"Promise",proto:!0,forced:xT,real:!0},{catch:function(t){return this.then(void 0,t)}});var GC=kt,MT=vi,HC=Qa,WC=pl,dc=od;Le({target:"Promise",stat:!0,forced:Dd},{race:function(t){var e=this,n=HC.f(e),i=n.reject,r=WC(function(){var s=MT(e.resolve);dc(t,function(c){GC(s,e,c).then(n.resolve,i)})});return r.error&&i(r.value),n.promise}});var UT=Qa;Le({target:"Promise",stat:!0,forced:Rd.CONSTRUCTOR},{reject:function(t){var e=UT.f(this);return(0,e.reject)(t),e.promise}});var XE=Zi,zC=Ei,qC=Qa,Of=function(t,e){if(XE(t),zC(e)&&e.constructor===t)return e;var n=qC.f(t);return(0,n.resolve)(e),n.promise},KC=Le,Ja=sc,QE=Rd.CONSTRUCTOR,VT=Of,jT=Ut("Promise"),uh=!QE;KC({target:"Promise",stat:!0,forced:!0},{resolve:function(t){return VT(uh&&this===jT?Ja:this,t)}});var ya=kt,BT=vi,Nf=Qa,po=pl,YC=od;Le({target:"Promise",stat:!0,forced:Dd},{allSettled:function(t){var e=this,n=Nf.f(e),i=n.resolve,r=n.reject,s=po(function(){var c=BT(e.resolve),l=[],d=0,h=1;YC(t,function(p){var m=d++,_=!1;h++,ya(c,e,p).then(function(E){_||(_=!0,l[m]={status:"fulfilled",value:E},--h||i(l))},function(E){_||(_=!0,l[m]={status:"rejected",reason:E},--h||i(l))})}),--h||i(l)});return s.error&&r(s.value),n.promise}});var XC=kt,Pd=vi,FT=Ut,QC=Qa,JC=pl,ZC=od,GT="No one promise resolved";Le({target:"Promise",stat:!0,forced:Dd},{any:function(t){var e=this,n=FT("AggregateError"),i=QC.f(e),r=i.resolve,s=i.reject,c=JC(function(){var l=Pd(e.resolve),d=[],h=0,p=1,m=!1;ZC(t,function(_){var E=h++,I=!1;p++,XC(l,e,_).then(function(C){I||m||(m=!0,r(C))},function(C){I||m||(I=!0,d[E]=C,--p||s(new n(d,GT)))})}),--p||s(new n(d,GT))});return c.error&&s(c.value),i.promise}});var $C=Le,t0=Be,e0=Cr,HT=Qa,kd=vi,Ld=pl,Df=xt.Promise,WT=!1;$C({target:"Promise",stat:!0,forced:!Df||!Df.try||Ld(function(){Df.try(function(t){WT=t===8},8)}).error||!WT},{try:function(t){var e=arguments.length>1?e0(arguments,1):[],n=HT.f(this),i=Ld(function(){return t0(kd(t),void 0,e)});return(i.error?n.reject:n.resolve)(i.value),n.promise}});var xd=Qa;Le({target:"Promise",stat:!0},{withResolvers:function(){var t=xd.f(this);return{promise:t.promise,resolve:t.resolve,reject:t.reject}}});var hh=Le,Pf=sc,kf=B,JE=Ut,ZE=qt,Lf=lf,$E=Of,zT=Pf&&Pf.prototype;hh({target:"Promise",proto:!0,real:!0,forced:!!Pf&&kf(function(){zT.finally.call({then:function(){}},function(){})})},{finally:function(t){var e=Lf(this,JE("Promise")),n=ZE(t);return this.then(n?function(i){return $E(e,t()).then(function(){return i})}:t,n?function(i){return $E(e,t()).then(function(){throw i})}:t)}});var tg=Et,qT=Bc,ph=ji,n0=ha,i0=tg("".charAt),KT=tg("".charCodeAt),xf=tg("".slice),fh=function(t){return function(e,n){var i,r,s=ph(n0(e)),c=qT(n),l=s.length;return c<0||c>=l?t?"":void 0:(i=KT(s,c))<55296||i>56319||c+1===l||(r=KT(s,c+1))<56320||r>57343?t?i0(s,c):i:t?xf(s,c,c+2):r-56320+(i-55296<<10)+65536}},mh={codeAt:fh(!1),charAt:fh(!0)},r0=mh.charAt,_h=ji,YT=Wa,XT=EE,eg=md,ng="String Iterator",QT=YT.set,ig=YT.getterFor(ng);XT(String,"String",function(t){QT(this,{type:ng,string:_h(t),index:0})},function(){var t,e=ig(this),n=e.string,i=e.index;return i>=n.length?eg(void 0,!0):(t=r0(n,i),e.index+=t.length,eg(t,!1))});var JT=Ui.Promise,Mf={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},a0=xt,s0=za,Uf=Jo;for(var Eh in Mf)s0(a0[Eh],Eh),Uf[Eh]=Uf.Array;var gh=JT,Tt=V(gh),ZT=$r("Array","values"),rg=no,uc=ci,hc=vt,pc=ZT,El=Array.prototype,vh={DOMTokenList:!0,NodeList:!0},fc=function(t){var e=t.values;return t===El||hc(El,t)&&e===El.values||uc(vh,rg(t))?pc:e},wr=V(fc),ag=Vo,Sh=TypeError,$T=Cr,ty=Math.floor,Md=function(t,e){var n=t.length;if(n<8)for(var i,r,s=1;s<n;){for(r=s,i=t[s];r&&e(t[r-1],i)>0;)t[r]=t[--r];r!==s++&&(t[r]=i)}else for(var c=ty(n/2),l=Md($T(t,0,c),e),d=Md($T(t,c),e),h=l.length,p=d.length,m=0,_=0;m<h||_<p;)t[m+_]=m<h&&_<p?e(l[m],d[_])<=0?l[m++]:d[_++]:m<h?l[m++]:d[_++];return t},sg=Md,ey=We.match(/firefox\/(\d+)/i),Vf=!!ey&&+ey[1],jf=/MSIE|Trident/.test(We),og=We.match(/AppleWebKit\/(\d+)\./),Th=!!og&&+og[1],cg=Le,yh=Et,ny=vi,o0=ja,Rh=Fo,a=function(t,e){if(!delete t[e])throw new Sh("Cannot delete property "+ag(e)+" of "+ag(t))},o=ji,u=B,f=sg,g=Hc,R=Vf,x=jf,j=Rr,X=Th,ct=[],Rt=yh(ct.sort),Nt=yh(ct.push),_t=u(function(){ct.sort(void 0)}),gt=u(function(){ct.sort(null)}),we=g("sort"),_e=!u(function(){if(j)return j<70;if(!(R&&R>3)){if(x)return!0;if(X)return X<603;var t,e,n,i,r="";for(t=65;t<76;t++){switch(e=String.fromCharCode(t),t){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(i=0;i<47;i++)ct.push({k:e+i,v:n})}for(ct.sort(function(s,c){return c.v-s.v}),i=0;i<ct.length;i++)e=ct[i].k.charAt(0),r.charAt(r.length-1)!==e&&(r+=e);return r!=="DGBEFHACIJK"}});cg({target:"Array",proto:!0,forced:_t||!gt||!we||!_e},{sort:function(t){t!==void 0&&ny(t);var e=o0(this);if(_e)return t===void 0?Rt(e):Rt(e,t);var n,i,r=[],s=Rh(e);for(i=0;i<s;i++)i in e&&Nt(r,e[i]);for(f(r,function(c){return function(l,d){return d===void 0?-1:l===void 0?1:c!==void 0?+c(l,d)||0:o(l)>o(d)?1:-1}}(t)),n=Rh(r),i=0;i<n;)e[i]=r[i++];for(;i<s;)a(e,i++);return e}});var Vn=$r("Array","sort"),st=vt,nt=Vn,lt=Array.prototype,At=function(t){var e=t.sort;return t===lt||st(lt,t)&&e===lt.sort?nt:e},Zt=V(At),en=Le,ce=Et,ye=Cp,nr=RangeError,mn=String.fromCharCode,fo=String.fromCodePoint,c0=ce([].join);en({target:"String",stat:!0,forced:!!fo&&fo.length!==1},{fromCodePoint:function(t){for(var e,n=[],i=arguments.length,r=0;i>r;){if(e=+arguments[r++],ye(e,1114111)!==e)throw new nr(e+" is not a valid code point");n[r]=e<65536?mn(e):mn(55296+((e-=65536)>>10),e%1024+56320)}return c0(n,"")}});var oB=B,cB=Mn("iterator"),iy=!oB(function(){var t=new URL("b?a=1&b=2&c=3","https://a"),e=t.searchParams,n=new URLSearchParams("a=1&a=2&b=3"),i="";return t.pathname="c%20d",e.forEach(function(r,s){e.delete("b"),i+=s+r}),n.delete("a",2),n.delete("b",void 0),!t.toJSON||!n.has("a",1)||n.has("a",2)||!n.has("a",void 0)||n.has("b")||!e.size&&!0||!e.sort||t.href!=="https://a/c%20d?a=1&c=3"||e.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!e[cB]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("https://тест").host!=="xn--e1aybc"||new URL("https://a#б").hash!=="#%D0%B1"||i!=="a1c3"||new URL("https://x",void 0).host!=="x"}),lB=Fi,l0=Le,NO=xt,d0=dl,dB=Ut,ry=kt,mo=Et,lg=Kt,DO=iy,PO=Fi,uB=Kn,hB=function(t,e,n){for(var i in e)n&&n.unsafe&&t[i]?t[i]=e[i]:lB(t,i,e[i],n);return t},pB=za,fB=tf,u0=Wa,kO=af,h0=qt,mB=ci,_B=Ba,EB=no,gB=Zi,LO=Ei,oa=ji,vB=el,xO=re,MO=xu,SB=sd,ay=md,Bf=Fr,TB=sg,yB=Mn("iterator"),Ff="URLSearchParams",UO=Ff+"Iterator",VO=u0.set,bs=u0.getterFor(Ff),RB=u0.getterFor(UO),jO=d0("fetch"),sy=d0("Request"),dg=d0("Headers"),p0=sy&&sy.prototype,BO=dg&&dg.prototype,bB=NO.TypeError,CB=NO.encodeURIComponent,AB=String.fromCharCode,wB=dB("String","fromCodePoint"),IB=parseInt,oy=mo("".charAt),FO=mo([].join),Ud=mo([].push),GO=mo("".replace),OB=mo([].shift),HO=mo([].splice),WO=mo("".split),zO=mo("".slice),NB=mo(/./.exec),DB=/\+/g,PB=/^[0-9a-f]+$/i,qO=function(t,e){var n=zO(t,e,e+2);return NB(PB,n)?IB(n,16):NaN},kB=function(t){for(var e=0,n=128;n>0&&(t&n)!=0;n>>=1)e++;return e},LB=function(t){var e=null;switch(t.length){case 1:e=t[0];break;case 2:e=(31&t[0])<<6|63&t[1];break;case 3:e=(15&t[0])<<12|(63&t[1])<<6|63&t[2];break;case 4:e=(7&t[0])<<18|(63&t[1])<<12|(63&t[2])<<6|63&t[3]}return e>1114111?null:e},KO=function(t){for(var e=(t=GO(t,DB," ")).length,n="",i=0;i<e;){var r=oy(t,i);if(r==="%"){if(oy(t,i+1)==="%"||i+3>e){n+="%",i++;continue}var s=qO(t,i+1);if(s!=s){n+=r,i++;continue}i+=2;var c=kB(s);if(c===0)r=AB(s);else{if(c===1||c>4){n+="�",i++;continue}for(var l=[s],d=1;d<c&&!(++i+3>e||oy(t,i)!=="%");){var h=qO(t,i+1);if(h!=h){i+=3;break}if(h>191||h<128)break;Ud(l,h),i+=2,d++}if(l.length!==c){n+="�";continue}var p=LB(l);p===null?n+="�":r=wB(p)}}n+=r,i++}return n},xB=/[!'()~]|%20/g,MB={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},UB=function(t){return MB[t]},YO=function(t){return GO(CB(t),xB,UB)},f0=fB(function(t,e){VO(this,{type:UO,target:bs(t).entries,index:0,kind:e})},Ff,function(){var t=RB(this),e=t.target,n=t.index++;if(!e||n>=e.length)return t.target=null,ay(void 0,!0);var i=e[n];switch(t.kind){case"keys":return ay(i.key,!1);case"values":return ay(i.value,!1)}return ay([i.key,i.value],!1)},!0),XO=function(t){this.entries=[],this.url=null,t!==void 0&&(LO(t)?this.parseObject(t):this.parseQuery(typeof t=="string"?oy(t,0)==="?"?zO(t,1):t:oa(t)))};XO.prototype={type:Ff,bindURL:function(t){this.url=t,this.update()},parseObject:function(t){var e,n,i,r,s,c,l,d=this.entries,h=SB(t);if(h)for(n=(e=MO(t,h)).next;!(i=ry(n,e)).done;){if(s=(r=MO(gB(i.value))).next,(c=ry(s,r)).done||(l=ry(s,r)).done||!ry(s,r).done)throw new bB("Expected sequence with length 2");Ud(d,{key:oa(c.value),value:oa(l.value)})}else for(var p in t)mB(t,p)&&Ud(d,{key:p,value:oa(t[p])})},parseQuery:function(t){if(t)for(var e,n,i=this.entries,r=WO(t,"&"),s=0;s<r.length;)(e=r[s++]).length&&(n=WO(e,"="),Ud(i,{key:KO(OB(n)),value:KO(FO(n,"="))}))},serialize:function(){for(var t,e=this.entries,n=[],i=0;i<e.length;)t=e[i++],Ud(n,YO(t.key)+"="+YO(t.value));return FO(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var cy=function(){kO(this,Gf);var t=VO(this,new XO(arguments.length>0?arguments[0]:void 0));lg||(this.size=t.entries.length)},Gf=cy.prototype;if(hB(Gf,{append:function(t,e){var n=bs(this);Bf(arguments.length,2),Ud(n.entries,{key:oa(t),value:oa(e)}),lg||this.length++,n.updateURL()},delete:function(t){for(var e=bs(this),n=Bf(arguments.length,1),i=e.entries,r=oa(t),s=n<2?void 0:arguments[1],c=s===void 0?s:oa(s),l=0;l<i.length;){var d=i[l];if(d.key!==r||c!==void 0&&d.value!==c)l++;else if(HO(i,l,1),c!==void 0)break}lg||(this.size=i.length),e.updateURL()},get:function(t){var e=bs(this).entries;Bf(arguments.length,1);for(var n=oa(t),i=0;i<e.length;i++)if(e[i].key===n)return e[i].value;return null},getAll:function(t){var e=bs(this).entries;Bf(arguments.length,1);for(var n=oa(t),i=[],r=0;r<e.length;r++)e[r].key===n&&Ud(i,e[r].value);return i},has:function(t){for(var e=bs(this).entries,n=Bf(arguments.length,1),i=oa(t),r=n<2?void 0:arguments[1],s=r===void 0?r:oa(r),c=0;c<e.length;){var l=e[c++];if(l.key===i&&(s===void 0||l.value===s))return!0}return!1},set:function(t,e){var n=bs(this);Bf(arguments.length,1);for(var i,r=n.entries,s=!1,c=oa(t),l=oa(e),d=0;d<r.length;d++)(i=r[d]).key===c&&(s?HO(r,d--,1):(s=!0,i.value=l));s||Ud(r,{key:c,value:l}),lg||(this.size=r.length),n.updateURL()},sort:function(){var t=bs(this);TB(t.entries,function(e,n){return e.key>n.key?1:-1}),t.updateURL()},forEach:function(t){for(var e,n=bs(this).entries,i=_B(t,arguments.length>1?arguments[1]:void 0),r=0;r<n.length;)i((e=n[r++]).value,e.key,this)},keys:function(){return new f0(this,"keys")},values:function(){return new f0(this,"values")},entries:function(){return new f0(this,"entries")}},{enumerable:!0}),PO(Gf,yB,Gf.entries,{}),PO(Gf,"toString",function(){return bs(this).serialize()},{enumerable:!0}),lg&&uB(Gf,"size",{get:function(){return bs(this).entries.length},configurable:!0,enumerable:!0}),pB(cy,Ff),l0({global:!0,forced:!DO},{URLSearchParams:cy}),!DO&&h0(dg)){var VB=mo(BO.has),jB=mo(BO.set),QO=function(t){if(LO(t)){var e,n=t.body;if(EB(n)===Ff)return e=t.headers?new dg(t.headers):new dg,VB(e,"content-type")||jB(e,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),vB(t,{body:xO(0,oa(n)),headers:xO(0,e)})}return t};if(h0(jO)&&l0({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(t){return jO(t,arguments.length>1?QO(arguments[1]):{})}}),h0(sy)){var m0=function(t){return kO(this,p0),new sy(t,arguments.length>1?QO(arguments[1]):{})};p0.constructor=m0,m0.prototype=p0,l0({global:!0,dontCallGetSet:!0,forced:!0},{Request:m0})}}var Cs,BB={URLSearchParams:cy,getState:bs},FB=Ui.URLSearchParams,JO=Kt,GB=Et,HB=kt,WB=B,_0=id,zB=Qc,qB=te,KB=ja,YB=xr,Hf=Object.assign,ZO=Object.defineProperty,XB=GB([].concat),QB=!Hf||WB(function(){if(JO&&Hf({b:1},Hf(ZO({},"a",{enumerable:!0,get:function(){ZO(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var t={},e={},n=Symbol("assign detection"),i="abcdefghijklmnopqrst";return t[n]=7,i.split("").forEach(function(r){e[r]=r}),Hf({},t)[n]!==7||_0(Hf({},e)).join("")!==i})?function(t,e){for(var n=KB(t),i=arguments.length,r=1,s=zB.f,c=qB.f;i>r;)for(var l,d=YB(arguments[r++]),h=s?XB(_0(d),s(d)):_0(d),p=h.length,m=0;p>m;)l=h[m++],JO&&!HB(c,d,l)||(n[l]=d[l]);return n}:Hf,JB=Zi,ZB=X_,$B=Kt,tF=mr,eF=re,E0=function(t,e,n){$B?tF.f(t,e,eF(0,n)):t[e]=n},nF=Ba,iF=kt,rF=ja,aF=function(t,e,n,i){try{return i?e(JB(n)[0],n[1]):e(n)}catch(r){ZB(t,"throw",r)}},sF=kS,oF=Zu,cF=Fo,$O=E0,lF=xu,dF=sd,tN=Array,bh=Et,g0=2147483647,uF=/[^\0-\u007E]/,eN=/[.\u3002\uFF0E\uFF61]/g,nN="Overflow: input needs wider integers to process",iN=RangeError,hF=bh(eN.exec),Wf=Math.floor,v0=String.fromCharCode,rN=bh("".charCodeAt),aN=bh([].join),Vd=bh([].push),pF=bh("".replace),fF=bh("".split),mF=bh("".toLowerCase),sN=function(t){return t+22+75*(t<26)},_F=function(t,e,n){var i=0;for(t=n?Wf(t/700):t>>1,t+=Wf(t/e);t>455;)t=Wf(t/35),i+=36;return Wf(i+36*t/(t+38))},EF=function(t){var e=[];t=function(D){for(var N=[],L=0,W=D.length;L<W;){var G=rN(D,L++);if(G>=55296&&G<=56319&&L<W){var U=rN(D,L++);(64512&U)==56320?Vd(N,((1023&G)<<10)+(1023&U)+65536):(Vd(N,G),L--)}else Vd(N,G)}return N}(t);var n,i,r=t.length,s=128,c=0,l=72;for(n=0;n<t.length;n++)(i=t[n])<128&&Vd(e,v0(i));var d=e.length,h=d;for(d&&Vd(e,"-");h<r;){var p=g0;for(n=0;n<t.length;n++)(i=t[n])>=s&&i<p&&(p=i);var m=h+1;if(p-s>Wf((g0-c)/m))throw new iN(nN);for(c+=(p-s)*m,s=p,n=0;n<t.length;n++){if((i=t[n])<s&&++c>g0)throw new iN(nN);if(i===s){for(var _=c,E=36;;){var I=E<=l?1:E>=l+26?26:E-l;if(_<I)break;var C=_-I,w=36-I;Vd(e,v0(sN(I+C%w))),_=Wf(C/w),E+=36}Vd(e,v0(sN(_))),l=_F(c,m,h===d),c=0,h++}}c++,s++}return aN(e,"")},gF=Le,S0=Kt,vF=iy,T0=xt,oN=Ba,As=Et,ly=Fi,ws=Kn,SF=af,y0=ci,R0=QB,zf=function(t){var e=rF(t),n=oF(this),i=arguments.length,r=i>1?arguments[1]:void 0,s=r!==void 0;s&&(r=nF(r,i>2?arguments[2]:void 0));var c,l,d,h,p,m,_=dF(e),E=0;if(!_||this===tN&&sF(_))for(c=cF(e),l=n?new this(c):tN(c);c>E;E++)m=s?r(e[E],E):e[E],$O(l,E,m);else for(l=n?new this:[],p=(h=lF(e,_)).next;!(d=iF(p,h)).done;E++)m=s?aF(h,r,[d.value,E],!0):d.value,$O(l,E,m);return l.length=E,l},_o=Cr,TF=mh.codeAt,yF=function(t){var e,n,i=[],r=fF(pF(mF(t),eN,"."),".");for(e=0;e<r.length;e++)n=r[e],Vd(i,hF(uF,n)?"xn--"+EF(n):n);return aN(i,".")},gl=ji,RF=za,bF=Fr,cN=BB,lN=Wa,CF=lN.set,dy=lN.getterFor("URL"),AF=cN.URLSearchParams,wF=cN.getState,ug=T0.URL,b0=T0.TypeError,uy=T0.parseInt,IF=Math.floor,dN=Math.pow,Is=As("".charAt),Eo=As(/./.exec),hg=As([].join),OF=As(1 .toString),NF=As([].pop),qf=As([].push),C0=As("".replace),DF=As([].shift),PF=As("".split),pg=As("".slice),hy=As("".toLowerCase),kF=As([].unshift),A0="Invalid scheme",Ch="Invalid host",uN="Invalid port",hN=/[a-z]/i,LF=/[\d+-.a-z]/i,w0=/\d/,xF=/^0x/i,MF=/^[0-7]+$/,UF=/^\d+$/,pN=/^[\da-f]+$/i,VF=/[\0\t\n\r #%/:<>?@[\\\]^|]/,jF=/[\0\t\n\r #/:<>?@[\\\]^|]/,BF=/^[\u0000-\u0020]+/,FF=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,GF=/[\t\n\r]/g,fg=function(t){var e,n,i,r;if(typeof t=="number"){for(e=[],n=0;n<4;n++)kF(e,t%256),t=IF(t/256);return hg(e,".")}if(typeof t=="object"){for(e="",i=function(s){for(var c=null,l=1,d=null,h=0,p=0;p<8;p++)s[p]!==0?(h>l&&(c=d,l=h),d=null,h=0):(d===null&&(d=p),++h);return h>l?d:c}(t),n=0;n<8;n++)r&&t[n]===0||(r&&(r=!1),i===n?(e+=n?":":"::",r=!0):(e+=OF(t[n],16),n<7&&(e+=":")));return"["+e+"]"}return t},py={},fN=R0({},py,{" ":1,'"':1,"<":1,">":1,"`":1}),mN=R0({},fN,{"#":1,"?":1,"{":1,"}":1}),I0=R0({},mN,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),jd=function(t,e){var n=TF(t,0);return n>32&&n<127&&!y0(e,t)?t:encodeURIComponent(t)},fy={ftp:21,file:null,http:80,https:443,ws:80,wss:443},mg=function(t,e){var n;return t.length===2&&Eo(hN,Is(t,0))&&((n=Is(t,1))===":"||!e&&n==="|")},_N=function(t){var e;return t.length>1&&mg(pg(t,0,2))&&(t.length===2||(e=Is(t,2))==="/"||e==="\\"||e==="?"||e==="#")},HF=function(t){return t==="."||hy(t)==="%2e"},O0={},EN={},N0={},gN={},vN={},D0={},SN={},TN={},my={},_y={},P0={},k0={},L0={},x0={},yN={},M0={},Kf={},mc={},RN={},Ah={},vl={},U0=function(t,e,n){var i,r,s,c=gl(t);if(e){if(r=this.parse(c))throw new b0(r);this.searchParams=null}else{if(n!==void 0&&(i=new U0(n,!0)),r=this.parse(c,null,i))throw new b0(r);(s=wF(new AF)).bindURL(this),this.searchParams=s}};U0.prototype={type:"URL",parse:function(t,e,n){var i,r,s,c,l,d=this,h=e||O0,p=0,m="",_=!1,E=!1,I=!1;for(t=gl(t),e||(d.scheme="",d.username="",d.password="",d.host=null,d.port=null,d.path=[],d.query=null,d.fragment=null,d.cannotBeABaseURL=!1,t=C0(t,BF,""),t=C0(t,FF,"$1")),t=C0(t,GF,""),i=zf(t);p<=i.length;){switch(r=i[p],h){case O0:if(!r||!Eo(hN,r)){if(e)return A0;h=N0;continue}m+=hy(r),h=EN;break;case EN:if(r&&(Eo(LF,r)||r==="+"||r==="-"||r==="."))m+=hy(r);else{if(r!==":"){if(e)return A0;m="",h=N0,p=0;continue}if(e&&(d.isSpecial()!==y0(fy,m)||m==="file"&&(d.includesCredentials()||d.port!==null)||d.scheme==="file"&&!d.host))return;if(d.scheme=m,e)return void(d.isSpecial()&&fy[d.scheme]===d.port&&(d.port=null));m="",d.scheme==="file"?h=x0:d.isSpecial()&&n&&n.scheme===d.scheme?h=gN:d.isSpecial()?h=TN:i[p+1]==="/"?(h=vN,p++):(d.cannotBeABaseURL=!0,qf(d.path,""),h=RN)}break;case N0:if(!n||n.cannotBeABaseURL&&r!=="#")return A0;if(n.cannotBeABaseURL&&r==="#"){d.scheme=n.scheme,d.path=_o(n.path),d.query=n.query,d.fragment="",d.cannotBeABaseURL=!0,h=vl;break}h=n.scheme==="file"?x0:D0;continue;case gN:if(r!=="/"||i[p+1]!=="/"){h=D0;continue}h=my,p++;break;case vN:if(r==="/"){h=_y;break}h=mc;continue;case D0:if(d.scheme=n.scheme,r===Cs)d.username=n.username,d.password=n.password,d.host=n.host,d.port=n.port,d.path=_o(n.path),d.query=n.query;else if(r==="/"||r==="\\"&&d.isSpecial())h=SN;else if(r==="?")d.username=n.username,d.password=n.password,d.host=n.host,d.port=n.port,d.path=_o(n.path),d.query="",h=Ah;else{if(r!=="#"){d.username=n.username,d.password=n.password,d.host=n.host,d.port=n.port,d.path=_o(n.path),d.path.length--,h=mc;continue}d.username=n.username,d.password=n.password,d.host=n.host,d.port=n.port,d.path=_o(n.path),d.query=n.query,d.fragment="",h=vl}break;case SN:if(!d.isSpecial()||r!=="/"&&r!=="\\"){if(r!=="/"){d.username=n.username,d.password=n.password,d.host=n.host,d.port=n.port,h=mc;continue}h=_y}else h=my;break;case TN:if(h=my,r!=="/"||Is(m,p+1)!=="/")continue;p++;break;case my:if(r!=="/"&&r!=="\\"){h=_y;continue}break;case _y:if(r==="@"){_&&(m="%40"+m),_=!0,s=zf(m);for(var C=0;C<s.length;C++){var w=s[C];if(w!==":"||I){var D=jd(w,I0);I?d.password+=D:d.username+=D}else I=!0}m=""}else if(r===Cs||r==="/"||r==="?"||r==="#"||r==="\\"&&d.isSpecial()){if(_&&m==="")return"Invalid authority";p-=zf(m).length+1,m="",h=P0}else m+=r;break;case P0:case k0:if(e&&d.scheme==="file"){h=M0;continue}if(r!==":"||E){if(r===Cs||r==="/"||r==="?"||r==="#"||r==="\\"&&d.isSpecial()){if(d.isSpecial()&&m==="")return Ch;if(e&&m===""&&(d.includesCredentials()||d.port!==null))return;if(c=d.parseHost(m))return c;if(m="",h=Kf,e)return;continue}r==="["?E=!0:r==="]"&&(E=!1),m+=r}else{if(m==="")return Ch;if(c=d.parseHost(m))return c;if(m="",h=L0,e===k0)return}break;case L0:if(!Eo(w0,r)){if(r===Cs||r==="/"||r==="?"||r==="#"||r==="\\"&&d.isSpecial()||e){if(m!==""){var N=uy(m,10);if(N>65535)return uN;d.port=d.isSpecial()&&N===fy[d.scheme]?null:N,m=""}if(e)return;h=Kf;continue}return uN}m+=r;break;case x0:if(d.scheme="file",r==="/"||r==="\\")h=yN;else{if(!n||n.scheme!=="file"){h=mc;continue}switch(r){case Cs:d.host=n.host,d.path=_o(n.path),d.query=n.query;break;case"?":d.host=n.host,d.path=_o(n.path),d.query="",h=Ah;break;case"#":d.host=n.host,d.path=_o(n.path),d.query=n.query,d.fragment="",h=vl;break;default:_N(hg(_o(i,p),""))||(d.host=n.host,d.path=_o(n.path),d.shortenPath()),h=mc;continue}}break;case yN:if(r==="/"||r==="\\"){h=M0;break}n&&n.scheme==="file"&&!_N(hg(_o(i,p),""))&&(mg(n.path[0],!0)?qf(d.path,n.path[0]):d.host=n.host),h=mc;continue;case M0:if(r===Cs||r==="/"||r==="\\"||r==="?"||r==="#"){if(!e&&mg(m))h=mc;else if(m===""){if(d.host="",e)return;h=Kf}else{if(c=d.parseHost(m))return c;if(d.host==="localhost"&&(d.host=""),e)return;m="",h=Kf}continue}m+=r;break;case Kf:if(d.isSpecial()){if(h=mc,r!=="/"&&r!=="\\")continue}else if(e||r!=="?")if(e||r!=="#"){if(r!==Cs&&(h=mc,r!=="/"))continue}else d.fragment="",h=vl;else d.query="",h=Ah;break;case mc:if(r===Cs||r==="/"||r==="\\"&&d.isSpecial()||!e&&(r==="?"||r==="#")){if((l=hy(l=m))===".."||l==="%2e."||l===".%2e"||l==="%2e%2e"?(d.shortenPath(),r==="/"||r==="\\"&&d.isSpecial()||qf(d.path,"")):HF(m)?r==="/"||r==="\\"&&d.isSpecial()||qf(d.path,""):(d.scheme==="file"&&!d.path.length&&mg(m)&&(d.host&&(d.host=""),m=Is(m,0)+":"),qf(d.path,m)),m="",d.scheme==="file"&&(r===Cs||r==="?"||r==="#"))for(;d.path.length>1&&d.path[0]==="";)DF(d.path);r==="?"?(d.query="",h=Ah):r==="#"&&(d.fragment="",h=vl)}else m+=jd(r,mN);break;case RN:r==="?"?(d.query="",h=Ah):r==="#"?(d.fragment="",h=vl):r!==Cs&&(d.path[0]+=jd(r,py));break;case Ah:e||r!=="#"?r!==Cs&&(r==="'"&&d.isSpecial()?d.query+="%27":d.query+=r==="#"?"%23":jd(r,py)):(d.fragment="",h=vl);break;case vl:r!==Cs&&(d.fragment+=jd(r,fN))}p++}},parseHost:function(t){var e,n,i;if(Is(t,0)==="["){if(Is(t,t.length-1)!=="]"||(e=function(r){var s,c,l,d,h,p,m,_=[0,0,0,0,0,0,0,0],E=0,I=null,C=0,w=function(){return Is(r,C)};if(w()===":"){if(Is(r,1)!==":")return;C+=2,I=++E}for(;w();){if(E===8)return;if(w()!==":"){for(s=c=0;c<4&&Eo(pN,w());)s=16*s+uy(w(),16),C++,c++;if(w()==="."){if(c===0||(C-=c,E>6))return;for(l=0;w();){if(d=null,l>0){if(!(w()==="."&&l<4))return;C++}if(!Eo(w0,w()))return;for(;Eo(w0,w());){if(h=uy(w(),10),d===null)d=h;else{if(d===0)return;d=10*d+h}if(d>255)return;C++}_[E]=256*_[E]+d,++l!=2&&l!==4||E++}if(l!==4)return;break}if(w()===":"){if(C++,!w())return}else if(w())return;_[E++]=s}else{if(I!==null)return;C++,I=++E}}if(I!==null)for(p=E-I,E=7;E!==0&&p>0;)m=_[E],_[E--]=_[I+p-1],_[I+--p]=m;else if(E!==8)return;return _}(pg(t,1,-1)),!e))return Ch;this.host=e}else if(this.isSpecial()){if(t=yF(t),Eo(VF,t)||(e=function(r){var s,c,l,d,h,p,m,_=PF(r,".");if(_.length&&_[_.length-1]===""&&_.length--,(s=_.length)>4)return r;for(c=[],l=0;l<s;l++){if((d=_[l])==="")return r;if(h=10,d.length>1&&Is(d,0)==="0"&&(h=Eo(xF,d)?16:8,d=pg(d,h===8?1:2)),d==="")p=0;else{if(!Eo(h===10?UF:h===8?MF:pN,d))return r;p=uy(d,h)}qf(c,p)}for(l=0;l<s;l++)if(p=c[l],l===s-1){if(p>=dN(256,5-s))return null}else if(p>255)return null;for(m=NF(c),l=0;l<c.length;l++)m+=c[l]*dN(256,3-l);return m}(t),e===null))return Ch;this.host=e}else{if(Eo(jF,t))return Ch;for(e="",n=zf(t),i=0;i<n.length;i++)e+=jd(n[i],py);this.host=e}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme==="file"},includesCredentials:function(){return this.username!==""||this.password!==""},isSpecial:function(){return y0(fy,this.scheme)},shortenPath:function(){var t=this.path,e=t.length;!e||this.scheme==="file"&&e===1&&mg(t[0],!0)||t.length--},serialize:function(){var t=this,e=t.scheme,n=t.username,i=t.password,r=t.host,s=t.port,c=t.path,l=t.query,d=t.fragment,h=e+":";return r!==null?(h+="//",t.includesCredentials()&&(h+=n+(i?":"+i:"")+"@"),h+=fg(r),s!==null&&(h+=":"+s)):e==="file"&&(h+="//"),h+=t.cannotBeABaseURL?c[0]:c.length?"/"+hg(c,"/"):"",l!==null&&(h+="?"+l),d!==null&&(h+="#"+d),h},setHref:function(t){var e=this.parse(t);if(e)throw new b0(e);this.searchParams.update()},getOrigin:function(){var t=this.scheme,e=this.port;if(t==="blob")try{return new Yf(t.path[0]).origin}catch{return"null"}return t!=="file"&&this.isSpecial()?t+"://"+fg(this.host)+(e!==null?":"+e:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(t){this.parse(gl(t)+":",O0)},getUsername:function(){return this.username},setUsername:function(t){var e=zf(gl(t));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n=0;n<e.length;n++)this.username+=jd(e[n],I0)}},getPassword:function(){return this.password},setPassword:function(t){var e=zf(gl(t));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n=0;n<e.length;n++)this.password+=jd(e[n],I0)}},getHost:function(){var t=this.host,e=this.port;return t===null?"":e===null?fg(t):fg(t)+":"+e},setHost:function(t){this.cannotBeABaseURL||this.parse(t,P0)},getHostname:function(){var t=this.host;return t===null?"":fg(t)},setHostname:function(t){this.cannotBeABaseURL||this.parse(t,k0)},getPort:function(){var t=this.port;return t===null?"":gl(t)},setPort:function(t){this.cannotHaveUsernamePasswordPort()||((t=gl(t))===""?this.port=null:this.parse(t,L0))},getPathname:function(){var t=this.path;return this.cannotBeABaseURL?t[0]:t.length?"/"+hg(t,"/"):""},setPathname:function(t){this.cannotBeABaseURL||(this.path=[],this.parse(t,Kf))},getSearch:function(){var t=this.query;return t?"?"+t:""},setSearch:function(t){(t=gl(t))===""?this.query=null:(Is(t,0)==="?"&&(t=pg(t,1)),this.query="",this.parse(t,Ah)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var t=this.fragment;return t?"#"+t:""},setHash:function(t){(t=gl(t))!==""?(Is(t,0)==="#"&&(t=pg(t,1)),this.fragment="",this.parse(t,vl)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Yf=function(t){var e=SF(this,ca),n=bF(arguments.length,1)>1?arguments[1]:void 0,i=CF(e,new U0(t,!1,n));S0||(e.href=i.serialize(),e.origin=i.getOrigin(),e.protocol=i.getProtocol(),e.username=i.getUsername(),e.password=i.getPassword(),e.host=i.getHost(),e.hostname=i.getHostname(),e.port=i.getPort(),e.pathname=i.getPathname(),e.search=i.getSearch(),e.searchParams=i.getSearchParams(),e.hash=i.getHash())},ca=Yf.prototype,Os=function(t,e){return{get:function(){return dy(this)[t]()},set:e&&function(n){return dy(this)[e](n)},configurable:!0,enumerable:!0}};if(S0&&(ws(ca,"href",Os("serialize","setHref")),ws(ca,"origin",Os("getOrigin")),ws(ca,"protocol",Os("getProtocol","setProtocol")),ws(ca,"username",Os("getUsername","setUsername")),ws(ca,"password",Os("getPassword","setPassword")),ws(ca,"host",Os("getHost","setHost")),ws(ca,"hostname",Os("getHostname","setHostname")),ws(ca,"port",Os("getPort","setPort")),ws(ca,"pathname",Os("getPathname","setPathname")),ws(ca,"search",Os("getSearch","setSearch")),ws(ca,"searchParams",Os("getSearchParams")),ws(ca,"hash",Os("getHash","setHash"))),ly(ca,"toJSON",function(){return dy(this).serialize()},{enumerable:!0}),ly(ca,"toString",function(){return dy(this).serialize()},{enumerable:!0}),ug){var bN=ug.createObjectURL,CN=ug.revokeObjectURL;bN&&ly(Yf,"createObjectURL",oN(bN,ug)),CN&&ly(Yf,"revokeObjectURL",oN(CN,ug))}RF(Yf,"URL"),gF({global:!0,forced:!vF,sham:!S0},{URL:Yf});var WF=Le,AN=B,zF=Fr,wN=ji,qF=iy,V0=Ut("URL"),KF=qF&&AN(function(){V0.canParse()}),YF=AN(function(){return V0.canParse.length!==1});WF({target:"URL",stat:!0,forced:!KF||YF},{canParse:function(t){var e=zF(arguments.length,1),n=wN(t),i=e<2||arguments[1]===void 0?void 0:wN(arguments[1]);try{return!!new V0(n,i)}catch{return!1}}});var XF=Le,QF=Fr,IN=ji,JF=iy,ZF=Ut("URL");XF({target:"URL",stat:!0,forced:!JF},{parse:function(t){var e=QF(arguments.length,1),n=IN(t),i=e<2||arguments[1]===void 0?void 0:IN(arguments[1]);try{return new ZF(n,i)}catch{return null}}});var Ey=V(Ui.URL);let ON=!0,NN=!0;function gy(t,e,n){const i=t.match(e);return i&&i.length>=n&&parseInt(i[n],10)}function wh(t,e,n){if(!t.RTCPeerConnection)return;const i=t.RTCPeerConnection.prototype,r=i.addEventListener;i.addEventListener=function(c,l){if(c!==e)return r.apply(this,arguments);const d=h=>{const p=n(h);p&&(l.handleEvent?l.handleEvent(p):l(p))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(l,d),r.apply(this,[c,d])};const s=i.removeEventListener;i.removeEventListener=function(c,l){if(c!==e||!this._eventMap||!this._eventMap[e])return s.apply(this,arguments);if(!this._eventMap[e].has(l))return s.apply(this,arguments);const d=this._eventMap[e].get(l);return this._eventMap[e].delete(l),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,s.apply(this,[c,d])},Object.defineProperty(i,"on"+e,{get(){return this["_on"+e]},set(c){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),c&&this.addEventListener(e,this["_on"+e]=c)},enumerable:!0,configurable:!0})}function $F(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(ON=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function t3(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(NN=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function DN(){if(typeof window=="object"){if(ON)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function j0(t,e){NN&&console.warn(t+" is deprecated, please use "+e+" instead.")}function PN(t){return Object.prototype.toString.call(t)==="[object Object]"}function kN(t){var e;return PN(t)?Vr(e=Object.keys(t)).call(e,function(n,i){const r=PN(t[i]),s=r?kN(t[i]):t[i],c=r&&!Object.keys(s).length;return s===void 0||c?n:Object.assign(n,{[i]:s})},{}):t}function B0(t,e,n){e&&!n.has(e.id)&&(n.set(e.id,e),Object.keys(e).forEach(i=>{i.endsWith("Id")?B0(t,t.get(e[i]),n):i.endsWith("Ids")&&e[i].forEach(r=>{B0(t,t.get(r),n)})}))}function LN(t,e,n){const i=n?"outbound-rtp":"inbound-rtp",r=new Map;if(e===null)return r;const s=[];return t.forEach(c=>{c.type==="track"&&c.trackIdentifier===e.id&&s.push(c)}),s.forEach(c=>{t.forEach(l=>{l.type===i&&l.trackId===c.id&&B0(t,l,r)})}),r}const xN=DN;function MN(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const i=function(c){if(typeof c!="object"||c.mandatory||c.optional)return c;const l={};return Object.keys(c).forEach(d=>{if(d==="require"||d==="advanced"||d==="mediaSource")return;const h=typeof c[d]=="object"?c[d]:{ideal:c[d]};h.exact!==void 0&&typeof h.exact=="number"&&(h.min=h.max=h.exact);const p=function(m,_){return m?m+_.charAt(0).toUpperCase()+_.slice(1):_==="deviceId"?"sourceId":_};if(h.ideal!==void 0){l.optional=l.optional||[];let m={};typeof h.ideal=="number"?(m[p("min",d)]=h.ideal,l.optional.push(m),m={},m[p("max",d)]=h.ideal,l.optional.push(m)):(m[p("",d)]=h.ideal,l.optional.push(m))}h.exact!==void 0&&typeof h.exact!="number"?(l.mandatory=l.mandatory||{},l.mandatory[p("",d)]=h.exact):["min","max"].forEach(m=>{h[m]!==void 0&&(l.mandatory=l.mandatory||{},l.mandatory[p(m,d)]=h[m])})}),c.advanced&&(l.optional=(l.optional||[]).concat(c.advanced)),l},r=function(c,l){if(e.version>=61)return l(c);if((c=JSON.parse(JSON.stringify(c)))&&typeof c.audio=="object"){const d=function(h,p,m){p in h&&!(m in h)&&(h[m]=h[p],delete h[p])};d((c=JSON.parse(JSON.stringify(c))).audio,"autoGainControl","googAutoGainControl"),d(c.audio,"noiseSuppression","googNoiseSuppression"),c.audio=i(c.audio)}if(c&&typeof c.video=="object"){let d=c.video.facingMode;d=d&&(typeof d=="object"?d:{ideal:d});const h=e.version<66;if(d&&(d.exact==="user"||d.exact==="environment"||d.ideal==="user"||d.ideal==="environment")&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||h)){let p;if(delete c.video.facingMode,d.exact==="environment"||d.ideal==="environment"?p=["back","rear"]:d.exact!=="user"&&d.ideal!=="user"||(p=["front"]),p)return n.mediaDevices.enumerateDevices().then(m=>{m=m.filter(E=>E.kind==="videoinput");let _=m.find(E=>p.some(I=>{var C;return mt(C=E.label.toLowerCase()).call(C,I)}));return!_&&m.length&&mt(p).call(p,"back")&&(_=m[m.length-1]),_&&(c.video.deviceId=d.exact?{exact:_.deviceId}:{ideal:_.deviceId}),c.video=i(c.video),xN("chrome: "+JSON.stringify(c)),l(c)})}c.video=i(c.video)}return xN("chrome: "+JSON.stringify(c)),l(c)},s=function(c){return e.version>=64?c:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[c.name]||c.name,message:c.message,constraint:c.constraint||c.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=(function(c,l,d){r(c,h=>{n.webkitGetUserMedia(h,l,p=>{d&&d(s(p))})})}).bind(n),n.mediaDevices.getUserMedia){const c=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(l){return r(l,d=>c(d).then(h=>{if(d.audio&&!h.getAudioTracks().length||d.video&&!h.getVideoTracks().length)throw h.getTracks().forEach(p=>{p.stop()}),new DOMException("","NotFoundError");return h},h=>Tt.reject(s(h))))}}}function UN(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function VN(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=n=>{n.stream.addEventListener("addtrack",i=>{let r;r=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(c=>c.track&&c.track.id===i.track.id):{track:i.track};const s=new Event("track");s.track=i.track,s.receiver=r,s.transceiver={receiver:r},s.streams=[n.stream],this.dispatchEvent(s)}),n.stream.getTracks().forEach(i=>{let r;r=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(c=>c.track&&c.track.id===i.id):{track:i};const s=new Event("track");s.track=i,s.receiver=r,s.transceiver={receiver:r},s.streams=[n.stream],this.dispatchEvent(s)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else wh(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function jN(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(r,s){return{track:s,get dtmf(){return this._dtmf===void 0&&(s.kind==="audio"?this._dtmf=r.createDTMFSender(s):this._dtmf=null),this._dtmf},_pc:r}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(c,l){let d=r.apply(this,arguments);return d||(d=e(this,c),this._senders.push(d)),d};const s=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(c){s.apply(this,arguments);const l=this._senders.indexOf(c);l!==-1&&this._senders.splice(l,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(r){this._senders=this._senders||[],n.apply(this,[r]),r.getTracks().forEach(s=>{this._senders.push(e(this,s))})};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(r){this._senders=this._senders||[],i.apply(this,[r]),r.getTracks().forEach(s=>{const c=this._senders.find(l=>l.track===s);c&&this._senders.splice(this._senders.indexOf(c),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const n=e.apply(this,[]);return n.forEach(i=>i._pc=this),n},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function BN(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[n,i,r]=arguments;if(arguments.length>0&&typeof n=="function")return e.apply(this,arguments);if(e.length===0&&(arguments.length===0||typeof n!="function"))return e.apply(this,[]);const s=function(l){const d={};return l.result().forEach(h=>{const p={id:h.id,timestamp:h.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[h.type]||h.type};h.names().forEach(m=>{p[m]=h.stat(m)}),d[p.id]=p}),d},c=function(l){return new Map(Object.keys(l).map(d=>[d,l[d]]))};if(arguments.length>=2){const l=function(d){i(c(s(d)))};return e.apply(this,[l,n])}return new Tt((l,d)=>{e.apply(this,[function(h){l(c(s(h)))},d])}).then(i,r)}}function FN(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const n=t.RTCPeerConnection.prototype.getSenders;n&&(t.RTCPeerConnection.prototype.getSenders=function(){const r=n.apply(this,[]);return r.forEach(s=>s._pc=this),r});const i=t.RTCPeerConnection.prototype.addTrack;i&&(t.RTCPeerConnection.prototype.addTrack=function(){const r=i.apply(this,arguments);return r._pc=this,r}),t.RTCRtpSender.prototype.getStats=function(){const r=this;return this._pc.getStats().then(s=>LN(s,r.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){const i=n.apply(this,[]);return i.forEach(r=>r._pc=this),i}),wh(t,"track",i=>(i.receiver._pc=i.srcElement,i)),t.RTCRtpReceiver.prototype.getStats=function(){const i=this;return this._pc.getStats().then(r=>LN(r,i.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype)||!("getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const n=arguments[0];let i,r,s;return this.getSenders().forEach(c=>{c.track===n&&(i?s=!0:i=c)}),this.getReceivers().forEach(c=>(c.track===n&&(r?s=!0:r=c),c.track===n)),s||i&&r?Tt.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():r?r.getStats():Tt.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function GN(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(s=>this._shimmedLocalStreams[s][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(s,c){if(!c)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const l=e.apply(this,arguments);return this._shimmedLocalStreams[c.id]?this._shimmedLocalStreams[c.id].indexOf(l)===-1&&this._shimmedLocalStreams[c.id].push(l):this._shimmedLocalStreams[c.id]=[c,l],l};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(s){this._shimmedLocalStreams=this._shimmedLocalStreams||{},s.getTracks().forEach(d=>{if(this.getSenders().find(p=>p.track===d))throw new DOMException("Track already exists.","InvalidAccessError")});const c=this.getSenders();n.apply(this,arguments);const l=this.getSenders().filter(d=>c.indexOf(d)===-1);this._shimmedLocalStreams[s.id]=[s].concat(l)};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(s){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[s.id],i.apply(this,arguments)};const r=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(s){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},s&&Object.keys(this._shimmedLocalStreams).forEach(c=>{const l=this._shimmedLocalStreams[c].indexOf(s);l!==-1&&this._shimmedLocalStreams[c].splice(l,1),this._shimmedLocalStreams[c].length===1&&delete this._shimmedLocalStreams[c]}),r.apply(this,arguments)}}function HN(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return GN(t);const n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const d=n.apply(this);return this._reverseStreams=this._reverseStreams||{},d.map(h=>this._reverseStreams[h.id])};const i=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(d){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},d.getTracks().forEach(h=>{if(this.getSenders().find(m=>m.track===h))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[d.id]){const h=new t.MediaStream(d.getTracks());this._streams[d.id]=h,this._reverseStreams[h.id]=d,d=h}i.apply(this,[d])};const r=t.RTCPeerConnection.prototype.removeStream;function s(d,h){let p=h.sdp;return Object.keys(d._reverseStreams||[]).forEach(m=>{const _=d._reverseStreams[m],E=d._streams[_.id];p=p.replace(new RegExp(E.id,"g"),_.id)}),new RTCSessionDescription({type:h.type,sdp:p})}t.RTCPeerConnection.prototype.removeStream=function(d){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[d.id]||d]),delete this._reverseStreams[this._streams[d.id]?this._streams[d.id].id:d.id],delete this._streams[d.id]},t.RTCPeerConnection.prototype.addTrack=function(d,h){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const p=[].slice.call(arguments,1);if(p.length!==1||!p[0].getTracks().find(E=>E===d))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(E=>E.track===d))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const _=this._streams[h.id];if(_)_.addTrack(d),Tt.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const E=new t.MediaStream([d]);this._streams[h.id]=E,this._reverseStreams[E.id]=h,this.addStream(E)}return this.getSenders().find(E=>E.track===d)},["createOffer","createAnswer"].forEach(function(d){const h=t.RTCPeerConnection.prototype[d],p={[d](){const m=arguments;return arguments.length&&typeof arguments[0]=="function"?h.apply(this,[_=>{const E=s(this,_);m[0].apply(null,[E])},_=>{m[1]&&m[1].apply(null,_)},arguments[2]]):h.apply(this,arguments).then(_=>s(this,_))}};t.RTCPeerConnection.prototype[d]=p[d]});const c=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(d,h){let p=h.sdp;return Object.keys(d._reverseStreams||[]).forEach(m=>{const _=d._reverseStreams[m],E=d._streams[_.id];p=p.replace(new RegExp(_.id,"g"),E.id)}),new RTCSessionDescription({type:h.type,sdp:p})}(this,arguments[0]),c.apply(this,arguments)):c.apply(this,arguments)};const l=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const d=l.get.apply(this);return d.type===""?d:s(this,d)}}),t.RTCPeerConnection.prototype.removeTrack=function(d){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!d._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(d._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let h;this._streams=this._streams||{},Object.keys(this._streams).forEach(p=>{this._streams[p].getTracks().find(m=>d.track===m)&&(h=this._streams[p])}),h&&(h.getTracks().length===1?this.removeStream(this._reverseStreams[h.id]):h.removeTrack(d.track),this.dispatchEvent(new Event("negotiationneeded")))}}function F0(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const i=t.RTCPeerConnection.prototype[n],r={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=r[n]})}function WN(t,e){wh(t,"negotiationneeded",n=>{const i=n.target;if(!(e.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")||i.signalingState==="stable")return n})}var zN=Object.freeze({__proto__:null,fixNegotiationNeeded:WN,shimAddTrackRemoveTrack:HN,shimAddTrackRemoveTrackWithNative:GN,shimGetDisplayMedia:function(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(typeof e=="function"?t.navigator.mediaDevices.getDisplayMedia=function(n){return e(n).then(i=>{const r=n.video&&n.video.width,s=n.video&&n.video.height,c=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:i,maxFrameRate:c||3}},r&&(n.video.mandatory.maxWidth=r),s&&(n.video.mandatory.maxHeight=s),t.navigator.mediaDevices.getUserMedia(n)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:jN,shimGetStats:BN,shimGetUserMedia:MN,shimMediaStream:UN,shimOnTrack:VN,shimPeerConnection:F0,shimSenderReceiverGetStats:FN});function qN(t,e){const n=t&&t.navigator,i=t&&t.MediaStreamTrack;if(n.getUserMedia=function(r,s,c){j0("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(r).then(s,c)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const r=function(c,l,d){l in c&&!(d in c)&&(c[d]=c[l],delete c[l])},s=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(c){return typeof c=="object"&&typeof c.audio=="object"&&(c=JSON.parse(JSON.stringify(c)),r(c.audio,"autoGainControl","mozAutoGainControl"),r(c.audio,"noiseSuppression","mozNoiseSuppression")),s(c)},i&&i.prototype.getSettings){const c=i.prototype.getSettings;i.prototype.getSettings=function(){const l=c.apply(this,arguments);return r(l,"mozAutoGainControl","autoGainControl"),r(l,"mozNoiseSuppression","noiseSuppression"),l}}if(i&&i.prototype.applyConstraints){const c=i.prototype.applyConstraints;i.prototype.applyConstraints=function(l){return this.kind==="audio"&&typeof l=="object"&&(l=JSON.parse(JSON.stringify(l)),r(l,"autoGainControl","mozAutoGainControl"),r(l,"noiseSuppression","mozNoiseSuppression")),c.apply(this,[l])}}}}function KN(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function G0(t,e){if(typeof t!="object"||!t.RTCPeerConnection&&!t.mozRTCPeerConnection)return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const s=t.RTCPeerConnection.prototype[r],c={[r](){return arguments[0]=new(r==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};t.RTCPeerConnection.prototype[r]=c[r]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[r,s,c]=arguments;return i.apply(this,[r||null]).then(l=>{if(e.version<53&&!s)try{l.forEach(d=>{d.type=n[d.type]||d.type})}catch(d){if(d.name!=="TypeError")throw d;l.forEach((h,p)=>{l.set(p,Object.assign({},h,{type:n[h.type]||h.type}))})}return l}).then(s,c)}}function YN(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(r=>r._pc=this),i});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const i=n.apply(this,arguments);return i._pc=this,i}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Tt.resolve(new Map)}}function XN(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const n=e.apply(this,[]);return n.forEach(i=>i._pc=this),n}),wh(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function QN(t){t.RTCPeerConnection&&!("removeStream"in t.RTCPeerConnection.prototype)&&(t.RTCPeerConnection.prototype.removeStream=function(e){j0("removeStream","removeTrack"),this.getSenders().forEach(n=>{var i;n.track&&mt(i=e.getTracks()).call(i,n.track)&&this.removeTrack(n)})})}function JN(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function ZN(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let n=arguments[1]&&arguments[1].sendEncodings;n===void 0&&(n=[]),n=[...n];const i=n.length>0;i&&n.forEach(s=>{if("rid"in s&&!/^[a-z0-9]{0,16}$/i.test(s.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in s&&!(parseFloat(s.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in s&&!(parseFloat(s.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const r=e.apply(this,arguments);if(i){const{sender:s}=r,c=s.getParameters();(!("encodings"in c)||c.encodings.length===1&&Object.keys(c.encodings[0]).length===0)&&(c.encodings=n,s.sendEncodings=n,this.setParametersPromises.push(s.setParameters(c).then(()=>{delete s.sendEncodings}).catch(()=>{delete s.sendEncodings})))}return r})}function $N(t){if(typeof t!="object"||!t.RTCRtpSender)return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const n=e.apply(this,arguments);return"encodings"in n||(n.encodings=[].concat(this.sendEncodings||[{}])),n})}function tD(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Tt.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function eD(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Tt.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var nD=Object.freeze({__proto__:null,shimAddTransceiver:ZN,shimCreateAnswer:eD,shimCreateOffer:tD,shimGetDisplayMedia:function(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,Tt.reject(i)}return n.video===!0?n.video={mediaSource:e}:n.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:$N,shimGetUserMedia:qN,shimOnTrack:KN,shimPeerConnection:G0,shimRTCDataChannel:JN,shimReceiverGetStats:XN,shimRemoveStream:QN,shimSenderGetStats:YN});function iD(t){if(typeof t=="object"&&t.RTCPeerConnection){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(n){var i;this._localStreams||(this._localStreams=[]),mt(i=this._localStreams).call(i,n)||this._localStreams.push(n),n.getAudioTracks().forEach(r=>e.call(this,r,n)),n.getVideoTracks().forEach(r=>e.call(this,r,n))},t.RTCPeerConnection.prototype.addTrack=function(n){for(var i=arguments.length,r=new Array(i>1?i-1:0),s=1;s<i;s++)r[s-1]=arguments[s];return r&&r.forEach(c=>{var l;this._localStreams?mt(l=this._localStreams).call(l,c)||this._localStreams.push(c):this._localStreams=[c]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const n=this._localStreams.indexOf(e);if(n===-1)return;this._localStreams.splice(n,1);const i=e.getTracks();this.getSenders().forEach(r=>{mt(i).call(i,r.track)&&this.removeTrack(r)})})}}function rD(t){if(typeof t=="object"&&t.RTCPeerConnection&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(r=>{var s;if(this._remoteStreams||(this._remoteStreams=[]),mt(s=this._remoteStreams).call(s,r))return;this._remoteStreams.push(r);const c=new Event("addstream");c.stream=r,this.dispatchEvent(c)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(r=>{if(n._remoteStreams||(n._remoteStreams=[]),n._remoteStreams.indexOf(r)>=0)return;n._remoteStreams.push(r);const s=new Event("addstream");s.stream=r,n.dispatchEvent(s)})}),e.apply(n,arguments)}}}function aD(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,i=e.createAnswer,r=e.setLocalDescription,s=e.setRemoteDescription,c=e.addIceCandidate;e.createOffer=function(d,h){const p=arguments.length>=2?arguments[2]:arguments[0],m=n.apply(this,[p]);return h?(m.then(d,h),Tt.resolve()):m},e.createAnswer=function(d,h){const p=arguments.length>=2?arguments[2]:arguments[0],m=i.apply(this,[p]);return h?(m.then(d,h),Tt.resolve()):m};let l=function(d,h,p){const m=r.apply(this,[d]);return p?(m.then(h,p),Tt.resolve()):m};e.setLocalDescription=l,l=function(d,h,p){const m=s.apply(this,[d]);return p?(m.then(h,p),Tt.resolve()):m},e.setRemoteDescription=l,l=function(d,h,p){const m=c.apply(this,[d]);return p?(m.then(h,p),Tt.resolve()):m},e.addIceCandidate=l}function sD(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const n=e.mediaDevices,i=n.getUserMedia.bind(n);e.mediaDevices.getUserMedia=r=>i(oD(r))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(n,i,r){e.mediaDevices.getUserMedia(n).then(i,r)}).bind(e))}function oD(t){return t&&t.video!==void 0?Object.assign({},t,{video:kN(t.video)}):t}function cD(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(n,i){if(n&&n.iceServers){const r=[];for(let s=0;s<n.iceServers.length;s++){let c=n.iceServers[s];!c.hasOwnProperty("urls")&&c.hasOwnProperty("url")?(j0("RTCIceServer.url","RTCIceServer.urls"),c=JSON.parse(JSON.stringify(c)),c.urls=c.url,delete c.url,r.push(c)):r.push(n.iceServers[s])}n.iceServers=r}return new e(n,i)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get:()=>e.generateCertificate})}function lD(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function dD(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(n){if(n){n.offerToReceiveAudio!==void 0&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);const i=this.getTransceivers().find(s=>s.receiver.track.kind==="audio");n.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):n.offerToReceiveAudio!==!0||i||this.addTransceiver("audio",{direction:"recvonly"}),n.offerToReceiveVideo!==void 0&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);const r=this.getTransceivers().find(s=>s.receiver.track.kind==="video");n.offerToReceiveVideo===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):n.offerToReceiveVideo!==!0||r||this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function uD(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var hD=Object.freeze({__proto__:null,shimAudioContext:uD,shimCallbacksAPI:aD,shimConstraints:oD,shimCreateOfferLegacy:dD,shimGetUserMedia:sD,shimLocalStreamsAPI:iD,shimRTCIceServerUrls:cD,shimRemoteStreamsAPI:rD,shimTrackEventTransceiver:lD}),pD=`	
\v\f\r                　\u2028\u2029\uFEFF`,e3=ha,n3=ji,H0=pD,fD=Et("".replace),i3=RegExp("^["+H0+"]+"),r3=RegExp("(^|[^"+H0+"])["+H0+"]+$"),a3=function(t){return function(e){var n=n3(e3(e));return 1&t&&(n=fD(n,i3,"")),2&t&&(n=fD(n,r3,"$1")),n}},s3={trim:a3(3)},o3=al.PROPER,c3=B,mD=pD,l3=s3.trim;Le({target:"String",proto:!0,forced:function(t){return c3(function(){return!!mD[t]()||"​᠎"[t]()!=="​᠎"||o3&&mD[t].name!==t})}("trim")},{trim:function(){return l3(this)}});var d3=$r("String","trim"),u3=vt,h3=d3,W0=String.prototype,p3=function(t){var e=t.trim;return typeof t=="string"||t===W0||u3(W0,t)&&e===W0.trim?h3:e},dr=V(p3),_D={exports:{}};(function(t){const e={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};e.localCName=e.generateIdentifier(),e.splitLines=function(n){return n.trim().split(`
`).map(i=>i.trim())},e.splitSections=function(n){return n.split(`
m=`).map((i,r)=>(r>0?"m="+i:i).trim()+`\r
`)},e.getDescription=function(n){const i=e.splitSections(n);return i&&i[0]},e.getMediaSections=function(n){const i=e.splitSections(n);return i.shift(),i},e.matchPrefix=function(n,i){return e.splitLines(n).filter(r=>r.indexOf(i)===0)},e.parseCandidate=function(n){let i;i=n.indexOf("a=candidate:")===0?n.substring(12).split(" "):n.substring(10).split(" ");const r={foundation:i[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]};for(let s=8;s<i.length;s+=2)switch(i[s]){case"raddr":r.relatedAddress=i[s+1];break;case"rport":r.relatedPort=parseInt(i[s+1],10);break;case"tcptype":r.tcpType=i[s+1];break;case"ufrag":r.ufrag=i[s+1],r.usernameFragment=i[s+1];break;default:r[i[s]]===void 0&&(r[i[s]]=i[s+1])}return r},e.writeCandidate=function(n){const i=[];i.push(n.foundation);const r=n.component;r==="rtp"?i.push(1):r==="rtcp"?i.push(2):i.push(r),i.push(n.protocol.toUpperCase()),i.push(n.priority),i.push(n.address||n.ip),i.push(n.port);const s=n.type;return i.push("typ"),i.push(s),s!=="host"&&n.relatedAddress&&n.relatedPort&&(i.push("raddr"),i.push(n.relatedAddress),i.push("rport"),i.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(i.push("ufrag"),i.push(n.usernameFragment||n.ufrag)),"candidate:"+i.join(" ")},e.parseIceOptions=function(n){return n.substring(14).split(" ")},e.parseRtpMap=function(n){let i=n.substring(9).split(" ");const r={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),r.name=i[0],r.clockRate=parseInt(i[1],10),r.channels=i.length===3?parseInt(i[2],10):1,r.numChannels=r.channels,r},e.writeRtpMap=function(n){let i=n.payloadType;n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType);const r=n.channels||n.numChannels||1;return"a=rtpmap:"+i+" "+n.name+"/"+n.clockRate+(r!==1?"/"+r:"")+`\r
`},e.parseExtmap=function(n){const i=n.substring(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1],attributes:i.slice(2).join(" ")}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},e.parseFmtp=function(n){const i={};let r;const s=n.substring(n.indexOf(" ")+1).split(";");for(let c=0;c<s.length;c++)r=s[c].trim().split("="),i[r[0].trim()]=r[1];return i},e.writeFmtp=function(n){let i="",r=n.payloadType;if(n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const s=[];Object.keys(n.parameters).forEach(c=>{n.parameters[c]!==void 0?s.push(c+"="+n.parameters[c]):s.push(c)}),i+="a=fmtp:"+r+" "+s.join(";")+`\r
`}return i},e.parseRtcpFb=function(n){const i=n.substring(n.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},e.writeRtcpFb=function(n){let i="",r=n.payloadType;return n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(s=>{i+="a=rtcp-fb:"+r+" "+s.type+(s.parameter&&s.parameter.length?" "+s.parameter:"")+`\r
`}),i},e.parseSsrcMedia=function(n){const i=n.indexOf(" "),r={ssrc:parseInt(n.substring(7,i),10)},s=n.indexOf(":",i);return s>-1?(r.attribute=n.substring(i+1,s),r.value=n.substring(s+1)):r.attribute=n.substring(i+1),r},e.parseSsrcGroup=function(n){const i=n.substring(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(r=>parseInt(r,10))}},e.getMid=function(n){const i=e.matchPrefix(n,"a=mid:")[0];if(i)return i.substring(6)},e.parseFingerprint=function(n){const i=n.substring(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},e.getDtlsParameters=function(n,i){return{role:"auto",fingerprints:e.matchPrefix(n+i,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(n,i){let r="a=setup:"+i+`\r
`;return n.fingerprints.forEach(s=>{r+="a=fingerprint:"+s.algorithm+" "+s.value+`\r
`}),r},e.parseCryptoLine=function(n){const i=n.substring(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},e.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?e.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const i=n.substring(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},e.getCryptoParameters=function(n,i){return e.matchPrefix(n+i,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(n,i){const r=e.matchPrefix(n+i,"a=ice-ufrag:")[0],s=e.matchPrefix(n+i,"a=ice-pwd:")[0];return r&&s?{usernameFragment:r.substring(12),password:s.substring(10)}:null},e.writeIceParameters=function(n){let i="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(i+=`a=ice-lite\r
`),i},e.parseRtpParameters=function(n){const i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=e.splitLines(n)[0].split(" ");i.profile=r[2];for(let c=3;c<r.length;c++){const l=r[c],d=e.matchPrefix(n,"a=rtpmap:"+l+" ")[0];if(d){const h=e.parseRtpMap(d),p=e.matchPrefix(n,"a=fmtp:"+l+" ");switch(h.parameters=p.length?e.parseFmtp(p[0]):{},h.rtcpFeedback=e.matchPrefix(n,"a=rtcp-fb:"+l+" ").map(e.parseRtcpFb),i.codecs.push(h),h.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(h.name.toUpperCase())}}}e.matchPrefix(n,"a=extmap:").forEach(c=>{i.headerExtensions.push(e.parseExtmap(c))});const s=e.matchPrefix(n,"a=rtcp-fb:* ").map(e.parseRtcpFb);return i.codecs.forEach(c=>{s.forEach(l=>{c.rtcpFeedback.find(d=>d.type===l.type&&d.parameter===l.parameter)||c.rtcpFeedback.push(l)})}),i},e.writeRtpDescription=function(n,i){let r="";r+="m="+n+" ",r+=i.codecs.length>0?"9":"0",r+=" "+(i.profile||"UDP/TLS/RTP/SAVPF")+" ",r+=i.codecs.map(c=>c.preferredPayloadType!==void 0?c.preferredPayloadType:c.payloadType).join(" ")+`\r
`,r+=`c=IN IP4 0.0.0.0\r
`,r+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(c=>{r+=e.writeRtpMap(c),r+=e.writeFmtp(c),r+=e.writeRtcpFb(c)});let s=0;return i.codecs.forEach(c=>{c.maxptime>s&&(s=c.maxptime)}),s>0&&(r+="a=maxptime:"+s+`\r
`),i.headerExtensions&&i.headerExtensions.forEach(c=>{r+=e.writeExtmap(c)}),r},e.parseRtpEncodingParameters=function(n){const i=[],r=e.parseRtpParameters(n),s=r.fecMechanisms.indexOf("RED")!==-1,c=r.fecMechanisms.indexOf("ULPFEC")!==-1,l=e.matchPrefix(n,"a=ssrc:").map(_=>e.parseSsrcMedia(_)).filter(_=>_.attribute==="cname"),d=l.length>0&&l[0].ssrc;let h;const p=e.matchPrefix(n,"a=ssrc-group:FID").map(_=>_.substring(17).split(" ").map(E=>parseInt(E,10)));p.length>0&&p[0].length>1&&p[0][0]===d&&(h=p[0][1]),r.codecs.forEach(_=>{if(_.name.toUpperCase()==="RTX"&&_.parameters.apt){let E={ssrc:d,codecPayloadType:parseInt(_.parameters.apt,10)};d&&h&&(E.rtx={ssrc:h}),i.push(E),s&&(E=JSON.parse(JSON.stringify(E)),E.fec={ssrc:d,mechanism:c?"red+ulpfec":"red"},i.push(E))}}),i.length===0&&d&&i.push({ssrc:d});let m=e.matchPrefix(n,"b=");return m.length&&(m=m[0].indexOf("b=TIAS:")===0?parseInt(m[0].substring(7),10):m[0].indexOf("b=AS:")===0?1e3*parseInt(m[0].substring(5),10)*.95-16e3:void 0,i.forEach(_=>{_.maxBitrate=m})),i},e.parseRtcpParameters=function(n){const i={},r=e.matchPrefix(n,"a=ssrc:").map(l=>e.parseSsrcMedia(l)).filter(l=>l.attribute==="cname")[0];r&&(i.cname=r.value,i.ssrc=r.ssrc);const s=e.matchPrefix(n,"a=rtcp-rsize");i.reducedSize=s.length>0,i.compound=s.length===0;const c=e.matchPrefix(n,"a=rtcp-mux");return i.mux=c.length>0,i},e.writeRtcpParameters=function(n){let i="";return n.reducedSize&&(i+=`a=rtcp-rsize\r
`),n.mux&&(i+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(i+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),i},e.parseMsid=function(n){let i;const r=e.matchPrefix(n,"a=msid:");if(r.length===1)return i=r[0].substring(7).split(" "),{stream:i[0],track:i[1]};const s=e.matchPrefix(n,"a=ssrc:").map(c=>e.parseSsrcMedia(c)).filter(c=>c.attribute==="msid");return s.length>0?(i=s[0].value.split(" "),{stream:i[0],track:i[1]}):void 0},e.parseSctpDescription=function(n){const i=e.parseMLine(n),r=e.matchPrefix(n,"a=max-message-size:");let s;r.length>0&&(s=parseInt(r[0].substring(19),10)),isNaN(s)&&(s=65536);const c=e.matchPrefix(n,"a=sctp-port:");if(c.length>0)return{port:parseInt(c[0].substring(12),10),protocol:i.fmt,maxMessageSize:s};const l=e.matchPrefix(n,"a=sctpmap:");if(l.length>0){const d=l[0].substring(10).split(" ");return{port:parseInt(d[0],10),protocol:d[1],maxMessageSize:s}}},e.writeSctpDescription=function(n,i){let r=[];return r=n.protocol!=="DTLS/SCTP"?["m="+n.kind+" 9 "+n.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:["m="+n.kind+" 9 "+n.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&r.push("a=max-message-size:"+i.maxMessageSize+`\r
`),r.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(n,i,r){let s;const c=i!==void 0?i:2;return s=n||e.generateSessionId(),`v=0\r
o=`+(r||"thisisadapterortc")+" "+s+" "+c+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(n,i){const r=e.splitLines(n);for(let s=0;s<r.length;s++)switch(r[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[s].substring(2)}return i?e.getDirection(i):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substring(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){const i=e.splitLines(n)[0].substring(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},e.parseOLine=function(n){const i=e.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const i=e.splitLines(n);for(let r=0;r<i.length;r++)if(i[r].length<2||i[r].charAt(1)!=="=")return!1;return!0},t.exports=e})(_D);var ED=_D.exports,Xf=V(ED),f3=y({__proto__:null,default:Xf},[ED]);function vy(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(n){if(typeof n=="object"&&n.candidate&&n.candidate.indexOf("a=")===0&&((n=JSON.parse(JSON.stringify(n))).candidate=n.candidate.substr(2)),n.candidate&&n.candidate.length){const i=new e(n),r=Xf.parseCandidate(n.candidate),s=Object.assign(i,r);return s.toJSON=function(){return{candidate:s.candidate,sdpMid:s.sdpMid,sdpMLineIndex:s.sdpMLineIndex,usernameFragment:s.usernameFragment}},s}return new e(n)},t.RTCIceCandidate.prototype=e.prototype,wh(t,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new t.RTCIceCandidate(n.candidate),writable:"false"}),n))}function z0(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||wh(t,"icecandidate",e=>{if(e.candidate){const n=Xf.parseCandidate(e.candidate.candidate);n.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return e})}function Sy(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const n=function(l){if(!l||!l.sdp)return!1;const d=Xf.splitSections(l.sdp);return d.shift(),d.some(h=>{const p=Xf.parseMLine(h);return p&&p.kind==="application"&&p.protocol.indexOf("SCTP")!==-1})},i=function(l){const d=l.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(d===null||d.length<2)return-1;const h=parseInt(d[1],10);return h!=h?-1:h},r=function(l){let d=65536;return e.browser==="firefox"&&(d=e.version<57?l===-1?16384:2147483637:e.version<60?e.version===57?65535:65536:2147483637),d},s=function(l,d){let h=65536;e.browser==="firefox"&&e.version===57&&(h=65535);const p=Xf.matchPrefix(l.sdp,"a=max-message-size:");return p.length>0?h=parseInt(p[0].substr(19),10):e.browser==="firefox"&&d!==-1&&(h=2147483637),h},c=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:l}=this.getConfiguration();l==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const l=i(arguments[0]),d=r(l),h=s(arguments[0],l);let p;p=d===0&&h===0?Number.POSITIVE_INFINITY:d===0||h===0?Math.max(d,h):Math.min(d,h);const m={};Object.defineProperty(m,"maxMessageSize",{get:()=>p}),this._sctp=m}return c.apply(this,arguments)}}function Ty(t){if(!t.RTCPeerConnection||!("createDataChannel"in t.RTCPeerConnection.prototype))return;function e(i,r){const s=i.send;i.send=function(){const c=arguments[0],l=c.length||c.size||c.byteLength;if(i.readyState==="open"&&r.sctp&&l>r.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+r.sctp.maxMessageSize+" bytes)");return s.apply(i,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const i=n.apply(this,arguments);return e(i,this),i},wh(t,"datachannel",i=>(e(i.channel,i.target),i))}function q0(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const i=e[n];e[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=r=>{const s=r.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;const c=new Event("connectionstatechange",r);s.dispatchEvent(c)}return r},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function K0(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e.version>=605)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(i){if(i&&i.sdp&&i.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const r=i.sdp.split(`
`).filter(s=>dr(s).call(s)!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&i instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:i.type,sdp:r}):i.sdp=r}return n.apply(this,arguments)}}function yy(t,e){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const n=t.RTCPeerConnection.prototype.addIceCandidate;n&&n.length!==0&&(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Tt.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Tt.resolve())})}function Ry(t,e){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const n=t.RTCPeerConnection.prototype.setLocalDescription;n&&n.length!==0&&(t.RTCPeerConnection.prototype.setLocalDescription=function(){let i=arguments[0]||{};if(typeof i!="object"||i.type&&i.sdp)return n.apply(this,arguments);if(i={type:i.type,sdp:i.sdp},!i.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":i.type="offer";break;default:i.type="answer"}return i.sdp||i.type!=="offer"&&i.type!=="answer"?n.apply(this,[i]):(i.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(r=>n.apply(this,[r]))})}var m3=Object.freeze({__proto__:null,removeExtmapAllowMixed:K0,shimAddIceCandidateNullOrEmpty:yy,shimConnectionState:q0,shimMaxMessageSize:Sy,shimParameterlessSetLocalDescription:Ry,shimRTCIceCandidate:vy,shimRTCIceCandidateRelayProtocol:z0,shimSendThrowTypeError:Ty});(function(){let{window:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=DN,i=function(s){const c={browser:null,version:null};if(s===void 0||!s.navigator)return c.browser="Not a browser.",c;const{navigator:l}=s;if(l.mozGetUserMedia)c.browser="firefox",c.version=gy(l.userAgent,/Firefox\/(\d+)\./,1);else if(l.webkitGetUserMedia||s.isSecureContext===!1&&s.webkitRTCPeerConnection)c.browser="chrome",c.version=gy(l.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!s.RTCPeerConnection||!l.userAgent.match(/AppleWebKit\/(\d+)\./))return c.browser="Not a supported browser.",c;c.browser="safari",c.version=gy(l.userAgent,/AppleWebKit\/(\d+)\./,1),c.supportsUnifiedPlan=s.RTCRtpTransceiver&&"currentDirection"in s.RTCRtpTransceiver.prototype}return c}(t),r={browserDetails:i,commonShim:m3,extractVersion:gy,disableLog:$F,disableWarnings:t3,sdp:f3};switch(i.browser){case"chrome":if(!zN||!F0||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),r;if(i.version===null)return n("Chrome shim can not determine version, not shimming."),r;n("adapter.js shimming chrome."),r.browserShim=zN,yy(t,i),Ry(t),MN(t,i),UN(t),F0(t,i),VN(t),HN(t,i),jN(t),BN(t),FN(t),WN(t,i),vy(t),z0(t),q0(t),Sy(t,i),Ty(t),K0(t,i);break;case"firefox":if(!nD||!G0||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),r;n("adapter.js shimming firefox."),r.browserShim=nD,yy(t,i),Ry(t),qN(t,i),G0(t,i),KN(t),QN(t),YN(t),XN(t),JN(t),ZN(t),$N(t),tD(t),eD(t),vy(t),q0(t),Sy(t,i),Ty(t);break;case"safari":if(!hD||!e.shimSafari)return n("Safari shim is not included in this adapter release."),r;n("adapter.js shimming safari."),r.browserShim=hD,yy(t,i),Ry(t),cD(t),dD(t),aD(t),iD(t),rD(t),lD(t),sD(t),uD(t),vy(t),z0(t),Sy(t,i),Ty(t),K0(t,i);break;default:n("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var Y0=xt;Le({global:!0,forced:Y0.globalThis!==Y0},{globalThis:Y0});var gD=V(xt),X0={exports:{}};(function(t,e){(function(n,i){var r="function",s="undefined",c="object",l="string",d="major",h="model",p="name",m="type",_="vendor",E="version",I="architecture",C="console",w="mobile",D="tablet",N="smarttv",L="wearable",W="embedded",G="Amazon",U="Apple",z="ASUS",$="BlackBerry",rt="Browser",dt="Chrome",ae="Firefox",se="Google",zt="Huawei",ke="LG",De="Microsoft",Xi="Motorola",it="Opera",ft="Samsung",wt="Sharp",at="Sony",b="Xiaomi",M="Zebra",F="Facebook",pt="Chromium OS",$t="Mac OS",nn=" Browser",ei=function(Jn){for(var ni={},cn=0;cn<Jn.length;cn++)ni[Jn[cn].toUpperCase()]=Jn[cn];return ni},cs=function(Jn,ni){return typeof Jn===l&&Hs(ni).indexOf(Hs(Jn))!==-1},Hs=function(Jn){return Jn.toLowerCase()},vv=function(Jn,ni){if(typeof Jn===l)return Jn=Jn.replace(/^\s\s*/,""),typeof ni===s?Jn:Jn.substring(0,500)},ep=function(Jn,ni){for(var cn,Xr,ko,Bn,kl,Te,Lo=0;Lo<ni.length&&!kl;){var np=ni[Lo],Pc=ni[Lo+1];for(cn=Xr=0;cn<np.length&&!kl&&np[cn];)if(kl=np[cn++].exec(Jn))for(ko=0;ko<Pc.length;ko++)Te=kl[++Xr],typeof(Bn=Pc[ko])===c&&Bn.length>0?Bn.length===2?typeof Bn[1]==r?this[Bn[0]]=Bn[1].call(this,Te):this[Bn[0]]=Bn[1]:Bn.length===3?typeof Bn[1]!==r||Bn[1].exec&&Bn[1].test?this[Bn[0]]=Te?Te.replace(Bn[1],Bn[2]):i:this[Bn[0]]=Te?Bn[1].call(this,Te,Bn[2]):i:Bn.length===4&&(this[Bn[0]]=Te?Bn[3].call(this,Te.replace(Bn[1],Bn[2])):i):this[Bn]=Te||i;Lo+=2}},Gm=function(Jn,ni){for(var cn in ni)if(typeof ni[cn]===c&&ni[cn].length>0){for(var Xr=0;Xr<ni[cn].length;Xr++)if(cs(ni[cn][Xr],Jn))return cn==="?"?i:cn}else if(cs(ni[cn],Jn))return cn==="?"?i:cn;return ni.hasOwnProperty("*")?ni["*"]:Jn},Rb={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},bb={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[E,[p,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[E,[p,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[p,E],[/opios[\/ ]+([\w\.]+)/i],[E,[p,it+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[E,[p,it+" GX"]],[/\bopr\/([\w\.]+)/i],[E,[p,it]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[E,[p,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[E,[p,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[p,E],[/quark(?:pc)?\/([-\w\.]+)/i],[E,[p,"Quark"]],[/\bddg\/([\w\.]+)/i],[E,[p,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[E,[p,"UC"+rt]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[E,[p,"WeChat"]],[/konqueror\/([\w\.]+)/i],[E,[p,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[E,[p,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[E,[p,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[E,[p,"Smart Lenovo "+rt]],[/(avast|avg)\/([\w\.]+)/i],[[p,/(.+)/,"$1 Secure "+rt],E],[/\bfocus\/([\w\.]+)/i],[E,[p,ae+" Focus"]],[/\bopt\/([\w\.]+)/i],[E,[p,it+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[E,[p,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[E,[p,"Dolphin"]],[/coast\/([\w\.]+)/i],[E,[p,it+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[E,[p,"MIUI"+nn]],[/fxios\/([\w\.-]+)/i],[E,[p,ae]],[/\bqihoobrowser\/?([\w\.]*)/i],[E,[p,"360"]],[/\b(qq)\/([\w\.]+)/i],[[p,/(.+)/,"$1Browser"],E],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[p,/(.+)/,"$1"+nn],E],[/samsungbrowser\/([\w\.]+)/i],[E,[p,ft+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[E,[p,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[p,"Sogou Mobile"],E],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[p,E],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[p],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[E,p],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[p,F],E],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[p,E],[/\bgsa\/([\w\.]+) .*safari\//i],[E,[p,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[E,[p,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[E,[p,dt+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[p,dt+" WebView"],E],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[E,[p,"Android "+rt]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[p,E],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[E,[p,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[E,p],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[p,[E,Gm,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[p,E],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[p,"Netscape"],E],[/(wolvic|librewolf)\/([\w\.]+)/i],[p,E],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[E,[p,ae+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[p,[E,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[p,[E,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[I,"amd64"]],[/(ia32(?=;))/i],[[I,Hs]],[/((?:i[346]|x)86)[;\)]/i],[[I,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[I,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[I,"armhf"]],[/windows (ce|mobile); ppc;/i],[[I,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[I,/ower/,"",Hs]],[/(sun4\w)[;\)]/i],[[I,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[I,Hs]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[h,[_,ft],[m,D]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[h,[_,ft],[m,w]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[h,[_,U],[m,w]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[h,[_,U],[m,D]],[/(macintosh);/i],[h,[_,U]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[h,[_,wt],[m,w]],[/(?:honor)([-\w ]+)[;\)]/i],[h,[_,"Honor"],[m,w]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[h,[_,zt],[m,D]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[h,[_,zt],[m,w]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[h,/_/g," "],[_,b],[m,w]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[h,/_/g," "],[_,b],[m,D]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[h,[_,"OPPO"],[m,w]],[/\b(opd2\d{3}a?) bui/i],[h,[_,"OPPO"],[m,D]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[h,[_,"Vivo"],[m,w]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[h,[_,"Realme"],[m,w]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[h,[_,Xi],[m,w]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[h,[_,Xi],[m,D]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[h,[_,ke],[m,D]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[h,[_,ke],[m,w]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[h,[_,"Lenovo"],[m,D]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[h,/_/g," "],[_,"Nokia"],[m,w]],[/(pixel c)\b/i],[h,[_,se],[m,D]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[h,[_,se],[m,w]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[h,[_,at],[m,w]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[h,"Xperia Tablet"],[_,at],[m,D]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[h,[_,"OnePlus"],[m,w]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[h,[_,G],[m,D]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[h,/(.+)/g,"Fire Phone $1"],[_,G],[m,w]],[/(playbook);[-\w\),; ]+(rim)/i],[h,_,[m,D]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[h,[_,$],[m,w]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[h,[_,z],[m,D]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[h,[_,z],[m,w]],[/(nexus 9)/i],[h,[_,"HTC"],[m,D]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[_,[h,/_/g," "],[m,w]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[h,[_,"TCL"],[m,D]],[/(itel) ((\w+))/i],[[_,Hs],h,[m,Gm,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[h,[_,"Acer"],[m,D]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[h,[_,"Meizu"],[m,w]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[h,[_,"Ulefone"],[m,w]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[h,[_,"Energizer"],[m,w]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[h,[_,"Cat"],[m,w]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[h,[_,"Smartfren"],[m,w]],[/droid.+; (a(?:015|06[35]|142p?))/i],[h,[_,"Nothing"],[m,w]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (imo) ((?!tab)[\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[_,h,[m,w]],[/(imo) (tab \w+)/i,/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[_,h,[m,D]],[/(surface duo)/i],[h,[_,De],[m,D]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[h,[_,"Fairphone"],[m,w]],[/(u304aa)/i],[h,[_,"AT&T"],[m,w]],[/\bsie-(\w*)/i],[h,[_,"Siemens"],[m,w]],[/\b(rct\w+) b/i],[h,[_,"RCA"],[m,D]],[/\b(venue[\d ]{2,7}) b/i],[h,[_,"Dell"],[m,D]],[/\b(q(?:mv|ta)\w+) b/i],[h,[_,"Verizon"],[m,D]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[h,[_,"Barnes & Noble"],[m,D]],[/\b(tm\d{3}\w+) b/i],[h,[_,"NuVision"],[m,D]],[/\b(k88) b/i],[h,[_,"ZTE"],[m,D]],[/\b(nx\d{3}j) b/i],[h,[_,"ZTE"],[m,w]],[/\b(gen\d{3}) b.+49h/i],[h,[_,"Swiss"],[m,w]],[/\b(zur\d{3}) b/i],[h,[_,"Swiss"],[m,D]],[/\b((zeki)?tb.*\b) b/i],[h,[_,"Zeki"],[m,D]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[_,"Dragon Touch"],h,[m,D]],[/\b(ns-?\w{0,9}) b/i],[h,[_,"Insignia"],[m,D]],[/\b((nxa|next)-?\w{0,9}) b/i],[h,[_,"NextBook"],[m,D]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[_,"Voice"],h,[m,w]],[/\b(lvtel\-)?(v1[12]) b/i],[[_,"LvTel"],h,[m,w]],[/\b(ph-1) /i],[h,[_,"Essential"],[m,w]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[h,[_,"Envizen"],[m,D]],[/\b(trio[-\w\. ]+) b/i],[h,[_,"MachSpeed"],[m,D]],[/\btu_(1491) b/i],[h,[_,"Rotor"],[m,D]],[/(shield[\w ]+) b/i],[h,[_,"Nvidia"],[m,D]],[/(sprint) (\w+)/i],[_,h,[m,w]],[/(kin\.[onetw]{3})/i],[[h,/\./g," "],[_,De],[m,w]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[h,[_,M],[m,D]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[h,[_,M],[m,w]],[/smart-tv.+(samsung)/i],[_,[m,N]],[/hbbtv.+maple;(\d+)/i],[[h,/^/,"SmartTV"],[_,ft],[m,N]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[_,ke],[m,N]],[/(apple) ?tv/i],[_,[h,U+" TV"],[m,N]],[/crkey/i],[[h,dt+"cast"],[_,se],[m,N]],[/droid.+aft(\w+)( bui|\))/i],[h,[_,G],[m,N]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[h,[_,wt],[m,N]],[/(bravia[\w ]+)( bui|\))/i],[h,[_,at],[m,N]],[/(mitv-\w{5}) bui/i],[h,[_,b],[m,N]],[/Hbbtv.*(technisat) (.*);/i],[_,h,[m,N]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[_,vv],[h,vv],[m,N]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[m,N]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[_,h,[m,C]],[/droid.+; (shield) bui/i],[h,[_,"Nvidia"],[m,C]],[/(playstation [345portablevi]+)/i],[h,[_,at],[m,C]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[h,[_,De],[m,C]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[h,[_,ft],[m,L]],[/((pebble))app/i],[_,h,[m,L]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[h,[_,U],[m,L]],[/droid.+; (glass) \d/i],[h,[_,se],[m,L]],[/droid.+; (wt63?0{2,3})\)/i],[h,[_,M],[m,L]],[/droid.+; (glass) \d/i],[h,[_,se],[m,L]],[/(pico) (4|neo3(?: link|pro)?)/i],[_,h,[m,L]],[/; (quest( \d| pro)?)/i],[h,[_,F],[m,L]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[_,[m,W]],[/(aeobc)\b/i],[h,[_,G],[m,W]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[h,[m,w]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[h,[m,D]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[m,D]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[m,w]],[/(android[-\w\. ]{0,9});.+buil/i],[h,[_,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[E,[p,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[p,E],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[E,[p,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[p,E],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[E,p]],os:[[/microsoft (windows) (vista|xp)/i],[p,E],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[p,[E,Gm,Rb]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[E,Gm,Rb],[p,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[E,/_/g,"."],[p,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[p,$t],[E,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[E,p],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish|openharmony)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[p,E],[/\(bb(10);/i],[E,[p,$]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[E,[p,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[E,[p,ae+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[E,[p,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[E,[p,"watchOS"]],[/crkey\/([\d\.]+)/i],[E,[p,dt+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[p,pt],E],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[p,E],[/(sunos) ?([\w\.\d]*)/i],[[p,"Solaris"],E],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[p,E]]},ls=function(Jn,ni){if(typeof Jn===c&&(ni=Jn,Jn=i),!(this instanceof ls))return new ls(Jn,ni).getResult();var cn=typeof n!==s&&n.navigator?n.navigator:i,Xr=Jn||(cn&&cn.userAgent?cn.userAgent:""),ko=cn&&cn.userAgentData?cn.userAgentData:i,Bn=ni?function(Te,Lo){var np={};for(var Pc in Te)Lo[Pc]&&Lo[Pc].length%2==0?np[Pc]=Lo[Pc].concat(Te[Pc]):np[Pc]=Te[Pc];return np}(bb,ni):bb,kl=cn&&cn.userAgent==Xr;return this.getBrowser=function(){var Te={};return Te[p]=i,Te[E]=i,ep.call(Te,Xr,Bn.browser),Te[d]=function(Lo){return typeof Lo===l?Lo.replace(/[^\d\.]/g,"").split(".")[0]:i}(Te[E]),kl&&cn&&cn.brave&&typeof cn.brave.isBrave==r&&(Te[p]="Brave"),Te},this.getCPU=function(){var Te={};return Te[I]=i,ep.call(Te,Xr,Bn.cpu),Te},this.getDevice=function(){var Te={};return Te[_]=i,Te[h]=i,Te[m]=i,ep.call(Te,Xr,Bn.device),kl&&!Te[m]&&ko&&ko.mobile&&(Te[m]=w),kl&&Te[h]=="Macintosh"&&cn&&typeof cn.standalone!==s&&cn.maxTouchPoints&&cn.maxTouchPoints>2&&(Te[h]="iPad",Te[m]=D),Te},this.getEngine=function(){var Te={};return Te[p]=i,Te[E]=i,ep.call(Te,Xr,Bn.engine),Te},this.getOS=function(){var Te={};return Te[p]=i,Te[E]=i,ep.call(Te,Xr,Bn.os),kl&&!Te[p]&&ko&&ko.platform&&ko.platform!="Unknown"&&(Te[p]=ko.platform.replace(/chrome os/i,pt).replace(/macos/i,$t)),Te},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return Xr},this.setUA=function(Te){return Xr=typeof Te===l&&Te.length>500?vv(Te,500):Te,this},this.setUA(Xr),this};ls.VERSION="0.7.40",ls.BROWSER=ei([p,E,d]),ls.CPU=ei([I]),ls.DEVICE=ei([h,_,m,C,w,N,D,L,W]),ls.ENGINE=ls.OS=ei([p,E]),t.exports&&(e=t.exports=ls),e.UAParser=ls;var Pl=typeof n!==s&&(n.jQuery||n.Zepto);if(Pl&&!Pl.ua){var Cb=new ls;Pl.ua=Cb.getResult(),Pl.ua.get=function(){return Cb.getUA()},Pl.ua.set=function(Jn){Cb.setUA(Jn);var ni=Cb.getResult();for(var cn in ni)Pl.ua[cn]=ni[cn]}}})(typeof window=="object"?window:A)})(X0,X0.exports);var _3=V(X0.exports),vD=Ya.clear;Le({global:!0,bind:!0,forced:xt.clearImmediate!==vD},{clearImmediate:vD});var SD=xt,E3=Be,g3=qt,v3=Zl,S3=We,T3=Cr,y3=Fr,R3=SD.Function,b3=/MSIE .\./.test(S3)||v3==="BUN"&&function(){var t=SD.Bun.version.split(".");return t.length<3||t[0]==="0"&&(t[1]<3||t[1]==="3"&&t[2]==="0")}(),C3=Le,TD=xt,yD=Ya.set,A3=function(t,e){var n=1;return b3?function(i,r){var s=y3(arguments.length,1)>n,c=g3(i)?i:R3(i),l=s?T3(arguments,n):[],d=s?function(){E3(c,this,l)}:c;return t(d)}:t},RD=TD.setImmediate?A3(yD):yD;C3({global:!0,bind:!0,forced:TD.setImmediate!==RD},{setImmediate:RD});var bD=V(Ui.setImmediate),w3=xt,I3=hl,O3=vi,N3=Fr,D3=Kt;Le({global:!0,dontCallGetSet:!0,forced:B(function(){return D3&&Object.getOwnPropertyDescriptor(w3,"queueMicrotask").value.length!==1})},{queueMicrotask:function(t){N3(arguments.length,1),I3(O3(t))}});var CD=V(Ui.queueMicrotask);function AD(t,e){return function(){return t.apply(e,arguments)}}const{toString:P3}=Object.prototype,{getPrototypeOf:Q0}=Object,{iterator:by,toStringTag:wD}=Symbol,Cy=(J0=Object.create(null),t=>{const e=P3.call(t);return J0[e]||(J0[e]=e.slice(8,-1).toLowerCase())});var J0;const go=t=>(t=t.toLowerCase(),e=>Cy(e)===t),Ay=t=>e=>typeof e===t,{isArray:Qf}=Array,_g=Ay("undefined"),ID=go("ArrayBuffer"),k3=Ay("string"),Ra=Ay("function"),OD=Ay("number"),wy=t=>t!==null&&typeof t=="object",Iy=t=>{if(Cy(t)!=="object")return!1;const e=Q0(t);return!(e!==null&&e!==Object.prototype&&Object.getPrototypeOf(e)!==null||wD in t||by in t)},L3=go("Date"),x3=go("File"),M3=go("Blob"),U3=go("FileList"),V3=go("URLSearchParams"),[j3,B3,F3,G3]=["ReadableStream","Request","Response","Headers"].map(go);function Eg(t,e){let n,i,{allOwnKeys:r=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(t!=null)if(typeof t!="object"&&(t=[t]),Qf(t))for(n=0,i=t.length;n<i;n++)e.call(null,t[n],n,t);else{const s=r?Object.getOwnPropertyNames(t):Object.keys(t),c=s.length;let l;for(n=0;n<c;n++)l=s[n],e.call(null,t[l],l,t)}}function ND(t,e){e=e.toLowerCase();const n=Object.keys(t);let i,r=n.length;for(;r-- >0;)if(i=n[r],e===i.toLowerCase())return i;return null}const Ih=gD!==void 0?gD:typeof self<"u"?self:typeof window<"u"?window:KI,DD=t=>!_g(t)&&t!==Ih,H3=(Z0=typeof Uint8Array<"u"&&Q0(Uint8Array),t=>Z0&&t instanceof Z0);var Z0;const W3=go("HTMLFormElement"),PD=(t=>{let{hasOwnProperty:e}=t;return(n,i)=>e.call(n,i)})(Object.prototype),z3=go("RegExp"),kD=(t,e)=>{const n=Object.getOwnPropertyDescriptors(t),i={};Eg(n,(r,s)=>{let c;(c=e(r,s,t))!==!1&&(i[s]=c||r)}),Object.defineProperties(t,i)},q3=go("AsyncFunction"),LD=(xD=typeof bD=="function",MD=Ra(Ih.postMessage),xD?bD:MD?($0="axios@".concat(Math.random()),Oy=[],Ih.addEventListener("message",t=>{let{source:e,data:n}=t;e===Ih&&n===$0&&Oy.length&&Oy.shift()()},!1),t=>{Oy.push(t),Ih.postMessage($0,"*")}):t=>setTimeout(t));var xD,MD,$0,Oy;const K3=CD!==void 0?CD.bind(Ih):typeof process<"u"&&process.nextTick||LD;var yt={isArray:Qf,isArrayBuffer:ID,isBuffer:function(t){return t!==null&&!_g(t)&&t.constructor!==null&&!_g(t.constructor)&&Ra(t.constructor.isBuffer)&&t.constructor.isBuffer(t)},isFormData:t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||Ra(t.append)&&((e=Cy(t))==="formdata"||e==="object"&&Ra(t.toString)&&t.toString()==="[object FormData]"))},isArrayBufferView:function(t){let e;return e=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&ID(t.buffer),e},isString:k3,isNumber:OD,isBoolean:t=>t===!0||t===!1,isObject:wy,isPlainObject:Iy,isReadableStream:j3,isRequest:B3,isResponse:F3,isHeaders:G3,isUndefined:_g,isDate:L3,isFile:x3,isBlob:M3,isRegExp:z3,isFunction:Ra,isStream:t=>wy(t)&&Ra(t.pipe),isURLSearchParams:V3,isTypedArray:H3,isFileList:U3,forEach:Eg,merge:function t(){const{caseless:e}=DD(this)&&this||{},n={},i=(r,s)=>{const c=e&&ND(n,s)||s;Iy(n[c])&&Iy(r)?n[c]=t(n[c],r):Iy(r)?n[c]=t({},r):Qf(r)?n[c]=r.slice():n[c]=r};for(let r=0,s=arguments.length;r<s;r++)arguments[r]&&Eg(arguments[r],i);return n},extend:function(t,e,n){let{allOwnKeys:i}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return Eg(e,(r,s)=>{n&&Ra(r)?t[s]=AD(r,n):t[s]=r},{allOwnKeys:i}),t},trim:t=>dr(t)?dr(t).call(t):t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),inherits:(t,e,n,i)=>{t.prototype=Object.create(e.prototype,i),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),n&&Object.assign(t.prototype,n)},toFlatObject:(t,e,n,i)=>{let r,s,c;const l={};if(e=e||{},t==null)return e;do{for(r=Object.getOwnPropertyNames(t),s=r.length;s-- >0;)c=r[s],i&&!i(c,t,e)||l[c]||(e[c]=t[c],l[c]=!0);t=n!==!1&&Q0(t)}while(t&&(!n||n(t,e))&&t!==Object.prototype);return e},kindOf:Cy,kindOfTest:go,endsWith:(t,e,n)=>{t=String(t),(n===void 0||n>t.length)&&(n=t.length),n-=e.length;const i=t.indexOf(e,n);return i!==-1&&i===n},toArray:t=>{if(!t)return null;if(Qf(t))return t;let e=t.length;if(!OD(e))return null;const n=new Array(e);for(;e-- >0;)n[e]=t[e];return n},forEachEntry:(t,e)=>{const n=(t&&t[by]).call(t);let i;for(;(i=n.next())&&!i.done;){const r=i.value;e.call(t,r[0],r[1])}},matchAll:(t,e)=>{let n;const i=[];for(;(n=t.exec(e))!==null;)i.push(n);return i},isHTMLForm:W3,hasOwnProperty:PD,hasOwnProp:PD,reduceDescriptors:kD,freezeMethods:t=>{kD(t,(e,n)=>{if(Ra(t)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const i=t[n];Ra(i)&&(e.enumerable=!1,"writable"in e?e.writable=!1:e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))})},toObjectSet:(t,e)=>{const n={},i=r=>{r.forEach(s=>{n[s]=!0})};return Qf(t)?i(t):i(String(t).split(e)),n},toCamelCase:t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,n,i){return n.toUpperCase()+i}),noop:()=>{},toFiniteNumber:(t,e)=>t!=null&&Number.isFinite(t=+t)?t:e,findKey:ND,global:Ih,isContextDefined:DD,isSpecCompliantForm:function(t){return!!(t&&Ra(t.append)&&t[wD]==="FormData"&&t[by])},toJSONObject:t=>{const e=new Array(10),n=(i,r)=>{if(wy(i)){if(e.indexOf(i)>=0)return;if(!("toJSON"in i)){e[r]=i;const s=Qf(i)?[]:{};return Eg(i,(c,l)=>{const d=n(c,r+1);!_g(d)&&(s[l]=d)}),e[r]=void 0,s}}return i};return n(t,0)},isAsyncFn:q3,isThenable:t=>t&&(wy(t)||Ra(t))&&Ra(t.then)&&Ra(t.catch),setImmediate:LD,asap:K3,isIterable:t=>t!=null&&Ra(t[by])};function qe(t,e,n,i,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),n&&(this.config=n),i&&(this.request=i),r&&(this.response=r,this.status=r.status?r.status:null)}yt.inherits(qe,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:yt.toJSONObject(this.config),code:this.code,status:this.status}}});const UD=qe.prototype,VD={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{VD[t]={value:t}}),Object.defineProperties(qe,VD),Object.defineProperty(UD,"isAxiosError",{value:!0}),qe.from=(t,e,n,i,r,s)=>{const c=Object.create(UD);return yt.toFlatObject(t,c,function(l){return l!==Error.prototype},l=>l!=="isAxiosError"),qe.call(c,t.message,e,n,i,r),c.cause=t,c.name=t.name,s&&Object.assign(c,s),c};function tA(t){return yt.isPlainObject(t)||yt.isArray(t)}function jD(t){return yt.endsWith(t,"[]")?t.slice(0,-2):t}function BD(t,e,n){return t?t.concat(e).map(function(i,r){return i=jD(i),!n&&r?"["+i+"]":i}).join(n?".":""):e}const Y3=yt.toFlatObject(yt,{},null,function(t){return/^is[A-Z]/.test(t)});function Ny(t,e,n){if(!yt.isObject(t))throw new TypeError("target must be an object");e=e||new FormData;const i=(n=yt.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(_,E){return!yt.isUndefined(E[_])})).metaTokens,r=n.visitor||h,s=n.dots,c=n.indexes,l=(n.Blob||typeof Blob<"u"&&Blob)&&yt.isSpecCompliantForm(e);if(!yt.isFunction(r))throw new TypeError("visitor must be a function");function d(_){if(_===null)return"";if(yt.isDate(_))return _.toISOString();if(!l&&yt.isBlob(_))throw new qe("Blob is not supported. Use a Buffer instead.");return yt.isArrayBuffer(_)||yt.isTypedArray(_)?l&&typeof Blob=="function"?new Blob([_]):Buffer.from(_):_}function h(_,E,I){let C=_;if(_&&!I&&typeof _=="object"){if(yt.endsWith(E,"{}"))E=i?E:E.slice(0,-2),_=JSON.stringify(_);else if(yt.isArray(_)&&function(w){return yt.isArray(w)&&!w.some(tA)}(_)||(yt.isFileList(_)||yt.endsWith(E,"[]"))&&(C=yt.toArray(_)))return E=jD(E),C.forEach(function(w,D){!yt.isUndefined(w)&&w!==null&&e.append(c===!0?BD([E],D,s):c===null?E:E+"[]",d(w))}),!1}return!!tA(_)||(e.append(BD(I,E,s),d(_)),!1)}const p=[],m=Object.assign(Y3,{defaultVisitor:h,convertValue:d,isVisitable:tA});if(!yt.isObject(t))throw new TypeError("data must be an object");return function _(E,I){if(!yt.isUndefined(E)){if(p.indexOf(E)!==-1)throw Error("Circular reference detected in "+I.join("."));p.push(E),yt.forEach(E,function(C,w){(!(yt.isUndefined(C)||C===null)&&r.call(e,C,yt.isString(w)?dr(w).call(w):w,I,m))===!0&&_(C,I?I.concat(w):[w])}),p.pop()}}(t),e}function FD(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(n){return e[n]})}function eA(t,e){this._pairs=[],t&&Ny(t,this,e)}const GD=eA.prototype;function X3(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function HD(t,e,n){if(!e)return t;const i=n&&n.encode||X3;yt.isFunction(n)&&(n={serialize:n});const r=n&&n.serialize;let s;if(s=r?r(e,n):yt.isURLSearchParams(e)?e.toString():new eA(e,n).toString(i),s){const c=t.indexOf("#");c!==-1&&(t=t.slice(0,c)),t+=(t.indexOf("?")===-1?"?":"&")+s}return t}GD.append=function(t,e){this._pairs.push([t,e])},GD.toString=function(t){const e=t?function(n){return t.call(this,n,FD)}:FD;return this._pairs.map(function(n){return e(n[0])+"="+e(n[1])},"").join("&")};var WD=class{constructor(){this.handlers=[]}use(t,e,n){return this.handlers.push({fulfilled:t,rejected:e,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){yt.forEach(this.handlers,function(e){e!==null&&t(e)})}},zD={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},qD={exports:{}},Q3=Le,J3=Kt,KD=mr.f;Q3({target:"Object",stat:!0,forced:Object.defineProperty!==KD,sham:!J3},{defineProperty:KD});var YD=Ui.Object,Z3=qD.exports=function(t,e,n){return YD.defineProperty(t,e,n)};YD.defineProperty.sham&&(Z3.sham=!0);var XD=V(qD.exports),$3=TypeError,QD=ps,t4=Zu,e4=Ei,n4=Mn("species"),JD=Array,i4=function(t){var e;return QD(t)&&(e=t.constructor,(t4(e)&&(e===JD||QD(e.prototype))||e4(e)&&(e=e[n4])===null)&&(e=void 0)),e===void 0?JD:e},ZD=function(t,e){return new(i4(t))(e===0?0:e)},r4=B,a4=Rr,s4=Mn("species"),$D=function(t){return a4>=51||!r4(function(){var e=[];return(e.constructor={})[s4]=function(){return{foo:1}},e[t](Boolean).foo!==1})},o4=Le,c4=B,l4=ps,d4=Ei,u4=ja,h4=Fo,tP=function(t){if(t>9007199254740991)throw $3("Maximum allowed index exceeded");return t},eP=E0,p4=ZD,f4=$D,m4=Rr,nP=Mn("isConcatSpreadable"),_4=m4>=51||!c4(function(){var t=[];return t[nP]=!1,t.concat()[0]!==t}),E4=function(t){if(!d4(t))return!1;var e=t[nP];return e!==void 0?!!e:l4(t)};o4({target:"Array",proto:!0,forced:!_4||!f4("concat")},{concat:function(t){var e,n,i,r,s,c=u4(this),l=p4(c,0),d=0;for(e=-1,i=arguments.length;e<i;e++)if(E4(s=e===-1?c:arguments[e]))for(r=h4(s),tP(d+r),n=0;n<r;n++,d++)n in s&&eP(l,d,s[n]);else tP(d+1),eP(l,d++,s);return l.length=d,l}});var iP={},g4=ue,v4=Va,rP=ms.f,S4=Cr,aP=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];iP.f=function(t){return aP&&g4(t)==="Window"?function(e){try{return rP(e)}catch{return S4(aP)}}(t):rP(v4(t))};var Jf={},T4=Mn;Jf.f=T4;var sP=Ui,y4=ci,R4=Jf,b4=mr.f,Si=function(t){var e=sP.Symbol||(sP.Symbol={});y4(e,t)||b4(e,t,{value:R4.f(t)})},C4=kt,A4=Ut,w4=Mn,I4=Fi,oP=function(){var t=A4("Symbol"),e=t&&t.prototype,n=e&&e.valueOf,i=w4("toPrimitive");e&&!e[i]&&I4(e,i,function(r){return C4(n,this)},{})},O4=Ba,N4=xr,D4=ja,P4=Fo,k4=ZD,cP=Et([].push),L4=function(t){var e=t===1,n=t===2,i=t===3,r=t===4,s=t===6,c=t===7,l=t===5||s;return function(d,h,p,m){for(var _,E,I=D4(d),C=N4(I),w=P4(C),D=O4(h,p),N=0,L=m||k4,W=e?L(d,w):n||c?L(d,0):void 0;w>N;N++)if((l||N in C)&&(E=D(_=C[N],N,I),t))if(e)W[N]=E;else if(E)switch(t){case 3:return!0;case 5:return _;case 6:return N;case 2:cP(W,_)}else switch(t){case 4:return!1;case 7:cP(W,_)}return s?-1:i||r?r:W}},lP={forEach:L4(0)},Dy=Le,gg=xt,nA=kt,x4=Et,Zf=Kt,$f=hs,M4=B,Er=ci,U4=vt,iA=Zi,Py=Va,rA=Bo,V4=ji,aA=re,tm=el,dP=id,j4=ms,uP=iP,B4=Qc,hP=oe,pP=mr,F4=Jc,fP=te,mP=Fi,G4=Kn,sA=fa,_P=Bi,EP=jo,H4=Mn,W4=Jf,z4=Si,q4=oP,K4=za,gP=Wa,ky=lP.forEach,ba=Zn("hidden"),Ly="Symbol",vg="prototype",Y4=gP.set,vP=gP.getterFor(Ly),vo=Object[vg],Oh=gg.Symbol,xy=Oh&&Oh[vg],X4=gg.RangeError,Q4=gg.TypeError,oA=gg.QObject,SP=hP.f,Nh=pP.f,TP=uP.f,J4=fP.f,yP=x4([].push),Sl=sA("symbols"),Sg=sA("op-symbols"),Z4=sA("wks"),cA=!oA||!oA[vg]||!oA[vg].findChild,RP=function(t,e,n){var i=SP(vo,e);i&&delete vo[e],Nh(t,e,n),i&&t!==vo&&Nh(vo,e,i)},lA=Zf&&M4(function(){return tm(Nh({},"a",{get:function(){return Nh(this,"a",{value:7}).a}})).a!==7})?RP:Nh,dA=function(t,e){var n=Sl[t]=tm(xy);return Y4(n,{type:Ly,tag:t,description:e}),Zf||(n.description=e),n},My=function(t,e,n){t===vo&&My(Sg,e,n),iA(t);var i=rA(e);return iA(n),Er(Sl,i)?(n.enumerable?(Er(t,ba)&&t[ba][i]&&(t[ba][i]=!1),n=tm(n,{enumerable:aA(0,!1)})):(Er(t,ba)||Nh(t,ba,aA(1,tm(null))),t[ba][i]=!0),lA(t,i,n)):Nh(t,i,n)},uA=function(t,e){iA(t);var n=Py(e),i=dP(n).concat(wP(n));return ky(i,function(r){Zf&&!nA(bP,n,r)||My(t,r,n[r])}),t},bP=function(t){var e=rA(t),n=nA(J4,this,e);return!(this===vo&&Er(Sl,e)&&!Er(Sg,e))&&(!(n||!Er(this,e)||!Er(Sl,e)||Er(this,ba)&&this[ba][e])||n)},CP=function(t,e){var n=Py(t),i=rA(e);if(n!==vo||!Er(Sl,i)||Er(Sg,i)){var r=SP(n,i);return!r||!Er(Sl,i)||Er(n,ba)&&n[ba][i]||(r.enumerable=!0),r}},AP=function(t){var e=TP(Py(t)),n=[];return ky(e,function(i){Er(Sl,i)||Er(_P,i)||yP(n,i)}),n},wP=function(t){var e=t===vo,n=TP(e?Sg:Py(t)),i=[];return ky(n,function(r){!Er(Sl,r)||e&&!Er(vo,r)||yP(i,Sl[r])}),i};$f||(Oh=function(){if(U4(xy,this))throw new Q4("Symbol is not a constructor");var t=arguments.length&&arguments[0]!==void 0?V4(arguments[0]):void 0,e=EP(t),n=function(i){var r=this===void 0?gg:this;r===vo&&nA(n,Sg,i),Er(r,ba)&&Er(r[ba],e)&&(r[ba][e]=!1);var s=aA(1,i);try{lA(r,e,s)}catch(c){if(!(c instanceof X4))throw c;RP(r,e,s)}};return Zf&&cA&&lA(vo,e,{configurable:!0,set:n}),dA(e,t)},mP(xy=Oh[vg],"toString",function(){return vP(this).tag}),mP(Oh,"withoutSetter",function(t){return dA(EP(t),t)}),fP.f=bP,pP.f=My,F4.f=uA,hP.f=CP,j4.f=uP.f=AP,B4.f=wP,W4.f=function(t){return dA(H4(t),t)},Zf&&G4(xy,"description",{configurable:!0,get:function(){return vP(this).description}})),Dy({global:!0,wrap:!0,forced:!$f,sham:!$f},{Symbol:Oh}),ky(dP(Z4),function(t){z4(t)}),Dy({target:Ly,stat:!0,forced:!$f},{useSetter:function(){cA=!0},useSimple:function(){cA=!1}}),Dy({target:"Object",stat:!0,forced:!$f,sham:!Zf},{create:function(t,e){return e===void 0?tm(t):uA(tm(t),e)},defineProperty:My,defineProperties:uA,getOwnPropertyDescriptor:CP}),Dy({target:"Object",stat:!0,forced:!$f},{getOwnPropertyNames:AP}),q4(),K4(Oh,Ly),_P[ba]=!0;var IP=hs&&!!Symbol.for&&!!Symbol.keyFor,$4=Le,t5=Ut,e5=ci,n5=ji,OP=fa,i5=IP,hA=OP("string-to-symbol-registry"),r5=OP("symbol-to-string-registry");$4({target:"Symbol",stat:!0,forced:!i5},{for:function(t){var e=n5(t);if(e5(hA,e))return hA[e];var n=t5("Symbol")(e);return hA[e]=n,r5[n]=e,n}});var a5=Le,s5=ci,o5=Ul,c5=Vo,l5=IP,NP=fa("symbol-to-string-registry");a5({target:"Symbol",stat:!0,forced:!l5},{keyFor:function(t){if(!o5(t))throw new TypeError(c5(t)+" is not a symbol");if(s5(NP,t))return NP[t]}});var DP=ps,d5=qt,PP=ue,u5=ji,kP=Et([].push),h5=Le,LP=Ut,xP=Be,p5=kt,Tg=Et,MP=B,UP=qt,VP=Ul,jP=Cr,f5=function(t){if(d5(t))return t;if(DP(t)){for(var e=t.length,n=[],i=0;i<e;i++){var r=t[i];typeof r=="string"?kP(n,r):typeof r!="number"&&PP(r)!=="Number"&&PP(r)!=="String"||kP(n,u5(r))}var s=n.length,c=!0;return function(l,d){if(c)return c=!1,d;if(DP(this))return d;for(var h=0;h<s;h++)if(n[h]===l)return d}}},m5=hs,_5=String,Bd=LP("JSON","stringify"),Uy=Tg(/./.exec),BP=Tg("".charAt),E5=Tg("".charCodeAt),g5=Tg("".replace),v5=Tg(1 .toString),S5=/[\uD800-\uDFFF]/g,FP=/^[\uD800-\uDBFF]$/,GP=/^[\uDC00-\uDFFF]$/,HP=!m5||MP(function(){var t=LP("Symbol")("stringify detection");return Bd([t])!=="[null]"||Bd({a:t})!=="{}"||Bd(Object(t))!=="{}"}),WP=MP(function(){return Bd("\uDF06\uD834")!=='"\\udf06\\ud834"'||Bd("\uDEAD")!=='"\\udead"'}),T5=function(t,e){var n=jP(arguments),i=f5(e);if(UP(i)||t!==void 0&&!VP(t))return n[1]=function(r,s){if(UP(i)&&(s=p5(i,this,_5(r),s)),!VP(s))return s},xP(Bd,null,n)},y5=function(t,e,n){var i=BP(n,e-1),r=BP(n,e+1);return Uy(FP,t)&&!Uy(GP,r)||Uy(GP,t)&&!Uy(FP,i)?"\\u"+v5(E5(t,0),16):t};Bd&&h5({target:"JSON",stat:!0,forced:HP||WP},{stringify:function(t,e,n){var i=jP(arguments),r=xP(HP?T5:Bd,null,i);return WP&&typeof r=="string"?g5(r,S5,y5):r}});var zP=Qc,R5=ja;Le({target:"Object",stat:!0,forced:!hs||B(function(){zP.f(1)})},{getOwnPropertySymbols:function(t){var e=zP.f;return e?e(R5(t)):[]}}),Si("asyncIterator"),Si("hasInstance"),Si("isConcatSpreadable"),Si("iterator"),Si("match"),Si("matchAll"),Si("replace"),Si("search"),Si("species"),Si("split");var b5=oP;Si("toPrimitive"),b5();var C5=Ut,A5=za;Si("toStringTag"),A5(C5("Symbol"),"Symbol"),Si("unscopables"),za(xt.JSON,"JSON",!0);var w5=Ui.Symbol,I5=Mn,O5=mr.f,qP=I5("metadata"),KP=Function.prototype;KP[qP]===void 0&&O5(KP,qP,{value:null}),Si("asyncDispose"),Si("dispose"),Si("metadata");var N5=w5,D5=Et,pA=Ut("Symbol"),P5=pA.keyFor,k5=D5(pA.prototype.valueOf),YP=pA.isRegisteredSymbol||function(t){try{return P5(k5(t))!==void 0}catch{return!1}};Le({target:"Symbol",stat:!0},{isRegisteredSymbol:YP});for(var L5=fa,XP=Ut,x5=Et,M5=Ul,U5=Mn,Vy=XP("Symbol"),QP=Vy.isWellKnownSymbol,JP=XP("Object","getOwnPropertyNames"),V5=x5(Vy.prototype.valueOf),ZP=L5("wks"),fA=0,$P=JP(Vy),j5=$P.length;fA<j5;fA++)try{var tk=$P[fA];M5(Vy[tk])&&U5(tk)}catch{}var ek=function(t){if(QP&&QP(t))return!0;try{for(var e=V5(t),n=0,i=JP(ZP),r=i.length;n<r;n++)if(ZP[i[n]]==e)return!0}catch{}return!1};Le({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:ek}),Si("customMatcher"),Si("observable"),Le({target:"Symbol",stat:!0},{isRegistered:YP}),Le({target:"Symbol",stat:!0,forced:!0},{isWellKnown:ek}),Si("matcher"),Si("metadataKey"),Si("patternMatch"),Si("replaceAll");var em=V(N5),nk=V(Jf.f("iterator"));function yg(t){return yg=typeof em=="function"&&typeof nk=="symbol"?function(e){return typeof e}:function(e){return e&&typeof em=="function"&&e.constructor===em&&e!==em.prototype?"symbol":typeof e},yg(t)}var B5=V(Jf.f("toPrimitive"));function F5(t){var e=function(n,i){if(yg(n)!="object"||!n)return n;var r=n[B5];if(r!==void 0){var s=r.call(n,i);if(yg(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(n)}(t,"string");return yg(e)=="symbol"?e:e+""}function O(t,e,n){return(e=F5(e))in t?XD(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var ik=V(FB),G5={isBrowser:!0,classes:{URLSearchParams:ik!==void 0?ik:eA,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const mA=typeof window<"u"&&typeof document<"u",_A=typeof navigator=="object"&&navigator||void 0,H5=mA&&(!_A||["ReactNative","NativeScript","NS"].indexOf(_A.product)<0),W5=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",z5=mA&&window.location.href||"http://localhost";function rk(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function ak(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?rk(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):rk(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}var Hr=ak(ak({},Object.freeze({__proto__:null,hasBrowserEnv:mA,hasStandardBrowserEnv:H5,hasStandardBrowserWebWorkerEnv:W5,navigator:_A,origin:z5})),G5),q5=Zi,K5=kt,Y5=ci,X5=vt,Q5=function(){var t=q5(this),e="";return t.hasIndices&&(e+="d"),t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.dotAll&&(e+="s"),t.unicode&&(e+="u"),t.unicodeSets&&(e+="v"),t.sticky&&(e+="y"),e},sk=RegExp.prototype,ok=function(t){var e=t.flags;return e!==void 0||"flags"in sk||Y5(t,"flags")||!X5(sk,t)?e:K5(Q5,t)},J5=mh.charAt,ck=kt,Z5=Zi,$5=qt,t6=ue,e6=/./.exec,n6=TypeError,i6=Le,lk=kt,dk=si,r6=tf,jy=md,uk=ha,hk=Fc,Rg=ji,a6=Zi,s6=Ei,o6=ue,c6=E_,pk=ok,l6=$s,d6=B,u6=lf,h6=function(t,e,n){return e+(n?J5(t,e).length:1)},p6=function(t,e){var n=t.exec;if($5(n)){var i=ck(n,t,e);return i!==null&&Z5(i),i}if(t6(t)==="RegExp")return ck(e6,t,e);throw new n6("RegExp#exec called on incompatible receiver")},fk=Wa,f6=Mn("matchAll"),mk="RegExp String",_k=mk+" Iterator",m6=fk.set,_6=fk.getterFor(_k),E6=TypeError,EA=dk("".indexOf),By=dk("".matchAll),gA=!!By&&!d6(function(){By("a",/./)}),g6=r6(function(t,e,n,i){m6(this,{type:_k,regexp:t,string:e,global:n,unicode:i,done:!1})},mk,function(){var t=_6(this);if(t.done)return jy(void 0,!0);var e=t.regexp,n=t.string,i=p6(e,n);return i===null?(t.done=!0,jy(void 0,!0)):t.global?(Rg(i[0])===""&&(e.lastIndex=h6(n,hk(e.lastIndex),t.unicode)),jy(i,!1)):(t.done=!0,jy(i,!1))}),Ek=function(t){var e,n,i,r=a6(this),s=Rg(t),c=u6(r,RegExp),l=Rg(pk(r));return e=new c(c===RegExp?r.source:r,l),n=!!~EA(l,"g"),i=!!~EA(l,"u"),e.lastIndex=hk(r.lastIndex),new g6(e,s,n,i)};i6({target:"String",proto:!0,forced:gA},{matchAll:function(t){var e,n,i,r,s=uk(this);if(s6(t)){if(c6(t)&&(e=Rg(uk(pk(t))),!~EA(e,"g")))throw new E6("`.matchAll` does not allow non-global regexes");if(gA)return By(s,t);if((i=l6(t,f6))===void 0&&o6(t)==="RegExp"&&(i=Ek),i)return lk(i,t,s)}else if(gA)return By(s,t);return n=Rg(s),r=new RegExp(t,"g"),lk(Ek,r,n)}});var v6=$r("String","matchAll"),S6=vt,T6=v6,vA=String.prototype,y6=function(t){var e=t.matchAll;return typeof t=="string"||t===vA||S6(vA,t)&&e===vA.matchAll?T6:e},R6=V(y6);function gk(t){function e(n,i,r,s){let c=n[s++];if(c==="__proto__")return!0;const l=Number.isFinite(+c),d=s>=n.length;return c=!c&&yt.isArray(r)?r.length:c,d?(yt.hasOwnProp(r,c)?r[c]=[r[c],i]:r[c]=i,!l):(r[c]&&yt.isObject(r[c])||(r[c]=[]),e(n,i,r[c],s)&&yt.isArray(r[c])&&(r[c]=function(h){const p={},m=Object.keys(h);let _;const E=m.length;let I;for(_=0;_<E;_++)I=m[_],p[I]=h[I];return p}(r[c])),!l)}if(yt.isFormData(t)&&yt.isFunction(t.entries)){const n={};return yt.forEachEntry(t,(i,r)=>{e(function(s){return R6(yt).call(yt,/\w+|\[(\w*)]/g,s).map(c=>c[0]==="[]"?"":c[1]||c[0])}(i),r,n,0)}),n}return null}const SA={transitional:zD,adapter:["xhr","http","fetch"],transformRequest:[function(t,e){const n=e.getContentType()||"",i=n.indexOf("application/json")>-1,r=yt.isObject(t);if(r&&yt.isHTMLForm(t)&&(t=new FormData(t)),yt.isFormData(t))return i?JSON.stringify(gk(t)):t;if(yt.isArrayBuffer(t)||yt.isBuffer(t)||yt.isStream(t)||yt.isFile(t)||yt.isBlob(t)||yt.isReadableStream(t))return t;if(yt.isArrayBufferView(t))return t.buffer;if(yt.isURLSearchParams(t))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let s;if(r){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(c,l){return Ny(c,new Hr.classes.URLSearchParams,Object.assign({visitor:function(d,h,p,m){return Hr.isNode&&yt.isBuffer(d)?(this.append(h,d.toString("base64")),!1):m.defaultVisitor.apply(this,arguments)}},l))}(t,this.formSerializer).toString();if((s=yt.isFileList(t))||n.indexOf("multipart/form-data")>-1){const c=this.env&&this.env.FormData;return Ny(s?{"files[]":t}:t,c&&new c,this.formSerializer)}}return r||i?(e.setContentType("application/json",!1),function(c,l,d){if(yt.isString(c))try{return(l||JSON.parse)(c),dr(yt).call(yt,c)}catch(h){if(h.name!=="SyntaxError")throw h}return(d||JSON.stringify)(c)}(t)):t}],transformResponse:[function(t){const e=this.transitional||SA.transitional,n=e&&e.forcedJSONParsing,i=this.responseType==="json";if(yt.isResponse(t)||yt.isReadableStream(t))return t;if(t&&yt.isString(t)&&(n&&!this.responseType||i)){const r=!(e&&e.silentJSONParsing)&&i;try{return JSON.parse(t)}catch(s){if(r)throw s.name==="SyntaxError"?qe.from(s,qe.ERR_BAD_RESPONSE,this,null,this.response):s}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Hr.classes.FormData,Blob:Hr.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};yt.forEach(["delete","get","head","post","put","patch"],t=>{SA.headers[t]={}});var TA=SA;const b6=yt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),vk=Symbol("internals");function bg(t){var e;return t&&dr(e=String(t)).call(e).toLowerCase()}function Fy(t){return t===!1||t==null?t:yt.isArray(t)?t.map(Fy):String(t)}function yA(t,e,n,i,r){return yt.isFunction(i)?i.call(this,e,n):(r&&(e=n),yt.isString(e)?yt.isString(i)?e.indexOf(i)!==-1:yt.isRegExp(i)?i.test(e):void 0:void 0)}class Gy{constructor(e){e&&this.set(e)}set(e,n,i){const r=this;function s(d,h,p){const m=bg(h);if(!m)throw new Error("header name must be a non-empty string");const _=yt.findKey(r,m);(!_||r[_]===void 0||p===!0||p===void 0&&r[_]!==!1)&&(r[_||h]=Fy(d))}const c=(d,h)=>yt.forEach(d,(p,m)=>s(p,m,h));if(yt.isPlainObject(e)||e instanceof this.constructor)c(e,n);else if(yt.isString(e)&&(e=dr(e).call(e))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(dr(l=e).call(l)))c((d=>{const h={};let p,m,_;return d&&d.split(`
`).forEach(function(E){var I,C;_=E.indexOf(":"),p=dr(I=E.substring(0,_)).call(I).toLowerCase(),m=dr(C=E.substring(_+1)).call(C),!p||h[p]&&b6[p]||(p==="set-cookie"?h[p]?h[p].push(m):h[p]=[m]:h[p]=h[p]?h[p]+", "+m:m)}),h})(e),n);else if(yt.isObject(e)&&yt.isIterable(e)){let d,h,p={};for(const m of e){if(!yt.isArray(m))throw TypeError("Object iterator must return a key-value pair");p[h=m[0]]=(d=p[h])?yt.isArray(d)?[...d,m[1]]:[d,m[1]]:m[1]}c(p,n)}else e!=null&&s(n,e,i);var l;return this}get(e,n){if(e=bg(e)){const i=yt.findKey(this,e);if(i){const r=this[i];if(!n)return r;if(n===!0)return function(s){const c=Object.create(null),l=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let d;for(;d=l.exec(s);)c[d[1]]=d[2];return c}(r);if(yt.isFunction(n))return n.call(this,r,i);if(yt.isRegExp(n))return n.exec(r);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,n){if(e=bg(e)){const i=yt.findKey(this,e);return!(!i||this[i]===void 0||n&&!yA(0,this[i],i,n))}return!1}delete(e,n){const i=this;let r=!1;function s(c){if(c=bg(c)){const l=yt.findKey(i,c);!l||n&&!yA(0,i[l],l,n)||(delete i[l],r=!0)}}return yt.isArray(e)?e.forEach(s):s(e),r}clear(e){const n=Object.keys(this);let i=n.length,r=!1;for(;i--;){const s=n[i];e&&!yA(0,this[s],s,e,!0)||(delete this[s],r=!0)}return r}normalize(e){const n=this,i={};return yt.forEach(this,(r,s)=>{var c;const l=yt.findKey(i,s);if(l)return n[l]=Fy(r),void delete n[s];const d=e?function(h){return dr(h).call(h).toLowerCase().replace(/([a-z\d])(\w*)/g,(p,m,_)=>m.toUpperCase()+_)}(s):dr(c=String(s)).call(c);d!==s&&delete n[s],n[d]=Fy(r),i[d]=!0}),this}concat(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return this.constructor.concat(this,...n)}toJSON(e){const n=Object.create(null);return yt.forEach(this,(i,r)=>{i!=null&&i!==!1&&(n[r]=e&&yt.isArray(i)?i.join(", "):i)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(e=>{let[n,i]=e;return n+": "+i}).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e){const n=new this(e);for(var i=arguments.length,r=new Array(i>1?i-1:0),s=1;s<i;s++)r[s-1]=arguments[s];return r.forEach(c=>n.set(c)),n}static accessor(e){const n=(this[vk]=this[vk]={accessors:{}}).accessors,i=this.prototype;function r(s){const c=bg(s);n[c]||(function(l,d){const h=yt.toCamelCase(" "+d);["get","set","has"].forEach(p=>{Object.defineProperty(l,p+h,{value:function(m,_,E){return this[p].call(this,d,m,_,E)},configurable:!0})})}(i,s),n[c]=!0)}return yt.isArray(e)?e.forEach(r):r(e),this}}Gy.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),yt.reduceDescriptors(Gy.prototype,(t,e)=>{let{value:n}=t,i=e[0].toUpperCase()+e.slice(1);return{get:()=>n,set(r){this[i]=r}}}),yt.freezeMethods(Gy);var So=Gy;function RA(t,e){const n=this||TA,i=e||n,r=So.from(i.headers);let s=i.data;return yt.forEach(t,function(c){s=c.call(n,s,r.normalize(),e?e.status:void 0)}),r.normalize(),s}function Sk(t){return!(!t||!t.__CANCEL__)}function nm(t,e,n){qe.call(this,t??"canceled",qe.ERR_CANCELED,e,n),this.name="CanceledError"}function Tk(t,e,n){const i=n.config.validateStatus;n.status&&i&&!i(n.status)?e(new qe("Request failed with status code "+n.status,[qe.ERR_BAD_REQUEST,qe.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):t(n)}yt.inherits(nm,qe,{__CANCEL__:!0});const Hy=function(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,i=0;const r=function(s,c){s=s||10;const l=new Array(s),d=new Array(s);let h,p=0,m=0;return c=c!==void 0?c:1e3,function(_){const E=Date.now(),I=d[m];h||(h=E),l[p]=_,d[p]=E;let C=m,w=0;for(;C!==p;)w+=l[C++],C%=s;if(p=(p+1)%s,p===m&&(m=(m+1)%s),E-h<c)return;const D=I&&E-I;return D?Math.round(1e3*w/D):void 0}}(50,250);return function(s,c){let l,d,h=0,p=1e3/c;const m=function(_){h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),l=null,d&&(clearTimeout(d),d=null),s.apply(null,_)};return[function(){const _=Date.now(),E=_-h;for(var I=arguments.length,C=new Array(I),w=0;w<I;w++)C[w]=arguments[w];E>=p?m(C,_):(l=C,d||(d=setTimeout(()=>{d=null,m(l)},p-E)))},()=>l&&m(l)]}(s=>{const c=s.loaded,l=s.lengthComputable?s.total:void 0,d=c-i,h=r(d);i=c,t({loaded:c,total:l,progress:l?c/l:void 0,bytes:d,rate:h||void 0,estimated:h&&l&&c<=l?(l-c)/h:void 0,event:s,lengthComputable:l!=null,[e?"download":"upload"]:!0})},n)},yk=(t,e)=>{const n=t!=null;return[i=>e[0]({lengthComputable:n,total:t,loaded:i}),e[1]]},Rk=t=>function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return yt.asap(()=>t(...n))};var C6=Hr.hasStandardBrowserEnv?((t,e)=>n=>(n=new Ey(n,Hr.origin),t.protocol===n.protocol&&t.host===n.host&&(e||t.port===n.port)))(new Ey(Hr.origin),Hr.navigator&&/(msie|trident)/i.test(Hr.navigator.userAgent)):()=>!0,A6=Hr.hasStandardBrowserEnv?{write(t,e,n,i,r,s){const c=[t+"="+encodeURIComponent(e)];yt.isNumber(n)&&c.push("expires="+new Date(n).toGMTString()),yt.isString(i)&&c.push("path="+i),yt.isString(r)&&c.push("domain="+r),s===!0&&c.push("secure"),document.cookie=c.join("; ")},read(t){const e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function bk(t,e,n){let i=!function(r){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(r)}(e);return t&&(i||n==0)?function(r,s){return s?r.replace(/\/?\/$/,"")+"/"+s.replace(/^\/+/,""):r}(t,e):e}function Ck(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}const Ak=t=>t instanceof So?function(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?Ck(Object(i),!0).forEach(function(r){O(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Ck(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}({},t):t;function Dh(t,e){e=e||{};const n={};function i(h,p,m,_){return yt.isPlainObject(h)&&yt.isPlainObject(p)?yt.merge.call({caseless:_},h,p):yt.isPlainObject(p)?yt.merge({},p):yt.isArray(p)?p.slice():p}function r(h,p,m,_){return yt.isUndefined(p)?yt.isUndefined(h)?void 0:i(void 0,h,0,_):i(h,p,0,_)}function s(h,p){if(!yt.isUndefined(p))return i(void 0,p)}function c(h,p){return yt.isUndefined(p)?yt.isUndefined(h)?void 0:i(void 0,h):i(void 0,p)}function l(h,p,m){return m in e?i(h,p):m in t?i(void 0,h):void 0}const d={url:s,method:s,data:s,baseURL:c,transformRequest:c,transformResponse:c,paramsSerializer:c,timeout:c,timeoutMessage:c,withCredentials:c,withXSRFToken:c,adapter:c,responseType:c,xsrfCookieName:c,xsrfHeaderName:c,onUploadProgress:c,onDownloadProgress:c,decompress:c,maxContentLength:c,maxBodyLength:c,beforeRedirect:c,transport:c,httpAgent:c,httpsAgent:c,cancelToken:c,socketPath:c,responseEncoding:c,validateStatus:l,headers:(h,p,m)=>r(Ak(h),Ak(p),0,!0)};return yt.forEach(Object.keys(Object.assign({},t,e)),function(h){const p=d[h]||r,m=p(t[h],e[h],h);yt.isUndefined(m)&&p!==l||(n[h]=m)}),n}var wk=t=>{const e=Dh({},t);let n,{data:i,withXSRFToken:r,xsrfHeaderName:s,xsrfCookieName:c,headers:l,auth:d}=e;if(e.headers=l=So.from(l),e.url=HD(bk(e.baseURL,e.url,e.allowAbsoluteUrls),t.params,t.paramsSerializer),d&&l.set("Authorization","Basic "+btoa((d.username||"")+":"+(d.password?unescape(encodeURIComponent(d.password)):""))),yt.isFormData(i)){if(Hr.hasStandardBrowserEnv||Hr.hasStandardBrowserWebWorkerEnv)l.setContentType(void 0);else if((n=l.getContentType())!==!1){const[h,...p]=n?n.split(";").map(m=>dr(m).call(m)).filter(Boolean):[];l.setContentType([h||"multipart/form-data",...p].join("; "))}}if(Hr.hasStandardBrowserEnv&&(r&&yt.isFunction(r)&&(r=r(e)),r||r!==!1&&C6(e.url))){const h=s&&c&&A6.read(c);h&&l.set(s,h)}return e},w6=typeof XMLHttpRequest<"u"&&function(t){return new Tt(function(e,n){const i=wk(t);let r=i.data;const s=So.from(i.headers).normalize();let c,l,d,h,p,{responseType:m,onUploadProgress:_,onDownloadProgress:E}=i;function I(){h&&h(),p&&p(),i.cancelToken&&i.cancelToken.unsubscribe(c),i.signal&&i.signal.removeEventListener("abort",c)}let C=new XMLHttpRequest;function w(){if(!C)return;const N=So.from("getAllResponseHeaders"in C&&C.getAllResponseHeaders());Tk(function(L){e(L),I()},function(L){n(L),I()},{data:m&&m!=="text"&&m!=="json"?C.response:C.responseText,status:C.status,statusText:C.statusText,headers:N,config:t,request:C}),C=null}C.open(i.method.toUpperCase(),i.url,!0),C.timeout=i.timeout,"onloadend"in C?C.onloadend=w:C.onreadystatechange=function(){C&&C.readyState===4&&(C.status!==0||C.responseURL&&C.responseURL.indexOf("file:")===0)&&setTimeout(w)},C.onabort=function(){C&&(n(new qe("Request aborted",qe.ECONNABORTED,t,C)),C=null)},C.onerror=function(){n(new qe("Network Error",qe.ERR_NETWORK,t,C)),C=null},C.ontimeout=function(){let N=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const L=i.transitional||zD;i.timeoutErrorMessage&&(N=i.timeoutErrorMessage),n(new qe(N,L.clarifyTimeoutError?qe.ETIMEDOUT:qe.ECONNABORTED,t,C)),C=null},r===void 0&&s.setContentType(null),"setRequestHeader"in C&&yt.forEach(s.toJSON(),function(N,L){C.setRequestHeader(L,N)}),yt.isUndefined(i.withCredentials)||(C.withCredentials=!!i.withCredentials),m&&m!=="json"&&(C.responseType=i.responseType),E&&([d,p]=Hy(E,!0),C.addEventListener("progress",d)),_&&C.upload&&([l,h]=Hy(_),C.upload.addEventListener("progress",l),C.upload.addEventListener("loadend",h)),(i.cancelToken||i.signal)&&(c=N=>{C&&(n(!N||N.type?new nm(null,t,C):N),C.abort(),C=null)},i.cancelToken&&i.cancelToken.subscribe(c),i.signal&&(i.signal.aborted?c():i.signal.addEventListener("abort",c)));const D=function(N){const L=/^([-+\w]{1,25})(:?\/\/|:)/.exec(N);return L&&L[1]||""}(i.url);D&&Hr.protocols.indexOf(D)===-1?n(new qe("Unsupported protocol "+D+":",qe.ERR_BAD_REQUEST,t)):C.send(r||null)})},I6=(t,e)=>{const{length:n}=t=t?t.filter(Boolean):[];if(e||n){let i,r=new AbortController;const s=function(h){if(!i){i=!0,l();const p=h instanceof Error?h:this.reason;r.abort(p instanceof qe?p:new nm(p instanceof Error?p.message:p))}};let c=e&&setTimeout(()=>{c=null,s(new qe("timeout ".concat(e," of ms exceeded"),qe.ETIMEDOUT))},e);const l=()=>{t&&(c&&clearTimeout(c),c=null,t.forEach(h=>{h.unsubscribe?h.unsubscribe(s):h.removeEventListener("abort",s)}),t=null)};t.forEach(h=>h.addEventListener("abort",s));const{signal:d}=r;return d.unsubscribe=()=>yt.asap(l),d}},bA=V(gh),Ik=Jf.f("asyncIterator"),O6=V(Ik);function CA(t,e){this.v=t,this.k=e}function Za(t){return function(){return new Cg(t.apply(this,arguments))}}function Cg(t){var e,n;function i(s,c){try{var l=t[s](c),d=l.value,h=d instanceof CA;bA.resolve(h?d.v:d).then(function(p){if(h){var m=s==="return"?"return":"next";if(!d.k||p.done)return i(m,p);p=t[m](p).value}r(l.done?"return":"normal",p)},function(p){i("throw",p)})}catch(p){r("throw",p)}}function r(s,c){switch(s){case"return":e.resolve({value:c,done:!0});break;case"throw":e.reject(c);break;default:e.resolve({value:c,done:!1})}(e=e.next)?i(e.key,e.arg):n=null}this._invoke=function(s,c){return new bA(function(l,d){var h={key:s,arg:c,resolve:l,reject:d,next:null};n?n=n.next=h:(e=n=h,i(s,c))})},typeof t.return!="function"&&(this.return=void 0)}function Re(t){return new CA(t,0)}function Wy(t){var e={},n=!1;function i(r,s){return n=!0,s=new bA(function(c){c(t[r](s))}),{done:!1,value:new CA(s,1)}}return e[em!==void 0&&nk||"@@iterator"]=function(){return this},e.next=function(r){return n?(n=!1,r):i("next",r)},typeof t.throw=="function"&&(e.throw=function(r){if(n)throw n=!1,r;return i("throw",r)}),typeof t.return=="function"&&(e.return=function(r){return n?(n=!1,r):i("return",r)}),e}Cg.prototype[typeof em=="function"&&O6||"@@asyncIterator"]=function(){return this},Cg.prototype.next=function(t){return this._invoke("next",t)},Cg.prototype.throw=function(t){return this._invoke("throw",t)},Cg.prototype.return=function(t){return this._invoke("return",t)};var AA=V(Ik);function wA(t){var e,n,i,r=2;for(typeof Symbol<"u"&&(n=AA,i=Symbol.iterator);r--;){if(n&&(e=t[n])!=null)return e.call(t);if(i&&(e=t[i])!=null)return new zy(e.call(t));n="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function zy(t){function e(n){if(Object(n)!==n)return Tt.reject(new TypeError(n+" is not an object."));var i=n.done;return Tt.resolve(n.value).then(function(r){return{value:r,done:i}})}return zy=function(n){this.s=n,this.n=n.next},zy.prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(n){var i=this.s.return;return i===void 0?Tt.resolve({value:n,done:!0}):e(i.apply(this.s,arguments))},throw:function(n){var i=this.s.return;return i===void 0?Tt.reject(n):e(i.apply(this.s,arguments))}},new zy(t)}const N6=function*(t,e){let n=t.byteLength;if(!e||n<e)return void(yield t);let i,r=0;for(;r<n;)i=r+e,yield t.slice(r,i),r=i},D6=function(){var t=Za(function*(e,n){var i,r=!1,s=!1;try{for(var c,l=wA(P6(e));r=!(c=yield Re(l.next())).done;r=!1){const d=c.value;yield*Wy(wA(N6(d,n)))}}catch(d){s=!0,i=d}finally{try{r&&l.return!=null&&(yield Re(l.return()))}finally{if(s)throw i}}});return function(e,n){return t.apply(this,arguments)}}(),P6=function(){var t=Za(function*(e){if(e[AA])return void(yield*Wy(wA(e)));const n=e.getReader();try{for(;;){const{done:i,value:r}=yield Re(n.read());if(i)break;yield r}}finally{yield Re(n.cancel())}});return function(e){return t.apply(this,arguments)}}(),Ok=(t,e,n,i)=>{const r=D6(t,e);let s,c=0,l=d=>{s||(s=!0,i&&i(d))};return new ReadableStream({async pull(d){try{const{done:h,value:p}=await r.next();if(h)return l(),void d.close();let m=p.byteLength;if(n){let _=c+=m;n(_)}d.enqueue(new Uint8Array(p))}catch(h){throw l(h),h}},cancel:d=>(l(d),r.return())},{highWaterMark:2})};function Nk(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Dk(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Nk(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Nk(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const qy=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",Pk=qy&&typeof ReadableStream=="function",k6=qy&&(typeof TextEncoder=="function"?(kk=new TextEncoder,t=>kk.encode(t)):async t=>new Uint8Array(await new Response(t).arrayBuffer()));var kk;const Lk=function(t){try{for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return!!t(...n)}catch{return!1}},L6=Pk&&Lk(()=>{let t=!1;const e=new Request(Hr.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!e}),IA=Pk&&Lk(()=>yt.isReadableStream(new Response("").body)),Ky={stream:IA&&(t=>t.body)};var xk;qy&&(xk=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(t=>{!Ky[t]&&(Ky[t]=yt.isFunction(xk[t])?e=>e[t]():(e,n)=>{throw new qe("Response type '".concat(t,"' is not supported"),qe.ERR_NOT_SUPPORT,n)})}));const x6=async(t,e)=>{const n=yt.toFiniteNumber(t.getContentLength());return n??(async i=>i==null?0:yt.isBlob(i)?i.size:yt.isSpecCompliantForm(i)?(await new Request(Hr.origin,{method:"POST",body:i}).arrayBuffer()).byteLength:yt.isArrayBufferView(i)||yt.isArrayBuffer(i)?i.byteLength:(yt.isURLSearchParams(i)&&(i+=""),yt.isString(i)?(await k6(i)).byteLength:void 0))(e)};var M6=qy&&(async t=>{let{url:e,method:n,data:i,signal:r,cancelToken:s,timeout:c,onDownloadProgress:l,onUploadProgress:d,responseType:h,headers:p,withCredentials:m="same-origin",fetchOptions:_}=wk(t);h=h?(h+"").toLowerCase():"text";let E,I=I6([r,s&&s.toAbortSignal()],c);const C=I&&I.unsubscribe&&(()=>{I.unsubscribe()});let w;try{if(d&&L6&&n!=="get"&&n!=="head"&&(w=await x6(p,i))!==0){let G,U=new Request(e,{method:"POST",body:i,duplex:"half"});if(yt.isFormData(i)&&(G=U.headers.get("content-type"))&&p.setContentType(G),U.body){const[z,$]=yk(w,Hy(Rk(d)));i=Ok(U.body,65536,z,$)}}yt.isString(m)||(m=m?"include":"omit");const D="credentials"in Request.prototype;E=new Request(e,Dk(Dk({},_),{},{signal:I,method:n.toUpperCase(),headers:p.normalize().toJSON(),body:i,duplex:"half",credentials:D?m:void 0}));let N=await fetch(E);const L=IA&&(h==="stream"||h==="response");if(IA&&(l||L&&C)){const G={};["status","statusText","headers"].forEach(rt=>{G[rt]=N[rt]});const U=yt.toFiniteNumber(N.headers.get("content-length")),[z,$]=l&&yk(U,Hy(Rk(l),!0))||[];N=new Response(Ok(N.body,65536,z,()=>{$&&$(),C&&C()}),G)}h=h||"text";let W=await Ky[yt.findKey(Ky,h)||"text"](N,t);return!L&&C&&C(),await new Tt((G,U)=>{Tk(G,U,{data:W,headers:So.from(N.headers),status:N.status,statusText:N.statusText,config:t,request:E})})}catch(D){throw C&&C(),D&&D.name==="TypeError"&&/Load failed|fetch/i.test(D.message)?Object.assign(new qe("Network Error",qe.ERR_NETWORK,t,E),{cause:D.cause||D}):qe.from(D,D&&D.code,t,E)}});const OA={http:null,xhr:w6,fetch:M6};yt.forEach(OA,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const Mk=t=>"- ".concat(t),U6=t=>yt.isFunction(t)||t===null||t===!1;var Uk={getAdapter:t=>{t=yt.isArray(t)?t:[t];const{length:e}=t;let n,i;const r={};for(let s=0;s<e;s++){let c;if(n=t[s],i=n,!U6(n)&&(i=OA[(c=String(n)).toLowerCase()],i===void 0))throw new qe("Unknown adapter '".concat(c,"'"));if(i)break;r[c||"#"+s]=i}if(!i){const s=Object.entries(r).map(c=>{let[l,d]=c;return"adapter ".concat(l," ")+(d===!1?"is not supported by the environment":"is not available in the build")});throw new qe("There is no suitable adapter to dispatch the request "+(e?s.length>1?`since :
`+s.map(Mk).join(`
`):" "+Mk(s[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return i},adapters:OA};function NA(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new nm(null,t)}function Vk(t){return NA(t),t.headers=So.from(t.headers),t.data=RA.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),Uk.getAdapter(t.adapter||TA.adapter)(t).then(function(e){return NA(t),e.data=RA.call(t,t.transformResponse,e),e.headers=So.from(e.headers),e},function(e){return Sk(e)||(NA(t),e&&e.response&&(e.response.data=RA.call(t,t.transformResponse,e.response),e.response.headers=So.from(e.response.headers))),Tt.reject(e)})}const jk="1.9.0",Yy={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{Yy[t]=function(n){return typeof n===t||"a"+(e<1?"n ":" ")+t}});const Bk={};Yy.transitional=function(t,e,n){function i(r,s){return"[Axios v"+jk+"] Transitional option '"+r+"'"+s+(n?". "+n:"")}return(r,s,c)=>{if(t===!1)throw new qe(i(s," has been removed"+(e?" in "+e:"")),qe.ERR_DEPRECATED);return e&&!Bk[s]&&(Bk[s]=!0,console.warn(i(s," has been deprecated since v"+e+" and will be removed in the near future"))),!t||t(r,s,c)}},Yy.spelling=function(t){return(e,n)=>(console.warn("".concat(n," is likely a misspelling of ").concat(t)),!0)};var Xy={assertOptions:function(t,e,n){if(typeof t!="object")throw new qe("options must be an object",qe.ERR_BAD_OPTION_VALUE);const i=Object.keys(t);let r=i.length;for(;r-- >0;){const s=i[r],c=e[s];if(c){const l=t[s],d=l===void 0||c(l,s,t);if(d!==!0)throw new qe("option "+s+" must be "+d,qe.ERR_BAD_OPTION_VALUE)}else if(n!==!0)throw new qe("Unknown option "+s,qe.ERR_BAD_OPTION)}},validators:Yy};const _c=Xy.validators;let Qy=class{constructor(t){this.defaults=t||{},this.interceptors={request:new WD,response:new WD}}async request(t,e){try{return await this._request(t,e)}catch(n){if(n instanceof Error){let i={};Error.captureStackTrace?Error.captureStackTrace(i):i=new Error;const r=i.stack?i.stack.replace(/^.+\n/,""):"";try{n.stack?r&&!String(n.stack).endsWith(r.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+r):n.stack=r}catch{}}throw n}}_request(t,e){typeof t=="string"?(e=e||{}).url=t:e=t||{},e=Dh(this.defaults,e);const{transitional:n,paramsSerializer:i,headers:r}=e;n!==void 0&&Xy.assertOptions(n,{silentJSONParsing:_c.transitional(_c.boolean),forcedJSONParsing:_c.transitional(_c.boolean),clarifyTimeoutError:_c.transitional(_c.boolean)},!1),i!=null&&(yt.isFunction(i)?e.paramsSerializer={serialize:i}:Xy.assertOptions(i,{encode:_c.function,serialize:_c.function},!0)),e.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?e.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:e.allowAbsoluteUrls=!0),Xy.assertOptions(e,{baseUrl:_c.spelling("baseURL"),withXsrfToken:_c.spelling("withXSRFToken")},!0),e.method=(e.method||this.defaults.method||"get").toLowerCase();let s=r&&yt.merge(r.common,r[e.method]);r&&yt.forEach(["delete","get","head","post","put","patch","common"],E=>{delete r[E]}),e.headers=So.concat(s,r);const c=[];let l=!0;this.interceptors.request.forEach(function(E){typeof E.runWhen=="function"&&E.runWhen(e)===!1||(l=l&&E.synchronous,c.unshift(E.fulfilled,E.rejected))});const d=[];let h;this.interceptors.response.forEach(function(E){d.push(E.fulfilled,E.rejected)});let p,m=0;if(!l){const E=[Vk.bind(this),void 0];for(E.unshift.apply(E,c),E.push.apply(E,d),p=E.length,h=Tt.resolve(e);m<p;)h=h.then(E[m++],E[m++]);return h}p=c.length;let _=e;for(m=0;m<p;){const E=c[m++],I=c[m++];try{_=E(_)}catch(C){I.call(this,C);break}}try{h=Vk.call(this,_)}catch(E){return Tt.reject(E)}for(m=0,p=d.length;m<p;)h=h.then(d[m++],d[m++]);return h}getUri(t){return HD(bk((t=Dh(this.defaults,t)).baseURL,t.url,t.allowAbsoluteUrls),t.params,t.paramsSerializer)}};yt.forEach(["delete","get","head","options"],function(t){Qy.prototype[t]=function(e,n){return this.request(Dh(n||{},{method:t,url:e,data:(n||{}).data}))}}),yt.forEach(["post","put","patch"],function(t){function e(n){return function(i,r,s){return this.request(Dh(s||{},{method:t,headers:n?{"Content-Type":"multipart/form-data"}:{},url:i,data:r}))}}Qy.prototype[t]=e(),Qy.prototype[t+"Form"]=e(!0)});var Jy=Qy;class DA{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let n;this.promise=new Tt(function(r){n=r});const i=this;this.promise.then(r=>{if(!i._listeners)return;let s=i._listeners.length;for(;s-- >0;)i._listeners[s](r);i._listeners=null}),this.promise.then=r=>{let s;const c=new Tt(l=>{i.subscribe(l),s=l}).then(r);return c.cancel=function(){i.unsubscribe(s)},c},e(function(r,s,c){i.reason||(i.reason=new nm(r,s,c),n(i.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const n=this._listeners.indexOf(e);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const e=new AbortController,n=i=>{e.abort(i)};return this.subscribe(n),e.signal.unsubscribe=()=>this.unsubscribe(n),e.signal}static source(){let e;return{token:new DA(function(i){e=i}),cancel:e}}}var V6=DA;const PA={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(PA).forEach(t=>{let[e,n]=t;PA[n]=e});var j6=PA;const ir=function t(e){const n=new Jy(e),i=AD(Jy.prototype.request,n);return yt.extend(i,Jy.prototype,n,{allOwnKeys:!0}),yt.extend(i,n,null,{allOwnKeys:!0}),i.create=function(r){return t(Dh(e,r))},i}(TA);ir.Axios=Jy,ir.CanceledError=nm,ir.CancelToken=V6,ir.isCancel=Sk,ir.VERSION=jk,ir.toFormData=Ny,ir.AxiosError=qe,ir.Cancel=ir.CanceledError,ir.all=function(t){return Tt.all(t)},ir.spread=function(t){return function(e){return t.apply(null,e)}},ir.isAxiosError=function(t){return yt.isObject(t)&&t.isAxiosError===!0},ir.mergeConfig=Dh,ir.AxiosHeaders=So,ir.formToJSON=t=>gk(yt.isHTMLForm(t)?new FormData(t):t),ir.getAdapter=Uk.getAdapter,ir.HttpStatusCode=j6,ir.default=ir;var Ir=ir;const B6=()=>{};function Ag(){const t={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:B6};return t.promise=new Tt((e,n)=>{t.resolve=i=>{t.isFinished||(t.isResolved=!0,t.isFinished=!0,e(i),t.value=i)},t.reject=i=>{t.isFinished||(t.isRejected=!0,t.isFinished=!0,n(i))}}),t}const Zy=new Map,$y=new Map,Ec=new Map;let di=function(t){return t.WIN_10="Windows 10",t.WIN_81="Windows 8.1",t.WIN_8="Windows 8",t.WIN_7="Windows 7",t.WIN_VISTA="Windows Vista",t.WIN_SERVER_2003="Windows Server 2003",t.WIN_XP="Windows XP",t.WIN_2000="Windows 2000",t.ANDROID="Android",t.HARMONY_OS="HarmonyOS",t.OPEN_BSD="Open BSD",t.SUN_OS="Sun OS",t.LINUX="Linux",t.IOS="iOS",t.MAC_OS="Mac OS",t.CHROMIUM_OS="Chromium OS",t.QNX="QNX",t.UNIX="UNIX",t.BEOS="BeOS",t.OS_2="OS/2",t.SEARCH_BOT="Search Bot",t}({}),Ie=function(t){return t.CHROME="Chrome",t.SAFARI="Safari",t.EDGE="Edge",t.FIREFOX="Firefox",t.OPERA="OPR",t.QQ="QQBrowser",t.WECHAT="MicroMessenger",t}({});const Fk=new _3;let To=Fk.getResult(),kA=null;function ve(t){if(!kA){To=Fk.getResult();const e=function(l){if(l.engine.name==="Blink"&&l.browser.name!=="WeChat")return Ie.CHROME;switch(l.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Ie.CHROME;case"Safari":case"Mobile Safari":return Ie.SAFARI;case"Edge":return Ie.EDGE;case"Firefox":return Ie.FIREFOX;case"QQ":case"QQBrowser":return Ie.QQ;case"Opera":return Ie.OPERA;case"WeChat":return Ie.WECHAT;default:return l.browser.name||""}}(To),n=Gk(To),i=function(l){return l.os.name==="Windows"?l.os.version?l.os.name+" "+l.os.version:l.os.name:l.os.name||""}(To),r=To.os.version,s=Gk(To,!1),c=To.device.type;if(!(e&&n&&i&&r))return{name:e,version:n,os:i,osVersion:r,browserVersion:s,deviceType:c};kA={name:e,version:n,os:i,osVersion:r,browserVersion:s,deviceType:c}}return kA}function Gk(t){let e,n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return e=t.engine.name==="Blink"?t.engine.version||"":t.browser.version||"",n?e.split(".")[0]:e}function tR(){return ve().os}function Hk(){const t=ve();return"".concat(t.os," ").concat(t.osVersion)}function eR(){const t=ve();return!!(To.engine.name==="WebKit"&&t.os===di.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&t.name!==Ie.SAFARI||rr()&&t.name!==Ie.SAFARI)}function Tl(){return ve().name===Ie.CHROME}function Di(){return ve().name===Ie.SAFARI}function Wk(){const t=ve();if(t.name!==Ie.SAFARI||!t.browserVersion)return!1;const e=t.browserVersion.split(".");return Number(e[0])>15||Number(e[0])===15&&Number(e[1])>=4}function zk(){return ve().name===Ie.EDGE}function An(){return ve().name===Ie.FIREFOX}function rr(){return ve().os===di.IOS}function im(t){const e=ve();return!(e.name!==Ie.CHROME||!e.osVersion)&&Number(e.version)>=t}function qk(t){const e=ve();return!(e.name!==Ie.CHROME||!e.osVersion)&&Number(e.version)<t}function LA(t,e,n){const i=ve();return!(i.name!==t||!i.osVersion)&&(n?Number(i.version)>=e&&Number(i.version)<=n:Number(i.version)===e)}function xA(t){const e=ve();return!(e.name!==Ie.EDGE||!e.osVersion)&&Number(e.version)>=t}function MA(t){const e=ve();return!(e.name!==Ie.FIREFOX||!e.osVersion)&&Number(e.version)>=t}function Kk(t){const e=ve();return!(e.name!==Ie.SAFARI||!e.osVersion)&&Number(e.version)>=t}function Yk(t,e,n){const i=ve();if(i.os!==di.IOS||!i.osVersion)return!1;const r=i.osVersion.split(".");return n?e&&Number(r[0])===t&&Number(r[1])>e||Number(r[0])>t:e?Number(r[0])===t&&Number(r[1])>=e||Number(r[0])>t:Number(r[0])>=t}function Xk(t,e,n){const i=ve();if(i.os!==di.IOS||!i.osVersion)return!1;const r=i.osVersion.split(".");return e&&Number(r[0])===t&&Number(r[1])<e||Number(r[0])<t}function UA(t,e,n){const i=ve();if(i.name!==Ie.SAFARI||!i.osVersion||!i.browserVersion)return!1;const r=i.browserVersion.split(".");return n?e&&Number(r[0])===t&&Number(r[1])<e||Number(r[0])<t:e?Number(r[0])===t&&Number(r[1])<=e||Number(r[0])<t:Number(r[0])<=t}function VA(t){const e=ve();return!(e.name!==Ie.OPERA||!e.osVersion)&&Number(e.version)>=t}function Qk(){const t=ve();if(t.os!==di.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])<14||Number(e[0])===14&&Number(e[1])<=6}function rm(){const t=ve();if(t.os!==di.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])===15}function jA(){const t=ve();if(t.os!==di.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])===16}function Jk(){const t=ve();if(t.os!==di.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])===15&&Number(e[1])>=1}function Ns(){return Di()&&navigator.maxTouchPoints>0}function Zk(){return ve().name===Ie.WECHAT}function $k(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function BA(){const t=tR();return function(){const{deviceType:e}=ve();return e==="mobile"||e==="tablet"}()||t===di.ANDROID||t===di.IOS||t===di.HARMONY_OS}function yl(){const t=ve();return t.name!==Ie.EDGE&&t.name!==Ie.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function nR(){return tR()===di.ANDROID}function wg(){const t=ve();return nR()&&(t.name===Ie.CHROME||t.name===Ie.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function Xt(t,e,n){return(e=function(i){var r=function(s,c){if(typeof s!="object"||!s)return s;var l=s[Symbol.toPrimitive];if(l!==void 0){var d=l.call(s,"string");if(typeof d!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}(i);return typeof r=="symbol"?r:r+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function tL(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function ut(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?tL(Object(n),!0).forEach(function(i){Xt(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):tL(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}let P=function(t){return t.UNEXPECTED_ERROR="UNEXPECTED_ERROR",t.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",t.TIMEOUT="TIMEOUT",t.INVALID_PARAMS="INVALID_PARAMS",t.NOT_READABLE="NOT_READABLE",t.NOT_SUPPORTED="NOT_SUPPORTED",t.INVALID_OPERATION="INVALID_OPERATION",t.OPERATION_ABORTED="OPERATION_ABORTED",t.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",t.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",t.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",t.DATACHANNEL_FAILED="DATACHANNEL_FAILED",t.NETWORK_ERROR="NETWORK_ERROR",t.NETWORK_TIMEOUT="NETWORK_TIMEOUT",t.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",t.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",t.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",t.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",t.ELECTRON_IS_NULL="ELECTRON_IS_NULL",t.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",t.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",t.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",t.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",t.PERMISSION_DENIED="PERMISSION_DENIED",t.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",t.TRACK_IS_DISABLED="TRACK_IS_DISABLED",t.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",t.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",t.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",t.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",t.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",t.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",t.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",t.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",t.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",t.UID_CONFLICT="UID_CONFLICT",t.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",t.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",t.TOKEN_EXPIRE="TOKEN_EXPIRE",t.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",t.INVALID_TRACK="INVALID_TRACK",t.SENDER_NOT_FOUND="SENDER_NOT_FOUND",t.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",t.SET_ANSWER_FAILED="SET_ANSWER_FAILED",t.ICE_FAILED="ICE_FAILED",t.PC_CLOSED="PC_CLOSED",t.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",t.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",t.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",t.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",t.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",t.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",t.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",t.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",t.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",t.INVALID_REMOTE_USER="INVALID_REMOTE_USER",t.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",t.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",t.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",t.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",t.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",t.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",t.WS_ABORT="WS_ABORT",t.WS_DISCONNECT="WS_DISCONNECT",t.WS_ERR="WS_ERR",t.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",t.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",t.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",t.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",t.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",t.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",t.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",t.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",t.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",t.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",t.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",t.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",t.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",t.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",t.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",t.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",t.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",t.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",t.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",t.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",t.INVALID_PLUGIN="INVALID_PLUGIN",t.DISCONNECT_P2P="DISCONNECT_P2P",t.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",t.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",t.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",t.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",t.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",t.PROHIBITED_OPERATION="PROHIBITED_OPERATION",t.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",t.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",t}({}),Z=class extends Error{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0;super(e),Xt(this,"code",void 0),Xt(this,"message",void 0),Xt(this,"data",void 0),Xt(this,"name","AgoraRTCException"),this.code=t,this.message="AgoraRTCError ".concat(this.code,": ").concat(e),this.data=n}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",e=arguments.length>1?arguments[1]:void 0;return t==="error"&&(e||console).error(this.toString()),t==="warning"&&(e||console).warn(this.toString()),this}throw(t){throw this.print("error",t),this}};function yo(t,e){if(typeof t!="boolean")throw new Z(P.INVALID_PARAMS,"Invalid ".concat(e,": The value is of the boolean type."))}function ri(t,e,n){if(!mt(n).call(n,t))throw new Z(P.INVALID_PARAMS,"".concat(e," can only be set as ").concat(JSON.stringify(n)))}function Ke(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(t<n||t>i||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(r){return typeof r=="number"&&r%1==0}(t))throw new Z(P.INVALID_PARAMS,"invalid ".concat(e,": the value range is [").concat(n,", ").concat(i,"]. integer only"))}function FA(t,e){if(typeof t!="number"){if(!(t.min||t.max||t.ideal||t.exact))throw new Z(P.INVALID_PARAMS,"".concat(e," is not a valid ConstrainLong"));t.min!==void 0&&Ke(t.min,"".concat(e,".min"),0,1/0),t.max!==void 0&&Ke(t.max,"".concat(e,".max"),1,1/0),t.exact!==void 0&&Ke(t.exact,"".concat(e,".exact"),1,1/0),t.ideal!==void 0&&Ke(t.ideal,"".concat(e,".ideal"),1,1/0)}else Ke(t,e,1,1/0)}function Ti(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,r=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(t==null)throw new Z(P.INVALID_PARAMS,"".concat(e||"param"," cannot be empty"));if(!eL(t,n,i,r))throw new Z(P.INVALID_PARAMS,"Invalid ".concat(e||"string param",": Length of the string: [").concat(n,",").concat(i,"].").concat(r?" ASCII characters only.":""))}function Rl(t,e){if(!Array.isArray(t))throw new Z(P.INVALID_PARAMS,"".concat(e," should be an array"))}function wn(t){return t==null}function eL(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,i=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof t=="string"&&t.length<=n&&t.length>=e&&(!i||function(r){if(typeof r!="string")return!1;for(let s=0;s<r.length;s+=1){const c=r.charCodeAt(s);if(c<0||c>255)return!1}return!0}(t))}var Ig=function(t){return t.COVERED="COVERED",t.POSITION="POSITION",t.SIZE="SIZE",t.STYLE="STYLE",t}(Ig||{}),GA=function(t){return t.UNMOUNTED="UNMOUNTED",t.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",t}(GA||{});const nL=new class{constructor(){Xt(this,"_clientSize",null),Xt(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),Xt(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),Xt(this,"getStyle",t=>window.getComputedStyle(t,null)),Xt(this,"checkCssVisibleProperty",t=>{var e;let n=!0;const i=this.getStyle(t),{display:r,visibility:s,opacity:c,filter:l}=i;return(r==="none"||mt(e=["hidden","collapse"]).call(e,s)||Number(c)<.1)&&(n=!1),!!n&&(l&&l.split(" ").filter(d=>{var h;const p=d.split("(")[0];return mt(h=["brightness","blur","opacity"]).call(h,p)}).map(d=>{const[h,p]=d.split(/\(|\)/);return[h,Number(p.match(/^[0-9\.]+/))]}).forEach(d=>{const[h,p]=d;switch(h){case"brightness":(p<.1||p>3)&&(n=!1);break;case"blur":p>3&&(n=!1);break;case"opacity":p<.1&&(n=!1)}}),n)}),Xt(this,"checkPropertyUpToAllParentNodes",(t,e)=>{let n=!0,i=!0;const r=c=>e(c);let s=t;for(;s&&i;)r(s)||(n=!1,i=!1),s=s.parentElement,s||(i=!1);return n}),Xt(this,"checkActualCssVisibleIncludeInherit",t=>this.checkPropertyUpToAllParentNodes(t,this.checkCssVisibleProperty)),Xt(this,"getSizeAboutClient",t=>{const{width:e,height:n,left:i,right:r,top:s,bottom:c}=t.getBoundingClientRect(),l=this.getClientWidth(),d=this.getClientHeight();return{width:e,height:n,left:i,right:r,top:s,bottom:c,clientWidth:l,clientHeight:d,clientMin:Math.min(l,d)}}),Xt(this,"checkActualSize",()=>{const{width:t,height:e,clientMin:n}=this._clientSize;return this.checkSizeIsVisible(t,e,n)}),Xt(this,"elementFromPoint",(t,e)=>document.elementFromPoint?document.elementFromPoint(t,e):null),Xt(this,"checkCoverForAPoint",(t,e,n)=>{const i=this.elementFromPoint(t,e);return i!==null&&i!==n}),Xt(this,"getPointPositionList",()=>{const{width:t,height:e,left:n,top:i}=this._clientSize,r=t/6,s=e/6,c=[],l=10**6;for(let d=0;d<5;d++)for(let h=0;h<5;h++){const p=(n*l+(d===0?.1:d===4?(r*d*l-1e5)/l:r*d)*l)/l,m=(i*l+(h===0?.1:h===4?(s*h*l-1e5)/l:s*h)*l)/l;c.push({x:p,y:m})}return[...c]}),Xt(this,"checkElementCover",t=>this.getPointPositionList().map(e=>this.checkCoverForAPoint(e.x,e.y,t)).filter(e=>!!e).length>6),Xt(this,"checkSizeIsVisible",(t,e,n)=>(t>50||n/t<=10)&&(e>50||n/e<=10)),Xt(this,"checkSizeOfPartInClient",()=>{const{left:t,right:e,top:n,bottom:i,clientHeight:r,clientWidth:s,clientMin:c}=this._clientSize;let l,d,h,p;if(t<0)l=0;else{if(!(t<s))return!1;l=t}if(e<0)return!1;if(d=e<s?e:s,n<0)h=0;else{if(!(n<r))return!1;h=n}if(i<0)return!1;p=i<r?i:r;const m=d-l,_=p-h;return this.checkSizeIsVisible(m,_,c)}),Xt(this,"returnHiddenResult",t=>(this._clientSize=null,{visible:!1,reason:t})),Xt(this,"checkOneElementVisible",t=>{if(t instanceof HTMLElement){if(this.checkElementIsMountedOnDom(t)){if(this.checkActualCssVisibleIncludeInherit(t)){if(this._clientSize=this.getSizeAboutClient(t),this.checkElementCover(t))return this.returnHiddenResult(Ig.COVERED);{const e=this.checkActualSize(),n=this.checkSizeOfPartInClient();return e&&!n?this.returnHiddenResult(Ig.POSITION):e?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(Ig.SIZE)}}return this.returnHiddenResult(Ig.STYLE)}return this.returnHiddenResult(GA.UNMOUNTED)}return this.returnHiddenResult(GA.INVALID_HTML_ELEMENT)}),Xt(this,"checkElementIsMountedOnDom",t=>this.checkPropertyUpToAllParentNodes(t,e=>e.nodeName.toUpperCase()!=="HTML"?e.parentElement!==null:!!document.documentElement))}};function HA(t){return new TextEncoder().encode(t)}const iL=function(t,e){const n=new Uint8Array(t.byteLength+e.byteLength);return n.set(new Uint8Array(t),0),n.set(new Uint8Array(e),t.byteLength),n},WA=async t=>function(e,n){let i="";return new Uint8Array(e).forEach(r=>{i+=r.toString(n).padStart(2,"0")}),i}(await crypto.subtle.digest("SHA-256",HA(t)),16);class Sn{constructor(){Xt(this,"_events",{}),Xt(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map(n=>n.listener):[]}on(e,n){this._events[e]||(this._events[e]=[]);const i=this._events[e];this._indexOfListener(i,n)===-1&&i.push({listener:n,once:!1})}once(e,n){this._events[e]||(this._events[e]=[]);const i=this._events[e];this._indexOfListener(i,n)===-1&&i.push({listener:n,once:!0})}off(e,n){if(!this._events[e])return;const i=this._events[e],r=this._indexOfListener(i,n);r!==-1&&i.splice(r,1),this._events[e].length===0&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);const n=this._events[e].map(c=>c);for(var i=arguments.length,r=new Array(i>1?i-1:0),s=1;s<i;s++)r[s-1]=arguments[s];for(let c=0;c<n.length;c+=1){const l=n[c];l.once&&this.off(e,l.listener),l.listener.apply(this,r||[])}}safeEmit(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];[...this._events[e]||[]].forEach(s=>{s.once&&this.off(e,s.listener);try{s.listener.apply(this,i)}catch(c){console.error("safeEmit event:".concat(e," error ").concat(c==null?void 0:c.toString()))}})}_indexOfListener(e,n){let i=e.length;for(;i--;)if(e[i].listener===n)return i;return-1}}let Og=null;function rL(){if(Og)return Og;if(window.electron)return Og=window.electron;if(!window.require)return null;try{return Og=window.require("electron"),Og}catch{return null}}let kn=function(t){return t.CREATE_CLIENT="createClient",t.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",t.SET_AREA="setArea",t.PRELOAD="PRELOAD",t.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",t.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",t.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",t.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",t.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",t.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",t.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",t.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",t.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",t.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",t.START_PROXY_SERVER="Client.startProxyServer",t.STOP_PROXY_SERVER="Client.stopProxyServer",t.SET_PROXY_SERVER="Client.setProxyServer",t.SET_TURN_SERVER="Client.setTurnServer",t.SET_CLIENT_ROLE="Client.setClientRole",t.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",t.ENABLE_DUAL_STREAM="Client.enableDualStream",t.DISABLE_DUAL_STREAM="Client.disableDualStream",t.JOIN="Client.join",t.LEAVE="Client.leave",t.PUBLISH="Client.publish",t.UNPUBLISH="Client.unpublish",t.SUBSCRIBE="Client.subscribe",t.MASS_SUBSCRIBE="Client.massSubscribe",t.MASS_UNSUBSCRIBE="Client.massUnsubscribe",t.UNSUBSCRIBE="Client.unsubscribe",t.RENEW_TOKEN="Client.renewToken",t.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",t.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",t.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",t.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",t.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",t.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",t.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",t.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",t.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",t.START_LIVE_STREAMING="Client.startLiveStreaming",t.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",t.STOP_LIVE_STREAMING="Client.stopLiveStreaming",t.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",t.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",t.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",t.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",t.SET_CONFIG_DISTRIBUTE="_configDistribute",t.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",t.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",t.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",t.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",t.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",t.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",t.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",t.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",t.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",t.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",t.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",t.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",t.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",t.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",t.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",t.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",t.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",t.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",t.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",t.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",t.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",t.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",t.STREAM_TYPE_CHANGE="streamTypeChange",t.CONNECTION_STATE_CHANGE="connectionStateChange",t.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",t.IMAGE_MODERATION_UPLOAD="imageModerationUpload",t.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",t.PRELOAD_MEDIA_FAILED="preloadMediaFailed",t.MISMATCH_DTLS_PARAMETERS="mismatchDtlsParameters",t}({}),_n=function(t){return t.TRACER="tracer",t}({});function aL(t){return Ke(t.timeout,"config.timeout",0,1e5),Ke(t.timeoutFactor,"config.timeoutFactor",0,100,!1),Ke(t.maxRetryCount,"config.maxRetryConfig",0,1/0),Ke(t.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let F6=function(t){return t[t.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",t[t.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",t[t.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",t}({}),xe=function(t){return t.LEAVE="LEAVE",t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.UID_BANNED="UID_BANNED",t.FALLBACK="FALLBACK",t.IP_BANNED="IP_BANNED",t.CHANNEL_BANNED="CHANNEL_BANNED",t.LICENSE_MISSING="LICENSE_MISSING",t.LICENSE_EXPIRED="LICENSE_EXPIRED",t.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",t.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",t.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",t.LICENSE_ILLEGAL="LICENSE_ILLEGAL",t.TOKEN_EXPIRE="TOKEN_EXPIRE",t}({});function Ng(t){if(!Array.isArray(t)||t.length<1)return!1;try{t.forEach(e=>{if(!e.urls)throw Error()})}catch{return!1}return!0}function sL(t){return Ti(t.turnServerURL,"turnServerURL"),Ti(t.username,"username"),Ti(t.password,"password"),t.udpport&&Ke(t.udpport,"udpport",1,99999,!0),t.forceturn&&yo(t.forceturn,"forceturn"),t.security&&yo(t.security,"security"),t.tcpport&&Ke(t.tcpport,"tcpport",1,99999,!0),!0}function zA(t){return t.level!==void 0&&ri(t.level,"level",[1,2,3]),t.delay!==void 0&&Ke(t.delay,"delay",0,3e3,!0),!0}let he=function(t){return t.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",t.AUDIO_METADATA="audio-metadata",t.AUDIO_PTS="audio-pts",t.CONNECTION_STATE_CHANGE="connection-state-change",t.MEDIA_RECONNECT_START="media-reconnect-start",t.MEDIA_RECONNECT_END="media-reconnect-end",t.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",t.USER_JOINED="user-joined",t.USER_LEAVED="user-left",t.USER_PUBLISHED="user-published",t.USER_UNPUBLISHED="user-unpublished",t.USER_INFO_UPDATED="user-info-updated",t.CLIENT_BANNED="client-banned",t.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",t.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",t.VOLUME_INDICATOR="volume-indicator",t.CRYPT_ERROR="crypt-error",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGED="stream-type-changed",t.STREAM_FALLBACK="stream-fallback",t.RECEIVE_METADATA="receive-metadata",t.STREAM_MESSAGE="stream-message",t.LIVE_STREAMING_ERROR="live-streaming-error",t.LIVE_STREAMING_WARNING="live-streaming-warning",t.EXCEPTION="exception",t.ERROR="error",t.P2P_LOST="p2p_lost",t.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",t.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",t.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",t.PUBLISHED_USER_LIST="published-user-list",t.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",t.CONTENT_INSPECT_ERROR="content-inspect-error",t.CONTENT_INSPECT_RESULT="content-inspect-result",t.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",t}({}),Pi=function(t){return t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.MULTI_IP="MULTI_IP",t.TIMEOUT="TIMEOUT",t.OFFLINE="OFFLINE",t.LEAVE="LEAVE",t.P2P_FAILED="P2P_FAILED",t.FALLBACK="FALLBACK",t.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",t}({}),la=function(t){return t.ONLINE="ONLINE",t.OFFLINE="OFFLINE",t}({}),am=function(t){return t.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",t.ONLINE="ONLINE",t.OFFLINE="OFFLINE",t}({});function ki(t,e){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return t.getListeners(e).length===0?Tt.reject(new Z(P.UNEXPECTED_ERROR,"can not emit promise")):new Tt((s,c)=>{t.emit(e,...i,s,c)})}function Qe(t,e){if(t.getListeners(e).length===0)return Tt.resolve();for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return ki(t,e,...i)}function Ca(t,e){if(t.getListeners(e).length===0)return null;for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return Dg(t,e,...i)}function Dg(t,e){let n=null,i=null;for(var r=arguments.length,s=new Array(r>2?r-2:0),c=2;c<r;c++)s[c-2]=arguments[c];if(t.emit(e,...s,l=>{n=l},l=>{i=l}),i!==null)throw i;if(n===null)throw new Z(P.UNEXPECTED_ERROR,"handler is not sync");return n}const Wn=new class extends Sn{set networkState(t){this.emit(am.NETWORK_STATE_CHANGE,t,this._networkState),t===la.ONLINE?this.emit(am.ONLINE):t===la.OFFLINE&&(this.onlineWaiter=new Tt(e=>{this.once(am.ONLINE,()=>{this.onlineWaiter=void 0,e(la.ONLINE)})}),this.emit(am.OFFLINE)),this._networkState=t}get networkState(){return this._networkState}get isOnline(){return this._networkState===la.ONLINE}constructor(){super(),Xt(this,"_moduleName","network-indicator"),Xt(this,"_networkState",la.ONLINE),Xt(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=la.ONLINE}),window.addEventListener("offline",()=>{this.networkState=la.OFFLINE})}};function iR(t,e){const n=t.indexOf(e);n!==-1&&t.splice(n,1)}function sm(t){const e=[];return t.forEach(n=>{e.indexOf(n)===-1&&e.push(n)}),e}function rR(t){Tt!==void 0?Tt.resolve().then(t):setTimeout(t,0)}function En(t){return JSON.parse(JSON.stringify(t))}function Ph(t){try{return En(t)}catch{return t}}const oL={};function Fd(t,e){oL[e]||(oL[e]=!0,t())}function kh(t){const e=window.atob(t),n=new Uint8Array(new ArrayBuffer(e.length));for(let i=0;i<e.length;i+=1)n[i]=e.charCodeAt(i);return n}function Gd(t){let e="";for(let n=0;n<t.length;n+=1)e+=String.fromCharCode(t[n]);return window.btoa(e)}function cL(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=new TextEncoder().encode(t);if(n.length>e)n=n.slice(0,e);else if(n.length<e){const i=new Uint8Array(e);i.set(n),n=i}return n}function lL(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=Vr(e).call(e,(c,l)=>c+l.length,0),r=new Uint8Array(new ArrayBuffer(i));let s=0;return e.forEach(c=>{r.set(c,s),s+=c.length}),r}function gc(t){return window.TextEncoder?new TextEncoder().encode(t).length:t.length}function dL(t){let e=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&t.realFormData&&(t=t.realFormData),t.forEach(n=>{e+=typeof n=="string"?gc(n):n.size}),e+138}function G6(t){const e=new Z(P.TIMEOUT,"timeout");return new Tt((n,i)=>{window.setTimeout(()=>i(e),t)})}function yi(t){return new Tt(e=>{window.setTimeout(e,t)})}function Je(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,e=arguments.length>1?arguments[1]:void 0;const n=Math.random().toString(16).substr(2,t).toLowerCase();return n.length===t?"".concat(e).concat(n):"".concat(e).concat(n)+Je(t-n.length,"")}function Lh(){return Je(32,"").toUpperCase()}const aR=()=>{},uL=new class{constructor(){Xt(this,"fnMap",new Map)}throttleByKey(t,e,n,i){for(var r=arguments.length,s=new Array(r>4?r-4:0),c=4;c<r;c++)s[c-4]=arguments[c];if(this.fnMap.has(e)){const l=this.fnMap.get(e);if(l.threshold!==n){l.fn(...l.args),clearTimeout(l.timer);const d=window.setTimeout(()=>{const h=this.fnMap.get(e);h&&h.fn(...h.args),this.fnMap.delete(e)},n);this.fnMap.set(e,{fn:t,threshold:n,timer:d,args:s,skipFn:i})}else l.skipFn&&l.skipFn(...l.args),this.fnMap.set(e,ut(ut({},l),{},{fn:t,args:s,skipFn:i}))}else{const l=window.setTimeout(()=>{const d=this.fnMap.get(e);d&&d.fn(...d.args),this.fnMap.delete(e)},n);this.fnMap.set(e,{fn:t,threshold:n,timer:l,args:s,skipFn:i})}}},hL=uL.throttleByKey.bind(uL);function pL(t){return typeof t=="object"&&t!==null&&!(t instanceof RegExp)}function qA(t,e){if(!pL(t)||!pL(e)||Array.isArray(t)&&!Array.isArray(e)||!Array.isArray(t)&&Array.isArray(e))return e;if(Array.isArray(e)&&Array.isArray(t)){const n=[...t];for(let i=0;i<e.length;i++)n[i]=qA(t[i],e[i]);return n}{const n=ut({},t);for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(Object.prototype.hasOwnProperty.call(t,i)?n[i]=qA(t[i],e[i]):n[i]=e[i]);return n}}function fL(t,e){let n=[0];if(n=new Array(e).fill(0),t===0)return n;let i=0;for(;t>0&&(n[i]=255&t,t>>=8,i++,i!==e););return n}function om(t){return typeof t=="number"?t:t.exact||t.ideal||t.max||t.min||0}function KA(t){return Vr(t).call(t,(e,n)=>e+n,0)}function mL(t){const e="0123456789abcdef";function n(L){let W,G="";for(W=0;W<=3;W++)G+=e.charAt(L>>8*W+4&15)+e.charAt(L>>8*W&15);return G}function i(L,W){const G=(65535&L)+(65535&W);return(L>>16)+(W>>16)+(G>>16)<<16|65535&G}function r(L,W,G,U,z,$){return i(function(rt,dt){return rt<<dt|rt>>>32-dt}(i(i(W,L),i(U,$)),z),G)}function s(L,W,G,U,z,$,rt){return r(W&G|~W&U,L,W,z,$,rt)}function c(L,W,G,U,z,$,rt){return r(W&U|G&~U,L,W,z,$,rt)}function l(L,W,G,U,z,$,rt){return r(W^G^U,L,W,z,$,rt)}function d(L,W,G,U,z,$,rt){return r(G^(W|~U),L,W,z,$,rt)}const h=function(L){let W;const G=1+(L.length+8>>6),U=new Array(16*G);for(W=0;W<16*G;W++)U[W]=0;for(W=0;W<L.length;W++)U[W>>2]|=L.charCodeAt(W)<<W%4*8;return U[W>>2]|=128<<W%4*8,U[16*G-2]=8*L.length,U}(t);let p,m,_,E,I,C=1732584193,w=-271733879,D=-1732584194,N=271733878;for(p=0;p<h.length;p+=16)m=C,_=w,E=D,I=N,C=s(C,w,D,N,h[p+0],7,-680876936),N=s(N,C,w,D,h[p+1],12,-389564586),D=s(D,N,C,w,h[p+2],17,606105819),w=s(w,D,N,C,h[p+3],22,-1044525330),C=s(C,w,D,N,h[p+4],7,-176418897),N=s(N,C,w,D,h[p+5],12,1200080426),D=s(D,N,C,w,h[p+6],17,-1473231341),w=s(w,D,N,C,h[p+7],22,-45705983),C=s(C,w,D,N,h[p+8],7,1770035416),N=s(N,C,w,D,h[p+9],12,-1958414417),D=s(D,N,C,w,h[p+10],17,-42063),w=s(w,D,N,C,h[p+11],22,-1990404162),C=s(C,w,D,N,h[p+12],7,1804603682),N=s(N,C,w,D,h[p+13],12,-40341101),D=s(D,N,C,w,h[p+14],17,-1502002290),w=s(w,D,N,C,h[p+15],22,1236535329),C=c(C,w,D,N,h[p+1],5,-165796510),N=c(N,C,w,D,h[p+6],9,-1069501632),D=c(D,N,C,w,h[p+11],14,643717713),w=c(w,D,N,C,h[p+0],20,-373897302),C=c(C,w,D,N,h[p+5],5,-701558691),N=c(N,C,w,D,h[p+10],9,38016083),D=c(D,N,C,w,h[p+15],14,-660478335),w=c(w,D,N,C,h[p+4],20,-405537848),C=c(C,w,D,N,h[p+9],5,568446438),N=c(N,C,w,D,h[p+14],9,-1019803690),D=c(D,N,C,w,h[p+3],14,-187363961),w=c(w,D,N,C,h[p+8],20,1163531501),C=c(C,w,D,N,h[p+13],5,-1444681467),N=c(N,C,w,D,h[p+2],9,-51403784),D=c(D,N,C,w,h[p+7],14,1735328473),w=c(w,D,N,C,h[p+12],20,-1926607734),C=l(C,w,D,N,h[p+5],4,-378558),N=l(N,C,w,D,h[p+8],11,-2022574463),D=l(D,N,C,w,h[p+11],16,1839030562),w=l(w,D,N,C,h[p+14],23,-35309556),C=l(C,w,D,N,h[p+1],4,-1530992060),N=l(N,C,w,D,h[p+4],11,1272893353),D=l(D,N,C,w,h[p+7],16,-155497632),w=l(w,D,N,C,h[p+10],23,-1094730640),C=l(C,w,D,N,h[p+13],4,681279174),N=l(N,C,w,D,h[p+0],11,-358537222),D=l(D,N,C,w,h[p+3],16,-722521979),w=l(w,D,N,C,h[p+6],23,76029189),C=l(C,w,D,N,h[p+9],4,-640364487),N=l(N,C,w,D,h[p+12],11,-421815835),D=l(D,N,C,w,h[p+15],16,530742520),w=l(w,D,N,C,h[p+2],23,-995338651),C=d(C,w,D,N,h[p+0],6,-198630844),N=d(N,C,w,D,h[p+7],10,1126891415),D=d(D,N,C,w,h[p+14],15,-1416354905),w=d(w,D,N,C,h[p+5],21,-57434055),C=d(C,w,D,N,h[p+12],6,1700485571),N=d(N,C,w,D,h[p+3],10,-1894986606),D=d(D,N,C,w,h[p+10],15,-1051523),w=d(w,D,N,C,h[p+1],21,-2054922799),C=d(C,w,D,N,h[p+8],6,1873313359),N=d(N,C,w,D,h[p+15],10,-30611744),D=d(D,N,C,w,h[p+6],15,-1560198380),w=d(w,D,N,C,h[p+13],21,1309151649),C=d(C,w,D,N,h[p+4],6,-145523070),N=d(N,C,w,D,h[p+11],10,-1120210379),D=d(D,N,C,w,h[p+2],15,718787259),w=d(w,D,N,C,h[p+9],21,-343485551),C=i(C,m),w=i(w,_),D=i(D,E),N=i(N,I);return n(C)+n(w)+n(D)+n(N)}let H6=1,_L=console,Wi=class{static setLogger(t){_L=t}constructor(t,e){Xt(this,"id",void 0),Xt(this,"lockingPromise",Tt.resolve()),Xt(this,"locks",0),Xt(this,"name",""),Xt(this,"lockId",void 0),this.lockId=H6++,t&&(this.name=t),e&&(this.id=e),this.logger("created")}logger(t,e){const n=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),i=t==="created"?"is ".concat(t,"."):"is ".concat(t,", current queue ").concat(this.locks,". ").concat(e??"");_L.debug("".concat(n," ").concat(i))}setId(t){this.id=t}get isLocked(){return this.locks>0}lock(t){let e;this.locks+=1,this.logger("locked",t);const n=new Tt(r=>{e=()=>{this.locks-=1,this.logger("unlocked",t),r()}}),i=this.lockingPromise.then(()=>e);return this.lockingPromise=this.lockingPromise.then(()=>n),i}};function cm(t,e){return function(n,i,r){const s=r.value;if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){const c=this[e];if(!c)throw new Error("mutex property key ".concat(e," doesn't exist on ").concat(t));const l=await c.lock("From ".concat(t,".").concat(i));try{for(var d=arguments.length,h=new Array(d),p=0;p<d;p++)h[p]=arguments[p];return await s.apply(this,h)}finally{l()}},r}}const Xn={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function YA(t,e){const n=Math.floor(e.timeout*Math.pow(e.timeoutFactor,t));return Math.min(e.maxRetryTimeout,n)}function Ro(t,e,n,i){const r=Object.assign({},Xn,i);let s=r.timeout;const c=async()=>{await function(h){return new Tt(p=>{window.setTimeout(p,h)})}(s),s*=r.timeoutFactor,s=Math.min(r.maxRetryTimeout,s)};let l=!1;const d=new Tt(async(h,p)=>{e=e||(()=>!1),n=n||(()=>!0);for(let m=0;m<r.maxRetryCount;m+=1){if(l)return p(new Z(P.OPERATION_ABORTED));try{const _=await t();if(!e(_,m)||m+1===r.maxRetryCount)return h(_);await c()}catch(_){if(!n(_,m)||m+1===r.maxRetryCount)return p(_);await c()}}});return d.cancel=()=>l=!0,d}let sR,EL=class{constructor(t){Xt(this,"input",[]),Xt(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}mean(){var t;return this.input.length===0?0:Vr(t=this.input).call(t,(e,n)=>e+n)/this.input.length}},oR=0,XA=0;function QA(t,e,n,i){return new Tt((r,s)=>{e.responseType=e.responseType||"json",e.data&&!n?(e.data=JSON.stringify(e.data),oR+=gc(e.data)):n&&(e.data.size?oR+=e.data.size:e.data instanceof FormData?oR+=dL(e.data):oR+=gc(JSON.stringify(e.data))),e.headers=e.headers||{},e.headers["Content-Type"]=e.headers["Content-Type"]||"application/json",e.method="POST",e.url=t,Ir.request(e).then(c=>{typeof c.data=="string"?XA+=gc(c.data):c.data instanceof ArrayBuffer||c.data instanceof Uint8Array?XA+=c.data.byteLength:XA+=gc(JSON.stringify(c.data)),r(c.data)}).catch(c=>{Ir.isCancel(c)?s(new Z(P.OPERATION_ABORTED,"cancel token canceled")):c.code==="ECONNABORTED"?s(new Z(P.NETWORK_TIMEOUT,c.message)):c.response?s(new Z(P.NETWORK_RESPONSE_ERROR,c.response.status)):s(new Z(P.NETWORK_ERROR,c.message))})})}async function W6(t,e){const n=new Blob([e.data],{type:"buffer"});return await QA(t,ut(ut({},e),{},{data:n,headers:{"Content-Type":"application/octet-stream"}}),!0)}const gL=()=>window.isSecureContext!==void 0;function Ds(t){if(Array.isArray(t))return t.map(n=>n);if(!vL(t))return t;const e={};for(const n in t){const i=t[n];vL(i)||Array.isArray(i)?e[n]=Ds(i):e[n]=i}return e}function vL(t){return!(typeof t!="object"||Array.isArray(t)||!t)}let JA=class{constructor(t){Xt(this,"input",[]),Xt(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const vc={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},Pg={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:vc,remoteCandidate:vc},updateInterval:0},SL={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},TL={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},yL={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},RL={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0,silentConcealedSamples:0,concealmentEvents:0,freezeMs80:0,freezeMs200:0,freezeSamples80:0,freezeSamples200:0};let ZA=class{constructor(t,e){Xt(this,"onFirstVideoReceived",void 0),Xt(this,"onFirstVideoDecoded",void 0),Xt(this,"onFirstAudioReceived",void 0),Xt(this,"onFirstVideoDecodedTimeout",void 0),Xt(this,"onFirstAudioDecoded",void 0),Xt(this,"onSelectedLocalCandidateChanged",void 0),Xt(this,"onSelectedRemoteCandidateChanged",void 0),Xt(this,"videoIsReady",!1),Xt(this,"videoIsReady2",{}),Xt(this,"pc",void 0),Xt(this,"options",void 0),Xt(this,"intervalTimer",void 0),Xt(this,"stats",Ds(Pg)),Xt(this,"isFirstVideoReceived",{}),Xt(this,"isFirstVideoDecoded",{}),Xt(this,"isFirstAudioReceived",{}),Xt(this,"isFirstAudioDecoded",{}),Xt(this,"isFirstVideoDecodedTimeout",{}),Xt(this,"lossRateWindowStats",[]),this.pc=t,this.options=e,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new Tt(t=>{t({local:ut({},vc),remote:ut({},vc)})})}setVideoIsReady(t){this.videoIsReady=t}setVideoIsReady2(t,e){this.videoIsReady2[t]=e}getVideoIsReady(t){return this.videoIsReady2[t]||!1}setIsFirstAudioDecoded(t){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(t){this.lossRateWindowStats.push(t),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const e=this.lossRateWindowStats.length,n=["videoSend","audioSend","videoRecv","audioRecv"];let i=0,r=0,s=0,c=0;for(const l of n)t[l].forEach((d,h)=>{if(!this.lossRateWindowStats[e-1][l][h]||!this.lossRateWindowStats[0][l][h])return;const p=this.lossRateWindowStats[e-1][l][h].packets-this.lossRateWindowStats[0][l][h].packets,m=this.lossRateWindowStats[e-1][l][h].packetsLost-this.lossRateWindowStats[0][l][h].packetsLost;l==="videoSend"||l==="audioSend"?(i+=p,s+=m):(r+=p,c+=m),Number.isNaN(p)||Number.isNaN(p)?d.packetLostRate=0:d.packetLostRate=p<=0||m<=0?0:m/(p+m)});t.sendPacketLossRate=i<=0||s<=0?0:s/(i+s),t.recvPacketLossRate=r<=0||c<=0?0:c/(r+c)}},z6=class extends ZA{constructor(){super(...arguments),Xt(this,"_stats",Pg),Xt(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const t=await this._getStats(),e=this.statsResponsesToObjects(t);this._stats=Ds(Pg);const n=e.filter(r=>r.type==="ssrc");this.processSSRCStats(n);const i=e.find(r=>r.type==="VideoBwe");i&&this.processBandwidthStats(i),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(t){this._stats.bitrate={actualEncoded:Number(t.googActualEncBitrate),targetEncoded:Number(t.googTargetEncBitrate),retransmit:Number(t.googRetransmitBitrate),transmit:Number(t.googTransmitBitrate)},this._stats.sendBandwidth=Number(t.googAvailableSendBandwidth)}processSSRCStats(t){t.forEach(e=>{var n;const i=mt(n=e.id).call(n,"send");switch("".concat(e.mediaType,"_").concat(i?"send":"recv")){case"video_send":{const r=Ds(TL);r.codec=e.googCodecName,r.adaptionChangeReason="none",e.googCpuLimitedResolution&&(r.adaptionChangeReason="cpu"),e.googBandwidthLimitedResolution&&(r.adaptionChangeReason="bandwidth"),r.avgEncodeMs=Number(e.googAvgEncodeMs),r.inputFrame={width:Number(e.googFrameWidthInput)||Number(e.googFrameWidthSent),height:Number(e.googFrameHeightInput)||Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},r.sentFrame={width:Number(e.googFrameWidthSent),height:Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},r.firsCount=Number(e.googFirReceived),r.nacksCount=Number(e.googNacksReceived),r.plisCount=Number(e.googPlisReceived),r.frameCount=Number(e.framesEncoded),r.bytes=Number(e.bytesSent),r.packets=Number(e.packetsSent),r.packetsLost=Number(e.packetsLost),r.ssrc=Number(e.ssrc),r.rttMs=Number(e.googRtt||0),this._stats.videoSend.push(r),this._stats.rtt=r.rttMs;break}case"video_recv":{const r=Ds(SL),s=this.lastDecodeVideoReceiverStats.get(Number(e.ssrc));if(r.codec=e.googCodecName,r.targetDelayMs=Number(e.googTargetDelayMs),r.renderDelayMs=Number(e.googRenderDelayMs),r.currentDelayMs=Number(e.googCurrentDelayMs),r.minPlayoutDelayMs=Number(e.googMinPlayoutDelayMs),r.decodeMs=Number(e.googDecodeMs),r.maxDecodeMs=Number(e.googMaxDecodeMs),r.receivedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateReceived)},r.decodedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateDecoded)},r.decodeFrameRate=Number(e.googFrameRateDecoded),r.outputFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateOutput)},r.jitterBufferMs=Number(e.googJitterBufferMs),r.firsCount=Number(e.googFirsSent),r.nacksCount=Number(e.googNacksSent),r.plisCount=Number(e.googPlisSent),r.framesDecodeCount=Number(e.framesDecoded),r.bytes=Number(e.bytesReceived),r.packets=Number(e.packetsReceived),r.packetsLost=Number(e.packetsLost),r.ssrc=Number(e.ssrc),r.packets>0&&!this.isFirstVideoReceived[r.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(r.ssrc),this.isFirstVideoReceived[r.ssrc]=!0),r.framesDecodeCount>0&&!this.isFirstVideoDecoded[r.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(r.ssrc,r.decodedFrame.width,r.decodedFrame.height),this.isFirstVideoDecoded[r.ssrc]=!0),s){const c=s.stats,l=Date.now()-s.lts;r.framesDecodeFreezeTime=c.framesDecodeFreezeTime,r.framesDecodeInterval=c.framesDecodeInterval,r.framesDecodeCount>c.framesDecodeCount&&this.isFirstVideoDecoded[r.ssrc]?(s.lts=Date.now(),r.framesDecodeInterval=l,r.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc,10))?r.framesDecodeFreezeTime+=r.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):r.framesDecodeCount<s.stats.framesDecodeCount&&(r.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(r.ssrc,{stats:ut({},r),lts:Date.now()}),this._stats.videoRecv.push(r);break}case"audio_recv":{const r=Ds(RL);r.codec=e.googCodecName,r.outputLevel=Math.abs(Number(e.audioOutputLevel))/32767,r.decodingCNG=Number(e.googDecodingCNG),r.decodingCTN=Number(e.googDecodingCTN),r.decodingCTSG=Number(e.googDecodingCTSG),r.decodingNormal=Number(e.googDecodingNormal),r.decodingPLC=Number(e.googDecodingPLC),r.decodingPLCCNG=Number(e.googDecodingPLCCNG),r.expandRate=Number(e.googExpandRate),r.accelerateRate=Number(e.googAccelerateRate),r.preemptiveExpandRate=Number(e.googPreemptiveExpandRate),r.secondaryDecodedRate=Number(e.googSecondaryDecodedRate),r.speechExpandRate=Number(e.googSpeechExpandRate),r.preferredJitterBufferMs=Number(e.googPreferredJitterBufferMs),r.jitterBufferMs=Number(e.googJitterBufferMs),r.jitterMs=Number(e.googJitterReceived),r.bytes=Number(e.bytesReceived),r.packets=Number(e.packetsReceived),r.packetsLost=Number(e.packetsLost),r.ssrc=Number(e.ssrc),r.receivedFrames=Number(e.googDecodingCTN)||Number(e.packetsReceived),r.droppedFrames=Number(e.googDecodingPLC)+Number(e.googDecodingPLCCNG)||Number(e.packetsLost),r.receivedFrames>0&&!this.isFirstAudioReceived[r.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(r.ssrc),this.isFirstAudioReceived[r.ssrc]=!0),r.decodingNormal>0&&!this.isFirstAudioDecoded[r.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(r.ssrc),this.isFirstAudioDecoded[r.ssrc]=!0),this._stats.audioRecv.push(r);break}case"audio_send":{const r=Ds(yL);r.codec=e.googCodecName,r.inputLevel=Math.abs(Number(e.audioInputLevel))/32767,r.aecReturnLoss=Number(e.googEchoCancellationReturnLoss||0),r.aecReturnLossEnhancement=Number(e.googEchoCancellationReturnLossEnhancement||0),r.residualEchoLikelihood=Number(e.googResidualEchoLikelihood||0),r.residualEchoLikelihoodRecentMax=Number(e.googResidualEchoLikelihoodRecentMax||0),r.bytes=Number(e.bytesSent),r.packets=Number(e.packetsSent),r.packetsLost=Number(e.packetsLost),r.ssrc=Number(e.ssrc),r.rttMs=Number(e.googRtt||0),this._stats.rtt=r.rttMs,this._stats.audioSend.push(r);break}}})}_getStats(){return new Tt((t,e)=>{this.pc.getStats(t,e)})}statsResponsesToObjects(t){const e=[];return t.result().forEach(n=>{const i={id:n.id,timestamp:n.timestamp.valueOf().toString(),type:n.type};n.names().forEach(r=>{i[r]=n.stat(r)}),e.push(i)}),e}},kg=function(t){return t.BANDWIDTH="bandwidth",t.CPU="cpu",t.NONE="none",t.OTHER="other",t}({}),cR=function(t){return t.L1T1="L1T1",t.L1T2="L1T2",t.L1T3="L1T3",t.L1T3_KEY="L1T3_KEY",t.L2T1_KEY="L2T1_KEY",t.L2T2_KEY="L2T2_KEY",t.L2T3_KEY="L2T3_KEY",t.L3T1_KEY="L3T1_KEY",t.L3T2_KEY="L3T2_KEY",t.L3T3_KEY="L3T3_KEY",t}({}),$A=function(t){return t[t.new=0]="new",t[t.connecting=1]="connecting",t[t.connected=2]="connected",t[t.disconnected=3]="disconnected",t[t.failed=4]="failed",t[t.closed=5]="closed",t}({}),Aa=function(t){return t.CERTIFICATE="certificate",t.CODEC="codec",t.CANDIDATE_PAIR="candidate-pair",t.LOCAL_CANDIDATE="local-candidate",t.REMOTE_CANDIDATE="remote-candidate",t.INBOUND="inbound-rtp",t.TRACK="track",t.OUTBOUND="outbound-rtp",t.PC="peer-connection",t.REMOTE_INBOUND="remote-inbound-rtp",t.REMOTE_OUTBOUND="remote-outbound-rtp",t.TRANSPORT="transport",t.CSRC="csrc",t.DATA_CHANNEL="data-channel",t.STREAM="stream",t.SENDER="sender",t.RECEIVER="receiver",t}({});var lm=function(t){return t[t.kNone=1]="kNone",t[t.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",t[t.kBytesToBits=8]="kBytesToBits",t}(lm||{});function Lg(t,e,n,i){let r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:lm.kNone;if(!e)return;const s=Number(e[n]);if(typeof s!="number")return;const c=Number(e[i]);if(typeof c!="number")return;if(!t)return c?s/c*r:void 0;const l=Number(t[n]);if(typeof l!="number")return;const d=Number(t[i]);if(typeof d!="number")return;const h=c-d;return h?(s-l)/h*r:void 0}let bL=class extends ZA{constructor(){super(...arguments),Xt(this,"_stats",Pg),Xt(this,"report",void 0),Xt(this,"lastDecodeVideoReceiverStats",new Map),Xt(this,"lastVideoFramesRecv",new Map),Xt(this,"lastVideoFramesSent",new Map),Xt(this,"lastVideoFramesDecode",new Map),Xt(this,"lastVideoFramesOutput",new Map),Xt(this,"lastVideoJBDelay",new Map),Xt(this,"lastAudioJBDelay",new Map),Xt(this,"mediaBytesSent",new Map),Xt(this,"mediaBytesRetransmit",new Map),Xt(this,"mediaBytesTargetEncode",new Map),Xt(this,"lastDecodeAudioReceiverStats",new Map),Xt(this,"lastAudioConcealment",new Map),Xt(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=Ds(Pg),this.report.forEach(t=>{switch(t.type){case Aa.OUTBOUND:case Aa.INBOUND:{const e=t.mediaType||t.kind,n=!e&&"frameWidth"in t,i=!e&&!("frameWidth"in t);t.type===Aa.OUTBOUND?e==="audio"||i?this.processAudioOutboundStats(t):(e==="video"||n)&&this.processVideoOutboundStats(t):t.type===Aa.INBOUND&&(e==="audio"||i?this.processAudioInboundStats(t):(e==="video"||n)&&this.processVideoInboundStats(t));break}case Aa.TRANSPORT:{const e=this.report.get(t.selectedCandidatePairId);e&&this.processCandidatePairStats(e);break}case Aa.CANDIDATE_PAIR:t.selected&&this.processCandidatePairStats(t)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const t=await this.pc.getStats(),e={local:ut({},vc),remote:ut({},vc)};return t.forEach(n=>{let i;if(n.type===Aa.TRANSPORT&&(i=t.get(n.selectedCandidatePairId)),n.type===Aa.CANDIDATE_PAIR&&n.selected&&(i=n),i){const r=(s,c)=>{s.type=c.type,s.id=c.id,c.address&&(s.address=c.address),c.candidateType&&(s.candidateType=c.candidateType),c.port&&(s.port=c.port),c.priority&&(s.priority=c.priority),c.protocol&&(s.protocol=c.protocol),c.relayProtocol&&(s.relayProtocol=c.relayProtocol)};if(i.localCandidateId){const s=t.get(i.localCandidateId);s&&r(e.local,s)}if(i.remoteCandidateId){const s=t.get(i.remoteCandidateId);s&&r(e.remote,s)}}}),e}processCandidatePairStats(t){if(this._stats.sendBandwidth=t.availableOutgoingBitrate||0,t.currentRoundTripTime&&(this._stats.rtt=1e3*t.currentRoundTripTime),this._stats.videoSend.forEach(e=>{t.currentRoundTripTime&&(e.rttMs=1e3*t.currentRoundTripTime)}),this._stats.audioSend.forEach(e=>{t.currentRoundTripTime&&(e.rttMs=1e3*t.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=t.id,t.localCandidateId){const e=this.report.get(t.localCandidateId);e&&this.processCandidateStats(e)}if(t.remoteCandidateId){const e=this.report.get(t.remoteCandidateId);e&&this.processCandidateStats(e)}}processCandidateStats(t){let e;t.type===Aa.LOCAL_CANDIDATE&&(e=this._stats.selectedCandidatePair.localCandidate),t.type===Aa.REMOTE_CANDIDATE&&(e=this._stats.selectedCandidatePair.remoteCandidate),e&&(e.type=t.type,e.id=t.id,t.address&&(e.address=t.address),t.candidateType&&(e.candidateType=t.candidateType),t.port&&(e.port=t.port),t.priority&&(e.priority=t.priority),t.protocol&&(e.protocol=t.protocol),t.relayProtocol&&(e.relayProtocol=t.relayProtocol),t.type===Aa.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==e.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(ut({},e),ut({},this.stats.selectedCandidatePair.localCandidate)),t.type===Aa.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==e.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(ut({},e),ut({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(t){let e=this._stats.audioRecv.find(i=>i.ssrc===t.ssrc);e||(e=Ds(RL),this._stats.audioRecv.push(e)),e.ssrc=t.ssrc,e.packets=t.packetsReceived,e.packetsLost=t.packetsLost,e.packetsDiscarded=t.packetsDiscarded,e.bytes=t.bytesReceived,e.jitterMs=1e3*t.jitter,e.retransmittedBytesReceived=t.retransmittedBytesReceived,e.retransmittedPacketsReceived=t.retransmittedPacketsReceived,e.totalProcessingDelay=t.totalProcessingDelay,e.jitterBufferEmittedCount=t.jitterBufferEmittedCount;const n=this.lastDecodeAudioReceiverStats.get(e.ssrc);e.avgProcessingDelayMs=Lg(n,e,"totalProcessingDelay","jitterBufferEmittedCount",lm.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(t,t.trackId,e),this.calculateAudioFreeze(e,n,t),t.codecId&&(e.codec=this.getCodecFromCodecStats(t.codecId)),e.receivedFrames||(e.receivedFrames=t.packetsReceived),e.droppedFrames||(e.droppedFrames=t.packetsLost),e.receivedFrames>0&&!this.isFirstAudioReceived[e.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(e.ssrc),this.isFirstAudioReceived[e.ssrc]=!0),e.outputLevel&&e.outputLevel>0&&!this.isFirstAudioDecoded[e.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(e.ssrc),this.isFirstAudioDecoded[e.ssrc]=!0),typeof t.concealedSamples=="number"&&(e.concealedSamples=t.concealedSamples),this.lastDecodeAudioReceiverStats.set(e.ssrc,ut({},e))}calculateAudioFreeze(t,e,n){const i=this.lastAudioConcealment.get(t.ssrc);if(e!=null&&i!=null){const r=i.lts,s=n.timestamp,c=s-r;if(c<=0)return;const l=t.concealedSamples-e.concealedSamples-0,d=i.nonSilent+l,h=t.totalSamplesReceived-e.totalSamplesReceived;if(h<=0)return;const p=80*h/c,m=200*h/c,_=c/h;let E=0;t.freezeSamples80=e.freezeSamples80,t.freezeMs80=e.freezeMs80,d>p&&(i.plc80>0?(t.freezeSamples80+=l,t.freezeMs80+=Math.round(l*_)):(t.freezeSamples80+=d,t.freezeMs80+=Math.round(d*_)),E=i.plc80+1);let I=0;t.freezeSamples200=e.freezeSamples200,t.freezeMs200=e.freezeMs200,d>m&&(i.plc200>0?(t.freezeSamples200+=l,t.freezeMs200+=Math.round(l*_)):(t.freezeSamples200+=d,t.freezeMs200+=Math.round(d*_)),I=i.plc200+1),this.lastAudioConcealment.set(t.ssrc,{nonSilent:l,lts:s,plc80:E,plc200:I})}else t.freezeSamples80=0,t.freezeSamples200=0,t.freezeMs80=0,t.freezeMs200=0,this.lastAudioConcealment.set(t.ssrc,{nonSilent:0,lts:n.timestamp,plc80:0,plc200:0})}processVideoInboundStats(t){let e=this._stats.videoRecv.find(c=>c.ssrc===t.ssrc);e||(e=Ds(SL),this._stats.videoRecv.push(e)),e.ssrc=t.ssrc,e.packets=t.packetsReceived,e.packetsLost=t.packetsLost,e.bytes=t.bytesReceived,e.firsCount=t.firCount,e.nacksCount=t.nackCount,e.plisCount=t.pliCount,e.framesDecodeCount=t.framesDecoded,e.framesDroppedCount=t.framesDropped,e.totalInterFrameDelay=t.totalInterFrameDelay,e.totalSquaredInterFrameDelay=t.totalSquaredInterFrameDelay,e.totalFreezesDuration=t.totalFreezesDuration,e.totalProcessingDelay=t.totalProcessingDelay,e.packetsDiscarded=t.packetsDiscarded,e.framesAssembledFromMultiplePackets=t.framesAssembledFromMultiplePackets,e.totalAssemblyTime=t.totalAssemblyTime,e.keyFramesDecoded=t.keyFramesDecoded,e.retransmittedBytesReceived=t.retransmittedBytesReceived,e.retransmittedPacketsReceived=t.retransmittedPacketsReceived;const n=this.lastDecodeVideoReceiverStats.get(e.ssrc),i=this.lastVideoFramesDecode.get(e.ssrc),r=this.lastVideoFramesOutput.get(e.ssrc),s=Date.now();if(e.framesDecodeCount>0&&!this.isFirstVideoDecoded[e.ssrc]){const c=e.decodedFrame?e.decodedFrame.width:0,l=e.decodedFrame?e.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(e.ssrc,c,l),this.isFirstVideoDecoded[e.ssrc]=!0}if(n){const c=n.stats,l=s-n.lts;e.framesDecodeFreezeTime=c.framesDecodeFreezeTime,e.framesDecodeInterval=c.framesDecodeInterval,!this.isFirstVideoDecoded[e.ssrc]&&l>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[e.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(e.ssrc),this.isFirstVideoDecodedTimeout[e.ssrc]=!0),e.framesDecodeCount>c.framesDecodeCount&&this.isFirstVideoDecoded[e.ssrc]?(n.lts=Date.now(),e.framesDecodeInterval=l,e.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc))?e.framesDecodeFreezeTime+=e.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):e.framesDecodeCount<c.framesDecodeCount&&(e.framesDecodeInterval=0),t.framesDecoded&&t.qpSum&&(n.stats.framesDecodeCount>t.framesDecoded?e.qpSumPerFrame=t.qpSum/t.framesDecoded:e.qpSumPerFrame=(t.qpSum-n.qpSum)/(t.framesDecoded-n.stats.framesDecodeCount))}t.totalDecodeTime&&(e.decodeMs=1e3*t.totalDecodeTime,e.avgDecodeMs=Lg(n==null?void 0:n.stats,e,"decodeMs","framesDecodeCount")),e.avgProcessingDelayMs=Lg(n==null?void 0:n.stats,e,"totalProcessingDelay","framesDecodeCount",lm.kMillisecondsFromSeconds),e.avgFramesAssembledFromMultiplePacketsMs=Lg(n==null?void 0:n.stats,e,"totalAssemblyTime","framesAssembledFromMultiplePackets",lm.kMillisecondsFromSeconds),e.avgInterFrameDelayMs=Lg(n==null?void 0:n.stats,e,"totalInterFrameDelay","framesDecodeCount",lm.kMillisecondsFromSeconds),i&&s-i.lts>=800?(e.decodeFrameRate=Math.round((e.framesDecodeCount-i.count)/((s-i.lts)/1e3)),this.lastVideoFramesDecode.set(e.ssrc,{count:e.framesDecodeCount,lts:s,rate:e.decodeFrameRate})):i?e.decodeFrameRate=i.rate:this.lastVideoFramesDecode.set(e.ssrc,{count:e.framesDecodeCount,lts:s,rate:0}),e.framesDroppedCount&&t.framesReceived&&(r&&s-r.lts>=800?(e.outputFrameRate=Math.round((t.framesReceived-e.framesDroppedCount-r.count)/((s-r.lts)/1e3)),this.lastVideoFramesOutput.set(e.ssrc,{count:t.framesReceived-e.framesDroppedCount,lts:s,rate:Math.max(e.outputFrameRate,0)})):r?e.outputFrameRate=r.rate:this.lastVideoFramesOutput.set(e.ssrc,{count:t.framesReceived-e.framesDroppedCount,lts:s,rate:0})),this.processVideoTrackReceiverStats(t,t.trackId,e),t.codecId&&(e.codec=this.getCodecFromCodecStats(t.codecId)),t.framerateMean&&(e.framesRateFirefox=t.framerateMean),e.packets>0&&!this.isFirstVideoReceived[e.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(e.ssrc),this.isFirstVideoReceived[e.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(e.ssrc,{stats:ut({},e),lts:n?n.lts:Date.now(),qpSum:t.qpSum})}processVideoOutboundStats(t){let e=this._stats.videoSend.find(i=>i.ssrc===t.ssrc);e||(e=Ds(TL),this._stats.videoSend.push(e));const n=this.mediaBytesSent.get(t.ssrc);if(n)n.add(t.bytesSent);else{const i=new JA(10);i.add(t.bytesSent),this.mediaBytesSent.set(t.ssrc,i)}if(t.retransmittedBytesSent!==void 0){const i=this.mediaBytesRetransmit.get(t.ssrc);if(i)i.add(t.retransmittedBytesSent);else{const r=new JA(10);r.add(t.retransmittedBytesSent),this.mediaBytesRetransmit.set(t.ssrc,r)}}if(t.totalEncodedBytesTarget){const i=this.mediaBytesTargetEncode.get(t.ssrc);if(i)i.add(t.totalEncodedBytesTarget);else{const r=new JA(10);r.add(t.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(t.ssrc,r)}}if(e.ssrc=t.ssrc,e.bytes=t.bytesSent,e.packets=t.packetsSent,e.firsCount=t.firCount,e.nacksCount=t.nackCount,e.plisCount=t.pliCount,e.frameCount=t.framesEncoded,e.adaptionChangeReason=t.qualityLimitationReason,e.scalabilityMode=t.scalabilityMode,e.retransmittedBytesSent=t.retransmittedBytesSent,e.retransmittedPacketsSent=t.retransmittedPacketsSent,e.hugeFramesSent=t.hugeFramesSent,e.keyFramesEncoded=t.keyFramesEncoded,e.targetBitrate=t.targetBitrate,t.totalEncodeTime&&t.framesEncoded){const i=this.lastEncoderMs.get(t.ssrc);if(!i||i.lastFrameCount>t.framesEncoded)e.avgEncodeMs=1e3*t.totalEncodeTime/t.framesEncoded;else{const r=t.framesEncoded-i.lastFrameCount,s=t.totalEncodeTime-i.lastEncoderTime;e.avgEncodeMs=1e3*s/r}}if(t.framesEncoded&&t.qpSum){const i=this.lastEncoderMs.get(t.ssrc);!i||i.lastFrameCount>t.framesEncoded?e.qpSumPerFrame=t.qpSum/t.framesEncoded:e.qpSumPerFrame=(t.qpSum-i.lastQpSum)/(t.framesEncoded-i.lastFrameCount)}if(this.lastEncoderMs.set(t.ssrc,{lastFrameCount:t.framesEncoded,lastEncoderTime:t.totalEncodeTime,lastQpSum:t.qpSum,lts:Date.now()}),t.codecId&&(e.codec=this.getCodecFromCodecStats(t.codecId)),t.mediaSourceId&&this.processVideoMediaSource(t.mediaSourceId,e),this.processVideoTrackSenderStats(t,t.trackId,e),t.remoteId)this.processRemoteInboundStats(t.remoteId,e);else{const i=this.findRemoteStatsId(t.ssrc,Aa.REMOTE_INBOUND);i&&this.processRemoteInboundStats(i,e)}}processAudioOutboundStats(t){let e=this._stats.audioSend.find(n=>n.ssrc===t.ssrc);if(e||(e=Ds(yL),this._stats.audioSend.push(e)),e.ssrc=t.ssrc,e.packets=t.packetsSent,e.bytes=t.bytesSent,e.retransmittedBytesSent=t.retransmittedBytesSent,e.retransmittedPacketsSent=t.retransmittedPacketsSent,t.mediaSourceId&&this.processAudioMediaSource(t.mediaSourceId,e),t.codecId&&(e.codec=this.getCodecFromCodecStats(t.codecId)),this.processAudioTrackSenderStats(t,t.trackId,e),t.remoteId)this.processRemoteInboundStats(t.remoteId,e);else{const n=this.findRemoteStatsId(t.ssrc,Aa.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,e)}}findRemoteStatsId(t,e){var n;const i=Array.from(wr(n=this.report).call(n)).find(r=>r.type===e&&r.ssrc===t);return i?i.id:null}processVideoMediaSource(t,e){const n=this.report.get(t);n&&n.width&&n.height&&n.framesPerSecond&&(e.inputFrame={width:n.width,height:n.height,frameRate:n.framesPerSecond})}processAudioMediaSource(t,e){const n=this.report.get(t);n&&(e.inputLevel=n.audioLevel)}processVideoTrackSenderStats(t,e,n){var i,r,s,c;const l=e?this.report.get(e):void 0,d=(i=l==null?void 0:l.framesSent)!==null&&i!==void 0?i:t.framesSent;if(typeof d!="number")return;let h=(r=l==null?void 0:l.frameWidth)!==null&&r!==void 0?r:t.frameWidth,p=(s=l==null?void 0:l.frameHeight)!==null&&s!==void 0?s:t.frameHeight,m=(c=l==null?void 0:l.framesPerSecond)!==null&&c!==void 0?c:t.framesPerSecond;if(typeof h=="number"&&typeof p=="number"||(h=0,p=0),m==null){const _=Date.now(),E=this.lastVideoFramesSent.get(n.ssrc);E&&_-E.lts>=800?(m=Math.round((d-E.count)/((_-E.lts)/1e3)),this.lastVideoFramesSent.set(n.ssrc,{count:d,lts:_,rate:m})):E?m=E.rate:this.lastVideoFramesSent.set(n.ssrc,{count:d,lts:_,rate:0})}n.sentFrame={width:h,height:p,frameRate:Math.max(0,m)}}processVideoTrackReceiverStats(t,e,n){var i,r,s,c,l;const d=e?this.report.get(e):void 0,h=(i=d==null?void 0:d.framesReceived)!==null&&i!==void 0?i:t.framesReceived,p=(r=d==null?void 0:d.frameWidth)!==null&&r!==void 0?r:t.frameWidth,m=(s=d==null?void 0:d.frameHeight)!==null&&s!==void 0?s:t.frameHeight,_=(c=d==null?void 0:d.jitterBufferDelay)!==null&&c!==void 0?c:t.jitterBufferDelay,E=(l=d==null?void 0:d.jitterBufferEmittedCount)!==null&&l!==void 0?l:t.jitterBufferEmittedCount;if(typeof h=="number"){const I=this.lastVideoFramesRecv.get(n.ssrc),C=Date.now();n.framesReceivedCount=h;let w=0;I&&C-I.lts>=800?(w=Math.round((h-I.count)/((C-I.lts)/1e3)),this.lastVideoFramesRecv.set(n.ssrc,{count:h,lts:C,rate:w})):I?w=I.rate:this.lastVideoFramesRecv.set(n.ssrc,{count:h,lts:C,rate:0}),n.receivedFrame={width:p||0,height:m||0,frameRate:w||0},n.decodedFrame={width:p||0,height:m||0,frameRate:n.decodeFrameRate||0},n.outputFrame={width:p||0,height:m||0,frameRate:n.outputFrameRate||n.decodeFrameRate||0}}if(_&&E){const I=this.lastVideoJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let C=I.jitterBufferMs;const w=E-I.jitterBufferEmittedCount;w>0&&(C=1e3*(_-I.jitterBufferDelay)/w),n.jitterBufferMs=C,n.currentDelayMs=Math.round(C),this.lastVideoJBDelay.set(n.ssrc,{jitterBufferDelay:_,jitterBufferEmittedCount:E,jitterBufferMs:n.currentDelayMs})}}processAudioTrackSenderStats(t,e,n){var i,r,s,c;const l=e?this.report.get(e):void 0,d=(i=(r=l==null?void 0:l.echoReturnLoss)!==null&&r!==void 0?r:t.echoReturnLoss)!==null&&i!==void 0?i:0,h=(s=(c=l==null?void 0:l.echoReturnLossEnhancement)!==null&&c!==void 0?c:t.echoReturnLossEnhancement)!==null&&s!==void 0?s:0;n.aecReturnLoss=d,n.aecReturnLossEnhancement=h}processAudioTrackReceiverStats(t,e,n){var i,r,s,c,l,d,h,p,m;const _=e?this.report.get(e):void 0,E=(i=_==null?void 0:_.removedSamplesForAcceleration)!==null&&i!==void 0?i:t.removedSamplesForAcceleration,I=(r=_==null?void 0:_.totalSamplesReceived)!==null&&r!==void 0?r:t.totalSamplesReceived,C=(s=_==null?void 0:_.jitterBufferDelay)!==null&&s!==void 0?s:t.jitterBufferDelay,w=(c=_==null?void 0:_.jitterBufferEmittedCount)!==null&&c!==void 0?c:t.jitterBufferEmittedCount,D=(l=_==null?void 0:_.audioLevel)!==null&&l!==void 0?l:t==null?void 0:t.audioLevel,N=(d=_==null?void 0:_.totalSamplesDuration)!==null&&d!==void 0?d:t==null?void 0:t.totalSamplesDuration,L=(h=_==null?void 0:_.concealedSamples)!==null&&h!==void 0?h:t.concealedSamples,W=(p=_==null?void 0:_.silentConcealedSamples)!==null&&p!==void 0?p:t.silentConcealedSamples,G=(m=_==null?void 0:_.concealmentEvents)!==null&&m!==void 0?m:t.concealmentEvents;if(typeof I=="number"&&(n.totalSamplesReceived=I),typeof W=="number"&&(n.silentConcealedSamples=W),typeof G=="number"&&(n.concealmentEvents=G),typeof L=="number"&&(n.concealedSamples=L),E&&I&&(n.accelerateRate=E/I),C&&w){const z=this.lastAudioJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let $=z.jitterBufferMs;const rt=w-z.jitterBufferEmittedCount;rt>0&&($=1e3*(C-z.jitterBufferDelay)/rt),n.jitterBufferMs=Math.round($),this.lastAudioJBDelay.set(n.ssrc,{jitterBufferDelay:C,jitterBufferEmittedCount:w,jitterBufferMs:n.jitterBufferMs})}n.outputLevel=D;let U=1920;N&&I&&(U=I/N/50,n.receivedFrames=Math.round(I/U)),L&&(n.droppedFrames=Math.round(L/U))}processRemoteInboundStats(t,e){const n=this.report.get(t);n&&(e.packetsLost=n.packetsLost,n.roundTripTime&&(e.rttMs=1e3*n.roundTripTime),n.jitter&&(e.jitterMs=1e3*n.jitter),n.timestamp&&(e.timestamp=n.timestamp))}getCodecFromCodecStats(t){const e=this.report.get(t);if(!e)return"";const n=e.mimeType.match(/\/(.*)$/);return n&&n[1]?n[1]:""}updateSendBitrate(){let t=0,e=null,n=null;this.mediaBytesSent.forEach(r=>{t+=r.diffMean()}),this.mediaBytesRetransmit.forEach(r=>{e=e===null?r.diffMean():e+r.diffMean()}),this.mediaBytesTargetEncode.forEach(r=>{n=n===null?r.diffMean():n+r.diffMean()});const i=e!==null?t-e:t;this._stats.bitrate={actualEncoded:8*i/(this.options.updateInterval/1e3),transmit:8*t/(this.options.updateInterval/1e3)},e!==null&&(this._stats.bitrate.retransmit=8*e/(this.options.updateInterval/1e3)),n!==null&&(this._stats.bitrate.targetEncoded=8*n/(this.options.updateInterval/1e3))}},q6=class extends ZA{updateStats(){return Tt.resolve()}};function tw(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const s=function(){const c=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return c&&c[0]?Number(c[0].split("/")[1]):null}();return s?s<76?new z6(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:r}):new bL(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:r}):function(c){if(!window.RTCStatsReport)return!1;const l=c.getStats();return!!(l instanceof Tt||function(d){return!!d&&(typeof d=="object"||typeof d=="function")&&typeof d.then=="function"}(l))}(t)?new bL(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:r}):new q6(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:r})}const CL="websdk_ng_install_id";function ew(){try{if(k("INSTALL_ID"))return k("INSTALL_ID");let t=window.localStorage.getItem(CL);return t||(t=Lh(),window.localStorage.setItem(CL,t)),Fe("INSTALL_ID",t),t}catch{return}}const $a=function(t){if(t.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return t;const e=t.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(e&&e[1]&&e[2]){const n=e[1],i=e[2];return"".concat(n,".").concat(i)}return"4.0.0.999"}("4.24.0"),nw=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let xh=function(t){return t.Default="default",t.Auto="auto",t.Relay="relay",t.SdRtn="sd-rtn",t}({});const Li=function(){const t="us".concat("erna","me"),e="pa".concat("sswo","rd"),n=["t","s","t"];n.splice(1,0,"e");const i=n.join(""),r=[];for(let l=0;l<6;l++)r.push("1");const s=r.join(""),c={};return c[t]=i,c[e]=s,Object.assign(c,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=Li;const lR={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!0,FORCE_ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:1,ENABLE_AUT_FEEDBACK:!0,SVC_EXTENDED:["VP9"]},iw={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},rw="v4.24.0-0-gf2267710-dirty(7/31/2025, 7:00:42 PM)",aw={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!0,NEW_TURN_MODE:4,NEW_FORCE_TURN:!1,USE_NEW_RENDER_FREEZE_TIME:!1,ENCODE_EXCEPTION_TIMES:5,ENABLE_ENCODE_EXCEPTION:!0,ENCODE_EXCEPTION_VALIDATE_CODEC:["h264"],VIDEO_ENCODER_CONFIG_LIST:[{width:240,height:180},{width:320,height:240},{width:400,height:300},{width:480,height:360},{width:560,height:420},{width:640,height:480}],DELETE_NEQ_AFTER_USER_LEAVE:!0},hn=ut(ut(ut(ut({},aw),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ENABLE_AUDIO_RED:!1,OPUS_PTIME:void 0,AUDIO_DUPLICATE_NUM:void 0,ENABLE_ABSSENDTIME_AS_SENTTS:!0,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],UNSUPPORTED_VIDEO_UPLINK_CODEC:[],UNSUPPORTED_VIDEO_DOWNLINK_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:iw,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},lR),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1,ENABLE_PRE_RENDER:!1,FORCE_DISABLE_AUTO_SUB:!1,ENABLE_PRE_SUB_WITH_PRE_PC:!1,PRE_USE_LOCAL_CODECS:!0},{INSTALL_ID:""}),{},{K_MIN_RENDER_DELAY:66,USE_STANDARD_BITRATE_DEFAULT:!1,VIDEO_NEW_BITRATE_RATIO:void 0,VIDEO_STANDARD_BITRATE_VERSION:2,BASELINE_MORE_H264_BITRATE_RATIO:1.1});function Fe(t,e,n){var i,r,s;mt(i=Object.keys(hn)).call(i,t)&&(!n&&mt(r=Object.keys(bo)).call(r,t)||(hn[t]=e,t!=="ENABLE_VIDEO_SEI"&&t!=="ENABLE_AUDIO_TOPN"&&t!=="ENABLE_AUDIO_METADATA"&&t!=="ENABLE_AUDIO_PTS"||e!==!0||(hn.ENABLE_ENCODED_TRANSFORM=!0),t==="USE_NEW_NETWORK_CONFIG"&&e&&(s=!!e,hn.USE_NEW_NETWORK_CONFIG=s,s&&(hn.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],hn.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],hn.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],hn.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],hn.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",hn.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",hn.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),t==="ENABLE_PRE_SUB"&&e&&(hn.ENABLE_INSTANT_VIDEO=!0,hn.ENABLE_PREALLOC_PC=!0),t==="ENABLE_SVC"&&e&&(hn.ENABLE_AUT_CC=!0),t==="NEW_FORCE_TURN"&&e&&(hn.NEW_TURN_MODE||(hn.NEW_TURN_MODE=4))))}function k(t){return hn[t]}nw||(hn.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],hn.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],hn.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],hn.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],hn.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],hn.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],hn.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",hn.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",hn.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",hn.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",hn.AREAS=["NORTH_AMERICA","OVERSEA"]);let AL=function(t){return t[t.REALTIME=1]="REALTIME",t}({});const bo={};var Qt=function(t){return t.SET_SESSION_ID="SET_SESSION_ID",t.SET_P2P_ID="SET_P2P_id",t.SET_DC_ID="SET_DC_id",t.SET_UID="SET_UID",t.SET_INT_UID="SET_INT_UID",t.SET_PUB_ID="SET_PUB_ID",t.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",t.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",t.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",t.KEY_METRIC_PRELOAD_START="KEY_METRIC_PRELOAD_START",t.KEY_METRIC_PRELOAD_END="KEY_METRIC_PRELOAD_END",t.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",t.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",t.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",t.KEY_METRIC_REQUEST_SUA_END="KEY_METRIC_REQUEST_SUA_END",t.KEY_METRIC_BEFORE_CONNECT="KEY_METRIC_BEFORE_CONNECT",t.KEY_METRIC_PEER_RECEIVER="KEY_METRIC_PEER_RECEIVER",t.KEY_METRIC_SIGNAL_CONNECTED="KEY_METRIC_SIGNAL_CONNECTED",t.KEY_METRIC_JOIN_REQ="KEY_METRIC_JOIN_REQ",t.KEY_METRIC_JOIN_REP="KEY_METRIC_JOIN_REP",t.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",t.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",t.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",t.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",t.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED="KEY_METRIC_FIRST_VIDEO_FRAME_DECODED",t.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",t.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",t.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",t.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",t.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",t.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",t.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",t.RESET_KEY_METRICS="RESET_KEY_METRICS",t.RESET_FIRST_VIDEO_FRAME_DECODED="RESET_FIRST_VIDEO_FRAME_DECODED",t.SET_USE_P2P="SET_USE_P2P",t.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",t}(Qt||{});let xg=function(t){return t.h264="h264",t.h265="h265",t.vp8="vp8",t.vp9="vp9",t.av1="av1",t}({});(function(t){t.opus="opus",t.pcma="pcma",t.pcmu="pcmu",t.g722="g722"})({});const wL=128,K6=96,IL=1e3,dm=10;let Y6=0;var OL=(()=>{var t={8:(i,r,s)=>{s.r(r),s.d(r,{Parser:()=>rt,Printer:()=>ke,parse:()=>ft,print:()=>wt});const c=`
`,l="".concat("\r").concat(c),d=" ";let h;function p(at){return at>="0"&&at<="9"}function m(at){return at>="!"&&at<="~"}function _(at){return m(at)||at>=""&&at<="ÿ"}function E(at){return at==="!"||at>="#"&&at<="'"||at>="*"&&at<="+"||at>="-"&&at<="."||at>="0"&&at<="9"||at>="A"&&at<="Z"||at>="^"&&at<="~"}function I(at){return at>="1"&&at<="9"}function C(at){return at>="A"&&at<="Z"||at>="a"&&at<="z"}function w(at){return at==="d"||at==="h"||at==="m"||at==="s"}function D(at){return at>""&&at<"	"||at>"\v"&&at<"\f"||at>""&&at<"ÿ"}function N(at){return C(at)||p(at)||at==="+"||at==="/"}function L(at){return p(at)||C(at)||at==="+"||at==="/"||at==="-"||at==="_"}function W(at){return C(at)||p(at)||at==="+"||at==="/"}function G(at,b){var M=Object.keys(at);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(at);b&&(F=F.filter(function(pt){return Object.getOwnPropertyDescriptor(at,pt).enumerable})),M.push.apply(M,F)}return M}function U(at){for(var b=1;b<arguments.length;b++){var M=arguments[b]!=null?arguments[b]:{};b%2?G(Object(M),!0).forEach(function(F){z(at,F,M[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(at,Object.getOwnPropertyDescriptors(M)):G(Object(M)).forEach(function(F){Object.defineProperty(at,F,Object.getOwnPropertyDescriptor(M,F))})}return at}function z(at,b,M){return b in at?Object.defineProperty(at,b,{value:M,enumerable:!0,configurable:!0,writable:!0}):at[b]=M,at}(function(at){at.VERSION="v",at.ORIGIN="o",at.SESSION_NAME="s",at.INFORMATION="i",at.URI="u",at.EMAIL="e",at.PHONE="p",at.CONNECTION="c",at.BANDWIDTH="b",at.TIME="t",at.REPEAT="r",at.ZONE_ADJUSTMENTS="z",at.KEY="k",at.ATTRIBUTE="a",at.MEDIA="m"})(h||(h={}));class ${consumeText(b,M){let F=M;for(;F<b.length;){const pt=b[F];if(pt==="\0"||pt==="\r"||pt===c)break;F+=1}if(F-M==0)throw new Error("Invalid text, at ".concat(b));return F}consumeUnicastAddress(b,M,F){return this.consumeTill(b,M,d)}consumeOneOrMore(b,M,F){let pt=M;for(;F(b[pt]);)pt++;if(pt-M==0)throw new Error("Invalid rule at ".concat(M,"."));return pt}consumeSpace(b,M){if(b[M]===d)return M+1;throw new Error("Invalid space at ".concat(M,"."))}consumeIP4Address(b,M){let F=M;for(let pt=0;pt<4;pt++)if(F=this.consumeDecimalUChar(b,F),pt!==3){if(b[F]!==".")throw new Error("Invalid IP4 address.");F++}return F}consumeDecimalUChar(b,M){let F=M;for(let $t=0;$t<3&&p(b[F]);$t++,F++);if(F-M==0)throw new Error("Invalid decimal uchar.");const pt=parseInt(b.slice(M,F));if(pt>=0&&pt<=255)return F;throw new Error("Invalid decimal uchar")}consumeIP6Address(b,M){let F=this.consumeHexpart(b,M);return b[F]===":"&&(F+=1,F=this.consumeIP4Address(b,F)),F}consumeHexpart(b,M){let F=M;if(b[F]===":"&&b[F+1]===":"){F+=2;try{F=this.consumeHexseq(b,F)}catch{}return F}if(F=this.consumeHexseq(b,F),b[F]===":"&&b[F+1]===":"){F+=2;try{F=this.consumeHexseq(b,F)}catch{}return F}return F}consumeHexseq(b,M){let F=M;for(;F=this.consumeHex4(b,F),b[F]===":"&&b[F+1]!==":";)F+=1;return F}consumeHex4(b,M){let F=0;for(;F<4;F++)if(!((pt=b[M+F])>="0"&&pt<="9"||pt>="a"&&pt<="f"||pt>="A"&&pt<="F")){if(F===0)throw new Error("Invalid hex 4");break}var pt;return M+F}consumeFQDN(b,M){let F=M;for(;p(b[F])||C(b[F])||b[F]==="-"||b[F]===".";)F+=1;if(F-M<4)throw new Error("Invalid FQDN");return F}consumeExtnAddr(b,M){return this.consumeOneOrMore(b,M,_)}consumeMulticastAddress(b,M,F){switch(F){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(b,M);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(b,M);default:try{return this.consumeFQDN(b,M)}catch{return this.consumeExtnAddr(b,M)}}}consumeIP6MulticastAddress(b,M){const F=this.consumeHexpart(b,M);return b[F]==="/"?this.consumeInteger(b,F+1):F}consumeIP4MulticastAddress(b,M){let F=M+3;const pt=b.slice(M,F),$t=parseInt(pt);if($t<224||$t>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let nn=0;nn<3;nn++){if(b[F]!==".")throw new Error("Invalid IP4 multicast address.");F+=1,F=this.consumeDecimalUChar(b,F)}return b[F]==="/"&&(F+=1),F=this.consumeTTL(b,F),b[F]==="/"&&(F=this.consumeInteger(b,F)),F}consumeInteger(b,M){if(!I(b[M]))throw new Error("Invalid integer.");for(M+=1;p(b[M]);)M+=1;return M}consumeTTL(b,M){if(b[M]==="0")return M+1;if(!I(b[M]))throw new Error("Invalid TTL.");M+=1;for(let F=0;F<2&&p(b[M]);F++)M+=1;return M}consumeToken(b,M){return this.consumeOneOrMore(b,M,E)}consumeTime(b,M){let F=M;if(b[F]==="0")return F+1;for(I(b[F])&&(F+=1);p(b[F]);)F++;if(F-M<10)throw new Error("Invalid time");return F}consumeAddress(b,M){return this.consumeTill(b,M,d)}consumeTypedTime(b,M){let F=M;return F=this.consumeOneOrMore(b,F,p),w(b[F])?F+1:F}consumeRepeatInterval(b,M){if(!I(b[M]))throw new Error("Invalid repeat interval");for(M+=1;p(b[M]);)M+=1;return w(b[M])&&(M+=1),M}consumePort(b,M){return this.consumeOneOrMore(b,M,p)}consume(b,M,F){for(let pt=0;pt<F.length;pt++){if(M+pt>=b.length)throw new Error("consume exceeding value length");if(b[M+pt]!==F[pt])throw new Error("consume ".concat(F," failed at ").concat(pt))}return M+F.length}consumeTill(b,M,F){let pt=M;for(;pt<b.length&&(typeof F!="string"||b[pt]!==F)&&(typeof F!="function"||!F(b[pt]));)pt++;return pt}}class rt extends ${constructor(){super(),z(this,"records",[]),z(this,"currentLine",0)}parse(b){const M=this.probeEOL(b);this.records=b.split(M).filter(Pl=>!!dr(Pl).call(Pl)).map(this.parseLine),this.currentLine=0;const F=this.parseVersion(),pt=this.parseOrigin(),$t=this.parseSessionName(),nn=this.parseInformation(),ei=this.parseUri(),cs=this.parseEmail(),Hs=this.parsePhone(),vv=this.parseConnection(),ep=this.parseBandWidth(),Gm=this.parseTimeFields(),Rb=this.parseKey(),bb=this.parseSessionAttribute(),ls=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:F,origin:pt,sessionName:$t,information:nn,uri:ei,emails:cs,phones:Hs,connection:vv,bandwidths:ep,timeFields:Gm,key:Rb,attributes:bb,mediaDescriptions:ls}}getCurrentRecord(){const b=this.records[this.currentLine];if(!b)throw new Error("Record doesn't exit.");return b}probeEOL(b){for(let M=0;M<b.length;M++)if(b[M]===c)return b[M-1]==="\r"?l:c;throw new Error("Invalid newline character.")}parseLine(b,M){if(b.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const F=b[0];if(b[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:F,value:b.slice(2),line:M,cur:0}}parseSessionAttribute(){const b=new ae;for(;this.currentLine<this.records.length;){const M=this.getCurrentRecord();if(M.type!==h.ATTRIBUTE)break;const F={attField:this.extractOneOrMore(M,pt=>E(pt)&&pt!==":"),_cur:0};M.value[M.cur]===":"&&(M.cur+=1,F.attValue=this.extractOneOrMore(M,D)),b.parse(F),this.currentLine++}return b.digest()}parseMediaAttributes(b){const M=new se(b);for(;this.currentLine<this.records.length;){const F=this.getCurrentRecord();if(F.type!==h.ATTRIBUTE)break;const pt={attField:this.extractOneOrMore(F,$t=>E($t)&&$t!==":"),_cur:0};F.value[F.cur]===":"&&(F.cur+=1,pt.attValue=this.extractOneOrMore(F,D)),M.parse(pt),this.currentLine++}return M.digest()}parseKey(){const b=this.getCurrentRecord();if(b.type===h.KEY){if(b.value==="prompt"||b.value==="clear:"||b.value==="base64:"||b.value==="uri:")return b.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const b=this.getCurrentRecord();if(b.type===h.ZONE_ADJUSTMENTS){const M=[];for(;;)try{const F=this.extract(b,this.consumeTime);this.consumeSpaceForRecord(b);let pt=!1;b.value[b.cur]==="-"&&(pt=!0,b.cur+=1);const $t=this.extract(b,this.consumeTypedTime);M.push({time:F,typedTime:$t,back:pt})}catch{break}if(M.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,M}return[]}parseRepeat(){const b=[];for(;;){const M=this.getCurrentRecord();if(M.type!==h.REPEAT)break;{const F=this.extract(M,this.consumeRepeatInterval),pt=this.parseTypedTime(M);b.push({repeatInterval:F,typedTimes:pt}),this.currentLine++}}return b}parseTypedTime(b){const M=[];for(;;)try{this.consumeSpaceForRecord(b),M.push(this.extract(b,this.consumeTypedTime))}catch{break}if(M.length===0)throw new Error("Invalid typed time.");return M}parseTime(){const b=this.getCurrentRecord(),M=this.extract(b,this.consumeTime);this.consumeSpaceForRecord(b);const F=this.extract(b,this.consumeTime);return this.currentLine++,{startTime:M,stopTime:F}}parseBandWidth(){const b=[];for(;this.currentLine<this.records.length;){const M=this.getCurrentRecord();if(M.type!==h.BANDWIDTH)break;{const F=this.extractOneOrMore(M,E);if(M.value[M.cur]!==":")throw new Error("Invalid bandwidth field.");M.cur++;const pt=this.extractOneOrMore(M,p);b.push({bwtype:F,bandwidth:pt}),this.currentLine++}}return b}parseVersion(){const b=this.getCurrentRecord();if(b.type!==h.VERSION)throw new Error("first sdp record must be version");const M=b.value.slice(0,this.consumeOneOrMore(b.value,0,p));if(M.length!==b.value.length)throw new Error('invalid proto version, "v='.concat(b.value,'"'));return this.currentLine++,M}parseOrigin(){const b=this.getCurrentRecord();if(b.type!==h.ORIGIN)throw new Error("second line of sdp must be origin");const M=this.extractOneOrMore(b,_);this.consumeSpaceForRecord(b);const F=this.extractOneOrMore(b,p);this.consumeSpaceForRecord(b);const pt=this.extractOneOrMore(b,p);this.consumeSpaceForRecord(b);const $t=this.extractOneOrMore(b,E);this.consumeSpaceForRecord(b);const nn=this.extractOneOrMore(b,E);this.consumeSpaceForRecord(b);const ei=this.extract(b,this.consumeUnicastAddress);return this.currentLine++,{username:M,sessId:F,sessVersion:pt,nettype:$t,addrtype:nn,unicastAddress:ei}}parseSessionName(){const b=this.getCurrentRecord();if(b.type===h.SESSION_NAME){const M=this.extract(b,this.consumeText);return this.currentLine++,M}}parseInformation(){const b=this.getCurrentRecord();if(b.type!==h.INFORMATION)return;const M=this.extract(b,this.consumeText);return this.currentLine++,M}parseUri(){const b=this.getCurrentRecord();if(b.type===h.URI)return this.currentLine++,b.value}parseEmail(){const b=[];for(;;){const M=this.getCurrentRecord();if(M.type!==h.EMAIL)break;b.push(M.value),this.currentLine++}return b}parsePhone(){const b=[];for(;;){const M=this.getCurrentRecord();if(M.type!==h.PHONE)break;b.push(M.value),this.currentLine++}return b}parseConnection(){const b=this.getCurrentRecord();if(b.type===h.CONNECTION){const M=this.extractOneOrMore(b,E);this.consumeSpaceForRecord(b);const F=this.extractOneOrMore(b,E);this.consumeSpaceForRecord(b);const pt=this.extract(b,this.consumeAddress);return this.currentLine++,{nettype:M,addrtype:F,address:pt}}}parseMedia(){const b=this.getCurrentRecord(),M=this.extract(b,this.consumeToken);this.consumeSpaceForRecord(b);let F=this.extract(b,this.consumePort);b.value[b.cur]==="/"&&(b.cur+=1,F+=this.extract(b,this.consumeInteger)),this.consumeSpaceForRecord(b);const pt=[];for(pt.push(this.extract(b,this.consumeToken));b.value[b.cur]==="/";)b.cur+=1,pt.push(this.extract(b,this.consumeToken));if(pt.length===0)throw new Error("Invalid proto");const $t=this.parseFmt(b);return this.currentLine++,{mediaType:M,port:F,protos:pt,fmts:$t}}parseTimeFields(){const b=[];for(;this.getCurrentRecord().type===h.TIME;){const M=this.parseTime(),F=this.parseRepeat(),pt=this.parseZone();b.push({time:M,repeats:F,zones:pt})}return b}parseMediaDescription(){const b=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===h.MEDIA;){const M=this.parseMedia(),F=this.parseInformation(),pt=this.parseConnections(),$t=this.parseBandWidth(),nn=this.parseKey(),ei=this.parseMediaAttributes(M);b.push({media:M,information:F,connections:pt,bandwidths:$t,key:nn,attributes:ei})}return b}parseConnections(){const b=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===h.CONNECTION;)b.push(this.parseConnection());return b}parseFmt(b){const M=[];for(;;)try{this.consumeSpaceForRecord(b),M.push(this.extract(b,this.consumeToken))}catch{break}if(M.length===0)throw new Error("Invalid fmts");return M}extract(b,M){for(var F=arguments.length,pt=new Array(F>2?F-2:0),$t=2;$t<F;$t++)pt[$t-2]=arguments[$t];const nn=M.call(this,b.value,b.cur,...pt),ei=b.value.slice(b.cur,nn);return b.cur=nn,ei}extractOneOrMore(b,M){const F=this.consumeOneOrMore(b.value,b.cur,M),pt=b.value.slice(b.cur,F);return b.cur=F,pt}consumeSpaceForRecord(b){if(b.value[b.cur]!==d)throw new Error("Invalid space at ".concat(b.cur,"."));b.cur+=1}}class dt extends ${constructor(){super(...arguments),z(this,"attributes",void 0),z(this,"digested",!1)}extractOneOrMore(b,M,F){const pt=this.consumeOneOrMore(b.attValue,b._cur,M),$t=b.attValue.slice(b._cur,pt),[nn,ei]=F||[];if(typeof nn=="number"&&$t.length<nn)throw new Error("error in length, should be more or equal than ".concat(nn," characters."));if(typeof ei=="number"&&$t.length>ei)throw new Error("error in length, should be less or equal than ".concat(ei," characters."));return b._cur=pt,$t}consumeAttributeSpace(b){if(b.attValue[b._cur]!==d)throw new Error("Invalid space at ".concat(b._cur,"."));b._cur+=1}extract(b,M){if(!b.attValue)throw new Error("Nothing to extract from attValue.");for(var F=arguments.length,pt=new Array(F>2?F-2:0),$t=2;$t<F;$t++)pt[$t-2]=arguments[$t];const nn=M.call(this,b.attValue,b._cur,...pt),ei=b.attValue.slice(b._cur,nn);return b._cur=nn,ei}atEnd(b){if(!b.attValue)throw new Error;return b._cur>=b.attValue.length}peekChar(b){if(!b.attValue)throw new Error;return b.attValue[b._cur]}peek(b,M){if(!b.attValue)throw new Error;for(let F=0;F<M.length;F++)if(M[F]!==b.attValue[b._cur+F])return!1;return!0}parseIceUfrag(b){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(b,N,[4,256])}parseIcePwd(b){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(b,N,[22,256])}parseIceOptions(b){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const M=[];for(;!this.atEnd(b);){M.push(this.extractOneOrMore(b,N));try{this.consumeAttributeSpace(b)}catch(F){if(this.atEnd(b))break;throw F}}this.attributes.iceOptions=M}parseFingerprint(b){const M=this.extract(b,this.consumeToken);this.consumeAttributeSpace(b);const F=this.extract(b,this.consumeTill);this.attributes.fingerprints.push({hashFunction:M,fingerprint:F})}parseExtmap(b){const M=this.extractOneOrMore(b,p);let F;this.peekChar(b)==="/"&&(this.extract(b,this.consume,"/"),F=this.extract(b,this.consumeToken)),this.consumeAttributeSpace(b);const pt=this.extract(b,this.consumeTill,d),$t=U(U({entry:parseInt(M,10)},F&&{direction:F}),{},{extensionName:pt});this.peekChar(b)===d&&(this.consumeAttributeSpace(b),$t.extensionAttributes=this.extract(b,this.consumeTill)),this.attributes.extmaps.push($t)}parseSetup(b){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const M=this.extract(b,this.consumeTill);if(M!=="active"&&M!=="passive"&&M!=="actpass"&&M!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=M}}class ae extends dt{constructor(){super(...arguments),z(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(b){if(this.digested)throw new Error("already digested");try{switch(b.attField){case"group":this.parseGroup(b);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(b);break;case"ice-pwd":this.parseIcePwd(b);break;case"ice-options":this.parseIceOptions(b);break;case"fingerprint":this.parseFingerprint(b);break;case"setup":this.parseSetup(b);break;case"tls-id":this.parseTlsId(b);break;case"identity":this.parseIdentity(b);break;case"extmap":this.parseExtmap(b);break;case"msid-semantic":this.parseMsidSemantic(b);break;default:b.ignored=!0,this.attributes.unrecognized.push(b)}}catch(M){throw console.error("parsing session attribute ".concat(b.attField,' error, "a=').concat(b.attField,":").concat(b.attValue,'"')),M}if(!b.ignored&&b.attValue&&!this.atEnd(b))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(b){const M=this.extract(b,this.consumeToken),F=[];for(;!this.atEnd(b)&&this.peekChar(b)===d;)this.consumeAttributeSpace(b),F.push(this.extract(b,this.consumeToken));this.attributes.groups.push({semantic:M,identificationTag:F})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(b){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(b,L)}parseIdentity(b){const M=this.extractOneOrMore(b,W),F=[];for(;!this.atEnd(b)&&this.peekChar(b)===d;){this.consumeAttributeSpace(b);const pt=this.extract(b,this.consumeToken);this.extract(b,this.consume,"=");const $t=this.extractOneOrMore(b,nn=>nn!==d&&D(nn));F.push({name:pt,value:$t})}this.attributes.identities.push({assertionValue:M,extensions:F})}parseMsidSemantic(b){this.peekChar(b)===d&&this.consumeAttributeSpace(b);const M={semantic:this.extract(b,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(b)}catch{break}if(this.peekChar(b)==="*"){this.extract(b,this.consume,"*"),M.applyForAll=!0;break}{const F=this.extract(b,this.consumeTill,d);M.identifierList.push(F)}}this.attributes.msidSemantic=M}}class se extends dt{constructor(b){super(),z(this,"attributes",void 0),b.protos.indexOf("RTP")!==-1||b.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(b){if(this.digested)throw new Error("already digested");try{switch(b.attField){case"extmap":this.parseExtmap(b);break;case"setup":this.parseSetup(b);break;case"ice-ufrag":this.parseIceUfrag(b);break;case"ice-pwd":this.parseIcePwd(b);break;case"ice-options":this.parseIceOptions(b);break;case"candidate":this.parseCandidate(b);break;case"remote-candidate":this.parseRemoteCandidate(b);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(b);break;case"rtpmap":this.parseRtpmap(b);break;case"ptime":this.parsePtime(b);break;case"maxptime":this.parseMaxPtime(b);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(b);break;case"ssrc":this.parseSSRC(b);break;case"fmtp":this.parseFmtp(b);break;case"rtcp-fb":this.parseRtcpFb(b);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(b);break;case"mid":this.parseMid(b);break;case"msid":this.parseMsid(b);break;case"imageattr":this.parseImageAttr(b);break;case"rid":this.parseRid(b);break;case"simulcast":this.parseSimulcast(b);break;case"sctp-port":this.parseSctpPort(b);break;case"max-message-size":this.parseMaxMessageSize(b);break;case"ssrc-group":this.parseSSRCGroup(b);break;default:b.ignored=!0,this.attributes.unrecognized.push(b)}}catch(M){throw console.error("parsing media attribute ".concat(b.attField,' error, "a=').concat(b.attField,":").concat(b.attValue,'"')),M}if(!b.ignored&&b.attValue&&!this.atEnd(b))throw new Error("attribute parsing error")}parseCandidate(b){const M=this.extractOneOrMore(b,N,[1,32]);this.consumeAttributeSpace(b);const F=this.extractOneOrMore(b,p,[1,5]);this.consumeAttributeSpace(b);const pt=this.extract(b,this.consumeToken);this.consumeAttributeSpace(b);const $t=this.extractOneOrMore(b,p,[1,10]);this.consumeAttributeSpace(b);const nn=this.extract(b,this.consumeAddress);this.consumeAttributeSpace(b);const ei=this.extract(b,this.consumePort);this.consumeAttributeSpace(b),this.extract(b,this.consume,"typ"),this.consumeAttributeSpace(b);const cs={foundation:M,componentId:F,transport:pt,priority:$t,connectionAddress:nn,port:ei,type:this.extract(b,this.consumeToken),extension:{}};for(this.peek(b," raddr")&&(this.extract(b,this.consume," raddr"),this.consumeAttributeSpace(b),cs.relAddr=this.extract(b,this.consumeAddress)),this.peek(b," rport")&&(this.extract(b,this.consume," rport"),this.consumeAttributeSpace(b),cs.relPort=this.extract(b,this.consumePort));this.peekChar(b)===d;){this.consumeAttributeSpace(b);const Hs=this.extract(b,this.consumeToken);this.consumeAttributeSpace(b),cs.extension[Hs]=this.extractOneOrMore(b,m)}this.attributes.candidates.push(cs)}parseRemoteCandidate(b){const M=[];for(;;){const F=this.extractOneOrMore(b,p,[1,5]);this.consumeAttributeSpace(b);const pt=this.extract(b,this.consumeAddress);this.consumeAttributeSpace(b);const $t=this.extract(b,this.consumePort);M.push({componentId:F,connectionAddress:pt,port:$t});try{this.consumeAttributeSpace(b)}catch{break}}this.attributes.remoteCandidatesList.push(M)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(b){const M=this.extract(b,this.consumeToken);this.consumeAttributeSpace(b);const F=this.extract(b,this.consumeTill,"/");this.extract(b,this.consume,"/");const pt={encodingName:F,clockRate:this.extractOneOrMore(b,p)};this.atEnd(b)||this.peekChar(b)!=="/"||(this.extract(b,this.consume,"/"),pt.encodingParameters=parseInt(this.extract(b,this.consumeTill),10));const $t=this.attributes.payloads.find(nn=>nn.payloadType===parseInt(M,10));$t?$t.rtpMap=pt:this.attributes.payloads.push({payloadType:parseInt(M,10),rtpMap:pt,rtcpFeedbacks:[]})}parsePtime(b){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(b,this.consumeTill)}parseMaxPtime(b){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(b,this.consumeTill)}parseDirection(b){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=b.attField}parseSSRC(b){const M=this.extractOneOrMore(b,p);this.consumeAttributeSpace(b);const F=this.extract(b,this.consumeTill,":");let pt;this.peekChar(b)===":"&&(this.extract(b,this.consume,":"),pt=this.extract(b,this.consumeTill));const $t=this.attributes.ssrcs.find(nn=>nn.ssrcId===parseInt(M,10));$t?$t.attributes[F]=pt:this.attributes.ssrcs.push({ssrcId:parseInt(M,10),attributes:{[F]:pt}})}parseFmtp(b){const M=this.extract(b,this.consumeTill,d);this.consumeAttributeSpace(b);const F=this.extract(b,this.consumeTill),pt={};F.split(";").forEach(nn=>{let[ei,cs]=nn.split("=");ei=dr(ei).call(ei);const Hs=typeof cs=="string"?dr(cs).call(cs):null;typeof ei=="string"&&ei.length>0&&(pt[ei]=Hs)});const $t=this.attributes.payloads.find(nn=>nn.payloadType===parseInt(M,10));$t?$t.fmtp={parameters:pt}:this.attributes.payloads.push({payloadType:parseInt(M,10),rtcpFeedbacks:[],fmtp:{parameters:pt}})}parseFmtParameters(b){const M={},F=this.extract(b,this.consumeTill,"=");b._cur++;const pt=this.extract(b,this.consumeTill,";");for(M[F]=pt;b.attValue[b._cur]===";";){const $t=this.extract(b,this.consumeTill,"=");b._cur++;const nn=this.extract(b,this.consumeTill,";");M[$t]=nn}return M}parseRtcpFb(b){let M="";M=this.peekChar(b)==="*"?this.extract(b,this.consume,"*"):this.extract(b,this.consumeTill,d),this.consumeAttributeSpace(b);const F=this.extract(b,this.consumeTill,d);let pt;if(F==="trr-int")pt={type:F,interval:this.extract(b,this.consumeTill)};else{const $t={type:F};this.peekChar(b)===d&&(this.consumeAttributeSpace(b),$t.parameter=this.extract(b,this.consumeToken),this.peekChar(b)===d&&($t.additional=this.extract(b,this.consumeTill))),pt=$t}if(M==="*")this.attributes.rtcpFeedbackWildcards.push(pt);else{const $t=this.attributes.payloads.find(nn=>nn.payloadType===parseInt(M,10));$t?$t.rtcpFeedbacks.push(pt):this.attributes.payloads.push({payloadType:parseInt(M,10),rtcpFeedbacks:[pt]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(b){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const M={port:this.extract(b,this.consumePort)};this.peekChar(b)===d&&(this.consumeAttributeSpace(b),M.netType=this.extractOneOrMore(b,E),this.consumeAttributeSpace(b),M.addressType=this.extractOneOrMore(b,E),this.consumeAttributeSpace(b),M.address=this.extract(b,this.consumeAddress)),this.attributes.rtcp=M}parseMsid(b){const M={id:this.extractOneOrMore(b,E,[1,64])};this.peekChar(b)===d&&(this.consumeAttributeSpace(b),M.appdata=this.extractOneOrMore(b,E,[1,64])),this.attributes.msids.push(M)}parseImageAttr(b){this.attributes.imageattr.push(b.attValue)}parseRid(b){const M=this.extractOneOrMore(b,pt=>C(pt)||p(pt)||pt==="_"||pt==="-");this.consumeAttributeSpace(b);const F={id:M,direction:this.extract(b,this.consumeToken),params:[]};if(this.peekChar(b)===d){if(this.consumeAttributeSpace(b),this.peek(b,"pt=")){this.extract(b,this.consume,"pt=");const pt=[];for(;;){const $t=this.extract(b,this.consumeToken);pt.push($t);try{this.extract(b,this.consume,",")}catch{break}}F.payloads=pt,this.peekChar(b)===d&&this.extract(b,this.consume,d)}for(;;){const pt=this.extract(b,this.consumeToken);switch(pt){case"depend":{const $t={type:pt,rids:this.extract(b,this.consume,"=").split(",")};F.params.push($t);break}default:{const $t={type:pt};this.peekChar(b)==="="&&(this.extract(b,this.consume,"="),$t.val=this.extract(b,this.consumeTill,";")),F.params.push($t)}}try{this.extract(b,this.consume,";")}catch{break}}}this.attributes.rids.push(F)}parseSimulcast(b){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=b.attValue,this.extract(b,this.consumeTill)}parseSctpPort(b){this.attributes.sctpPort=this.extractOneOrMore(b,p,[1,5])}parseMaxMessageSize(b){this.attributes.maxMessageSize=this.extractOneOrMore(b,p,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(b){this.attributes.mid=this.extract(b,this.consumeToken)}parseSSRCGroup(b){const M=this.extract(b,this.consumeToken),F=[];for(;;)try{this.consumeAttributeSpace(b);const pt=this.extract(b,this.consumeInteger);F.push(parseInt(pt,10))}catch{break}this.attributes.ssrcGroups.push({semantic:M,ssrcIds:F})}}function zt(at,b,M){return b in at?Object.defineProperty(at,b,{value:M,enumerable:!0,configurable:!0,writable:!0}):at[b]=M,at}class ke{constructor(){zt(this,"eol",l)}print(b,M){let F="";return M&&(this.eol=M),F+=this.printVersion(b.version),F+=this.printOrigin(b.origin),F+=this.printSessionName(b.sessionName),F+=this.printInformation(b.information),F+=this.printUri(b.uri),F+=this.printEmail(b.emails),F+=this.printPhone(b.phones),F+=this.printConnection(b.connection),F+=this.printBandwidth(b.bandwidths),F+=this.printTimeFields(b.timeFields),F+=this.printKey(b.key),F+=this.printSessionAttributes(b.attributes),F+=this.printMediaDescription(b.mediaDescriptions),F}printVersion(b){return"v=".concat(b).concat(this.eol)}printOrigin(b){return"o=".concat(b.username," ").concat(b.sessId," ").concat(b.sessVersion," ").concat(b.nettype," ").concat(b.addrtype," ").concat(b.unicastAddress).concat(this.eol)}printSessionName(b){return b?"s=".concat(b).concat(this.eol):""}printInformation(b){return b?"i=".concat(b).concat(this.eol):""}printUri(b){return b?"u=".concat(b).concat(this.eol):""}printEmail(b){let M="";for(const F of b)M+="e=".concat(F).concat(this.eol);return M}printPhone(b){let M="";for(const F of b)M+="e=".concat(F).concat(this.eol);return M}printConnection(b){return b?"c=".concat(b.nettype," ").concat(b.addrtype," ").concat(b.address).concat(this.eol):""}printBandwidth(b){let M="";for(const F of b)M+="b=".concat(F.bwtype,":").concat(F.bandwidth).concat(this.eol);return M}printTimeFields(b){let M="";for(const F of b){M+="t=".concat(F.time.startTime," ").concat(F.time.startTime).concat(this.eol);for(const pt of F.repeats)M+="r=".concat(pt.repeatInterval," ").concat(pt.typedTimes.join(" ")).concat(this.eol);F.zoneAdjustments&&(M+="z=",M+="z=".concat(F.zoneAdjustments.map(pt=>"".concat(pt.time," ").concat(pt.back?"-":""," ").concat(pt.typedTime)).join(" ")).concat(this.eol),M+=this.eol)}return M}printKey(b){return b?"k=".concat(b).concat(this.eol):""}printAttributes(b){let M="";for(const F of b)M+="a=".concat(F.attField).concat(F.attValue?":".concat(F.attValue):"").concat(this.eol);return M}printMediaDescription(b){let M="";for(const F of b)M+=this.printMedia(F.media),M+=this.printInformation(F.information),M+=this.printConnections(F.connections),M+=this.printBandwidth(F.bandwidths),M+=this.printKey(F.key),M+=this.printMediaAttributes(F);return M}printConnections(b){let M="";for(const F of b)M+=this.printConnection(F);return M}printMedia(b){return"m=".concat(b.mediaType," ").concat(b.port," ").concat(b.protos.join("/")," ").concat(b.fmts.join(" ")).concat(this.eol)}printSessionAttributes(b){return new Xi(this.eol).print(b)}printMediaAttributes(b){return new it(this.eol).print(b)}}class De{constructor(b){zt(this,"eol",void 0),this.eol=b}printIceUfrag(b){return b===void 0?"":"a=ice-ufrag:".concat(b).concat(this.eol)}printIcePwd(b){return b===void 0?"":"a=ice-pwd:".concat(b).concat(this.eol)}printIceOptions(b){return b===void 0?"":"a=ice-options:".concat(b.join(d)).concat(this.eol)}printFingerprints(b){return b.length>0?b.map(M=>"a=fingerprint:".concat(M.hashFunction).concat(d).concat(M.fingerprint)).join(this.eol)+this.eol:""}printExtmap(b){return b.map(M=>"a=extmap:".concat(M.entry).concat(M.direction?"/".concat(M.direction):"").concat(d).concat(M.extensionName).concat(M.extensionAttributes?"".concat(d).concat(M.extensionAttributes):"").concat(this.eol)).join("")}printSetup(b){return b===void 0?"":"a=setup:".concat(b).concat(this.eol)}printUnrecognized(b){return b.map(M=>"a=".concat(M.attField).concat(M.attValue?":".concat(M.attValue):"").concat(this.eol)).join("")}}class Xi extends De{print(b){let M="";return M+=this.printGroups(b.groups),M+=this.printMsidSemantic(b.msidSemantic),M+=this.printIceLite(b.iceLite),M+=this.printIceUfrag(b.iceUfrag),M+=this.printIcePwd(b.icePwd),M+=this.printIceOptions(b.iceOptions),M+=this.printFingerprints(b.fingerprints),M+=this.printSetup(b.setup),M+=this.printTlsId(b.tlsId),M+=this.printIdentity(b.identities),M+=this.printExtmap(b.extmaps),M+=this.printUnrecognized(b.unrecognized),M}printGroups(b){let M="";return b.length>0&&(M+=b.map(F=>"a=group:".concat(F.semantic).concat(F.identificationTag.map(pt=>"".concat(d).concat(pt)).join("")).concat(this.eol)).join("")),M}printIceLite(b){return b===void 0?"":"a=ice-lite"+this.eol}printTlsId(b){return b?"a=tls-id:".concat(b).concat(this.eol):""}printIdentity(b){return b.length===0?"":b.map(M=>"a=identity:".concat(M.assertionValue).concat(M.extensions.map(F=>"".concat(d).concat(F.name).concat(F.value?"=".concat(F.value):"")))).join(this.eol)+this.eol}printMsidSemantic(b){if(!b)return"";let M="a=msid-semantic:".concat(b.semantic);return b.applyForAll?M+="".concat(d,"*"):b.identifierList.length>0&&(M+=b.identifierList.map(F=>"".concat(d).concat(F))),M+this.eol}}class it extends De{print(b){const M=b.attributes;let F="";return F+=this.printRTCP(M.rtcp),F+=this.printIceUfrag(M.iceUfrag),F+=this.printIcePwd(M.icePwd),F+=this.printIceOptions(M.iceOptions),F+=this.printCandidates(M.candidates),F+=this.printRemoteCandidatesList(M.remoteCandidatesList),F+=this.printEndOfCandidates(M.endOfCandidates),F+=this.printFingerprints(M.fingerprints),F+=this.printSetup(M.setup),F+=this.printMid(M.mid),F+=this.printExtmap(M.extmaps),F+=this.printRTPRelated(M),F+=this.printPtime(M.ptime),F+=this.printMaxPtime(M.maxPtime),F+=this.printDirection(M.direction),F+=this.printSSRCGroups(M.ssrcGroups),F+=this.printSSRC(M.ssrcs),F+=this.printRTCPMux(M.rtcpMux),F+=this.printRTCPMuxOnly(M.rtcpMuxOnly),F+=this.printRTCPRsize(M.rtcpRsize),F+=this.printMSId(M.msids),F+=this.printImageattr(M.imageattr),F+=this.printRid(M.rids),F+=this.printSimulcast(M.simulcast),F+=this.printSCTPPort(M.sctpPort),F+=this.printMaxMessageSize(M.maxMessageSize),F+=this.printUnrecognized(M.unrecognized),F}printCandidates(b){return b.map(M=>"a=candidate:".concat(M.foundation).concat(d).concat(M.componentId).concat(d).concat(M.transport).concat(d).concat(M.priority).concat(d).concat(M.connectionAddress).concat(d).concat(M.port).concat(d,"typ").concat(d).concat(M.type).concat(M.relAddr?"".concat(d,"raddr").concat(d).concat(M.relAddr):"").concat(M.relPort?"".concat(d,"rport").concat(d).concat(M.relPort):"").concat(Object.keys(M.extension).map(F=>"".concat(d).concat(F).concat(d).concat(M.extension[F])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(b){return b.map(M=>"a=remote-candidates:".concat(M.join(d)).concat(this.eol)).join("")}printEndOfCandidates(b){return b===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(b){if(!b.payloads)return"";const M=b.payloads;let F="";F+=b.rtcpFeedbackWildcards.map(pt=>this.printRTCPFeedback("*",pt)).join("");for(const pt of M)F+=this.printRtpMap(pt.payloadType,pt.rtpMap),F+=this.printFmtp(pt.payloadType,pt.fmtp),F+=pt.rtcpFeedbacks.map($t=>this.printRTCPFeedback(pt.payloadType,$t)).join("");return F}printFmtp(b,M){if(!M)return"";const F=Object.keys(M.parameters);return F.length===1&&M.parameters[F[0]]===null?"a=fmtp:".concat(b).concat(d).concat(F[0]).concat(this.eol):"a=fmtp:".concat(b).concat(d).concat(Object.keys(M.parameters).map(pt=>"".concat(pt,"=").concat(M.parameters[pt])).join(";")).concat(this.eol)}printRtpMap(b,M){return M?"a=rtpmap:".concat(b).concat(d).concat(M.encodingName,"/").concat(M.clockRate).concat(M.encodingParameters?"/".concat(M.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(b,M){let F="a=rtcp-fb:".concat(b).concat(d),pt=M;return pt.type==="trr-int"?F+="ttr-int".concat(d).concat(pt.interval):(F+="".concat(pt.type),pt.parameter&&(F+="".concat(d).concat(pt.parameter),pt.additional&&(F+="".concat(d).concat(pt.additional)))),F+this.eol}printPtime(b){return b===void 0?"":"a=ptime:".concat(b).concat(this.eol)}printMaxPtime(b){return b===void 0?"":"a=maxptime:".concat(b).concat(this.eol)}printDirection(b){return b===void 0?"":"a=".concat(b).concat(this.eol)}printSSRC(b){return b.map(M=>Object.keys(M.attributes).map(F=>"a=ssrc:".concat(M.ssrcId.toString(10)).concat(d).concat(F).concat(M.attributes[F]?":".concat(M.attributes[F]):"").concat(this.eol)).join("")).join("")}printRTCPMux(b){return b===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(b){return b===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(b){return b===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(b){if(b===void 0)return"";let M="a=rtcp:".concat(b.port);return b.netType&&(M+="".concat(d).concat(b.netType)),b.addressType&&(M+="".concat(d).concat(b.addressType)),b.address&&(M+="".concat(d).concat(b.address)),M+this.eol}printMSId(b){return b.map(M=>"a=msid:".concat(M.id).concat(M.appdata?"".concat(d).concat(M.appdata):"").concat(this.eol)).join("")}printImageattr(b){return b.map(M=>"a=imageattr:".concat(M).concat(this.eol)).join("")}printRid(b){return b.map(M=>{let F="a=rid:".concat(M.id).concat(d).concat(M.direction);return M.payloads&&(F+="".concat(d,"pt=").concat(M.payloads.join(","))),M.params.length>0&&(F+="".concat(d).concat(M.params.map(pt=>pt.type==="depend"?"depend=".concat(pt.rids.join(",")):"".concat(pt.type,"=").concat(pt.val)).join(";"))),F+this.eol}).join("")}printSimulcast(b){return b===void 0?"":"a=simulcast:".concat(b).concat(this.eol)}printSCTPPort(b){return b===void 0?"":"a=sctp-port:".concat(b).concat(this.eol)}printMaxMessageSize(b){return b===void 0?"":"a=max-message-size:".concat(b).concat(this.eol)}printMid(b){return b===void 0?"":"a=mid:".concat(b).concat(this.eol)}printSSRCGroups(b){return b.map(M=>"a=ssrc-group:".concat(M.semantic).concat(M.ssrcIds.map(F=>"".concat(d).concat(F.toString(10))).join("")).concat(this.eol)).join("")}}function ft(at){return new rt().parse(at)}function wt(at,b){return new ke().print(at,b)}}},e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={exports:{}};return t[i](r,r.exports,n),r.exports}return n.d=(i,r)=>{for(var s in r)n.o(r,s)&&!n.o(i,s)&&Object.defineProperty(i,s,{enumerable:!0,get:r[s]})},n.o=(i,r)=>Object.prototype.hasOwnProperty.call(i,r),n.r=i=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},n(8)})();function Wr(t){return OL.parse(t)}function Hd(t,e){return OL.print(t,e)}var X6=$r("Array","keys"),Q6=no,J6=ci,Z6=vt,$6=X6,sw=Array.prototype,tG={DOMTokenList:!0,NodeList:!0},eG=function(t){var e=t.keys;return t===sw||Z6(sw,t)&&e===sw.keys||J6(tG,Q6(t))?$6:e},zr=V(eG);function In(t,e,n){return(e=function(i){var r=function(s,c){if(typeof s!="object"||!s)return s;var l=s[Symbol.toPrimitive];if(l!==void 0){var d=l.call(s,"string");if(typeof d!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}(i);return typeof r=="symbol"?r:r+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function NL(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function ie(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?NL(Object(n),!0).forEach(function(i){In(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):NL(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const DL=new class extends Sn{constructor(){super(...arguments),In(this,"currentUploadLogID",0)}reportLogUploadError(t){const{errorRange:e}=t;e[e.length-1]&&e[e.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=e[e.length-1],this.emit("REPORT_LOG_UPLOAD",t))}};class nG{constructor(e){In(this,"logger",void 0),In(this,"prefixLists",[]),this.logger=e}debug(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];this.logger.debug(...this.prefixLists,...n)}info(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];this.logger.info(...this.prefixLists,...n)}warning(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];this.logger.warning(...this.prefixLists,...n)}error(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];this.logger.error(...this.prefixLists,...n)}prefix(e){return this.prefixLists.push(e),this}popPrefix(){return this.prefixLists.pop(),this}}function ow(){const t=new Date;return t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}function PL(){const t=new Date,e=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return e?(e==null?void 0:e[0])+":"+t.getUTCMilliseconds():t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}const ts={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},dR=Date.now(),Mg=t=>{for(const e in ts)if(Object.prototype.hasOwnProperty.call(ts,e)&&ts[e]===t)return e;return"DEFAULT"},T=new class{constructor(){In(this,"proxyServerURL",void 0),In(this,"logLevel",ts.DEBUG),In(this,"uploadState","collecting"),In(this,"uploadLogWaitingList",[]),In(this,"uploadLogUploadingList",[]),In(this,"uploadErrorCount",0),In(this,"currentLogID",0),In(this,"url",void 0),In(this,"extLog",(t,e)=>{this.appendLogToWaitingList(t,...e)})}debug(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=[ts.DEBUG].concat(e);this.log.apply(this,i)}info(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=[ts.INFO].concat(e);this.log.apply(this,i)}warning(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=[ts.WARNING].concat(e);this.log.apply(this,i)}warn(){this.warning(...arguments)}error(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=[ts.ERROR].concat(e);this.log.apply(this,i)}upload(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=[ts.DEBUG].concat(e);this.uploadLog.apply(this,i)}setLogLevel(t){t=Math.min(Math.max(0,t),4),this.logLevel=t}enableLogUpload(){Fe("UPLOAD_LOG",!0)}disableLogUpload(){Fe("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(t){this.proxyServerURL=t}prefix(t){return new nG(this).prefix(t)}log(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if(Date.now()-dR<100)return void setTimeout(()=>{this.log(...e)},Date.now()-dR);const i=Math.max(0,Math.min(4,e[0]));if(e[0]=ow()+" Agora-SDK [".concat(Mg(i),"]:"),this.appendLogToWaitingList(i,...e),i<this.logLevel)return;const r=ow()+" %cAgora-SDK [".concat(Mg(i),"]:");let s=[];if(!k("USE_NEW_LOG"))switch(i){case ts.DEBUG:s=[r,"color: #64B5F6;"].concat(e.slice(1)),console.log.apply(console,s);break;case ts.INFO:s=[r,"color: #1E88E5; font-weight: bold;"].concat(e.slice(1)),console.log.apply(console,s);break;case ts.WARNING:s=[r,"color: #FB8C00; font-weight: bold;"].concat(e.slice(1)),console.warn.apply(console,s);break;case ts.ERROR:s=[r,"color: #B00020; font-weight: bold;"].concat(e.slice(1)),console.error.apply(console,s)}}uploadLog(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if(Date.now()-dR<100)return void setTimeout(()=>{this.uploadLog(...e)},Date.now()-dR);const i=Math.max(0,Math.min(4,e[0]));e[0]=ow()+" Agora-SDK [".concat(Mg(i),"]:"),this.appendLogToWaitingList(i,...e)}appendLogToWaitingList(t){if(!k("UPLOAD_LOG"))return;for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];Array.isArray(n[0])?n[0][0]=PL()+" Agora-SDK [".concat(Mg(t),"]:"):n[0]=PL()+" Agora-SDK [".concat(Mg(t),"]:");let r="";n.forEach(s=>{typeof s=="object"&&(s=JSON.stringify(s)),r+="".concat(s," ")}),this.uploadLogWaitingList.push({payload_str:r,log_level:t,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const t=this.uploadLogUploadingList,e={sdk_version:$a,process_id:k("PROCESS_ID"),payload:JSON.stringify(t)};return Ro(async()=>{const n=await Ir.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(k("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(k("LOG_UPLOAD_SERVER"),"/upload/v1")),e,{responseType:"text"});if(n.data!=="OK"){const i=new Error("unexpected upload log response");throw i.response=n,i}},()=>(this.uploadLogUploadingList=[],!1),n=>{const i={status:-1,message:n.message,errorRange:t.map(r=>r.log_item_id)};return n.response?(i.status=n.response.status,i.data=n.response.data,i.headers=n.response.headers):n.request&&(i.status=n.request.status),DL.reportLogUploadError(i),!0},{timeout:k("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:k("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,k("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),k("UPLOAD_LOG_INTERVAL"))}).catch(t=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),k("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),k("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var kL;function iG(t){return Ti(t.reportId,"params.reportId",0,100,!1),Ti(t.category,"params.category",0,100,!1),Ti(t.event,"params.event",0,100,!1),Ti(t.label,"params.label",0,100,!1),Ke(t.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(kL={}).FREE="free",kL.UPLOADING="uploading",function(t){t[t.MISC=0]="MISC",t[t.INTERNAL_EVENT=1]="INTERNAL_EVENT",t[t.PUBLIC_EVENT=2]="PUBLIC_EVENT",t[t.WEB_EVENT=3]="WEB_EVENT",t[t.INTERNAL_API=4]="INTERNAL_API",t[t.WEB_API=5]="WEB_API",t[t.PUBLIC_API=6]="PUBLIC_API"}({});const rG={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let ai=function(t){return t.PUBLISH="publish",t.SUBSCRIBE="subscribe",t.WS_COMPRESSOR_INIT="ws_compressor_init",t.SESSION_INIT="session_init",t.JOIN_CHOOSE_SERVER="join_choose_server",t.REQ_USER_ACCOUNT="req_user_account",t.JOIN_GATEWAY="join_gateway",t.REJOIN_GATEWAY="rejoin_gateway",t.STREAM_SWITCH="stream_switch",t.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",t.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",t.FIRST_VIDEO_RECEIVED="first_video_received",t.FIRST_AUDIO_RECEIVED="first_audio_received",t.FIRST_VIDEO_DECODE="first_video_decode",t.FIRST_AUDIO_DECODE="first_audio_decode",t.XLA_PEER_FIRST_VIDEO_FRAME="xla_peer_first_video_frame",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_UPDATE_STREAM="on_update_stream",t.ON_REMOVE_STREAM="on_remove_stream",t.USER_ANALYTICS="req_user_analytics",t.PC_STATS="pc_stats",t.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",t.AB_TEST="ab_test",t}({}),pn=function(t){return t.SESSION="io.agora.pb.Wrtc.Session",t.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",t.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",t.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",t.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",t.PUBLISH="io.agora.pb.Wrtc.Publish",t.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",t.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",t.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",t.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",t.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",t.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",t.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",t.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",t.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",t.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",t.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",t.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",t.XLA_PEER_FIRST_VIDEO_FRAME="io.agora.pb.Wrtc.XLAPeerFirstVideoFrame",t.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",t.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",t.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",t.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",t.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",t.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",t.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",t.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",t.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",t.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",t.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",t.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",t.PC_STATS="io.agora.pb.Wrtc.PCStats",t.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",t.AB_TEST="io.agora.pb.Wrtc.ABTest",t}({});(function(t){t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let aG=function(t){return t[t.SESSION=26]="SESSION",t[t.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",t[t.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",t[t.JOIN_GATEWAY=28]="JOIN_GATEWAY",t[t.PUBLISH=30]="PUBLISH",t[t.SUBSCRIBE=29]="SUBSCRIBE",t[t.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",t[t.STREAM_SWITCH=32]="STREAM_SWITCH",t[t.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",t[t.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",t[t.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",t[t.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",t[t.API_INVOKE=41]="API_INVOKE",t[t.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",t[t.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",t[t.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",t[t.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",t[t.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",t[t.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",t[t.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",t[t.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",t[t.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",t[t.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",t[t.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",t[t.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",t[t.USER_ANALYTICS=1e4]="USER_ANALYTICS",t[t.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",t}({});function Bt(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(e,n,i){const r=i.value;if(typeof r=="function"){const s=t.className||e.__className__||(e.constructor.name==="AgoraRTCClient"?"Client":e.constructor.name);i.value=function(){for(var c,l=arguments.length,d=new Array(l),h=0;h<l;h++)d[h]=arguments[h];let p=d;if(t.argsMap)try{p=t.argsMap(this,...d)}catch(_){T.warning(_),p=[]}try{JSON.stringify(p)}catch{T.warning("arguments for method ".concat(s,".").concat(String(n)," not serializable for apiInvoke.")),p=[]}const m=(t.report||Pt).reportApiInvoke(this._sessionId||null,{id:this._clientId||((c=this.store)===null||c===void 0?void 0:c.clientId)||this._ID,name:"".concat(s,".").concat(String(n)),options:p,tag:_n.TRACER,reportResult:t.reportResult},t.throttleTime);try{const _=r.apply(this,d);return _ instanceof Tt?_.then(E=>(m.onSuccess(t.reportResult&&E),E)).catch(E=>{throw m.onError(E),E}):(m.onSuccess(t.reportResult&&_),_)}catch(_){throw m.onError(_),_}}}return i}}const Pt=new class{constructor(){In(this,"baseInfoMap",new Map),In(this,"proxyServer",void 0),In(this,"eventUploadTimer",void 0),In(this,"setSessionIdTimer",void 0),In(this,"url",void 0),In(this,"sids",new Set),In(this,"backupUrl",void 0),In(this,"_appId",void 0),In(this,"_aid",0),In(this,"keyEventUploadPendingItems",[]),In(this,"normalEventUploadPendingItems",[]),In(this,"apiInvokeUploadPendingItems",[]),In(this,"apiInvokeCount",0),In(this,"apiInvokeLoggedCount",0),In(this,"ltsList",[]),In(this,"lastSendNormalEventTime",Date.now()),In(this,"customReportCounterTimer",void 0),In(this,"customReportCount",0),In(this,"extApiInvoke",async t=>{for(const e of t){const n=ie(ie({},e),{},{sid:null,invokeId:++this.apiInvokeCount,tag:_n.TRACER});this.sendApiInvoke(n)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),k("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),k("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(t){return this.baseInfoMap.get(t)}setAppId(t){this._appId=t,this._aid=parseInt(t.replace(/[a-fA-F0-9]{8}/g,e=>{let[n,i]=e;return n+i}),16)||0}reportApiInvoke(t,e,n){e.timeout=e.timeout||6e4,e.reportResult=e.reportResult===void 0||e.reportResult;const i=Date.now();this.apiInvokeCount+=1;const r=this.apiInvokeCount,s=!!k("SHOW_REPORT_INVOKER_LOG"),c=!!k("SHOW_REPORT_USER_INVOKER_LOG"),l=s||c&&e.id;l&&(this.apiInvokeLoggedCount+=1);const d=this.apiInvokeLoggedCount;function h(E,I){if(l){let C="[apiInvoke-".concat(d,"]");if(e.id&&(C+="[".concat(e.id,"]")),e.name&&(C+="[".concat(e.name,"]"),e.name===kn.JOIN))return T.info("".concat(C," ").concat(E));T.info("".concat(C," ").concat(E),E==="start"?e.options:I||"")}}const p=()=>({tag:e.tag,invokeId:r,sid:t,name:e.name,apiInvokeTime:i,options:e.options,states:e.states||null});h("start");let m=!1;yi(e.timeout).then(()=>{m||(this.sendApiInvoke(ie(ie({},p()),{},{error:P.API_INVOKE_TIMEOUT,success:!1})),h("timeout"))});const _=new Z(P.UNEXPECTED_ERROR,"".concat(e.name,": this api invoke is end"));return{onSuccess:E=>{const I=()=>{if(m)throw _;return m=!0,this.sendApiInvoke(ie(ie({},p()),{},{success:!0},e.reportResult&&{result:E})),h("onSuccess"),E};return n?hL(I,e.name+"Success",n,()=>m=!0):I()},onError:E=>{const I=()=>{if(m)throw E;m=!0,this.sendApiInvoke(ie(ie({},p()),{},{success:!1,error:E})),h("onFailure",E.toString())};return n?hL(I,e.name+"Error",n,()=>m=!0):I()}}}sessionInit(t,e){if(this.baseInfoMap.has(t))return;const n=Date.now(),i=this.createBaseInfo(t,n);i.cname=e.cname;const r=Object.assign({},{willUploadConsoleLog:k("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:nw?"global":"oversea",areas:k("AREAS")&&k("AREAS").join(",")},e.extend),{stringUid:s,channelProfile:c,channelMode:l,isABTestSuccess:d,lsid:h,clientRole:p}=e,m=Date.now(),_=ie(ie({},i),{},{eventType:ai.SESSION_INIT,appid:e.appid,browser:navigator.userAgent,buildFormat:e.buildFormat,build:rw,lts:m,elapse:m-n,extend:JSON.stringify(r),mode:e.mode,process:k("PROCESS_ID"),appType:k("APP_TYPE"),success:!0,version:$a,stringUid:s,channelProfile:c,channelMode:l,isABTestSuccess:d,lsid:h,clientType:mt(E=window.navigator.userAgent).call(E,"AgoraWebView")?42:20,clientRole:p,serviceId:k("PROCESS_ID"),extensionID:k("PLUGIN_INFO").join(",")||""});var E;this.send({type:pn.SESSION,data:_},!0)}joinChooseServer(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=ie(ie({},i),{},{role:e.role,eventType:ai.JOIN_CHOOSE_SERVER,lts:r,eventElapse:e.elapse||r-e.lts,chooseServerAddr:e.csAddr,errorCode:e.ec,elapse:r-n.startTime,success:e.succ,chooseServerAddrList:JSON.stringify(e.serverList),uid:e.uid?parseInt(e.uid):null,cid:e.cid?parseInt(e.cid):null,chooseServerIp:e.csIp||"",opid:e.opid,unilbsServerIds:e.unilbsServerIds,extend:e.extend||void 0,isHttp3:e.isHttp3,corssRegionTagReq:e.corssRegionTagReq||void 0,corssRegionTagRes:e.corssRegionTagRes||void 0,resourceTimingInfo:e.resourceTimingInfo||void 0});this.send({type:pn.JOIN_CHOOSE_SERVER,data:s},!0)}reqUserAccount(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=ie(ie({},i),{},{eventType:ai.REQ_USER_ACCOUNT,lts:r,success:e.success,serverAddress:e.serverAddr,stringUid:e.stringUid,uid:e.uid,errorCode:e.errorCode,elapse:e.elapse||r-n.startTime,eventElapse:r-e.lts,extend:JSON.stringify(e.extend)});this.send({type:pn.REQ_USER_ACCOUNT,data:s},!0)}joinGateway(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info;e.vid&&(i.vid=e.vid),i.uid=e.uid,i.cid=e.cid;const r=Date.now(),{firstSuccess:s,addr:c,isProxy:l}=e,d=r-n.startTime,h=ie(ie({},i),{},{eventType:ai.JOIN_GATEWAY,lts:r,gatewayAddr:e.addr,success:e.succ,errorCode:e.ec,errorMsg:e.errorMsg||"",elapse:d,eventElapse:r-e.lts,firstSuccess:s,signalChannel:e.signalChannel,preload:e.preload?1:0,installId:ew(),isABTestSuccess:e.isABTestSuccess?1:0}),p=h.success?1:0;if(e.succ&&(n.lastJoinSuccessTime=r),s)this.send({type:pn.JOIN_GATEWAY,data:h},!0);else{let m;if(c)if(l){const E=c.match(/h=(\d{1,3}-){3}\d{1,3}/g),I=c.match(/p=[0-9]{1,6}/g);m={isSuccess:p,gatewayIp:E&&E.length?E[0].split("=")[1].replace(/-/g,"."):"",port:I&&I.length?I[0].split("=")[1]:"",isProxy:l?1:0}}else{const E=c.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),I=c.match(/(:|p=)[0-9]{1,6}/g);m={isSuccess:p,gatewayIp:E&&E.length?E[0].split("//")[1].replace(/-/g,"."):"",port:I&&I.length?I[0].split(/:|p=/g)[1]:"",isProxy:l?1:0}}else m={isSuccess:p,gatewayIp:"",port:"",isProxy:l?1:0};delete h.success,delete h.eventType,delete h.firstSuccess,h.vid=Number(h.vid);const _=Object.assign({},h,m,{eventType:ai.REJOIN_GATEWAY});this.send({type:pn.RE_JOIN_GATEWAY,data:_},!0)}}joinChannelTimeout(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=Date.now(),r=ie(ie({},n.info),{},{lts:i,timeout:e,elapse:i-n.startTime});this.send({type:pn.JOIN_CHANNEL_TIMEOUT,data:r},!0)}publish(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=ie(ie({},i),{},{eventType:ai.PUBLISH,lts:r,eventElapse:e.eventElapse,elapse:r-n.startTime,success:e.succ,errorCode:e.ec,videoName:e.videoName,audioName:e.audioName,screenName:e.screenName,screenshare:e.screenshare,audio:e.audio,video:e.video,p2pid:e.p2pid,publishRequestid:e.publishRequestid});this.send({type:pn.PUBLISH,data:s},!0)}subscribe(t,e,n){const i=this.baseInfoMap.get(t);if(!i)return;const r=i.info,s=Date.now(),c=ie(ie({},r),{},{eventType:ai.SUBSCRIBE,lts:s,eventElapse:e.eventElapse,elapse:s-i.startTime,success:e.succ,errorCode:e.ec,video:e.video,audio:e.audio,subscribeRequestid:e.subscribeRequestid,p2pid:e.p2pid,preSsrc:e.preSsrc?1:0},n&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof e.peerid=="string"?c.peerSuid=e.peerid:c.peer=e.peerid,this.send({type:pn.SUBSCRIBE,data:c},!0)}wsCompressorInit(t){var e;const n=[...zr(e=this.baseInfoMap).call(e)],i=n.length?n[0]:"UnableToGetSid",r=this.baseInfoMap.get(i);if(!r)return;const s=r.info,c=Date.now(),l=ie(ie({},s),{},{eventType:ai.WS_COMPRESSOR_INIT,lts:c,eventElapse:t.eventElapse,elapse:c-r.startTime,status:t.status?1:2});this.send({type:pn.WS_COMPRESSOR_INIT,data:l},!0)}firstXLAPeerFirstVideoFrame(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=e.peerPubStatusMs-(n.lastJoinSuccessTime||r),c=ie(ie({},i),{},{elapse:r-n.startTime,eventType:ai.XLA_PEER_FIRST_VIDEO_FRAME,lts:r,peer:e.peer,width:e.width,height:e.height,ssrc:e.ssrc,p2pid:e.p2pid,peerPublishDuration:e.peerPublishDuration,joinChannelSuccessElapse:s,peerPubStatusMs:e.peerPubStatusMs-e.joinChannelStart,availablePublish:e.peerPublishDuration>s?1:0,preloadStart:Math.max(e.preloadStart-e.joinChannelStart,0),preloadEnd:Math.max(e.preloadEnd-e.joinChannelStart,0),encrypt:Math.max(e.apStart-e.joinChannelStart,0),ap:Math.max(e.apEnd-e.joinChannelStart,0),sua:Math.max(e.suaEnd-e.joinChannelStart,0),beforeConnect:Math.max(e.beforeConnect-e.joinChannelStart,0),peerRecevier:Math.max(e.peerReceiver-e.joinChannelStart,0),ice:Math.max(e.ice-e.joinChannelStart,0),pc:Math.max(e.pc-e.joinChannelStart,0),signalConnected:Math.max(e.signalConnected-e.joinChannelStart,0),joinReq:Math.max(e.joinReq-e.joinChannelStart,0),joinRes:Math.max(e.joinRes-e.joinChannelStart,0),userJoinNotify:Math.max(e.userJoinNotify-e.joinChannelStart,0),videoSsrcNotify:Math.max(e.videoAddNotify-e.joinChannelStart,0),subscribeDelayMs:Math.max(e.subscribeStart-e.videoAddNotify,0),subscribeStart:Math.max(e.subscribeStart-e.joinChannelStart,0),subscribeEnd:Math.max(e.subscribeEnd-e.joinChannelStart,0),firstReceived:Math.max(e.firstReceived-e.joinChannelStart,0),firstDecoded:Math.max(e.firstDecoded-e.joinChannelStart,0),firstPreRender:Math.max(e.firstPreRender-e.joinChannelStart,0),firstRender:Math.max(e.firstRender-e.joinChannelStart,0),playDelayMs:Math.max(e.playStart-e.subscribeEnd,0),playStart:Math.max(e.playStart-e.joinChannelStart,0),playEnd:Math.max(e.playEnd-e.joinChannelStart,0),isPreSub:e.isPreSub?1:0,isPrePc:e.isPrePc?1:0,isPreInstantVideo:e.isPreInstantVideo?1:0});this.send({type:pn.XLA_PEER_FIRST_VIDEO_FRAME,data:c},!0)}firstRemoteVideoDecode(t,e,n,i){const r=this.baseInfoMap.get(t);if(!r)return;const s=r.info,c=Date.now(),l=ie(ie(ie({},s),i),{},{elapse:c-r.startTime,eventType:e,lts:c,firstDecodeFrame:Math.max((i.firstFrame||c)-r.startTime,0),apEnd:Math.max(i.apEnd-r.startTime,0),apStart:Math.max(i.apStart-r.startTime,0),joinGwEnd:Math.max(i.joinGwEnd-r.startTime,0),joinGwStart:Math.max(i.joinGwStart-r.startTime,0),pcEnd:Math.max(i.pcEnd-r.startTime,0),pcStart:Math.max(i.pcStart-r.startTime,0),subscriberEnd:Math.max(i.subscriberEnd-r.startTime,0),subscriberStart:Math.max(i.subscriberStart-r.startTime,0),videoAddNotify:Math.max(i.videoAddNotify-r.startTime,0)});this.send({type:n,data:l},!0)}firstRemoteFrame(t,e,n,i){const r=this.baseInfoMap.get(t);if(!r)return;const s=r.info,c=Date.now(),l=ie(ie(ie({},s),i),{},{elapse:c-r.startTime,eventType:e,lts:c});this.send({type:n,data:l},!0)}abTest(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=ie(ie(ie({},i),e),{},{vid:i.vid===void 0?0:Number(i.vid),elapse:r-n.startTime,eventType:ai.AB_TEST,lts:r});this.send({type:pn.AB_TEST,data:s},!0)}pcStats(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=ie(ie(ie({},i),e),{},{vid:i.vid===void 0?0:Number(i.vid),elapse:r-n.startTime,eventType:ai.PC_STATS,lts:r,preallocation:e.preallocation?1:0});this.send({type:pn.PC_STATS,data:s},!0)}updateRemoteRTPCapabilities(t,e){if(t){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=ie(ie(ie({},i),e),{},{vid:i.vid===void 0?0:Number(i.vid),eventType:ai.UPDATE_REMOTE_RTPCAPABILITIES,lts:r});this.send({type:pn.UPDATE_REMOTE_RTPCAPABILITIES,data:s},!0)}}onGatewayStream(t,e,n,i){const r=this.baseInfoMap.get(t);if(!r)return;const s=r.info,c=Date.now(),l=ie(ie(ie({},s),i),{},{eventType:e,lts:c});this.send({type:n,data:l},!0)}streamSwitch(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=ie(ie({},i),{},{eventType:ai.STREAM_SWITCH,lts:r,isDual:e.isdual,elapse:r-n.startTime,success:e.succ});this.send({type:pn.STREAM_SWITCH,data:s},!0)}requestProxyAppCenter(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=ie(ie({},i),{},{eventType:ai.REQUEST_PROXY_APPCENTER,lts:r,eventElapse:r-e.lts,elapse:r-n.startTime,APAddr:e.APAddr,workerManagerList:e.workerManagerList,response:e.response,errorCode:e.ec,success:e.succ});this.send({type:pn.REQUEST_PROXY_APPCENTER,data:s},!0)}requestProxyWorkerManager(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=ie(ie({},i),{},{eventType:ai.REQUEST_PROXY_WORKER_MANAGER,lts:r,eventElapse:r-e.lts,elapse:r-n.startTime,workerManagerAddr:e.workerManagerAddr,response:e.response,errorCode:e.ec,success:e.succ});this.send({type:pn.REQUEST_PROXY_WORKER_MANAGER,data:s},!0)}setProxyServer(t){this.proxyServer=t,t?T.debug("reportProxyServerurl: ".concat(t)):T.debug("disable reportProxyServerurl: ".concat(t))}peerPublishStatus(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=ie(ie({},i),{},{subscribeElapse:e.subscribeElapse,peer:e.peer,peerPublishDuration:Math.max(e.audioPublishDuration,e.videoPublishDuration),audiotag:e.audioPublishDuration>0?1:-1,videotag:e.videoPublishDuration>0?1:-1,lts:r,elapse:r-n.startTime,joinChannelSuccessElapse:r-(n.lastJoinSuccessTime||r),peerPublishDurationVideo:e.videoPublishDuration,peerPublishDurationAudio:e.audioPublishDuration});this.send({type:pn.PEER_PUBLISH_STATUS,data:s},!0)}workerEvent(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now();(function(s,c,l){const d=s[c];if(!d||typeof d!="string")return[s];s[c]="";const h=gc(JSON.stringify(s));let p=0;const m=[];let _=0;for(let E=0;E<d.length;E++)_+=d.charCodeAt(E)<=127?1:3,_<=l-h||(m[m.length]=ut(ut({},s),{},{[c]:d.substring(p,E)}),p=E,_=d.charCodeAt(E)<=127?1:3);return p!==d.length-1&&(m[m.length]=ut(ut({},s),{},{[c]:d.substring(p)})),m})(ie(ie(ie({},i),e),{},{elapse:r-n.startTime,lts:r,productType:"WebRTC"}),"payload",1300).forEach(s=>this.send({type:pn.WORKER_EVENT,data:s},!0))}apworkerEvent(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=ie(ie(ie({},i),e),{},{elapse:r-n.startTime,lts:r});this.send({type:pn.AP_WORKER_EVENT,data:s},!0)}joinWebProxyAP(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=ie(ie(ie({},i),e),{},{elapse:r-n.startTime,lts:r,extend:e.extend||void 0});this.send({type:pn.JOIN_WEB_PROXY_AP,data:s},!0)}WebSocketQuit(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=ie(ie(ie({},i),e),{},{elapse:r-n.startTime,lts:r});this.send({type:pn.WEBSOCKET_QUIT,data:s},!0)}async sendCustomReportMessage(t,e){if(this.customReportCount+=e.length,this.customReportCount>k("CUSTOM_REPORT_LIMIT"))throw new Z(P.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const n=Date.now(),i=e.map(r=>({type:pn.USER_ANALYTICS,data:ie(ie({sid:t},r),{},{lts:n})}));try{k("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(i):await this.postDataToStatsCollector(i)}catch(r){throw T.error("send custom report message failed",r.toString()),new Z(P.CUSTOM_REPORT_SEND_FAILED,r.message)}}sendApiInvoke(t){const e=k("NOT_REPORT_EVENT");if(t.tag&&mt(e)&&mt(e).call(e,t.tag))return!1;if(t.sid===null)return this.apiInvokeUploadPendingItems.push(t),!1;const n=this.baseInfoMap.get(t.sid);if(!n)return this.apiInvokeUploadPendingItems.push(t),!1;const{cname:i,uid:r,cid:s}=n.info;let c;if(t.lts=t.lts||Date.now(),t.error)if(t.error instanceof Z){const{code:d,message:h}=t.error;c=d||h||t.error.toString()}else c=t.error.toString();const l={invokeId:t.invokeId,sid:t.sid,cname:i,cid:s,uid:r,lts:t.lts,success:t.success,elapse:t.lts-n.startTime,execElapse:t.lts-t.apiInvokeTime,apiName:t.name,options:t.options?JSON.stringify(t.options):void 0,execStates:t.states?JSON.stringify(t.states):void 0,execResult:t.result?JSON.stringify(t.result):void 0,errorCode:t.error?c:void 0,errorMsg:t.error?JSON.stringify(t.error):void 0};return this.send({type:pn.API_INVOKE,data:l},!1),!0}addSid(t){this.sids.add(t)}removeSid(t){this.sids.delete(t)}appendSessionId(){const t=this.apiInvokeUploadPendingItems;if(t.length===0)return;const e=Array.from(this.sids).find(n=>n!==null);e&&t.forEach(n=>{n&&(n.sid=e,this.sendApiInvoke(Object.assign({},n)))}),t.length=0}send(t,e){if(e)return this.keyEventUploadPendingItems.push(t),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(t),this.normalEventUploadPendingItems.length>k("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(t,e){const n=[],i=[];for(;t.length;){const s=t.shift();n.length<20?n.push(s):i.push(s)}t.push(...i);for(const s of[...n]){var r;this.ltsList.indexOf(s.data.lts)!==-1?(s.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(s.data.lts)):(this.ltsList.push(s.data.lts),Zt(r=this.ltsList).call(r,(c,l)=>c-l))}return e||(this.lastSendNormalEventTime=Date.now()),k("ENABLE_EVENT_REPORT")&&n.length&&(k("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(n):this.postDataToStatsCollector(n)).catch((s=>c=>{k("EVENT_REPORT_RETRY")&&(e?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(s):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(s),this.normalEventUploadPendingItems.length>k("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-k("NORMAL_EVENT_QUEUE_CAPACITY")),T.warning("report: drop normal events"))))})(n)),t}async postDataToStatsCollector2(t){Wn.networkState===la.OFFLINE&&await Tt.race([Wn.onlineWaiter,yi(2*Xn.maxRetryTimeout)]);const e=r=>{let s=new Uint8Array;return r.forEach(c=>{const l=HA(JSON.stringify(c.data)),d=new ArrayBuffer(5),h=(m=>{let _=0;return Object.entries(pn).forEach(E=>{let[I,C]=E;C===m.type&&(_=aG[I])}),_})(c),p=new DataView(d);p.setUint16(0,l.byteLength,!0),p.setUint8(2,255&h),p.setUint8(3,h>>>8&255),p.setUint8(4,h>>>16&255),s=iL(s,new Uint8Array(d)),s=iL(s,l)}),s},n="event";let i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(k("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(n):"https://".concat(k("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(n);for(let r=0;r<2;r+=1){r===1&&(i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(k("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(n):"https://".concat(k("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(n));try{await QA(i,{timeout:1e4,data:e(t),headers:ie(ie({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(s){if(r===1)throw s;continue}return}}async postDataToStatsCollector(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=(l=>{const d=l&&l.data.sid&&this.baseInfoMap.get(l.data.sid);return d&&d.info.vid&&+d.info.vid||0})(t[0]),i=n?void 0:this._aid,r={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:t.map(l=>JSON.stringify(l)),vid:n,aid:i};Wn.networkState===la.OFFLINE&&await Tt.race([Wn.onlineWaiter,yi(2*Xn.maxRetryTimeout)]);const s=e?"/events/proto-raws":"/events/messages";let c=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(k("EVENT_REPORT_DOMAIN"),"&p=").concat(k("STATS_COLLECTOR_PORT"),"&d=").concat(s):"https://".concat(k("EVENT_REPORT_DOMAIN"),":").concat(k("STATS_COLLECTOR_PORT")).concat(s));for(let l=0;l<2;l+=1){l===1&&(c=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(k("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(k("STATS_COLLECTOR_PORT"),"&d=").concat(s):"https://".concat(k("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(k("STATS_COLLECTOR_PORT")).concat(s)));try{e?await W6(c,{timeout:1e4,data:r}):await QA(c,{timeout:1e4,data:r})}catch(d){if(l===1)throw d;continue}return}}createBaseInfo(t,e){const n=Object.assign({},rG);return n.sid=t,this.baseInfoMap.set(t,{info:n,startTime:e}),n}reportResourceTiming(t,e){const n=performance.getEntriesByName(t),i=n[n.length-1];i&&this.reportApiInvoke(e,{name:"Client.resourceTiming",options:i,tag:_n.TRACER}).onSuccess()}};DL.on("REPORT_LOG_UPLOAD",t=>{t.networkState=Wn.networkState,Pt.reportApiInvoke(null,{name:"logUploadError",options:t,tag:_n.TRACER}).onSuccess("logUploadError")});class K extends Z{constructor(e){super(e,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),In(this,"name","AgoraRTCException")}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(e,T)}throw(){super.throw(T)}}const Ri={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function be(){return Ri}function LL(){return"setSinkId"in HTMLAudioElement.prototype&&(!k("RESTRICTION_SET_PLAYBACK_DEVICE")||(Tl()||zk())&&!BA())}function uR(){return!Ri.supportUnifiedPlan||k("CHROME_FORCE_PLAN_B")&&yl()}function cw(t){return!(An()||qk(87)||uR()||!k("ENABLE_PRE_SUB")&&(t==null||!t.autoSubscribe||k("FORCE_DISABLE_AUTO_SUB")))}function xL(t){return!!k("ENABLE_INSTANT_VIDEO")||!(t==null||!t.autoSubscribe||k("FORCE_DISABLE_AUTO_SUB"))}let bi=function(t){return t.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",t.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",t.IOS_INTERRUPTION_START="ios-interruption-start",t.IOS_INTERRUPTION_END="ios-interruption-end",t.STATE_CHANGE="state-change",t}({});function um(t,e,n){return{sampleRate:t,stereo:e,bitrate:n}}function Ce(t,e,n,i,r){return{width:t,height:e,frameRate:n,bitrateMin:i,bitrateMax:r}}function Ps(t,e,n,i,r){return{width:{max:t},height:{max:e},frameRate:n,bitrateMin:i,bitrateMax:r}}function lw(t,e){return{numSpatialLayers:t,numTemporalLayers:e}}const sG={"90p":Ce(160,90),"90p_1":Ce(160,90),"120p":Ce(160,120,15,30,65),"120p_1":Ce(160,120,15,30,65),"120p_3":Ce(120,120,15,30,50),"120p_4":Ce(212,120),"180p":Ce(320,180,15,30,140),"180p_1":Ce(320,180,15,30,140),"180p_3":Ce(180,180,15,30,100),"180p_4":Ce(240,180,15,30,120),"240p":Ce(320,240,15,40,200),"240p_1":Ce(320,240,15,40,200),"240p_3":Ce(240,240,15,40,140),"240p_4":Ce(424,240,15,40,220),"360p":Ce(640,360,15,80,400),"360p_1":Ce(640,360,15,80,400),"360p_3":Ce(360,360,15,80,260),"360p_4":Ce(640,360,30,80,600),"360p_6":Ce(360,360,30,80,400),"360p_7":Ce(480,360,15,80,320),"360p_8":Ce(480,360,30,80,490),"360p_9":Ce(640,360,15,80,800),"360p_10":Ce(640,360,24,80,800),"360p_11":Ce(640,360,24,80,1e3),"480p":Ce(640,480,15,100,500),"480p_1":Ce(640,480,15,100,500),"480p_2":Ce(640,480,30,100,1e3),"480p_3":Ce(480,480,15,100,400),"480p_4":Ce(640,480,30,100,750),"480p_6":Ce(480,480,30,100,600),"480p_8":Ce(848,480,15,100,610),"480p_9":Ce(848,480,30,100,930),"480p_10":Ce(640,480,10,100,400),"720p":Ce(1280,720,15,120,1130),"720p_auto":Ce(1280,720,30,900,3e3),"720p_1":Ce(1280,720,15,120,1130),"720p_2":Ce(1280,720,30,120,2e3),"720p_3":Ce(1280,720,30,120,1710),"720p_5":Ce(960,720,15,120,910),"720p_6":Ce(960,720,30,120,1380),"1080p":Ce(1920,1080,15,120,2080),"1080p_1":Ce(1920,1080,15,120,2080),"1080p_2":Ce(1920,1080,30,120,3e3),"1080p_3":Ce(1920,1080,30,120,3150),"1080p_5":Ce(1920,1080,60,120,4780),"1440p":Ce(2560,1440,30,120,4850),"1440p_1":Ce(2560,1440,30,120,4850),"1440p_2":Ce(2560,1440,60,120,7350),"4k":Ce(3840,2160,30,120,8910),"4k_1":Ce(3840,2160,30,120,8910),"4k_3":Ce(3840,2160,60,120,13500)},oG={"480p":Ps(640,480,5),"480p_1":Ps(640,480,5),"480p_2":Ps(640,480,30),"480p_3":Ps(640,480,15),"720p":Ps(1280,720,5),"720p_auto":Ce(1280,720,30,900,3e3),"720p_1":Ps(1280,720,5),"720p_2":Ps(1280,720,30),"720p_3":Ps(1280,720,15),"1080p":Ps(1920,1080,5),"1080p_1":Ps(1920,1080,5),"1080p_2":Ps(1920,1080,30),"1080p_3":Ps(1920,1080,15)},cG={"1SL1TL":lw(1,1),"3SL3TL":lw(3,3),"2SL3TL":lw(2,3)};function ks(t){return t||(t="480p_1"),typeof t=="string"?Object.assign({},sG[t]):t}function dw(t){return typeof t=="string"?Object.assign({},oG[t]):t}function hR(t){return typeof t=="string"?Object.assign({},cG[t]):t}const lG={speech_low_quality:um(16e3,!1),speech_standard:um(32e3,!1,18),music_standard:um(48e3,!1),standard_stereo:um(48e3,!0,56),high_quality:um(48e3,!1,128),high_quality_stereo:um(48e3,!0,192)};function pR(t){return typeof t=="string"?Object.assign({},lG[t]):t}const hm=[];function ML(t){return ri(t,"mediaSource",["screen","window","application"]),!0}let It=function(t){return t.NEED_RENEGOTIATE="@need_renegotiate",t.NEED_REPLACE_TRACK="@need_replace_track",t.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",t.NEED_CLOSE="@need_close",t.NEED_ENABLE_TRACK="@need_enable_track",t.NEED_DISABLE_TRACK="@need_disable_track",t.NEED_SESSION_ID="@need_sid",t.SET_OPTIMIZATION_MODE="@set_optimization_mode",t.GET_STATS="@get_stats",t.GET_RTC_STATS="@get_rtc_stats",t.GET_LOW_VIDEO_TRACK="@get_low_video_track",t.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",t.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",t.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",t.NEED_MUTE_TRACK="@need_mute_track",t.NEED_UNMUTE_TRACK="@need_unmute_track",t}({}),Ye=function(t){return t.SCREEN_TRACK="screen_track",t.CUSTOM_TRACK="custome_track",t.LOW_STREAM="low_stream",t.SCREEN_LOW_TRACK="screen_low_track",t}({}),pm=function(t){return t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM",t}({}),dG=function(t){return t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM",t[t.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",t[t.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",t[t.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",t[t.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",t[t.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",t[t.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",t}({}),uG=function(t){return t[t.DISABLE=0]="DISABLE",t[t.LOW_STREAM=1]="LOW_STREAM",t[t.AUDIO_ONLY=2]="AUDIO_ONLY",t[t.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",t[t.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",t[t.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",t[t.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",t[t.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",t[t.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",t}({}),Mh=function(t){return t.TRANSCEIVER_UPDATED="transceiver-updated",t.SEI_TO_SEND="sei-to-send",t.SEI_RECEIVED="sei-received",t.TRACK_UPDATED="track-updated",t}({}),fm=function(t){return t.SOURCE_STATE_CHANGE="source-state-change",t.TRACK_ENDED="track-ended",t.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.CLOSED="closed",t}({}),es=function(t){return t.FIRST_FRAME_DECODED="first-frame-decoded",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.VIDEO_STATE_CHANGED="video-state-changed",t.PLAY_START="play-start",t.PLAY_END="play-end",t.FIRST_FRAME_RENDER="first-frame-render",t}({}),mm=function(t){return t.AUDIO="audio",t.VIDEO="video",t.DATA="data",t}({}),wa=function(t){return t.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",t.RECEIVE_TRACK_BUFFER="receive_track_buffer",t.ON_AUDIO_BUFFER="on_audio_buffer",t.UPDATE_SOURCE="update_source",t}({});(function(t){t.UPDATE_TRACK_SOURCE="update-track-source"})({});const uw={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},hw={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},UL={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},hG={uplinkNetworkQuality:0,downlinkNetworkQuality:0},VL={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let gr=function(t){return t.ON_TRACK="on_track",t.ON_NODE="on_node",t}({}),Ia=function(t){return t.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",t.REQUEST_CONSTRAINTS="request_constraints",t}({}),Ug=function(t){return t.IDLE="IDLE",t.INITING="INITING",t.INITEND="INITEND",t}({}),Uh=function(t){return t.STATE_CHANGE="state_change",t.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",t.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",t.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",t}({}),zi=function(t){return t.NONE="none",t.INIT="init",t.CANPLAY="canplay",t.PLAYING="playing",t.PAUSED="paused",t.SUSPEND="suspend",t.STALLED="stalled",t.WAITING="waiting",t.ERROR="error",t.DESTROYED="destroyed",t.ABORT="abort",t.ENDED="ended",t.EMPTIED="emptied",t.LOADEDDATA="loadeddata",t}({}),Sc=function(t){return t[t.VideoStateStopped=0]="VideoStateStopped",t[t.VideoStateStarting=1]="VideoStateStarting",t[t.VideoStateDecoding=2]="VideoStateDecoding",t[t.VideoStateFrozen=3]="VideoStateFrozen",t}({});const pw={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let fR=function(t){return t.OPEN="open",t.MESSAGE="message",t.CLOSE="close",t.CLOSING="closing",t.ERROR="error",t}({});function Ee(t,e,n,i,r){var s,c,l={};return Object.keys(i).forEach(function(d){l[d]=i[d]}),l.enumerable=!!l.enumerable,l.configurable=!!l.configurable,("value"in l||l.initializer)&&(l.writable=!0),l=Vr(s=Pp(c=n.slice()).call(c)).call(s,function(d,h){return h(t,e,d)||d},l),r&&l.initializer!==void 0&&(l.value=l.initializer?l.initializer.call(r):void 0,l.initializer=void 0),l.initializer===void 0?(Object.defineProperty(t,e,l),null):l}function q(t,e,n){return(e=function(i){var r=function(s,c){if(typeof s!="object"||!s)return s;var l=s[Symbol.toPrimitive];if(l!==void 0){var d=l.call(s,"string");if(typeof d!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}(i);return typeof r=="symbol"?r:r+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function jL(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function rn(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?jL(Object(n),!0).forEach(function(i){q(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):jL(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}class BL extends Sn{set _mediaStreamTrack(e){e!==this.mediaStreamTrack&&(this.safeEmit(Mh.TRACK_UPDATED,e),this.mediaStreamTrack=e)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(e,n){super(),q(this,"trackMediaType",void 0),q(this,"_ID",void 0),q(this,"_rtpTransceiver",void 0),q(this,"_lowRtpTransceiver",void 0),q(this,"_hints",[]),q(this,"_isClosed",!1),q(this,"_originMediaStreamTrack",void 0),q(this,"mediaStreamTrack",void 0),q(this,"_external",{}),this._ID=n||Je(8,"track-"),this._originMediaStreamTrack=e,this.mediaStreamTrack=e,function(i){mt(hm).call(hm,i)||hm.push(i)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(e){return e||Fd(()=>{var n;Pt.reportApiInvoke(null,{name:kn.GET_MEDIA_STREAM_TRACK,options:[],tag:_n.TRACER}).onSuccess(((n=this._mediaStreamTrack)===null||n===void 0?void 0:n.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(e){return e===pm.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(e){const n=hm.indexOf(e);n!==-1&&hm.splice(n,1)}(this),this.emit(fm.CLOSED),this.removeAllListeners(Mh.SEI_RECEIVED)}_updateRtpTransceiver(e,n){if(n===pm.LOW_STREAM){if(this._lowRtpTransceiver===e)return;this._lowRtpTransceiver=e}else{if(this._rtpTransceiver===e)return;this._rtpTransceiver=e}this.emit(Mh.TRANSCEIVER_UPDATED,e,n)}}class _m extends BL{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(e,n){super(e,n),q(this,"_enabled",!0),q(this,"_muted",!1),q(this,"_isExternalTrack",!1),q(this,"_isClosed",!1),q(this,"_enabledMutex",void 0),q(this,"processor",void 0),q(this,"_processorContext",void 0),q(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new Wi("".concat(this.getTrackId())),e.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var e,n;return(e=(n=this._originMediaStreamTrack)===null||n===void 0?void 0:n.label)!==null&&e!==void 0?e:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,T.debug("[".concat(this.getTrackId(),"] close")),this.emit(It.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(e,n){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=i,e!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),n&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Qe(this,It.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){T.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(fm.TRACK_ENDED)}stateCheck(e,n){if(T.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(e,": ").concat(n,"]")),yo(n,e),this._enabled&&this._muted&&e==="enabled"&&n===!1)throw new Z(P.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",T);if(!this._enabled&&!this._muted&&e==="muted"&&n===!0)throw new Z(P.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",T)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():Tt.resolve([])}}const FL=window.AudioContext||window.webkitAudioContext;let Oa=null;const Ge=new class extends Sn{constructor(){super(...arguments),q(this,"prevState",void 0),q(this,"curState",void 0),q(this,"currentTime",void 0),q(this,"currentTimeStuckAt",void 0),q(this,"interruptDetectorTrack",void 0),q(this,"onLocalAudioTrackMute",()=>{T.info("ios15-interruption-start"),this.emit(bi.IOS_15_16_INTERRUPTION_START)}),q(this,"onLocalAudioTrackUnmute",async()=>{T.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?T.info("ios15-interruption-end-canceled"):(Oa&&await Oa.suspend(),this.emit(bi.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(t){T.debug("webaudio bindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=t,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(t){T.debug("webaudio unbindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===t&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function Em(){if(!Oa){if(function(){if(!FL)return void T.error("your browser is not support web audio");T.info("create audio context");const t=rn({},k("WEBAUDIO_INIT_OPTIONS"));T.debug("audio context init option:",JSON.stringify(t)),Oa=new FL(t),Ge.curState=Oa.state,Oa.onstatechange=()=>{Ge.prevState=Ge.curState,Ge.curState=Oa?Oa.state:void 0;const{prevState:e,curState:n}=Ge,i=n==="running",r=n==="interrupted",s=e==="running",c=e==="suspended",l=e==="interrupted",d=ve().osVersion;(rr()||Ns())&&s&&r&&(T.info("ios".concat(d,"-interruption-start")),Ge.emit(bi.IOS_INTERRUPTION_START)),(rr()||Ns())&&(c||l)&&i&&(T.info("ios".concat(d,"-interruption-end")),Ge.emit(bi.IOS_INTERRUPTION_END)),e!==n&&Ge.emit(bi.STATE_CHANGE,n,e)},setInterval(()=>{var e;const n=(e=Oa)===null||e===void 0?void 0:e.currentTime;Ge.currentTime!==n?(Ge.currentTimeStuckAt&&(T.debug("AudioContext current time resume at ".concat(n)),Ge.currentTimeStuckAt=void 0),Ge.currentTime=n):(n!==Ge.currentTimeStuckAt&&(Pt.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:n},tag:_n.TRACER}).onSuccess(),T.warning("AudioContext current time stuck at ".concat(n))),Ge.currentTimeStuckAt=n)},5e3),async function(e){const n=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let i,r=!1,s=!1,c=!1;function l(C){e.state==="running"?d(!1):rr()||Ns()?e.state==="suspended"&&(d(!0),C&&e.resume().then(h,h)):e.state!=="closed"&&(d(!0),C&&e.resume().then(h,h))}function d(C){if(r!==C){r=C;for(let w=0,D=n;w<D.length;w+=1){const N=D[w];C?window.addEventListener(N,p,{capture:!0,passive:!0}):window.removeEventListener(N,p,{capture:!0,passive:!0})}}}function h(){l(!1)}function p(){l(!0)}function m(C){if(!c)if(i.paused)if(C){let w;_(!1),c=!0;try{w=i.play(),w?w.then(E,E):(i.addEventListener("playing",E),i.addEventListener("abort",E),i.addEventListener("error",E))}catch{E()}}else _(!0);else _(!1)}function _(C){if(s!==C){s=C;for(let w=0,D=n;w<D.length;w++){const N=D[w];C?window.addEventListener(N,I,{capture:!0,passive:!0}):window.removeEventListener(N,I,{capture:!0,passive:!0})}}}function E(){i.removeEventListener("playing",E),i.removeEventListener("abort",E),i.removeEventListener("error",E),c=!1,m(!1)}function I(){m(!0)}if(rr()){const C=e.createMediaStreamDestination(),w=document.createElement("div");w.innerHTML="<audio x-webkit-airplay='deny'></audio>",i=w.children.item(0),i.controls=!1,i.disableRemotePlayback=!0,i.preload="auto",i.srcObject=C.stream,m(!0)}Ge.on(bi.STATE_CHANGE,function(){l(!0)}),l(!1)}(Oa)}(),!Oa)throw new Z(P.NOT_SUPPORTED,"can not create audio context");return Oa}return Oa}function Vh(t){if(function(){if(fw!==null)return fw;const i=Em(),r=i.createBufferSource(),s=i.createGain(),c=i.createGain();r.connect(s),r.connect(c),r.disconnect(s);let l=!1;try{r.disconnect(s)}catch{l=!0}return r.disconnect(),fw=l,l}())return;const e=t.connect,n=t.disconnect;t.connect=(i,r,s)=>{var c;return t._inputNodes||(t._inputNodes=[]),mt(c=t._inputNodes).call(c,i)||(i instanceof AudioNode?(t._inputNodes.push(i),e.call(t,i,r,s)):e.call(t,i,r)),t},t.disconnect=(i,r,s)=>{n.call(t),i?iR(t._inputNodes,i):t._inputNodes=[];for(const c of t._inputNodes)e.call(t,c)}}let fw=null;function mw(t,e){let n=!1;const i=1/e;if(k("DISABLE_WEBAUDIO")){const r=window.setInterval(()=>{n?window.clearInterval(r):t(performance.now()/1e3)},1e3*i)}else{const r=Em();let s=r.createGain();s.gain.value=0,s.connect(r.destination);const c=()=>{if(n)return void(s=null);const l=r.createOscillator();l.onended=c,l.connect(s),l.start(0),l.stop(r.currentTime+i),t(r.currentTime)};c()}return()=>{n=!0}}class GL{constructor(){q(this,"context",void 0),q(this,"analyserNode",void 0),q(this,"sourceNode",void 0),this.context=Em(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(e){if(e!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=e,e==null||e.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||rr()||Ns()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const e=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(e);else{const i=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(i);for(let r=0;r<e.length;++r)e[r]=i[r]/128-1}const n=Vr(e).call(e,(i,r)=>i+r*r,0)/e.length;return Math.max(10*Math.log10(n)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var e,n;(e=this.sourceNode)===null||e===void 0||e.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(n=this.sourceNode)===null||n===void 0||n.connect(this.analyserNode)}catch{T.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class HL extends Sn{get processSourceNode(){return this.sourceNode}set processedNode(e){var n;if(!this.isDestroyed&&this._processedNode!==e){try{var i;(i=this.sourceNode)===null||i===void 0||i.disconnect(this.outputNode)}catch{}(n=this._processedNode)===null||n===void 0||n.disconnect(),this._processedNode=e,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),q(this,"outputNode",void 0),q(this,"outputTrack",void 0),q(this,"isPlayed",!1),q(this,"sourceNode",void 0),q(this,"context",void 0),q(this,"audioBufferNode",void 0),q(this,"destNode",void 0),q(this,"audioOutputLevel",0),q(this,"volumeLevelAnalyser",void 0),q(this,"_processedNode",void 0),q(this,"playNode",void 0),q(this,"isDestroyed",!1),q(this,"onNoAudioInput",void 0),q(this,"isNoAudioInput",!1),q(this,"_noAudioInputCount",0),this.context=Em(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),Vh(this.outputNode),this.volumeLevelAnalyser=new GL}startGetAudioBuffer(e){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(e),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=n=>{this.emit(wa.ON_AUDIO_BUFFER,function(i){for(let r=0;r<i.outputBuffer.numberOfChannels;r+=1){const s=i.outputBuffer.getChannelData(r);for(let c=0;c<s.length;c+=1)s[c]=0}return i.inputBuffer}(n))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!be().webAudioMediaStreamDest)throw new Z(P.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(e){this.context.state!=="running"&&rR(()=>{Ge.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=e||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(e>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;rr()||Ns()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const n=this.volumeLevelAnalyser.getAnalyserNode();let i;n.getFloatTimeDomainData?(i=new Float32Array(n.fftSize),n.getFloatTimeDomainData(i)):(i=new Uint8Array(n.fftSize),n.getByteTimeDomainData(i));let r=!1;for(let s=0;s<i.length;s++)i[s]!==0&&(r=!0);return r?(this.isNoAudioInput=!1,!0):(await yi(200),await this.checkHasAudioInput(e?e+1:1)&&r)}getAudioVolume(){return this.outputNode.gain.value}setVolume(e){this.outputNode.gain.setValueAtTime(e,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var e,n;(e=this.processedNode)===null||e===void 0||e.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var e;this.processedNode?(e=this.processedNode)===null||e===void 0||e.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class WL extends HL{get isFreeze(){return!1}constructor(e,n,i){var r;if(super(),q(this,"sourceNode",void 0),q(this,"track",void 0),q(this,"clonedTrack",void 0),q(this,"audioElement",void 0),q(this,"isCurrentTrackCloned",!1),q(this,"isRemoteTrack",!1),q(this,"originVolumeLevelAnalyser",void 0),q(this,"rebuildWebAudio",async()=>{if(T.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void T.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>T.info("resume success")),T.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const l=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?l.stop():this.isCurrentTrackCloned=!0;const d=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(d),Vh(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const h=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(h,this.context.currentTime),Vh(this.outputNode),this.emit(wa.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=d,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),e.kind!=="audio")throw new Z(P.UNEXPECTED_ERROR);this.track=e;const s=new MediaStream([this.track]);if(this.isRemoteTrack=!!n,this.sourceNode=this.context.createMediaStreamSource(s),Vh(this.sourceNode),i){const l=i.clone();l.enabled=!0,this.clonedTrack=l,T.debug("create an unmuted track ".concat(l.id," from the original track ").concat(i.id," to get the volume"));const d=this.context.createMediaStreamSource(new MediaStream([l]));Vh(d),this.originVolumeLevelAnalyser=new GL,this.originVolumeLevelAnalyser.updateSource(d)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=s;const c=ve();n&&c.os===di.IOS&&Number((r=c.osVersion)===null||r===void 0?void 0:r.split(".")[0])<15&&(Ge.on(bi.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(l=>{l||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(e){this.sourceNode.disconnect(),this.track=e,this.isCurrentTrackCloned=!1;const n=new MediaStream([e]);this.sourceNode=this.context.createMediaStreamSource(n),Vh(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(wa.UPDATE_SOURCE),this.audioElement.srcObject=n}destroy(){var e;this.audioElement.srcObject=null,this.audioElement.remove(),Ge.off("state-change",this.rebuildWebAudio),(e=this.originVolumeLevelAnalyser)===null||e===void 0||e.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(e){return this.context.createMediaStreamSource(new MediaStream([e]))}updateOriginTrack(e){const n=e.clone();n.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=n),T.debug("create an unmuted track ".concat(n.id," from the original track ").concat(e.id," to get the volume"));const i=this.context.createMediaStreamSource(new MediaStream([n]));Vh(i),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(i)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function zL(t,e,n){const i=(s,c)=>s?typeof s!="number"?s.max||s.exact||s.ideal||s.min||c:s:c,r={audio:!!n&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxHeight:i(e.height,1080),maxWidth:i(e.width,1920)}}};return e.frameRate&&typeof e.frameRate!="number"?(r.video.mandatory.maxFrameRate=e.frameRate.max,r.video.mandatory.minFrameRate=e.frameRate.min):typeof e.frameRate=="number"&&(r.video.mandatory.maxFrameRate=e.frameRate),await navigator.mediaDevices.getUserMedia(r)}async function pG(t,e){const n=await qL(t.mediaSource),{sourceId:i,audio:r}=await function(s){let c=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new Tt((l,d)=>{const h=document.createElement("div");h.innerText="share screen",h.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const p=document.createElement("div");p.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const m=document.createElement("div");m.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",m.setAttribute("style","height: 12%;");const _=document.createElement("div");_.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const E=document.createElement("div");E.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const I=document.createElement("button");I.innerHTML="cancel",I.setAttribute("style","width: 85px;"),I.onclick=()=>{document.body.removeChild(D);const N=new Error("NotAllowedError");N.name="NotAllowedError",d(N)};let C=c;const w=document.createElement("div");if(c){const N=document.createElement("input");N.setAttribute("type","checkbox");const L=document.createElement("span");N.setAttribute("style","margin-right: 6px;"),L.innerText="Share audio",N.checked=C,N.onchange=()=>{C=N.checked},w.appendChild(N),w.appendChild(L)}E.appendChild(w),E.appendChild(I),p.appendChild(m),p.appendChild(_),p.appendChild(E);const D=document.createElement("div");D.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),D.appendChild(h),D.appendChild(p),document.body.appendChild(D),s.map(N=>{if(N.id){const L=document.createElement("div");L.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let W=N.thumbnail;try{const{width:G}=W.getSize();G>1920&&(W=W.resize({width:1920}))}catch(G){throw G&&G.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),G}L.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+W.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+N.name.replace(/[\u00A0-\u9999<>\&]/g,function(G){return"&#"+G.charCodeAt(0)+";"})+"</span>",L.onclick=()=>{document.body.removeChild(D),l({sourceId:N.id,audio:C})},_.appendChild(L)}})})}(n,e);return await zL(i,t,r)}async function qL(t){let e=["window","screen"];t!=="application"&&t!=="window"||(e=["window"]),t==="screen"&&(e=["screen"]);const n=rL();if(!n)throw console.error("failed to fetch electron, please mount it to window"),new Z(P.ELECTRON_IS_NULL);let i=null;try{var r;i=((r=n.desktopCapturer)===null||r===void 0?void 0:r.getSources({types:e}))||n.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:e})}catch{i=null}i&&i.then||(i=new Tt((s,c)=>{n.desktopCapturer.getSources({types:e},(l,d)=>{l?c(l):s(d)})}));try{return await i}catch(s){throw new Z(P.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,s.toString())}}const _w=new Wi("safari");let KL=!1,YL=!1;async function Na(t,e){let n=0,i=null;for(;n<2;)try{i=await fG(t,e,n>0);break}catch(r){if(r instanceof Z)throw T.error("[".concat(e,"] ").concat(r.toString())),r;const s=mR(r.name||r.code||r,r.message);if(s.code===P.MEDIA_OPTION_INVALID){T.debug("[".concat(e,"] detect media option invalid, retry")),n+=1,await yi(500);continue}throw T.error("[".concat(e,"] ").concat(s.toString())),s}if(!i)throw new Z(P.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return i}async function fG(t,e,n){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Z(P.NOT_SUPPORTED,"can not find getUserMedia");n&&(t.video&&(delete t.video.width,delete t.video.height),t.screen&&(delete t.screen.width,delete t.screen.height));const i=be(),r=new MediaStream;if(t.audioSource&&r.addTrack(t.audioSource),t.videoSource&&r.addTrack(t.videoSource),!t.audio&&!t.video&&!t.screen)return T.debug("Using Video Source/ Audio Source"),r;if(t.screen)if(rL())t.screen.sourceId?gm(r,await zL(t.screen.sourceId,t.screen,!!t.screenAudio)):gm(r,await pG(t.screen,!!t.screenAudio));else if(Tl()&&t.screen.extensionId&&t.screen.mandatory){if(!i.getStreamFromExtension)throw new Z(P.NOT_SUPPORTED,"This browser does not support screen sharing");T.debug("[".concat(e,'] Screen access on chrome stable, looking for extension"'));const _=await(c=t.screen.extensionId,l=e,new Tt((E,I)=>{try{chrome.runtime.sendMessage(c,{getStream:!0},C=>{if(!C||!C.streamId)return T.error("[".concat(l,"] No response from Chrome Plugin. Plugin not installed properly"),C),void I(new Z(P.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));E(C.streamId)})}catch(C){T.error("[".concat(l,"] AgoraRTC screensharing plugin is not accessible(").concat(c,")"),C.toString()),I(new Z(P.CHROME_PLUGIN_NOT_INSTALL))}}));t.screen.mandatory.chromeMediaSourceId=_,gm(r,await navigator.mediaDevices.getUserMedia({video:{mandatory:t.screen.mandatory}}))}else if(i.getDisplayMedia){var s;t.screen.mediaSource&&ML(t.screen.mediaSource);const _={width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate,displaySurface:(s=t.screen.displaySurface)!==null&&s!==void 0?s:t.screen.mediaSource==="screen"?"monitor":t.screen.mediaSource},{selfBrowserSurface:E,surfaceSwitching:I,systemAudio:C,preferCurrentTab:w}=t.screen,D={selfBrowserSurface:E,surfaceSwitching:I,systemAudio:C,preferCurrentTab:w};!E&&delete D.selfBrowserSurface,!I&&delete D.surfaceSwitching,!C&&delete D.systemAudio,!w&&delete D.preferCurrentTab,T.debug("[".concat(e,"] getDisplayMedia:"),JSON.stringify({video:_,audio:t.screenAudio,controls:D})),gm(r,await navigator.mediaDevices.getDisplayMedia(rn({video:_,audio:t.screenAudio},D)))}else{if(!An())throw T.error("[".concat(e,"] This browser does not support screenSharing")),new Z(P.NOT_SUPPORTED,"This browser does not support screen sharing");{t.screen.mediaSource&&ML(t.screen.mediaSource);const _={video:{mediaSource:t.screen.mediaSource,width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate}};T.debug("[".concat(e,"] getUserMedia: ").concat(JSON.stringify(_))),gm(r,await navigator.mediaDevices.getUserMedia(_))}}var c,l;if(!t.video&&!t.audio)return r;let d={video:t.video,audio:t.audio},h=k("MEDIA_DEVICE_CONSTRAINTS");if(h)try{typeof h=="string"&&(h=JSON.parse(h)),d=qA(d,h)}catch{}T.debug("[".concat(e,"] GetUserMedia"),JSON.stringify(d)),ve();let p,m=null;(Di()||rr()||eR())&&(m=await _w.lock());try{p=await navigator.mediaDevices.getUserMedia(d)}catch(_){throw m&&m(),_}return d.audio&&(KL=!0),d.video&&(YL=!0),gm(r,p),m&&m(),r}function mR(t,e){switch(t){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new Z(P.MEDIA_OPTION_INVALID,"".concat(t,": ").concat(e));case"NotFoundError":case"DevicesNotFoundError":return new Z(P.DEVICE_NOT_FOUND,"".concat(t,": ").concat(e));case"NotSupportedError":return new Z(P.NOT_SUPPORTED,"".concat(t,": ").concat(e));case"NotReadableError":return new Z(P.NOT_READABLE,"".concat(t,": ").concat(e));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new Z(P.PERMISSION_DENIED,"".concat(t,": ").concat(e));case"ConstraintNotSatisfiedError":return new Z(P.CONSTRAINT_NOT_SATISFIED,"".concat(t,": ").concat(e));default:return T.error("getUserMedia unexpected error",t),new Z(P.UNEXPECTED_ERROR,"".concat(t,": ").concat(e))}}function gm(t,e){const n=t.getVideoTracks()[0],i=t.getAudioTracks()[0],r=e.getVideoTracks()[0],s=e.getAudioTracks()[0];s&&(i&&t.removeTrack(i),t.addTrack(s)),r&&(n&&t.removeTrack(n),t.addTrack(r))}const Da=new class extends Sn{get state(){return this._state}set state(t){t!==this._state&&(this.emit(Uh.STATE_CHANGE,t),this._state=t)}constructor(){super(),q(this,"_state",Ug.IDLE),q(this,"isAccessMicrophonePermission",!1),q(this,"isAccessCameraPermission",!1),q(this,"lastAccessMicrophonePermission",!1),q(this,"lastAccessCameraPermission",!1),q(this,"checkdeviceMatched",!1),q(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(k("ENUMERATE_DEVICES_INTERVAL")||(nR()||tR()===di.HARMONY_OS)&&yl())&&this.updateDevicesInfo()},k("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(t=>T.error(t.toString()))}async enumerateDevices(t,e){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new Z(P.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const i=await navigator.mediaDevices.enumerateDevices(),r=this.checkMediaDeviceInfoIsOk(i);let s=!this.isAccessMicrophonePermission&&t,c=!this.isAccessCameraPermission&&e;r.audio&&(s=!1),r.video&&(c=!1);let l=null,d=null,h=null;if(!n&&(s||c)){if(_w.isLocked&&(T.debug("[device manager] wait GUM lock"),(await _w.lock())(),T.debug("[device manager] GUM unlock")),KL&&(s=!1,this.isAccessMicrophonePermission=!0),YL&&(c=!1,this.isAccessCameraPermission=!0),T.debug("[device manager] check media device permissions",t,e,s,c),s&&c){try{h=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(p){const m=mR(p.name||p.code||p,p.message);if(m.code===P.PERMISSION_DENIED)throw m;T.warning("getUserMedia failed in getDevices",m)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(s){try{l=await navigator.mediaDevices.getUserMedia({audio:t})}catch(p){const m=mR(p.name||p.code||p,p.message);if(m.code===P.PERMISSION_DENIED)throw m;T.warning("getUserMedia failed in getDevices",m)}this.isAccessMicrophonePermission=!0}else if(c){try{d=await navigator.mediaDevices.getUserMedia({video:e})}catch(p){const m=mR(p.name||p.code||p,p.message);if(m.code===P.PERMISSION_DENIED)throw m;T.warning("getUserMedia failed in getDevices",m)}this.isAccessCameraPermission=!0}T.debug("[device manager] mic permission",t,"cam permission",e)}try{const p=await navigator.mediaDevices.enumerateDevices();return l&&l.getTracks().forEach(m=>m.stop()),d&&d.getTracks().forEach(m=>m.stop()),h&&h.getTracks().forEach(m=>m.stop()),l=null,d=null,h=null,p}catch(p){return l&&l.getTracks().forEach(m=>m.stop()),d&&d.getTracks().forEach(m=>m.stop()),h&&h.getTracks().forEach(m=>m.stop()),l=null,d=null,h=null,new Z(P.ENUMERATE_DEVICES_FAILED,p.toString()).throw()}}async getRecordingDevices(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter(e=>e.kind==="audioinput")}async getCamerasDevices(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,t)).filter(e=>e.kind==="videoinput")}async getSpeakers(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter(e=>e.kind==="audiooutput")}searchDeviceIdByName(t){let e=null;return this.deviceInfoMap.forEach(n=>{n.device.label===t&&(e=n.device.deviceId)}),e}async getDeviceById(t){const e=(await this.enumerateDevices(!0,!0,!0)).find(n=>n.deviceId===t);if(!e)throw new Z(P.DEVICE_NOT_FOUND,"deviceId: ".concat(t));return e}async init(){this.state=Ug.INITING;try{await this.updateDevicesInfo(),this.state=Ug.INITEND}catch(t){throw T.warning("Device Detection functionality cannot start properly.",t.toString()),this.state=Ug.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new Z(P.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),t}}async updateDevicesInfo(){const t=await this.enumerateDevices(!0,!0,!0),e=Date.now(),n=[];if(t[0]&&t[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const r=t.find(c=>c.kind==="audioinput"&&c.deviceId==="default"),s=t.find(c=>c.kind==="audiooutput"&&c.deviceId==="default");r&&s?s.groupId===r.groupId?T.debug("[device-check] default input ".concat(r.label," and output ").concat(s.label," is the same group")):T.debug("[device-check] default input ".concat(r.label," and output ").concat(s.label," is not the same group")):T.debug("[device-check] default input or output not found")}const i=this.checkMediaDeviceInfoIsOk(t);if(t.forEach(r=>{if(!r.deviceId)return;const s=this.deviceInfoMap.get("".concat(r.kind,"_").concat(r.deviceId));if((s?s.state:"INACTIVE")!=="ACTIVE"){const c={initAt:e,updateAt:e,device:r,state:"ACTIVE"};this.deviceInfoMap.set("".concat(r.kind,"_").concat(r.deviceId),c),n.push(c)}s&&(s.updateAt=e)}),this.deviceInfoMap.forEach((r,s)=>{r.state==="ACTIVE"&&r.updateAt!==e&&(r.state="INACTIVE",n.push(r))}),this.state!==Ug.INITEND)return i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));n.forEach(r=>{switch(r.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Uh.RECORDING_DEVICE_CHANGED,r);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(Uh.CAMERA_DEVICE_CHANGED,r);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Uh.PLAYOUT_DEVICE_CHANGED,r)}}),i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(t){const e=t.filter(r=>r.kind==="audioinput"),n=t.filter(r=>r.kind==="videoinput"),i={audio:!1,video:!1};for(const r of e)if(r.label&&r.deviceId){i.audio=!0;break}for(const r of n)if(r.label&&r.deviceId){i.video=!0;break}return i}};let Ew=!1;const Pa=new class extends Sn{constructor(){super(...arguments),q(this,"onAutoplayFailed",void 0),q(this,"onAudioAutoplayFailed",void 0)}};function XL(){if(ve(),!Ew){const t=e=>{e.preventDefault(),Ew=!1,wg()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};Ew=!0,wg()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),T.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),Pa.onAutoplayFailed?Pa.onAutoplayFailed():Pa.onAudioAutoplayFailed?T.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):T.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),Pa.emit("autoplay-failed")}}function QL(t,e,n,i){if(!t)return;const r=Pt.getBaseInfoBySessionId(t);if(!r)return;const s=r.info,c=Date.now(),l=rn(rn({},s),{},{vid:s.vid===void 0?0:Number(s.vid),lts:c,elapse:c-r.startTime,cbRegistered:Pa.onAutoplayFailed||Pa.onAudioAutoplayFailed?1:-1,errorMsg:n,mediaType:e,trackId:i,extend:void 0});Pt.send({type:pn.AUTOPLAY_FAILED,data:l},!0)}const mG=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],Or=new class{constructor(){q(this,"onAutoplayFailed",void 0),q(this,"elementMap",new Map),q(this,"elementStateMap",new Map),q(this,"elementsNeedToResume",[]),q(this,"sinkIdMap",new Map),q(this,"autoResumeAfterInterruption",t=>{Array.from(this.elementMap.entries()).forEach(e=>{let[n,i]=e;const r=this.elementStateMap.get(n),s=i.srcObject.getAudioTracks()[0],c=s&&s.readyState;if(T.debug("resume after interrupted, ele: ".concat(r," audio: ").concat(c," ").concat(t)),c==="live"){if(t)return i.pause(),void i.play();if(Ge.curState==="running")return rm()?(i.pause(),void i.play()):void(r&&r==="paused"&&i.play())}})}),q(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(t=>{let[e,n]=t;const i=n.srcObject.getAudioTracks()[0];i&&i.readyState==="live"&&(T.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),n.pause(),n.play())})}),this.autoResumeAudioElement(),Ge.on(bi.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Ge.on(bi.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),Ge.on(bi.STATE_CHANGE,()=>{rr()&&Ge.prevState==="suspended"&&Ge.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(t,e){const n=this.elementMap.get(t);if(this.sinkIdMap.set(t,e),n)try{await n.setSinkId(e)}catch(i){throw new Z(P.PERMISSION_DENIED,"can not set sink id: "+i.toString())}}play(t,e,n,i){if(this.elementMap.has(e))return;const r=document.createElement("audio");r.autoplay=!0,r.srcObject=new MediaStream([t]),this.bindAudioElementEvents(e,r),this.elementMap.set(e,r),this.elementStateMap.set(e,zi.INIT),this.setVolume(e,n);const s=this.sinkIdMap.get(e);if(s)try{r.setSinkId(s).catch(l=>{T.warning("[".concat(e,"] set sink id failed"),l.toString())})}catch(l){T.warning("[".concat(e,"] set sink id failed"),l.toString())}const c=r.play();c&&c.then&&c.catch(l=>{i&&QL(i,"audio",l.message,e),T.warning("audio element play warning",l.toString()),this.elementMap.has(e)&&l.name==="NotAllowedError"&&(T.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(r),rR(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),XL()}))})}updateTrack(t,e){const n=this.elementMap.get(t);n&&(n.srcObject=new MediaStream([e]))}isPlaying(t){return this.elementMap.has(t)&&this.elementStateMap.get(t)==="playing"}setVolume(t,e){const n=this.elementMap.get(t);n&&(e=Math.max(0,Math.min(100,e)),n.volume=e/100)}stop(t){const e=this.elementMap.get(t);if(this.sinkIdMap.delete(t),!e)return;const n=this.elementsNeedToResume.indexOf(e);this.elementsNeedToResume.splice(n,1),e.srcObject=null,e.remove(),this.elementMap.delete(t),this.elementStateMap.delete(t)}bindAudioElementEvents(t,e){mG.forEach(n=>{e.addEventListener(n,i=>{const r=this.elementStateMap.get(t),s=i.type==="pause"?"paused":i.type;if(T.debug("[".concat(t,"] audio-element-status change ").concat(r," => ").concat(s)),i.type==="error"){const c=e==null?void 0:e.error;c&&T.error("[".concat(t,"] media error, code: ").concat(c.code,", message: ").concat(c.message))}this.elementStateMap.set(t,s)})})}getPlayerState(t){return this.elementStateMap.get(t)||"uninit"}autoResumeAudioElement(){const t=()=>{this.elementsNeedToResume.forEach(e=>{e.play().then(n=>{T.debug("Auto resume audio element success")}).catch(n=>{T.warning("Auto resume audio element failed!",n)})}),this.elementsNeedToResume=[]};new Tt(e=>{document.body?e():window.addEventListener("load",()=>e())}).then(()=>{wg()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0))})}};function On(){return function(t,e,n){const i=n.value;return typeof i=="function"&&(n.value=function(){this._isClosed&&new Z(P.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",T);for(var r=arguments.length,s=new Array(r),c=0;c<r;c++)s[c]=arguments[c];const l=i.apply(this,s);return l instanceof Tt?new Tt((d,h)=>{l.then(d).catch(h)}):l}),n}}class JL extends Sn{constructor(e){super(),q(this,"name","VideoProcessorDestination"),q(this,"ID","0"),q(this,"_source",void 0),q(this,"videoContext",void 0),q(this,"inputTrack",void 0),this.videoContext=e}get kind(){return"video"}get enabled(){return!0}pipe(){throw new Z(P.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new Z(P.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(e){if(e.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);e.track&&e.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=e.track,this.emit(gr.ON_TRACK,e.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(gr.ON_TRACK,void 0)}}class ZL extends Sn{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,n){super(),q(this,"constraintsMap",new Map),q(this,"statsRegistry",[]),q(this,"usageRegistry",[]),q(this,"trackId",void 0),q(this,"direction",void 0),q(this,"_chained",!1),this.trackId=e,this.direction=n}async getConstraints(){return await ki(this,Ia.REQUEST_CONSTRAINTS)}async requestApplyConstraints(e,n){var i;return T.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(n,e),Qe(this,Ia.REQUEST_UPDATE_CONSTRAINTS,Array.from(wr(i=this.constraintsMap).call(i)))}async requestRevertConstraints(e){var n;if(this.constraintsMap.has(e))return T.info("processor ".concat(e.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(e),Qe(this,Ia.REQUEST_UPDATE_CONSTRAINTS,Array.from(wr(n=this.constraintsMap).call(n)))}registerStats(e,n,i){this.statsRegistry.find(r=>r.processorID===e.ID&&r.processorName===e.name&&r.type===n)||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:n,cb:i})}unregisterStats(e,n){const i=this.statsRegistry.findIndex(r=>r.processorID===e.ID&&r.processorName===e.name&&r.type===n);i!==-1&&this.statsRegistry.splice(i,1)}gatherStats(){const e=[];for(const{processorID:n,processorName:i,type:r,cb:s}of this.statsRegistry)try{const c=s();e.push({processorID:n,processorName:i,type:r,stats:c})}catch(c){T.error(new Z(P.UNEXPECTED_ERROR,c.message))}return e}registerUsage(e,n){this.usageRegistry.find(i=>i.processorID===e.ID&&i.processorName===e.name)||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:n})}unregisterUsage(e){const n=this.usageRegistry.findIndex(i=>i.processorID===e.ID&&i.processorName===e.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const e=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let i=n();i instanceof Tt&&(i=await i),e.push(rn(rn({},i),{},{direction:this.direction}))}catch(i){T.error("gather extension usage error",i)}return e}getDirection(){return this.direction}}class $L extends Sn{constructor(e){super(),q(this,"name","AudioProcessorDestination"),q(this,"ID","0"),q(this,"inputTrack",void 0),q(this,"inputNode",void 0),q(this,"audioProcessorContext",void 0),q(this,"_source",void 0),this.audioProcessorContext=e}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new Z(P.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new Z(P.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(gr.ON_TRACK,void 0),this.emit(gr.ON_NODE,void 0)}updateInput(e){if(e.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);e.track&&this.inputTrack!==e.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=e.track,this.emit(gr.ON_TRACK,this.inputTrack)),e.node&&this.inputNode!==e.node&&(this.audioProcessorContext.chained=!0,this.inputNode=e.node,this.emit(gr.ON_NODE,this.inputNode))}}class t1 extends Sn{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,n,i){super(),q(this,"constraintsMap",new Map),q(this,"statsRegistry",[]),q(this,"audioContext",void 0),q(this,"trackId",void 0),q(this,"direction",void 0),q(this,"usageRegistry",[]),q(this,"_chained",!1),this.audioContext=e,this.trackId=n,this.direction=i}async getConstraints(){return ki(this,Ia.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(e,n){var i;return T.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(n,e),Qe(this,Ia.REQUEST_UPDATE_CONSTRAINTS,Array.from(wr(i=this.constraintsMap).call(i)))}async requestRevertConstraints(e){var n;if(this.constraintsMap.has(e))return this.constraintsMap.delete(e),Qe(this,Ia.REQUEST_UPDATE_CONSTRAINTS,Array.from(wr(n=this.constraintsMap).call(n)))}registerStats(e,n,i){this.statsRegistry.find(r=>r.processorID===e.ID&&r.processorName===e.name&&r.type===n)||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:n,cb:i})}unregisterStats(e,n){const i=this.statsRegistry.findIndex(r=>r.processorID===e.ID&&r.processorName===e.name&&r.type===n);i!==-1&&this.statsRegistry.splice(i,1)}gatherStats(){const e=[];for(const{processorID:n,processorName:i,type:r,cb:s}of this.statsRegistry)try{const c=s();e.push({processorID:n,processorName:i,type:r,stats:c})}catch(c){T.error(new Z(P.UNEXPECTED_ERROR,c.message))}return e}registerUsage(e,n){this.usageRegistry.find(i=>i.processorID===e.ID&&i.processorName===e.name)||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:n})}unregisterUsage(e){const n=this.usageRegistry.findIndex(i=>i.processorID===e.ID&&i.processorName===e.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const e=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let i=n();i instanceof Tt&&(i=await i),e.push(rn(rn({},i),{},{direction:this.direction}))}catch(i){T.error("gather extension usage error",i)}return e}getDirection(){return this.direction}}class gw extends Sn{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),q(this,"context",void 0),q(this,"processSourceNode",void 0),q(this,"outputTrack",void 0),q(this,"processedNode",void 0),q(this,"clonedTrack",void 0),q(this,"outputNode",void 0),this.outputNode=new _G}setVolume(){}createOutputTrack(){throw new Z(P.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class _G{disconnect(){}connect(){}}function e1(t){return new Tt((e,n)=>{let i=!1;const r=document.createElement("video");r.setAttribute("autoplay",""),r.setAttribute("muted",""),r.muted=!0,r.autoplay=!0,r.setAttribute("playsinline",""),r.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(r);const s=rr()?"canplay":"playing";r.addEventListener(s,()=>{const c=r.videoWidth,l=r.videoHeight;!c&&An()||(i=!0,r.srcObject=null,r.remove(),e([c,l]))}),r.srcObject=new MediaStream([t]),r.play().catch(aR),setTimeout(()=>{i||(r.srcObject=null,r.remove(),e([r.videoWidth,r.videoHeight]))},4e3)})}function _R(t){const e={};t.facingMode&&(e.facingMode=t.facingMode),t.cameraId&&(e.deviceId={exact:t.cameraId});const n=ks(t.encoderConfig);return n.width!=null&&(e.width=n.width),n.height!=null&&(e.height=n.height),!$k()&&n.frameRate&&(e.frameRate=n.frameRate),zk()&&typeof e.frameRate=="object"&&(e.frameRate.max=60),An()&&(e.frameRate={ideal:30,max:30}),e}function n1(t){const e={};return $k()||(t.AGC!==void 0&&(e.autoGainControl=t.AGC),t.AEC!==void 0&&(e.echoCancellation=t.AEC),t.ANS!==void 0&&(e.noiseSuppression=t.ANS,Tl()&&t.ANS&&(e.googHighpassFilter=t.ANS))),e}function i1(t){const e=n1(t);if(t.encoderConfig){const n=pR(t.encoderConfig);e.channelCount=n.stereo?2:1,e.sampleRate=n.sampleRate,e.sampleSize=n.sampleSize}return t.microphoneId&&(e.deviceId={exact:t.microphoneId}),nR()&&(e.sampleRate=void 0),e}const EG=t=>{const e=t._encoderConfig;if(!e)return;const{frameRate:n,width:i,height:r}=t.getMediaStreamTrackSettings();let{frameRate:s=n,width:c=i,height:l=r}=e;if(!s||!c||!l)return;c=om(c),l=om(l),s=om(s);const{max:d,min:h}=function(E,I,C){const w=200*Math.pow(C/15,.6)*Math.pow(E*I/640/360,.75);return{min:Math.floor(w),max:Math.floor(4*w)}}(c,l,s),{bitrateMax:p,bitrateMin:m}=e||{};p||T.debug("calculate bitrate: [w: ".concat(c,", h: ").concat(l,", fps: ").concat(s,"] => [brMax: ").concat(p,", brMin: ").concat(m,"]"));const{maxFramerate:_}=k("ENCODER_CONFIG_LIMIT");return _&&typeof _=="number"&&(s=Math.min(s,_)),{frameRate:s,bitrateMax:p||d,bitrateMin:m||h,scaleResolutionDownBy:1,scale:0}},r1=async(t,e,n)=>await(async(i,r,s)=>{const c=function(h){const p=[];for(let m=0;m<h.length;m+=2)p.push(parseInt(h.slice(m,m+2),16));return Uint8Array.from(p)}(mL(""+r+s)).slice(0,16),l=c.slice(0,12),d=await window.crypto.subtle.importKey("raw",c,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:l},d,i))})(t.buffer,e,n),vw=t=>{const e=document.createElement("canvas");return e.width=2,e.height=2,new Tt((n,i)=>{e.toBlob(async r=>{if(e.remove(),r){const s=await a1(r);n({buffer:s,width:e.width,height:e.height})}else i(new Z(P.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,1)})},a1=async t=>{const e=await t.arrayBuffer();return new Uint8Array(e)};var s1,o1,c1,l1,d1,u1,h1,p1,f1,m1,_1,E1,g1,v1,S1,T1,y1,R1,Tn,b1,C1,A1,w1,I1,O1,Tc,N1,D1,P1,k1,L1,x1,M1,U1,V1,j1,B1,F1,G1,xi;let Nn=(s1=Bt({argsMap:(t,e)=>[t.getTrackId(),e],throttleTime:300}),o1=Bt({argsMap:(t,e)=>[t.getTrackId(),e]}),c1=On(),l1=cm("LocalAudioTrack","_enabledMutex"),d1=Bt({argsMap:(t,e)=>[t.getTrackId(),e]}),u1=On(),h1=cm("LocalAudioTrack","_enabledMutex"),p1=Bt({argsMap:(t,e)=>[t.getTrackId(),e]}),f1=On(),m1=On(),_1=On(),E1=Bt({argsMap:t=>[t.getTrackId()]}),g1=On(),v1=Bt({argsMap:t=>[t.getTrackId()]}),S1=On(),T1=Bt({argsMap:t=>[t.getTrackId()]}),y1=Bt({argsMap:(t,e)=>[t.getTrackId(),e.name]}),R1=Bt({argsMap:t=>[t.getTrackId()]}),Ee((Tn=class extends _m{get _source(){return this.initWebAudio()}set _source(t){this._trackSource=t}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?Or.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(t,e,n,i){super(t,n),q(this,"trackMediaType",mm.AUDIO),q(this,"_encoderConfig",void 0),q(this,"_trackSource",void 0),q(this,"metadata",[]),q(this,"_enabled",!0),q(this,"_volume",100),q(this,"_useAudioElement",!0),q(this,"_bypassWebAudio",!1),q(this,"processor",void 0),q(this,"_processorContext",void 0),q(this,"_processorDestination",void 0),q(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=e,this._getOriginVolumeLevel=!!i,this._trackSource=new gw,k("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),k("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),Di()&&!Oa?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(t){Ke(t,"volume",0,1e3),this._volume=t,this._source.setVolume(t/100),this._useAudioElement&&Or.setVolume(this.getTrackId(),t);try{if(this._bypassWebAudio)return void T.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const e=this._source.createOutputTrack();this._mediaStreamTrack!==e&&(this._mediaStreamTrack=e,Qe(this,It.NEED_REPLACE_TRACK,this).then(()=>{T.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(n=>{T.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),n)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(t){if(!this._useAudioElement||!LL())throw new Z(P.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Or.setSinkID(this.getTrackId(),t)}async setEnabled(t,e,n){return this._setEnabled(t,e,n)}async _setEnabled(t,e,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(T.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){this._originMediaStreamTrack.enabled=!0;try{n||(this._enabled=!0),await Qe(this,It.NEED_ENABLE_TRACK,this),T.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(t," success"))}catch(i){throw n||(this._enabled=!1),T.error("[".concat(this.getTrackId(),"] setEnabled to true error"),i.toString()),i}}else{this._originMediaStreamTrack.enabled=!1,n||(this._enabled=!1);try{await Qe(this,It.NEED_DISABLE_TRACK,this)}catch(i){throw n||(this._enabled=!0),T.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}}}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,T.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await Qe(this,It.NEED_MUTE_TRACK,this):await Qe(this,It.NEED_UNMUTE_TRACK,this))}getStats(){return Fd(()=>{T.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),Ca(this,It.GET_STATS)||rn({},uw)}setAudioFrameCallback(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(wa.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(e),this._source.removeAllListeners(wa.ON_AUDIO_BUFFER),this._source.on(wa.ON_AUDIO_BUFFER,n=>t(n))}play(){T.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(T.debug("[".concat(this.getTrackId(),"] start audio playback in element")),Or.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){T.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Or.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];T.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Or.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(t,e){this._originMediaStreamTrack!==t&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),e&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:t,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Qe(this,It.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(t))}renewMediaStreamTrack(t){return Tt.resolve(void 0)}pipe(t){if(this._bypassWebAudio)throw new Z(P.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===t)return t;if(t._source)throw new Z(P.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(!this.processor)return;const e=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(t){t.on(gr.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e),await Qe(this,It.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Qe(this,It.NEED_REPLACE_TRACK,this))}),t.on(gr.ON_NODE,e=>{this._source.processedNode=e})}unbindProcessorDestinationEvents(t){t.removeAllListeners(gr.ON_TRACK),t.removeAllListeners(gr.ON_NODE)}bindProcessorContextEvents(t){t.on(Ia.REQUEST_CONSTRAINTS,async e=>{e(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(t){t.removeAllListeners(Ia.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof gw&&(this._trackSource=new WL(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const t=new t1(this._source.context,this.getTrackId(),"local"),e=new $L(t);return this._processorContext=t,this._processorDestination=e,this.bindProcessorContextEvents(t),this.bindProcessorDestinationEvents(e),this._source.on(wa.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:t})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(Or.stop(this.getTrackId()),this._source.play()),Qe(this,It.NEED_REPLACE_MIXING_TRACK,this).then(()=>{T.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(n=>{T.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),n)})),{processorContext:t,processorDestination:e}}}).prototype,"setVolume",[s1],Object.getOwnPropertyDescriptor(Tn.prototype,"setVolume"),Tn.prototype),Ee(Tn.prototype,"setPlaybackDevice",[o1,c1],Object.getOwnPropertyDescriptor(Tn.prototype,"setPlaybackDevice"),Tn.prototype),Ee(Tn.prototype,"setEnabled",[l1,d1,u1],Object.getOwnPropertyDescriptor(Tn.prototype,"setEnabled"),Tn.prototype),Ee(Tn.prototype,"setMuted",[h1,p1,f1],Object.getOwnPropertyDescriptor(Tn.prototype,"setMuted"),Tn.prototype),Ee(Tn.prototype,"getStats",[m1],Object.getOwnPropertyDescriptor(Tn.prototype,"getStats"),Tn.prototype),Ee(Tn.prototype,"setAudioFrameCallback",[_1],Object.getOwnPropertyDescriptor(Tn.prototype,"setAudioFrameCallback"),Tn.prototype),Ee(Tn.prototype,"play",[E1,g1],Object.getOwnPropertyDescriptor(Tn.prototype,"play"),Tn.prototype),Ee(Tn.prototype,"stop",[v1,S1],Object.getOwnPropertyDescriptor(Tn.prototype,"stop"),Tn.prototype),Ee(Tn.prototype,"close",[T1],Object.getOwnPropertyDescriptor(Tn.prototype,"close"),Tn.prototype),Ee(Tn.prototype,"pipe",[y1],Object.getOwnPropertyDescriptor(Tn.prototype,"pipe"),Tn.prototype),Ee(Tn.prototype,"unpipe",[R1],Object.getOwnPropertyDescriptor(Tn.prototype,"unpipe"),Tn.prototype),Tn),Vg=(b1=Bt({argsMap:(t,e)=>[t.getTrackId(),e]}),C1=On(),A1=cm("MicrophoneAudioTrack","_enabledMutex"),w1=Bt({argsMap:(t,e,n)=>[t.getTrackId(),e,n]}),I1=On(),O1=Bt({argsMap:t=>[t.getTrackId()]}),Ee((Tc=class extends Nn{get __className__(){return"MicrophoneAudioTrack"}constructor(t,e,n,i){super(t,e.encoderConfig?pR(e.encoderConfig):{},i,k("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),q(this,"_config",void 0),q(this,"_deviceName","default"),q(this,"_constraints",void 0),q(this,"_originalConstraints",void 0),q(this,"_enabled",!0),this._config=e,this._constraints=n,this._originalConstraints=n,this._deviceName=t.label,typeof e.bypassWebAudio=="boolean"&&(this._bypassWebAudio=e.bypassWebAudio),(rm()||jA())&&Ge.bindInterruptDetectorTrack(this)}async setDevice(t){if(T.info("[".concat(this.getTrackId(),"] start set device to ").concat(t)),this._enabled)try{const e=await Da.getDeviceById(t),n={};n.audio=rn({},this._constraints),n.audio.deviceId={exact:t},this._originMediaStreamTrack.stop();let i=null;try{i=await Na(n,this.getTrackId())}catch(r){throw T.error("[".concat(this.getTrackId(),"] setDevice failed"),r.toString()),i=await Na({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),r}await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),this._deviceName=e.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(e){throw T.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}else try{const e=await Da.getDeviceById(t);this._deviceName=e.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(e){throw T.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}T.info("[".concat(this.getTrackId(),"] set device to ").concat(t," success"))}async setEnabled(t,e,n){if(e)return T.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(t);if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(T.info("[".concat(this.getTrackId(),"] start setEnabled"),t),k("AUTO_RESET_AUDIO_ROUTE")&&(rr()||Ns())){const c=navigator.audioSession;c&&(t||(c.type="playback"),c.type="auto")}if(!t){var i;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(i=this._source.clonedTrack)===null||i===void 0||i.stop(),n||(this._enabled=!1);try{await Qe(this,It.NEED_DISABLE_TRACK,this)}catch(c){throw T.error("[".concat(this.getTrackId(),"] setEnabled false failed"),c.toString()),c}return}const r=rn({},this._constraints),s=Da.searchDeviceIdByName(this._deviceName);s&&!r.deviceId&&(r.deviceId=s);try{n||(this._enabled=!0);const c=await Na({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(c.getAudioTracks()[0],!1),await Qe(this,It.NEED_ENABLE_TRACK,this)}catch(c){throw n||(this._enabled=!1),T.error("[".concat(this.getTrackId(),"] setEnabled true failed"),c.toString()),c}T.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(rm()||jA())&&Ge.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((rr()||Ns())&&this._enabled&&!this._isClosed&&Ge.duringInterruption){const t=async()=>{Ge.off(bi.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(T.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Ge.on(bi.IOS_INTERRUPTION_END,t)}else T.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(fm.TRACK_ENDED)}async renewMediaStreamTrack(t){const e=t||this._constraints,n=Da.searchDeviceIdByName(this._deviceName);if(n&&!e.deviceId&&(e.deviceId=n),this._constraints=e,this._enabled){this._originMediaStreamTrack.stop();const i=await Na({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!0)}}bindProcessorContextEvents(t){super.bindProcessorContextEvents(t),t.on(Ia.REQUEST_UPDATE_CONSTRAINTS,async(e,n,i)=>{try{const r=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(r),n()}catch(r){i(r)}})}unbindProcessorContextEvents(t){super.unbindProcessorContextEvents(t),t.removeAllListeners(Ia.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[b1,C1],Object.getOwnPropertyDescriptor(Tc.prototype,"setDevice"),Tc.prototype),Ee(Tc.prototype,"setEnabled",[A1,w1,I1],Object.getOwnPropertyDescriptor(Tc.prototype,"setEnabled"),Tc.prototype),Ee(Tc.prototype,"close",[O1],Object.getOwnPropertyDescriptor(Tc.prototype,"close"),Tc.prototype),Tc),gG=(N1=Bt({argsMap:(t,e)=>[t.getTrackId(),e,t.duration]}),D1=On(),P1=Bt({argsMap:t=>[t.getTrackId()]}),k1=On(),L1=Bt({argsMap:t=>[t.getTrackId()]}),x1=On(),M1=Bt({argsMap:t=>[t.getTrackId()]}),U1=On(),V1=Bt({argsMap:t=>[t.getTrackId()]}),j1=On(),B1=Bt({argsMap:t=>[t.getTrackId()]}),F1=Bt({argsMap:t=>[t.getTrackId()]}),G1=On(),Ee((xi=class extends Nn{get __className__(){return"BufferSourceAudioTrack"}constructor(t,e,n,i){super(e.createOutputTrack(),n,i),q(this,"source",void 0),q(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=t,this._bufferSource=e,this._bufferSource.on(wa.AUDIO_SOURCE_STATE_CHANGE,r=>{this.safeEmit(fm.SOURCE_STATE_CHANGE,r)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(t){t&&this._bufferSource.updateOptions(t),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(t){this._bufferSource.seekAudioBuffer(t)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(t){Ke(t,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(t)}}).prototype,"startProcessAudioBuffer",[N1,D1],Object.getOwnPropertyDescriptor(xi.prototype,"startProcessAudioBuffer"),xi.prototype),Ee(xi.prototype,"pauseProcessAudioBuffer",[P1,k1],Object.getOwnPropertyDescriptor(xi.prototype,"pauseProcessAudioBuffer"),xi.prototype),Ee(xi.prototype,"seekAudioBuffer",[L1,x1],Object.getOwnPropertyDescriptor(xi.prototype,"seekAudioBuffer"),xi.prototype),Ee(xi.prototype,"resumeProcessAudioBuffer",[M1,U1],Object.getOwnPropertyDescriptor(xi.prototype,"resumeProcessAudioBuffer"),xi.prototype),Ee(xi.prototype,"stopProcessAudioBuffer",[V1,j1],Object.getOwnPropertyDescriptor(xi.prototype,"stopProcessAudioBuffer"),xi.prototype),Ee(xi.prototype,"close",[B1],Object.getOwnPropertyDescriptor(xi.prototype,"close"),xi.prototype),Ee(xi.prototype,"setAudioBufferPlaybackSpeed",[F1,G1],Object.getOwnPropertyDescriptor(xi.prototype,"setAudioBufferPlaybackSpeed"),xi.prototype),xi);class $n extends Nn{get __className__(){return"MixingAudioTrack"}get isActive(){for(const e of this.trackList)if(e._enabled&&!e._isClosed&&!e.muted)return!0;return!1}constructor(){const e=Em().createMediaStreamDestination();super(e.stream.getAudioTracks()[0],void 0,Je(8,"track-mix-")),q(this,"trackList",void 0),q(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=e,this.trackList=[]}hasAudioTrack(e){return this.trackList.indexOf(e)!==-1}addAudioTrack(e){this.trackList.indexOf(e)===-1?(T.debug("add ".concat(e.getTrackId()," to mixing track")),e._source.outputNode.connect(this.destNode),this.trackList.push(e),this.updateEncoderConfig()):T.debug("track ".concat(e.getTrackId()," is already added"))}removeAudioTrack(e){if(this.trackList.indexOf(e)!==-1){T.debug("remove ".concat(e.getTrackId()," from mixing track"));try{e._source.outputNode.disconnect(this.destNode)}catch{}iR(this.trackList,e),this.updateEncoderConfig()}}updateEncoderConfig(){const e={};this.trackList.forEach(n=>{n._encoderConfig&&((n._encoderConfig.bitrate||0)>(e.bitrate||0)&&(e.bitrate=n._encoderConfig.bitrate),(n._encoderConfig.sampleRate||0)>(e.sampleRate||0)&&(e.sampleRate=n._encoderConfig.sampleRate),(n._encoderConfig.sampleSize||0)>(e.sampleSize||0)&&(e.sampleSize=n._encoderConfig.sampleSize),n._encoderConfig.stereo&&(e.stereo=!0))}),this._encoderConfig=e}_updateRtpTransceiver(e){this._rtpTransceiver!==e&&(this._rtpTransceiver=e,this.trackList.forEach(n=>{n instanceof $n?n.emit(Mh.TRANSCEIVER_UPDATED,e):n._updateRtpTransceiver(e)}))}}class vG extends HL{set currentState(e){e!==this._currentState&&(this._currentState=e,this.safeEmit(wa.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),q(this,"audioBuffer",void 0),q(this,"sourceNode",void 0),q(this,"startPlayTime",0),q(this,"startPlayOffset",0),q(this,"pausePlayTime",0),q(this,"options",void 0),q(this,"currentLoopCount",0),q(this,"currentPlaybackSpeed",100),q(this,"_currentState","stopped"),this.audioBuffer=e,this.options=n,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(e){this.currentState==="stopped"?(this.options=e,this.startPlayOffset=this.options.startPlayTime||0):T.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(e){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=e,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=e))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(e){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=e/100),this.currentPlaybackSpeed=e}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const e=this.context.createBufferSource();return e.buffer=this.audioBuffer,e.loop=!!this.options.loop,e.connect(this.outputNode),e.playbackRate.value=this.currentPlaybackSpeed/100,e}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const H1=new Map;function W1(t,e){if(t.length===0||e.length===0)return 1/0;const n=KA(t),i=KA(e);return Math.floor(i/n)}class Sw{get rendFrameRate(){const e=Math.max(1,W1(this._render_interframe_delays_sizes,this._render_interframe_delays));return Math.floor(1e3/e)}get videoElementStatus(){return this._isInPage?this._videoElementStatus:zi.DESTROYED}set videoElementStatus(e){e!==this._videoElementStatus&&(T.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(e)),this._videoElementStatus=e)}get videoState(){return this._videoState}set videoState(e){var n;e!==this._videoState&&(this._videoState=e,(n=this.onVideoStateChanged)===null||n===void 0||n.call(this,this.videoState))}constructor(e){q(this,"trackId",void 0),q(this,"config",void 0),q(this,"onFirstVideoFrameDecoded",void 0),q(this,"onFirstVideoFrameRender",void 0),q(this,"onVideoStateChanged",void 0),q(this,"freezeTimeCounterList",[]),q(this,"renderFreezeAccTime",0),q(this,"renderFreezeAccTime2",0),q(this,"isKeepLastFrame",!1),q(this,"isDestroyed",!1),q(this,"timeUpdatedCount",0),q(this,"freezeTime",0),q(this,"playbackTime",0),q(this,"lastTimeUpdatedTime",0),q(this,"autoplayFailed",!1),q(this,"videoTrack",void 0),q(this,"videoElement",void 0),q(this,"cacheVideoElement",void 0),q(this,"internal",!1),q(this,"_render_interframe_delays",[]),q(this,"_render_interframe_delays_sizes",[]),q(this,"_videoState",Sc.VideoStateStopped),q(this,"videoElementCheckInterval",void 0),q(this,"videoElementFreezeTimeout",void 0),q(this,"_videoElementStatus",zi.NONE),q(this,"_isInPage",!0),q(this,"isGettingVideoDimensions",!1),q(this,"startGetVideoDimensions",()=>{const n=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return T.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(n,500)};!this.isGettingVideoDimensions&&n()}),q(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&Ge.curState==="running"&&(T.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(Hk())),Jk()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),q(this,"handleVideoEvents",n=>{switch(n.type){case"play":case"playing":n.type==="play"&&T.debug("[".concat(this.trackId,"] video element status: play")),this.startGetVideoDimensions(),this.videoElementStatus=zi.PLAYING;break;case"loadeddata":if(this.videoState=Sc.VideoStateStarting,this.onFirstVideoFrameRender&&this.onFirstVideoFrameRender(),this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=zi.CANPLAY;break;case"stalled":this.videoElementStatus=zi.STALLED;break;case"suspend":this.videoElementStatus=zi.SUSPEND;break;case"pause":this.videoElementStatus=zi.PAUSED,rr()||Ns()||Di()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(T.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=zi.WAITING;break;case"abort":this.videoElementStatus=zi.ABORT;break;case"ended":this.videoElementStatus=zi.ENDED;break;case"emptied":this.videoElementStatus=zi.EMPTIED;break;case"error":{const i=this.videoElement.error;i&&(this.videoElementStatus=zi.ERROR,T.error("[".concat(this.trackId,"] media error: ").concat(i.message," (").concat(i.code,")")));break}case"timeupdate":{const i=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=i);const r=i-this.lastTimeUpdatedTime,s=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=i,yc.lastVisibleTime<yc.lastHiddenTime||s<yc.lastHiddenTime||s<yc.lastVisibleTime||this.isSkipCalcRenderFreezeTime())return;for(r>k("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=r),this.playbackTime+=r;this.playbackTime>=6e3;){this.playbackTime-=6e3;const c=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(c),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),q(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(T.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(Hk())),Jk()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=e.trackId,this.config=e,e.element instanceof HTMLVideoElement?this.videoElement=e.element:this.videoElement=document.createElement("video"),Ge.on(bi.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Ge.on(bi.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var e;return(e=this.videoElement.parentElement)!==null&&e!==void 0?e:void 0}updateConfig(e){this.config=e,this.trackId=e.trackId,e.element!==this.videoElement&&(this.destroy(),this.videoElement=e.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.initVideoElement())}play(e){const n=this.videoElement.play();n&&n.catch&&n.catch(r=>{e&&QL(e,"video",r.message,this.trackId),r.name==="NotAllowedError"?(T.warning("detected video element autoplay failed",r),this.autoplayFailed=!0,this.handleAutoPlayFailed()):T.warning("[".concat(this.trackId,"] play warning: "),r)});const i=ve();if((i.name==="Safari"&&Number(i.version)===15||rm())&&n&&n.then){const r=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};n.then(r).catch(r)}}getCurrentFrame(){const e=document.createElement("canvas");e.width=this.videoElement.videoWidth,e.height=this.videoElement.videoHeight;const n=e.getContext("2d");if(!n)return T.error("create canvas context failed!"),new ImageData(2,2);n.drawImage(this.videoElement,0,0,e.width,e.height);const i=n.getImageData(0,0,e.width,e.height);return e.remove(),i}async getCurrentFrameToUint8Array(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const i=document.createElement("canvas");i.width=this.videoElement.videoWidth,i.height=this.videoElement.videoHeight;const r=i.getContext("2d");return r?(r.drawImage(this.videoElement,0,0,i.width,i.height),new Tt((s,c)=>{i.toBlob(async l=>{if(i.remove(),l){const d=await a1(l);s({buffer:d,width:i.width,height:i.height})}else c(new Z(P.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,n<0?.1:n>1?1:n)})):await vw(e)}destroy(){this.isDestroyed=!0,Ge.off(bi.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Ge.off(bi.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=Sc.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=zi.INIT,!this.videoElementCheckInterval&&(z1.forEach(s=>{this.videoElement.addEventListener(s,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{this._isInPage=function(s){return s!==document.body&&document.body.contains(s)}(this.videoElement)},1e3),k("ENABLE_VIDEO_FRAME_CALLBACK"))){var e,n;let s;const c=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",c),this.videoElementFreezeTimeout=window.setTimeout(l,k("VIDEO_FREEZE_DURATION")))},l=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===Sc.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=Sc.VideoStateFrozen:document.addEventListener("visibilitychange",c))},d=(h,p)=>{if(this.videoElementStatus===zi.PLAYING){if(s){const E=p.presentationTime-s.presentationTime,I=p.presentedFrames-s.presentedFrames;this._render_interframe_delays_sizes.push(I),this._render_interframe_delays.push(E);const C=KA(this._render_interframe_delays_sizes),w=C-this._render_interframe_delays_sizes[0];if(C>30&&w>5&&(this._render_interframe_delays_sizes.shift(),this._render_interframe_delays.shift()),this.videoState===Sc.VideoStateStarting&&(this.videoState=Sc.VideoStateDecoding),this.videoState===Sc.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(l,k("VIDEO_FREEZE_DURATION"))),E<k("VIDEO_FREEZE_DURATION")&&this.videoState===Sc.VideoStateFrozen&&(this.videoState=Sc.VideoStateDecoding),E>k("VIDEO_FREEZE_DURATION")&&yc.lastVisibleTime>=yc.lastHiddenTime&&s.timestamp>yc.lastVisibleTime&&s.timestamp>yc.lastHiddenTime){const D=Math.min(66,W1(this._render_interframe_delays_sizes,this._render_interframe_delays)),N=Math.max(0,E-(I-1)*D);this.renderFreezeAccTime2+=N>D?N:0,this.renderFreezeAccTime+=E}}s=rn(rn({},p),{},{timestamp:h})}else this.isSkipCalcRenderFreezeTime()&&(s=rn(rn({},p),{},{timestamp:h}));var m,_;k("ENABLE_VIDEO_FRAME_CALLBACK")&&((m=(_=this.videoElement).requestVideoFrameCallback)===null||m===void 0||m.call(_,d))};(e=(n=this.videoElement).requestVideoFrameCallback)===null||e===void 0||e.call(n,d)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),nR()&&!k("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const i=ve();i.name==="Safari"&&Number(i.version)===15||rm()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,An()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,An()&&this.videoElement.load());const r=this.videoElement.play();r!==void 0&&r.catch(s=>{T.debug("[".concat(this.trackId,"] playback interrupted"),s.toString())})}resetVideoElement(){z1.forEach(e=>{this.videoElement&&this.videoElement.removeEventListener(e,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=zi.NONE}isSkipCalcRenderFreezeTime(){return this.videoElementStatus===zi.DESTROYED||this.internal}handleAutoPlayFailed(){const e=n=>{n.preventDefault(),this.videoElement.play().then(()=>{T.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(i=>{T.error(i)}),this.autoplayFailed=!1,wg()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};wg()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),XL()}}const z1=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class Tw extends Sw{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];super(e),q(this,"container",void 0),q(this,"slot",void 0),this.slot=e.element,this.internal=n,this.updateConfig(e)}updateConfig(e){this.config=e,this.trackId=e.trackId;const n=e.element;var i;!this.internal||this.slot?(n!==this.slot&&(this.destroy(),this.slot=n),this.createElements()):(this.slot=n,n&&this.container?(this.internal=!1,this.container.id="agora-video-player-".concat(this.trackId),this.videoElement.id="video_".concat(this.trackId),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",(i=this.slot)===null||i===void 0||i.appendChild(this.container)):this.createElements())}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.createElements())}play(e){var n;(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)&&super.play(e)}getCurrentFrame(){var e;return(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(e){var n;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(e,i):await vw(e)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{var e;this.container.remove(),(e=this.slot)===null||e===void 0||e.removeChild(this.container)}catch{}this.container=void 0}}createElements(){var e;this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",k("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),(e=this.slot)===null||e===void 0||e.appendChild(this.container)}mountedVideoElement(){var e;!this.container||(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var e;if((e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var e;(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var q1,K1,Y1,X1,Q1,J1,Z1,$1,tx,ex,nx,ix,rx,ax,sx,ox,cx,lx,dx,ux,hx,px,fx,mx,_x,Ex,gx,vx,le,Sx,Tx,yx,Rx,bx,Cx,Ax,wx,ka;let sn=(q1=Bt({argsMap:(t,e,n)=>[t.getTrackId(),typeof e=="string"?e:e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),K1=On(),Y1=Bt({argsMap:t=>[t.getTrackId()]}),X1=cm("LocalVideoTrack","_enabledMutex"),Q1=Bt({argsMap:(t,e)=>[t.getTrackId(),e]}),J1=On(),Z1=cm("LocalVideoTrack","_enabledMutex"),$1=Bt({argsMap:(t,e)=>[t.getTrackId(),e]}),tx=On(),ex=Bt({argsMap:(t,e)=>[t.getTrackId(),e,t._saveEncodeBitrateRatio]}),nx=On(),ix=Bt({argsMap:(t,e)=>[t.getTrackId(),e]}),rx=On(),ax=On(),sx=Bt({argsMap:(t,e,n)=>[t.getTrackId(),e,n]}),ox=On(),cx=On(),lx=On(),dx=Bt({argsMap:t=>[t.getTrackId()]}),ux=On(),hx=On(),px=On(),fx=On(),mx=On(),_x=Bt({argsMap:(t,e)=>[t.getTrackId(),e.name]}),Ex=Bt({argsMap:t=>[t.getTrackId()]}),gx=Bt({argsMap:t=>[t.getTrackId()]}),vx=Bt({argsMap:(t,e,n)=>[t.getTrackId(),e.label,n]}),le=class rB extends _m{get videoHeight(){if(Di()){const{height:e}=this._mediaStreamTrack.getSettings();return this._videoHeight=e,this._videoHeight}return this._videoHeight}get videoWidth(){if(Di()){const{width:e}=this._mediaStreamTrack.getSettings();return this._videoWidth=e,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==zi.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(e){this._processorContext=e}get __className__(){return"LocalVideoTrack"}constructor(e,n,i,r,s,c){if(super(e,s),q(this,"trackMediaType",mm.VIDEO),q(this,"_player",void 0),q(this,"isUseScaleResolutionDownBy",!1),q(this,"_videoVisibleTimer",null),q(this,"_previousVideoVisibleStatus",void 0),q(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),q(this,"_encoderConfig",void 0),q(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),q(this,"_optimizationMode",void 0),q(this,"_saveEncodeBitrateRatio",1),q(this,"_videoHeight",void 0),q(this,"_videoWidth",void 0),q(this,"_forceBitrateLimit",void 0),q(this,"_enabled",!0),q(this,"_processorDestination",void 0),q(this,"_processorContext",void 0),Di()){const{width:l,height:d}=e.getSettings();this._videoWidth=l,this._videoHeight=d}else this.updateMediaStreamTrackResolution();if(this._scalabilityMode=i,this._optimizationMode=r,this._hints=c||[],n&&this._hints.indexOf(Ye.CUSTOM_TRACK)!==-1?this._encoderConfig=En(n):this._encoderConfig=n,this._hints.indexOf(Ye.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(LA(Ie.CHROME,115)&&tR().indexOf("Windows")!==-1){const l=function(d,h){if("VideoFrame"in window&&"TransformStream"in window&&be().supportWebRTCInsertableStream){const p=new MediaStreamTrackProcessor(d),m=new MediaStreamTrackGenerator({kind:"video"});let _,E,I=Date.now();const C=()=>{w&&(clearInterval(w),w=void 0),_&&(_.close(),_=void 0),d.stop(),E=void 0,m.removeEventListener("ended",C)};let w=window.setInterval(()=>{if(E&&_&&Date.now()-I>1e3)try{m.readyState==="live"?E.enqueue(_.clone()):C()}catch{C()}},1e3);const D=new TransformStream({transform:(N,L)=>{m.readyState==="live"?(E=L,I=Date.now(),_===void 0?(_=N,L.enqueue(N.clone())):(L.enqueue(_),_=N)):N.close()}});return m.addEventListener("ended",C),p.readable.pipeThrough(D).pipeTo(m.writable),m}}(e);l&&(T.info("local screen video track begin to inject frame"),this._mediaStreamTrack=l)}n&&this._hints.indexOf(Ye.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(n),this._processorContext=new ZL(this.getTrackId(),"local"),this._processorDestination=new JL(this.processorContext),this.bindProcessorDestinationEvents()}play(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e=="string"){const r=document.getElementById(e);r?e=r:(T.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}T.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(n));const i=rn(rn(rn({},this._getDefaultPlayerConfig()),n),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(i):(e instanceof HTMLVideoElement?this._player=new Sw(i):this._player=new Tw(i),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const r=this.getVideoElementVisibleStatus();this.safeEmit(fm.VIDEO_ELEMENT_VISIBLE_STATUS,r)}catch{}},k("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,T.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(e,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(T.info("[".concat(this.getTrackId(),"] start setEnabled"),e),!e){this._originMediaStreamTrack.enabled=!1;try{await Qe(this,It.NEED_DISABLE_TRACK,this)}catch(i){throw T.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}return n||(this._enabled=!1),void T.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await Qe(this,It.NEED_ENABLE_TRACK,this)}catch(i){throw T.error("[".concat(this.getTrackId(),"] setEnabled to true error"),i.toString()),i}T.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,T.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await Qe(this,It.NEED_MUTE_TRACK,this):await Qe(this,It.NEED_UNMUTE_TRACK,this))}async setSaveEncodeBitrateRatio(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this._saveEncodeBitrateRatio;if(this._saveEncodeBitrateRatio!==1&&this._encoderConfig&&this._encoderConfig.bitrateMax&&this._encoderConfig.bitrateMin){this._encoderConfig.bitrateMin=Math.floor(this._encoderConfig.bitrateMin*e),this._encoderConfig.bitrateMax=Math.floor(this._encoderConfig.bitrateMax*e),T.debug("[".concat(this.getTrackId(),"] set save encode bitrate ratio, ").concat(e)),this._saveEncodeBitrateRatio=1;try{await Qe(this,It.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(T)}}}async setEncoderConfiguration(e,n){if(!this._enabled)throw new Z(P.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(e=ks(e),k("USE_STANDARD_BITRATE_DEFAULT")&&(delete e.bitrateMax,delete e.bitrateMin),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),e.width||e.height||e.frameRate){const i=_R({encoderConfig:e});(Di()||rr()||Ns())&&(i.deviceId=void 0),T.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(i));try{await this._originMediaStreamTrack.applyConstraints(i),this.updateMediaStreamTrackResolution()}catch(r){const s=new Z(P.UNEXPECTED_ERROR,r.toString());throw T.error("[".concat(this.getTrackId(),"] applyConstraints error"),s.toString()),s}}this._encoderConfig=e,this._hints.indexOf(Ye.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Qe(this,It.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw(T)}}getStats(){return Fd(()=>{T.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),Ca(this,It.GET_STATS)||rn({},hw)}async setBeautyEffect(e){T.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(e,n):await vw(e)}async findClosestProfile(){const{width:e,height:n,frameRate:i}=this.getMediaStreamTrackSettings(),{width:r,height:s,frameRate:c}=this._encoderConfig||{},l=om(this._videoWidth||e||r||0),d=om(this._videoHeight||n||s||0),h=function(p,m,_){if(!Array.isArray(k("VIDEO_ENCODER_CONFIG_LIST"))||k("VIDEO_ENCODER_CONFIG_LIST").length===0)return!1;const E=Math.min(p,m);return!(E>=480)&&rn(rn({},k("VIDEO_ENCODER_CONFIG_LIST").find(I=>I.height>E)),{},{frameRate:_})}(l,d,om(i||c||15));if(h)return T.debug("[".concat(this.getTrackId(),"] find closest profile, ").concat(l,"x").concat(d," => ").concat(JSON.stringify(h))),this.setEncoderConfiguration(h)}async setBitrateLimit(e){T.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(e))),e&&(this._forceBitrateLimit=e,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<e.max_bitrate?this._encoderConfig.bitrateMax:e.max_bitrate:this._encoderConfig.bitrateMax=e.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=e.min_bitrate))}async setOptimizationMode(e){if(e!=="motion"&&e!=="detail"&&e!=="balanced")return void T.error(P.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const n=this._optimizationMode;try{this._optimizationMode=e,await Qe(this,It.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(i){throw this._optimizationMode=n,T.error("[".concat(this.getTrackId(),"] set optimization mode failed"),i.toString()),i}T.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(e,")"))}setScalabiltyMode(e){if(e.numSpatialLayers===1&&e.numTemporalLayers!==1)return T.error(P.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=e,T.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(e,")"))}updateMediaStreamTrackResolution(){e1(this._originMediaStreamTrack).then(e=>{let[n,i]=e;this._videoHeight=i,this._videoWidth=n}).catch(aR)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(e){if(!this._enabled)throw new Z(P.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");T.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(e)),e=ks(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),this._encoderConfig=e,this._hints.indexOf(Ye.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Qe(this,It.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(T)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:e,height:n,frameRate:i}=this.getMediaStreamTrackSettings();if(!e||!n||!i)return;const{bitrateMax:r,bitrateMin:s}=this._encoderConfig;if(s==null||r==null){const{max:c,min:l}=function(d,h,p,m,_){const E=k("BITRATE_ADAPTER_TYPE");if(E==="DEFAULT_BITRATE")return{min:m,max:_};if(_===void 0){const I=Math.floor(200*Math.pow(p/15,.6)*Math.pow(d*h/640/360,.75));_=E==="STANDARD_BITRATE"?4*I:2*I,m=m??I}else m=m??Math.floor(_/10);return{min:m,max:_}}(e,n,i,s,r);if(this._encoderConfig.bitrateMin=l,this._encoderConfig.bitrateMax=c,k("VIDEO_STANDARD_BITRATE_VERSION")&&s==null&&r==null){const[d,h]=function(p,m,_){const E=4*Math.floor(2e5*Math.pow(_/15,.6)*Math.pow(p*m/230400,.75)),I=p*m,C=new Map([[19200,.9],[230400,.85],[518400,.75],[921600,.7],[2073600,.6],[3686400,.5]]),w=new Map([[230400,.95],[518400,.9],[921600,.85],[2073600,.8]]);let D=wr(C).call(C).next().value,N=1;if(C.has(I))D=C.get(I);else{var L;const dt=Zt(L=Array.from(C.entries())).call(L,(se,zt)=>{let[ke]=se,[De]=zt;return ke-De}),ae=dt.find(se=>{let[zt]=se;return zt>I});if(ae){const se=dt.indexOf(ae);if(se>0){const zt=dt[se-1],ke=(I-zt[0])/(ae[0]-zt[0]);D=zt[1]+ke*(ae[1]-zt[1])}else D=ae[1]}else D=dt[dt.length-1][1]}if(w.has(I))N=w.get(I);else{var W;const dt=Zt(W=Array.from(w.entries())).call(W,(se,zt)=>{let[ke]=se,[De]=zt;return ke-De}),ae=dt.find(se=>{let[zt]=se;return zt>I});if(ae){const se=dt.indexOf(ae);if(se>0){const zt=dt[se-1],ke=(I-zt[0])/(ae[0]-zt[0]);N=zt[1]+ke*(ae[1]-zt[1])}else N=ae[1]}else N=dt[dt.length-1][1]}const G=k("VIDEO_NEW_BITRATE_RATIO");G&&G>0&&(D=G/100);const U=Math.floor(E*D),z=Math.floor(65e4*Math.pow(p*m/230400,.5)*Math.pow(_/15,.69));let $=U;const rt=k("VIDEO_STANDARD_BITRATE_VERSION");return rt&&rt>0&&(rt===1?$=E:rt===2?$=U:rt===3&&($=z)),[Math.floor($/1e3),N]}(e,n,i);this._encoderConfig.bitrateMax=d,this._encoderConfig.bitrateMin=l?Math.min(l,d):d,this._saveEncodeBitrateRatio=h,T.debug("[".concat(this.getTrackId(),"] update new bitrate from profile, [w: ").concat(e,", h: ").concat(n,", fps: ").concat(i,"] => [brMax: ").concat(this._encoderConfig.bitrateMax,", brMin: ").concat(this._encoderConfig.bitrateMin,", save_bitrate_ratio: ").concat(this._saveEncodeBitrateRatio,"]"))}else T.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(e,", h: ").concat(n,", fps: ").concat(i,"] => [brMax: ").concat(c,", brMin: ").concat(l,"]")),this._saveEncodeBitrateRatio=1}}getVideoElementVisibleStatus(){try{var e,n;const i=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),r={track:this,element:this==null||(n=this._player)===null||n===void 0?void 0:n.getVideoElement(),slot:i==null?void 0:i.parentElement},{element:s,slot:c}=r;if(this.isPlaying&&s instanceof HTMLVideoElement&&c instanceof HTMLElement){const l=nL.checkOneElementVisible(s),d=Object.assign({},l);if(d.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=d.visible;const h=Pt.reportApiInvoke(null,{tag:_n.TRACER,name:kn.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});d.visible?h.onSuccess("Video is visible"):h.onSuccess("Invisible because of ".concat(d.reason))}return d}return}catch(i){throw new Z(P.GET_VIDEO_ELEMENT_VISIBLE_ERROR,i.message)}}async renewMediaStreamTrack(e){}pipe(e){if(this.processor===e)return e;if(e._source)throw new Z(P.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(e){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],i=this._encoderConfig;e&&(i=rn(rn({},i),ks(e))),i=Ph(i);const r=Je(8,"track-video-cloned-"),s=new rB(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,i,Ph(this._scalabilityMode),this._optimizationMode,r,Ph(this._hints));return e&&i&&s.setEncoderConfiguration(i),T.debug("clone video track from ".concat(this.getTrackId()," to ").concat(r,", clone ").concat(n)),s}async replaceTrack(e,n){if(!(e instanceof MediaStreamTrack))throw new Z(P.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(e.kind!=="video")throw new Z(P.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(e,n,!0),this.updateMediaStreamTrackResolution()}sendSeiData(e){if(Fd(()=>{Pt.reportApiInvoke(null,{name:kn.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:_n.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!k("ENABLE_VIDEO_SEI")||!k("ENABLE_ENCODED_TRANSFORM"))return void T.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(e instanceof Uint8Array==0)return new Z(P.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const n=this.getRTCRtpTransceiver();if(!n)return void T.warning("Video track is not published, SEI can not be send");const i=n.sender.getParameters();if(i.codecs.length===0)return;const r=i.codecs[0].mimeType.toLocaleLowerCase();r==="video/h264"||r==="video/h265"?this.safeEmit("sei-to-send",e):T.warning("SEI is not supported by ".concat(r))}bindProcessorDestinationEvents(){this.processorDestination.on(gr.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(),await Qe(this,It.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Qe(this,It.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(gr.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(Ia.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(Ia.REQUEST_CONSTRAINTS)}},Ee(le.prototype,"play",[q1,K1],Object.getOwnPropertyDescriptor(le.prototype,"play"),le.prototype),Ee(le.prototype,"stop",[Y1],Object.getOwnPropertyDescriptor(le.prototype,"stop"),le.prototype),Ee(le.prototype,"setEnabled",[X1,Q1,J1],Object.getOwnPropertyDescriptor(le.prototype,"setEnabled"),le.prototype),Ee(le.prototype,"setMuted",[Z1,$1,tx],Object.getOwnPropertyDescriptor(le.prototype,"setMuted"),le.prototype),Ee(le.prototype,"setSaveEncodeBitrateRatio",[ex,nx],Object.getOwnPropertyDescriptor(le.prototype,"setSaveEncodeBitrateRatio"),le.prototype),Ee(le.prototype,"setEncoderConfiguration",[ix,rx],Object.getOwnPropertyDescriptor(le.prototype,"setEncoderConfiguration"),le.prototype),Ee(le.prototype,"getStats",[ax],Object.getOwnPropertyDescriptor(le.prototype,"getStats"),le.prototype),Ee(le.prototype,"setBeautyEffect",[sx,ox],Object.getOwnPropertyDescriptor(le.prototype,"setBeautyEffect"),le.prototype),Ee(le.prototype,"getCurrentFrameData",[cx],Object.getOwnPropertyDescriptor(le.prototype,"getCurrentFrameData"),le.prototype),Ee(le.prototype,"getCurrentFrameImage",[lx],Object.getOwnPropertyDescriptor(le.prototype,"getCurrentFrameImage"),le.prototype),Ee(le.prototype,"findClosestProfile",[dx,ux],Object.getOwnPropertyDescriptor(le.prototype,"findClosestProfile"),le.prototype),Ee(le.prototype,"setBitrateLimit",[hx],Object.getOwnPropertyDescriptor(le.prototype,"setBitrateLimit"),le.prototype),Ee(le.prototype,"setOptimizationMode",[px],Object.getOwnPropertyDescriptor(le.prototype,"setOptimizationMode"),le.prototype),Ee(le.prototype,"setScalabiltyMode",[fx],Object.getOwnPropertyDescriptor(le.prototype,"setScalabiltyMode"),le.prototype),Ee(le.prototype,"updateMediaStreamTrackResolution",[mx],Object.getOwnPropertyDescriptor(le.prototype,"updateMediaStreamTrackResolution"),le.prototype),Ee(le.prototype,"pipe",[_x],Object.getOwnPropertyDescriptor(le.prototype,"pipe"),le.prototype),Ee(le.prototype,"unpipe",[Ex],Object.getOwnPropertyDescriptor(le.prototype,"unpipe"),le.prototype),Ee(le.prototype,"close",[gx],Object.getOwnPropertyDescriptor(le.prototype,"close"),le.prototype),Ee(le.prototype,"replaceTrack",[vx],Object.getOwnPropertyDescriptor(le.prototype,"replaceTrack"),le.prototype),le),ER=(Sx=Bt({argsMap:(t,e)=>[t.getTrackId(),e]}),Tx=On(),yx=cm("CameraVideoTrack","_enabledMutex"),Rx=Bt({argsMap:(t,e)=>[t.getTrackId(),e]}),bx=On(),Cx=Bt({argsMap:(t,e)=>[t.getTrackId(),e]}),Ax=On(),wx=Bt({argsMap:t=>[t.getTrackId()]}),ka=class aB extends sn{get __className__(){return"CameraVideoTrack"}constructor(e,n,i,r,s,c){super(e,ks(n.encoderConfig),r,s,c),q(this,"_config",void 0),q(this,"_originalConstraints",void 0),q(this,"_constraints",void 0),q(this,"_enabled",!0),q(this,"_deviceName","default"),q(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(rm()||jA())&&!function(){const l=ve();if(l.os!==di.IOS||!l.osVersion)return!1;const d=l.osVersion.split(".");return Number(d[0])===15&&Number(d[1])>=2}()&&Zk()&&this._enabled&&!this._isClosed&&(T.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=n,this._originalConstraints=i,this._constraints=i,this._deviceName=e.label,this._encoderConfig=ks(this._config.encoderConfig),Ge.on(bi.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Ge.on(bi.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(e){return typeof e=="string"?this._setDeviceById(e):e.deviceId?this._setDeviceById(e.deviceId):e.facingMode?this._setDeviceByFacingModel(e.facingMode):void 0}async _setDeviceById(e){if(T.info("[".concat(this.getTrackId(),"] set device to ").concat(e)),this._enabled)try{const n=await Da.getDeviceById(e),i={};i.video=rn({},this._constraints),i.video.deviceId={exact:e},i.video.facingMode=void 0,this._originMediaStreamTrack.stop();let r=null;try{r=await Na(i,this.getTrackId())}catch(s){throw T.error("[".concat(this.getTrackId(),"] setDevice failed"),s.toString()),r=await Na({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),s}await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=n.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(n){throw T.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}else try{const n=await Da.getDeviceById(e);this._deviceName=n.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(n){throw T.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}T.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(e){T.info("[".concat(this.getTrackId(),"] set facingMode ").concat(e));const n={video:rn(rn({},this._constraints),{},{deviceId:void 0,facingMode:{exact:e}})};if(this._enabled){this._originMediaStreamTrack.stop();let i=null;try{i=await Na(n,this.getTrackId())}catch(r){throw T.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),r.toString()),i=await Na({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),r}await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=e,this._config.cameraId=void 0,this._constraints=rn({},n.video),T.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(e,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(T.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const i=await Na({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1)}await Qe(this,It.NEED_ENABLE_TRACK,this)}catch(i){throw T.error("[".concat(this.getTrackId(),"] setEnabled true error"),i.toString()),i}this.updateMediaStreamTrackResolution(),T.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),n||(this._enabled=!1);try{await Qe(this,It.NEED_DISABLE_TRACK,this)}catch(i){throw T.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}T.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(e,n){if(!this._enabled)throw new Z(P.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");e=ks(e),k("USE_STANDARD_BITRATE_DEFAULT")&&(delete e.bitrateMax,delete e.bitrateMin),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate||e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate||e.bitrateMin);const i=En(this._config);i.encoderConfig=e;const r=_R(i);(Di()||rr()||Ns())&&(r.deviceId=void 0),T.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(r));try{await this._originMediaStreamTrack.applyConstraints(r),this.updateMediaStreamTrackResolution()}catch(s){const c=new Z(P.UNEXPECTED_ERROR,s.toString());throw T.error("[".concat(this.getTrackId(),"] applyConstraints error"),c.toString()),c}this._config=i,this._constraints=r,this._originalConstraints=r,this._encoderConfig=e,this._hints.indexOf(Ye.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Qe(this,It.NEED_UPDATE_VIDEO_ENCODER,this)}catch(s){return s.throw(T)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((rr()||Ns())&&this._enabled&&!this._isClosed&&Ge.duringInterruption){const e=async()=>{Ge.off(bi.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(T.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Ge.on(bi.IOS_INTERRUPTION_END,e)}else T.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(fm.TRACK_ENDED)}async renewMediaStreamTrack(e){const n=e||this._constraints,i=Da.searchDeviceIdByName(this._deviceName);if(i&&!n.deviceId&&(n.deviceId={exact:i}),this._enabled){const r=await Na({video:n},this.getTrackId());this._constraints=n,await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),Ge.off(bi.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Ge.off(bi.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(e){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],i=this._encoderConfig;e&&(i=rn(rn({},i),ks(e))),i=Ph(i);const r=Je(8,"track-cam-cloned-"),s=new aB(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,Ph(rn(rn({},this._config),{},{encoderConfig:i})),Ph(this._constraints),Ph(this._scalabilityMode),this._optimizationMode,r);return e&&i&&s.setEncoderConfiguration(i),T.debug("clone track from ".concat(this.getTrackId()," to ").concat(r,", clone ").concat(n)),s}bindProcessorContextEvents(){this.processorContext.on(Ia.REQUEST_UPDATE_CONSTRAINTS,async(e,n,i)=>{try{const r=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(r),n()}catch(r){i(r)}}),this.processorContext.on(Ia.REQUEST_CONSTRAINTS,async e=>{e(this._originMediaStreamTrack.getSettings())})}},Ee(ka.prototype,"setDevice",[Sx,Tx],Object.getOwnPropertyDescriptor(ka.prototype,"setDevice"),ka.prototype),Ee(ka.prototype,"setEnabled",[yx,Rx,bx],Object.getOwnPropertyDescriptor(ka.prototype,"setEnabled"),ka.prototype),Ee(ka.prototype,"setEncoderConfiguration",[Cx,Ax],Object.getOwnPropertyDescriptor(ka.prototype,"setEncoderConfiguration"),ka.prototype),Ee(ka.prototype,"close",[wx],Object.getOwnPropertyDescriptor(ka.prototype,"close"),ka.prototype),ka);function yw(t,e,n,i){n.optimizationMode&&(i&&i.width&&i.height?(n.encoderConfig=rn(rn({},i),{},{bitrateMin:i.bitrateMin,bitrateMax:i.bitrateMax}),n.optimizationMode!=="motion"&&n.optimizationMode!=="detail"||(e.contentHint=n.optimizationMode,e.contentHint===n.optimizationMode?T.debug("[".concat(t,"] set content hint to"),n.optimizationMode):T.debug("[".concat(t,"] set content hint failed")))):T.warning("[".concat(t,"] can not apply optimization mode bitrate config, no encoderConfig")))}var Ix,Ox,Nx,Dx,ns,Px,kx,Lx,xx,Mx,Ux,ur;class Vx extends BL{getUserId(){return this._userId}constructor(e,n,i,r){super(e,"track-".concat(e.kind,"-").concat(n,"-").concat(r.clientId,"_").concat(Je(5,""))),q(this,"_userId",void 0),q(this,"_uintId",void 0),q(this,"_isDestroyed",!1),q(this,"store",void 0),q(this,"processor",void 0),q(this,"processorContext",void 0),this._userId=n,this._uintId=i,this.store=r}_updateOriginMediaStreamTrack(e){this._originMediaStreamTrack=e,this._mediaStreamTrack=e,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,T.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let vm=(Ix=Bt({argsMap:(t,e,n)=>[t.getTrackId(),typeof e=="string"?e:e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),Ox=Bt({argsMap:t=>[t.getTrackId()]}),Nx=Bt({argsMap:(t,e)=>[t.getTrackId(),e.name]}),Dx=Bt({argsMap:t=>[t.getTrackId()]}),Ee((ns=class extends Vx{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==zi.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(t,e,n,i,r){super(t,e,n,i),q(this,"_videoVisibleTimer",null),q(this,"_previousVideoVisibleStatus",void 0),q(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),q(this,"trackMediaType",mm.VIDEO),q(this,"_videoWidth",void 0),q(this,"_videoHeight",void 0),q(this,"_player",void 0),q(this,"_prePlayer",void 0),q(this,"processorDestination",void 0),q(this,"processorContext",void 0),this._prePlayer=r,this.updateMediaStreamTrackResolution(),this.processorContext=new ZL(this.getTrackId(),"remote"),this.processorDestination=new JL(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Fd(()=>{T.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),Ca(this,It.GET_STATS)||rn({},VL)}play(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.safeEmit(es.PLAY_START),typeof t=="string"){const i=document.getElementById(t);i?t=i:(T.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}T.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(e));const n=rn(rn({fit:"cover"},e),{},{trackId:this.getTrackId(),element:t});if(this._player)this._player.updateConfig(n);else{let i=!1,r=!1;t instanceof HTMLVideoElement?(this._player=new Sw(n),this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0,r=!0)):this._prePlayer&&!this._prePlayer.isDestroyed?(this._player=this._prePlayer,this._prePlayer=void 0,i=this._player.videoState>0,this._player.updateConfig(n)):this._player=new Tw(n),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(es.FIRST_FRAME_DECODED),r&&this.safeEmit(es.FIRST_FRAME_RENDER)},this._player.onVideoStateChanged=s=>{this.safeEmit(es.VIDEO_STATE_CHANGED,s)},i&&(this._player.onFirstVideoFrameDecoded(),this._player.onVideoStateChanged(this._player.videoState))}this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const i=this.getVideoElementVisibleStatus();this.safeEmit(es.VIDEO_ELEMENT_VISIBLE_STATUS,i)}catch{}},k("CHECK_VIDEO_VISIBLE_INTERVAL")),this.safeEmit(es.PLAY_END)}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,T.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){e1(this._originMediaStreamTrack).then(t=>{let[e,n]=t;this._videoHeight=n,this._videoWidth=e}).catch(aR)}_updatePlayerSource(){T.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var t,e;const n=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),i={track:this,element:this==null||(e=this._player)===null||e===void 0?void 0:e.getVideoElement(),slot:n==null?void 0:n.parentElement},{element:r,slot:s}=i;if(this.isPlaying&&r instanceof HTMLVideoElement&&s instanceof HTMLElement){const c=nL.checkOneElementVisible(r),l=Object.assign({},c);if(l.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=l.visible;const d=Pt.reportApiInvoke(null,{tag:_n.TRACER,name:kn.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});l.visible?d.onSuccess("Video is visible"):d.onSuccess("Invisible because of ".concat(l.reason))}return l}return}catch(n){throw new Z(P.GET_VIDEO_ELEMENT_VISIBLE_ERROR,n.message)}}pipe(t){if(this.processor===t)return t;if(t._source)throw new Z(P.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(gr.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(gr.ON_TRACK)}_destroy(){this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0),super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(t){this.emit(Mh.SEI_RECEIVED,t)}}).prototype,"play",[Ix],Object.getOwnPropertyDescriptor(ns.prototype,"play"),ns.prototype),Ee(ns.prototype,"stop",[Ox],Object.getOwnPropertyDescriptor(ns.prototype,"stop"),ns.prototype),Ee(ns.prototype,"pipe",[Nx],Object.getOwnPropertyDescriptor(ns.prototype,"pipe"),ns.prototype),Ee(ns.prototype,"unpipe",[Dx],Object.getOwnPropertyDescriptor(ns.prototype,"unpipe"),ns.prototype),ns),Sm=(Px=Bt({argsMap:(t,e)=>[t.getTrackId(),e],throttleTime:300}),kx=Bt({argsMap:(t,e)=>[t.getTrackId(),e]}),Lx=Bt({argsMap:t=>[t.getTrackId()]}),xx=Bt({argsMap:t=>[t.getTrackId()]}),Mx=Bt({argsMap:(t,e)=>[t.getTrackId(),e.name]}),Ux=Bt({argsMap:t=>[t.getTrackId()]}),Ee((ur=class extends Vx{get isPlaying(){return this._useAudioElement?Or.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(t,e,n,i){super(t,e,n,i),q(this,"trackMediaType",mm.AUDIO),q(this,"_source",void 0),q(this,"_useAudioElement",!0),q(this,"_volume",100),q(this,"processorContext",void 0),q(this,"processorDestination",void 0),q(this,"_played",!1),q(this,"_bypassWebAudio",!1),k("DISABLE_WEBAUDIO")?(this._source=new gw,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new WL(t,!0),k("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(wa.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(es.FIRST_FRAME_DECODED)}),this.processorContext=new t1(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new $L(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(wa.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(wa.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(e),this._source.removeAllListeners(wa.ON_AUDIO_BUFFER),this._source.on(wa.ON_AUDIO_BUFFER,n=>t(n))}setVolume(t){this._volume=t,this._useAudioElement?Or.setVolume(this.getTrackId(),t):this._source.setVolume(t/100)}async setPlaybackDevice(t){if(!this._useAudioElement||!LL())throw new Z(P.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Or.setSinkID(this.getTrackId(),t)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Fd(()=>{T.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),Ca(this,It.GET_STATS)||rn({},UL)}play(){T.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(T.debug("[".concat(this.getTrackId(),"] use audio element to play")),Or.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){T.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?Or.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];T.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Or.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(t){if(this._bypassWebAudio)throw new Z(P.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===t)return t;if(t._source)throw new Z(P.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(this._bypassWebAudio)throw new Z(P.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const e=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(gr.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(gr.ON_NODE,t=>{this._source.processedNode=t;const e=!t;this._useAudioElement!==e&&(this._played?(this.stop(),this._useAudioElement=e,this.play()):this._useAudioElement=e)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(gr.ON_TRACK),this.processorDestination.removeAllListeners(gr.ON_NODE)}}).prototype,"setVolume",[Px],Object.getOwnPropertyDescriptor(ur.prototype,"setVolume"),ur.prototype),Ee(ur.prototype,"setPlaybackDevice",[kx],Object.getOwnPropertyDescriptor(ur.prototype,"setPlaybackDevice"),ur.prototype),Ee(ur.prototype,"play",[Lx],Object.getOwnPropertyDescriptor(ur.prototype,"play"),ur.prototype),Ee(ur.prototype,"stop",[xx],Object.getOwnPropertyDescriptor(ur.prototype,"stop"),ur.prototype),Ee(ur.prototype,"pipe",[Mx],Object.getOwnPropertyDescriptor(ur.prototype,"pipe"),ur.prototype),Ee(ur.prototype,"unpipe",[Ux],Object.getOwnPropertyDescriptor(ur.prototype,"unpipe"),ur.prototype),ur);const yc=new class extends Sn{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),q(this,"_lastHiddenTime",0),q(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),T.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class jx extends Sn{constructor(e,n){super(),q(this,"trackMediaType",mm.DATA),q(this,"_version",1),q(this,"_type",3),q(this,"_config",void 0),q(this,"_originDataChannel",void 0),q(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),q(this,"_dataStreamPacketHandler",{serialize:i=>i,deserialize:i=>i}),q(this,"_datachannelEventMap",new Map),this._config=e,n&&(this._originDataChannel=n,this._bandDataChannelEvents(n)),this._initPacketHeader()}useDataStream(e){this._dataStreamPacketHandler=e}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return k("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var e,n;return(e=(n=this._originDataChannel)===null||n===void 0?void 0:n.readyState)!==null&&e!==void 0?e:"connecting"}get _originDataChannelId(){var e,n;return(e=(n=this._originDataChannel)===null||n===void 0?void 0:n.id)!==null&&e!==void 0?e:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new Tt((e,n)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&e();const i=setTimeout(()=>{var r;n(new Z(P.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((r=this._originDataChannel)===null||r===void 0?void 0:r.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(i),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),e()},this._originDataChannel.onerror=()=>{throw clearTimeout(i),new Z(P.DATACHANNEL_CONNECTION_TIMEOUT)}}else n(new Z(P.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(e){this._originDataChannel=e,this._bandDataChannelEvents(e)}_initPacketHeader(){const e=new DataView(this._dataStreamPacketHeader);e.setUint16(0,this._version),e.setUint8(2,this._type),e.setUint8(3,this._config.id)}_bandDataChannelEvents(e){this._unbindDataChannelEvents(e),[fR.OPEN,fR.CLOSE,fR.ERROR].forEach(n=>{const i=()=>{this.emit(n)};this._datachannelEventMap.set(n,i),e.addEventListener(n,i)})}_unbindDataChannelEvents(e){Array.from(this._datachannelEventMap.entries()).forEach(n=>{let[i,r]=n;e.removeEventListener(i,r)}),this._datachannelEventMap.clear()}}class SG extends jx{constructor(e){super(e),q(this,"_messageListener",void 0),this._messageListener=n=>{if(n.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const i=n.data.slice(0,this._dataStreamPacketHeader.byteLength),r=new DataView(i).getUint8(3);if(r!==this.id)return void(k("SHOW_DATASTREAM2_LOG")&&T.debug("invalid datachannel id: ".concat(r," !== ").concat(this.id)));let s=n.data.slice(this._dataStreamPacketHeader.byteLength);s=this._dataStreamPacketHandler.deserialize(s),this.emit(fR.MESSAGE,s)}}_updateOriginDataChannel(e){super._updateOriginDataChannel(e),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class TG extends jx{send(e){if(this._originDataChannel){let n=e;n=this._dataStreamPacketHandler.serialize(e);const i=new Uint8Array(this._dataStreamPacketHeader.byteLength+n.byteLength);i.set(new Uint8Array(this._dataStreamPacketHeader),0),i.set(new Uint8Array(n),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(i.buffer)}}}function gR(){const t=new Blob([atob("Y29uc3QgdD0idmlkZW8vaDI2NCIsZT0idmlkZW8vaDI2NSI7ZnVuY3Rpb24gbih0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLHI9W10sbz0wO2Zvcig7ci5sZW5ndGg8bjspbyszPG4mJjA9PT1hW29dJiYwPT09YVtvKzFdJiYzPT09YVtvKzJdJiYoMD09PWFbbyszXXx8MT09PWFbbyszXXx8Mj09PWFbbyszXXx8Mz09PWFbbyszXSk/KHIucHVzaChhW29dLGFbbysxXSxhW28rM10pLG8rPTQpOihyLnB1c2goYVtvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkocil9ZnVuY3Rpb24gYShhLHIpe3N3aXRjaChyKXtjYXNlIHQ6cmV0dXJuIGZ1bmN0aW9uKHQpe2NvbnN0IGU9bmV3IERhdGFWaWV3KHQuZGF0YSk7bGV0IGE9MDtmb3IoO2ErNDx0LmRhdGEuYnl0ZUxlbmd0aDspe2lmKDA9PT1lLmdldFVpbnQ4KGErMCkmJjA9PT1lLmdldFVpbnQ4KGErMSkmJjA9PT1lLmdldFVpbnQ4KGErMikmJjE9PT1lLmdldFVpbnQ4KGErMykmJjY9PT1lLmdldFVpbnQ4KGErNCkpe2xldCByPWErNixvPTAsaT0wO2Zvcig7MjU1PT09KGk9ZS5nZXRVaW50OChyKyspKTspbys9MjU1O28rPWk7Y29uc3Qgcz1uKHQuZGF0YSxyLG8pO3JldHVybiBuZXcgVWludDhBcnJheShzKX1hKyt9cmV0dXJuIG51bGx9KGEpO2Nhc2UgZTpyZXR1cm4gZnVuY3Rpb24odCl7Y29uc3QgZT1uZXcgRGF0YVZpZXcodC5kYXRhKTtsZXQgYT0wO2Zvcig7YSs1PHQuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PWUuZ2V0VWludDgoYSswKSYmMD09PWUuZ2V0VWludDgoYSsxKSYmMD09PWUuZ2V0VWludDgoYSsyKSYmMT09PWUuZ2V0VWludDgoYSszKSYmNzg9PT1lLmdldFVpbnQ4KGErNCkmJjE9PT1lLmdldFVpbnQ4KGErNSkmJjEwMT09PWUuZ2V0VWludDgoYSs2KSl7bGV0IHI9YSs3LG89MCxpPTA7Zm9yKDsyNTU9PT0oaT1lLmdldFVpbnQ4KHIrKykpOylvKz0yNTU7bys9aTtjb25zdCBzPW4odC5kYXRhLHIsbyk7cmV0dXJuIG5ldyBVaW50OEFycmF5KHMpfWErK31yZXR1cm4gbnVsbH0oYSk7ZGVmYXVsdDpyZXR1cm4gbnVsbH19ZnVuY3Rpb24gcih0KXtjb25zdCBlPXQubGVuZ3RoO2xldCBuPVtdLGE9MDtmb3IoO2E8ZTspYSsyPGUmJjA9PT10W2FdJiYwPT09dFthKzFdJiYoMD09PXRbYSsyXXx8MT09PXRbYSsyXXx8Mj09PXRbYSsyXXx8Mz09PXRbYSsyXSk/KG4ucHVzaCh0W2FdLHRbYSsxXSwzLHRbYSsyXSksYSs9Myk6KG4ucHVzaCh0W2FdKSxhKyspO3JldHVybiBuZXcgVWludDhBcnJheShuKX1mdW5jdGlvbiBvKG4sYSxvKXtzd2l0Y2gobyl7Y2FzZSB0OnJldHVybiBmdW5jdGlvbih0LGUpe2NvbnN0IG49cihlKSxhPW4ubGVuZ3RoLG89TWF0aC5mbG9vcihhLzI1NSksaT1hJTI1NSxzPW5ldyBVaW50OEFycmF5KDYrbysxK2ErdC5ieXRlTGVuZ3RoKTtzWzBdPTAsc1sxXT0wLHNbMl09MCxzWzNdPTEsc1s0XT02LHNbNV09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNitmXT0yNTUsZisrO3JldHVybiBzWzYrZl09aSxmKysscy5zZXQobiw2K2YpLHMuc2V0KG5ldyBVaW50OEFycmF5KHQpLDYrZithKSxzLmJ1ZmZlcn0obixhKTtjYXNlIGU6cmV0dXJuIGZ1bmN0aW9uKHQsZSl7Y29uc3Qgbj1yKGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxpPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNytvKzErYSsxK3QuYnl0ZUxlbmd0aCk7c1swXT0wLHNbMV09MCxzWzJdPTAsc1szXT0xLHNbNF09Nzgsc1s1XT0xLHNbNl09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNytmXT0yNTUsZisrO3JldHVybiBzWzcrZl09aSxmKysscy5zZXQobiw3K2YpLGYrPWEsc1s3K2ZdPTEyOCxmKysscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNytmKSxzLmJ1ZmZlcn0obixhKTtkZWZhdWx0OnJldHVybiBudWxsfX1mdW5jdGlvbiBpKG4pe2lmKG4ubGVuZ3RoPDUpcmV0dXJuIiI7bGV0IGE9LTE7Zm9yKGxldCB0PTA7dDxuLmxlbmd0aC0zO3QrKyl7aWYoMD09PW5bdF0mJjA9PT1uW3QrMV0mJjE9PT1uW3QrMl0pe2E9dDticmVha31pZih0PG4ubGVuZ3RoLTQmJjA9PT1uW3RdJiYwPT09blt0KzFdJiYwPT09blt0KzJdJiYxPT09blt0KzNdKXthPXQ7YnJlYWt9fWlmKC0xPT09YSlyZXR1cm4iIjtjb25zdCByPWErKDA9PT1uW2ErMl0/NDozKTtpZihyPj1uLmxlbmd0aClyZXR1cm4iIjtjb25zdCBvPW5bcl07aWYoMTI4Jm8pcmV0dXJuIiI7aWYoKG8+PjEmNjMpPj0zMilyZXR1cm4gZTtpZihyKzE8bi5sZW5ndGgpe2lmKDA9PSgyNDgmbltyKzFdKSlyZXR1cm4gZX1yZXR1cm4oMzEmbyk8PTMxP3Q6IiJ9Y29uc3Qgcz03MSxmPTEsbD0yLHU9MSxnPTI7dmFyIGM7ZnVuY3Rpb24gZCh0LGU9ITEpe2NvbnN0IG49dC5nZXRVaW50OCgwKTtpZihuIT09cylyZXR1cm47Y29uc3QgYT10LmdldFVpbnQxNigxKSxyPWYrbCthLG89bmV3IFVpbnQ4QXJyYXkodC5ieXRlTGVuZ3RoLXIpO28uc2V0KG5ldyBVaW50OEFycmF5KHQuYnVmZmVyLHIsdC5ieXRlTGVuZ3RoLXIpKTtjb25zdCBpPXttOm4sdGx2TGVuOmEsdGx2OltdLGZyYW1lOm99O2xldCBkPWYrbDtmb3IoO2Q8cjspe2NvbnN0IG49dC5nZXRVaW50OChkKSxhPXQuZ2V0VWludDE2KGQrdSkscj11K2c7aWYobj09PWMuQVVESU9fTEVWRUwpe2xldCBvPXQuZ2V0VWludDgoZCtyKTtmb3IobGV0IGU9MTtlPGE7ZSsrKW89bzw8OHx0LmdldFVpbnQ4KGQrcitlKTtpLnRsdi5wdXNoKHt0YWc6bixsZW5ndGg6YSx2YWx1ZTplPzEyN15vPj4xOjEyNyZvfSl9ZWxzZSBpZihuPT09Yy5NRVRBREFUQXx8bj09PWMuQVVESU9fNjRfQklUX1BUUyl7Y29uc3QgZT1uZXcgVWludDhBcnJheShhKTtmb3IobGV0IG49MDtuPGE7bisrKWVbbl09dC5nZXRVaW50OChkK3Irbik7aS50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZX0pfWQrPXIrYX1yZXR1cm4gaX0hZnVuY3Rpb24odCl7dFt0LkFVRElPX0xFVkVMPTFdPSJBVURJT19MRVZFTCIsdFt0Lk1FVEFEQVRBPTJdPSJNRVRBREFUQSIsdFt0LkFVRElPXzY0X0JJVF9QVFM9M109IkFVRElPXzY0X0JJVF9QVFMifShjfHwoYz17fSkpLHNlbGYub25ydGN0cmFuc2Zvcm09dD0+e2NvbnN0IGU9dC50cmFuc2Zvcm1lcjtsZXQgbj1bXSxyPVtdO2Uub3B0aW9ucy5wb3J0Lm9ubWVzc2FnZT10PT57dC5kYXRhLnNlaSYmbi5wdXNoKHQuZGF0YS5zZWkpLHQuZGF0YS5tZXRhZGF0YSYmci5wdXNoKHQuZGF0YS5tZXRhZGF0YSl9LHNlbGYucG9zdE1lc3NhZ2UoInN0YXJ0ZWQiKTtjb25zdCBoPWUucmVhZGFibGUuZ2V0UmVhZGVyKCksVT1lLndyaXRhYmxlLmdldFdyaXRlcigpOyJzZWktcngiPT09ZS5vcHRpb25zLm5hbWU/ZnVuY3Rpb24gdChlKXtoLnJlYWQoKS50aGVuKChuPT57aWYoIW4uZG9uZSl7aWYobi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRWaWRlb0ZyYW1lKXtjb25zdCB0PWkobmV3IFVpbnQ4QXJyYXkobi52YWx1ZS5kYXRhKSkscj1hKG4udmFsdWUsdCk7ciYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTpyfSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6InNlaS10eCI9PT1lLm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2gucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9aShuZXcgVWludDhBcnJheShhLnZhbHVlLmRhdGEpKSxlPW4uc2hpZnQoKTtpZihlKXtjb25zdCBuPW8oYS52YWx1ZS5kYXRhLGUsdCk7biYmKGEudmFsdWUuZGF0YT1uKX19VS53cml0ZShhLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6ImF1ZGlvLW1ldGFkYXRhLXJ4Ij09PWUub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1uZXcgRGF0YVZpZXcobi52YWx1ZS5kYXRhKSxhPXQuZ2V0VWludDgoMCk7bGV0IHI7aWYoMCE9KDEyOCZhKSYmNzEhPT1hKXtsZXQgZT1mdW5jdGlvbih0KXtpZih0LmJ5dGVMZW5ndGg8PTApcmV0dXJuW107Y29uc3QgZT1bXTtsZXQgbj0wO2Zvcig7bjx0LmJ5dGVMZW5ndGg7KXtjb25zdCBhPSgxMjgmdC5nZXRVaW50OChuKSk+Pjcscj0xMjcmdC5nZXRVaW50OChuKTtpZighKGEmJm4rNDw9dC5ieXRlTGVuZ3RoKSl7bisrO2JyZWFrfXtjb25zdCBhPXQuZ2V0VWludDMyKG4sITEpLG89KDE2Nzc2MTkyJmEpPj4xMCxpPTEwMjMmYTtlLnB1c2goe3B0OnIsdHNfb2Zmc2V0Om8sbGVuZ3RoOmksZGF0YTpuZXcgVWludDhBcnJheX0pLG4rPTR9fWxldCBhPXQuYnl0ZUxlbmd0aC1uO2Zvcihjb25zdCByIG9mIGUpe2lmKHIubGVuZ3RoPmEpcmV0dXJuIGNvbnNvbGUud2FybigiQnJva2VuIHJlZCBwYXlsb2FkIiksW107ci5sZW5ndGg+MCYmKHIuZGF0YT1uZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixyLmxlbmd0aCksbis9ci5sZW5ndGgsYS09ci5sZW5ndGgpfWlmKGE+MCl7Y29uc3Qgcj17cHQ6ZS5sZW5ndGg+MD9lW2UubGVuZ3RoLTFdLnB0OjAsdHNfb2Zmc2V0OjAsbGVuZ3RoOmEsZGF0YTpuZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixhKX07ZS5wdXNoKHIpfXJldHVybiBlfSh0KTtpZihlLmxlbmd0aD4wKXtjb25zdCB0PWZ1bmN0aW9uKHQpe2xldCBlPTA7Zm9yKGxldCBuPTA7bjx0Lmxlbmd0aDtuKyspZSs9bjx0Lmxlbmd0aC0xPzQ6MSxlKz10W25dLmxlbmd0aDtjb25zdCBuPW5ldyBVaW50OEFycmF5KGUpO2xldCBhPTA7Zm9yKGxldCBlPTA7ZTx0Lmxlbmd0aDtlKyspaWYoZTx0Lmxlbmd0aC0xKXtjb25zdCByPSgyMTQ3NDgzNjQ4fCgxMjcmdFtlXS5wdCk8PDI0fCgyNjIxNDMmdFtlXS50c19vZmZzZXQpPDwxMHwxMDIzJnRbZV0ubGVuZ3RoKT4+PjA7blthKytdPXI+PjI0JjI1NSxuW2ErK109cj4+MTYmMjU1LG5bYSsrXT1yPj44JjI1NSxuW2ErK109MjU1JnJ9ZWxzZSBuW2ErK109MTI3JnRbZV0ucHQ7Zm9yKGNvbnN0IGUgb2YgdCluLnNldChlLmRhdGEsYSksYSs9ZS5sZW5ndGg7cmV0dXJuIG59KGUubWFwKCh0PT57bGV0IGU9bmV3IFVpbnQ4QXJyYXkodC5sZW5ndGgpO2Uuc2V0KHQuZGF0YSk7Y29uc3Qgbj1kKG5ldyBEYXRhVmlldyhlLmJ1ZmZlcikpO3JldHVybiBuPy5mcmFtZSYmKHQuZGF0YT1uPy5mcmFtZSkscj1uLHR9KSkpO24udmFsdWUuZGF0YT10LmJ1ZmZlcn19ZWxzZSByPWQodCksciYmKG4udmFsdWUuZGF0YT1yLmZyYW1lLmJ1ZmZlcik7aWYocil7bGV0IHQ9ci50bHYuZmluZCgodD0+dC50YWc9PT1jLk1FVEFEQVRBKSk7aWYodCYmdC52YWx1ZSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkmJmUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHttZXRhZGF0YTp0LnZhbHVlfSksdD1yLnRsdi5maW5kKCh0PT50LnRhZz09PWMuQVVESU9fNjRfQklUX1BUUykpLHQmJnQudmFsdWUgaW5zdGFuY2VvZiBVaW50OEFycmF5JiY4PT10LnZhbHVlLmxlbmd0aCl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcodC52YWx1ZS5idWZmZXIpLmdldEJpZ1VpbnQ2NCgwLCEwKTt0JiZ0LnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3B0czpufSl9fX1VLndyaXRlKG4udmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToiYXVkaW8tbWV0YWRhdGEtdHgiPT09ZS5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHtnZXRNZXRhZGF0YTohMH0pLG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1yLnNoaWZ0KCk7dCYmKG4udmFsdWUuZGF0YT1mdW5jdGlvbih0LGUsbil7Y29uc3QgYT1uLmJ5dGVMZW5ndGgscj1hK3UrZyxvPWYrbCtyLGk9bmV3IEFycmF5QnVmZmVyKHQuYnl0ZUxlbmd0aCtvKSxjPW5ldyBEYXRhVmlldyhpKTtjLnNldFVpbnQ4KDAscyksYy5zZXRVaW50MTYoMSxyKSxjLnNldFVpbnQ4KDMsZSksYy5zZXRVaW50MTYoNCxhKTtmb3IobGV0IHQ9MDt0PGE7dCsrKWMuc2V0VWludDgoNit0LG5bdF0pO2NvbnN0IGQ9bmV3IFVpbnQ4QXJyYXkoYy5idWZmZXIpO3JldHVybiBkLnNldChuZXcgVWludDhBcnJheSh0KSxvKSxkLmJ1ZmZlcn0obi52YWx1ZS5kYXRhLGMuQVVESU9fNjRfQklUX1BUUyx0KSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSl9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKTsK")],{type:"text/javascript"});return setTimeout(()=>Ey.revokeObjectURL(t),0),new Worker(Ey.createObjectURL(t))}const Bx=71,Rw=1,bw=2,Cw=1,Fx=2;var Wd=function(t){return t[t.AUDIO_LEVEL=1]="AUDIO_LEVEL",t[t.METADATA=2]="METADATA",t[t.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",t}(Wd||{});function Aw(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=t.getUint8(0);if(n!==Bx)return;const i=t.getUint16(1),r=Rw+bw+i,s=new Uint8Array(t.byteLength-r);s.set(new Uint8Array(t.buffer,r,t.byteLength-r));const c={m:n,tlvLen:i,tlv:[],frame:s};let l=Rw+bw;for(;l<r;){const d=t.getUint8(l),h=t.getUint16(l+Cw),p=Cw+Fx;if(d===Wd.AUDIO_LEVEL){let m=t.getUint8(l+p);for(let _=1;_<h;_++)m=m<<8|t.getUint8(l+p+_);c.tlv.push({tag:d,length:h,value:e?127^m>>1:127&m})}else if(d===Wd.METADATA||d===Wd.AUDIO_64_BIT_PTS){const m=new Uint8Array(h);for(let _=0;_<h;_++)m[_]=t.getUint8(l+p+_);c.tlv.push({tag:d,length:h,value:m})}l+=p+h}return c}const vR=new Map,SR=127,jh=1e-10,ww=139/13,TR=new Map;function Iw(t,e,n){const i="".concat(t,"-").concat(e,"-").concat(n);let r=0;return TR.has(i)?r=TR.get(i):(r=Math.log(function(c,l){const d=c-l;l<d&&(l=d);let h=1;for(let p=c,m=1;p>l;p--,m++)h=h*p/m;return h}(e,t))+t*Math.log(.5)+(e-t)*Math.log(1-.5)-Math.log(n)+n*t,TR.set(i,r)),r<jh&&(r=jh),r}function Gx(t,e,n){const i=e.length,r=t.length/i;let s=!1;for(let c=0,l=0;c<i;c++){let d=0;for(let h=l+r;l<h;l++)t[l]>n&&d++;e[c]!==d&&(e[c]=d,s=!0)}return s}window.cache=TR;let yG=0;class Hx{constructor(e){q(this,"id",void 0),q(this,"immediates",[]),q(this,"lastNonSilence",-1),q(this,"immediateSpeechActivityScore",jh),q(this,"lastLevelChangedTime",Date.now()),q(this,"levels",[]),q(this,"longs",[]),q(this,"longSpeechActivityScore",jh),q(this,"mediums",[]),q(this,"mediumSpeechActivityScore",jh),q(this,"minLevel",0),q(this,"nextMinLevel",0),q(this,"nextMinLevelWindowLength",0),q(this,"energyScore",0),this.id=e||"".concat(yG++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const e=this.immediates,n=this.levels,i=this.minLevel+ww;let r=!1;for(let s=0;s<e.length;++s){let c=n[s];c<i&&(c=0);const l=Math.floor(c/ww);e[s]!==l&&(e[s]=l,r=!0)}return r}computeLongs(){return Gx(this.mediums,this.longs,4)}computeMediums(){return Gx(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=Iw(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(e){this.longSpeechActivityScore=Iw(this.longs[0],10,47),this.longSpeechActivityScore>jh&&(this.lastNonSilence=e)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=Iw(this.mediums[0],5,24)}evaluateSpeechActivityScores(e){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(e)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var e;return"[".concat(Pp(e=[...this.levels]).call(e).join(),"]")}getSpeechActivityScore(e){switch(e){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+e)}}levelChanged(e,n){if(this.lastLevelChangedTime<=n){this.lastLevelChangedTime=n;let i=e;return e<0&&(i=0),e>SR&&(i=SR),this.levels.unshift(i),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(i),i>=this.minLevel+ww?i:i/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(e){if(e!==0){if(this.minLevel===0||this.minLevel>e)return this.minLevel=e,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=e,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>e&&(this.nextMinLevel=e),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let n=Math.sqrt(this.minLevel*this.nextMinLevel);n<0?n=0:n>SR&&(n=SR),this.minLevel=n,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class RG{constructor(e){q(this,"algorithm",void 0),this.algorithm=e}execute(){let e=!this.algorithm;if(!e)try{const n=this.algorithm.runInDecisionMaker(this);n<=0?e=!0:setTimeout(this.execute.bind(this),n)}catch{e=!0}e&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class Ow{constructor(e,n,i){q(this,"isDominant",void 0),q(this,"energyRanking",void 0),q(this,"energyScore",void 0),this.isDominant=e,this.energyRanking=n,this.energyScore=i}}class bG extends Sn{constructor(e){super(),q(this,"dominantId",null),q(this,"lastDecisionTime",0),q(this,"lastLevelChangedTime",0),q(this,"lastLevelIdleTime",0),q(this,"relativeSpeechActivities",[]),q(this,"speakers",new Map),q(this,"enableSilence",!1),q(this,"timeoutToSilenceInterval",0),q(this,"decisionMaker",null),q(this,"loudest",[]),q(this,"numLoudestToTrack",3),q(this,"energyExpireTimeMs",250),q(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=e,this.enableSilence=e>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,n=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=e,n!=null&&(this.energyExpireTimeMs=n),i!=null&&(this.energyAlphaPct=i),this.loudest.length>e&&this.loudest.splice(e)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(e){return this.loudest.some(n=>n.id===e)}levelChanged(e,n){const i=Date.now(),r=this.getOrCreateSpeaker(e);this.lastLevelChangedTime<i&&(this.lastLevelChangedTime=i,this.maybeStartDecisionMaker());const s=r.levelChanged(n,i);return this.updateLoudestList(r,s,i)}runInDecisionMaker(e){return this.decisionMaker!==e||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(e){this.decisionMaker===e&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(e){e.forEach(n=>{this.speakers.has(n.id)||this.speakers.set(n.id,n)})}removeSpeakers(e){e.forEach(n=>{this.speakers.delete(n.id)})}getOrCreateSpeaker(e){let n=this.speakers.get(e);return n||(n=new Hx(e),this.speakers.set(e,n),this.maybeStartDecisionMaker()),n}updateLoudestList(e,n,i){const r=e.id===this.dominantId;if(n<0){let d=0;for(;d<this.loudest.length&&this.loudest[d]!==e;)++d;return new Ow(r,d,e.energyScore)}if(e.energyScore=Math.floor((this.energyAlphaPct*n+(100-this.energyAlphaPct)*e.energyScore+50)/100),this.numLoudestToTrack===0)return new Ow(r,0,e.energyScore);const s=i-this.energyExpireTimeMs;let c=0;for(;c<this.loudest.length;){const d=this.loudest[c];if(d.getLastLevelChangedTime()<s&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(c,1);else if(d.id!==e.id)++c;else if(this.loudest.splice(c,1),this.loudest.length<this.numLoudestToTrack)break}let l=0;for(;l<this.loudest.length&&!(this.loudest[l].energyScore<e.energyScore);)++l;return l<this.numLoudestToTrack&&(this.loudest.splice(l,0,e),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new Ow(r,l,e.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new RG(this),this.decisionMaker.execute())}makeDecision(e){let n=null,i=null;const r=this.speakers.size;let s=null;if(r===0)s=null;else if(r===1){var c;const l=wr(c=this.speakers).call(c).next().value;this.enableSilence&&l&&(s=l.id,l.evaluateSpeechActivityScores(e),e-l.lastNonSilence>this.timeoutToSilenceInterval&&(s=null))}else{let l=this.dominantId==null?null:this.speakers.get(this.dominantId);if(l==null){const p=this.speakers.entries().next();p.value&&(s=p.value[0],l=p.value[1])}else s=l.id;l!=null&&l.evaluateSpeechActivityScores(e);const d=this.relativeSpeechActivities;let h=2;for(const p of this.speakers.entries()){const[m,_]=p;if(_===l)continue;_.evaluateSpeechActivityScores(e);for(let w=0;w<d.length;++w){const D=l==null?jh:l.getSpeechActivityScore(w);d[w]=Math.log(_.getSpeechActivityScore(w)/D)}const E=d[0],I=d[1],C=d[2];E>3&&I>2&&C>0&&I>h&&(h=I,s=m)}this.enableSilence&&l!=null&&s===l.id&&e-l.lastNonSilence>this.timeoutToSilenceInterval&&(s=null)}s==null&&!this.enableSilence||s===this.dominantId||(n=this.dominantId,this.dominantId=s,i=this.dominantId),i==null&&!this.enableSilence||i===n||this.emit("ActiveSpeakerChanged",i)}_runInDecisionMaker(){const e=Date.now(),n=300-(e-this.lastLevelIdleTime);let i=0;n<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(e),this.lastLevelIdleTime=e):i=n;let r=300-(e-this.lastDecisionTime);return r<=0&&(this.lastDecisionTime=e,this.makeDecision(e),r=300-(Date.now()-e)),r>0&&i>r&&(i=r),i}timeoutIdleLevels(e){const n=[];for(const r of wr(i=this.speakers).call(i)){var i;const s=e-r.getLastLevelChangedTime();36e5<s&&(this.dominantId==null||r.id!==this.dominantId)?n.push(r.id):300<s&&r.levelTimedOut()}n.forEach(r=>this.speakers.delete(r))}}const Tm=new Map;let Co=null,yR=null;const Wx=3;let Bh=[];const Ao=new Map,RR=new Map;class CG{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(e,n){q(this,"id",void 0),q(this,"track",void 0),q(this,"score",0),q(this,"active",!0),q(this,"muted",!1),q(this,"timer",0),q(this,"actives",0),q(this,"inactives",0),this.id=e,this.track=n,this.setActive(Ao.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const e=this.active;this.active=this.activeRate>=.8;const{actives:n,inactives:i}=function(){const r=[],s=[];return Array.from(wr(Ao).call(Ao)).forEach(c=>{c.active?r.push(c):s.push(c)}),{actives:r,inactives:s}}();if(n.length>3){let r;n.forEach(s=>{(!r||r.score>s.score)&&(r=s)}),r&&r.setActive(!1)}if(n.length<3&&i.length>0){let r;i.forEach(s=>{(!r||r.score<s.score)&&s.id!==this.id&&(r=s)}),r&&e&&!this.active&&(r.samples>40&&r.activeRate-this.activeRate>.4?r.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(e){this.active=e,this.resetTimer(),this.setMuted(!e)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const e=function(n){let i;return Array.from(wr(Ao).call(Ao)).forEach(r=>{!r.active||r.id===n||r.samples<40||(!i||r.score<i.score)&&(i=r)}),i}(this.id);e&&this.activeRate-e.activeRate>.4&&(e.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const e=function(n){let i;return Array.from(wr(Ao).call(Ao)).forEach(r=>{r.active||r.id===n||r.samples<40||(!i||r.score>i.score)&&(i=r)}),i}(this.id);e&&e.activeRate-this.activeRate>.4&&(e.setActive(!0),this.setActive(!1))}addSample(e){e?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(e){this.track&&(this.track.enabled=!e,this.muted=e)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let bR;function zx(t){const e=Ao.get(t);e&&(Ao.delete(t),e.clearTimer())}const CR=new Map,AG=new Map,Nw="video/h264",Dw="video/h265";function qx(t,e,n){let i=new Uint8Array(t,e,n),r=[],s=0;for(;r.length<n;)s+3<n&&i[s]===0&&i[s+1]===0&&i[s+2]===3&&(i[s+3]===0||i[s+3]===1||i[s+3]===2||i[s+3]===3)?(r.push(i[s],i[s+1],i[s+3]),s+=4):(r.push(i[s]),s++);return new Uint8Array(r)}function Kx(t){const e=t.length;let n=[],i=0;for(;i<e;)i+2<e&&t[i]===0&&t[i+1]===0&&(t[i+2]===0||t[i+2]===1||t[i+2]===2||t[i+2]===3)?(n.push(t[i],t[i+1],3,t[i+2]),i+=3):(n.push(t[i]),i++);return new Uint8Array(n)}function Yx(t){if(t.length<5)return"";let e=-1;for(let r=0;r<t.length-3;r++){if(t[r]===0&&t[r+1]===0&&t[r+2]===1){e=r;break}if(r<t.length-4&&t[r]===0&&t[r+1]===0&&t[r+2]===0&&t[r+3]===1){e=r;break}}if(e===-1)return"";const n=e+(t[e+2]===0?4:3);if(n>=t.length)return"";const i=t[n];return 128&i?"":(i>>1&63)>=32||n+1<t.length&&(248&t[n+1])==0?Dw:(31&i)<=31?Nw:""}const AR=new Map,jg=new Map;(function(){const t=ve();Ri.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),Ri.getStreamFromExtension=t.name===Ie.CHROME&&Number(t.version)>34,Ri.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const e=new RTCPeerConnection;let n=!1;try{e.addTransceiver("audio"),n=!0}catch{}return e.close(),n}(),Ri.supportMinBitrate=t.name===Ie.CHROME||t.name===Ie.EDGE,Ri.supportSetRtpSenderParameters=function(){const e=ve();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!yl()||!(!Di()&&!eR())||e.name===Ie.FIREFOX&&Number(e.version)>=64)}(),t.name===Ie.SAFARI&&(Number(t.version)>=14?Ri.supportDualStream=!0:Ri.supportDualStream=!1),Ri.webAudioMediaStreamDest=function(){const e=ve();return!(e.name===Ie.SAFARI&&Number(e.version)<12)}(),Ri.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",Ri.supportWebGL=typeof WebGLRenderingContext<"u",Ri.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,yl()||(Ri.webAudioWithAEC=!0),Ri.supportShareAudio=function(){const e=ve();return(e.os===di.WIN_10||e.os===di.WIN_81||e.os===di.WIN_7||e.os===di.LINUX||e.os===di.MAC_OS||e.os===di.CHROMIUM_OS)&&e.name===Ie.CHROME&&Number(e.version)>=74}(),Ri.supportDataChannel=!!(im(76)||MA(68)||Kk(14)),Ri.supportPCSetConfiguration=function(){const e=window.RTCPeerConnection;return!An()&&!!e&&e.prototype.setConfiguration instanceof Function}(),Ri.supportWebRTCEncodedTransform=im(87)||Wk()||MA(117),Ri.supportWebRTCInsertableStream=function(){const e=ve();return(e.name===Ie.CHROME||e.name===Ie.EDGE)&&Number(e.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),Ri.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,Ri.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,rR(()=>{Ri.supportDualStreamEncoding=function(){const e=ve();return!!k("DISABLE_WEBAUDIO")||e.name==="Safari"&&Number(e.version)>=14||!!(e.name==="Chrome"&&/Windows/i.test(e.os||"")&&Number(e.version)>=100&&k("CHROME_DUAL_STREAM_USE_ENCODING"))}(),T.debug("browser ua: ",navigator.userAgent),T.info("browser info: ",t),T.info("browser compatibility: ",Ri)})})();const wG=["CHINA","GLOBAL"],Xx=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],Fh=[],ym=[];function Gh(t,e){return!!e&&Fh.some(n=>n.uid===t&&n.channelName===e)}function Pw(){return ym.length>0}var IG=lP.forEach,Qx=Hc("forEach")?[].forEach:function(t){return IG(this,t,arguments.length>1?arguments[1]:void 0)};Le({target:"Array",proto:!0,forced:[].forEach!==Qx},{forEach:Qx});var OG=$r("Array","forEach"),NG=no,DG=ci,PG=vt,kG=OG,kw=Array.prototype,LG={DOMTokenList:!0,NodeList:!0},xG=function(t){var e=t.forEach;return t===kw||PG(kw,t)&&e===kw.forEach||DG(LG,NG(t))?kG:e},MG=V(xG),UG=ja,Jx=id;Le({target:"Object",stat:!0,forced:B(function(){Jx(1)})},{keys:function(t){return Jx(UG(t))}});var VG=V(Ui.Object.keys),jG=V(qo),BG=V(N_),FG=Le,Zx=ps,GG=Zu,HG=Ei,$x=Cp,WG=Fo,zG=Va,qG=E0,KG=Mn,YG=Cr,XG=$D("slice"),QG=KG("species"),Lw=Array,JG=Math.max;FG({target:"Array",proto:!0,forced:!XG},{slice:function(t,e){var n,i,r,s=zG(this),c=WG(s),l=$x(t,c),d=$x(e===void 0?c:e,c);if(Zx(s)&&(n=s.constructor,(GG(n)&&(n===Lw||Zx(n.prototype))||HG(n)&&(n=n[QG])===null)&&(n=void 0),n===Lw||n===void 0))return YG(s,l,d);for(i=new(n===void 0?Lw:n)(JG(d-l,0)),r=0;l<d;l++,r++)l in s&&qG(i,r,s[l]);return i.length=r,i}});var ZG=$r("Array","slice"),$G=vt,t8=ZG,xw=Array.prototype,e8=function(t){var e=t.slice;return t===xw||$G(xw,t)&&e===xw.slice?t8:e},n8=V(e8);function Dt(t,e,n,i,r){var s,c,l,d={};return MG(s=VG(i)).call(s,function(h){d[h]=i[h]}),d.enumerable=!!d.enumerable,d.configurable=!!d.configurable,("value"in d||d.initializer)&&(d.writable=!0),d=jG(c=BG(l=n8(n).call(n)).call(l)).call(c,function(h,p){return p(t,e,h)||h},d),r&&d.initializer!==void 0&&(d.value=d.initializer?d.initializer.call(r):void 0,d.initializer=void 0),d.initializer===void 0?(XD(t,e,d),null):d}let wR=function(t){return t[t.ACCESS_POINT=101]="ACCESS_POINT",t[t.UNILBS=201]="UNILBS",t[t.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",t}({}),Mw=function(t){return t[t.IIIEGAL_APPID=1]="IIIEGAL_APPID",t[t.IIIEGAL_UID=2]="IIIEGAL_UID",t[t.INTERNAL_ERROR=3]="INTERNAL_ERROR",t}({}),Ls=function(t){return t[t.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",t[t.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",t[t.INTERNAL_ERROR=8]="INTERNAL_ERROR",t[t.NO_AUTHORIZED=9]="NO_AUTHORIZED",t[t.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",t[t.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",t[t.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",t[t.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",t[t.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",t[t.USER_OVERLOAD=16]="USER_OVERLOAD",t[t.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",t[t.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",t}({}),vr=function(t){return t[t.NO_FLAG_SET=100]="NO_FLAG_SET",t[t.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",t[t.INVALID_FALG_SET=102]="INVALID_FALG_SET",t[t.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",t[t.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",t[t.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",t[t.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",t[t.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",t[t.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",t[t.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",t[t.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",t[t.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",t[t.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",t[t.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",t[t.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",t[t.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",t[t.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",t[t.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",t[t.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",t}({}),Vt=function(t){return t[t.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",t[t.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",t[t.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",t[t.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",t[t.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",t[t.K_TICKET_INVALID=7]="K_TICKET_INVALID",t[t.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",t[t.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",t[t.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",t[t.K_UID_BANNED=14]="K_UID_BANNED",t[t.K_IP_BANNED=15]="K_IP_BANNED",t[t.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",t[t.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",t[t.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",t[t.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",t[t.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",t[t.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",t[t.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",t[t.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",t[t.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",t[t.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",t[t.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",t[t.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",t[t.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",t[t.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",t[t.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",t[t.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",t[t.ERR_INVALID_UID=117]="ERR_INVALID_UID",t[t.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",t[t.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",t[t.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",t[t.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",t[t.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",t[t.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",t[t.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",t[t.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",t[t.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",t[t.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",t[t.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",t[t.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",t[t.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",t[t.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",t[t.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",t[t.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",t[t.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",t[t.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",t[t.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",t[t.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",t[t.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",t[t.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",t[t.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",t[t.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",t[t.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",t[t.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",t[t.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",t[t.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",t[t.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",t[t.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",t[t.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",t[t.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",t[t.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",t[t.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",t[t.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",t[t.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",t[t.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",t}({}),an=function(t){return t.CONNECTING="connecting",t.CONNECTED="connected",t.RECONNECTING="reconnecting",t.CLOSED="closed",t}({}),Yt=function(t){return t.WS_CONNECTED="ws_connected",t.WS_RECONNECTING="ws_reconnecting",t.WS_CLOSED="ws_closed",t.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",t.ON_BINARY_DATA="on_binary_data",t.REQUEST_RECOVER="request_recover",t.REQUEST_JOIN_INFO="request_join_info",t.REQUEST_REJOIN_INFO="req_rejoin_info",t.IS_P2P_DISCONNECTED="is_p2p_dis",t.DISCONNECT_P2P="dis_p2p",t.ABORT_P2P_EXECUTION="abort_p2p_execution",t.NEED_RENEW_SESSION="need-sid",t.REPORT_JOIN_GATEWAY="report_join_gateway",t.REQUEST_TIMEOUT="request_timeout",t.REQUEST_SUCCESS="request_success",t.JOIN_RESPONSE="join_response",t.PRE_CONNECT_PC="pre_connect_pc",t.P2P_CONNECTION="p2p_connection",t.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",t.P2P_SUBSCRIBE="p2p_subscribe",t.P2P_UNSUBSCRIBE="p2p_unsubscribe",t.P2P_EXCHANGE_SDP="p2p_exchange_sdp",t.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",t.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",t.RECOVER_NOTIFICATION="recover_notification",t}({}),Wt=function(t){return t.PING="ping",t.PING_BACK="ping_back",t.JOIN="join_v3",t.REJOIN="rejoin_v3",t.LEAVE="leave",t.SET_CLIENT_ROLE="set_client_role",t.PUBLISH="publish",t.PUBLISH_DATASTREAM="publish_datastream",t.UNPUBLISH="unpublish",t.UNPUBLISH_DATASTREAM="unpublish_datastream",t.SUBSCRIBE="subscribe",t.PRE_SUBSCRIBE="pre_subscribe",t.SUBSCRIBE_DATASTREAM="subscribe_datastream",t.SUBSCRIBE_STREAMS="subscribe_streams",t.UNSUBSCRIBE="unsubscribe",t.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",t.UNSUBSCRIBE_STREAMS="unsubscribe_streams",t.SUBSCRIBE_CHANGE="subscribe_change",t.TRAFFIC_STATS="traffic_stats",t.RENEW_TOKEN="renew_token",t.SWITCH_VIDEO_STREAM="switch_video_stream",t.DEFAULT_VIDEO_STREAM="default_video_stream",t.SET_FALLBACK_OPTION="set_fallback_option",t.GATEWAY_INFO="gateway_info",t.CONTROL="control",t.SEND_METADATA="send_metadata",t.DATA_STREAM="data_stream",t.PICK_SVC_LAYER="pick_svc_layer",t.RESTART_ICE="restart_ice",t.CONNECT_PC="connect_pc",t.SET_VIDEO_PROFILE="set_video_profile",t.SET_PARAMETER="set_parameter",t.SET_RTM2_FLAG="set_rtm2_flag",t.DOWNGRADE_CODEC="downgrade_codec",t}({}),Bg=function(t){return t.WRTC_STATS="wrtc_stats",t.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",t.DENOISER_STATS="denoiser_stats",t.EXTENSION_USAGE_STATS="extension_usage_stats",t}({}),pe=function(t){return t.ON_USER_ONLINE="on_user_online",t.ON_USER_OFFLINE="on_user_offline",t.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",t.ON_PUBLISH_STREAM="on_publish_stream",t.ON_UPLINK_STATS="on_uplink_stats",t.ON_P2P_LOST="on_p2p_lost",t.ON_REMOVE_STREAM="on_remove_stream",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",t.ON_USER_BANNED="on_user_banned",t.ON_USER_LICENSE_BANNED="on_user_license_banned",t.ON_NOTIFICATION="on_notification",t.ON_CRYPT_ERROR="on_crypt_error",t.MUTE_AUDIO="mute_audio",t.MUTE_VIDEO="mute_video",t.UNMUTE_AUDIO="unmute_audio",t.UNMUTE_VIDEO="unmute_video",t.ON_P2P_OK="on_p2p_ok",t.RECEIVE_METADATA="receive_metadata",t.ON_DATA_STREAM="on_data_stream",t.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",t.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",t.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",t.ENABLE_LOCAL_VIDEO="enable_local_video",t.DISABLE_LOCAL_VIDEO="disable_local_video",t.ENABLE_LOCAL_AUDIO="enable_local_audio",t.DISABLE_LOCAL_AUDIO="disable_local_audio",t.ON_PUBLISHED_USER_LIST="on_published_user_list",t}({}),Sr=function(t){return t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY",t}({}),ee=function(t){return t.CONNECTED="websocket:connected",t.RECONNECTING="websocket:reconnecting",t.WILL_RECONNECT="websocket:will_reconnect",t.CLOSED="websocket:closed",t.FAILED="websocket:failed",t.ON_MESSAGE="websocket:on_message",t.REQUEST_NEW_URLS="websocket:request_new_urls",t.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",t}({});function IR(t){if(typeof t!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(t))throw T.error("Invalid Channel Name ".concat(t)),new K(P.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function OR(t){if(e=t,!(typeof e=="number"&&Math.floor(e)===e&&0<=e&&e<=4294967295||eL(t,1,255)))throw new K(P.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var e;typeof t=="string"&&T.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let bl=function(t){return t.TRANSCODE="mix_streaming",t.RAW="raw_streaming",t}({});const i8={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},Uw={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function Vw(t,e){Ti(t.url,"".concat(e,".url"),1,1e3,!1),wn(t.x)||Ke(t.x,"".concat(e,".x"),0,1e4),wn(t.y)||Ke(t.y,"".concat(e,".y"),0,1e4),wn(t.width)||Ke(t.width,"".concat(e,".width"),0,1e4),wn(t.height)||Ke(t.height,"".concat(e,".height"),0,1e4),wn(t.zOrder)||Ke(t.zOrder,"".concat(e,".zOrder"),0,255),wn(t.alpha)||Ke(t.alpha,"".concat(e,".alpha"),0,1,!1)}const r8={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let zd=function(t){return t.WARNING="@live_uap-warning",t.ERROR="@line_uap-error",t.PUBLISH_STREAM_STATUS="@live_uap-publish-status",t.WORKER_STATUS="@live_uap-worker-status",t.REQUEST_NEW_ADDRESS="@live_uap-request-address",t}({}),jw=function(t){return t.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",t}({}),ti=function(t){return t[t.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",t[t.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",t[t.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",t[t.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",t[t.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",t[t.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",t[t.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",t[t.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",t[t.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",t[t.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",t[t.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",t[t.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",t[t.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",t[t.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",t[t.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",t[t.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",t}({});function tM(t){if(!t.channelName)throw new K(P.INVALID_PARAMS,"invalid channelName in info");if(typeof t.uid!="number")throw new K(P.INVALID_PARAMS,"invalid uid in info, uid must be a number");return t.token&&Ti(t.token,"info.token",1,2047),OR(t.uid),IR(t.channelName),!0}let Tr=function(t){return t[t.SetSdkProfile=0]="SetSdkProfile",t[t.SetSourceChannel=1]="SetSourceChannel",t[t.SetSourceUserId=2]="SetSourceUserId",t[t.SetDestChannel=3]="SetDestChannel",t[t.StartPacketTransfer=4]="StartPacketTransfer",t[t.StopPacketTransfer=5]="StopPacketTransfer",t[t.UpdateDestChannel=6]="UpdateDestChannel",t[t.Reconnect=7]="Reconnect",t[t.SetVideoProfile=8]="SetVideoProfile",t}({}),Cl=function(t){return t.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",t.NETWORK_CONNECTED="NETWORK_CONNECTED",t.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",t.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",t.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",t.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",t.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",t.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",t.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",t.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",t}({}),qr=function(t){return t.RELAY_STATE_IDLE="RELAY_STATE_IDLE",t.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",t.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",t.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",t}({}),Rm=function(t){return t.RELAY_OK="RELAY_OK",t.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",t.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",t.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",t}({}),Ve=function(t){return t.High="high",t.Low="low",t.Audio="audio",t.Screen="screen",t.ScreenLow="screen_low",t}({}),fi=function(t){return t.DISCONNECT="disconnect",t.CONNECTION_STATE_CHANGE="connection-state-change",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGE="stream-type-change",t.IS_P2P_DISCONNECTED="is-p2p-dis",t.DISCONNECT_P2P="dis-p2p",t.REQUEST_NEW_GATEWAY_LIST="req-gate-url",t.NEED_RENEW_SESSION="need-sid",t.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",t.JOIN_RESPONSE="join-response",t.RESET_CONNECTION_EVENTS="reset-connection-events",t.PRE_CONNECT_PC="pre-connect_pc",t.UPDATE_GATEWAY_CONFIG="update-gateway-config",t}({}),NR=function(t){return t.P2P_DISCONNECTED="P2P_DISCONNECTED",t.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",t.TIMEOUT="TIMEOUT",t.UNKNOWN_REASON="UNKNOWN_REASON",t}({}),ui=function(t){return t[t.Nothing=0]="Nothing",t[t.Audio=1]="Audio",t[t.LwoVideo=2]="LwoVideo",t[t.Video=4]="Video",t[t.Data=8]="Data",t[t.DataStream0=256]="DataStream0",t[t.DataStream1=512]="DataStream1",t[t.DataStream2=1024]="DataStream2",t[t.DataStream3=2048]="DataStream3",t[t.DataStream4=4096]="DataStream4",t[t.DataStream5=8192]="DataStream5",t[t.DataStream6=16384]="DataStream6",t[t.DataStream7=32768]="DataStream7",t}({}),Pe=function(t){return t.CHINA="CHINA",t.ASIA="ASIA",t.NORTH_AMERICA="NORTH_AMERICA",t.EUROPE="EUROPE",t.JAPAN="JAPAN",t.INDIA="INDIA",t.KOREA="KOREA",t.HKMC="HKMC",t.US="US",t.OCEANIA="OCEANIA",t.SOUTH_AMERICA="SOUTH_AMERICA",t.AFRICA="AFRICA",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="EXTENSIONS",t}({});const eM=[Pe.AFRICA,Pe.ASIA,Pe.CHINA,Pe.EUROPE,Pe.GLOBAL,Pe.INDIA,Pe.JAPAN,Pe.NORTH_AMERICA,Pe.OCEANIA,Pe.OVERSEA,Pe.SOUTH_AMERICA];let qi=function(t){return t.CHINA="CN",t.ASIA="AS",t.NORTH_AMERICA="NA",t.EUROPE="EU",t.JAPAN="JP",t.INDIA="IN",t.KOREA="KR",t.HKMC="HK",t.US="US",t.OCEANIA="OC",t.SOUTH_AMERICA="SA",t.AFRICA="AF",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="GLOBAL",t}({});const DR={CHINA:{},ASIA:{CODE:qi.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:qi.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:qi.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:qi.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:qi.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:qi.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:qi.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:qi.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:qi.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:qi.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:qi.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:qi.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:qi.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};nw&&(DR.CHINA={CODE:qi.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let Fg=function(t){return t.UPDATE_BITRATE_LIMIT="update_bitrate_limit",t.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",t}({});function nM(t){return!!t&&!(!t.uplink||!t.id)&&t.uplink.max_bitrate!==void 0&&t.uplink.min_bitrate!==void 0}class iM extends Sn{constructor(e,n){super(),O(this,"onICEConnectionStateChange",void 0),O(this,"onConnectionStateChange",void 0),O(this,"onDTLSTransportStateChange",void 0),O(this,"onDTLSTransportError",void 0),O(this,"onICETransportStateChange",void 0),O(this,"onFirstAudioReceived",void 0),O(this,"onFirstVideoReceived",void 0),O(this,"onFirstAudioDecoded",void 0),O(this,"onFirstVideoDecoded",void 0),O(this,"onFirstVideoRender",void 0),O(this,"onFirstVideoDecodedTimeout",void 0),O(this,"onSelectedLocalCandidateChanged",void 0),O(this,"onSelectedRemoteCandidateChanged",void 0),O(this,"onICECandidateError",void 0),O(this,"getLocalVideoStats",void 0)}}class rM extends iM{constructor(e,n){super(e,n),O(this,"establishPromise",void 0)}}let Ct=function(t){return t.VIDEO="video",t.AUDIO="audio",t}({}),Ki=function(t){return t.UDP_RELAY="udp_relay",t.UDP_TCP_RELAY="udp_tcp_relay",t.TCP_RELAY="tcp_relay",t.RELAY="relay",t}({}),Al=function(t){return t[t.FIRST_CONNECTION=0]="FIRST_CONNECTION",t[t.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",t[t.RELAY_RESTART=2]="RELAY_RESTART",t[t.TCP_RESTART=3]="TCP_RESTART",t[t.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",t[t.OLD_RESTART=11]="OLD_RESTART",t[t.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",t}({});const aM=["disconnected","failed"];let ot=function(t){return t.LocalVideoTrack="videoTrack",t.LocalAudioTrack="audioTrack",t.LocalVideoLowTrack="videoLowTrack",t}({}),Me=function(t){return t.New="new",t.Connected="connected",t.Reconnecting="reconnecting",t.Disconnected="disconnected",t}({}),Mt=function(t){return t.AudioMetadata="audioMetadata",t.AudioPts="audioPts",t.StateChange="stateChange",t.IceConnectionStateChange="iceConnectionStateChange",t.RequestMuteLocal="requestMuteLocal",t.RequestUnmuteLocal="requestUnmuteLocal",t.RequestRePublish="requestRePublish",t.RequestRePublishDataChannel="requestRePublishDataChannel",t.RequestReSubscribe="requestReSubscribe",t.RequestUploadStats="requestUploadStats",t.RequestUpload="requestUpload",t.MediaReconnectStart="MediaReconnectStart",t.MediaReconnectEnd="MediaReconnectEnd",t.NeedSignalRTT="NeedSignalRTT",t.RequestRestartICE="RequestRestartIce",t.PeerConnectionStateChange="PeerConnectionStateChange",t.RequestReconnect="RequestReconnect",t.RequestReconnectPC="RequestReconnectPC",t.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",t.P2PLost="P2PLost",t.UpdateVideoEncoder="UpdateVideoEncoder",t.ConnectionTypeChange="ConnectionTypeChange",t.RequestLowStreamParameter="RequestLowStreamParameter",t.QueryClientConnectionState="QueryClientConnectionState",t.LocalCandidate="LocalCandidate",t.RequestP2PMuteLocal="requestP2PMuteLocal",t.RequestP2PUnPublish="RequestP2PUnPublish",t.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",t.RequestP2PMuteRemote="RequestP2PMuteRemote",t.RequestP2PRestartICE="RequestP2PRestartICE",t}({}),xs=function(t){return t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED",t}({}),Ms=function(t){return t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED",t}({}),mi=function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url",t}({}),sM=function(t){return t.CONNECTED="transmitter:connected",t.RECONNECTING="transmitter:reconnecting",t.WILL_RECONNECT="transmitter:will_reconnect",t.CLOSED="transmitter:closed",t.FAILED="transmitter:failed",t.ON_MESSAGE="transmitter:on_message",t.REQUEST_NEW_URLS="transmitter:request_new_urls",t.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",t.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",t.FAILBACK="transmitter:failback",t.PRE_CONNECT_PC="transmitter:pre_connect_pc",t}({}),Rc=function(t){return t.CAMERA_CHANGED="camera-changed",t.MICROPHONE_CHANGED="microphone-changed",t.PLAYBACK_DEVICE_CHANGED="playback-device-changed",t.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",t.AUTOPLAY_FAILED="autoplay-failed",t.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",t.SECURITY_POLICY_VIOLATION="security-policy-violation",t}({}),is=function(t){return t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED",t}({}),wo=function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url",t}({}),bm=function(t){return t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED",t}({}),jn=function(t){return t.CALL="call",t.CANDIDATE="candidate",t.PUBLISH="publish",t.UNPUBLISH="unpublish",t.CONTROL="control",t.RESTART_ICE="restart_ice",t.ACK="ack",t.RESPONSE="response",t.JOIN="join",t.CHECK="check",t}({}),Cm=function(t){return t.ABORT="abort",t}({}),qd=function(t){return t.MUTE_LOCAL_AUDIO="mute_local_audio",t.MUTE_LOCAL_VIDEO="mute_local_video",t.UNMUTE_LOCAL_AUDIO="unmute_local_audio",t.UNMUTE_LOCAL_VIDEO="unmute_local_video",t}({}),a8=function(t){return t.P2P_TOKEN_TIMEOUT="p2p_token_timeout",t.P2P_TOKEN_CHANGED="p2p_token_changed",t}({});const s8={[wR.ACCESS_POINT]:{[vr.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[vr.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[vr.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[vr.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[vr.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[vr.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[vr.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[vr.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[vr.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[vr.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[vr.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[vr.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[vr.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[vr.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[vr.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[vr.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[vr.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[vr.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[wR.UNILBS]:{[Ls.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[Ls.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[Ls.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[Ls.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[Ls.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[Ls.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[Ls.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[Ls.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[Ls.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[Ls.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[Ls.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[Ls.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[wR.STRING_UID_ALLOCATOR]:{[Mw.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[Mw.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[Mw.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function Am(t){const e=s8[Math.floor(t/1e4)];if(!e)return{desc:"unknown error",retry:!1};const n=e[t%1e4];if(!n){if(Math.floor(t/1e4)===wR.ACCESS_POINT){const i=t%1e4;if(i.toString()[0]==="1")return{desc:t.toString(),retry:!1};if(i.toString()[0]==="2")return{desc:t.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return n}const o8={[Vt.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Vt.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Vt.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Vt.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Vt.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Vt.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Vt.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Vt.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Vt.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Vt.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Vt.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Vt.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[Vt.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Vt.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Vt.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Vt.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Vt.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Vt.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Vt.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Vt.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Vt.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Vt.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Vt.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Vt.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Vt.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Vt.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Vt.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Vt.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Vt.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Vt.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Vt.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Vt.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Vt.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Vt.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Vt.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Vt.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Vt.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Vt.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Vt.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Vt.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Vt.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Vt.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Vt.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Vt.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Vt.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Vt.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Vt.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Vt.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Vt.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Vt.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Vt.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Vt.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Vt.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Vt.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Vt.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Vt.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Vt.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Vt.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Vt.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Vt.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Vt.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Vt.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Vt.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Vt.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function Gg(t){return o8[t]||{desc:"UNKNOWN_ERROR_".concat(t),action:"failed"}}function oM(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Bw(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?oM(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):oM(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function Fw(t,e){if(typeof t=="string")return t;const{proxy:n,host:i,port:r}=t;if(e){const s=k("JOIN_GATEWAY_FALLBACK_PORT")||443;return s===443?"wss://".concat(i,"/ws/?p=").concat(Number(r)+150):"wss://".concat(i,":").concat(s,"/ws/?p=").concat(Number(r)+150)}return n?"wss://".concat(n,"/ws/?h=").concat(i,"&p=").concat(r):"wss://".concat(i,":").concat(r)}const c8=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,l8=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,d8=/wss:\/\/(.+):([0-9]+)\/?/,u8=/wss:\/\/(.[^\/]+)\/?/;let h8=0;class p8{constructor(e,n){O(this,"id",0),O(this,"store",void 0),O(this,"recordIndex",void 0),O(this,"websockets",[]),O(this,"try443PortDuration",2e3),O(this,"forceCloseWSDuration",5e3),O(this,"try443PortTimeout",null),O(this,"forceCloseTimeout",null),O(this,"isTry443PortFailed",!1),O(this,"isNormalPortFailed",!1),O(this,"useDoubleDomain",!1),O(this,"useProxy",!1),O(this,"startTime",Date.now()),this.id=++h8,this.try443PortDuration=k("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=e||5e3,this.store=n}closeAllWebsockets(){this.websockets.forEach(e=>{e.onopen=null,e.onclose=null,e.onmessage=null,e.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var e;const n=Date.now()-this.startTime;for(var i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];T.debug("[choose-best-ws ".concat((e=this.store)===null||e===void 0?void 0:e.clientId," ").concat(this.id,"] ").concat(n,"ms:"),...r)}createWebSocket(e,n,i){this.logger("createWebSocket:",e,{isTry443Port:n,hasTimeoutDetection:i});const r=k("GATEWAY_DOMAINS"),s=Date.now(),c=[],l=r.find(_=>{var E;return mt(E=e.host).call(E,_)});l||(this.useDoubleDomain=!1);const d=[];if(this.useDoubleDomain)r.forEach(_=>{d.push(Fw(Bw(Bw({},e),{},{host:e.host.replace(l,_)}),n))});else{const _=Bw({},e);if(n&&l){const E=r.find(I=>I!==l);E&&(_.host=_.host.replace(l,E))}d.push(Fw(_,n))}try{d.forEach(_=>{const E=new WebSocket(_);E.binaryType="arraybuffer",c.push(E),this.logger("ws is connecting:",E.url)})}catch(_){if(this.logger("ws create failed"),c.forEach(E=>E.close()),c.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(e,n,i);if(!n&&Number(e.port)!==443)return this.createWebSocket(e,!0,i);throw new K(P.WS_ERR,"init websocket failed! Error: ".concat(_.toString()))}const h=Ag();this.store&&this.store.recordJoinChannelService({urls:c.map(_=>_.url),service:"gateway"},this.recordIndex),c.forEach(_=>{_.onopen=()=>{this.logger("onopen: ws ".concat(_.url," open cost ").concat(Date.now()-s,"ms")),this.websockets.forEach(E=>{E!==_&&(E.onopen=null,E.onclose=null,E.onmessage=null,E.close(),this.logger("close backup websocket: ".concat(E.url)))}),this.websockets.length=0,h.resolve(_)},_.onclose=E=>{this.logger("onclose: ws ".concat(_.url," closed cost ").concat(Date.now()-s,"ms state: ").concat(_.readyState));const I=c.every(C=>C.readyState===WebSocket.CLOSED||C.readyState===WebSocket.CLOSING);this.logger("".concat(n?"443":"47xx"," websocket closed, all failed: ").concat(I)),I&&(n||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(E.reason)),h.reject({code:E.code,reason:NR.A_ROUND_WS_FAILED})):!n&&I&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),m()),n?this.isTry443PortFailed=I:this.isNormalPortFailed=I},_.onmessage=E=>this.logger("".concat(_.url," onmessage: ").concat(E.data))}),this.websockets.push(...c);const p=()=>{this.websockets.forEach(_=>_.readyState!==WebSocket.OPEN&&_.close())},m=()=>{if(h.isResolved)return p();ve().os===di.MAC_OS&&An()&&p(),this.createWebSocket(e,!0,!0).then(_=>{h.resolve(_)}).catch(_=>{this.isNormalPortFailed&&h.reject(_),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",h.isResolved),this.forceCloseTimeout=null,p()},this.forceCloseWSDuration)};return i||(()=>{if(n||this.useProxy)return this.logger("add 5s timeout at ".concat(n?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,p()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",h.isResolved),this.try443PortTimeout=null,m()},this.try443PortDuration)})(),h.promise}chooseBestWebsocket(e,n,i,r){return this.useDoubleDomain=!!n,typeof e=="string"&&(e=function(s){let c,l,d;return[,c,l,d]=s.match(c8)||[],c||([,l,d]=s.match(l8)||[]),l&&d||([,l,d]=s.match(d8)||[]),l&&d||([,l]=s.match(u8)||[]),l||T.warning("un-destructible url: ",s),{proxy:c,host:l,port:d||"443"}}(e)),this.recordIndex=r,this.useProxy=!!e.proxy,i&&this.useProxy&&(T.warn("cannot use 443 only when use proxy"),i=!1),this.createWebSocket(e,!!i,!1).finally(()=>this.clearTimeout())}}function cM(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}class lM extends Sn{get url(){return this.websocket&&this.websocket.url||this._websocketUrl}get reconnectMode(){return this._reconnectMode}set reconnectMode(e){var n;mt(n=["tryNext","recover"]).call(n,e)&&this.resetReconnectCount(e),this._reconnectMode=e}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,this._state==="reconnecting"?this.emit(ee.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(ee.CONNECTED):this._state==="closed"?this.emit(ee.CLOSED):this._state==="failed"&&this.emit(ee.FAILED))}resetReconnectCount(e){T.debug("websocket reset reconnect count, reason: "+e),this.reconnectCount=0}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2],r=arguments.length>3&&arguments[3]!==void 0&&arguments[3],s=arguments.length>4&&arguments[4]!==void 0&&arguments[4],c=arguments.length>5?arguments[5]:void 0;super(),O(this,"_websocketUrl",null),O(this,"connectionID",0),O(this,"currentURLIndex",0),O(this,"urls",[]),O(this,"_reconnectMode","tryNext"),O(this,"reconnectReason",void 0),O(this,"_initMutex",void 0),O(this,"name",void 0),O(this,"_state","closed"),O(this,"reconnectInterrupter",void 0),O(this,"websocket",void 0),O(this,"retryConfig",void 0),O(this,"reconnectCount",0),O(this,"forceCloseTimeout",5e3),O(this,"onlineReconnectListener",void 0),O(this,"useCompress",void 0),O(this,"tryDoubleDomain",!1),O(this,"use443PortOnly",!1),O(this,"wsInflateLength",0),O(this,"wsDeflateLength",0),O(this,"closeEstablishingWs",()=>{}),O(this,"store",void 0),O(this,"joinGatewayRecordIndex",void 0),this.store=c,this.name=e,this.retryConfig=function(m){for(var _=1;_<arguments.length;_++){var E=arguments[_]!=null?arguments[_]:{};_%2?cM(Object(E),!0).forEach(function(I){O(m,I,E[I])}):Object.getOwnPropertyDescriptors?Object.defineProperties(m,Object.getOwnPropertyDescriptors(E)):cM(Object(E)).forEach(function(I){Object.defineProperty(m,I,Object.getOwnPropertyDescriptor(E,I))})}return m}({},n),this.useCompress=i,this.tryDoubleDomain=r,this.use443PortOnly=s,this._initMutex=new Wi("websocket",c?c.clientId:void 0);const{timeout:l,timeoutFactor:d}=n,h=Math.max(300,Math.floor(3*l/5)),p=Math.max(1.2,Math.floor(8*d)/10);la.ONLINE&&(this.retryConfig.timeout=h,this.retryConfig.timeoutFactor=p),Wn.on(am.NETWORK_STATE_CHANGE,(m,_)=>{m!==_&&(this.resetReconnectCount("network state change: ".concat(_," -> ").concat(m)),m===la.ONLINE?(this.retryConfig.timeout=h,this.retryConfig.timeoutFactor=p):(this.retryConfig.timeout=l,this.retryConfig.timeoutFactor=d))})}getConnection(){return this.websocket||void 0}async init(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const i=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=n,this.urls=e,this.state="connecting";try{var r;const s=Ag(),c=this.urls[this.currentURLIndex];(r=this.store)===null||r===void 0||r.beforeConnect(),function(l){return!(uR()||k("USE_NEW_TOKEN")||!k("ENABLE_PREALLOC_PC")&&(l==null||!l.autoSubscribe||k("FORCE_DISABLE_AUTO_SUB")))}(this.store)&&this.emit(sM.PRE_CONNECT_PC),this.createWebSocketConnection(c).then(s.resolve).catch(s.reject),this.once(ee.CLOSED,()=>{s.reject(new Z(P.WS_DISCONNECT))}),this.once(ee.CONNECTED,s.resolve),await s.promise}catch{}finally{i()}}close(e,n){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const i=this.websocket;n?setTimeout(()=>i.close(),500):i.close(),this.websocket=void 0,this._websocketUrl=null}this.state=e?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(e,n){if(!this.websocket)return void T.warning("[".concat(this.name,"] can not reconnect, no websocket"));e!==void 0&&(this.reconnectMode=e),T.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(n)]},this.joinGatewayRecordIndex);const i=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),i&&i.bind(this.websocket)({code:9999,reason:n})}sendMessage(e){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new Z(P.WS_ABORT,"websocket is not ready");try{n||(e=JSON.stringify(e)),this.websocket.send(e)}catch(i){throw new Z(P.WS_ERR,"send websocket message error"+i.toString())}}setWsInflateData(e){this.wsDeflateLength=this.wsDeflateLength+e.originLength,this.wsInflateLength=this.wsInflateLength+e.compressedLength}getWsInflateData(){const e=this.wsInflateLength,n=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:e,wsDeflateLength:n}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(e){var n;const i=Ag();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const r=p=>{var m;(m=this.store)===null||m===void 0||m.signalChannelOpen(),T.debug("[".concat(this.name,"] websocket opened:"),p),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),i.resolve()},s=async p=>{var m;if(T.debug("[".concat(this.name,"] websocket close ").concat((m=this.websocket)===null||m===void 0?void 0:m.url,", code: ").concat(p.code,", reason: ").concat(p.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)i.reject(new Z(P.WS_DISCONNECT,"websocket close: ".concat(p.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=p.reason,this.state="reconnecting");const _=Ca(this,ee.WILL_RECONNECT,this.reconnectMode,p.reason)||this.reconnectMode,E=await this.reconnectWithAction(_);if(this.state==="closed")return void T.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!E)return i.reject(new Z(P.WS_DISCONNECT,"websocket reconnect failed: ".concat(p.code))),this.close(!0);i.resolve()}},c=p=>{this.emit(ee.ON_MESSAGE,p)},l=p=>{T.warn("[".concat(this.connectionID,"] ws open error ").concat(p))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),k("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(e=k("GATEWAY_WSS_ADDRESS")),T.debug("[".concat(this.name,"] start connect, url:"),e);const d=(n=this.store)===null||n===void 0?void 0:n.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var h;this._websocketUrl=Fw(e);const p=await this.chooseBestWebsocketConnection(e);this.websocket=p,r&&r(this.websocket.url),this.websocket.onclose=s,this.websocket.onmessage=c,this.websocket.onerror=l,(h=this.store)===null||h===void 0||h.recordJoinChannelService({endTs:Date.now(),status:"success"},d),this.joinGatewayRecordIndex=d}catch(p){const m=this.state==="closed",_=p instanceof Z,E=_&&p.code===P.WS_ABORT,I=_&&p.code===P.WS_ERR,C=_?p.message:p&&(p.reason||p.toString());T.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(C)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:E?"aborted":"error",errors:[p]},d),m||I?(i.reject(m?new Z(P.WS_DISCONNECT,"websocket is closed: ".concat(C)):new Z(P.WS_ERR,"init websocket failed: ".concat(C))),I&&T.error("[".concat(this.name,"] init websocket failed: ").concat(C))):s&&s(p)}return i.promise}async reconnectWithAction(e){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;T.warning("[choose-best-ws] action: =>",e),this.onlineReconnectListener||Wn.isOnline||!Wn.onlineWaiter||(this.onlineReconnectListener=Wn.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let i=!0;if(this.reconnectInterrupter=()=>i=!1,n){const c=YA(this.reconnectCount,this.retryConfig);T.debug("[".concat(this.name,"] wait ").concat(c,"ms to reconnect websocket, mode: ").concat(e)),await Tt.race([yi(c),this.onlineReconnectListener||new Tt(()=>{})])}if(this._state==="closed"||!i)return!1;this.reconnectCount+=1;const r=async(c,l)=>{this.emit(ee.RECONNECT_CREATE_CONNECTION,l),await this.createWebSocketConnection(c)};try{if(e==="retry")await r(this.urls[this.currentURLIndex],e);else if(e==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);T.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await r(this.urls[this.currentURLIndex],e)}else e==="recover"&&(T.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await ki(this,ee.REQUEST_NEW_URLS),this.currentURLIndex=0,await r(this.urls[this.currentURLIndex],e))}catch(c){var s;T.error("[".concat(this.name,"] reconnect failed ").concat(c&&c.toString()));const l=c==null||(s=c.data)===null||s===void 0?void 0:s.desc;return Array.isArray(l)&&mt(l).call(l,"dynamic key expired")?(this.emit(ee.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(e,n)}return!0}}class Gw extends lM{constructor(e,n){super(e,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,n){const i=Ag(),r=function(c,l){return new p8(c,l)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{T.debug("[choose-best-ws] close establishing websockets"),r.closeAllWebsockets(),i.reject(new Z(P.WS_ABORT,"choose best websocket aborted"))};const s=k("GATEWAY_DOMAINS");return T.debug("[choose-best-ws] currentDomain: ",e,", domains: ",s,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),r.chooseBestWebsocket(e,this.tryDoubleDomain,this.use443PortOnly,n).then(i.resolve).catch(i.reject),i.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class Hg extends lM{constructor(e,n){super(e,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,n){return new Tt((i,r)=>{let s=!1;const c=[];this.closeEstablishingWs=()=>{T.debug("[choose-best-ws] close establishing websockets"),c.forEach(I=>{I.onclose=null,I.onopen=null,I.onmessage=null,I.close()}),r(new Z(P.WS_ABORT,"choose best websocket aborted"))};const l=k("GATEWAY_DOMAINS");let d;const h=e.indexOf("?h="),p=l.find(I=>h!==-1?mt(e).call(e,I,h):mt(e).call(e,I));T.debug("[choose-best-ws] currentDomain: ",p,", domains: ",l);let m=!this.tryDoubleDomain||!p;if(!m&&p){var _;const I=Date.now();try{l.forEach(C=>{const w=h===-1?e.replace(p,C):e.substr(0,h)+e.substr(h).replace(p,C),D=new WebSocket(w);D.binaryType="arraybuffer",c.push(D),T.debug("[choose-best-ws] ws is connecting:",D.url)})}catch{for(T.debug("[choose-best-ws] ws create failed, fallback to single url"),c.forEach(w=>w.close());c.length;)c.pop();m=!0}(_=this.store)===null||_===void 0||_.recordJoinChannelService({urls:c.map(C=>C.url),service:"gateway"},n),c.forEach(C=>{C.onopen=()=>{if(s)return;const w=Date.now()-I;T.debug("[choose-best-ws] ws open cost ".concat(w,"ms")),c.filter(D=>D!==C).forEach(D=>{T.debug("[choose-best-ws]close backup websocket: ".concat(D.url)),D.close()}),s=!0,i(C)},C.onclose=w=>{d=w,!s&&(c.find(D=>!(D.readyState===WebSocket.CLOSED||D.readyState===WebSocket.CLOSING))||(T.debug("[choose-best-ws] all websocket is closed"),s=!0,r(d)))},C.onmessage=w=>{T.debug("[choose-best-ws]".concat(C.url," onmessage: ").concat(w.data))}}),yi(this.forceCloseTimeout).then(()=>{c.forEach(C=>{C.readyState!==WebSocket.OPEN&&C.close()})})}if(m){var E;let I;T.debug("[choose-best-ws] use single url: ",e),(E=this.store)===null||E===void 0||E.recordJoinChannelService({urls:[e],service:"gateway"},n);try{I=new WebSocket(e),c.push(I),I.binaryType="arraybuffer"}catch(C){const w=new Z(P.WS_ERR,"init websocket failed! Error: ".concat(C.toString()));return T.error("[".concat(this.name,"]").concat(w)),void r(w)}I.onopen=()=>{i(I)},I.onclose=C=>{r(C)},I.onmessage=C=>{T.debug("[choose-best-ws]".concat(I.url," onmessage: ").concat(C.data))},yi(this.forceCloseTimeout).then(()=>{I&&I.readyState!==WebSocket.OPEN&&I.close()})}}).then(i=>(this.closeEstablishingWs=void 0,i)).catch(i=>{throw this.closeEstablishingWs=void 0,i})}}class f8 extends Sn{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===an.CONNECTED?this.emit(Yt.WS_CONNECTED):e===an.RECONNECTING?this.emit(Yt.WS_RECONNECTING,this._websocketReconnectReason):e===an.CLOSED&&this.emit(Yt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,n){super(),O(this,"_disconnectedReason",void 0),O(this,"_websocketReconnectReason",void 0),O(this,"_connectionState",an.CLOSED),O(this,"reconnectToken",void 0),O(this,"websocket",void 0),O(this,"openConnectionTime",void 0),O(this,"clientId",void 0),O(this,"lastMsgTime",Date.now()),O(this,"uploadCache",[]),O(this,"uploadCacheInterval",void 0),O(this,"rttRolling",new EL(5)),O(this,"pingpongTimer",void 0),O(this,"wsInflateDataTimer",void 0),O(this,"pingpongTimeoutCount",0),O(this,"ortc",void 0),O(this,"joinResponse",void 0),O(this,"multiIpOption",void 0),O(this,"initError",void 0),O(this,"spec",void 0),O(this,"store",void 0),O(this,"onWebsocketMessage",i=>{if(i.data instanceof ArrayBuffer)return void this.emit(Yt.ON_BINARY_DATA,i.data);const r=JSON.parse(i.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(r,"_id")){const s="res-@".concat(r._id);this.emit(s,r._result,r._message)}else if(Object.prototype.hasOwnProperty.call(r,"_type")){if(this.emit(r._type,r._message),r._type===pe.ON_NOTIFICATION&&this.handleNotification(r._message),r._type===pe.ON_USER_BANNED)switch(r._message.error_code){case 14:this.close(xe.UID_BANNED);break;case 15:this.close(xe.IP_BANNED);break;case 16:this.close(xe.CHANNEL_BANNED)}if(r._type===pe.ON_USER_LICENSE_BANNED)switch(r._message.error_code){case Vt.ERR_LICENSE_MISSING:this.close(xe.LICENSE_MISSING);break;case Vt.ERR_LICENSE_EXPIRED:this.close(xe.LICENSE_EXPIRED);break;case Vt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(xe.LICENSE_MINUTES_EXCEEDED);break;case Vt.ERR_LICENSE_PERIOD_INVALID:this.close(xe.LICENSE_PERIOD_INVALID);break;case Vt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(xe.LICENSE_MULTIPLE_SDK_SERVICE);break;case Vt.ERR_LICENSE_ILLEGAL:this.close(xe.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=e.clientId,this.spec=e,this.store=n,this.websocket=new Gw("gateway-".concat(this.clientId),this.spec.retryConfig,!0,k("JOIN_GATEWAY_USE_DUAL_DOMAIN"),k("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===an.CONNECTED&&this.reconnect("retry",Pi.OFFLINE)})}async request(e,n,i,r){const s=Je(6,""),c={_id:s,_type:e,_message:n},l=this.websocket.connectionID,d=()=>new Tt((I,C)=>{if(this.connectionState===an.CONNECTED)return I();const w=()=>{this.off(Yt.WS_CLOSED,D),I()},D=()=>{this.off(Yt.WS_CONNECTED,w),C(new K(P.WS_ABORT))};this.once(Yt.WS_CONNECTED,w),this.once(Yt.WS_CLOSED,D),e!==Wt.PUBLISH&&e!==Wt.PUBLISH_DATASTREAM&&e!==Wt.SUBSCRIBE&&e!==Wt.SUBSCRIBE_DATASTREAM&&e!==Wt.UNSUBSCRIBE&&e!==Wt.UNSUBSCRIBE_DATASTREAM&&e!==Wt.UNPUBLISH&&e!==Wt.UNPUBLISH_DATASTREAM&&e!==Wt.CONTROL&&e!==Wt.RESTART_ICE||this.once(Yt.DISCONNECT_P2P,()=>{C(new K(P.DISCONNECT_P2P))}),e!==Wt.PUBLISH&&e!==Wt.RESTART_ICE||this.once(Yt.ABORT_P2P_EXECUTION,()=>{C(new K(P.DISCONNECT_P2P))})});if(this.connectionState!==an.CONNECTING&&this.connectionState!==an.RECONNECTING||e===Wt.JOIN||e===Wt.REJOIN||await d(),this.websocket.sendMessage(c,!0),r)return;const h=new Tt((I,C)=>{let w=!1;const D=(L,W)=>{w=!0,I({isSuccess:L==="success",message:W||{}}),this.off(Yt.WS_CLOSED,N),this.off(Yt.WS_RECONNECTING,N),this.emit(Yt.REQUEST_SUCCESS,e,n)};this.once("res-@".concat(s),D);const N=()=>{C(new K(P.WS_ABORT,"type: ".concat(e))),this.off(Yt.WS_CLOSED,N),this.off(Yt.WS_RECONNECTING,N),this.off("res-@".concat(s),D)};this.once(Yt.WS_CLOSED,N),this.once(Yt.WS_RECONNECTING,N),yi(k("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==l||w||(T.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(Yt.REQUEST_TIMEOUT,e,n))})});let p=null;try{p=await h}catch(I){if(this.connectionState===an.CLOSED||e===Wt.LEAVE)throw new K(P.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?I.throw():e===Wt.JOIN||e===Wt.REJOIN?null:(await d(),await this.request(e,n))}if(p.isSuccess)return p.message;const m=Number(p.message.error_code||p.message.code),_=Gg(m),E=new K(P.UNEXPECTED_RESPONSE,"".concat(_.desc,": ").concat(p.message.error_str),{code:m,data:p.message,desc:_.desc});return _.action==="success"?p.message:(T.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(m,", message: ").concat(_.desc,", action: ").concat(_.action)),m===Vt.ERR_TOO_MANY_BROADCASTERS?((e===Wt.JOIN||e===Wt.REJOIN)&&(this.initError=E,this.close()),E.throw()):_.action==="failed"?E.throw():_.action==="quit"?(this.initError=E,this.close(),E.throw()):(m===Vt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=p.message.option,T.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Pi.MULTI_IP)):this.reconnect(_.action,Pi.SERVER_ERROR),e===Wt.JOIN||e===Wt.REJOIN?null:await this.request(e,n)))}waitMessage(e,n){return new Tt(i=>{const r=s=>{(!n||n(s))&&(this.off(e,r),i(s))};this.on(e,r)})}uploadWRTCStats(e){if(!this.store.sessionId)return void T.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(Bg.WRTC_STATS,n)}upload(e,n){const i={_type:e,_message:n};try{this.websocket.sendMessage(i)}catch{const s=k("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>s&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==an.CONNECTED)return;const c=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(c._type,c._message)},k("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,n){const i={_type:e,_message:n};this.websocket.sendMessage(i)}init(e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Tt((n,i)=>{this.once(Yt.WS_CONNECTED,()=>n(this.joinResponse)),this.once(Yt.WS_CLOSED,r=>i(this.initError||new K(P.WS_ABORT,r))),this.connectionState=an.CONNECTING,this.websocket.init(e).catch(i),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=e||xe.LEAVE,this.connectionState=an.CLOSED,T.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(Yt.ABORT_P2P_EXECUTION),this.store.signalConnected();const e=await ki(this,Yt.REQUEST_JOIN_INFO);this.store.joinReq();const n=await this.request(Wt.JOIN,e);if(this.ortc=e==null?void 0:e.ortc,this.store.joinRep(),!n)return this.emit(Yt.REPORT_JOIN_GATEWAY,NR.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(Yt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=an.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new K(P.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const e=Dg(this,Yt.REQUEST_REJOIN_INFO);e.token=this.reconnectToken;const n=await this.request(Wt.REJOIN,e);return!!n&&(this.connectionState=an.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),n.peers&&n.peers.forEach(i=>{this.emit(pe.ON_USER_ONLINE,{uid:i.uid}),i.audio&&this.emit(pe.ON_ADD_AUDIO_STREAM,{uid:i.uid,uint_id:i.uint_id,audio:!0,ssrcId:i.audio_ssrc}),i.video&&this.emit(pe.ON_ADD_VIDEO_STREAM,{uid:i.uid,uint_id:i.uint_id,video:!0,ssrcId:i.video_ssrc}),i.audio_mute?this.emit(pe.MUTE_AUDIO,{uid:i.uid}):this.emit(pe.UNMUTE_AUDIO,{uid:i.uid}),i.video_mute?this.emit(pe.MUTE_VIDEO,{uid:i.uid}):this.emit(pe.UNMUTE_VIDEO,{uid:i.uid}),i.audio_enable_local?this.emit(pe.ENABLE_LOCAL_AUDIO,{uid:i.uid}):this.emit(pe.DISABLE_LOCAL_AUDIO,{uid:i.uid}),i.video_enable_local?this.emit(pe.ENABLE_LOCAL_VIDEO,{uid:i.uid}):this.emit(pe.DISABLE_LOCAL_VIDEO,{uid:i.uid}),i.audio||i.video||this.emit(pe.ON_REMOVE_STREAM,{uid:i.uid,uint_id:i.uint_id})}),!0)}reconnect(e,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,n)}async downgradeCodec(e){if(!this.ortc)return!1;const n={downgrade_codec:e,ortc:this.ortc};return!!await this.request(Wt.DOWNGRADE_CODEC,n)}handleNotification(e){T.debug("[".concat(this.clientId,"] receive notification: "),e);const n=Gg(e.code);if(e.code===28&&"detail"in e&&(T.info("[".concat(this.clientId,"] receive recover notification: "),e.detail),this.emit(Yt.RECOVER_NOTIFICATION,e.detail)),n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(xe.UID_BANNED),void this.close()):void this.reconnect(n.action,Pi.SERVER_ERROR);T.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const e=k("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=e&&(T.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>k("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Pi.TIMEOUT):this.request(Wt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const i=Date.now()-n;this.rttRolling.add(i),k("REPORT_STATS")&&this.send(Wt.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleWsInflateData(){const{wsInflateLength:e,wsDeflateLength:n}=this.websocket.getWsInflateData();e!==0&&n!==0&&this.upload(Bg.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:e})}handleWebsocketEvents(){this.websocket.on(ee.RECONNECT_CREATE_CONNECTION,e=>{this.emit(Yt.WS_RECONNECT_CREATE_CONNECTION,e)}),this.websocket.on(ee.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(ee.CLOSED,()=>{this.connectionState=an.CLOSED}),this.websocket.on(ee.FAILED,()=>{this._disconnectedReason=xe.NETWORK_ERROR,this.connectionState=an.CLOSED}),this.websocket.on(ee.RECONNECTING,e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===an.CONNECTED?this.connectionState=an.RECONNECTING:this.connectionState=an.CONNECTING}),this.websocket.on(ee.WILL_RECONNECT,(e,n,i)=>{const r=Dg(this,Yt.IS_P2P_DISCONNECTED),s=r||e!=="retry";r&&e==="retry"&&(T.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),e="tryNext",n=NR.P2P_DISCONNECTED),s&&(T.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(e)),this.emit(Yt.REPORT_JOIN_GATEWAY,n||NR.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(Yt.DISCONNECT_P2P)),i(e)}),this.websocket.on(ee.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(e=>{T.warning("[".concat(this.clientId,"] rejoin failed ").concat(e)),this.reconnect("tryNext",Pi.SERVER_ERROR)}):this.join().catch(e=>{if(this.emit(Yt.REPORT_JOIN_GATEWAY,e,this.url||""),e instanceof K){if(e.code===P.UNEXPECTED_RESPONSE&&e.data.code===Vt.ERR_NO_AUTHORIZED)return this.initError=new K(P.TOKEN_EXPIRE,"dynamic key expired"),void this.close(xe.TOKEN_EXPIRE);T.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Pi.SERVER_ERROR):(this.initError=e,this.close())}})}),this.websocket.on(ee.REQUEST_NEW_URLS,(e,n)=>{ki(this,Yt.REQUEST_RECOVER,this.multiIpOption).then(e).catch(n)}),this.websocket.on(ee.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(pe.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(sM.PRE_CONNECT_PC,()=>{this.emit(Yt.PRE_CONNECT_PC)})}}let m8=function(t){return t.NATIVE_RTC="native_rtc",t.NATIVE_RTM="native_rtm",t.WEB_RTC="web_rtc",t.WEB_RTM="web_rtm",t}({}),zn=function(t){return t[t.CHOOSE_SERVER=11]="CHOOSE_SERVER",t[t.CLOUD_PROXY=18]="CLOUD_PROXY",t[t.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",t[t.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",t}({});function dM(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function PR(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?dM(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):dM(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function Kd(t){return t.match(/^[\.\:\d]+$/)?"".concat(t.replace(/[^\d]/g,"-"),".").concat(k("TURN_DOMAIN")):(T.debug("Cannot recognized as ip address: ".concat(t,", use as host2")),t)}function kR(t){try{const e=k("GATEWAY_DOMAINS").concat(k("TURN_DOMAIN")).find(n=>mt(t).call(t,n));return e?t.split(".".concat(e))[0].replace(/-/g,"."):t}catch{return T.debug("serverUrlToIp error, fallback to url",t),t}}function Hw(t,e){t.addresses||(t.addresses=[]);const n=function(l,d){if(k("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return l.map(m=>{let{ip:_,port:E}=m;return{address:"".concat(_,":").concat(E)}});const h=k("GATEWAY_DOMAINS");let p=h[1]&&mt(d).call(d,h[1])?1:0;return l.map(m=>{let{domain_prefix:_,port:E,ip:I}=m;if(_)return{address:"".concat(_,".").concat(h[p++%h.length],":").concat(E)};const C=/^[\.\:\d]+$/.test(I),w=C?"".concat(I.replace(/[^\d]/g,"-"),".").concat(h[p++%h.length],":").concat(E):"".concat(I,":").concat(E);return C||T.debug("Cannot recognized as ip address: ".concat(I,", use as host3")),{ip:I,port:E,address:w}})}(t.addresses,e),i=Array.isArray(t.detail)&&t.detail[18];if(i&&typeof i=="string"){const l=i.split(";");for(let d=0;d<l.length;d++){var r;const h=dr(r=l[d]).call(r);n[d]&&h&&(n[d].ip6=h)}}const s=t.detail&&t.detail.candidate;let c;if(s){const[l,d]=s.split(":");l&&d&&(c={port:Number(d),ip:l,address:"".concat(l,":").concat(d)})}return{gatewayAddrs:n,apGatewayAddress:c,uid:t.uid,cid:t.cid,cert:t.cert,vid:t.detail&&t.detail[8],uni_lbs_ip:t.detail&&t.detail[1],res:t,csIp:t.detail&&t.detail[502]}}function da(t){return typeof t=="number"?t:t.exact||t.ideal||t.max||t.min||0}function uM(t){const e=t._encoderConfig;if(!e)return{};const n={resolution:e.width&&e.height?"".concat(da(e.width),"x").concat(da(e.height)):void 0,maxVideoBW:e.bitrateMax,minVideoBW:e.bitrateMin};return typeof e.frameRate=="number"?(n.maxFrameRate=e.frameRate,n.minFrameRate=e.frameRate):e.frameRate&&(n.maxFrameRate=e.frameRate.max||e.frameRate.ideal||e.frameRate.exact||e.frameRate.min,n.minFrameRate=e.frameRate.min||e.frameRate.ideal||e.frameRate.exact||e.frameRate.max),n}function hM(t){return t>=0&&t<.17?1:t>=.17&&t<.36?2:t>=.36&&t<.59?3:t>=.59&&t<=1?4:t>1?5:0}function Wg(t,e){let n,i,r;switch(e){case zn.CHOOSE_SERVER:i=4096,r="choose server";break;case zn.CLOUD_PROXY:i=1048576,r="proxy";break;case zn.CLOUD_PROXY_5:i=4194304,r="proxy5";break;case zn.CLOUD_PROXY_FALLBACK:i=4194310,r="proxy fallback";break;default:throw new K(P.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:t.detail&&t.detail[502],retry:!1})}if(t.response_body.forEach(s=>{s.buffer&&s.buffer.flag===i&&(n={code:s.buffer.code,addresses:(s.buffer.edges_services||[]).map(c=>PR(PR({},c),{},{ticket:s.buffer.cert})),server_ts:t.enter_ts,uid:s.buffer.uid,cid:s.buffer.cid,cname:s.buffer.cname,detail:PR(PR({},s.buffer.detail),t.detail),flag:s.buffer.flag,opid:t.opid,cert:s.buffer.cert})}),!n)throw new K(P.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(r," from multi unilbs response"),{csIp:t.detail&&t.detail[502]});return n}async function pM(t,e){return await Tt.all(t.addresses.map(async n=>({address:Kd(n.ip),tcpport:n.port,udpport:n.port,username:e&&k("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?e.toString():Li.username,password:e&&k("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await WA(e.toString()):Li.password})))}function Ww(t,e){const n=e.getMediaStreamTrack(!0).getSettings(),i=e.videoHeight||n.height,r=e.videoWidth||n.width;return i&&r?Math.max(Math.min(i,r)/Math.min(da(t.height),da(t.width)),1):(T.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function Yd(t){let{candidateType:e,relayProtocol:n,type:i,address:r,port:s,protocol:c}=t;const l={candidateType:e,relayProtocol:n,protocol:c};if(i!=="local-candidate"){const d=r.split(".");d.length>=4&&(d[1]="*",d[2]="*"),l.address=d.join("."),l.port=s}return l}function Hh(t){const e=t.split(":"),n=t.split(/[-.]/),i=mt(t).call(t,"-")?"-":".";let r=t;return e.length>1?n.length>1?(n[1]="**",r=n[0]+i+"**:"+e[e.length-1]):r=e.length>2?e[0]+i+"**:"+e[e.length-1]:"**:"+e[e.length-1]:n.length>1&&(r=n[0]+i+"**"),r}function LR(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:k("SVC_MODE");if(k("ENABLE_SVC"))return function(e){return e in cR}(t)?t:cR.L1T3}const fM={[Ct.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[Ct.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function xR(t,e,n){e.forEach(i=>{var r;const s=fM[t].find(l=>{var d;let{key:h}=l;return mt(d=i.extensionName).call(d,h)});if(!s)return;const c=n.find(l=>{let{extensionName:d}=l;return mt(d).call(d,s.key)});c&&mt(r=c.extensionName).call(r,"gdpr_forbidden")&&(i.extensionName=c.extensionName)})}function wm(t,e){e.forEach(n=>{var i;const r=fM[t].find(s=>{var c;let{key:l}=s;return mt(c=n.extensionName).call(c,l)});mt(i=n.extensionName).call(i,"gdpr_forbidden")&&r&&(n.extensionName=r.extensionName)})}function mM(t){return t==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||mt(t).call(t,"abs-send-time")}function MR(t){return t==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||mt(t).call(t,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function _M(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function EM(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?_M(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):_M(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function zg(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0;const{filterRTX:r,filterVideoFec:s,filterAudioFec:c,filterAudioCodec:l,filterVideoCodec:d,unsupportedVideoUplinkCodec:h,unsupportedVideoDownlinkCodec:p}=e,{useXR:m}=n;let _=[],E=[],I=[],C=[],w=!1,D=!1;if(Wr(t).mediaDescriptions.forEach(L=>{i&&i!==L.attributes.direction||(L.media.mediaType!=="video"||w||(E=L.attributes.payloads,C=L.attributes.extmaps,w=!0),L.media.mediaType!=="audio"||D||(_=L.attributes.payloads,I=L.attributes.extmaps,D=!0))}),!C||E.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!I||_.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(E.forEach(L=>{var W;(W=L.rtpMap)!==null&&W!==void 0&&W.clockRate&&(L.rtpMap.clockRate=parseInt(L.rtpMap.clockRate)),m&&L.rtcpFeedbacks.push({type:"rrtr"})}),_.forEach(L=>{var W;(W=L.rtpMap)!==null&&W!==void 0&&W.clockRate&&(L.rtpMap.clockRate=parseInt(L.rtpMap.clockRate)),m&&L.rtcpFeedbacks.push({type:"rrtr"})}),r&&(_=_.filter(L=>{var W;return((W=L.rtpMap)===null||W===void 0?void 0:W.encodingName.toLowerCase())!=="rtx"}),E=E.filter(L=>{var W;return((W=L.rtpMap)===null||W===void 0?void 0:W.encodingName.toLowerCase())!=="rtx"})),s){const L=E.filter(U=>{var z;return/(red)|(ulpfec)|(flexfec)/i.test(((z=U.rtpMap)===null||z===void 0?void 0:z.encodingName)||"")}),W=Qd(L,E).map(U=>U.payloadType),G=[...L.map(U=>U.payloadType),...W];E=E.filter(U=>!mt(G).call(G,U.payloadType))}if(c&&(_=_.filter(L=>{var W;return!/(red)|(ulpfec)|(flexfec)/i.test(((W=L.rtpMap)===null||W===void 0?void 0:W.encodingName)||"")})),l&&(l==null?void 0:l.length)>0&&(_=_.filter(L=>{var W;return mt(l).call(l,((W=L.rtpMap)===null||W===void 0?void 0:W.encodingName.toLowerCase())||"")})),d&&(d==null?void 0:d.length)>0){const L=E.filter(W=>{var G;return mt(d).call(d,((G=W.rtpMap)===null||G===void 0?void 0:G.encodingName.toLowerCase())||"")});E=L.concat(r?[]:Qd(L,E))}const N=k("UNSUPPORTED_VIDEO_CODEC");if(N&&N.length>0){const L=E.filter(U=>U.rtpMap&&mt(N).call(N,U.rtpMap.encodingName.toLowerCase())),W=Qd(L,E),G=L.concat(W).map(U=>U.payloadType);E=E.filter(U=>!mt(G).call(G,U.payloadType)),T.debug("unsupportedVideoCodec: ".concat(N,", toBeRemoved: ").concat(G))}if(h&&h.length>0&&i==="sendonly"){const L=E.filter(U=>U.rtpMap&&mt(h).call(h,U.rtpMap.encodingName.toLowerCase())),W=Qd(L,E),G=L.concat(W).map(U=>U.payloadType);E=E.filter(U=>!mt(G).call(G,U.payloadType)),T.debug("unsupportedVideoUplinkCodec: ".concat(h,", toBeRemoved: ").concat(G))}if(p&&p.length>0&&i==="recvonly"){const L=E.filter(U=>U.rtpMap&&mt(p).call(p,U.rtpMap.encodingName.toLowerCase())),W=Qd(L,E),G=L.concat(W).map(U=>U.payloadType);E=E.filter(U=>!mt(G).call(G,U.payloadType)),T.debug("unsupportedVideoDownlinkCodec: ".concat(p,", toBeRemoved: ").concat(G))}return{audioCodecs:_,videoCodecs:E,audioExtensions:I,videoExtensions:C}}function Xd(t){const e=Wr(t);let n,i;for(const r of e.mediaDescriptions){if(!n){const s=r.attributes.iceUfrag,c=r.attributes.icePwd;if(!s||!c)throw new Error("Cannot get iceUfrag or icePwd from SDP.");n={iceUfrag:s,icePwd:c}}if(!i){const s=r.attributes.fingerprints;s.length>0&&(i={fingerprints:s})}}if(!i&&e.attributes.fingerprints.length>0&&(i={fingerprints:e.attributes.fingerprints}),!i||!n)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:n,dtlsParameters:i}}function gM(t,e){const n=[],i=t.attributes.ssrcGroups.filter(c=>c.semantic==="FID"),r=t.attributes.ssrcGroups.find(c=>c.semantic==="SIM"),s=t.attributes.ssrcs;if(r)r.ssrcIds.forEach(c=>{var l;const d=(l=i.find(h=>h.ssrcIds[0]===c))===null||l===void 0?void 0:l.ssrcIds[1];n.push({ssrcId:c,rtx:e?d:void 0})});else if(i.length>0){const c=i[0].ssrcIds[0],l=i[0].ssrcIds[1];n.push({ssrcId:c,rtx:e?l:void 0})}else{if(s.length===0)throw new Error("No ssrcs found on local media description.");n.push({ssrcId:s[0].ssrcId})}return n}function vM(t,e,n){const{cname:i}=t;let r=[];e&&(r=SM(e)),r.length===0&&(r=t.iceParameters.candidates.map(p=>({foundation:p.foundation,componentId:"1",transport:p.protocol,priority:p.priority.toString(),connectionAddress:p.ip,port:p.port.toString(),type:p.type,extension:{}})),T.debug("Using candidates from gateway."));const s={fingerprints:t.dtlsParameters.fingerprints.map(p=>({hashFunction:p.algorithm,fingerprint:p.fingerprint}))},c={iceUfrag:t.iceParameters.iceUfrag,icePwd:t.iceParameters.icePwd};let l;switch(t.dtlsParameters.role){case"server":l="passive";break;case"client":l="active";break;case"auto":l="actpass"}const d=VR(t.rtpCapabilities),h=[];return Array.isArray(n)&&n.length>0&&n.forEach(p=>{h.push({kind:Ct.VIDEO,ssrcMsg:[{ssrcId:p.v,rtx:p.v_rtx}],mslabel:"".concat(p.v,"_").concat(p.a)},{kind:Ct.AUDIO,ssrcMsg:[{ssrcId:p.a}],mslabel:"".concat(p.v,"_").concat(p.a)})}),{dtlsParameters:s,iceParameters:c,candidates:r,rtpCapabilities:d,setup:l,cname:i,preSSRCs:h}}function SM(t){let e=[];return t.ip&&typeof t.port=="number"&&(e=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip,port:t.port.toString(),type:"host",extension:{}}],T.debug("Using remote candidate from AP ".concat(Hh(t.ip),":").concat(t.port)),t.ip6&&(e.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip6,port:t.port.toString(),type:"host",extension:{}}),T.debug("Using IPV6 remote candidate from AP ".concat(Hh(t.ip6),":").concat(t.port)))),e}function qg(t,e,n){const i=[],r=[];return t.forEach(s=>{let{ssrcId:c,rtx:l}=s;const d=Je(8,"track-"),h={ssrcId:c,attributes:EM({label:d,mslabel:n=n||Je(10,""),msid:"".concat(n," ").concat(d)},e&&{cname:e})};if(i.push(h),l!==void 0){const p={ssrcId:l,attributes:EM({label:d,mslabel:n,msid:"".concat(n," ").concat(d)},e&&{cname:e})};i.push(p),r.push({semantic:"FID",ssrcIds:[c,l]})}}),t.length>1&&r.push({semantic:"SIM",ssrcIds:t.map(s=>{let{ssrcId:c}=s;return c})}),{ssrcs:i,ssrcGroups:r}}function Im(t,e){e instanceof Nn&&t.attributes.payloads.forEach(n=>{var i;const r=(i=n.rtpMap)===null||i===void 0?void 0:i.encodingName.toLowerCase();if(!r||["opus","pcmu","pcma","g722"].indexOf(r)===-1)return;n.fmtp||(n.fmtp={parameters:{}}),r==="opus"&&typeof k("OPUS_PTIME")=="number"?n.fmtp.parameters.ptime=k("OPUS_PTIME"):n.fmtp.parameters.minptime="10",n.fmtp.parameters.useinbandfec="1";const s=e._encoderConfig;s&&(r!=="pcmu"&&r!=="pcma"&&r!=="g722"&&(s.bitrate&&!An()&&(n.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*s.bitrate))),s.sampleRate&&(n.fmtp.parameters.maxplaybackrate="".concat(s.sampleRate),n.fmtp.parameters["sprop-maxcapturerate"]="".concat(s.sampleRate)),s.stereo&&(n.fmtp.parameters.stereo="1",n.fmtp.parameters["sprop-stereo"]="1")),e instanceof Vg&&r==="opus"&&e._config.DTX&&(n.fmtp.parameters.usedtx="1"))})}function zw(t){const e=t.attributes.unrecognized.findIndex(n=>n.attField==="x-google-flag"&&n.attValue==="conference");e!==-1&&t.attributes.unrecognized.splice(e,1)}function qw(t,e){var n;if(!(e instanceof sn&&e._encoderConfig&&e._hints.indexOf(Ye.SCREEN_TRACK)===-1))return;const i=e._encoderConfig;be().supportMinBitrate&&i.bitrateMin&&t.attributes.payloads.forEach(r=>{var s,c;mt(s=["h264","h265","vp8","vp9","av1"]).call(s,((c=r.rtpMap)===null||c===void 0?void 0:c.encodingName.toLowerCase())||"")&&(r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters["x-google-min-bitrate"]="".concat(i.bitrateMin))}),be().supportMinBitrate&&!mt(n=e._hints).call(n,Ye.LOW_STREAM)&&i.bitrateMax&&t.attributes.payloads.forEach(r=>{var s,c;mt(s=["h264","h265","vp8","vp9","av1"]).call(s,((c=r.rtpMap)===null||c===void 0?void 0:c.encodingName.toLowerCase())||"")&&(r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters["x-google-start-bitrate"]="".concat(k("X_GOOGLE_START_BITRATE")||Math.floor(i.bitrateMax)))})}function TM(t){if(t.media.mediaType!=="video")return;const e=ve();if(e.name!==Ie.SAFARI&&e.os!==di.IOS)return;const n=t.attributes.extmaps.findIndex(i=>/video-orientation/g.test(i.extensionName));n!==-1&&t.attributes.extmaps.splice(n,1)}function UR(t,e,n){if(!e)return;let i,r;if(t.media.mediaType==="video"?(i=n.videoExtensions,r=n.videoCodecs):(i=n.audioExtensions,r=n.audioCodecs),e.twcc===!0){const s=i.find(c=>MR(c.extensionName));if(s){const c=s.extensionName;t.attributes.extmaps.find(d=>MR(d.extensionName))||t.attributes.extmaps.push({entry:s.entry,extensionName:c}),function(d,h){return h.filter(p=>!!d.find(m=>m.payloadType===p.payloadType&&!!m.rtcpFeedbacks.find(_=>_.type==="transport-cc")))}(r,t.attributes.payloads).forEach(d=>{d.rtcpFeedbacks.find(h=>h.type==="transport-cc")||d.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(e.twcc===!1){const s=t.attributes.extmaps.findIndex(c=>MR(c.extensionName));s!==-1&&t.attributes.extmaps.splice(s,1),t.attributes.payloads.forEach(c=>{const l=c.rtcpFeedbacks.findIndex(d=>d.type==="transport-cc");l!==-1&&c.rtcpFeedbacks.splice(l,1)})}if(e.remb===!0){const s=i.find(c=>mM(c.extensionName));if(s){const c=s.extensionName;t.attributes.extmaps.find(d=>d.extensionName===c)||t.attributes.extmaps.push({entry:s.entry,extensionName:c}),function(d,h){return h.filter(p=>!!d.find(m=>m.payloadType===p.payloadType&&!!m.rtcpFeedbacks.find(_=>_.type==="goog-remb")))}(r,t.attributes.payloads).forEach(d=>{d.rtcpFeedbacks.find(h=>h.type==="goog-remb")||d.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(e.remb===!1){const s=t.attributes.extmaps.findIndex(c=>mM(c.extensionName));s!==-1&&t.attributes.extmaps.splice(s,1),t.attributes.payloads.forEach(c=>{const l=c.rtcpFeedbacks.findIndex(d=>d.type==="goog-remb");l!==-1&&c.rtcpFeedbacks.splice(l,1)})}}function yM(t,e,n){if(An()||t.media.mediaType!=="video"||!(e instanceof sn)||n!=="vp9"&&n!=="vp8"||n==="vp8"&&!k("SIMULCAST")||n==="vp9"&&k("ENABLE_SVC")||e._scalabilityMode===void 0||e._scalabilityMode.numSpatialLayers<=1)return;const i=n==="vp8"?2:e._scalabilityMode.numSpatialLayers,r=t.attributes.ssrcs[0],s=t.attributes.ssrcGroups.find(l=>l.semantic==="FID"&&l.ssrcIds[0]===r.ssrcId),c={semantic:"SIM",ssrcIds:[r.ssrcId]};for(let l=1;l<i;l++)t.attributes.ssrcs.push({ssrcId:r.ssrcId+l,attributes:En(r.attributes)}),c.ssrcIds.push(r.ssrcId+l),s&&(t.attributes.ssrcs.push({ssrcId:s.ssrcIds[1]+l,attributes:En(r.attributes)}),t.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[r.ssrcId+l,s.ssrcIds[1]+l]}));t.attributes.ssrcGroups.unshift(c)}async function RM(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=new RTCPeerConnection;n.addTransceiver("video",{direction:"sendonly"}),n.addTransceiver("audio",{direction:"sendonly"}),n.addTransceiver("video",{direction:"recvonly"}),n.addTransceiver("audio",{direction:"recvonly"});const i=(await n.createOffer()).sdp,{send:r,recv:s,sendrecv:c}=function(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},h=arguments.length>2?arguments[2]:void 0;const p=zg(h,l,d,"sendonly"),m=zg(h,l,d,"recvonly"),_={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},E={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},I={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Us(p,m,"videoExtensions",_,E,I),Us(p,m,"videoCodecs",_,E,I),Us(p,m,"audioExtensions",_,E,I),Us(p,m,"audioCodecs",_,E,I),k("RAISE_H264_BASELINE_PRIORITY")){const C=[],w=[];if(I.videoCodecs.forEach((D,N)=>{var L;if(((L=D.rtpMap)===null||L===void 0?void 0:L.encodingName.toLocaleLowerCase())==="h264"){var W,G;const U=I.videoCodecs[N+1],z=U&&IM(D,U),$=(W=D.fmtp)===null||W===void 0?void 0:W.parameters["profile-level-id"],rt=(G=D.fmtp)===null||G===void 0?void 0:G.parameters["packetization-mode"];!$||$!==k("FIRST_H264_PROFILE_LEVEL_ID")||k("FIRST_PACKETIZATION_MODE")&&rt!==k("FIRST_PACKETIZATION_MODE")?z?w.push([D,U]):w.push([D]):z?C.push([D,U]):C.push([D])}}),C.length>0&&w.length>0){T.debug("raising H264 baseline profile priority"),I.videoCodecs.forEach((N,L)=>{var W;if(((W=N.rtpMap)===null||W===void 0?void 0:W.encodingName.toLocaleLowerCase())==="h264"){const G=IM(N,I.videoCodecs[L+1]),U=C.shift()||w.shift()||[];U.length>0&&(G?I.videoCodecs.splice(L,2,...U):I.videoCodecs.splice(L,1,...U))}});const D=E.videoCodecs.filter(N=>{var L,W;return((L=N.rtpMap)===null||L===void 0?void 0:L.encodingName.toLocaleLowerCase())==="h264"&&((W=N.fmtp)===null||W===void 0?void 0:W.parameters["profile-level-id"])!==k("FIRST_H264_PROFILE_LEVEL_ID")});if(D.length>0){const N=Qd(D,E.videoCodecs).map(W=>W.payloadType),L=[...D.map(W=>W.payloadType),...N];E.videoCodecs=E.videoCodecs.filter(W=>!mt(L).call(L,W.payloadType))}k("FILTER_SEND_H264_BASELINE")&&(_.videoCodecs=_.videoCodecs.filter(N=>{var L,W;return!(((L=N.rtpMap)===null||L===void 0?void 0:L.encodingName.toLocaleLowerCase())==="h264"&&((W=N.fmtp)===null||W===void 0?void 0:W.parameters["profile-level-id"])!==k("FIRST_H264_PROFILE_LEVEL_ID"))}))}return{send:_,recv:E,sendrecv:I}}return{send:_,recv:E,sendrecv:I}}(t,e,i);try{n.close()}catch{}return{send:r,recv:s,sendrecv:c}}function bM(){const t={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},e=zg(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Us(t,e,"videoExtensions",n,i,r),Us(t,e,"videoCodecs",n,i,r),Us(t,e,"audioExtensions",n,i,r),Us(t,e,"audioCodecs",n,i,r),k("RAISE_H264_BASELINE_PRIORITY")){const s=r.videoCodecs.findIndex(c=>c.rtpMap&&c.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&c.fmtp&&c.fmtp.parameters["profile-level-id"]==="42001f");if(s!==-1){const c=r.videoCodecs.findIndex(l=>l.rtpMap&&l.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(c<s){T.debug("raising H264 baseline profile priority");const l=r.videoCodecs[s];r.videoCodecs.splice(s,1),r.videoCodecs.splice(c,0,l)}c!==-1&&(i.videoCodecs=i.videoCodecs.filter(l=>!(l.rtpMap&&l.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&l.fmtp&&l.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:n,recv:i,sendrecv:r}}function Us(t,e,n,i,r,s){if(n==="videoExtensions"||n==="audioExtensions"){const c=[];return t[n].forEach(l=>{e[n].some((d,h)=>{if(l.entry===d.entry&&l.extensionName===d.extensionName)return c.push(h),!0})?s[n].push(l):i[n].push(l)}),void e[n].forEach((l,d)=>{c.indexOf(d)===-1&&r[n].push(l)})}if(n==="videoCodecs"||n==="audioCodecs"){const c=[];return t[n].forEach(l=>{e[n].some((d,h)=>{if(l.payloadType===d.payloadType&&JSON.stringify(l)===JSON.stringify(d))return c.push(h),!0})?s[n].push(l):i[n].push(l)}),void e[n].forEach((l,d)=>{c.indexOf(d)===-1&&r[n].push(l)})}}function VR(t){const{send:e,recv:n,sendrecv:i}=t;if(!i){if(!e||!n)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:e,recv:n}}let r,s;return e?(r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r.audioCodecs=[...e.audioCodecs,...i.audioCodecs],r.videoCodecs=[...e.videoCodecs,...i.videoCodecs],r.audioExtensions=[...e.audioExtensions,...i.audioExtensions],r.videoExtensions=[...e.videoExtensions,...i.videoExtensions]):r=i,n?(s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},s.audioCodecs=[...n.audioCodecs,...i.audioCodecs],s.videoCodecs=[...n.videoCodecs,...i.videoCodecs],s.audioExtensions=[...n.audioExtensions,...i.audioExtensions],s.videoExtensions=[...n.videoExtensions,...i.videoExtensions]):s=i,{send:r,recv:s}}function Om(t){t.media.mediaType==="audio"&&t.attributes.payloads.filter(e=>{var n;return((n=e.rtpMap)===null||n===void 0?void 0:n.encodingName.toLowerCase())==="opus"}).forEach(e=>{e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters.stereo="1",e.fmtp.parameters["sprop-stereo"]="1"})}function Kg(t,e,n,i){let r=[];if(t===Ct.VIDEO){if(k("H264_PROFILE_LEVEL_ID")&&i==="h264"&&(r=e.videoCodecs.filter(s=>{var c;return mt(c=s.rtpMap&&s.rtpMap.encodingName.toLowerCase()||"").call(c,i)&&s&&s.fmtp&&s.fmtp.parameters["profile-level-id"]===k("H264_PROFILE_LEVEL_ID")})),!Array.isArray(r)||r.length===0){let s=[];const c=[],l=[],d=[];if(n.videoCodecs.forEach(h=>{const p=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"";mt(p).call(p,i)?s.push(h):mt(p).call(p,"vp9")?c.push(h):mt(p).call(p,"vp8")?l.push(h):mt(p).call(p,"h264")&&d.push(h)}),s.length===0){let h="";c.length!==0?(s=c,h="vp9"):l.length!==0?(s=l,h="vp8"):d.length!==0&&(s=d,h="h264"),T.warning("codec ".concat(i," not included in rtpCapabilities, fallback to default payloads: ").concat(h))}s.length!==0&&(r=e.videoCodecs.filter(h=>s.some(p=>p.payloadType===h.payloadType)))}if(r.length===0&&(T.warning("codec ".concat(i," not included in rtpCapabilities, fallback to default payloads: ").concat(e.videoCodecs[0].rtpMap&&e.videoCodecs[0].rtpMap.encodingName)),r=e.videoCodecs),k("USE_PUB_RTX")||k("USE_SUB_RTX")){const s=Qd(r,e.videoCodecs);r=[...r,...s]}}else{r=e.audioCodecs.filter(c=>{var l;return mt(l=c.rtpMap&&c.rtpMap.encodingName.toLowerCase()||"").call(l,i)});const s=e.audioCodecs.filter(c=>{var l;return mt(l=c.rtpMap&&c.rtpMap.encodingName.toLowerCase()||"").call(l,"red")});r.length===0&&(T.warning("codec ".concat(i," not included in rtpCapabilities, fallback to opus")),r=e.audioCodecs.filter(c=>{var l;return mt(l=c.rtpMap&&c.rtpMap.encodingName.toLowerCase()||"").call(l,"opus")})),k("ENABLE_AUDIO_RED")&&s.length!==0&&(r=[...s,...r])}return r}function Qd(t,e){const n=t.map(i=>i.payloadType.toString());return e.filter(i=>i.rtpMap&&i.rtpMap.encodingName==="rtx"&&i.fmtp&&i.fmtp.parameters.apt&&mt(n).call(n,i.fmtp&&i.fmtp.parameters.apt))}async function Jd(t,e,n){const i=e.toString(),r=AM(i,"offer","remote","exchangeSDP");await t.setRemoteDescription({type:"offer",sdp:i});const s=await t.createAnswer();if(!s.sdp)throw new Error("cannot get answer sdp");let c=s.sdp;c=CM(c,n||{}),r==null||r(c||""),await t.setLocalDescription({type:"answer",sdp:c})}function CM(t,e,n){const i=Wr(t),{useXR:r}=e;return i.mediaDescriptions.forEach(s=>{var c;s.attributes.mid&&(Array.isArray(n)&&!mt(n).call(n,s.attributes.mid)||(s.media.mediaType==="audio"&&Om(s),r&&mt(c=["audio","video"]).call(c,s.media.mediaType)&&s.attributes.payloads.forEach(l=>{l.rtcpFeedbacks.findIndex(d=>d.type==="rrtr")===-1&&l.rtcpFeedbacks.push({type:"rrtr"})})))}),Hd(i)}function AM(t,e,n,i){if(k("SDP_LOGGING"))return T.upload("exchanging ".concat(n," ").concat(e," SDP during P2PConnection.").concat(i,`
`),t),e==="offer"?r=>{AM(r,"answer",n==="local"?"remote":"local",i)}:void 0}function wM(t){const e=k("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(e)&&e.length>0)&&e.some(n=>mt(t).call(t,n))}function IM(t,e){try{var n;return((n=t.fmtp)===null||n===void 0?void 0:n.parameters.apt)===e.payloadType.toString()}catch{return!1}}function OM(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function La(t,e){return typeof k(t)===e?k(t):void 0}function _8(){try{const t=k("EXPERIMENTS")||{};return typeof t=="string"||Array.isArray(t)?{}:function(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?OM(Object(i),!0).forEach(function(r){O(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):OM(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}({},t)}catch(t){return T.debug("handle gateway attributes failed: ",t),{}}}const NM={};function Zd(t){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&T.debug("install service ".concat(t.name)),NM[t.name]=t}function wl(t){const e=NM[t];if(!e)throw new Z(P.INVALID_OPERATION,"".concat(t," not found, please use AgoraRTC.use(").concat(t,"Service) to load it first"));return e}function DM(t,e){return wl("DataStream").create(t,e)}function jR(){return wl("InterceptFrame").create()}function PM(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function ar(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?PM(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):PM(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const Kw=new Map;class E8 extends Sn{get state(){return this._state}set state(e){if(e===this._state)return;const n=this._state;this._state=e,e==="DISCONNECTED"&&this._disconnectedReason?this.emit(fi.CONNECTION_STATE_CHANGE,e,n,this._disconnectedReason):this.emit(fi.CONNECTION_STATE_CHANGE,e,n)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(e){T.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(e)),this._joinGatewayStartTime=e}constructor(e,n){var i,r,s;super(),O(this,"store",void 0),O(this,"joinInfo",void 0),O(this,"key",void 0),O(this,"ntpOffset",0),O(this,"signal",void 0),O(this,"role",void 0),O(this,"isPreallocation",void 0),O(this,"isPreSub",void 0),O(this,"inChannelInfo",{joinAt:null,duration:0}),O(this,"spec",void 0),O(this,"_state","DISCONNECTED"),O(this,"_statsCollector",void 0),O(this,"_disconnectedReason",void 0),O(this,"isSignalRecover",!1),O(this,"hasChangeBGPAddress",!1),O(this,"trafficStatsInterval",void 0),O(this,"networkQualityInterval",void 0),O(this,"_joinGatewayStartTime",0),O(this,"_signalTimeout",!1),O(this,"_clientRoleOptions",void 0),O(this,"_isProactiveJoin",!1),this.store=e,this.spec=n,this.signal=this.store.useP2P?(i={spec:ar(ar({},n),{},{retryConfig:n.websocketRetryConfig}),store:e},(r=(s=wl("P2PChannel")).createSubmodule)===null||r===void 0?void 0:r.call(s,i)):new f8(ar(ar({},n),{},{retryConfig:n.websocketRetryConfig}),e),this._statsCollector=n.statsCollector,this.role=n.role||"audience",this._clientRoleOptions=n.clientRoleOptions,this.handleSignalEvents()}async join(e,n,i){this.store.joinGatewayStart(),e.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const r=Date.now();let s=Kw.get(e.cname);if(s||(s=new Map,Kw.set(e.cname,s)),this._isProactiveJoin=!0,s.has(e.uid)){const h=new K(P.UID_CONFLICT);throw Pt.joinGateway(e.sid,{lts:r,succ:!1,ec:h.code,addr:null,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,isProxy:!!e.proxyServer,signalChannel:"0",preload:e.preload}),h}s.set(e.uid,!0),this.joinInfo=e,this.key=n;let c=0;this.joinGatewayStartTime=r;const l=e.proxyServer;try{T.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(c));const h=e.gatewayAddrs.map(p=>{let{address:m}=p;const[_,E]=m.split(":"),I={host:_,port:E};return e.proxyServer&&(I.proxy=e.proxyServer),I});c=(await this.signal.init(h)).uid,T.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(c," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(h){var d;throw T.error("[".concat(this.store.clientId,"] User join failed"),h.toString()),Pt.joinGateway(e.sid,{lts:r,succ:!1,ec:((d=h.data)===null||d===void 0?void 0:d.desc)||h.code,errorMsg:h.message,addr:this.signal.url,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,isProxy:!!l,signalChannel:"0",preload:e.preload}),s.delete(e.uid),this.signal.close(),h}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),T.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(h=>{T.warning("[".concat(this.store.clientId,"] get traffic stats error"),h.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(fi.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(fi.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(fi.NETWORK_QUALITY,{uplinkNetworkQuality:hM(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:hM(this._statsCollector.trafficStats.B_dnq)}):this.emit(fi.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),c}async leave(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0],n=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){n!==xe.FALLBACK&&(this.state="DISCONNECTING");try{e||this.signal.connectionState!==an.CONNECTED||await function(i,r){return r===1/0?i:Tt.race([i,G6(r)])}(this.signal.request(Wt.LEAVE,void 0,!0),3e3)}catch(i){T.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),i)}this.signal.close(n),n!==xe.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(e,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new K(P.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const r={state:"offer",p2p_id:this.store.p2pId,ortc:n,mode:this.spec.mode,extend:k("PUB_EXTEND"),twcc:!!k("PUBLISH_TWCC"),rtx:!!k("USE_PUB_RTX")};try{return(await this.signal.request(Wt.PUBLISH,r,!0))._message}catch(s){if(i&&s.data&&s.data.code===Vt.ERR_PUBLISH_REQUEST_INVALID)return T.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),s.toString()),await this.tryUnpubBeforeRepub(e,n),this.publish(e,n,!1);throw s}}async publishDataChannel(e,n,i){var r;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new K(P.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const s={stream_id:n.streamId,ordered:n.ordered?1:0,max_retrans_times:(r=n.maxRetransmits)!==null&&r!==void 0?r:10,channel_id:n.channelId,metadata:n.metadata};try{await this.signal.request(Wt.PUBLISH_DATASTREAM,s,!0)}catch(c){if(i&&c.data&&c.data.code===Vt.ERR_PUBLISH_REQUEST_INVALID)return T.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),c.toString()),await this.tryUnpubDataChannelBeforeRepub(e,n),this.publishDataChannel(e,n,!1);throw c}}async unpublish(e,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new K(P.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(Wt.UNPUBLISH,{stream_id:n,ortc:e},!0)}catch(i){T.warning("[".concat(this.store.clientId,"] unpublish warning: "),i)}}async unpublishDataChannel(e){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new K(P.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await Tt.all(e.map(n=>this.signal.request(Wt.UNPUBLISH_DATASTREAM,{channel_id:n},!0)))}catch(n){T.warning("unpublish datachannels warning: ",n)}}async presubscribe(e,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new K(P.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const r={stream_id:e,stream_type:n,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!k("SUBSCRIBE_TWCC"),rtx:!!k("USE_SUB_RTX")||void 0,extend:k("SUB_EXTEND"),svc:Array.isArray(k("SVC"))&&k("SVC").length!==0?k("SVC"):void 0};try{return await this.signal.request(Wt.PRE_SUBSCRIBE,r,!0)}catch(s){if(i&&s.data&&s.data.code===Vt.ERR_SUBSCRIBE_REQUEST_INVALID)return T.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),s.toString()),this.presubscribe(e,n,!1);throw s}}async subscribe(e,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new K(P.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const r={stream_id:e,stream_type:n.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!k("SUBSCRIBE_TWCC"),rtx:!!k("USE_SUB_RTX"),extend:k("SUB_EXTEND"),ssrcId:n.ssrcId,svc:Array.isArray(k("SVC"))&&k("SVC").length!==0?k("SVC"):void 0};try{return(await this.signal.request(Wt.SUBSCRIBE,r,!0))._message}catch(s){if(i&&s.data&&s.data.code===Vt.ERR_SUBSCRIBE_REQUEST_INVALID)return T.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),s.toString()),await this.tryUnsubBeforeResub(e,n),await this.subscribe(e,n,!1);throw s}}async subscribeDataChannel(e,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new K(P.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const r={uid:e,stream_id:n.id,channel_id:n.datachannelId};try{return void await this.signal.request(Wt.SUBSCRIBE_DATASTREAM,r,!0)}catch(s){if(i&&s.data&&s.data.code===Vt.ERR_SUBSCRIBE_REQUEST_INVALID)return T.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),s.toString()),await this.tryUnsubDataChannelBeforeResub(e,n),await this.subscribeDataChannel(e,n,!1);throw s}}async subscribeAll(e,n){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new K(P.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const i={p2p_id:this.store.p2pId,users:e,dtx:!1,rtx:!!k("USE_SUB_RTX"),twcc:!!k("SUBSCRIBE_TWCC"),svc:Array.isArray(k("SVC"))&&k("SVC").length!==0?k("SVC"):void 0};try{return await this.signal.request(Wt.SUBSCRIBE_STREAMS,i,!0)}catch(r){if(n&&r.data&&r.data.code===Vt.ERR_SUBSCRIBE_REQUEST_INVALID)return T.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),r.toString()),await this.tryMassUnsubBeforeResub(e),await this.subscribeAll(e,!1);throw r}}async setVideoProfile(e){const n=function(i){if(!(i.bitrateMax&&i.bitrateMin&&i.frameRate&&i.height&&i.width))return;let r=i.frameRate,s=i.width,c=i.height,l=!0;return typeof r!="number"&&(r=r.exact||r.ideal||r.max||r.min||0,r||(l=!1)),typeof s!="number"&&(s=s.exact||s.ideal||s.max||s.min||0,s||(l=!1)),typeof c!="number"&&(c=c.exact||c.ideal||c.max||c.min||0,r||(l=!1)),l?{stream_type:0,width:s,height:c,fps:r,start_bps:1e3*i.bitrateMax,min_bps:1e3*i.bitrateMin,target_bps:1e3*i.bitrateMax}:void 0}(e);if(n)return this.signal.request(Wt.SET_VIDEO_PROFILE,n);T.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(e,n){try{await this.signal.request(Wt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:e,stream_id:n},!0)}catch(i){T.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),i)}}async unsubscribeDataChannel(e,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new K(P.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await Tt.all(e.map(i=>this.signal.request(Wt.UNSUBSCRIBE_DATASTREAM,{stream_id:i,uid:n},!0)))}catch(i){T.warning("unsubscribeDataChannel warning: ",i)}}async massUnsubscribe(e){try{await this.signal.request(Wt.UNSUBSCRIBE_STREAMS,e,!0)}catch(n){T.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),n)}}async reconnectPC(e){const{iceParameters:n,dtlsParameters:i,rtpCapabilities:r}=e;return{gatewayEstablishParams:await this.signal.request(Wt.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:n,dtlsParameters:i,rtpCapabilities:r}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(Wt.GATEWAY_INFO)}async renewToken(e){await this.signal.request(Wt.RENEW_TOKEN,e),this.key=e.token}updateClientRole(e,n){n&&(this._clientRoleOptions=Object.assign({},n)),k("CLIENT_ROLE_OPTIONS")&&(T.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(k("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},k("CLIENT_ROLE_OPTIONS"))),this.role=e}async setClientRole(e,n){if(n&&(this._clientRoleOptions=Object.assign({},n)),k("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},k("CLIENT_ROLE_OPTIONS")),T.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(k("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=e);let i,r=0;e==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(i=this._clientRoleOptions.delay,r=1):r=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:r=0;const s=Object.assign({},n);delete s.delay,delete s.level,await this.signal.request(Wt.SET_CLIENT_ROLE,ar(ar({role:e,level:r,delay:i},s),{},{client_ts:Date.now()})),this.role=e}async setRemoteVideoStreamType(e,n){await this.signal.request(Wt.SWITCH_VIDEO_STREAM,{stream_id:e,stream_type:n})}async setDefaultRemoteVideoStreamType(e){await this.signal.request(Wt.DEFAULT_VIDEO_STREAM,{stream_type:e})}async setStreamFallbackOption(e,n){await this.signal.request(Wt.SET_FALLBACK_OPTION,{stream_id:e,fallback_type:n})}async pickSVCLayer(e,n){await this.signal.request(Wt.PICK_SVC_LAYER,{stream_id:e,spatial_layer:n.spatialLayer,temporal_layer:n.temporalLayer})}async setRTM2Flag(e){await this.signal.request(Wt.SET_RTM2_FLAG,{rtm2_flag:e})}async sendExtensionMessage(e,n,i){if(this.store.useP2P)return this.signal.sendExtensionMessage(e,n,i)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),ar({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(Wt.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const e=Kw.get(this.joinInfo.cname);e&&e.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const e=function(n){let i;return i=n.startsWith("dc")?n.match(/(dc\:\/\/)?([^:]+):(\d+)/):n.match(/(wss\:\/\/)?([^:]+):(\d+)/),i?{username:Li.username,password:Li.password,turnServerURL:i[2],tcpport:parseInt(i[3])+30,udpport:parseInt(i[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],e&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(ar(ar({},Li),{},{turnServerURL:e.turnServerURL,tcpport:e.tcpport,udpport:e.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const e=await this.signal.request(Wt.TRAFFIC_STATS,void 0,!0);e.timestamp=Date.now(),e.ntp_offset!=null&&(this.ntpOffset=e.ntp_offset),e.peer_delay.forEach(n=>{const i=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(r=>r.peer_uid===n.peer_uid);i&&i.B_st!==n.B_st&&rR(()=>{this.emit(fi.STREAM_TYPE_CHANGE,n.peer_uid,n.B_st)})}),this._statsCollector.updateTrafficStats(e)}getJoinMessage(e){var n,i;if(!this.joinInfo||!this.key)throw new K(P.UNEXPECTED_ERROR,"can not generate join message, no join info");const r=Object.assign({},this.joinInfo.apResponse);let s=k("REPORT_APP_SCENARIO");if(typeof s!="string")try{s=JSON.stringify(s)}catch{s=void 0}var c;s&&s.length>128&&(s=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(fi.UPDATE_GATEWAY_CONFIG),c=this.store.clientId,mt(ym).call(ym,c)||ym.push(c);const l=cw(this.store),d=!((n=this.isPreallocation)===null||n===void 0||!n.call(this)),h=xL(this.store),p=_8(),m=im(87)||Wk()||MA(117),_=(function(){const I=ve();if(I.name!==Ie.SAFARI||!I.browserVersion)return!1;const C=I.browserVersion.split(".");return Number(C[0])>18||Number(C[0])===18&&Number(C[1])>=4}()||Yk(18,4,!1))&&UA(18,6,!0)&&this.spec.codec==="h264"&&k("ENABLE_ABSSENDTIME_AS_SENTTS"),E=ar({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:$a,browser:navigator.userAgent,process_id:k("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:r,extend:k("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:s,attributes:{userAttributes:ar(ar({enableEncodedTransform:(!!k("ENABLE_AUDIO_METADATA")||!!k("ENABLE_AUDIO_PTS"))&&m||!!k("ENABLE_AUDIO_TOPN")&&LA(Ie.CHROME,87,116)||void 0,enableAudioMetadata:!!k("ENABLE_AUDIO_METADATA")&&m,enableAudioPts:!!k("ENABLE_AUDIO_PTS")&&m,topnSmoothLevel:k("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:k("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:k("TOPN_SWITCH_HOLD_MS"),topnAudioGain:k("TOPN_AUDIO_GAIN"),enablePublishedUserList:k("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:k("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:La("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:La("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:La("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:k("USE_PUB_RTX")===!0||k("USE_SUB_RTX")===!0||void 0,disableFEC:k("DISABLE_FEC"),enableNTPReport:!!k("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:h,enableFulllinkAvSync:!!k("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:La("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!k("FORCE_ENABLE_AUT_CC")||!uR()&&(!!k("ENABLE_AUT_FEEDBACK")||void 0),rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!k("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:La("USE_XR","boolean"),enableLossbasedBwe:La("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!k("FORCE_ENABLE_AUT_CC")||!uR()&&(!!k("ENABLE_AUT_CC")||void 0),enableCCFallback:La("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:d,preSubNum:l?La("PRE_SUB_NUM","number"):void 0,enablePubTWCC:La("PUBLISH_TWCC","boolean"),enableSubTWCC:La("SUBSCRIBE_TWCC","boolean"),enablePubRTX:La("USE_PUB_RTX","boolean"),enableSubRTX:La("USE_SUB_RTX","boolean"),enableSubSVC:k("ENABLE_SVC")?k("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(k("SVC"))&&k("SVC").length!==0?k("SVC"):void 0,enableSvcExtended:k("ENABLE_SVC")&&Array.isArray(k("SVC_EXTENDED"))&&k("SVC_EXTENDED").length!==0?k("SVC_EXTENDED"):void 0},p),{},{audioDuplicate:La("ENABLE_AUDIO_RED","boolean")?(i=La("AUDIO_DUPLICATE_NUM","number"))!==null&&i!==void 0?i:2:void 0,senttsUsesAbsSendTime:!!_||void 0})},join_ts:this.joinGatewayStartTime},e);return this.joinInfo.stringUid&&(E.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(E.aes_mode=this.joinInfo.aesmode,k("ENCRYPT_AES")?(E.aes_secret=this.joinInfo.aespassword,E.aes_encrypt=!0):E.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(E.aes_salt=this.joinInfo.aessalt)),r.addresses[this.signal.websocket.currentURLIndex]&&(E.ap_response.ticket=r.addresses[this.signal.websocket.currentURLIndex].ticket,delete r.addresses),this.joinInfo.defaultVideoStream!==void 0&&(E.default_video_stream=this.joinInfo.defaultVideoStream),E}getRejoinMessage(){if(!this.joinInfo)throw new K(P.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(Yt.WS_RECONNECT_CREATE_CONNECTION,e=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(Yt.WS_RECONNECTING,e=>{this.joinInfo&&Pt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:e||Pi.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",Pt.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(Yt.WS_CLOSED,e=>{let n;switch(e){case xe.LEAVE:n=Pi.LEAVE;break;case xe.UID_BANNED:case xe.IP_BANNED:case xe.CHANNEL_BANNED:case xe.SERVER_ERROR:n=Pi.SERVER_ERROR;break;case xe.FALLBACK:n=Pi.FALLBACK;break;case xe.LICENSE_MISSING:case xe.LICENSE_EXPIRED:case xe.LICENSE_MINUTES_EXCEEDED:case xe.LICENSE_PERIOD_INVALID:case xe.LICENSE_MULTIPLE_SDK_SERVICE:case xe.LICENSE_ILLEGAL:case xe.TOKEN_EXPIRE:n=e;break;default:n=Pi.NETWORK_ERROR}T.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(n||"undefined -> "+Pi.NETWORK_ERROR)),this.joinInfo&&Pt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:e===xe.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:n}),this._disconnectedReason=e,e!==xe.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(Yt.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const e=k("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;e&&(e.level||e.delay)&&(T.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(e.level,", delay: ").concat(e.delay)),this.setClientRole(this.role,e))}if(Pt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const e=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!e)return void T.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(e));Fe("EVENT_REPORT_DOMAIN",e[1]),Fe("EVENT_REPORT_BACKUP_DOMAIN",e[1]),Fe("LOG_UPLOAD_SERVER","".concat(e[1],":6444"))}}}),this.signal.on(pe.ON_UPLINK_STATS,e=>{this._statsCollector.updateUplinkStats(e)}),this.signal.on(Yt.REQUEST_RECOVER,(e,n,i)=>{if(!this.joinInfo)return i(new K(P.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));e&&(this.joinInfo.multiIP=e,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,ki(this,fi.REQUEST_NEW_GATEWAY_LIST).then(n).catch(i)}),this.signal.on(Yt.REQUEST_JOIN_INFO,async(e,n,i)=>{var r,s,c;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void e(this.getJoinMessage({ortc:{}}));const l=En((r=this.joinInfo)===null||r===void 0?void 0:r.turnServer);if(k("NEW_TURN_MODE")&&l&&((s=this.joinInfo)===null||s===void 0?void 0:s.cloudProxyServer)==="disabled"){var d;let _=l.servers.map(C=>"turnServerURL"in C&&k("USE_TURN_IP")?ar(ar({},C),{},{turnServerURL:kR(C.turnServerURL)}):C),E=(d=l.serversFromGateway)===null||d===void 0?void 0:d.map(C=>k("USE_TURN_IP")?ar(ar({},C),{},{turnServerURL:kR(C.turnServerURL)}):C);const I=this.signal.currentURLIndex;_.length>0&&(_=[_[I%_.length]],l.servers=_),Array.isArray(E)&&E.length>0&&(E=[E[0]],l.serversFromGateway=E),T.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(I))}const{iceParameters:h,dtlsParameters:p,rtpCapabilities:m}=await ki(this,fi.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:l,cloudProxyServer:(c=this.joinInfo)===null||c===void 0?void 0:c.cloudProxyServer});try{e(this.getJoinMessage({ortc:{iceParameters:h,dtlsParameters:p,rtpCapabilities:m,version:"2"}}))}catch(_){n(_)}}),this.signal.on(Yt.REQUEST_REJOIN_INFO,e=>{e(this.getRejoinMessage())}),this.signal.on(Yt.REPORT_JOIN_GATEWAY,(e,n)=>{if(!this.joinInfo)return;let i,r="";var s;e instanceof K?(i=((s=e.data)===null||s===void 0?void 0:s.desc)||e.code,r=e.message):i=e,Pt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:i,errorMsg:r,addr:n,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on(Yt.IS_P2P_DISCONNECTED,e=>{e(Dg(this,fi.IS_P2P_DISCONNECTED))}),this.signal.on(Yt.DISCONNECT_P2P,()=>{this.emit(fi.DISCONNECT_P2P)}),this.signal.on(Yt.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(Yt.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(Yt.JOIN_RESPONSE,e=>{const n=this.getCurrentGatewayAddress();this.emit(fi.JOIN_RESPONSE,e,n)}),this.signal.on(Yt.PRE_CONNECT_PC,async()=>{if(this.joinInfo){var e,n;this.updateTurnConfigFromSignal();const r=this.getCurrentGatewayAddress(),s=En((e=this.joinInfo)===null||e===void 0?void 0:e.turnServer);if(k("NEW_TURN_MODE")&&s&&((n=this.joinInfo)===null||n===void 0?void 0:n.cloudProxyServer)==="disabled"){var i;let l=s.servers.map(p=>"turnServerURL"in p&&k("USE_TURN_IP")?ar(ar({},p),{},{turnServerURL:kR(p.turnServerURL)}):p),d=(i=s.serversFromGateway)===null||i===void 0?void 0:i.map(p=>k("USE_TURN_IP")?ar(ar({},p),{},{turnServerURL:kR(p.turnServerURL)}):p);const h=this.signal.currentURLIndex;l.length>0&&(l=[l[h%l.length]],s.servers=l),Array.isArray(d)&&d.length>0&&(d=[d[0]],s.serversFromGateway=d),T.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(h,",in pre pc"))}const c=k("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(r&&c){const l=SM(r);this.emit(fi.PRE_CONNECT_PC,{candidates:l,fingerprint:c,turnServer:s})}}}),this.signal.on(Yt.RECOVER_NOTIFICATION,e=>{this.joinInfo&&typeof k("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(k("AP_REQUEST_DETAIL"),";").concat(e))})}async tryUnsubBeforeResub(e,n){try{await this.signal.request(Wt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:e,ortc:[n]},!0)}catch(i){throw T.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),i),i}}async tryUnsubDataChannelBeforeResub(e,n){try{await this.signal.request(Wt.UNSUBSCRIBE,{stream_id:n.id},!0)}catch(i){throw T.warning("unsubscribe datachannel warning",i),i}}async tryUnpubBeforeRepub(e,n){try{await this.signal.request(Wt.UNPUBLISH,{stream_id:e,ortc:n},!0)}catch(i){throw T.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),i),i}}async tryUnpubDataChannelBeforeRepub(e,n){try{await this.signal.request(Wt.UNPUBLISH_DATASTREAM,{channnel_id:n.channelId},!0)}catch(i){throw T.warning("unpublish datastream warning: ",i),i}}async tryMassUnsubBeforeResub(e){const n={users:e.map(i=>({stream_id:i.stream_id,stream_type:i.stream_type}))};try{await this.signal.request(Wt.UNSUBSCRIBE_STREAMS,n,!0)}catch(i){throw T.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),i),i}}async muteLocal(e,n){const i={action:e.find(r=>r.stream_type===Ve.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:n};try{await this.signal.request(Wt.CONTROL,i,!0,!0)}catch(r){throw T.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),r),r}}async unmuteLocal(e,n){const i={action:e.find(r=>r.stream_type===Ve.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:n};try{await this.signal.request(Wt.CONTROL,i,!0,!0)}catch(r){throw T.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),r),r}}async muteRemote(e,n){const i={action:e===Ct.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(Wt.CONTROL,i,!0,!0)}catch(r){throw T.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),r),r}}async unmuteRemote(e,n){const i={action:e===Ct.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(Wt.CONTROL,i,!0,!0)}catch(r){throw T.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),r),r}}uploadWRTCStats(e){this.signal.uploadWRTCStats(e)}upload(e,n){this.signal.upload(e,n)}getSignalRTT(){return this.signal.rtt}async restartICE(e){const n={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:e};try{return await this.signal.request(Wt.RESTART_ICE,n,!0)}catch(i){throw T.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),i),i}}reconnect(e,n){this.state==="CONNECTED"&&this.signal.reconnect(e||void 0,n||Pi.P2P_FAILED)}getCurrentGatewayAddress(){var e,n;if(!k("GATEWAY_WSS_ADDRESS"))return k("USE_CANDIDATE_FROM_AP_DETAIL")&&(e=this.joinInfo)!==null&&e!==void 0&&e.apGatewayAddress?(T.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(n=this.joinInfo)!==null&&n!==void 0&&n.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(e){await this.signal.request(Wt.SET_PARAMETER,{enablePublishAudioFilter:e})}downgradeCodec(e){this.signal.downgradeCodec(e)}}let BR=0,Yw=0;function Io(t,e,n,i){return new Tt((r,s)=>{e.timeout=e.timeout||k("HTTP_CONNECT_TIMEOUT"),e.responseType=e.responseType||"json",e.data&&!n?(e.data=JSON.stringify(e.data),BR+=gc(e.data)):n&&(e.data.size?BR+=e.data.size:e.data instanceof FormData?BR+=dL(e.data):BR+=gc(JSON.stringify(e.data))),e.headers=e.headers||{},e.headers["Content-Type"]=e.headers["Content-Type"]||"application/json",e.method="POST",e.url=t,Ir.request(e).then(c=>{typeof c.data=="string"?Yw+=gc(c.data):c.data instanceof ArrayBuffer||c.data instanceof Uint8Array?Yw+=c.data.byteLength:Yw+=gc(JSON.stringify(c.data)),i&&r({data:c.data,headers:c.headers}),r(c.data)}).catch(c=>{Ir.isCancel(c)?s(new K(P.OPERATION_ABORTED,"cancel token canceled")):c.code==="ECONNABORTED"?s(new K(P.NETWORK_TIMEOUT,c.message)):c.response?s(new K(P.NETWORK_RESPONSE_ERROR,c.response.status)):s(new K(P.NETWORK_ERROR,c.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var t;function e(it){var ft=0;return function(){return ft<it.length?{done:!1,value:it[ft++]}:{done:!0}}}var n=typeof Object.defineProperties=="function"?Object.defineProperty:function(it,ft,wt){return it==Array.prototype||it==Object.prototype||(it[ft]=wt.value),it},i,r=function(it){it=[typeof globalThis=="object"&&globalThis,it,typeof window=="object"&&window,typeof self=="object"&&self,typeof A=="object"&&A];for(var ft=0;ft<it.length;++ft){var wt=it[ft];if(wt&&wt.Math==Math)return wt}throw Error("Cannot find global object")}(this);function s(it,ft){if(ft)t:{var wt=r;it=it.split(".");for(var at=0;at<it.length-1;at++){var b=it[at];if(!(b in wt))break t;wt=wt[b]}(ft=ft(at=wt[it=it[it.length-1]]))!=at&&ft!=null&&n(wt,it,{configurable:!0,writable:!0,value:ft})}}function c(it){return(it={next:it})[Symbol.iterator]=function(){return this},it}function l(it){var ft=typeof Symbol<"u"&&Symbol.iterator&&it[Symbol.iterator];return ft?ft.call(it):{next:e(it)}}if(s("Symbol",function(it){function ft(b,M){this.A=b,n(this,"description",{configurable:!0,writable:!0,value:M})}if(it)return it;ft.prototype.toString=function(){return this.A};var wt="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",at=0;return function b(M){if(this instanceof b)throw new TypeError("Symbol is not a constructor");return new ft(wt+(M||"")+"_"+at++,M)}}),s("Symbol.iterator",function(it){if(it)return it;it=Symbol("Symbol.iterator");for(var ft="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),wt=0;wt<ft.length;wt++){var at=r[ft[wt]];typeof at=="function"&&typeof at.prototype[it]!="function"&&n(at.prototype,it,{configurable:!0,writable:!0,value:function(){return c(e(this))}})}return it}),typeof Object.setPrototypeOf=="function")i=Object.setPrototypeOf;else{var d;t:{var h={};try{h.__proto__={a:!0},d=h.a;break t}catch{}d=!1}i=d?function(it,ft){if(it.__proto__=ft,it.__proto__!==ft)throw new TypeError(it+" is not extensible");return it}:null}var p=i;function m(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function _(it){if(it.m)throw new TypeError("Generator is already running");it.m=!0}function E(it,ft){return it.h=3,{value:ft}}function I(it){this.g=new m,this.G=it}function C(it,ft,wt,at){try{var b=ft.call(it.g.j,wt);if(!(b instanceof Object))throw new TypeError("Iterator result "+b+" is not an object");if(!b.done)return it.g.m=!1,b;var M=b.value}catch(F){return it.g.j=null,it.g.s(F),w(it)}return it.g.j=null,at.call(it.g,M),w(it)}function w(it){for(;it.g.h;)try{var ft=it.G(it.g);if(ft)return it.g.m=!1,{value:ft.value,done:!1}}catch(wt){it.g.v=void 0,it.g.s(wt)}if(it.g.m=!1,it.g.l){if(ft=it.g.l,it.g.l=null,ft.F)throw ft.D;return{value:ft.return,done:!0}}return{value:void 0,done:!0}}function D(it){this.next=function(ft){return it.o(ft)},this.throw=function(ft){return it.s(ft)},this.return=function(ft){return function(wt,at){_(wt.g);var b=wt.g.j;return b?C(wt,"return"in b?b.return:function(M){return{value:M,done:!0}},at,wt.g.return):(wt.g.return(at),w(wt))}(it,ft)},this[Symbol.iterator]=function(){return this}}function N(it,ft){return ft=new D(new I(ft)),p&&it.prototype&&p(ft,it.prototype),ft}if(m.prototype.o=function(it){this.v=it},m.prototype.s=function(it){this.l={D:it,F:!0},this.h=this.C||this.u},m.prototype.return=function(it){this.l={return:it},this.h=this.u},I.prototype.o=function(it){return _(this.g),this.g.j?C(this,this.g.j.next,it,this.g.o):(this.g.o(it),w(this))},I.prototype.s=function(it){return _(this.g),this.g.j?C(this,this.g.j.throw,it,this.g.o):(this.g.s(it),w(this))},s("Array.prototype.entries",function(it){return it||function(){return function(ft,wt){ft instanceof String&&(ft+="");var at=0,b=!1,M={next:function(){if(!b&&at<ft.length){var F=at++;return{value:wt(F,ft[F]),done:!1}}return b=!0,{done:!0,value:void 0}}};return M[Symbol.iterator]=function(){return M},M}(this,function(ft,wt){return[ft,wt]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var L=function(it,ft){for(var wt=0;wt<it.length;wt++)ft(it[wt])},W=function(it){return it.replace(/\r?\n|\r/g,`\r
`)},G=function(it,ft,wt){return ft instanceof Blob?(wt=wt!==void 0?wt+"":typeof ft.name=="string"?ft.name:"blob",ft.name===wt&&Object.prototype.toString.call(ft)!=="[object Blob]"||(ft=new File([ft],wt)),[String(it),ft]):[String(it),String(ft)]},U=function(it,ft){if(it.length<ft)throw new TypeError(ft+" argument required, but only "+it.length+" present.")},z=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,$=z.FormData,rt=z.XMLHttpRequest&&z.XMLHttpRequest.prototype.send,dt=z.Request&&z.fetch,ae=z.navigator&&z.navigator.sendBeacon,se=z.Element&&z.Element.prototype,zt=z.Symbol&&Symbol.toStringTag;zt&&(Blob.prototype[zt]||(Blob.prototype[zt]="Blob"),"File"in z&&!File.prototype[zt]&&(File.prototype[zt]="File"));try{new File([],"")}catch{z.File=function(ft,wt,at){return ft=new Blob(ft,at||{}),Object.defineProperties(ft,{name:{value:wt},lastModified:{value:+(at&&at.lastModified!==void 0?new Date(at.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),zt&&Object.defineProperty(ft,zt,{value:"File"}),ft}}var ke=function(it){return it.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},De=function(it){this.i=[];var ft=this;it&&L(it.elements,function(wt){if(wt.name&&!wt.disabled&&wt.type!=="submit"&&wt.type!=="button"&&!wt.matches("form fieldset[disabled] *"))if(wt.type==="file"){var at=wt.files&&wt.files.length?wt.files:[new File([],"",{type:"application/octet-stream"})];L(at,function(b){ft.append(wt.name,b)})}else wt.type==="select-multiple"||wt.type==="select-one"?L(wt.options,function(b){!b.disabled&&b.selected&&ft.append(wt.name,b.value)}):wt.type==="checkbox"||wt.type==="radio"?wt.checked&&ft.append(wt.name,wt.value):(at=wt.type==="textarea"?W(wt.value):wt.value,ft.append(wt.name,at))})};if((t=De.prototype).append=function(it,ft,wt){U(arguments,2),this.i.push(G(it,ft,wt))},t.delete=function(it){U(arguments,1);var ft=[];it=String(it),L(this.i,function(wt){wt[0]!==it&&ft.push(wt)}),this.i=ft},t.entries=function it(){var ft,wt=this;return N(it,function(at){if(at.h==1&&(ft=0),at.h!=3)return ft<wt.i.length?at=E(at,wt.i[ft]):(at.h=0,at=void 0),at;ft++,at.h=2})},t.forEach=function(it,ft){U(arguments,1);for(var wt=l(this),at=wt.next();!at.done;at=wt.next()){var b=l(at.value);at=b.next().value,b=b.next().value,it.call(ft,b,at,this)}},t.get=function(it){U(arguments,1);var ft=this.i;it=String(it);for(var wt=0;wt<ft.length;wt++)if(ft[wt][0]===it)return ft[wt][1];return null},t.getAll=function(it){U(arguments,1);var ft=[];return it=String(it),L(this.i,function(wt){wt[0]===it&&ft.push(wt[1])}),ft},t.has=function(it){U(arguments,1),it=String(it);for(var ft=0;ft<this.i.length;ft++)if(this.i[ft][0]===it)return!0;return!1},t.keys=function it(){var ft,wt,at,b,M=this;return N(it,function(F){if(F.h==1&&(ft=l(M),wt=ft.next()),F.h!=3)return wt.done?void(F.h=0):(at=wt.value,b=l(at),E(F,b.next().value));wt=ft.next(),F.h=2})},t.set=function(it,ft,wt){U(arguments,2),it=String(it);var at=[],b=G(it,ft,wt),M=!0;L(this.i,function(F){F[0]===it?M&&(M=!at.push(b)):at.push(F)}),M&&at.push(b),this.i=at},t.values=function it(){var ft,wt,at,b,M=this;return N(it,function(F){if(F.h==1&&(ft=l(M),wt=ft.next()),F.h!=3)return wt.done?void(F.h=0):(at=wt.value,(b=l(at)).next(),E(F,b.next().value));wt=ft.next(),F.h=2})},De.prototype._asNative=function(){for(var it=new $,ft=l(this),wt=ft.next();!wt.done;wt=ft.next()){var at=l(wt.value);wt=at.next().value,at=at.next().value,it.append(wt,at)}return it},De.prototype._blob=function(){var it="----formdata-polyfill-"+Math.random(),ft=[],wt="--"+it+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(at,b){return typeof at=="string"?ft.push(wt+ke(W(b))+`"\r
\r
`+W(at)+`\r
`):ft.push(wt+ke(W(b))+'"; filename="'+ke(at.name)+`"\r
Content-Type: `+(at.type||"application/octet-stream")+`\r
\r
`,at,`\r
`)}),ft.push("--"+it+"--"),new Blob(ft,{type:"multipart/form-data; boundary="+it})},De.prototype[Symbol.iterator]=function(){return this.entries()},De.prototype.toString=function(){return"[object FormData]"},se&&!se.matches&&(se.matches=se.matchesSelector||se.mozMatchesSelector||se.msMatchesSelector||se.oMatchesSelector||se.webkitMatchesSelector||function(it){for(var ft=(it=(this.document||this.ownerDocument).querySelectorAll(it)).length;0<=--ft&&it.item(ft)!==this;);return-1<ft}),zt&&(De.prototype[zt]="FormData"),rt){var Xi=z.XMLHttpRequest.prototype.setRequestHeader;z.XMLHttpRequest.prototype.setRequestHeader=function(it,ft){Xi.call(this,it,ft),it.toLowerCase()==="content-type"&&(this.B=!0)},z.XMLHttpRequest.prototype.send=function(it){it instanceof De?(it=it._blob(),this.B||this.setRequestHeader("Content-Type",it.type),rt.call(this,it)):rt.call(this,it)}}dt&&(z.fetch=function(it,ft){return ft&&ft.body&&ft.body instanceof De&&(ft.body=ft.body._blob()),dt.call(this,it,ft)}),ae&&(z.navigator.sendBeacon=function(it,ft){return ft instanceof De&&(ft=ft._asNative()),ae.call(this,it,ft)}),z.FormData=De}})();const Yg=()=>{const t=k("AREAS");return t.length===0&&t.push(Pe.GLOBAL),Vr(t).call(t,(e,n,i)=>{const r=kM(n);return r?i===0?r:"".concat(e,",").concat(r):e},"")},kM=t=>t===Pe.OVERSEA?"".concat(qi.ASIA,",").concat(qi.EUROPE,",").concat(qi.AFRICA,",").concat(qi.NORTH_AMERICA,",").concat(qi.SOUTH_AMERICA,",").concat(qi.OCEANIA):qi[t],g8=t=>{const e={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return t.map(n=>{const i=DR[n],r=Object.keys(i);r&&r.map(s=>{s!=="CODE"&&(e[s]=e[s].concat(i[s]))})}),e},FR={GLOBAL:{ASIA:[Pe.CHINA,Pe.JAPAN,Pe.INDIA,Pe.KOREA,Pe.HKMC],EUROPE:[],NORTH_AMERICA:[Pe.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},GR=Object.keys(FR[Pe.GLOBAL]),Xw=[Pe.CHINA,Pe.NORTH_AMERICA,Pe.EUROPE,Pe.ASIA,Pe.JAPAN,Pe.INDIA,Pe.OCEANIA,Pe.SOUTH_AMERICA,Pe.AFRICA,Pe.KOREA,Pe.HKMC,Pe.US],v8=function(t,e){let n=[];if(mt(t).call(t,Pe.GLOBAL)){const s=[Pe.GLOBAL,Pe.OVERSEA],c=Object.keys(DR);if(e===Pe.GLOBAL)throw new K(P.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(e===Pe.CHINA)n=[Pe.OVERSEA];else if(r=e,mt(GR).call(GR,r)){const l=(i=e,FR[Pe.GLOBAL][i]||[]),d=[...s,e,...l];n=c.filter(h=>!mt(d).call(d,h))}else if(function(l){let d=!1;return GR.forEach(h=>{var p;mt(p=FR[Pe.GLOBAL][h]).call(p,l)&&(d=!0)}),d}(e)){const l=function(h){let p;return GR.forEach(m=>{var _;mt(_=FR[Pe.GLOBAL][m]).call(_,h)&&(p=m)}),p}(e),d=[...s,l,e];n=c.filter(h=>!mt(d).call(d,h))}else n=t;n=function(l){const d=[];return Xw.forEach(h=>{mt(l).call(l,h)&&d.push(h)}),d.concat(l.filter(h=>!mt(Xw).call(Xw,h)))}(n)}else n=t;var i,r;return n};function LM(t){var e,n;if(!t&&mt(e=k("AREAS")).call(e,Pe.EXTENSIONS))return T.debug("update area from ap : reset"),void Qw(wG,!0);if(!mt(n=k("AREAS")).call(n,Pe.GLOBAL)||!t)return;let i=DR.EXTENSIONS;i&&(i={CODE:kM(Pe.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(t,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(t,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(t,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(t,".agora.io"),"cds-ap-web-2-".concat(t,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(t,".agora.io"),"sua-ap-web-2-".concat(t,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(t,".agora.io"),"uap-ap-web-2-".concat(t,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(t,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(t,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(t,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(t,".agora.io")]},T.debug("update area from ap success: ".concat(t,",config is "),i),Fe("AREAS",[Pe.EXTENSIONS],!0),Object.keys(i).map(r=>{r==="LOG_UPLOAD_SERVER"||r==="EVENT_REPORT_DOMAIN"||r==="EVENT_REPORT_BACKUP_DOMAIN"||r==="PROXY_SERVER_TYPE3"?Fe(r,i[r][0]):Fe(r,i[r])}))}function Qw(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=Pt.reportApiInvoke(null,{name:kn.SET_AREA,options:t,tag:_n.TRACER});try{let i=[];if(typeof t=="string"&&(i=[t]),Array.isArray(t)&&(t.forEach(s=>{if(!mt(eM).call(eM,s))throw new K(P.INVALID_PARAMS,"invalid area code")}),i=t),Object.prototype.toString.call(t)==="[object Object]"){const{areaCode:s,excludedArea:c}=t;if(!s)throw new K(P.INVALID_PARAMS,"area code is needed");let l=s;typeof s=="string"&&(l=[s]),i=c?v8(l,c):l}if(!e){if(bo.AREAS){const s=new K(P.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return n.onError(s),void T.warning("setArea is prohibited because of config-distribute")}if(mt(i).call(i,Pe.GLOBAL)&&k("AREAS")===Pe.EXTENSIONS){const s=new K(P.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return n.onError(s),void T.warning("setArea is prohibited because of ap extensions")}}Fe("AREAS",i,e);const r=g8(i);Object.keys(r).map(s=>{s==="LOG_UPLOAD_SERVER"||s==="EVENT_REPORT_DOMAIN"||s==="EVENT_REPORT_BACKUP_DOMAIN"||s==="PROXY_SERVER_TYPE3"?Fe(s,r[s][0]):Fe(s,r[s])}),T.debug("set area success:",i.join(","))}catch(i){throw n.onError(i),i}n.onSuccess()}function xM(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function bc(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?xM(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):xM(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}let Jw=1;function S8(t,e,n,i,r){Jw+=1;const s={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(Date.now()/1e3),seq:Jw,requestId:Jw,version:$a,cname:n.cname},c={service_name:e,json_body:JSON.stringify(s)};let l,d,h=t[0];return Ro(async()=>{l=Date.now();const p=await Io(h,{data:c,cancelToken:i,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(d=Date.now()-l,p.code!==0){const E=new K(P.UNEXPECTED_RESPONSE,"live streaming ap error, code"+p.code,{retry:!0,responseTime:d});throw T.error(E.toString()),E}const m=JSON.parse(p.json_body);if(m.code!==200){const E=new K(P.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(m.code,", reason: ").concat(m.reason),{code:m.code,responseTime:d});throw T.error(E.toString()),E}if(!m.servers||m.servers.length===0){const E=new K(P.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:m.code,responseTime:d});throw T.error(E.toString()),E}const _=function(E,I){return{addressList:E.servers.map(C=>"wss://".concat(C.address.replace(/\./g,"-"),".").concat(k("WORKER_DOMAIN"),":").concat(C.wss,"?serviceName=").concat(encodeURIComponent(I))),workerToken:E.workerToken,vid:E.vid}}(m,e);return k("LIVE_STREAMING_ADDRESS")&&(_.addressList=k("LIVE_STREAMING_ADDRESS")instanceof Array?k("LIVE_STREAMING_ADDRESS"):[k("LIVE_STREAMING_ADDRESS")]),bc(bc({},_),{},{responseTime:d})},(p,m)=>(Pt.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:e,responseDetail:JSON.stringify(p.addressList),firstSuccess:m===0,responseTime:d,serverIp:t[m%t.length]}),!1),(p,m)=>(Pt.apworkerEvent(n.sid,{success:!1,sc:p.data&&p.data.code||200,serviceName:e,responseTime:d,serverIp:t[m%t.length]}),!!(p.code!==P.OPERATION_ABORTED&&p.code!==P.UNEXPECTED_RESPONSE||p.data&&p.data.retry)&&(h=t[(m+1)%t.length],!0)),r)}let Zw=1;function MM(t,e,n,i){let{url:r,areaCode:s}=t;const{clientId:c,sid:l}=e,d=Date.now();let h;const p=e.role,[m,_]=tI(e,s,[zn.CHOOSE_SERVER]);let E=Wn.networkState;return Ro(async()=>{E&&Wn.networkState===la.OFFLINE&&Wn.onlineWaiter&&await Tt.race([Wn.onlineWaiter,yi(i&&i.maxRetryTimeout||Xn.maxRetryTimeout)]),E=Wn.networkState;const{data:I,headers:C}=await Io(r,{data:m,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);h=C.http3==="1"?1:-1,Pt.reportResourceTiming(r,l),VM(I,r,e,d,[zn.CHOOSE_SERVER],h);const w=Wg(I,zn.CHOOSE_SERVER);return $w(w),Hw(w,r)},I=>(I&&Pt.joinChooseServer(l,{role:p,lts:d,succ:!0,csAddr:r,opid:_,serverList:I.gatewayAddrs.map(C=>C.address),ec:null,cid:I.cid.toString(),uid:I.uid.toString(),csIp:I.csIp,unilbsServerIds:[zn.CHOOSE_SERVER].toString(),isHttp3:h,corssRegionTagReq:e.apRequestDetail,corssRegionTagRes:I.res.detail&&I.res.detail[38]}),!1),I=>I.code!==P.OPERATION_ABORTED&&(I.code===P.CAN_NOT_GET_GATEWAY_SERVER?I.data.retry:(Pt.joinChooseServer(l,{role:p,lts:d,succ:!1,csAddr:r,serverList:null,opid:_,ec:I.code,csIp:I.data&&I.data.csIp,unilbsServerIds:[zn.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:E}),isHttp3:h,corssRegionTagReq:e.apRequestDetail}),T.warning("[".concat(c||"sid-".concat(l.slice(0,6)),"] Choose server network error, retry"),I),!0)),i)}function UM(t,e,n,i){let r,{url:s,areaCode:c,serviceIds:l}=t;const d=Date.now(),h=e.role,[p,m]=tI(e,c,l);let _;return Ro(async()=>{_&&Wn.networkState===la.OFFLINE&&Wn.onlineWaiter&&await Tt.race([Wn.onlineWaiter,yi(i&&i.maxRetryTimeout||Xn.maxRetryTimeout)]),_=Wn.networkState;const{data:E,headers:I}=await Io(s,{data:p,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);r=I.http3==="1"?1:-1,Pt.reportResourceTiming(s,e.sid),VM(E,s,e,d,l,r);const C=Wg(E,zn.CHOOSE_SERVER),w=Wg(E,e.cloudProxyServer==="proxy5"?zn.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?zn.CLOUD_PROXY:zn.CLOUD_PROXY_FALLBACK),D=performance.getEntriesByName(s),N=D[D.length-1];let L;return N&&(L={name:N.name,protocol:"nextHopProtocol"in N?N.nextHopProtocol:"",dnscost:"domainLookupEnd"in N&&"domainLookupStart"in N&&typeof N.domainLookupEnd=="number"&&typeof N.domainLookupStart=="number"?N.domainLookupEnd-N.domainLookupStart:-1,tcpTlsCost:"connectEnd"in N&&"connectStart"in N&&typeof N.connectEnd=="number"&&typeof N.connectStart=="number"?N.connectEnd-N.connectStart:-1,reqCost:"requestStart"in N&&typeof N.requestStart=="number"&&"responseEnd"in N&&typeof N.responseEnd=="number"?N.responseEnd-N.requestStart:-1,handleCost:"leave_ts"in E&&"enter_ts"in E&&typeof E.leave_ts=="number"&&typeof E.enter_ts=="number"?E.leave_ts-E.enter_ts:-1}),$w(C),{gatewayInfo:Hw(C,s),proxyInfo:w,url:s,resourceTimingInfo:L}},E=>(E.gatewayInfo&&Pt.joinChooseServer(e.sid,{role:h,lts:d,succ:!0,csAddr:s,serverList:E.gatewayInfo.gatewayAddrs.map(I=>I.address),ec:null,opid:m,cid:E.gatewayInfo.cid.toString(),uid:E.gatewayInfo.uid.toString(),csIp:E.gatewayInfo.csIp,unilbsServerIds:l.toString(),isHttp3:r,corssRegionTagReq:e.apRequestDetail,corssRegionTagRes:E.gatewayInfo.res.detail&&E.gatewayInfo.res.detail[38],resourceTimingInfo:E.resourceTimingInfo?JSON.stringify(E.resourceTimingInfo):void 0}),E.proxyInfo&&Pt.joinWebProxyAP(e.sid,{lts:d,sucess:1,apServerAddr:s,turnServerAddrList:E.proxyInfo.addresses.map(I=>I.ip).join(","),errorCode:null,eventType:e.cloudProxyServer,unilbsServerIds:l.toString()}),!1),E=>E.code!==P.OPERATION_ABORTED&&(E.code===P.CAN_NOT_GET_GATEWAY_SERVER?E.data.retry:(Pt.joinWebProxyAP(e.sid,{lts:d,sucess:0,apServerAddr:s,turnServerAddrList:null,errorCode:E.code,eventType:e.cloudProxyServer,unilbsServerIds:l.toString(),extend:JSON.stringify({networkState:_})}),T.warning("[".concat(e.clientId,"] multi unilbs network error, retry"),E),!0)),i)}const VM=(t,e,n,i,r,s)=>{const{sid:c,clientId:l,cloudProxyServer:d}=n,h=[],p=m=>{m.flag===4096?Pt.joinChooseServer(c,{role:n.role,lts:i,succ:!1,csAddr:e,opid:t.opid,serverList:null,ec:m.error.message,csIp:m.error.data&&m.error.data.csIp,unilbsServerIds:r.toString(),isHttp3:s,corssRegionTagReq:n.apRequestDetail}):m.flag!==1048576&&m.flag!==4194304&&m.flag!==4194310||Pt.joinWebProxyAP(c,{lts:i,sucess:0,apServerAddr:e,turnServerAddrList:null,errorCode:m.error.code,eventType:d,unilbsServerIds:r.toString()})};if(t.response_body.forEach(m=>{const _=m.buffer.code;if(m.uri===23&&_===0&&!m.buffer.edges_services)if(m.buffer.flag===4194310)T.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),m.buffer.edges_services=[];else{const E={error:new K(P.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:t.detail[502]}),flag:m.buffer.flag};h.push(E),p(E)}if(_!==0){const E=Am(_),I={error:new K(P.CAN_NOT_GET_GATEWAY_SERVER,E.desc,{desc:E.desc,retry:E.retry,csIp:t.detail[502]}),flag:m.buffer.flag};m.buffer.flag===4194310?T.warning(I.error.toString()):h.push(I),p(I)}}),h.length)throw T.warning("[".concat(l||"sid-".concat(c.slice(0,6)),"] multi unilbs ").concat(e," failed, ").concat(h.map(m=>"flag: ".concat(m.flag,", message: ").concat(m.error.message,", retry: ").concat(m.error.data.retry)).join(" | "))),new K(P.CAN_NOT_GET_GATEWAY_SERVER,h.map(m=>"flag: ".concat(m.flag,", message: ").concat(m.error.message)).join(" | "),{retry:!!h.find(m=>m.error.data.retry),csIp:t.detail[502],desc:[...new Set(h.map(m=>{var _;return m==null||(_=m.error)===null||_===void 0||(_=_.data)===null||_===void 0?void 0:_.desc}).filter(m=>!!m))]})},$w=t=>{var e,n,i,r;if(t.addresses&&t.addresses.length===0&&t.code===0)throw new K(P.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:t.detail&&t.detail[502]});if(k("AP_AREA")&&((i=t.detail)!==null&&i!==void 0&&i[23]&&typeof((r=t.detail)===null||r===void 0?void 0:r[23])=="string"?LM(t.detail[23].toLowerCase()):LM()),(e=t.detail)!==null&&e!==void 0&&e[19]&&typeof((n=t.detail)===null||n===void 0?void 0:n[19])=="string"){const c=t.detail[19],l=c==null?void 0:c.split(";");for(let d=0;d<l.length;d++){var s;const h=dr(s=l[d]).call(s);t.addresses[d]&&l&&(t.addresses[d].fingerprint=h)}}if(k("GATEWAY_ADDRESS")&&k("GATEWAY_ADDRESS").length>0){T.debug("assign gateway address to",k("GATEWAY_ADDRESS"));const c=k("GATEWAY_ADDRESS").map(l=>{var d,h;const p=(d=(h=t.addresses.find(m=>m.ip===l.ip&&m.port===l.port))===null||h===void 0?void 0:h.fingerprint)!==null&&d!==void 0?d:"";return{ip:l.ip,port:l.port,ticket:t.addresses[0]&&t.addresses[0].ticket,fingerprint:p}});t.addresses=c}},T8=(t,e)=>{if(t.response_body&&t.response_body.length){const n=t.response_body[0];if(n.buffer.code!==0){const i=Am(n.buffer.code);throw new K(P.UPDATE_TICKET_FAILED,"[".concat(n.buffer.code,"]: ").concat(i.desc),{retry:i.retry})}return n.buffer.ticket}throw T.debug("update ticket request received ap response without response body:",e),new K(P.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},tI=(t,e,n)=>{const i=Math.floor(Math.random()*1e12),r=t.role==="host"?"1":t.role==="audience"?"2":void 0,s={appid:t.appId,client_ts:Date.now(),opid:i,sid:t.sid,request_bodies:[{uri:22,buffer:{cname:t.cname,detail:bc(bc(bc({6:t.stringUid,11:e,12:k("USE_NEW_TOKEN")?"1":void 0},r?{17:r}:{}),{},{22:e},t.apRequestDetail?{33:t.apRequestDetail}:{}),t.apRTM?{26:"RTM2"}:{}),key:t.token,service_ids:n,uid:t.uid||0}}]};s.request_bodies.forEach(l=>{t.multiIP&&t.multiIP.gateway_ip&&(l.buffer.detail[5]=JSON.stringify({vocs_ip:[t.multiIP.uni_lbs_ip],vos_ip:[t.multiIP.gateway_ip]}))});const c=new FormData;return c.append("request",JSON.stringify(s)),[c,i]},y8=(t,e)=>{const n=Math.floor(Math.random()*1e12),i={appid:t.appId,client_ts:Date.now(),opid:n,sid:t.sid,request_bodies:[{uri:28,buffer:{cname:t.cname,detail:{1:"",6:t.stringUid,12:"1"},token:t.token,service_ids:e,uid:t.uid||0,edges_services:t.apResponse.addresses.map(s=>({ip:s.ip,port:s.port}))}}]},r=new FormData;return r.append("request",JSON.stringify(i)),[r,n]};let Nm=0;function Dm(t){return Tt.all(t.map(e=>e.then(n=>{throw n},n=>n))).then(e=>{throw e},e=>e)}const Xg=async t=>{let{fragementLength:e,referenceList:n,asyncMapHandler:i,allFailedhandler:r,promisesCollector:s}=t,c=0;const l=e;let d,h=0;const p=async()=>{const m=(()=>{const _=c*l,E=_+l;return n.slice(_,E).map(i)})();s&&s.push(...m);try{d=await Dm(m)}catch(_){if(h+=l,c++,!(h>=n.length))return void await p();r(_)}m.forEach(_=>_.cancel())};return await p(),d},jM=async t=>{let{referenceList:e,asyncMapHandler:n,closeFn:i}=t;const r=e.length;let s=0;const c=async()=>{const l=n(e.shift());try{return await l}catch(d){if(s++,s>=r||i!=null&&i(d))throw d;return c()}};return c()};async function R8(){if(typeof VideoDecoder>"u")return!0;let t;const e=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,85,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,149,160,133,4,144,43,122,168,159,120,159,205,39,82,131,57,52,87,187,68,23,248,134,204,226,97,17,49,183,55,236,219,249,221,98,208,215,190,59,179,167,213,47,1,246,150,14,194,245,159,83,35,64,103,218,38,21,82,3,135,21,185,84,248,134],n=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,148,62,134,140,92,172,141,77,35,94,181,164,65,169,65,156,154,43,221,162,11,252,67,102,113,48,136,137,219,62,43,113,239,23,126,250,186,252,10,138,218,25,193,244,74,68,194,209,107,23,52,206,199,78,72,98,103,151,71,96,62,51,210,158,72,231,158],i=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,143,233,163,51,196,98,95,151,224,22,134,33,240,150,248,67,18,34,196,142,81,238,173,140,80,205,232,132,144,67,12,131,157,4,171,243,86,122,35,6,166,184,243,85,126,13,206,103,152,62,168,160,187,2,241,138,52,211,72,121,128,151,63,147,128,19,42],r=[18,0,50,138,1,48,192,64,253,248,65,17,67,192,32,0,16,0,0,0,0,0,0,0,195,12,48,144,64,32,0,209,75,61,9,204,25,115,79,226,115,63,63,208,70,210,220,153,126,241,237,37,107,195,153,1,99,112,230,189,209,169,130,10,11,22,167,215,159,205,197,7,183,162,26,48,254,141,134,103,32,16,235,45,1,15,18,119,169,110,206,251,51,115,202,60,148,1,46,39,109,25,28,86,168,15,77,211,239,2,58,43,146,26,230,184,81,48,140,226,226,250,222,146,171,133,164,13,188,180,64,122,142,146,32,208,238,170,193,35,53,44,225],s=[18,0,50,107,48,0,133,125,248,65,26,195,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,204,24,122,65,56,165,18,52,206,218,4,187,51,97,9,29,191,90,253,106,185,31,197,155,52,205,245,185,203,131,20,226,25,124,95,113,220,113,141,15,15,104,211,144,152,237,150,157,127,51,143,24,231,218,171,255,176,241,128,229,149,150,148,66,245,228,91,27,182,228,136,61,182,237,133,45,220,24,103,214,152],c=[18,0,50,122,48,1,9,253,248,65,26,67,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,198,182,231,242,220,235,163,140,12,36,36,166,46,132,210,4,71,23,218,132,27,30,17,45,244,79,31,243,195,136,100,169,76,88,142,85,204,217,121,168,29,163,198,17,251,223,73,12,212,244,139,123,151,179,75,216,96,208,136,40,229,42,59,149,10,116,228,85,99,93,221,108,255,140,248,20,30,167,122,109,206,164,108,197,110,251,23,243,133,160,63,13,207,177,12,128];return await new Tt((d,h)=>{let p;(async function(){t&&t.state!=="closed"||await async function(){t=new VideoDecoder({output:_=>{_.close(),clearTimeout(p),d(!0)},error:_=>{clearTimeout(p),d(!1)}}),await t.configure({codec:"av01.0.05M.08",width:160,height:90})}();const m=[e,n,i,r,s,c];for(let _=0;_<m.length;_++){const E=new EncodedVideoChunk({type:_==0?"key":"delta",timestamp:33333*_,duration:33333,data:new Uint8Array(m[_])});try{await t.decode(E)}catch{return void d(!1)}}})(),p=setTimeout(()=>{d(!1)},5e3)})}async function eI(t,e,n,i){return{gatewayInfo:await async function(s,c,l,d){let h=null;const p=[],m=async()=>{const E=k("WEBCS_DOMAIN").slice(0,k("AJAX_REQUEST_CONCURRENT")).map(w=>({url:s.proxyServer?"https://".concat(s.proxyServer,"/ap/?url=").concat(w+"/api/v2/transpond/webrtc?v=2"):"https://".concat(w,"/api/v2/transpond/webrtc?v=2"),areaCode:Yg()})),I=d.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:E.map(w=>w.url)}),C=await Xg({fragementLength:k("FRAGEMENT_LENGTH"),referenceList:E,asyncMapHandler:w=>(T.debug("[".concat(s.clientId,"] Connect to choose_server:"),w.url),MM(w,s,c,l)),allFailedhandler:w=>{throw d.recordJoinChannelService({endTs:Date.now(),status:"error",errors:w},I),w[0]},promisesCollector:p});return d.recordJoinChannelService({endTs:Date.now(),status:"success"},I),C},_=async()=>{if(await yi(1e3),h!==null)return h;const E=k("WEBCS_DOMAIN_BACKUP_LIST").map(w=>({url:s.proxyServer?"https://".concat(s.proxyServer,"/ap/?url=").concat(w+"/api/v2/transpond/webrtc?v=2"):"https://".concat(w,"/api/v2/transpond/webrtc?v=2"),areaCode:Yg()})),I=d.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:E.map(w=>w.url)}),C=await Xg({fragementLength:k("FRAGEMENT_LENGTH"),referenceList:E,asyncMapHandler:w=>(T.debug("[".concat(s.clientId,"] Connect to backup choose_server:"),w.url),MM(w,s,c,l)),allFailedhandler:w=>{throw d.recordJoinChannelService({endTs:Date.now(),status:"error",errors:w},I),w[0]},promisesCollector:p});return d.recordJoinChannelService({endTs:Date.now(),status:"success"},I),C};try{return h=await Dm([m(),_()]),p.length&&p.forEach(E=>E.cancel&&typeof E.cancel=="function"&&E.cancel()),h}catch(E){throw E[0]}}(t,e,n,i)}}async function BM(t,e,n,i,r){const s=t.cloudProxyServer;if(s==="disabled"){if(t.useLocalAccessPoint)return await eI(t,e,n,r);if(k("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:_,proxyInfo:E}=await HM(t,e,n,r);if(t.turnServer&&t.turnServer.mode!=="auto")return{gatewayInfo:_};const I=E.map(C=>({turnServerURL:C.address,tcpport:C.tcpport||Li.tcpport,udpport:C.udpport||Li.udpport,username:C.username||Li.username,password:C.password||Li.password,forceturn:!1,security:!0}));if(r.useP2P){var c;const C=(c=t.uid)!==null&&c!==void 0?c:_.uid,w="glb:".concat(C.toString()),D=await WA(w),N=E.map(L=>({turnServerURL:L.address,tcpport:L.tcpport||Li.tcpport,udpport:L.udpport||Li.udpport,username:w,password:D,forceturn:!1,security:!0}));I.push(...N)}return t.turnServer={mode:"manual",servers:I},{gatewayInfo:_}}return await eI(t,e,n,r)}const{proxyInfo:l,gatewayInfo:d}=await HM(t,e,n,r),h={gatewayInfo:d},p=l.map(_=>({turnServerURL:_.address,tcpport:s==="proxy3"?void 0:_.tcpport?_.tcpport:Li.tcpport,udpport:s==="proxy4"?void 0:_.udpport?_.udpport:Li.udpport,username:_.username||Li.username,password:_.password||Li.password,forceturn:s!=="proxy4",security:s==="proxy5"}));if(r.useP2P){var m;const _=(m=t.uid)!==null&&m!==void 0?m:d.uid,E="glb:".concat(_.toString()),I=await WA(E),C=l.map(w=>({turnServerURL:w.address,tcpport:s==="proxy3"?void 0:w.tcpport||Li.tcpport,udpport:s==="proxy4"?void 0:w.udpport||Li.udpport,username:E,password:I,forceturn:s!=="proxy4",security:s==="proxy5"}));p.push(...C)}return t.turnServer={mode:"manual",servers:p},T.debug("[".concat(t.clientId,"] set proxy server: ").concat(t.proxyServer,", mode: ").concat(s)),h}async function FM(t,e,n,i,r){const s=k("ACCOUNT_REGISTER").slice(0,k("AJAX_REQUEST_CONCURRENT"));let c=[];c=e.proxyServer?s.map(d=>"https://".concat(e.proxyServer,"/ap/?url=").concat(d+"/api/v1")):s.map(d=>"https://".concat(d,"/api/v1"));const l=r==null?void 0:r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:c});try{const d=await async function(h,p,m,_,E){const I=Date.now(),C={sid:m.sid,opid:10,appid:m.appId,string_uid:p};let w=h[0];const D=await Ro(()=>Io(w+"".concat(w.indexOf("?")===-1?"?":"&","action=stringuid"),{data:C,cancelToken:_,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(N,L)=>{if(N.code===0){if(N.uid<=0||N.uid>=Math.pow(2,32))throw T.error("Invalid Uint Uid ".concat(p," => ").concat(N.uid),N),Pt.reqUserAccount(C.sid,{lts:I,success:!1,serverAddr:w,stringUid:C.string_uid,uid:N.uid,errorCode:P.INVALID_UINT_UID_FROM_STRING_UID,extend:C}),new K(P.INVALID_UINT_UID_FROM_STRING_UID);return Pt.reqUserAccount(C.sid,{lts:I,success:!0,serverAddr:w,stringUid:C.string_uid,uid:N.uid,errorCode:null,extend:C}),!1}const W=Am(N.code);return W.retry&&(w=h[(L+1)%h.length]),Pt.reqUserAccount(C.sid,{lts:I,success:!1,serverAddr:w,stringUid:C.string_uid,uid:N.uid,errorCode:W.desc,extend:C}),W.retry},(N,L)=>N.code!==P.OPERATION_ABORTED&&(Pt.reqUserAccount(C.sid,{lts:I,success:!1,serverAddr:w,stringUid:C.string_uid,uid:null,errorCode:N.code,extend:C}),w=h[(L+1)%h.length],!0),E);if(D.code!==0){const N=Am(D.code);throw new K(P.UNEXPECTED_RESPONSE,N.desc)}return D}(c,t,e,n,i);return r==null||r.recordJoinChannelService({status:"success",endTs:Date.now()},l),d.uid}catch(d){throw r==null||r.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[d]},l),d}}async function b8(t,e,n){const i=k("ACCOUNT_REGISTER");let r=[];r=e.proxyServer?i.map(s=>"https://".concat(e.proxyServer,"/ap/?url=").concat(s+"/api/v1")):i.map(s=>"https://".concat(s,"/api/v1"));try{return await jM({referenceList:r,asyncMapHandler:c=>async function(l,d,h,p){const m=Date.now(),_={sid:h.sid,opid:10,appid:h.appId,string_uid:d};try{const E=await Io(l+"".concat(l.indexOf("?")===-1?"?":"&","action=stringuid"),{data:_,cancelToken:p,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(E.code!==0){const I=Am(E.code);throw new K(P.UNEXPECTED_RESPONSE,"preload sua error:".concat(I.desc),I)}if(E.uid<=0||E.uid>=Math.pow(2,32))throw new K(P.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:m,url:l,req:_,uid:E.uid,elapse:Date.now()-m}}catch(E){throw E}}(c,t,e,n),closeFn:c=>c.code===P.OPERATION_ABORTED||c.code===P.UNEXPECTED_RESPONSE&&!c.data.retry})}catch(s){throw s}}async function C8(t,e,n){const i=k("CDS_AP").slice(0,k("AJAX_REQUEST_CONCURRENT")).map(d=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(d+"/api/v1"):"https://".concat(d,"/api/v1?action=config")),r=i.map(d=>function(h,p,m,_){const E=ve(),I={flag:64,cipher_method:0,features:bc(bc(bc(bc(bc({install_id:ew(),device:E.name,system:E.os,system_general:navigator.userAgent,vendor:p.appId,version:$a,cname:p.cname,session_id:p.sid,proxyServer:p.proxyServer,sdk_type:m8.WEB_RTC,browser_name:E.name,browser_version:E.version,user_agent:navigator.userAgent,channel_name:p.cname},p.stringUid&&{string_uid:p.stringUid}),p.uid&&{uid:p.uid+""}),E.os&&{os_name:E.os}),E.osVersion&&{os_version:E.osVersion}),{},{detail:""})};return Ro(()=>Io(h,{data:I,timeout:1e3,cancelToken:m,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,C=>C.code!==P.OPERATION_ABORTED,_)}(d,t,e,n));let s=null,c=null,l={};try{s=await Dm(r)}catch(d){if(d.code===P.OPERATION_ABORTED)throw d;c=d}if(r.forEach(d=>d.cancel()),Pt.reportApiInvoke(t.sid,{name:kn.REQUEST_CONFIG_DISTRIBUTE,options:{error:c,res:s}}).onSuccess(),s&&s.test_tags)try{l=function(d){if(!d.test_tags)return{};const h=d.test_tags,p=Object.keys(h),m={};return p.forEach(_=>{var E;const I=dr(E=_.slice(4)).call(E),C=JSON.parse(h[_]),w=C[1];m[I]={tag:C[0]||"",value:w}}),m}(s)}catch{}return l}async function GM(t,e){const n=k("WEBCS_DOMAIN").concat(k("WEBCS_DOMAIN_BACKUP_LIST")).map(i=>({url:"https://".concat(i,"/api/v2/transpond/webrtc?v=2"),areaCode:Yg(),serviceIds:[zn.CHOOSE_SERVER,zn.CLOUD_PROXY_FALLBACK]}));try{return await jM({referenceList:n,asyncMapHandler:r=>async function(s,c,l){let d,{url:h,areaCode:p,serviceIds:m}=s;const _=Date.now(),[E,I]=tI(c,p,m);let C=Wn.networkState;try{C&&Wn.networkState===la.OFFLINE&&Wn.onlineWaiter&&await Tt.race([Wn.onlineWaiter,yi(Xn.maxRetryTimeout)]),C=Wn.networkState;const{data:w,headers:D}=await Io(h,{data:E,cancelToken:l,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);d=D.http3==="1"?1:-1,(G=>{const U=[];if(G.response_body.forEach(z=>{const $=z.buffer.code;if(z.uri===23&&$===0&&!z.buffer.edges_services)if(z.buffer.flag===4194310)z.buffer.edges_services=[];else{const rt={error:new K(P.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:G.detail[502]}),flag:z.buffer.flag};U.push(rt)}if($!==0){const rt=Am($),dt={error:new K(P.CAN_NOT_GET_GATEWAY_SERVER,rt.desc,{desc:rt.desc,retry:rt.retry,csIp:G.detail[502]}),flag:z.buffer.flag};z.buffer.flag===4194310?T.warning(dt.error.toString()):U.push(dt)}}),U.length)throw new K(P.CAN_NOT_GET_GATEWAY_SERVER,U.map(z=>"flag: ".concat(z.flag,", message: ").concat(z.error.message)).join(" | "),{retry:!!U.find(z=>z.error.data.retry),csIp:G.detail[502],desc:[...new Set(U.map(z=>{var $;return z==null||($=z.error)===null||$===void 0||($=$.data)===null||$===void 0?void 0:$.desc}).filter(z=>!!z))]})})(w);const L=Wg(w,zn.CHOOSE_SERVER),W=Wg(w,zn.CLOUD_PROXY_FALLBACK);return $w(L),{gatewayInfo:Hw(L,h),proxyInfo:W,opid:I,requestTime:_,url:h,isHttp3:d,elapse:Date.now()-_}}catch(w){throw w}}(r,t,e),closeFn:r=>r.code===P.OPERATION_ABORTED||r.code===P.CAN_NOT_GET_GATEWAY_SERVER&&!r.data.retry})}catch(i){throw i}}async function HM(t,e,n,i){const r=k("PROXY_SERVER_TYPE3"),s=(E,I,C)=>{let w=C||r;return Array.isArray(w)&&(w=I%2==0&&r[1]||r[0]),"https://".concat(w,"/ap/?url=").concat(E)};let c=null;const l=[],d=async()=>{const E=k("WEBCS_DOMAIN").slice(0,k("AJAX_REQUEST_CONCURRENT")).map((w,D)=>{let N;return N=t.cloudProxyServer==="disabled"&&t.proxyServer?s("".concat(w,"/api/v2/transpond/webrtc?v=2"),D,t.proxyServer):t.cloudProxyServer==="disabled"||t.cloudProxyServer==="fallback"?"https://".concat(w,"/api/v2/transpond/webrtc?v=2"):s("".concat(w,"/api/v2/transpond/webrtc?v=2"),D),{url:N,areaCode:Yg(),serviceIds:[zn.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?zn.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?zn.CLOUD_PROXY:zn.CLOUD_PROXY_FALLBACK]}}),I=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:E.map(w=>w.url)}),C=await Xg({fragementLength:k("FRAGEMENT_LENGTH"),referenceList:E,asyncMapHandler:w=>(T.debug("[".concat(t.clientId,"] Connect to choose_server:"),w.url),UM(w,t,e,n)),allFailedhandler:w=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:w},I),w[0]},promisesCollector:l});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},I),C},h=async()=>{if(await yi(1e3),c!==null)return c;const E=k("WEBCS_DOMAIN_BACKUP_LIST").map((w,D)=>{let N;return N=t.cloudProxyServer==="disabled"&&t.proxyServer?s("".concat(w,"/api/v2/transpond/webrtc?v=2"),D,t.proxyServer):t.cloudProxyServer==="disabled"||t.cloudProxyServer==="fallback"?"https://".concat(w,"/api/v2/transpond/webrtc?v=2"):s("".concat(w,"/api/v2/transpond/webrtc?v=2"),D),{url:N,areaCode:Yg(),serviceIds:[zn.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?zn.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?zn.CLOUD_PROXY:zn.CLOUD_PROXY_FALLBACK]}}),I=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:E.map(w=>w.url)}),C=await Xg({fragementLength:k("FRAGEMENT_LENGTH"),referenceList:E,asyncMapHandler:w=>(T.debug("[".concat(t.clientId,"] Connect to backup choose_server:"),w.url),UM(w,t,e,n)),allFailedhandler:w=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:w},I),w[0]},promisesCollector:l});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},I),C};let p,m,_;try{({gatewayInfo:p,proxyInfo:m,url:_}=await Dm([d(),h()]))}catch(E){throw E[0]}if(l.length&&l.forEach(E=>E.cancel&&typeof E.cancel=="function"&&E.cancel()),!p||!m)throw new K(P.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(t.apUrl=_,t.cloudProxyServer!=="disabled"&&Array.isArray(r)&&_){const E=/^https?:\/\/(.+?)(\/.*)?$/.exec(_)[1];mt(r).call(r,E)&&(t.proxyServer=E,T.setProxyServer(E),Pt.setProxyServer(E))}return c={gatewayInfo:p,proxyInfo:await pM(m,p.uid)},c}async function A8(t,e,n){const i=k("UAP_AP").slice(0,k("AJAX_REQUEST_CONCURRENT")).map(s=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(s+"/api/v1?action=uap"):"https://".concat(s,"/api/v1?action=uap")),r=i.map(s=>function(c,l,d,h){const p={command:"convergeAllocateEdge",sid:l.sid,appId:l.appId,token:l.token,ts:Date.now(),version:$a,cname:l.cname,uid:l.uid.toString(),requestId:Zw,seq:Zw};Zw+=1;const m={service_name:"tele_channel",json_body:JSON.stringify(p)};return Ro(async()=>{const _=await Io(c,{data:m,cancelToken:d,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(_.code!==0){const I=new K(P.UNEXPECTED_RESPONSE,"cross channel ap error, code"+_.code,{retry:!0});throw T.error(I.toString()),I}const E=JSON.parse(_.json_body);if(E.code!==200){const I=new K(P.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(E.code,", reason: ").concat(E.reason));throw T.error(I.toString()),I}if(!E.servers||E.servers.length===0){const I=new K(P.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw T.error(I.toString()),I}return{vid:E.vid,workerToken:E.workerToken,addressList:(k("CHANNEL_MEDIA_RELAY_SERVERS")||E.servers).map(I=>"wss://".concat(I.address.replace(/\./g,"-"),".").concat(k("WORKER_DOMAIN"),":").concat(I.wss))}},void 0,_=>!!(_.code!==P.OPERATION_ABORTED&&_.code!==P.UNEXPECTED_RESPONSE||_.data&&_.data.retry),h)}(s,t,e,n));try{const s=await Dm(r);return r.forEach(c=>c.cancel()),s}catch(s){throw s[0]}}async function w8(t,e,n){let i=null;const r=[],s=async c=>{const l=k(c?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(d=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(d+"/api/v2/transpond/webrtc?v=2"):"https://".concat(d,"/api/v2/transpond/webrtc?v=2"));return c&&(await yi(1e3),i!==null)?i:await Xg({fragementLength:k("FRAGEMENT_LENGTH"),referenceList:l,asyncMapHandler:d=>(T.debug("[".concat(t.clientId,"] update ticket, Connect to ").concat(c?"backup":""," choose_server:"),d),function(h,p,m,_){const[E]=y8(p,[zn.CHOOSE_SERVER]);let I=Wn.networkState;return Ro(async()=>{I&&Wn.networkState===la.OFFLINE&&Wn.onlineWaiter&&await Tt.race([Wn.onlineWaiter,yi(_&&_.maxRetryTimeout||Xn.maxRetryTimeout)]),I=Wn.networkState;const C=await Io(h,{data:E,cancelToken:m,headers:{"Content-Type":"multipart/form-data;"}},!0);return T8(C,h)},()=>!1,C=>C.code!==P.OPERATION_ABORTED&&(C.code===P.UPDATE_TICKET_FAILED?C.data.retry:(T.warning("[".concat(p.clientId,"] update ticket network error, retry"),C),!0)),_)}(d,t,e,n)),allFailedhandler:d=>{throw d[0]},promisesCollector:r})};try{return i=await Dm([s(!1),s(!0)]),r.length&&r.forEach(c=>c.cancel&&typeof c.cancel=="function"&&c.cancel()),i}catch(c){throw c[0]}}function WM(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function nI(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?WM(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):WM(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}class I8 extends Sn{get isSuccess(){return!!this.configs}constructor(e,n){super(),O(this,"configs",void 0),O(this,"store",void 0),O(this,"joinInfo",void 0),O(this,"cancelToken",void 0),O(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),O(this,"interval",void 0),O(this,"mutex",void 0),O(this,"mutableParamsRead",!1),O(this,"configCache",{}),O(this,"limit_bitrate",void 0),this.mutex=new Wi("config-distribute",e),this.store=n}startGetConfigDistribute(e,n){this.joinInfo=e,this.cancelToken=n,this.interval&&this.stopGetConfigDistribute(),k("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},k("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,Pt.reportApiInvoke(null,{options:void 0,name:kn.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:_n.TRACER}).onSuccess(JSON.stringify(bo))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void T.debug("[config-distribute] get config distribute interrupted have no joininfo");let e;const n=await this.mutex.lock();try{e=await C8(this.joinInfo,this.cancelToken,this.retryConfig),T.debug("[config-distribute] get config distribute",JSON.stringify(e));const i=function(r){var s;const c=Zt(s=Object.keys(r).filter(h=>/^webrtc_ng_global_parameter/.test(h))).call(s);for(let h=0;h<c.length;h++)for(let p=c.length-1;p>h;p--){const m=c[p],_=r[m].value;if(typeof _.__priority=="number"){const E=_.__priority,I=c[p-1],C=r[I].value;if(typeof C.__priority=="number"){if(!(E>C.__priority))continue;{const w=m;c[p]=c[p-1],c[p-1]=w}}else{const w=m;c[p]=c[p-1],c[p-1]=w}}}const l=Date.now();let d={};return c.forEach(h=>{const p=r[h].value.__expires;p&&p<=l||(d[h]=r[h])}),d}(e);this.cacheGlobalParameterConfig(i),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=i}catch(i){const r=new K(P.NETWORK_RESPONSE_ERROR,i);T.warning("[config-distribute] ".concat(r.toString()))}finally{n()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(e){nM(e)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==e.id&&this.emit(Fg.UPDATE_BITRATE_LIMIT,e):this.emit(Fg.UPDATE_BITRATE_LIMIT,e))}getLowStreamConfigDistribute(){return this.limit_bitrate&&nI({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(e){try{const n={},i=Object.keys(e),r=[];i.forEach(s=>{const c=e[s].value;n[s]=c;const l=c.__id;if(l&&this.configCache[s]&&this.configCache[s].__id===l)return;const d=c.__type,h=e[s].value,p=e[s].tag;let m=0;d?d===AL.REALTIME&&(m=1):Object.keys(h).some(_=>Object.prototype.hasOwnProperty.call(aw,_)||!Pw()&&Object.prototype.hasOwnProperty.call(lR,_)?(m=1,!0):void 0),r.push({tag:p,isApplied:m,feature:s,params:JSON.stringify(c)})}),r.forEach(s=>{let{tag:c,feature:l,params:d,isApplied:h}=s;this.store.sessionId&&Pt.abTest(this.store.sessionId,{intSucc:1,isApplied:h,tag:c,feature:l,params:d,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=n}catch(n){T.debug("handleABTestConfigDistribute error",n)}}cacheGlobalParameterConfig(e){const n=function(r){const s={};return Object.keys(r).forEach(c=>{const l=r[c].value,d=l.__expires,h=l.__type;Object.keys(l).forEach(p=>{p==="__id"||p==="__type"||p==="__priority"||p==="__expires"||Object.prototype.hasOwnProperty.call(s,p)||(s[p]=nI(nI({value:l[p]},d&&{expires:d}),h&&{type:h}))})}),s}(e);try{var i;const r=(i=n.LIMIT_BITRATE)===null||i===void 0?void 0:i.value;delete n.LIMIT_BITRATE,r&&nM(r)&&this.handleBitrateLimit(r),this.limit_bitrate=r,this.handleGlobalParameterConfig(n),this.handleABTestConfigDistribute(e),function(l){try{const d=Date.now();Object.keys(l).forEach(h=>{const{value:p,type:m,expires:_}=l[h];_&&_<=d||((m===AL.REALTIME||Object.prototype.hasOwnProperty.call(aw,h))&&(bo[h]=p,hn[h]=p,T.debug("Update realtime parameters from config distribute",h,p)),m||Pw()||!Object.prototype.hasOwnProperty.call(lR,h)||(bo[h]=p,hn[h]=p,T.debug("Update gateway parameters from config distribute",h,p)))})}catch(d){T.error("Error update config immediately: ".concat(l),d.message)}}(n);const s=JSON.stringify(n),c=window.btoa(s);window.localStorage.setItem("websdk_ng_global_parameter",c),T.debug("Caching global parameters ".concat(s))}catch(r){T.error("Error caching global parameters:",r.message)}}handleGlobalParameterConfig(e){try{const n=Date.now();Object.keys(e).forEach(i=>{if(i==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(hn,i)){const{value:r,expires:s}=e[i];if(s&&s<=n)return;(function(c,l){try{return typeof c=="object"&&typeof l=="object"&&JSON.stringify(c)===JSON.stringify(l)}catch{return!1}})(hn[i],r)||(bo[i]=r,hn[i]=r,this.emit(Fg.UPDATE_CLIENT_ROLE_OPTIONS,r),T.debug("Updating client role options: ".concat(JSON.stringify(r))))}})}catch(n){T.error("Error handling global parameter config:",n.message)}}}class O8 extends Sn{constructor(){super(...arguments),O(this,"resultStorage",new Map)}setLocalAudioStats(e,n,i){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",e,this.checkAudioInputLevel(i,n)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",e,this.checkSendAudioBitrate(i,n))}setLocalVideoStats(e,n,i){this.record("SEND_VIDEO_BITRATE_TOO_LOW",e,this.checkSendVideoBitrate(i,n)),this.record("FRAMERATE_INPUT_TOO_LOW",e,this.checkFramerateInput(i,n)),this.record("FRAMERATE_SENT_TOO_LOW",e,this.checkFramerateSent(i)),!n.muted&&this.record("VIDEO_ENCODE_FAILED",e,this.checResolutionSent(i))}setRemoteAudioStats(e,n){const i=e.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",i,this.checkAudioOutputLevel(n))}setRemoteVideoStats(e,n){const i=e.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",i,this.checkVideoDecode(n))}record(e,n,i){if(k("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(e)||this.resultStorage.set(e,{result:[],isPrevNormal:!0});const r=this.resultStorage.get(e);if(!r)return;r.result.push(i);const s=e==="VIDEO_ENCODE_FAILED"?k("ENCODE_EXCEPTION_TIMES"):5;if(r.result.length>=s){var c;const l=mt(c=r.result).call(c,!0);r.isPrevNormal&&!l&&this.emit("exception",iI[e],e,n),!r.isPrevNormal&&l&&this.emit("exception",iI[e]+2e3,e+"_RECOVER",n),r.isPrevNormal=l,r.result=[]}}checkAudioOutputLevel(e){return!(e.receiveBitrate>0&&e.receiveLevel===0)}checkAudioInputLevel(e,n){return n instanceof $n&&!n.isActive||!!n.muted||e.sendVolumeLevel!==0}checkFramerateInput(e,n){let i=null;n._encoderConfig&&n._encoderConfig.frameRate&&(i=da(n._encoderConfig.frameRate));const r=e.captureFrameRate;return!i||!r||!(i>10&&r<5||i<10&&i>=5&&r<=1)}checkFramerateSent(e){return!(e.captureFrameRate&&e.sendFrameRate&&e.captureFrameRate>5&&e.sendFrameRate<=1)}checResolutionSent(e){var n;return!(!e.codecType||mt(n=k("ENCODE_EXCEPTION_VALIDATE_CODEC")).call(n,e.codecType.toLocaleLowerCase()))||!e.captureFrameRate||e.sendFrameRate!==0||e.sendResolutionWidth!==0||e.sendResolutionHeight!==0}checkSendVideoBitrate(e,n){return!!n.muted||e.sendBitrate!==0}checkSendAudioBitrate(e,n){return n instanceof $n&&!n.isActive||!!n.muted||e.sendBitrate!==0}checkVideoDecode(e){return e.receiveBitrate===0||e.decodeFrameRate!==0}}const iI={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003,VIDEO_ENCODE_FAILED:2004},Yi=new class{markSubscribeStart(t,e){performance.mark("agora-web-sdk/".concat(t,"/subscribe-").concat(e))}markPublishStart(t,e){performance.mark("agora-web-sdk/".concat(t,"/publish-").concat(e))}measureFromSubscribeStart(t,e){const n=performance.getEntriesByName("agora-web-sdk/".concat(t,"/subscribe-").concat(e));if(n.length>0){const i=n[n.length-1];return Math.round(performance.now()-i.startTime)}return 0}measureFromPublishStart(t,e){const n=performance.getEntriesByName("agora-web-sdk/".concat(t,"/publish-").concat(e));if(n.length>0){const i=n[n.length-1];return Math.round(performance.now()-i.startTime)}return 0}};function zM(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Wh(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?zM(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):zM(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}class Qg{constructor(e){O(this,"store",void 0),O(this,"onStatsException",void 0),O(this,"onUploadPublishDuration",void 0),O(this,"onStatsChanged",void 0),O(this,"onVideoCodecChanged",void 0),O(this,"localStats",new Map),O(this,"remoteStats",new Map),O(this,"updateStatsInterval",void 0),O(this,"trafficStats",void 0),O(this,"trafficStatsPeerList",[]),O(this,"uplinkStats",void 0),O(this,"exceptionMonitor",void 0),O(this,"p2pChannel",void 0),O(this,"scalabilityMode",cR.L1T1),O(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=e,this.exceptionMonitor=new O8,this.exceptionMonitor.on("exception",(n,i,r)=>{this.onStatsException&&this.onStatsException(n,i,r)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(ot.LocalAudioTrack)||Wh({},uw)}getLocalVideoTrackStats(){return this.localStats.get(ot.LocalVideoTrack)||Wh({},hw)}getRemoteAudioTrackStats(e){const n=(s,c)=>{if(!this.trafficStats)return c;const l=this.trafficStats.peer_delay.find(d=>d.peer_uid===s);return l&&(c.publishDuration=l.B_ppad+(Date.now()-this.trafficStats.timestamp)),c},i={};if(e){var r;const s=(r=this.remoteStats.get(e))===null||r===void 0?void 0:r.audioStats;s&&(i[e]=n(e,s))}else Array.from(this.remoteStats.entries()).forEach(s=>{let[c,{audioStats:l}]=s;l&&(i[c]=n(c,l))});return i}getRemoteNetworkQualityStats(e){const n={};if(e){var i;const r=(i=this.remoteStats.get(e))===null||i===void 0?void 0:i.networkStats;r&&(n[e]=r)}else Array.from(this.remoteStats.entries()).forEach(r=>{let[s,{networkStats:c}]=r;c&&(n[s]=c)});return n}getRemoteVideoTrackStats(e){const n=(s,c)=>{if(!this.trafficStats)return c;const l=this.trafficStats.peer_delay.find(d=>d.peer_uid===s);return l&&(c.publishDuration=l.B_ppvd+(Date.now()-this.trafficStats.timestamp)),c},i={};if(e){var r;const s=(r=this.remoteStats.get(e))===null||r===void 0?void 0:r.videoStats;s&&(i[e]=n(e,s))}else Array.from(this.remoteStats.entries()).forEach(s=>{let[c,{videoStats:l}]=s;l&&(i[c]=n(c,l))});return i}getRTCStats(){let e=0,n=0,i=0,r=0;const s=this.localStats.get(ot.LocalAudioTrack);s&&(e+=s.sendBytes,n+=s.sendBitrate);const c=this.localStats.get(ot.LocalVideoTrack);c&&(e+=c.sendBytes,n+=c.sendBitrate);const l=this.localStats.get(ot.LocalVideoLowTrack);l&&(e+=l.sendBytes,n+=l.sendBitrate),this.remoteStats.forEach(h=>{let{audioStats:p,videoStats:m}=h;p&&(i+=p.receiveBytes,r+=p.receiveBitrate),m&&(i+=m.receiveBytes,r+=m.receiveBitrate)});let d=1;return this.trafficStats&&(d+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:d,SendBitrate:n,SendBytes:e,RecvBytes:i,RecvBitrate:r,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(e){this.localStats.set(e,void 0)}removeLocalStats(e){e?this.localStats.delete(e):this.localStats.clear()}addRemoteStats(e){this.remoteStats.set(e,{})}removeRemoteStats(e){e?this.remoteStats.delete(e):this.remoteStats.clear()}addP2PChannel(e){this.p2pChannel=e}updateTrafficStats(e){e.peer_delay=e.peer_delay.filter(n=>n.B_ppad!==void 0||n.B_ppvd!==void 0),e.peer_delay.filter(n=>this.trafficStatsPeerList.indexOf(n.peer_uid)===-1).forEach(n=>{var i;const r=(i=this.p2pChannel)===null||i===void 0?void 0:i.getRemoteMedia(n.peer_uid),s=r!=null&&r.videoSSRC?Yi.measureFromSubscribeStart(this.store.clientId,r.videoSSRC):0,c=r!=null&&r.audioSSRC?Yi.measureFromSubscribeStart(this.store.clientId,r.audioSSRC):0;n.B_ppad!==void 0&&n.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(n.peer_uid,n.B_ppad,n.B_ppvd,s>c?s:c),this.trafficStatsPeerList.push(n.peer_uid))}),this.trafficStats=e}updateUplinkStats(e){this.uplinkStats&&this.uplinkStats.B_fir!==e.B_fir&&T.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(e.B_fir)),this.uplinkStats=e}static isRemoteVideoFreeze(e,n,i){if(!e)return!1;const r=!!i&&n.framesDecodeFreezeTime>i.framesDecodeFreezeTime,s=!i||n.framesDecodeCount>i.framesDecodeCount;return r||!s}static isRemoteAudioFreeze(e){return!!e&&e._isFreeze()}isLocalVideoFreeze(e){return!(!e.inputFrame||!e.sentFrame)&&e.inputFrame.frameRate>5&&e.sentFrame.frameRate<3}updateLocalStats(e){Array.from(this.localStats.entries()).forEach(n=>{let[i,r]=n;switch(i){case ot.LocalVideoTrack:case ot.LocalVideoLowTrack:{const l=r,d=Wh({},hw),h=e.getStats(),p=e.getLocalMedia(i);if(h){const m=h.videoSend.find(_=>_.ssrc===(p==null?void 0:p.ssrcs[0].ssrcId));if(m){const _=e.getLocalVideoSize(),E=e.getEncoderConfig(ot.LocalVideoTrack);var s;(m.codec==="H264"||m.codec==="H265"||m.codec==="VP8"||m.codec==="VP9"||m.codec==="AV1X"||m.codec==="AV1")&&(d.codecType=m.codec,(l==null?void 0:l.codecType)!==m.codec&&((s=this.onVideoCodecChanged)===null||s===void 0||s.call(this,m.codec.toLocaleLowerCase()))),d.sendBytes=m.bytes,d.sendBitrate=l?8*Math.max(0,d.sendBytes-l.sendBytes):0,m.inputFrame?(d.captureFrameRate=m.inputFrame.frameRate,d.captureResolutionHeight=m.inputFrame.height,d.captureResolutionWidth=m.inputFrame.width):_&&(d.captureResolutionWidth=_.width,d.captureResolutionHeight=_.height),m.sentFrame?(d.sendFrameRate=m.sentFrame.frameRate,d.sendResolutionHeight=m.sentFrame.height,d.sendResolutionWidth=m.sentFrame.width):_&&(d.sendResolutionWidth=_.width,d.sendResolutionHeight=_.height),m.avgEncodeMs&&(d.encodeDelay=m.avgEncodeMs),E&&E.bitrateMax?d.targetSendBitrate=1e3*E.bitrateMax:m.targetBitrate&&(d.targetSendBitrate=m.targetBitrate),d.sendPackets=m.packets,d.sendPacketsLost=m.packetsLost,d.sendJitterMs=m.jitterMs,d.sendRttMs=m.rttMs,d.totalDuration=l?l.totalDuration+1:1,d.totalFreezeTime=l?l.totalFreezeTime:0,this.isLocalVideoFreeze(m)&&(d.totalFreezeTime+=1),m.scalabilityMode&&this.scalabilityMode!==m.scalabilityMode&&(T.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(m.scalabilityMode)),this.scalabilityMode=m.scalabilityMode)}this.trafficStats&&(d.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var c;this.localStats.set(i,d),((l==null?void 0:l.sendResolutionWidth)!==d.sendResolutionWidth||(l==null?void 0:l.sendResolutionHeight)!==d.sendResolutionHeight)&&((c=this.onStatsChanged)===null||c===void 0||c.call(this,"resolution",{width:d.sendResolutionWidth,height:d.sendResolutionHeight})),d&&p&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,p.track,d);break}case ot.LocalAudioTrack:{const l=r,d=Wh({},uw),h=e.getStats(),p=e.getLocalMedia(i);if(h){const m=h.audioSend.find(_=>_.ssrc===(p==null?void 0:p.ssrcs[0].ssrcId));if(m){if(m.codec!=="opus"&&m.codec!=="aac"&&m.codec!=="PCMU"&&m.codec!=="PCMA"&&m.codec!=="G722"||(d.codecType=m.codec),m.inputLevel)d.sendVolumeLevel=Math.round(32767*m.inputLevel);else{const _=e.getLocalAudioVolume();_&&(d.sendVolumeLevel=Math.round(32767*_))}d.sendBytes=m.bytes,d.sendPackets=m.packets,d.sendPacketsLost=m.packetsLost,d.sendJitterMs=m.jitterMs,d.sendRttMs=m.rttMs,d.sendBitrate=l?8*Math.max(0,d.sendBytes-l.sendBytes):0}}this.trafficStats&&(d.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(ot.LocalAudioTrack,d),d&&p&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,p.track,d);break}}})}updateRemoteStats(e){Array.from(this.remoteStats.entries()).forEach(n=>{var i,r;let[s,{videoStats:c,audioStats:l,videoPcStats:d}]=n;const h=l,p=c,m=d,_=Wh({},UL),E=Wh({},VL),I=Wh({},hG),{audioTrack:C,videoTrack:w,audioSSRC:D,videoSSRC:N}=e.getRemoteMedia(s);let L;L=this.store.useP2P?e.getStats(!0):e.getStats();const W=(i=L)===null||i===void 0?void 0:i.audioRecv.find($=>$.ssrc===D),G=(r=L)===null||r===void 0?void 0:r.videoRecv.find($=>$.ssrc===N),U=this.trafficStats&&this.trafficStats.peer_delay.find($=>$.peer_uid===s);if(W&&(W.codec!=="opus"&&W.codec!=="aac"&&W.codec!=="PCMU"&&W.codec!=="PCMA"&&W.codec!=="G722"||(_.codecType=W.codec),W.outputLevel?_.receiveLevel=Math.round(32767*W.outputLevel):C&&(_.receiveLevel=Math.round(32767*C.getVolumeLevel())),_.receiveBytes=W.bytes,_.receivePackets=W.packets,_.receivePacketsLost=W.packetsLost,_.receivePacketsDiscarded=W.packetsDiscarded,_.packetLossRate=_.receivePacketsLost/(_.receivePackets+_.receivePacketsLost),_.receiveBitrate=h?8*Math.max(0,_.receiveBytes-h.receiveBytes):0,_.totalDuration=h?h.totalDuration+1:1,_.totalFreezeTime=h?h.totalFreezeTime:0,_.freezeRate=_.totalFreezeTime/_.totalDuration,_.receiveDelay=W.jitterBufferMs,_.totalDuration>10&&Qg.isRemoteAudioFreeze(C)&&(_.totalFreezeTime+=1)),G){var z;G.codec!=="H264"&&G.codec!=="H265"&&G.codec!=="VP8"&&G.codec!=="VP9"&&G.codec!=="AV1X"&&G.codec!=="AV1"||(E.codecType=G.codec),E.receiveBytes=G.bytes,E.receiveBitrate=p?8*Math.max(0,E.receiveBytes-p.receiveBytes):0,E.decodeFrameRate=G.decodeFrameRate<0?0:G.decodeFrameRate,E.renderFrameRate=G.decodeFrameRate<0?0:G.decodeFrameRate,G.outputFrame&&(E.renderFrameRate=G.outputFrame.frameRate),G.receivedFrame?(E.receiveFrameRate=G.receivedFrame.frameRate,E.receiveResolutionHeight=G.receivedFrame.height,E.receiveResolutionWidth=G.receivedFrame.width):w&&(E.receiveResolutionHeight=w._videoHeight||0,E.receiveResolutionWidth=w._videoWidth||0),G.framesRateFirefox!==void 0&&(E.receiveFrameRate=Math.round(G.framesRateFirefox)),E.receivePackets=G.packets,E.receivePacketsLost=G.packetsLost,E.packetLossRate=E.receivePacketsLost/(E.receivePackets+E.receivePacketsLost);const $=p?p.totalFreezeTime:0,rt=p?p.totalDuration:0;E.totalDuration=p?p.totalDuration+1:1,E.totalFreezeTime=(z=G.totalFreezesDuration)!==null&&z!==void 0?z:$||0,E.receiveDelay=G.jitterBufferMs||0;const dt=!!N&&e.getRemoteVideoIsReady(N);G.totalFreezesDuration===void 0&&w&&dt&&Qg.isRemoteVideoFreeze(w,G,m)&&(E.totalFreezeTime+=1),E.freezeRate=Math.max(0,Math.min((E.totalFreezeTime-$)/(E.totalDuration-rt),1))}U&&(_.end2EndDelay=U.B_ad,E.end2EndDelay=U.B_vd,_.transportDelay=U.B_ed,E.transportDelay=U.B_ed,_.currentPacketLossRate=U.B_ealr4/100,E.currentPacketLossRate=U.B_evlr4/100,I.uplinkNetworkQuality=U.B_punq?U.B_punq:0,I.downlinkNetworkQuality=U.B_pdnq?U.B_pdnq:0),this.remoteStats.set(s,{audioStats:_,videoStats:E,videoPcStats:G,networkStats:I}),C&&this.exceptionMonitor.setRemoteAudioStats(C,_),w&&this.exceptionMonitor.setRemoteVideoStats(w,E)})}}class qM{constructor(){O(this,"destChannelMediaInfos",new Map),O(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(e){tM(e),this.srcChannelMediaInfo=e}addDestChannelInfo(e){tM(e),this.destChannelMediaInfos.set(e.channelName,e)}removeDestChannelInfo(e){IR(e),this.destChannelMediaInfos.delete(e)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function KM(t){if(!(t instanceof qM))return new K(P.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const e=t.getSrcChannelMediaInfo(),n=t.getDestChannelMediaInfo();if(!e)return new K(P.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(n.size===0)return new K(P.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class $d{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(e,n){O(this,"uid",void 0),O(this,"_uintid",void 0),O(this,"_trust_in_room_",!0),O(this,"_trust_audio_enabled_state_",!0),O(this,"_trust_video_enabled_state_",!0),O(this,"_trust_audio_mute_state_",!0),O(this,"_trust_video_mute_state_",!0),O(this,"_audio_muted_",!1),O(this,"_video_muted_",!1),O(this,"_audio_enabled_",!0),O(this,"_video_enabled_",!0),O(this,"_audio_added_",!1),O(this,"_video_added_",!1),O(this,"_is_pre_created",!1),O(this,"_video_pre_subscribed",!1),O(this,"_audio_pre_subscribed",!1),O(this,"_trust_video_stream_added_state_",!0),O(this,"_trust_audio_stream_added_state_",!0),O(this,"_audioTrack",void 0),O(this,"_videoTrack",void 0),O(this,"_dataChannels",[]),O(this,"_audioSSRC",void 0),O(this,"_videoSSRC",void 0),O(this,"_audioOrtc",void 0),O(this,"_videoOrtc",void 0),O(this,"_cname",void 0),O(this,"_rtxSsrcId",void 0),O(this,"_videoMid",void 0),O(this,"_audioMid",void 0),this.uid=e,this._uintid=n}}function YM(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function rI(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?YM(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):YM(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const HR="9",aI=2e4,WR=4e4;function XM(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Il(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?XM(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):XM(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}var Pm=function(t){return t[t.DOWN=0]="DOWN",t[t.UP=1]="UP",t}(Pm||{});const zR=new Map;function QM(t,e,n,i){let{scale:r}=t;if(r===0&&i===Pm.UP||r>=e.length-1&&i===Pm.DOWN)return t;let s=Il(Il({},t),{},{scale:i===Pm.DOWN?++r:--r});switch(n){case"maintain-framerate":s=Il(Il({},s),e[r].motion);break;case"maintain-resolution":s=Il(Il({},s),e[r].detail);break;case"balanced":s=Il(Il({},s),e[r].balanced)}return s}function JM(t,e){if(e){const n={overUse:0,underUse:0,adaptationList:ZM(e)};zR.set(t,n)}else zR.delete(t)}function ZM(t){const e=Il({},t),{bitrateMax:n,frameRate:i,scaleResolutionDownBy:r,bitrateMin:s}=e,{MIN_FRAME_RATE:c,MAX_THRESHOLD_FRAMERATE:l,MAX_SCALE:d,BITRATE_MIN_THRESHOLD:h,BITRATE_MAX_THRESHOLD:p,BWE_SCALE_UP_THRESHOLD:m,BWE_SCALE_DOWN_THRESHOLD:_,PERF_SCALE_DOWN_THRESHOLD:E,PERF_SCALE_UP_THRESHOLD:I,BALANCE_BITRATE_FACTOR:C,BALANCE_FRAMERATE_FACTOR:w,BALANCE_RESOLUTION_FACTOR:D,MOTION_RESOLUTION_FACTOR:N,MOTION_BITRATE_FACTOR:L,DETAIL_FRAMERATE_FACTOR:W,DETAIL_BITRATE_FACTOR:G}=iw,U=Math.min(e.frameRate,l),z=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(_,1)*n),bwe_up:n,fps_down:Math.round(Math.pow(E,1)*U),fps_up:i},balanced:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:n,bitrateMin:s},motion:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:n,bitrateMin:s},detail:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:n,bitrateMin:s}}];for(let $=1;$<=d;$++){const rt={bwe_up:Math.round(Math.pow(m,$)*n),bwe_down:Math.round(Math.pow(_,$+1)*n),fps_up:Math.round(Math.pow(I,$)*U),fps_down:Math.round(Math.pow(E,$+1)*U)},dt={scaleResolutionDownBy:r/Math.pow(D,$),frameRate:Math.max(Math.round(Math.pow(w,$)*i),c),bitrateMax:Math.max(Math.round(Math.pow(C,$)*n),p),bitrateMin:Math.max(Math.round(Math.pow(C,$)*s),h)},ae={scaleResolutionDownBy:r/Math.pow(N,$),frameRate:i,bitrateMax:Math.max(Math.round(Math.pow(L,$)*n),p),bitrateMin:Math.max(Math.round(Math.pow(L,$)*s),h)},se={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(W,$)*i),c),bitrateMax:Math.max(Math.round(Math.pow(G,$)*n),p),bitrateMin:Math.max(Math.round(Math.pow(G,$)*s),h)};z.push({scale:$,threshold:rt,balanced:dt,motion:ae,detail:se})}return z}function N8(t,e,n,i,r,s){const c=zR.get(t)||{overUse:0,underUse:0,adaptationList:ZM(r)},{adaptationList:l}=c;zR.set(t,c);const{OVERUSE_TIMES_THRESHOLD:d,UNDERUSE_TIMES_THRESHOLD:h}=iw,{scale:p}=i;let m,_;return typeof e=="number"&&e>0&&function(E,I,C,w){if(I>=C.length)return!1;let{threshold:{fps_down:D}}=C[I];return k("FORCE_AG_HIGH_FRAMERATE")&&w==="maintain-framerate"&&(D=C[0].threshold.fps_down),E<D}(e,p,l,s)&&(c.overUse++,_=kg.CPU,c.overUse>d)||typeof n=="number"&&n>0&&function(E,I,C){if(I>=C.length)return!1;const{threshold:{bwe_down:w}}=C[I];return E<w}(n,p,l)&&(c.overUse++,_=kg.BANDWIDTH,c.overUse>d)?(c.overUse=0,c.underUse=0,m=QM(i,l,s,Pm.DOWN),[m,_]):(typeof e=="number"&&e>0&&typeof n=="number"&&n>0&&function(E,I,C,w){if(I===0)return;let{threshold:{fps_up:D}}=C[I];return k("FORCE_AG_HIGH_FRAMERATE")&&w==="maintain-framerate"&&(D=C[1].threshold.fps_up),E>D}(e,p,l,s)&&function(E,I,C){if(I===0)return;const{threshold:{bwe_up:w}}=C[I];return E>w}(n,p,l)&&(c.underUse++,c.underUse>h&&(c.overUse=0,c.underUse=0,m=QM(i,l,s,Pm.UP),m.scale===0&&(_=kg.NONE))),[m,_])}function $M(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function sI(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?$M(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):$M(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const qR=new Map;function KR(t,e){const n=qR.get(t);if(n){const{timer:i}=n;window.clearTimeout(i),qR.delete(t)}e.qualityLimitationReason=kg.NONE,JM(t)}function D8(t,e){var n;let i;switch(e){case ot.LocalAudioTrack:i=Ve.Audio;break;case ot.LocalVideoTrack:i=mt(n=t._hints).call(n,Ye.SCREEN_TRACK)?Ve.Screen:Ve.High;break;case ot.LocalVideoLowTrack:i=Ve.Low}return i}function oI(t){const e=be();if(t.some(n=>n._bypassWebAudio))throw new Z(P.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!e.webAudioMediaStreamDest)throw new Z(P.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function cI(t,e){oI(t);const n=new $n;return t.forEach(i=>n.addAudioTrack(i)),n}const P8=!be().supportUnifiedPlan||k("CHROME_FORCE_PLAN_B")&&yl();function YR(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var n;return P8?(n={spec:e,store:t},wl("PlanBConnection").create(n)):new rs(e,t)}function lI(t){return t&&(t.iceConnectionState==="disconnected"||t.iceConnectionState==="checking"||t.iceConnectionState==="failed")}function t2(t){try{if(t.iceServers)return!1;if(t.turnServer&&t.turnServer.mode!=="off"){if(Ng(t.turnServer.servers))return!1;if(k("FORCE_TURN_TCP")||t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).some(e=>e.forceturn))return!0}return!1}catch{return!1}}var Se;function e2(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Oo(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?e2(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):e2(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}let rs=(Se=class rp extends rM{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,n;return(e=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&e!==void 0?e:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").filter(e=>{var n;return mt(n=Object.keys(xg)).call(n,e)}))]}constructor(e,n){super(e,n),O(this,"id",Je(5,"connection-")),O(this,"store",void 0),O(this,"peerConnection",void 0),O(this,"forceTurn",!1),O(this,"remoteSDP",void 0),O(this,"initialOffer",void 0),O(this,"transportEventReceiver",void 0),O(this,"statsFilter",void 0),O(this,"extension",{useXR:k("USE_XR")}),O(this,"localCapabilities",void 0),O(this,"remoteCodecs",void 0),O(this,"localCandidateCount",0),O(this,"allCandidatesReceived",!1),O(this,"isPreallocation",!1),O(this,"preMediaMap",new Map),O(this,"dataStreamChannelMap",new Map),O(this,"establishPromise",void 0),O(this,"recoveredDataChannelIds",[]),O(this,"currentDataChannelId",1),O(this,"supportAV1RtpSpec",!1),O(this,"mutex",void 0),O(this,"qualityLimitationReason",kg.NONE),O(this,"isFirstConnected",!1),this.store=n,this.forceTurn=t2(e),this.mutex=new Wi("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(rp.resolvePCConfiguration(e),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=tw(this.peerConnection,k("STATS_UPDATE_INTERVAL"),void 0,An()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,e.isPreallocation&&(this.isPreallocation=!0),this.establishPromise=this.establish()}getPreMedia(e){return this.preMediaMap.get(e)}isPreSub(){return this.preMediaMap.size>0}async updateRemoteRTPCapabilities(e,n){if(this.remoteCodecs=n,!this.remoteSDP)return void T.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(n));if(this.remoteSDP.updateRemoteCodec(e,n,this.store.codec)){const i=await this.peerConnection.createOffer(),r=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i);const s=this.remoteSDP.toString();r==null||r(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}else T.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const i=await this.peerConnection.createOffer();if(!i.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const r=Xd(i.sdp),s=await RM({filterRTX:!k("USE_PUB_RTX")&&!k("USE_SUB_RTX"),filterVideoFec:k("FILTER_VIDEO_FEC"),filterAudioFec:k("FILTER_AUDIO_FEC"),filterVideoCodec:k("FILTER_VIDEO_CODEC"),unsupportedVideoUplinkCodec:k("UNSUPPORTED_VIDEO_UPLINK_CODEC"),unsupportedVideoDownlinkCodec:k("UNSUPPORTED_VIDEO_DOWNLINK_CODEC")},this.extension);if(this.localCapabilities=VR(s),this.initialOffer=i,k("ENABLE_SVC")&&this.store.codec=="av1"){const l=await async function(){try{const d=new RTCPeerConnection;d.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:cR.L1T3}]});const h=await d.createOffer();if(!h.sdp)return void d.close();const p=Wr(h.sdp).mediaDescriptions[0];if(!p)return;const m=p.attributes.extmaps.find(_=>_.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return d.close(),m}catch{return}}();var e;l&&(this.supportAV1RtpSpec=!0,(e=s.send)===null||e===void 0||e.videoExtensions.push(l))}let c;return i.sdp&&wM(i.sdp)&&(c=En(s),(n=c).send&&(wm(Ct.VIDEO,n.send.videoExtensions),wm(Ct.AUDIO,n.send.audioExtensions)),n.recv&&(wm(Ct.VIDEO,n.recv.videoExtensions),wm(Ct.AUDIO,n.recv.audioExtensions)),n.sendrecv&&(wm(Ct.VIDEO,n.sendrecv.videoExtensions),wm(Ct.AUDIO,n.sendrecv.audioExtensions))),Oo(Oo({},r),{},{rtpCapabilities:c||s,offerSDP:i.sdp})}catch(i){throw new Z(P.GET_LOCAL_CONNECTION_PARAMS_FAILED,i.toString())}var n}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&wM(this.initialOffer.sdp)&&(n=e.rtpCapabilities,i=this.localCapabilities,n.send&&(xR(Ct.VIDEO,n.send.videoExtensions,i.send.videoExtensions),xR(Ct.AUDIO,n.send.audioExtensions,i.send.audioExtensions)),n.recv&&(xR(Ct.VIDEO,n.recv.videoExtensions,i.recv.videoExtensions),xR(Ct.AUDIO,n.recv.audioExtensions,i.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return En(this._localCapabilities)}get rtpCapabilities(){return En(this._rtpCapabilities)}get candidates(){return En(this._candidates)}get iceParameters(){return En(this._iceParameters)}get dtlsParameters(){return En(this._dtlsParameters)}constructor(d){let h=arguments.length>1&&arguments[1]!==void 0&&arguments[1],p=arguments.length>2&&arguments[2]!==void 0&&arguments[2];O(this,"sessionDesc",void 0),O(this,"_localCapabilities",void 0),O(this,"_rtpCapabilities",void 0),O(this,"_candidates",void 0),O(this,"_originCandidates",void 0),O(this,"_iceParameters",void 0),O(this,"_isUseExtmapAllowMixed",void 0),O(this,"_isUseLocalCodecs",void 0),O(this,"_dtlsParameters",void 0),O(this,"setup",void 0),O(this,"currentMidIndex",void 0),O(this,"cname",void 0),O(this,"useLocalCodecsMids",[]),O(this,"preloadSsrcs",[]),O(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=h,this._isUseLocalCodecs=p,d=En(d);const{iceParameters:m,dtlsParameters:_,candidates:E,rtpCapabilities:I,setup:C,localCapabilities:w,cname:D}=d;this._rtpCapabilities=I,this._candidates=E,this._originCandidates=En(E),this._iceParameters=m,this._dtlsParameters=_,this._localCapabilities=w,this.setup=C,this.cname=D,[this.sessionDesc]=this.updateRemoteRTPCapabilities(I),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}checkPreloadSsrcs(d){return d.length===this.preloadSsrcs.length&&d.every(h=>{var p;return mt(p=this.preloadSsrcs).call(p,h)})}preloadRemoteMedia(d){let h=0;const p=[],m=[];for(;d>0;){const _=[rI({ssrcId:WR+h},k("USE_SUB_RTX")?{rtx:WR+h+1}:{})],E="".concat(WR+h,"_").concat(aI+h),{ssrcs:I,ssrcGroups:C}=qg(_,this.cname,k("SYNC_GROUP")?E:void 0),w=this.preCreateOrRecycleSendMedia("video",I,C,void 0),D=[{ssrcId:aI+h}],N="".concat(WR+h,"_").concat(aI+h),{ssrcs:L,ssrcGroups:W}=qg(D,this.cname,k("SYNC_GROUP")?N:void 0),G=this.preCreateOrRecycleSendMedia("audio",L,W,void 0);d--,h+=2,p.push(w,G),m.push(I[0].ssrcId,L[0].ssrcId)}return this.useLocalCodecsMids.push(...p),this.preloadSsrcs=m,{mids:p,preSSRCs:m,isAvailable:!0}}preCreateOrRecycleSendMedia(d,h,p,m){const _=this.rtpCapabilities.send.videoCodecs,E=this._isUseLocalCodecs||_.length===0?this.localCapabilities.recv:this.rtpCapabilities.send;T.debug("create or recycle send media without remote rtp capabilities, ssrcs ",h[0].ssrcId);const I=d===Ct.VIDEO?E.videoCodecs:E.audioCodecs,C=d===Ct.VIDEO?E.videoExtensions:E.audioExtensions;this.currentMidIndex+=1;const w="".concat(this.currentMidIndex);let D={media:{mediaType:d,port:HR,protos:["UDP","TLS","RTP","SAVPF"],fmts:I.map(N=>N.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:C,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:h,ssrcGroups:p,rtcpFeedbackWildcards:[],payloads:I,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(w)}};return D=this.mungSendMediaDesc(D,m),this.sessionDesc.mediaDescriptions.push(D),this.updateBundleMids(),w}toString(){return Hd(this.sessionDesc)}send(d,h,p,m){const{ssrcs:_,ssrcGroups:E}=qg(h,this.cname,k("SYNC_GROUP")?p:void 0),I=this.findPreloadMediaDesc(_);if(I){if(An()&&this.firefoxSsrcMidMap.set(_[0].ssrcId,I.attributes.mid),m&&(m.twcc||m.remb)){const C=this.sessionDesc.mediaDescriptions.indexOf(I);return this.sessionDesc.mediaDescriptions[C]=this.mungSendMediaDesc(I,m),{mid:I.attributes.mid,needExchangeSDP:!0}}return{mid:I.attributes.mid,needExchangeSDP:!1}}{const C=this.findAvailableMediaIndex(d,_);let w;return C===-1||C===1&&(Di()||function(){const D=ve();return!(D.name!==Ie.CHROME||!D.osVersion)&&Number(D.version)<=90}()||k("ENABLE_ENCODED_TRANSFORM")&&Tl())||C===0&&!function(D){const N=ve();return!(N.name!==Ie.FIREFOX||!N.osVersion)&&Number(N.version)===D}(138)&&k("USE_SUB_RTX")||Qk()?(w=this.createOrRecycleSendMedia(d,_,E,"sendonly",m),this.updateBundleMids()):(w=En(this.sessionDesc.mediaDescriptions[C]),w.attributes.direction="sendonly",w.attributes.ssrcs=_,w.attributes.ssrcGroups=E,this.sessionDesc.mediaDescriptions[C]=this.mungSendMediaDesc(w,m)),An()&&this.firefoxSsrcMidMap.set(_[0].ssrcId,w.attributes.mid),{mid:w.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:d,needExchangeSDP:h}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:d.attributes.mid,needExchangeSDP:h}}batchSend(d){const h=d.map(_=>{let{kind:E,ssrcMsg:I,mslabel:C}=_;return this.send(E,I,C)}),p=[];let m=!1;return h.forEach(_=>{let{mid:E,needExchangeSDP:I}=_;I&&(m=!0),p.push(E)}),{mids:p,needExchangeSDP:m}}stopSending(d){const h=this.sessionDesc.mediaDescriptions.filter(p=>p.attributes.mid&&d.indexOf(p.attributes.mid)!==-1);if(h.length!==d.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");h.forEach(p=>{p.attributes.mid==="0"||An()||Qk()?p.attributes.ssrcs=[]:(p.attributes.ssrcs=[],p.attributes.direction="inactive",p.media.port="0")}),this.updateBundleMids()}mute(d){const h=this.sessionDesc.mediaDescriptions.find(p=>p.attributes.mid===d);if(!h)throw new Error("mediaDescription not found with ".concat(d," in remote SDP when calling RemoteSDP.mute."));h.attributes.direction="inactive"}unmute(d){const h=this.sessionDesc.mediaDescriptions.find(p=>p.attributes.mid===d);if(!h)throw new Error("mediaDescription not found with ".concat(d," in remote SDP when calling RemoteSDP.unmute."));h.attributes.direction="sendonly"}muteRemote(d){const h=this.sessionDesc.mediaDescriptions.filter(p=>mt(d).call(d,p.attributes.mid||""));if(h.length!==d.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");h.forEach(p=>{p.attributes.direction="inactive"})}unmuteRemote(d){const h=this.sessionDesc.mediaDescriptions.filter(p=>mt(d).call(d,p.attributes.mid||""));if(h.length!==d.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");h.forEach(p=>{p.attributes.direction="recvonly"})}receive(d,h,p,m){d.forEach((_,E)=>{this.createOrRecycleRecvMedia(_,[],"recvonly",h,p,m[E])}),this.updateBundleMids()}stopReceiving(d){const h=this.sessionDesc.mediaDescriptions.filter(p=>d.indexOf(p.attributes.mid)!==-1);if(h.length!==d.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");h.forEach(p=>{p.media.port="0",p.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(d){const h=this.sessionDesc||Wr((p=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(p?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var p;this._rtpCapabilities=d;let m=!1;const _=this.rtpCapabilities.send,E=this.localCapabilities.send,I=this.localCapabilities.recv,C=I.videoCodecs,w=I.audioCodecs,D=I.videoExtensions,N=I.audioExtensions;for(const U of h.mediaDescriptions){var L;if(U.attributes.direction!=="sendonly"||typeof U.attributes.mid!="string"||!mt(L=this.useLocalCodecsMids).call(L,U.attributes.mid)){if(m=!0,U.attributes.iceUfrag=this._iceParameters.iceUfrag,U.attributes.icePwd=this._iceParameters.icePwd,U.attributes.fingerprints=this._dtlsParameters.fingerprints,U.attributes.candidates=this._candidates,U.attributes.setup=this.setup,U.media.mediaType==="application"&&(U.attributes.sctpPort="5000"),U.media.mediaType==="video")if(this._isUseLocalCodecs&&U.attributes.direction==="sendonly"){var W;U.media.fmts=C.map($=>$.payloadType.toString(10)),U.attributes.payloads=C,U.attributes.extmaps=D;const z=U.attributes.mid;typeof z!="string"||mt(W=this.useLocalCodecsMids).call(W,z)||this.useLocalCodecsMids.push(z)}else if(_.videoCodecs.length===0){const z=E.videoCodecs.filter($=>{var rt,dt;return(rt=$.rtpMap)===null||rt===void 0?void 0:mt(dt=rt.encodingName.toLowerCase()).call(dt,"vp8")})||[E.videoCodecs[0]];U.media.fmts=z.map($=>$.payloadType.toString(10)),U.attributes.payloads=z,U.attributes.extmaps=[]}else U.media.fmts=_.videoCodecs.map(z=>z.payloadType.toString(10)),U.attributes.payloads=_.videoCodecs,U.attributes.extmaps=_.videoExtensions;if(U.media.mediaType==="audio")if(this._isUseLocalCodecs&&U.attributes.direction==="sendonly"){var G;U.media.fmts=w.map($=>$.payloadType.toString(10)),U.attributes.payloads=w,U.attributes.extmaps=N;const z=U.attributes.mid;typeof z!="string"||mt(G=this.useLocalCodecsMids).call(G,z)||this.useLocalCodecsMids.push(z)}else if(_.audioCodecs.length===0){const z=E.audioCodecs.filter($=>{var rt,dt;return(rt=$.rtpMap)===null||rt===void 0?void 0:mt(dt=rt.encodingName.toLowerCase()).call(dt,"opus")})||[E.audioCodecs[0]];U.media.fmts=z.map($=>$.payloadType.toString(10)),U.attributes.payloads=z,U.attributes.extmaps=[]}else U.media.fmts=_.audioCodecs.map(z=>z.payloadType.toString(10)),U.attributes.payloads=_.audioCodecs,U.attributes.extmaps=_.audioExtensions,Om(U)}}return this.sessionDesc=h,this.currentMidIndex=h.mediaDescriptions.length-1,[this.sessionDesc,m]}updateCandidates(d){const h=this._originCandidates.filter(m=>m.transport==="udp"),p=[];if(h.forEach(m=>{p.push(rI(rI({},m),{},{foundation:"tcpcandidate",priority:Number(m.priority)-1+"",transport:"tcp",port:Number(m.port)+90+""}))}),h.length!==0){switch(d){case Ki.TCP_RELAY:this._candidates=p;break;case Ki.UDP_TCP_RELAY:case Ki.RELAY:this._candidates=[...h,...p];break;default:this._candidates=h}for(const m of this.sessionDesc.mediaDescriptions)m.attributes.candidates=this.candidates}}restartICE(d){d=En(d),this._iceParameters=d,this.sessionDesc.mediaDescriptions.forEach(h=>{h.attributes.iceUfrag=d.iceUfrag,h.attributes.icePwd=d.icePwd})}predictReceivingMids(d){const h=[];for(let p=0;p<d;p++)h.push((this.currentMidIndex+p+1).toString(10));return h}findAvailableMediaIndex(d,h){return this.sessionDesc.mediaDescriptions.findIndex(p=>{const m=p.media.mediaType===d&&p.media.port!=="0"&&(p.attributes.direction==="sendonly"||p.attributes.direction==="sendrecv")&&p.attributes.ssrcs.length===0;if(An()){if(m){const _=this.firefoxSsrcMidMap.get(h[0].ssrcId);return!(_||p.attributes.mid!=="0"&&p.attributes.mid!=="1")||!(!_||_!==p.attributes.mid)}return!1}return m})}createOrRecycleDataChannel(){for(const p of this.sessionDesc.mediaDescriptions)if(p.media.mediaType==="application")return{mediaDesc:p,needExchangeSDP:!1};this.currentMidIndex+=1;const d="".concat(this.currentMidIndex),h={media:{mediaType:"application",port:HR,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(d),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(h),{mediaDesc:h,needExchangeSDP:!0}}createOrRecycleRecvMedia(d,h,p,m,_,E){const I=d._mediaStreamTrack.kind,C=this.rtpCapabilities.recv,w=Kg(I,C,this.localCapabilities.send,I===Ct.VIDEO?m:_),D=I===Ct.VIDEO?C.videoExtensions:C.audioExtensions;this.currentMidIndex+=1;const N="".concat(this.currentMidIndex);let L={media:{mediaType:I,port:HR,protos:["UDP","TLS","RTP","SAVPF"],fmts:w.map(G=>G.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:D,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:h,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:w,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:p,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(N)}};L=this.mungRecvMediaDsec(L,d,E);const W=this.findFirstClosedMedia(I);if(W){const G=this.sessionDesc.mediaDescriptions.indexOf(W);this.sessionDesc.mediaDescriptions[G]=L}else this.sessionDesc.mediaDescriptions.push(L);return L}updateRemoteDtlsParameters(d){const h=new Set(this._dtlsParameters.fingerprints.map(_=>_.fingerprint)),p=new Set(d.map(_=>_.fingerprint));let m=!1;h.size!==p.size&&(m=!0);for(const _ of h)p.has(_)||(m=!0);return m}updateRemoteCodec(d,h,p){const m=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(L=>L.rtpMap&&L.rtpMap.encodingName.toLowerCase()||"").filter(L=>{var W;return mt(W=Object.keys(xg)).call(W,L)}))],_=new Set(h);if(m.every(L=>_.has(L)))return T.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(h)),!1;const E=this._rtpCapabilities.recv.videoCodecs.filter(L=>h.some(W=>{var G;return mt(G=L.rtpMap&&L.rtpMap.encodingName.toLowerCase()||"").call(G,W)}));if(E.length===0)return T.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(m," codecs: ").concat(h)),!1;const I=[...new Set(E.map(L=>L.rtpMap&&L.rtpMap.encodingName.toLowerCase()||""))];let C;if(T.debug("updateRemoteCodec, from ".concat(m," to ").concat(I)),d.length===0)C=this.sessionDesc.mediaDescriptions.filter(L=>L.media.mediaType==="video"&&L.attributes.direction==="recvonly");else if(C=this.sessionDesc.mediaDescriptions.filter(L=>L.attributes.mid&&L.media.mediaType==="video"&&mt(d).call(d,L.attributes.mid)&&L.attributes.direction==="recvonly"),C.length!==d.length)return T.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(d,", codecs: ").concat(h)),!1;if(k("USE_PUB_RTX")||k("USE_SUB_RTX")){const L=Qd(E,this.rtpCapabilities.recv.videoCodecs);E.push(...L)}this._rtpCapabilities.recv.videoCodecs=E;const w=this.localCapabilities.send,D=this.rtpCapabilities.recv,N=Kg(Ct.VIDEO,D,w,p);return C.forEach(L=>{const W=N.map(G=>G.payloadType.toString(10));T.debug("updateRemoteCodec mid: ".concat(L.attributes.mid,", from"),L.attributes.payloads,"to",N),L.attributes.payloads=N,L.media.fmts=W}),!0}createOrRecycleSendMedia(d,h,p,m,_){const E=this.rtpCapabilities.send.videoCodecs,I=this._isUseLocalCodecs||E.length===0?this.localCapabilities.recv:this.rtpCapabilities.send,C=d===Ct.VIDEO?I.videoCodecs:I.audioCodecs,w=d===Ct.VIDEO?I.videoExtensions:I.audioExtensions;this.currentMidIndex+=1;const D="".concat(this.currentMidIndex);let N={media:{mediaType:d,port:HR,protos:["UDP","TLS","RTP","SAVPF"],fmts:C.map(W=>W.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:w,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:h,ssrcGroups:p,rtcpFeedbackWildcards:[],payloads:C,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:m,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(D)}};N=this.mungSendMediaDesc(N,_);const L=this.findFirstClosedMedia(d);if(L){const W=this.sessionDesc.mediaDescriptions.indexOf(L);this.sessionDesc.mediaDescriptions[W]=N}else this.sessionDesc.mediaDescriptions.push(N);return N}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(d=>d.media.port!=="0").map(d=>d.attributes.mid)}mungRecvMediaDsec(d,h,p){const m=En(d);return zw(m),Im(m,h),qw(m,h),TM(m),UR(m,p,this.localCapabilities.send),m}mungSendMediaDesc(d,h){const p=En(d);return UR(p,h,this.localCapabilities.recv),Om(p),p}updateRecvMedia(d,h){const p=this.sessionDesc.mediaDescriptions.findIndex(m=>m.attributes.mid===d);if(p!==-1){const m=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[p],h);this.sessionDesc.mediaDescriptions[p]=m}}bumpMid(d){this.currentMidIndex+=d}findFirstClosedMedia(d){return this.sessionDesc.mediaDescriptions.find(h=>An()?h.media.port==="0"&&h.media.mediaType===d:h.media.port==="0")}findPreloadMediaDesc(d){return this.sessionDesc.mediaDescriptions.find(h=>{var p;return((p=h.attributes)===null||p===void 0||(p=p.ssrcs[0])===null||p===void 0?void 0:p.ssrcId)===d[0].ssrcId})}getSSRC(d){var h;return(h=this.sessionDesc.mediaDescriptions.find(p=>p.attributes.mid===d))===null||h===void 0?void 0:h.attributes.ssrcs}}(Oo(Oo({},e),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec,!(!k("ENABLE_PRE_SUB_WITH_PRE_PC")||!k("PRE_USE_LOCAL_CODECS"))&&cw(this.store)),e.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const r=this.remoteSDP.toString(),s=CM(this.initialOffer.sdp,this.extension),c=this.logSDPExchange(s||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),c==null||c(r),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r});const l=this.peerConnection.getTransceivers()[0];if(l!=null&&l.receiver&&this.tryBindTransportEvents(l.receiver),cw(this.store))if(e.preallocation&&k("ENABLE_PRE_SUB_WITH_PRE_PC")){const d=k("PRE_SUB_NUM"),{mids:h,preSSRCs:p}=this.remoteSDP.preloadRemoteMedia(d);await Jd(this.peerConnection,this.remoteSDP,this.extension),T.debug("[".concat(this.store.clientId,"] [P2PConnection] preload media, in pre pc,add preload ssrcs ").concat(p)),this.presetMedia(h,p)}else{const{preSSRCs:d=[]}=e,h=d.map(m=>m.ssrcMsg[0].ssrcId);if(d.length===0)return;const{mids:p}=this.remoteSDP.batchSend(d.map(m=>Object.assign({},m)));await Jd(this.peerConnection,this.remoteSDP,this.extension),T.debug("[P2PConnection.connect] preload media, after join, add preload ssrcs ".concat(h)),this.presetMedia(p,h)}}catch(r){throw new Z(P.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(r.toString()))}var n,i}presetMedia(e,n){e.forEach((i,r)=>{this.peerConnection.getTransceivers().forEach(s=>{if(s.mid!=null&&i===s.mid&&s.receiver.track){const c=s.receiver.track;let l;c.kind==="video"&&k("ENABLE_PRE_RENDER")&&(l=new Tw({trackId:"track-".concat(c.kind,"-unknown-").concat(this.store.clientId,"_").concat(Je(5,""))},!0),l.updateVideoTrack(c),l.onFirstVideoFrameRender=()=>{var d;const h=this.preMediaMap.get(n[r]);h&&(h.firstVideoRender=Date.now()),(d=this.onFirstVideoRender)===null||d===void 0||d.call(this,n[r])},l.play(this.store.sessionId||void 0)),this.preMediaMap.set(n[r],{mid:i,track:c,player:l,transceiver:s})}}),this.store.peerReceiver()})}checkDtlsParameters(e){return!!this.remoteSDP&&e.length>0&&this.remoteSDP.updateRemoteDtlsParameters(e)}async updateRemoteConnect(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");let n=!1;const{rtpCapabilities:i}=e;if([,n]=this.remoteSDP.updateRemoteRTPCapabilities(i),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0){const c=this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);n=n||c}const{preSSRCs:r=[]}=e,s=r.map(c=>c.ssrcMsg[0].ssrcId);if(!this.remoteSDP.checkPreloadSsrcs(s)){const c=[],l=[];if(Array.from(this.preMediaMap.entries()).every(d=>{let[h,{mid:p,player:m,track:_}]=d;return c.push(p),l.push(h),this.preMediaMap.delete(h),m&&m.destroy(),!0}),c.length>0&&(this.remoteSDP.stopSending(c),await Jd(this.peerConnection,this.remoteSDP,this.extension),T.warn("[P2PConnection.updateRemoteConnect] preload media, failed, del preload ssrcs ".concat(l)),Pt.reportApiInvoke(this.store.sessionId,{name:kn.PRELOAD_MEDIA_FAILED,options:[r,l],tag:_n.TRACER}).onSuccess()),r.length>0){const{mids:d}=this.remoteSDP.batchSend(r.map(h=>Object.assign({},h)));await Jd(this.peerConnection,this.remoteSDP,this.extension),T.debug("[P2PConnection.updateRemoteConnect] preload media, after join, add preload ssrcs ".concat(s)),this.presetMedia(d,s)}}n?(await Jd(this.peerConnection,this.remoteSDP,this.extension),T.debug("[P2PConnection] updateRemoteConnect by exchanging SDP.")):T.debug("[P2PConnection] updateRemoteConnect no need to exchange SDP, because no need to update remote codecs (use local codecs)")}catch(n){throw new Z(P.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(n.toString()))}}send(e,n,i){var r=this;return Za(function*(){const s=yield Re(r.mutex.lock("From P2PConnection.send"));try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const c=[],l=LR();e.forEach(w=>{const D=r.peerConnection.addTransceiver(w._mediaStreamTrack,Oo({direction:"sendonly"},w.trackMediaType==="video"&&r.supportAV1RtpSpec&&l?{sendEncodings:[{scalabilityMode:l}]}:{}));c.push(D),w._updateRtpTransceiver(D)}),An()&&k("SIMULCAST")===!0&&(yield Re(r.applySimulcastForFirefox(c,e)));const d=yield Re(r.peerConnection.createOffer()),h=r.remoteSDP.predictReceivingMids(e.length),p=r.mungSendOfferSDP(d.sdp,e,h),m=Wr(p),_=h.map(w=>{const D=m.mediaDescriptions.find(N=>N.attributes.mid===w);if(!D)throw new Error("Cannot extract ssrc from mediaDescription.");return gM(D,k("USE_PUB_RTX"))});let E;try{E=yield _}catch(w){E=[],r.remoteSDP.receive(e,n,i,E);const D=r.remoteSDP.toString();throw yield Re(r.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield Re(r.peerConnection.setRemoteDescription({type:"answer",sdp:D})),yield Re(r.stopSending(h,!0)),w}r.remoteSDP.receive(e,n,i,E);const I=r.remoteSDP.toString(),C=r.logSDPExchange(p,"offer","local","send");return yield Re(r.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield Re(r.applySimulcastEncodings(c,e)),yield Re(r.applySendEncodings(c,e)),C==null||C(I),yield Re(r.peerConnection.setRemoteDescription({type:"answer",sdp:I})),c.map((w,D)=>{const N=h[D];return{localSSRC:_[D],id:N,transceiver:w}})}catch(c){throw c instanceof Z?c:new Z(P.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(c.toString()))}finally{s()}})()}async createDataChannels(e,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let i=this.dataStreamChannelMap.get(e);if(i&&i.readyState==="open")T.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const s=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof s!="number")throw new Error("create DataChannel error, because cannot get dc id");i=this.peerConnection.createDataChannel("datastream-channel",{id:s,negotiated:!0,ordered:!1,maxRetransmits:k("DATASTREAM_MAX_RETRANSMITS")}),i.binaryType="arraybuffer",this.dataStreamChannelMap.set(e,i)}n.forEach(s=>{s._updateOriginDataChannel(i)});const{needExchangeSDP:r}=this.remoteSDP.sendDataChannel();if(r){const s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(c),T.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else T.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(i){throw i instanceof Z?i:new Z(P.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(i.toString()))}}async stopDataChannels(e){try{const n=this.dataStreamChannelMap.get(e);return n&&(n.id&&this.recoveredDataChannelIds.push(n.id),n.close()),void this.dataStreamChannelMap.delete(e)}catch(n){throw n instanceof Z?n:new Z(P.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(n.toString()))}}async stopSending(e,n){const i=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const r=this.peerConnection.getTransceivers().filter(d=>e.indexOf(d.mid)!==-1);if(r.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");r.map(d=>{var h;KR(this.id+d.mid,this),d.direction="inactive",(h=d.stop)===null||h===void 0||h.call(d)});const s=await this.peerConnection.createOffer(),c=this.logSDPExchange(s.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(s),this.remoteSDP.stopReceiving(e);const l=this.remoteSDP.toString();c==null||c(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(r){throw new Z(P.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(r.toString()))}finally{i&&i()}}async receive(e,n,i,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:s,needExchangeSDP:c}=this.remoteSDP.send(e,n,i,r);c&&(await Jd(this.peerConnection,this.remoteSDP,this.extension),T.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP.")));const l=this.peerConnection.getTransceivers().find(d=>d.mid===s);if(!l)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:l.receiver.track,id:s,transceiver:l}}catch(s){throw new Z(P.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:n,needExchangeSDP:i}=this.remoteSDP.batchSend(e);return i&&(await Jd(this.peerConnection,this.remoteSDP,this.extension),T.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),n.map(r=>{const s=this.peerConnection.getTransceivers().find(c=>c.mid===r);if(!s)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:s.receiver.track,id:r,transceiver:s}})}catch(n){throw new Z(P.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");e.forEach(s=>{Array.from(this.preMediaMap.entries()).some(c=>{let[l,{mid:d,player:h}]=c;if(d===s)return this.preMediaMap.delete(l),h&&h.destroy(),!0})}),this.remoteSDP.stopSending(e);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();i==null||i(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(n){throw new Z(P.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.mute(e);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();i==null||i(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(n){throw new Z(P.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(n.toString()))}}async unmuteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.unmute(e);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();i==null||i(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(n){throw new Z(P.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(n.toString()))}}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(c=>c.mid&&e.indexOf(c.mid)!==-1);if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(c=>{c.direction="inactive"});const i=await this.peerConnection.createOffer(),r=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(e);const s=this.remoteSDP.toString();r==null||r(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new Z(P.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(c=>c.mid&&e.indexOf(c.mid)!==-1);if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async(c,l)=>{c.direction="sendonly"});const i=await this.peerConnection.createOffer(),r=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(e),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(e,this.remoteCodecs,this.store.codec);const s=this.remoteSDP.toString();r==null||r(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new Z(P.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(e){var n=this;return Za(function*(){const i=yield Re(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const r=be().supportPCSetConfiguration,s=k("FORCE_TURN_TCP")||n.forceTurn;if(e===Ki.RELAY&&!r)return;if(r&&!s){const m=e===Ki.RELAY?"relay":"all",_=n.peerConnection.getConfiguration();_.iceTransportPolicy!==m&&(T.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(_.iceTransportPolicy,"] to [").concat(m,"]")),_.iceTransportPolicy=m,n.peerConnection.setConfiguration(_))}n.remoteSDP.updateCandidates(e);const c=yield Re(n.peerConnection.createOffer({iceRestart:!0}));if(!c.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const l=Xd(c.sdp),{remoteIceParameters:d}=yield l.iceParameters;n.remoteSDP.restartICE(d);const h=n.remoteSDP.toString(),p=n.logSDPExchange(c.sdp||"","offer","local","restartICE");n.store.descriptionStart(),yield Re(n.peerConnection.setLocalDescription(c)),p==null||p(h),yield Re(n.peerConnection.setRemoteDescription({type:"answer",sdp:h}))}catch(r){T.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),r)}finally{i()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const e=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(Ki.TCP_RELAY),await Jd(this.peerConnection,this.remoteSDP,this.extension)}catch(n){T.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),n)}finally{e()}}close(){var e;this.peerConnection.getTransceivers().forEach(n=>{KR(this.id+n.mid,this)}),this.preMediaMap.forEach(n=>{let{player:i}=n;i&&i.destroy()}),this.preMediaMap.clear(),this.peerConnection.close(),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return Oo(Oo({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),r=this.mungSendOfferSDP(i.sdp,[n],[e]);this.remoteSDP.updateRecvMedia(e,n);const s=this.remoteSDP.toString(),c=this.logSDPExchange(r,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),c==null||c(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(i){throw new Z(P.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(e,n){const i=this.peerConnection.getTransceivers().filter(r=>r.mid===e);i.length===1&&(this.isVP8Simulcast(n)?An()||await this.applySimulcastEncodings(i,[n]):await this.applySendEncodings(i,[n]))}setStatsRemoteVideoIsReady(e,n){this.statsFilter.setVideoIsReady2(e,n)}async replaceTrack(e,n){const i=this.peerConnection.getTransceivers().find(r=>r.mid===n);i&&await i.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){const e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){const n=e[0].transport.iceTransport,{local:i,remote:r}=n.getSelectedCandidatePair();return{local:Oo(Oo({},vc),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port}),remote:Oo(Oo({},vc),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;(e=this.onICEConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=e=>{if(e&&(e.errorCode||e.errorText)){var n;const i="code: ".concat(e.errorCode,", message: ").concat(e.errorText),r=e.port?"local: ".concat(e.port):"",s=Hh(e.url||"");T.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(i,"), url: ").concat(s||"",", host_candidate:").concat(r)),(n=this.onICECandidateError)===null||n===void 0||n.call(this,i)}},this.peerConnection.onicegatheringstatechange=e=>{e&&e.target&&"iceGatheringState"in e.target&&T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(e.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},k("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e){const n={iceServers:[]},i=e.cloudProxyServer||"disabled";return e.iceServers?n.iceServers=e.iceServers:e.turnServer&&(Ng(e.turnServer.servers)?n.iceServers=e.turnServer.servers:k("NEW_TURN_MODE")&&n.iceServers&&i==="disabled"?(k("USE_TURN_SERVER_OF_GATEWAY")?e.turnServer.serversFromGateway&&n.iceServers.push(...rp.newTurnServerConfigToIceServers(e.turnServer.serversFromGateway)):n.iceServers.push(...rp.newTurnServerConfigToIceServers(e.turnServer.servers)),k("NEW_FORCE_TURN")&&(n.iceTransportPolicy="relay")):e.turnServer.mode!=="off"&&(n.iceServers&&n.iceServers.push(...rp.turnServerConfigToIceServers(e.turnServer.servers)),k("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&e.turnServer.serversFromGateway&&n.iceServers.push(...rp.turnServerConfigToIceServers(e.turnServer.serversFromGateway)),k("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach(r=>{r.forceturn&&(n.iceTransportPolicy="relay")}))),k("ENABLE_ENCODED_TRANSFORM")&&be().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(e){const n=[];return e.forEach(i=>{i.security?i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(Kd(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&!k("FORCE_TURN_TCP")&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),n}static newTurnServerConfigToIceServers(e){const n=[];return e.forEach(i=>{const r=k("NEW_TURN_MODE");r===1?n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=udp")}):r===2?n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=tcp")}):r===3?n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(Kd(i.turnServerURL),":443?transport=tcp")}):r===4&&(n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=udp")}),n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=tcp")}),n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(Kd(i.turnServerURL),":443?transport=tcp")}))}),n}tryBindTransportEvents(e){const n=e.transport;if(n){this.transportEventReceiver=e,n.onstatechange=()=>{var r;n!=null&&n.state&&((r=this.onDTLSTransportStateChange)===null||r===void 0||r.call(this,n.state))},n.onerror=r=>{var s;(s=this.onDTLSTransportError)===null||s===void 0||s.call(this,"error"in r?r.error:r)};const i=n.iceTransport;i&&(i.onstatechange=()=>{const r=n==null?void 0:n.iceTransport.state;var s;r&&((s=this.onICETransportStateChange)===null||s===void 0||s.call(this,r))},i.getSelectedCandidatePair&&(i.onselectedcandidatepairchange=()=>{if(i.getSelectedCandidatePair()){const{local:r,remote:s}=i.getSelectedCandidatePair()||{};if(r&&s){const c=r.address+":"+r.port,l=s.address+":"+s.port;T.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(Hh(c)),", remote ").concat(JSON.stringify(Hh(l))))}}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e,n){var i,r;if(n||(n=this.peerConnection.getSenders().find(w=>w.track===e._mediaStreamTrack)),!n)return T.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e))return T.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!be().supportSetRtpSenderParameters)return T.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const s={},c={};switch(e._optimizationMode){case"motion":s.degradationPreference="maintain-framerate";break;case"detail":s.degradationPreference="maintain-resolution";break;case"balanced":s.degradationPreference="balanced"}const l=function(C,w){return C.getTransceivers().find(D=>D.sender.track===w||D.receiver.track===w)}(this.peerConnection,e._mediaStreamTrack),d=EG(e);if(function(C){var w;return!(!k("ENABLE_AG_ADAPTATION")||!(C instanceof ER||mt(w=C._hints).call(w,Ye.CUSTOM_TRACK))||!k("FORCE_SUPPORT_AG_ADAPTATION")&&!(Yk(14,0,!1)&&Xk(17,4)||Kk(14)&&UA(17,4,!0)))}(e)&&l&&n&&d&&this.getLocalVideoStats&&mt(i=["vp8","vp9"]).call(i,this.store.codec)){var h;const C=s.degradationPreference||(mt(h=e._hints).call(h,Ye.CUSTOM_TRACK)?k("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(w,D,N,L,W,G){if(KR(w,N),W(D),L!=="balanced"&&L!=="maintain-framerate"&&L!=="maintain-resolution")return;let U=-1;JM(w,D);const z=window.setInterval(()=>{const rt=qR.get(w);if(!k("ENABLE_AG_ADAPTATION")||!rt)return KR(w,N),void W(D);const dt=G();if(dt.sendPackets>0&&dt.OutgoingAvailableBandwidth>0){if(U===-1)return void(U=Date.now());if(Date.now()-U<1e3)return;const ae=dt.sendFrameRate,se=dt.OutgoingAvailableBandwidth,[zt,ke]=N8(w,ae,se,rt.adaptationConfig,D,L);ke&&(N.qualityLimitationReason=ke),zt&&rt.adaptationConfig.scale!==zt.scale&&(T.debug("[".concat(w,"] applyAdaptation: ").concat(N.qualityLimitationReason,`
           sendFps `).concat(ae,", bwe ").concat(se,", switch from ").concat(rt.adaptationConfig.scale," to ").concat(zt.scale," ")),rt.adaptationConfig=sI(sI({},rt.adaptationConfig),zt),W(zt))}},k("CHECK_LOCAL_STATS_INTERVAL")),$=sI({},D);qR.set(w,{timer:z,adaptationConfig:$,originConfig:D,adaptationFunc:W}),T.debug("[".concat(w,"] start adaptation, originConfig: ").concat(JSON.stringify(D),", degradationPreference: ").concat(L))})(this.id+l.mid,d,this,C,w=>{n&&this.updateAdaptation(n,w)},this.getLocalVideoStats.bind(this))}if(e._encoderConfig){var p;const{bitrateMax:C,frameRate:w,scaleResolutionDownBy:D}=e._encoderConfig;C&&(c.maxBitrate=1e3*C),(mt(p=e._hints).call(p,Ye.LOW_STREAM)||e.isUseScaleResolutionDownBy)&&(w&&(c.maxFramerate=da(w)),D&&D>=1&&(c.scaleResolutionDownBy=D))}const{maxFramerate:m}=k("ENCODER_CONFIG_LIMIT");if(m&&typeof m=="number"&&(c.maxFramerate=c.maxFramerate?Math.min(c.maxFramerate,m):m),k("DSCP_TYPE")&&yl()){var _;const C=k("DSCP_TYPE");mt(_=["very-low","low","medium","high"]).call(_,C)&&(c.networkPriority=C)}const E=n.getParameters(),I=(r=E.encodings)===null||r===void 0?void 0:r[0];An()&&!I&&(s.encodings=[c]),I&&Object.assign(I,c),Object.assign(E,s),T.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(E.encodings))),await n.setParameters(E),await async function(C,w,D){try{var N;if(!be().supportSetRtpSenderParameters||!function(z){return z==="vp9"||z==="av1"}(C)||!k("ENABLE_SVC"))return;const L={},W={},G=w.getParameters(),U=(N=G.encodings)===null||N===void 0?void 0:N[0];W.scalabilityMode=LR(D),U&&Object.assign(U,W),Object.assign(G,L),await w.setParameters(G),T.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(G.encodings)))}catch(L){T.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",L)}}(this.store.codec,n,k("SVC_MODE"))}async updateAdaptation(e,n){var i,r;if(!e)return T.debug("[updateAdaptation] no rtpSender found");if(!be().supportSetRtpSenderParameters)return T.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const s={},{bitrateMax:c,frameRate:l,scaleResolutionDownBy:d}=n;c&&(s.maxBitrate=1e3*c),l&&(s.maxFramerate=da(l)),d&&d>=1&&mt(i=["vp8","vp9"]).call(i,this.store.codec)&&(s.scaleResolutionDownBy=d);const h=e.getParameters(),p=(r=h.encodings)===null||r===void 0?void 0:r[0];p&&Object.assign(p,s),Object.assign(h,{});try{await e.setParameters(h),T.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(h.encodings)))}catch(m){!("transport"in e)||e.transport&&e.transport.state==="connected"?this.peerConnectionState!=="connected"?T.debug("[updateAdaptation] peerConnection not connected}"):T.debug("[updateAdaptation] updateRtpSenderEncodings failed",m):T.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(e,n){try{if(!be().supportSetRtpSenderParameters||e.length!==n.length)return;for(let i=0;i<e.length;i++){const r=e[i],s=n[i];s instanceof sn&&!this.isVP8Simulcast(s)&&await this.updateRtpSenderEncodings(s,r.sender)}}catch{T.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,n,i){const r=Wr(e);return n.forEach((s,c)=>{const l=i[c],d=r.mediaDescriptions.find(h=>h.attributes.mid===l);d&&(Im(d,s),yM(d,s,this.store.codec))}),Hd(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,n,i)=>{var r;(r=this.onFirstVideoDecoded)===null||r===void 0||r.call(this,e,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(e,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,e,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,e,n)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,n){if(e.length===n.length)for(let d=0;d<e.length;d++){var i,r,s,c,l;const h=e[d],p=n[d];if(p instanceof sn&&!mt(i=p._hints).call(i,Ye.LOW_STREAM)&&(r=p._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((s=p._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(c=p._scalabilityMode)!==null&&c!==void 0&&c.numSpatialLayers&&((l=p._scalabilityMode)===null||l===void 0?void 0:l.numSpatialLayers)>1&&this.store.codec==="vp8"){const m={},_={high:1e3*(p._encoderConfig.bitrateMax-50),medium:5e4};m.encodings=[{rid:"m",active:!0,maxBitrate:_.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:_.high}];const E=h.sender.getParameters();await h.sender.setParameters(Object.assign(E,m))}}}async applySimulcastEncodings(e,n){if(!An()&&e.length===n.length)for(let i=0;i<e.length;i++){const r=n[i];if(r instanceof sn&&this.isVP8Simulcast(r)){const s=e[i],c={},l={high:1e3*(r._encoderConfig.bitrateMax-50),medium:5e4};c.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:l.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:l.medium,scaleResolutionDownBy:4}];const d=s.sender.getParameters();await s.sender.setParameters(Object.assign(d,c))}}}isVP8Simulcast(e){var n,i,r,s,c;return!!(e instanceof sn&&k("SIMULCAST")&&this.store.codec==="vp8"&&!mt(n=e._hints).call(n,Ye.LOW_STREAM)&&(i=e._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((r=e._encoderConfig)===null||r===void 0?void 0:r.bitrateMax)>200&&(s=e._scalabilityMode)!==null&&s!==void 0&&s.numSpatialLayers&&((c=e._scalabilityMode)===null||c===void 0?void 0:c.numSpatialLayers)>1)}logSDPExchange(e,n,i,r){if(k("SDP_LOGGING"))return T.upload("[".concat(this.store.clientId,"] exchanging ").concat(i," ").concat(n," SDP during P2PConnection.").concat(r,`
`),e),n==="offer"?s=>{this.logSDPExchange(s,"answer",i==="local"?"remote":"local",r)}:void 0}async getRemoteSSRC(e){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(e);return n&&n.length!==0?n[0].ssrcId:void 0}setConfiguration(e){if(be().supportPCSetConfiguration){const n=rp.resolvePCConfiguration(e);this.peerConnection.setConfiguration(n)}e.isPreallocation&&(this.isPreallocation=!0)}},Dt(Se.prototype,"updateRemoteRTPCapabilities",[Nr],Object.getOwnPropertyDescriptor(Se.prototype,"updateRemoteRTPCapabilities"),Se.prototype),Dt(Se.prototype,"connect",[Nr],Object.getOwnPropertyDescriptor(Se.prototype,"connect"),Se.prototype),Dt(Se.prototype,"updateRemoteConnect",[Nr],Object.getOwnPropertyDescriptor(Se.prototype,"updateRemoteConnect"),Se.prototype),Dt(Se.prototype,"createDataChannels",[Nr],Object.getOwnPropertyDescriptor(Se.prototype,"createDataChannels"),Se.prototype),Dt(Se.prototype,"receive",[Nr],Object.getOwnPropertyDescriptor(Se.prototype,"receive"),Se.prototype),Dt(Se.prototype,"batchReceive",[Nr],Object.getOwnPropertyDescriptor(Se.prototype,"batchReceive"),Se.prototype),Dt(Se.prototype,"stopReceiving",[Nr],Object.getOwnPropertyDescriptor(Se.prototype,"stopReceiving"),Se.prototype),Dt(Se.prototype,"muteRemote",[Nr],Object.getOwnPropertyDescriptor(Se.prototype,"muteRemote"),Se.prototype),Dt(Se.prototype,"unmuteRemote",[Nr],Object.getOwnPropertyDescriptor(Se.prototype,"unmuteRemote"),Se.prototype),Dt(Se.prototype,"muteLocal",[Nr],Object.getOwnPropertyDescriptor(Se.prototype,"muteLocal"),Se.prototype),Dt(Se.prototype,"unmuteLocal",[Nr],Object.getOwnPropertyDescriptor(Se.prototype,"unmuteLocal"),Se.prototype),Dt(Se.prototype,"close",[Nr],Object.getOwnPropertyDescriptor(Se.prototype,"close"),Se.prototype),Dt(Se.prototype,"updateEncoderConfig",[Nr],Object.getOwnPropertyDescriptor(Se.prototype,"updateEncoderConfig"),Se.prototype),Dt(Se.prototype,"updateSendParameters",[Nr],Object.getOwnPropertyDescriptor(Se.prototype,"updateSendParameters"),Se.prototype),Dt(Se.prototype,"replaceTrack",[Nr],Object.getOwnPropertyDescriptor(Se.prototype,"replaceTrack"),Se.prototype),Dt(Se.prototype,"updateAdaptation",[Nr],Object.getOwnPropertyDescriptor(Se.prototype,"updateAdaptation"),Se.prototype),Dt(Se.prototype,"getRemoteSSRC",[Nr],Object.getOwnPropertyDescriptor(Se.prototype,"getRemoteSSRC"),Se.prototype),Se);function Nr(t,e,n){const i=t[e];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const r=this.mutex,s=await r.lock("From P2PConnection.".concat(e));try{for(var c=arguments.length,l=new Array(c),d=0;d<c;d++)l[d]=arguments[d];return await i.apply(this,l)}finally{s()}},n}function dI(t,e){let n=document.createElement("video"),i=document.createElement("canvas");n.setAttribute("style","display:none"),i.setAttribute("style","display:none"),n.setAttribute("muted",""),n.muted=!0,n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),i.width=da(e.width),i.height=da(e.height);const r=da(e.framerate||15);document.body.append(n),document.body.append(i);let s=t._mediaStreamTrack;n.srcObject=new MediaStream([s]),n.play();const c=i.getContext("2d");if(!c)throw new K(P.UNEXPECTED_ERROR,"can not get canvas context");const l=be(),d=i.captureStream(l.supportRequestFrame?0:r).getVideoTracks()[0];d.canvas||(d.canvas=i),i.startCapture=()=>{if(!n)return i.stopCapture&&i.stopCapture();if(n.paused&&n.play(),n.videoHeight>2&&n.videoWidth>2){const p=n.videoWidth,m=n.videoHeight/p,_=i.width*m;Math.abs(_-i.height)>=2&&(T.debug("adjust low stream resolution","".concat(i.width,"x").concat(i.height," -> ").concat(i.width,"x").concat(_)),i.height=_)}c.drawImage(n,0,0,i.width,i.height),d.requestFrame&&d.requestFrame(),s!==t._mediaStreamTrack&&(s=t._mediaStreamTrack,n.srcObject=new MediaStream([s]))},i.stopCapture=mw(()=>i.startCapture&&i.startCapture(),r);const h=d.stop;return d.stop=()=>{h.call(d),n&&(n.remove(),n.srcObject=null,n=null),i&&(i.width=0,i.remove(),i.stopCapture&&i.stopCapture(),i.startCapture=void 0,i.stopCapture=void 0,i=null),T.debug("clean low stream renderer")},d}var n2=function(t){return t[t.Video_Send_Type=190]="Video_Send_Type",t}(n2||{}),No=function(t){return t[t.Video_Send_Qp_Sum=2143]="Video_Send_Qp_Sum",t[t.Video_Send_Freeze=2082]="Video_Send_Freeze",t[t.Video_Recv_Qp_Sum=2144]="Video_Recv_Qp_Sum",t[t.Video_Recv_Freeze=2084]="Video_Recv_Freeze",t[t.Video_Render_Freeze_Time=2109]="Video_Render_Freeze_Time",t[t.Video_Render_Freeze_Time_Render=2147]="Video_Render_Freeze_Time_Render",t[t.Video_Render_Freeze_Time_Render2=2223]="Video_Render_Freeze_Time_Render2",t[t.Audio_Recv_Freeze=2083]="Audio_Recv_Freeze",t}(No||{}),Jt=function(t){return t[t.Video_Send_Retransmit=2062]="Video_Send_Retransmit",t[t.Video_Send_Target_Encoded=2064]="Video_Send_Target_Encoded",t[t.Video_Send_Actual_Encoded=2060]="Video_Send_Actual_Encoded",t[t.Video_Send_Transmit=2066]="Video_Send_Transmit",t[t.Video_Send_Bandwidth=2061]="Video_Send_Bandwidth",t[t.Video_Capture_Height=2033]="Video_Capture_Height",t[t.Video_Capture_Width=2035]="Video_Capture_Width",t[t.Video_Capture_Frame_Rate=2034]="Video_Capture_Frame_Rate",t[t.Video_Send_Low_Height=2073]="Video_Send_Low_Height",t[t.Video_Send_Low_Frame_Rate=2075]="Video_Send_Low_Frame_Rate",t[t.Video_Send_Low_Width=2077]="Video_Send_Low_Width",t[t.Video_Send_Low_Bitrate=2069]="Video_Send_Low_Bitrate",t[t.Video_Send_Low_Package_Lost=2070]="Video_Send_Low_Package_Lost",t[t.Video_Send_Low_Package_Rate=2071]="Video_Send_Low_Package_Rate",t[t.Video_Send_Frame_Rate=2002]="Video_Send_Frame_Rate",t[t.Video_Send_Width=2003]="Video_Send_Width",t[t.Video_Send_Height=2004]="Video_Send_Height",t[t.Video_Send_Disabled=2095]="Video_Send_Disabled",t[t.Video_Send_Adaptation=2032]="Video_Send_Adaptation",t[t.Video_Send_Player_Status=2128]="Video_Send_Player_Status",t[t.Video_Send_Nacks=2009]="Video_Send_Nacks",t[t.Video_Send_Plis=2010]="Video_Send_Plis",t[t.Video_Send_Firs=2011]="Video_Send_Firs",t[t.Video_Send_Avg_Encode=2007]="Video_Send_Avg_Encode",t[t.Video_Send_Huge_Frame_Sent=2174]="Video_Send_Huge_Frame_Sent",t[t.Video_Send_Bytes_Retransmit=2173]="Video_Send_Bytes_Retransmit",t[t.Video_Send_Packages_Retransmit=2172]="Video_Send_Packages_Retransmit",t[t.Video_Send_Key_Frames_Encoded=2207]="Video_Send_Key_Frames_Encoded",t[t.Video_Send_Bitrate=2012]="Video_Send_Bitrate",t[t.Video_Send_Package_Rate=2031]="Video_Send_Package_Rate",t[t.Video_Send_Package_Lost=2005]="Video_Send_Package_Lost",t[t.Audio_Capture_PCM_Level=2104]="Audio_Capture_PCM_Level",t[t.Audio_Send_Level=2038]="Audio_Send_Level",t[t.Audio_Send_Bitrate=2039]="Audio_Send_Bitrate",t[t.Audio_Send_Package_Rate=2040]="Audio_Send_Package_Rate",t[t.Audio_Send_AEC_Return_Loss=2041]="Audio_Send_AEC_Return_Loss",t[t.Audio_Send_AEC_Return_Loss_Enhancement=2042]="Audio_Send_AEC_Return_Loss_Enhancement",t[t.Audio_Send_Freeze=2081]="Audio_Send_Freeze",t[t.Audio_Send_Disabled=2096]="Audio_Send_Disabled",t[t.Audio_Send_Bytes_Retransmit=2179]="Audio_Send_Bytes_Retransmit",t[t.Audio_Send_Packages_Retransmit=2180]="Audio_Send_Packages_Retransmit",t[t.Video_Recv_Height=2019]="Video_Recv_Height",t[t.Video_Recv_Width=2018]="Video_Recv_Width",t[t.Video_Recv_Frame_Rate_Output=2155]="Video_Recv_Frame_Rate_Output",t[t.Video_Recv_Jitter_Buffer=2023]="Video_Recv_Jitter_Buffer",t[t.Video_Recv_Current_Delay=2024]="Video_Recv_Current_Delay",t[t.Video_Recv_Nacks=2026]="Video_Recv_Nacks",t[t.Video_Recv_Plis=2027]="Video_Recv_Plis",t[t.Video_Recv_Firs=2028]="Video_Recv_Firs",t[t.Video_Recv_Disabled=2101]="Video_Recv_Disabled",t[t.Video_Recv_Player_Status=2129]="Video_Recv_Player_Status",t[t.Video_Recv_I_Frame_Delay=2149]="Video_Recv_I_Frame_Delay",t[t.Video_Render_Frame_Rate_Render=2022]="Video_Render_Frame_Rate_Render",t[t.Video_Render_Freeze_Duration=2156]="Video_Render_Freeze_Duration",t[t.Audio_Render_Level=2043]="Audio_Render_Level",t[t.Audio_Render_Freeze_Time_80ms=2226]="Audio_Render_Freeze_Time_80ms",t[t.Audio_Render_Freeze_Time_200ms=2227]="Audio_Render_Freeze_Time_200ms",t[t.Audio_Render_Freeze_Samples_80ms=2228]="Audio_Render_Freeze_Samples_80ms",t[t.Audio_Render_Freeze_Samples_200ms=2229]="Audio_Render_Freeze_Samples_200ms",t[t.Audio_Recv_PCM_Level=2105]="Audio_Recv_PCM_Level",t[t.Audio_Recv_Disabled=2102]="Audio_Recv_Disabled",t[t.Audio_Recv_Jitter_Buffer=2054]="Audio_Recv_Jitter_Buffer",t[t.Audio_Recv_Current_Delay=2047]="Audio_Recv_Current_Delay",t[t.Audio_Recv_Player_Status=2130]="Audio_Recv_Player_Status",t[t.Audio_Recv_Bitrate=2044]="Audio_Recv_Bitrate",t[t.Audio_Recv_Concealed_Samples=2148]="Audio_Recv_Concealed_Samples",t[t.Audio_Recv_Total_Samples_Received=2224]="Audio_Recv_Total_Samples_Received",t}(Jt||{}),Ci=function(t){return t[t.Video_Render_Frame_Rate_Decode=2021]="Video_Render_Frame_Rate_Decode",t[t.Video_Recv_Frame_Rate=2020]="Video_Recv_Frame_Rate",t[t.Video_Recv_Frame_Dropped=2181]="Video_Recv_Frame_Dropped",t[t.Video_Recv_Bytes_Retransmit=2175]="Video_Recv_Bytes_Retransmit",t[t.Video_Recv_Packages_Retransmit=2176]="Video_Recv_Packages_Retransmit",t[t.Video_Recv_Packages_Discarded=2198]="Video_Recv_Packages_Discarded",t[t.Video_Recv_Avg_Decode=2200]="Video_Recv_Avg_Decode",t[t.Video_Recv_Avg_Processing_Delay=2202]="Video_Recv_Avg_Processing_Delay",t[t.Video_Recv_Avg_Assembly_Time=2203]="Video_Recv_Avg_Assembly_Time",t[t.Video_Recv_Avg_Inter_Frame_Delay=2204]="Video_Recv_Avg_Inter_Frame_Delay",t[t.Video_Recv_Key_Frames_Decoded=2206]="Video_Recv_Key_Frames_Decoded",t[t.Video_Recv_Package_Lost=2014]="Video_Recv_Package_Lost",t[t.Video_Recv_Bitrate=2029]="Video_Recv_Bitrate",t[t.Video_Recv_Package_Rate=2078]="Video_Recv_Package_Rate",t[t.Audio_Recv_Jitter=2055]="Audio_Recv_Jitter",t[t.Audio_Recv_Bytes_Retransmit=2178]="Audio_Recv_Bytes_Retransmit",t[t.Audio_Recv_Packages_Retransmit=2177]="Audio_Recv_Packages_Retransmit",t[t.Audio_Recv_Packages_Discarded=2199]="Audio_Recv_Packages_Discarded",t[t.Audio_Recv_Avg_Processing_Delay=2201]="Audio_Recv_Avg_Processing_Delay",t[t.Audio_Recv_Package_Rate=2046]="Audio_Recv_Package_Rate",t[t.Audio_Recv_Package_Lost=2045]="Audio_Recv_Package_Lost",t}(Ci||{}),Dr=function(t){return t[t.RTT=2006]="RTT",t[t.CONN_TYPE=801]="CONN_TYPE",t[t.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",t}(Dr||{}),XR=function(t){return t[t.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",t}(XR||{});const zh=1e3,QR=6,Jg=3,k8=Math.max(QR,Jg,60);function jt(t,e,n){n!=null&&Number.isFinite(n)&&(t[e]=Math.round(Math.max(0,n)))}function i2(t){const e={[Dr.CONN_TYPE]:0,[Dr.RTT]:t.rtt,[Dr.STATS_UPDATE_INTERVAL]:t.updateInterval?Math.round(Math.max(0,t.updateInterval)):void 0};switch(t.selectedCandidatePair.localCandidate.candidateType){case"relay":{const n=t.selectedCandidatePair.localCandidate.relayProtocol;n==="udp"&&(e[Dr.CONN_TYPE]=1),n==="tcp"&&(e[Dr.CONN_TYPE]=3),n==="tls"&&(e[Dr.CONN_TYPE]=4);break}case"srflx":e[Dr.CONN_TYPE]=2;break;case"unknown":e[Dr.CONN_TYPE]=5;break;default:e[Dr.CONN_TYPE]=0}return e}function r2(t){let e=0;switch(t){case"none":e=0;break;case"cpu":e=1;break;case"bandwidth":e=2;break;case"other":e=3}return e}class a2 extends Sn{constructor(e){super(),O(this,"store",void 0),O(this,"uploadWRTCStatsTimer",void 0),O(this,"uploadOutboundDenoiserStatsTimer",void 0),O(this,"uploadExtStatsTimer",void 0),O(this,"uploadExtUsageStatsTimer",void 0),O(this,"uploadInboundExtStatsTimer",void 0),O(this,"requestStats",void 0),O(this,"requestTransportStats",void 0),O(this,"requestLocalMedia",void 0),O(this,"requestRemoteMedia",void 0),O(this,"requestAllTracks",void 0),O(this,"requestVideoIsReady",void 0),O(this,"requestUploadStats",void 0),O(this,"requestUpload",void 0),O(this,"uploadOutboundStarted",!1),O(this,"uploadInboundStarted",!1),O(this,"uploadTransportStarted",!1),O(this,"uploadBaseStatsStarted",!1),O(this,"uploadExtensionUsageStarted",!1),O(this,"lastRecvStats",void 0),O(this,"lastSendStats",void 0),O(this,"lastRefRecvStats",void 0),O(this,"lastRefSendStats",void 0),O(this,"lastNormalRecvStats",void 0),O(this,"lastNormalSendStats",void 0),O(this,"lastExtendStats",{}),O(this,"needUploadStats",{}),O(this,"needUploadRenderFreezeTime",!0),O(this,"lastUploadCompensateTime",-1),O(this,"uploadCompensateDeltaTime",0),this.store=e}uploadWRTCStats(e){if(!this.requestStats||!this.requestUploadStats)return;const n=e%Jg==0,i=e%QR==0,r=e%60==0;let s,c;if(this.uploadTransportStarted&&(s=this.requestStats(),this.store.useP2P&&(c=this.requestStats(!0))),!s&&this.uploadOutboundStarted&&(s=this.requestStats()),!c&&this.uploadInboundStarted&&(c=this.requestStats(!0)),s||c){var l;const d={};if(this.uploadTransportStarted&&s){const p=this.getTransportStats(s,c,n);p&&(d.misc=[p])}if(this.uploadOutboundStarted&&s){const p=this.getOutboundStats(s,i?this.lastNormalSendStats:void 0,n?this.lastRefSendStats:void 0,this.lastSendStats,r);p&&(d.outbound=[p])}if(this.uploadInboundStarted&&c){this.uploadCompensateStats(e);const p=this.getInboundStats(c,i?this.lastNormalRecvStats:void 0,n?this.lastRefRecvStats:void 0,this.lastRecvStats);p&&(d.inbound=p)}const h=(l=this.requestTransportStats)===null||l===void 0?void 0:l.call(this).connectState;h&&(Array.isArray(d.misc)?d.misc[0]&&d.misc[0].addition&&(d.misc[0].addition[XR.RTC_PEER_CONNECTION_STATE]=$A[h]):d.misc=[{addition:{[XR.RTC_PEER_CONNECTION_STATE]:$A[h]}}]),this.needUploadStats.sendType&&(Array.isArray(d.outbound)&&d.outbound[0]&&d.outbound[0].high&&(d.outbound[0].high[n2.Video_Send_Type]=this.needUploadStats.sendType),this.needUploadStats.sendType=void 0),this.requestUploadStats(d)}this.lastRecvStats=c,this.lastSendStats=s,i&&(this.lastNormalRecvStats=c,this.lastNormalSendStats=s),n&&(this.lastRefRecvStats=c,this.lastRefSendStats=s)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let e=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var n,i;const r=(n=this.requestTransportStats)===null||n===void 0?void 0:n.call(this);return void(r&&((i=this.requestUploadStats)===null||i===void 0||i.call(this,{misc:[{addition:{[XR.RTC_PEER_CONNECTION_STATE]:$A[r.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(e),++e===k8+1&&(e=1)},zh)}uploadCompensateStats(e){if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const n=e%Jg==0&&this.needUploadRenderFreezeTime;if(!this.uploadInboundStarted||!n)return;if(this.lastUploadCompensateTime===-1)return void(this.lastUploadCompensateTime=Date.now());const i=Math.max(-6e3,Date.now()-this.lastUploadCompensateTime-6e3);if(this.uploadCompensateDeltaTime+=i,this.lastUploadCompensateTime=Date.now(),this.uploadCompensateDeltaTime<6e3)return;const r=Math.min(Math.floor(this.uploadCompensateDeltaTime/6e3),10);this.uploadCompensateDeltaTime-=6e3*r;const s=this.requestStats(!0);new Array(r).fill(0).forEach(()=>{if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const c={};if(this.uploadInboundStarted&&s){const l=this.requestRemoteMedia()||[],d=[];l.forEach(h=>{let[p,m]=h;const _={peer:p.uid};if(p._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(p._videoSSRC)&&m.has(Ct.VIDEO)&&p.videoTrack){const E=function(I,C,w){if(!C.videoRecv.find(N=>N.ssrc===I))return;const D={};if(w&&w._player){const N=w._player,{renderFreezeAccTime2:L,videoElementStatus:W}=N;if(yc.visibility==="visible"&&W===zi.PLAYING&&be().supportRequestVideoFrameCallback){const G=Math.min(6e3,L);N.renderFreezeAccTime2=Math.max(0,L-G),jt(D,No.Video_Render_Freeze_Time_Render2,G),k("USE_NEW_RENDER_FREEZE_TIME")&&jt(D,No.Video_Render_Freeze_Time_Render,G)}}return D}(p._videoSSRC,s,p.videoTrack);E&&(_.video=E)}_.video&&d.push(_)}),d.length>0&&(c.inbound=d,this.requestUploadStats(c))}})}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0}getTransportStats(e,n,i){if(!this.requestStats)return;if(!i)return e.rtt==null?void 0:{addition:{[Dr.RTT]:e.rtt,[Dr.CONN_TYPE]:void 0,[Dr.STATS_UPDATE_INTERVAL]:e.updateInterval||void 0}};const r=i2(e);if(this.store.useP2P){if(n){const s=i2(n);r[Dr.CONN_TYPE]+=s[Dr.CONN_TYPE]<<3}r[Dr.CONN_TYPE]+=110}else r[Dr.CONN_TYPE]+=100;return{addition:r}}getOutboundStats(e,n,i,r,s){if(!this.requestUploadStats||!this.requestLocalMedia)return;const c=this.requestLocalMedia();if(!c||c.length===0)return;let l,d,h;return c.forEach(p=>{let[m,{track:_,ssrcs:E}]=p;switch(m){case ot.LocalVideoLowTrack:case ot.LocalVideoTrack:if(m===ot.LocalVideoTrack){var I;const C=function(L,W,G,U,z,$){const rt=W.videoSend.find(zt=>zt.ssrc===L);if(!rt)return;const dt={},{sentFrame:ae,inputFrame:se}=rt;if(U&&(jt(dt,No.Video_Send_Qp_Sum,rt.qpSumPerFrame),se&&ae)){const zt=se.frameRate,ke=ae.frameRate;dt[No.Video_Send_Freeze]=function(De,Xi){let it=!0;return it=!(De<=5)&&(De<=10?Xi<3:De<=20?Xi<4:Xi<5),it}(zt,ke)?1:0}if(z){switch(ae&&(jt(dt,Jt.Video_Send_Height,ae.height),jt(dt,Jt.Video_Send_Width,ae.width),jt(dt,Jt.Video_Send_Frame_Rate,ae.frameRate)),dt[Jt.Video_Send_Disabled]=G._originMediaStreamTrack&&!G._originMediaStreamTrack.enabled||G._mediaStreamTrack&&!G._mediaStreamTrack.enabled?1:0,rt.adaptionChangeReason){case"none":dt[Jt.Video_Send_Adaptation]=0;break;case"cpu":dt[Jt.Video_Send_Adaptation]=1;break;case"bandwidth":dt[Jt.Video_Send_Adaptation]=2;break;case"other":dt[Jt.Video_Send_Adaptation]=3}let zt=0;rt.adaptionChangeReason&&(zt+=r2(rt.adaptionChangeReason)),W.qualityLimitationReason&&(zt+=r2(W.qualityLimitationReason)<<3),dt[Jt.Video_Send_Adaptation]=zt,dt[Jt.Video_Send_Player_Status]=pw[G._player?G._player.videoElementStatus:"uninit"],jt(dt,Jt.Video_Send_Nacks,rt.nacksCount),jt(dt,Jt.Video_Send_Plis,rt.plisCount),jt(dt,Jt.Video_Send_Firs,rt.firsCount),jt(dt,Jt.Video_Send_Avg_Encode,rt.avgEncodeMs),jt(dt,Jt.Video_Send_Huge_Frame_Sent,rt.hugeFramesSent),jt(dt,Jt.Video_Send_Bytes_Retransmit,rt.retransmittedBytesSent),jt(dt,Jt.Video_Send_Packages_Retransmit,rt.retransmittedPacketsSent),jt(dt,Jt.Video_Send_Key_Frames_Encoded,rt.keyFramesEncoded);const ke=z.videoSend.find(De=>De.ssrc===L);if(ke){let De=zh*Jg;ke.timestamp&&rt.timestamp&&(De=rt.timestamp-ke.timestamp),ke.packets!=null&&rt.packets!=null&&jt(dt,Jt.Video_Send_Package_Rate,1e3*(rt.packets-ke.packets)/De),rt.packetsLost!=null&&ke.packetsLost!=null&&jt(dt,Jt.Video_Send_Package_Lost,rt.packetsLost-ke.packetsLost),ke.bytes!=null&&rt.bytes!=null&&jt(dt,Jt.Video_Send_Bitrate,8*(rt.bytes-ke.bytes)/De)}}return dt}(E[0].ssrcId,e,_,n,i),w=_.__className__==="CameraVideoTrack"?3:mt(I=_._hints).call(I,Ye.SCREEN_TRACK)?7:10;(this.lastExtendStats.sendType!==w||s)&&(this.needUploadStats={sendType:w},this.lastExtendStats.sendType=w);const D=_&&function(L,W,G,U){const z=W.videoSend.find(rt=>rt.ssrc===L);if(!z)return null;const $={};if(U){const rt=z.inputFrame,dt=rt&&rt.height||G.videoHeight||0,ae=rt&&rt.width||G.videoWidth||0,se=rt&&rt.frameRate||0;jt($,Jt.Video_Capture_Height,dt),jt($,Jt.Video_Capture_Width,ae),jt($,Jt.Video_Capture_Frame_Rate,se)}return $}(E[0].ssrcId,e,_,!!i),N=function(L,W){const G={};return W&&(jt(G,Jt.Video_Send_Retransmit,L.bitrate.retransmit),jt(G,Jt.Video_Send_Target_Encoded,L.bitrate.targetEncoded),jt(G,Jt.Video_Send_Actual_Encoded,L.bitrate.actualEncoded),jt(G,Jt.Video_Send_Transmit,L.bitrate.transmit),jt(G,Jt.Video_Send_Bandwidth,L.sendBandwidth)),G}(e,!!i);d=Object.assign({},C,D,N)}else h=function(C,w,D,N,L){const W=w.videoSend.find(U=>U.ssrc===C);if(!W)return;const G={};if(N){const U=W.sentFrame;U&&(jt(G,Jt.Video_Send_Low_Height,U.height),jt(G,Jt.Video_Send_Low_Width,U.width),jt(G,Jt.Video_Send_Low_Frame_Rate,U.frameRate));const z=N.videoSend.find($=>$.ssrc===C);if(z){let $=zh*QR;z.timestamp&&W.timestamp&&($=W.timestamp-z.timestamp),z.packets!=null&&W.packets!=null&&jt(G,Jt.Video_Send_Low_Package_Rate,1e3*(W.packets-z.packets)/$),W.packetsLost!=null&&z.packetsLost!=null&&jt(G,Jt.Video_Send_Low_Package_Lost,W.packetsLost-z.packetsLost),z.bytes!=null&&W.bytes!=null&&jt(G,Jt.Video_Send_Low_Bitrate,8*(W.bytes-z.bytes)/$)}}return G}(E[0].ssrcId,e,0,i);break;case ot.LocalAudioTrack:l=_&&function(C,w,D,N,L,W){const G=w.audioSend.find(z=>z.ssrc===C);if(!G)return;const U={};if(L){U[Jt.Audio_Send_Disabled]=D._originMediaStreamTrack&&!D._originMediaStreamTrack.enabled||D._mediaStreamTrack&&!D._mediaStreamTrack.enabled?1:0;const z=100*D._source.getAccurateVolumeLevel(),$=G.inputLevel;if($!=null){const dt=Math.ceil(50*Math.log10(100*$+1));jt(U,Jt.Audio_Send_Level,dt)}jt(U,Jt.Audio_Capture_PCM_Level,z),jt(U,Jt.Audio_Send_AEC_Return_Loss,G.aecReturnLoss),jt(U,Jt.Audio_Send_AEC_Return_Loss_Enhancement,G.aecReturnLossEnhancement),jt(U,Jt.Audio_Send_Bytes_Retransmit,G.retransmittedBytesSent),jt(U,Jt.Audio_Send_Packages_Retransmit,G.retransmittedPacketsSent),U[Jt.Audio_Send_Freeze]=0;const rt=L.audioSend.find(dt=>dt.ssrc===C);if(rt){let dt=zh*QR;rt.timestamp&&G.timestamp&&(dt=G.timestamp-rt.timestamp),rt.bytes!=null&&G.bytes!=null&&jt(U,Jt.Audio_Send_Bitrate,8*(G.bytes-rt.bytes)/dt),rt.packets!=null&&G.packets!=null&&jt(U,Jt.Audio_Send_Package_Rate,1e3*(G.packets-rt.packets)/dt)}}return U}(E[0].ssrcId,e,_,0,i)}}),{high:d,low:h,audio:l}}getInboundStats(e,n,i,r){if(!this.requestRemoteMedia)return;const s=this.requestRemoteMedia()||[],c=[];return s.forEach(l=>{let[d,h]=l;const p={peer:d.uid};if(h.has(Ct.VIDEO)&&d.videoTrack){const m=d._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(d._videoSSRC)||!1,_=d.videoTrack?function(E,I,C,w,D,N,L,W){const G=I.videoRecv.find(zt=>zt.ssrc===E);if(!G)return;const U={},{receivedFrame:z,outputFrame:$,decodeFrameRate:rt}=G;jt(U,Ci.Video_Render_Frame_Rate_Decode,rt),G.framesRateFirefox&&jt(U,Ci.Video_Recv_Frame_Rate,G.framesRateFirefox),z&&jt(U,Ci.Video_Recv_Frame_Rate,z.frameRate),jt(U,Ci.Video_Recv_Frame_Dropped,G.framesDroppedCount),jt(U,Ci.Video_Recv_Bytes_Retransmit,G.retransmittedBytesReceived),jt(U,Ci.Video_Recv_Packages_Retransmit,G.retransmittedPacketsReceived),jt(U,Ci.Video_Recv_Packages_Discarded,G.packetsDiscarded),jt(U,Ci.Video_Recv_Avg_Decode,G.avgDecodeMs),jt(U,Ci.Video_Recv_Avg_Processing_Delay,G.avgProcessingDelayMs),jt(U,Ci.Video_Recv_Avg_Assembly_Time,G.avgFramesAssembledFromMultiplePacketsMs),jt(U,Ci.Video_Recv_Avg_Inter_Frame_Delay,G.avgInterFrameDelayMs),jt(U,Ci.Video_Recv_Key_Frames_Decoded,G.keyFramesDecoded);const dt=W&&W.videoRecv.find(zt=>zt.ssrc===E);if(dt){const zt=I.timestamp-W.timestamp||zh;G.packetsLost!=null&&dt.packetsLost!=null&&jt(U,Ci.Video_Recv_Package_Lost,G.packetsLost-dt.packetsLost),dt.bytes!=null&&G.bytes!=null&&jt(U,Ci.Video_Recv_Bitrate,8*(G.bytes-dt.bytes)/zt),dt.packets!=null&&G.packets!=null&&jt(U,Ci.Video_Recv_Package_Rate,1e3*(G.packets-dt.packets)/zt)}const ae=N&&N.videoRecv.find(zt=>zt.ssrc===E);if(ae&&(jt(U,No.Video_Recv_Qp_Sum,G.qpSumPerFrame),U[No.Video_Recv_Freeze]=w&&Qg.isRemoteVideoFreeze(C,G,ae)?1:0),L){var se;const zt=L.videoRecv.find(De=>De.ssrc===E);z?(jt(U,Jt.Video_Recv_Height,z.height),jt(U,Jt.Video_Recv_Width,z.width)):C&&(jt(U,Jt.Video_Recv_Height,C._videoHeight||0),jt(U,Jt.Video_Recv_Width,C._videoWidth||0)),$&&jt(U,Jt.Video_Recv_Frame_Rate_Output,$.frameRate);const ke=(se=C._player)===null||se===void 0?void 0:se.rendFrameRate.toFixed(0);if(ke&&jt(U,Jt.Video_Render_Frame_Rate_Render,+ke),jt(U,Jt.Video_Recv_Jitter_Buffer,G.jitterBufferMs),jt(U,Jt.Video_Recv_Current_Delay,G.currentDelayMs),jt(U,Jt.Video_Recv_Firs,G.firsCount),jt(U,Jt.Video_Recv_Nacks,G.nacksCount),jt(U,Jt.Video_Recv_Plis,G.plisCount),C){U[Jt.Video_Recv_Disabled]=C._originMediaStreamTrack.enabled&&C._mediaStreamTrack.enabled?0:1;const De=C._player;if(De){const{freezeTimeCounterList:Xi,renderFreezeAccTime:it,renderFreezeAccTime2:ft,videoElementStatus:wt}=De;if(Xi&&Xi.length>0&&jt(U,No.Video_Render_Freeze_Time,Xi.splice(0,1)[0]),D&&yc.visibility==="visible"&&wt===zi.PLAYING&&be().supportRequestVideoFrameCallback){const at=Math.min(6e3,ft);De.renderFreezeAccTime2=Math.max(0,ft-at),jt(U,No.Video_Render_Freeze_Time_Render2,at);const b=Math.min(6e3,it);De.renderFreezeAccTime=Math.max(0,it-b),jt(U,No.Video_Render_Freeze_Time_Render,k("USE_NEW_RENDER_FREEZE_TIME")?at:b)}if(typeof G.totalFreezesDuration=="number"){const at=zt&&zt.totalFreezesDuration?G.totalFreezesDuration-zt.totalFreezesDuration:G.totalFreezesDuration;jt(U,Jt.Video_Render_Freeze_Duration,1e3*at)}}}if(U[Jt.Video_Recv_Player_Status]=pw[C._player?C._player.videoElementStatus:"uninit"],zt&&G.totalInterFrameDelay!==void 0&&G.totalSquaredInterFrameDelay!==void 0&&zt.totalInterFrameDelay!==void 0&&zt.totalSquaredInterFrameDelay!==void 0){const De=G.totalInterFrameDelay-zt.totalInterFrameDelay,Xi=G.totalSquaredInterFrameDelay-zt.totalSquaredInterFrameDelay,it=G.framesDecodeCount-zt.framesDecodeCount,ft=De/it*1e3,wt=Math.round(1e3*Math.sqrt((Xi-Math.pow(De,2)/it)/it));!isNaN(wt)&&ft+wt>Math.max(3*ft,ft+150)&&(U[Jt.Video_Recv_I_Frame_Delay]=wt)}}return U}(d._videoSSRC,e,d.videoTrack,m===!0,this.needUploadRenderFreezeTime,n,i,r):void 0;_&&(p.video=_)}if(h.has(Ct.AUDIO)&&d.audioTrack){const m=d.audioTrack?function(_,E,I,C,w,D){const N=E.audioRecv.find(U=>U.ssrc===_);if(!N)return;const L={};jt(L,Ci.Audio_Recv_Jitter,N.jitterMs),jt(L,Ci.Audio_Recv_Bytes_Retransmit,N.retransmittedBytesReceived),jt(L,Ci.Audio_Recv_Packages_Retransmit,N.retransmittedPacketsReceived),jt(L,Ci.Audio_Recv_Packages_Discarded,N.packetsDiscarded),jt(L,Ci.Audio_Recv_Avg_Processing_Delay,N.avgProcessingDelayMs);const W=D&&D.audioRecv.find(U=>U.ssrc===_);if(W){const U=zh;N.packets!=null&&W.packets!=null&&jt(L,Ci.Audio_Recv_Package_Rate,1e3*(N.packets-W.packets)/U),N.packetsLost!=null&&W.packetsLost!=null&&jt(L,Ci.Audio_Recv_Package_Lost,N.packetsLost-W.packetsLost)}if(C){const{receivedFrames:U,droppedFrames:z}=N;U!=null&&z!=null&&(L[No.Audio_Recv_Freeze]=(G=U)===0||100*z/G>20?1:0)}var G;if(w){const U=100*I._source.getAccurateVolumeLevel(),z=N.outputLevel;if(z!=null){const rt=Math.ceil(50*Math.log10(100*z+1));jt(L,Jt.Audio_Render_Level,rt)}jt(L,Jt.Audio_Recv_PCM_Level,U),I&&(L[Jt.Audio_Recv_Disabled]=I._originMediaStreamTrack.enabled&&I._mediaStreamTrack.enabled?0:1),jt(L,Jt.Audio_Recv_Jitter_Buffer,N.jitterBufferMs),jt(L,Jt.Audio_Recv_Current_Delay,N.jitterBufferMs),L[Jt.Audio_Recv_Player_Status]=pw[Or.getPlayerState(I.getTrackId())];const $=w.audioRecv.find(rt=>rt.ssrc===_);if($){$.bytes!=null&&N.bytes!=null&&jt(L,Jt.Audio_Recv_Bitrate,8*(N.bytes-$.bytes)/(zh*Jg));const rt=N.concealedSamples-$.concealedSamples;rt>0&&jt(L,Jt.Audio_Recv_Concealed_Samples,rt);const dt=N.totalSamplesReceived-$.totalSamplesReceived;dt>0&&jt(L,Jt.Audio_Recv_Total_Samples_Received,dt);const ae=N.freezeSamples80-$.freezeSamples80;ae>0&&jt(L,Jt.Audio_Render_Freeze_Samples_80ms,ae);const se=N.freezeSamples200-$.freezeSamples200;se>0&&jt(L,Jt.Audio_Render_Freeze_Samples_200ms,se);const zt=N.freezeMs80-$.freezeMs80;jt(L,Jt.Audio_Render_Freeze_Time_80ms,zt<0?0:zt);const ke=N.freezeMs200-$.freezeMs200;jt(L,Jt.Audio_Render_Freeze_Time_200ms,ke<0?0:ke)}}return L}(d._audioSSRC,e,d.audioTrack,n,i,r):void 0;m&&(p.audio=m)}(p.video||p.audio)&&c.push(p)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,c}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const e=(this.requestAllTracks()||[]).find(n=>n instanceof Vg);if(e&&e._external.getDenoiserStats){const n=e._external.getDenoiserStats();n&&this.requestUpload(Bg.DENOISER_STATS,n)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(e=>{e.getProcessorStats().forEach(n=>{this.requestUpload&&this.requestUpload(n.type,n.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0,this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(e=>{let[n,i]=e;i.has(Ct.VIDEO)&&n.videoTrack&&n.videoTrack.getProcessorStats().forEach(r=>{this.requestUpload&&this.requestUpload(r.type,r.stats)}),i.has(Ct.AUDIO)&&n.audioTrack&&n.audioTrack.getProcessorStats().forEach(r=>{this.requestUpload&&this.requestUpload(r.type,r.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0,this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=void 0)}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const e=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const n=Date.now(),i={connectionInterval:k("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:n};let r=[];const s=this.requestAllTracks&&this.requestAllTracks()||[];for(const h of s)!h.muted&&h.enabled&&(r=r.concat(await h.getProcessorUsage()));const c=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[h,p]of c)p.has(Ct.VIDEO)&&h.videoTrack&&(r=r.concat(await h.videoTrack.getProcessorUsage())),p.has(Ct.AUDIO)&&h.audioTrack&&(r=r.concat(await h.audioTrack.getProcessorUsage()));if(r.length===0)return;i.details=function(h,p){const m={};for(const{id:C,value:w,level:D,direction:N}of h){var _;const L=(_=p.get(C))!==null&&_!==void 0?_:0,W=w===2?L+k("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:L;var E,I;p.set(C,W),m[C]?(w===2&&(m[C].value=w),D>m[C].level&&(m[C].level=D),N==="remote"&&(m[C].remoteUidCount+=1),m[C].totalTs=(E=p.get(C))!==null&&E!==void 0?E:0):m[C]={value:w,level:D,remoteUidCount:N==="local"?0:1,totalTs:(I=p.get(C))!==null&&I!==void 0?I:0}}return Object.keys(m).map(C=>{const{level:w,value:D,totalTs:N}=m[C];return{id:C,level:w,value:D,totalTs:N}})}(r,e);const l=Date.now(),d=l>n?l:n+1;this.requestUpload&&this.requestUpload(Bg.EXTENSION_USAGE_STATS,{usageStats:i,sendTs:d})},k("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const L8=k("ICE_RESTART_INTERVAL");let JR=new Map,km=new Map,tu=[Ki.UDP_TCP_RELAY,Ki.TCP_RELAY,Ki.RELAY],uI=k("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&be().supportPCSetConfiguration;function s2(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=JR.get(t.id);n&&(window.clearTimeout(n),JR.delete(t.id));const i=km.get(t.id);e&&i&&i.index===tu.length-1&&(T.debug("[".concat(t.id,"] reset ICE restart policy")),km.delete(t.id))}function o2(t,e,n){if(JR.size===0&&km.size===0&&(Array.isArray(k("RESTART_SEQUENCE"))&&k("RESTART_SEQUENCE").length>0&&!function(l,d){if(l.length!==d.length)return!1;for(let h=0;h<l.length;h+=1){const p=l[h];if(l.filter(m=>m===p).length!==d.filter(m=>m===p).length)return!1}return!0}(tu,k("RESTART_SEQUENCE"))&&(tu=k("RESTART_SEQUENCE").filter(l=>{var d;if(mt(d=Object.values(Ki)).call(d,l))return!0}),T.debug("use reconnection policy from config distribution, queues: ".concat(tu.join(" => ")))),uI=k("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&be().supportPCSetConfiguration),tu.length===0)return void n();let i,{index:r=0,type:s}=km.get(t.id)||{};if(uI&&s===Ki.RELAY)return void n();let c=s&&r>=tu.length-1;if(uI)s=Ki.RELAY;else{if(c)return void n();s?(r++,s=tu[r]):(s=tu[0],r=0)}T.debug("[".concat(t.id,"] choose ICE restart policy: ").concat(s,", index: ").concat(r)),e(s),km.set(t.id,{index:r,type:s}),i=window.setTimeout(()=>o2(t,e,n),L8),JR.set(t.id,i)}var de;function c2(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Cc(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?c2(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):c2(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function l2(t){var e,n,i,r=2;for(typeof Symbol<"u"&&(n=AA,i=Symbol.iterator);r--;){if(n&&(e=t[n])!=null)return e.call(t);if(i&&(e=t[i])!=null)return new ZR(e.call(t));n="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function ZR(t){function e(n){if(Object(n)!==n)return Tt.reject(new TypeError(n+" is not an object."));var i=n.done;return Tt.resolve(n.value).then(function(r){return{value:r,done:i}})}return ZR=function(n){this.s=n,this.n=n.next},ZR.prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(n){var i=this.s.return;return i===void 0?Tt.resolve({value:n,done:!0}):e(i.apply(this.s,arguments))},throw:function(n){var i=this.s.return;return i===void 0?Tt.reject(n):e(i.apply(this.s,arguments))}},new ZR(t)}let Zg=(de=class extends Sn{get state(){return this._state}set state(t){const e=this._state;this._state=t,this.emit(Mt.StateChange,e,this._state)}constructor(t,e){super(),O(this,"isPlanB",void 0),O(this,"store",void 0),O(this,"statsUploader",void 0),O(this,"connection",void 0),O(this,"localTrackMap",new Map),O(this,"remoteUserMap",new Map),O(this,"localDataChannels",[]),O(this,"remoteDataChannelMap",new Map),O(this,"pendingLocalTracks",[]),O(this,"pendingRemoteTracks",[]),O(this,"pendingLocalDataChannels",[]),O(this,"pendingRemoteDataChannels",[]),O(this,"statsCollector",void 0),O(this,"shouldForwardP2PCreation",void 0),O(this,"iceFailedCount",0),O(this,"dtlsFailedCount",0),O(this,"mutex",void 0),O(this,"_state",Me.Disconnected),O(this,"_pcStatsUploadType",k("NEW_ICE_RESTART")?Al.FIRST_CONNECTION:Al.OLD_FIRST_CONNECTION),O(this,"_isStartRestartIce",!1),O(this,"_restartTimer",void 0),O(this,"_isTryConnecting",!1),O(this,"_iceError",null),O(this,"_forceTurn",!1),O(this,"_isWaitPcToRePub",!1),O(this,"handleMuteLocalTrack",async(n,i,r)=>{const s=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==Me.Connected)return void r(new Z(P.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const c=this.filterTobeMutedTracks(n);if(c.length===0)return void i();const l=c.find(h=>h[0]==="videoLowTrack");if(l){const h=l[1];this.store.enableInstantMuteRestore?(h.track._originMediaStreamTrack.enabled=!1,T.info("[".concat(this.store.clientId,"] P2PChannel muteLocalLowTrack without close sender because enableInstantMuteRestore is true"))):h.track._originMediaStreamTrack.stop()}this.store.enableInstantMuteRestore?T.info("[".concat(this.store.clientId,"] P2PChannel muteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.muteLocal(c.map(h=>{let[,{id:p}]=h;return p}));const d=this.createMuteMessage(c);await Qe(this,Mt.RequestMuteLocal,d),i()}catch(c){r(c)}finally{s()}}),O(this,"handleUnmuteLocalTrack",async(n,i,r)=>{const s=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==Me.Connected)return void r(new Z(P.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const c=this.filterTobeUnmutedTracks(n);if(c.length===0)return void i();const l=c.find(h=>h[0]==="videoLowTrack");if(l){const h=l[1];if(this.store.enableInstantMuteRestore)h.track._originMediaStreamTrack.enabled=!0,T.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalLowTrack without close sender because enableInstantMuteRestore is true"));else{if(h.track._originMediaStreamTrack.stop(),!k("DISABLE_DUAL_STREAM_USE_ENCODING")&&be().supportDualStreamEncoding){const p=n._mediaStreamTrack.clone();h.track._mediaStreamTrack=p,h.track._originMediaStreamTrack=p}else{const p=dI(n,Dg(this,Mt.RequestLowStreamParameter));h.track._mediaStreamTrack=p,h.track._originMediaStreamTrack=p}await new Tt((p,m)=>{this.handleReplaceTrack(h.track,p,m,!0)})}}this.store.enableInstantMuteRestore?T.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.unmuteLocal(c.map(h=>{let[,{id:p}]=h;return p}));const d=this.createUnmuteMessage(c);await Qe(this,Mt.RequestUnmuteLocal,d),i()}catch(c){r(c)}finally{s()}}),O(this,"handleUpdateVideoEncoder",async(n,i,r,s)=>{let c;s||(c=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const d=this.localTrackMap.get(ot.LocalVideoTrack);if(!this.connection||!d||d.track!==n||this.state!==Me.Connected)return void i();const{id:h,track:p}=d;await this.connection.updateSendParameters(h,p),await this.connection.updateEncoderConfig(h,p),this.emit(Mt.UpdateVideoEncoder,p),i()}catch(d){r(d)}finally{var l;(l=c)===null||l===void 0||l()}}),O(this,"handleUpdateVideoSendParameters",async(n,i,r)=>{const s=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const c=this.localTrackMap.get(ot.LocalVideoTrack);if(!this.connection||!c||c.track!==n||this.state!==Me.Connected)return void i();const{id:l,track:d}=c;await this.connection.updateSendParameters(l,d),i()}catch(c){r(c)}finally{s()}}),O(this,"handleReplaceMixingTrack",async(n,i,r,s)=>{if(!this.connection||this.state!==Me.Connected)return void i();const c=cI([n]);let l;T.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(c.getTrackId(),"]")),typeof s=="boolean"&&s||(l=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(n,c),i()}catch(h){r(h)}finally{var d;(d=l)===null||d===void 0||d()}}),O(this,"handleReplaceTrack",async(n,i,r,s)=>{let c;T.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof s=="boolean"&&s||(c=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var l;const h=Array.from(this.localTrackMap.entries()).find(p=>{let[,{track:m}]=p;return n===m});if(!this.connection||!h||this.state!==Me.Connected)return void i();if(await((l=this.connection)===null||l===void 0?void 0:l.replaceTrack(n,h[1].id)),this.isPlanB){const p=h[1];p.id=n._mediaStreamTrack.id,this.localTrackMap.set(h[0],p)}if(h[0]===ot.LocalVideoTrack&&!k("DISABLE_DUAL_STREAM_USE_ENCODING")&&be().supportDualStreamEncoding){const p=this.localTrackMap.get(ot.LocalVideoLowTrack);if(p){const m=n._mediaStreamTrack.clone();p.track._originMediaStreamTrack.stop(),p.track._mediaStreamTrack=m,p.track._originMediaStreamTrack=m,await new Tt((_,E)=>{this.handleReplaceTrack(p.track,_,E,!0)})}}i()}catch(h){r(h)}finally{var d;(d=c)===null||d===void 0||d()}}),O(this,"handleGetRTCStats",n=>{n(this.statsCollector.getRTCStats())}),O(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),O(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),O(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),O(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=t,this.statsCollector=e,this.statsCollector.addP2PChannel(this),this.statsUploader=new a2(this.store),this.bindStatsUploaderEvents(),this.mutex=new Wi("P2PChannel-mutex",this.store.clientId),this.isPlanB=!be().supportUnifiedPlan||k("CHROME_FORCE_PLAN_B")&&yl(),this.shouldForwardP2PCreation=k("FORWARD_P2P_CREATION")&&be().supportPCSetConfiguration&&BA(),this.shouldForwardP2PCreation&&(this.connection=YR(this.store),this.emit(Mt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(t,e){var n;this.state=Me.New,this._forceTurn=t2(t),T.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const i=this.shouldForwardP2PCreation&&((n=this.connection)===null||n===void 0?void 0:n.peerConnectionState)==="closed";if((!this.shouldForwardP2PCreation||i||e)&&((i||e)&&this.connection&&(T.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=YR(this.store,t),this.emit(Mt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new Z(P.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=k("NEW_ICE_RESTART")?Al.FIRST_CONNECTION:Al.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(t),this.connection.establishPromise}async connect(t){if(!this.connection)throw new Z(P.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");if(this.isPreallocation()&&this.state===Me.Connected){if(this.connection instanceof rs&&this.connection.checkDtlsParameters(t.dtlsParameters.fingerprints))return T.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] dtls parameters mismatch, try next.")),Pt.reportApiInvoke(this.store.sessionId,{name:kn.MISMATCH_DTLS_PARAMETERS,options:[t.dtlsParameters.fingerprints],tag:_n.TRACER}).onSuccess(),void setTimeout(()=>{this.emit(Mt.RequestReconnect)});await this.connection.updateRemoteConnect(t)}else this.store.peerConnectionStart(),await this.connection.connect(t),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Me.Connected}updateRemoteRTPCapabilities(t){const e=Array.from(this.localTrackMap.entries()).filter(r=>{var s;let[c]=r;return mt(s=[ot.LocalVideoLowTrack,ot.LocalVideoTrack]).call(s,c)}),n=e.map(r=>{let[,{id:s}]=r;return s}),i=e.map(r=>{let[s]=r;return s});if(this.connection instanceof rs){if(Pt.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(i),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(t)}),!mt(t).call(t,this.store.codec)){const r=["vp9","vp8","h264"].find(s=>mt(t).call(t,s));r&&(this.store.codec=r,T.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(r,".")))}this.connection.updateRemoteRTPCapabilities(n,t)}}async getEstablishParams(){var t;if(this.connection instanceof rs&&this.connection.peerConnectionState!=="closed"&&mt(t=[Me.New,Me.Connected]).call(t,this.state))return this.connection.establishPromise}async publishDataChannel(t){if(!this.connection||this.state!==Me.Connected){if(this.state===Me.Disconnected)throw new Z(P.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return t.forEach(n=>{var i;mt(i=this.pendingLocalDataChannels).call(i,n)||this.pendingLocalDataChannels.push(n)}),[]}const e=this.filterTobePublishedDataChannels(t);return e.length===0?[]:(e.forEach(n=>{const i=Date.now();this.store.publish(n.id.toString(),"datachannel",i)}),await this.connection.createDataChannels(this.store.uid,e),e.forEach(n=>{this.localDataChannels.push(n);const i=Date.now();this.store.publish(n.id+"","datachannel",void 0,i)}),t.map(n=>({streamId:n.id,ordered:n.ordered,maxRetransmits:n.maxRetransmits,metadata:n.metadata,channelId:n._originDataChannelId})))}publish(t,e,n){var i=this;return Za(function*(){const r=yield Re(i.mutex.lock("From P2PChannel.publish"));try{var s;const c=i.connection&&mt(s=["disconnected","failed"]).call(s,i.connection.peerConnectionState);if(!i.connection||i.state!==Me.Connected||c){if(i.state===Me.Disconnected)throw new Z(P.UNEXPECTED_ERROR,"PeerConnection already disconnected.");i.throwIfTrackTypeNotMatch(t);const d=t.filter(h=>i.pendingLocalTracks.indexOf(h)===-1);return i.pendingLocalTracks=i.pendingLocalTracks.concat(d),void(c&&(i._isWaitPcToRePub=!0))}i.store.pubId=i.store.pubId+1,Yi.markPublishStart(i.store.clientId,i.store.pubId);const l=i.filterTobePublishedTracks(t,e,n);if(l.length===0)return void(yield Re(i.tryToUnmuteAudio(t)));yield*Wy(l2(i.doPublish(i.connection,l)))}finally{r()}})()}doPublish(t,e){var n=this;return Za(function*(){e.forEach(_=>{let{track:E,type:I}=_;const C=Date.now();n.store.publish(E.getTrackId(),I===ot.LocalAudioTrack?"audio":"video",C)}),n.bindLocalTrackEvents(e);const i=e.map(_=>{let{track:E}=_;return E}),r=yield Re(t.send(i,n.store.codec,n.store.audioCodec)),s=(yield Re(r.next())).value,c=n.createGatewayPublishMessage(e,s);let l;try{l=yield c}catch(_){throw r.throw(_),(_==null?void 0:_.code)===P.WS_ABORT&&e.forEach(E=>{let{track:I}=E;n.pendingLocalTracks.indexOf(I)===-1&&n.pendingLocalTracks.push(I)}),n.unbindLocalTrackEvents(e),_}const d=n.mapPubResToRemoteConfig(c,l,i),h=(yield Re(r.next(d))).value;if(n.state===Me.Disconnected)throw new Z(P.UNEXPECTED_ERROR,"PeerConnection already disconnected.");k("ENABLE_VIDEO_SEI");const p=k("ENABLE_ENCODED_TRANSFORM"),m=k("ENABLE_AUDIO_METADATA");i.forEach(async _=>{const E=_.getRTCRtpTransceiver();if(!E||!p)return;const{interceptLocalVideoFrame:I,interceptLocalAudioFrame:C}=jR();_.trackMediaType===Ct.VIDEO?await I(E.sender,_):_.trackMediaType===Ct.AUDIO&&await C(E.sender,{metadata:m?()=>{const w=_.metadata.shift();return w&&w.value}:void 0})}),e.forEach(_=>{let{type:E}=_;n.statsCollector.addLocalStats(E)}),n.assignLocalTracks(e,h),n.statsUploader.startUploadOutboundStats(),e.forEach(_=>{let{track:E,type:I}=_;const C=Date.now();n.store.publish(E.getTrackId(),I===ot.LocalAudioTrack?"audio":"video",void 0,C)})})()}async updateVideoStreamParameter(t,e){const n=this.localTrackMap.get(e);if(!n||!this.connection)return;if(!(n.track instanceof sn))return T.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:i}=n,r=function(s,c){const l={};return s.height&&s.width&&(l.scaleResolutionDownBy=Ww(s,c)),l.maxFramerate=s.framerate?da(s.framerate):void 0,l.maxBitrate=s.bitrate?1e3*s.bitrate:void 0,l}(t,i);if(i._encoderConfig||(i._encoderConfig={}),e!==ot.LocalVideoLowTrack||!k("DISABLE_DUAL_STREAM_USE_ENCODING")&&be().supportDualStreamEncoding)r.scaleResolutionDownBy!=null&&(i._encoderConfig.scaleResolutionDownBy=r.scaleResolutionDownBy);else{const s=i._originMediaStreamTrack;if(!s.canvas)return T.warn("[".concat(i.getTrackId(),"] no canvas on track"));(function(c,l){const d=c.canvas;l.width&&(d.width=da(l.width)),l.height&&(d.height=da(l.height)),l.framerate&&(d.stopCapture&&d.stopCapture(),d.stopCapture=mw(()=>{!d.startCapture&&d.stopCapture&&d.stopCapture(),d.startCapture&&d.startCapture()},da(l.framerate)))})(s,t)}r.maxBitrate!=null&&(i._encoderConfig.bitrateMax=r.maxBitrate/1e3),r.maxFramerate!=null&&(i._encoderConfig.frameRate&&typeof i._encoderConfig.frameRate=="object"?i._encoderConfig.frameRate.max=r.maxFramerate:i._encoderConfig.frameRate={max:r.maxFramerate}),T.debug("[".concat(i.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(i._encoderConfig))),await this.connection.updateRtpSenderEncodings(i)}publishLowStream(t){var e=this;return Za(function*(){if(!e.connection||e.state!==Me.Connected)return;const n=yield Re(e.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const r=e.localTrackMap.get(ot.LocalVideoTrack);if(!r)throw new Z(P.UNEXPECTED_ERROR,"Could not find high stream");if(e.localTrackMap.has(ot.LocalVideoLowTrack))throw new Z(P.UNEXPECTED_ERROR,"[".concat(e.store.clientId,"] Can't publish low stream when stream already publish"));const s=[{track:e.getLowVideoTrack(r.track,t),type:ot.LocalVideoLowTrack}];if(yield*Wy(l2(e.doPublish(e.connection,s))),r.track.muted||!r.track.enabled){var i;const c=(i=e.localTrackMap.get(ot.LocalVideoLowTrack))===null||i===void 0?void 0:i.id;c!==void 0&&(yield Re(e.connection.muteLocal([c])))}}finally{n()}})()}async republish(){this.pendingLocalTracks.length>0&&(T.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await ki(this,Mt.RequestRePublish,this.pendingLocalTracks),this.emit(Mt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(T.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await ki(this,Mt.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(t){for(let e=this.pendingRemoteTracks.length-1;e>=0;e--){const{user:n,kind:i}=this.pendingRemoteTracks[e];(i!==Ct.AUDIO||n._audio_added_&&n._audioSSRC)&&(i!==Ct.VIDEO||n._video_added_&&n._videoSSRC)||this.pendingRemoteTracks.splice(e,1)}if(t)await ki(this,Mt.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:e,kind:n}of this.pendingRemoteTracks)await this.subscribe(e,n,n===Ct.VIDEO?e._videoSSRC:e._audioSSRC);this.pendingRemoteTracks.forEach(e=>{let{user:n}=e;this.emit(Mt.MediaReconnectEnd,n.uid)}),this.pendingRemoteTracks=[]}async unpublish(t){if(!this.connection||this.state!==Me.Connected)return void t.forEach(i=>{const r=this.pendingLocalTracks.indexOf(i);r!==-1&&this.pendingLocalTracks.splice(r,1)});const e=this.filterTobeUnpublishedTracks(t);if(e.length===0)return;const n=e.find(i=>i[0]==="videoLowTrack");return n&&n[1].track.close(),this.doUnpublish(this.connection,e)}async unpublishDataChannel(t){if(!this.connection||this.state!==Me.Connected)return void t.forEach(n=>{const i=this.pendingLocalDataChannels.indexOf(n);i!==-1&&this.pendingLocalDataChannels.splice(i,1)});const e=this.filterTobeUnpublishedDataChannels(t);return e.length!==0?(e.forEach(n=>{const i=this.localDataChannels.indexOf(n);i!==-1&&this.localDataChannels.splice(i,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),e.map(n=>n.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==Me.Connected)return;const t=this.localTrackMap.get(ot.LocalVideoLowTrack);if(!t)return;t.track.close();const e=[[ot.LocalVideoLowTrack,t]];return this.doUnpublish(this.connection,e)}async doUnpublish(t,e){const n=this.createGatewayUnpublishMessage(e);return await t.stopSending(e.map(i=>{let[,{id:r}]=i;return r})),this.withdrawLocalTracks(e),this.unbindLocalTrackEvents(e.map(i=>{let[r,{track:s}]=i;return{type:r,track:s}})),e.forEach(i=>{let[r]=i;this.statsCollector.removeLocalStats(r)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),n}async subscribeDataChannel(t,e){if(!this.connection||this.state!==Me.Connected)throw new Z(P.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const n=e.filter(i=>{var r;return!((r=this.remoteDataChannelMap.get(t))!==null&&r!==void 0&&r.get(i.id))});if(n.length!==0)return await this.connection.createDataChannels(t.uid,n),n.forEach(i=>{var r;this.remoteDataChannelMap.has(t)?(r=this.remoteDataChannelMap.get(t))===null||r===void 0||r.set(i.id,i):this.remoteDataChannelMap.set(t,new Map([[i.id,i]]));const s=this.pendingRemoteDataChannels.findIndex(c=>{let{user:l,id:d}=c;return l.uid===t.uid&&d===i.id});s!==-1&&this.pendingRemoteDataChannels.splice(s,1)}),n.map(i=>i.id)}async subscribe(t,e,n,i,r){var s;if(!this.connection||this.state!==Me.Connected)throw new Z(P.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((s=this.remoteUserMap.get(t))!==null&&s!==void 0&&s.has(e))return;let c,l,d,h;const p=this.connection.getPreMedia(n);if(p)T.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(n,", no need to send sub to gateway.")),d=p.transceiver,c=p.track,l=p.mid,h=p.player,p.firstVideoRender&&this.store.firstVideoFrameDecoded(t.uid,{firstPreRender:p.firstVideoRender});else if(r){const E=r.find(C=>{let{stream_type:w}=C;return w===e});if(!E)throw new Z(P.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(e," for user: ").concat(t.uid," because subscribe answer from gateway does not contain stream_type: ").concat(e,"."));const I=await this.connection.receive(e,E.ssrcs,String(t._uintid),E.attributes);this.connection instanceof rs&&(d=I.transceiver),c=I.track,l=I.id}else{const E=await this.connection.receive(e,[{ssrcId:n,rtx:i}],String(t._uintid),void 0);this.connection instanceof rs&&(d=E.transceiver),c=E.track,l=E.id}if(e===Ct.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(c):(t._audioTrack=new Sm(c,t.uid,t._uintid,this.store),T.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),d&&t._audioTrack._updateRtpTransceiver(d),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(c):(t._videoTrack=new vm(c,t.uid,t._uintid,this.store,h),T.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId())),t._videoTrack.once(es.PLAY_START,()=>{this.store.firstVideoFrameDecoded(t.uid,{playStart:Date.now()})}),t._videoTrack.once(es.PLAY_END,()=>{this.store.firstVideoFrameDecoded(t.uid,{playEnd:Date.now()}),this.reportVideoFirstFrameRender(t)}),h?t._videoTrack.once(es.FIRST_FRAME_RENDER,()=>{this.store.firstVideoFrameDecoded(t.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(t)}):t._videoTrack.once(es.FIRST_FRAME_DECODED,()=>{this.store.firstVideoFrameDecoded(t.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(t)})),d&&t._videoTrack._updateRtpTransceiver(d),this.bindRemoteTrackEvents(t,t._videoTrack)),d&&k("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:E,interceptRemoteAudioFrame:I}=jR();e==Ct.VIDEO?await E(d.receiver,{onSei:k("ENABLE_VIDEO_SEI")&&(C=>{var w;return(w=t._videoTrack)===null||w===void 0?void 0:w._onSei(C)})}):e==Ct.AUDIO&&await I(d.receiver,{enableTopn:!!k("ENABLE_AUDIO_TOPN"),enableMetadata:!!k("ENABLE_AUDIO_METADATA"),enablePts:!!k("ENABLE_AUDIO_PTS"),onMetadata:C=>{this.safeEmit(Mt.AudioMetadata,C)},onPts:C=>{this.safeEmit(Mt.AudioPts,C)}})}const m=this.remoteUserMap.get(t);m?m.set(e,l):this.remoteUserMap.set(t,new Map([[e,l]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats();const _=this.pendingRemoteTracks.findIndex(E=>{let{user:I,kind:C}=E;return I.uid===t.uid&&e===C});_!==-1&&(this.pendingRemoteTracks.splice(_,1),this.emit(Mt.MediaReconnectEnd,t.uid))}async massSubscribe(t){return this.massSubscribeNoLock(t)}async massSubscribeNoLock(t){if(!this.connection||this.state!==Me.Connected)throw new Z(P.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");t=t.filter(r=>{var s;let{user:c,mediaType:l}=r;return!((s=this.remoteUserMap.get(c))!==null&&s!==void 0&&s.has(l))});const e=[],n=new Map;t.forEach(r=>{if(!this.connection)return;const s=this.connection.getPreMedia(r.ssrcId);if(s){const{track:c,mid:l,transceiver:d,player:h}=s;n.set(r.ssrcId,{track:c,id:l,transceiver:d,player:h})}else e.push(r)});const i=await this.connection.batchReceive(e.map(r=>{let{user:s,mediaType:c,ssrcId:l,rtxSsrcId:d}=r;return{kind:c,ssrcMsg:[{ssrcId:l,rtx:d}],mslabel:String(s._uintid)}}));e.forEach((r,s)=>{n.set(r.ssrcId,i[s])});for(const{user:r,mediaType:s,ssrcId:c}of t){const l=n.get(c);if(!l)return void T.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(r.uid," subscribe data,").concat(s,", ").concat(c));const{track:d,id:h,transceiver:p,player:m}=l;if(p&&k("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:I,interceptRemoteAudioFrame:C}=jR();s==Ct.VIDEO?await I(p.receiver,{onSei:k("ENABLE_VIDEO_SEI")&&(w=>{var D;return(D=r._videoTrack)===null||D===void 0?void 0:D._onSei(w)})}):s==Ct.AUDIO&&await C(p.receiver,{enableTopn:!!k("ENABLE_AUDIO_TOPN"),enableMetadata:!!k("ENABLE_AUDIO_METADATA"),enablePts:!!k("ENABLE_AUDIO_PTS"),onMetadata:w=>{this.safeEmit(Mt.AudioMetadata,w)},onPts:w=>{this.safeEmit(Mt.AudioPts,w)}})}if(s===Ct.AUDIO?(r._audioTrack?r._audioTrack._updateOriginMediaStreamTrack(d):(r._audioTrack=new Sm(d,r.uid,r._uintid,this.store),T.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(r._audioTrack.getTrackId()))),p&&r._audioTrack._updateRtpTransceiver(p),this.bindRemoteTrackEvents(r,r._audioTrack)):(r._videoTrack?r._videoTrack._updateOriginMediaStreamTrack(d):(r._videoTrack=new vm(d,r.uid,r._uintid,this.store,m),T.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(r._videoTrack.getTrackId()))),p&&r._videoTrack._updateRtpTransceiver(p),this.bindRemoteTrackEvents(r,r._videoTrack)),k("ENABLE_VIDEO_SEI")&&p){const{interceptRemoteVideoFrame:I,interceptRemoteAudioFrame:C}=jR();s==Ct.VIDEO?await I(p.receiver,{onSei:w=>{var D;(D=r._videoTrack)===null||D===void 0||D._onSei(w)}}):s==Ct.AUDIO&&await C(p.receiver)}const _=this.remoteUserMap.get(r);_?_.set(s,h):this.remoteUserMap.set(r,new Map([[s,h]])),this.statsCollector.addRemoteStats(r.uid),this.statsUploader.startUploadInboundStats();const E=this.pendingRemoteTracks.findIndex(I=>{let{user:C,kind:w}=I;return C.uid===r.uid&&s===w});E!==-1&&(this.pendingRemoteTracks.splice(E,1),this.emit(Mt.MediaReconnectEnd,r.uid))}}async unsubscribe(t,e,n){const i=this.pendingRemoteTracks.filter(c=>{let{user:l,kind:d}=c;return e!==void 0?l.uid===t.uid&&e===d:l.uid===t.uid});if(i.forEach(c=>{const l=this.pendingRemoteTracks.indexOf(c);this.pendingRemoteTracks.splice(l,1)}),this.connection&&this.state===Me.Connected||n||i.forEach(c=>{let{kind:l}=c;var d;if(l===Ct.AUDIO)(d=t._audioTrack)===null||d===void 0||d._destroy(),t._audioTrack=void 0;else if(l===Ct.VIDEO){var h;(h=t._videoTrack)===null||h===void 0||h._destroy(),t._videoTrack=void 0}}),!this.connection||this.state!==Me.Connected)return;const r=this.filterTobeUnSubscribedTracks(t,e);if(r.length===0)return;await this.connection.stopReceiving(r.map(c=>{let[,{id:l}]=c;return l}));const s=this.createUnsubscribeMessage(r);return this.withdrawRemoteTracks(r),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),r.forEach(c=>{let[l,{kind:d}]=c;var h,p;if(d===Ct.VIDEO&&l._videoSSRC&&((h=this.connection)===null||h===void 0||h.setStatsRemoteVideoIsReady(l._videoSSRC,!1)),d===Ct.VIDEO)this.unbindRemoteTrackEvents(l._videoTrack),n||((p=l._videoTrack)===null||p===void 0||p._destroy(),l._videoTrack=void 0);else if(d===Ct.AUDIO){var m;this.unbindRemoteTrackEvents(l._audioTrack),!n&&((m=l._audioTrack)===null||m===void 0||m._destroy(),l._audioTrack=void 0)}}),s}async unsubscribeDataChannel(t,e){if(e.forEach(r=>{const s=this.pendingRemoteDataChannels.findIndex(c=>c.id===r.id);s!==-1&&this.pendingRemoteDataChannels.splice(s,1)}),!this.connection)return;const n=this.filterTobeUnSubscribedDataChannels(t,e);if(n.length===0)return;e.forEach(r=>{r._close()});const i=this.remoteDataChannelMap.get(t);return n.forEach(r=>{i&&i.delete(r.id)}),i&&i.size===0&&(this.remoteDataChannelMap.delete(t),await this.connection.stopDataChannels(t.uid)),n.map(r=>r.id)}async massUnsubscribe(t){return this.massUnsubscribeNoLock(t)}async massUnsubscribeNoLock(t){let e=[];for(const{user:r,mediaType:s}of t){const c=this.pendingRemoteTracks.filter(l=>{let{user:d,kind:h}=l;return s!==void 0?d.uid===r.uid&&s===h:d.uid===r.uid});c.forEach(l=>{const d=this.pendingRemoteTracks.indexOf(l);this.pendingRemoteTracks.splice(d,1)}),e=e.concat(c)}if(!this.connection||this.state!==Me.Connected)return void e.forEach(r=>{let{user:s,kind:c}=r;var l;if(c===Ct.AUDIO)(l=s._audioTrack)===null||l===void 0||l._destroy(),s._audioTrack=void 0;else if(c===Ct.VIDEO){var d;(d=s._videoTrack)===null||d===void 0||d._destroy(),s._videoTrack=void 0}});const n=Vr(t).call(t,(r,s)=>{let{user:c,mediaType:l}=s;const d=this.filterTobeUnSubscribedTracks(c,l);return r.concat(d)},[]);if(n.length===0)return;await this.connection.stopReceiving(n.map(r=>{let[,{id:s}]=r;return s}));const i=this.createUnsubscribeAllMessage(n);return this.withdrawRemoteTracks(n),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),n.forEach(r=>{let[s,{kind:c}]=r;var l,d;if(c===Ct.VIDEO&&s._videoSSRC&&((l=this.connection)===null||l===void 0||l.setStatsRemoteVideoIsReady(s._videoSSRC,!1)),c===Ct.VIDEO)this.unbindRemoteTrackEvents(s._videoTrack),(d=s._videoTrack)===null||d===void 0||d._destroy(),s._videoTrack=void 0;else if(c===Ct.AUDIO){var h;this.unbindRemoteTrackEvents(s._audioTrack),(h=s._audioTrack)===null||h===void 0||h._destroy(),s._audioTrack=void 0}}),i}isPreSubScribe(t){return!this.connection||this.state!==Me.Connected?!1:!!this.connection.getPreMedia(t)}async muteRemote(t,e){if(!this.connection)return;const n=this.remoteUserMap.get(t);if(!n)return void T.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid,"."));if(!n.get(e))return void T.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."));const i=e===Ct.VIDEO?t._videoSSRC:t._audioSSRC;i!==void 0&&this.connection.setStatsRemoteVideoIsReady(i,!1)}async unmuteRemote(t,e){return this.unmuteRemoteNoLock(t,e)}async unmuteRemoteNoLock(t,e){if(!this.connection)return;const n=this.remoteUserMap.get(t);if(!n)return void T.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid,"."));n.get(e)||T.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."))}addAudioMetadata(t){const e=this.localTrackMap.get(ot.LocalAudioTrack),n=e&&e.track;n&&n.metadata.push(t)}getAllTracks(t){const e=this.localTrackMap.get(ot.LocalAudioTrack);if((e==null?void 0:e.track)instanceof $n){const n=e.track;return Array.from(this.localTrackMap.entries()).filter(i=>{let[r]=i;return r!==ot.LocalAudioTrack}).filter(i=>{let[r]=i;return!(t&&r===ot.LocalVideoLowTrack)}).map(i=>{let[,{track:r}]=i;return r}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[i]=n;return!(t&&i===ot.LocalVideoLowTrack)}).map(n=>{let[,{track:i}]=n;return i})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(t,e,n,i,r){if(t){const c=this.localTrackMap.get(ot.LocalAudioTrack),l=i?this.localTrackMap.get(ot.LocalVideoLowTrack):this.localTrackMap.get(ot.LocalVideoTrack);Pt.publish(this.store.sessionId,{eventElapse:Yi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:c==null?void 0:c.track.getTrackLabel(),videoName:l==null?void 0:l.track.getTrackLabel(),screenshare:(l==null?void 0:l.track._hints.indexOf(Ye.SCREEN_TRACK))!==-1,audio:!!c,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}else{var s;n||(n=[]);const c=n.find(d=>d instanceof Nn),l=i?(s=this.localTrackMap.get(ot.LocalVideoTrack))===null||s===void 0?void 0:s.track:n.find(d=>d instanceof sn);Pt.publish(this.store.sessionId,{eventElapse:Yi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:c==null?void 0:c.getTrackLabel(),videoName:l==null?void 0:l.getTrackLabel(),screenshare:(l==null?void 0:l._hints.indexOf(Ye.SCREEN_TRACK))!==-1,audio:!!c,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}}reportSubscribeEvent(t,e,n,i){const r=i===Ct.VIDEO?n._videoSSRC:n._audioSSRC;r&&Pt.subscribe(this.store.sessionId,{succ:t,ec:e,video:i===Ct.VIDEO,audio:i===Ct.AUDIO,peerid:n.uid,subscribeRequestid:r,p2pid:this.store.p2pId,eventElapse:Yi.measureFromSubscribeStart(this.store.clientId,r),preSsrc:this.isPreSubScribe(r)})}reset(){T.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Wi("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=YR(this.store),this.emit(Mt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(ot.LocalAudioTrack);if((t==null?void 0:t.track)instanceof $n){if(t.track.trackList.length>0){const e=t.track;t.track.trackList.forEach(n=>{e.removeAudioTrack(n)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=Me.Disconnected}getStats(){var t;return(t=this.connection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(t){var e;return((e=this.connection)===null||e===void 0?void 0:e.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(ot.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(ot.LocalVideoTrack);if(t)return{width:t.track.videoWidth||0,height:t.track.videoHeight||0}}getEncoderConfig(t){const e=this.localTrackMap.get(t);return e&&e.track instanceof sn||e&&e.track instanceof Nn?e.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,e){if(!t)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(t);return!!n&&(!e||n.has(e))}async hasRemoteMediaWithLock(t,e){if(!t)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(t);return!!n&&(!e||n.has(e))}getRemoteMedia(t){var e;const n=Array.from(zr(e=this.remoteUserMap).call(e)).find(i=>i.uid===t);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(n=>{let[i]=n;return{uid:i.uid,level:i.audioTrack?100*i.audioTrack._source.getAccurateVolumeLevel():0}});const e=this.localTrackMap.get(ot.LocalAudioTrack);return e&&t.push({level:100*e.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=Zt(t).call(t,(n,i)=>n.level-i.level),t}async disconnectForReconnect(){this.connection&&(T.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=Me.Reconnecting,k("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e]=t;var n;e._videoTrack&&e._videoTrack._player&&((n=e._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),e._videoTrack._player.isKeepLastFrame=!0,e._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=YR(this.store),this.emit(Mt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var e;let[n,{track:i}]=t;switch(n){case ot.LocalVideoTrack:mt(e=i._hints).call(e,Ye.LOW_STREAM)?i.close():this.pendingLocalTracks.push(i);break;case ot.LocalAudioTrack:i instanceof $n?this.pendingLocalTracks=this.pendingLocalTracks.concat(i.trackList):this.pendingLocalTracks.push(i);case ot.LocalVideoLowTrack:}}),this.emit(Mt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,n]=t;Array.from(zr(n).call(n)).forEach(i=>{this.setPendingRemoteMedia(e,i)}),this.emit(Mt.MediaReconnectStart,e.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(t=>{this.pendingLocalDataChannels.push(t)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(t=>{let[e,n]=t;Array.from(zr(n).call(n)).forEach(i=>{this.setPendingRemoteDataChannel(e,i)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),T.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(t,e){for(const n of this.pendingRemoteDataChannels){const{user:i,id:r}=n;if((t instanceof $d?t.uid:t)===i.uid&&r===e)return!0}return!1}setPendingRemoteDataChannel(t,e){this.hasPendingRemoteDataChannel(t,e)||this.pendingRemoteDataChannels.push({user:t,id:e})}hasPendingRemoteMedia(t,e){for(const n of this.pendingRemoteTracks){const{user:i,kind:r}=n;if((t instanceof $d?t.uid:t)===i.uid&&e===r)return!0}return!1}setPendingRemoteMedia(t,e){this.hasPendingRemoteMedia(t,e)||this.pendingRemoteTracks.push({user:t,kind:e})}restartICE(t){var e=this;return Za(function*(){if(!e.connection||e.state!==Me.Connected)return;const n=yield Re(e.mutex.lock("From P2PChannel.restartICE"));let i;try{i=yield Re(e.connection.restartICE(t));const s=yield Re(i.next());if(s.done)return;const c=s.value,l=yield c;switch(lI(e.connection)&&e.reportPCStats(Date.now(),!1,e._pcStatsUploadType),t){case Ki.UDP_TCP_RELAY:e._pcStatsUploadType=Al.UDP_TCP_RESTART;break;case Ki.TCP_RELAY:e._pcStatsUploadType=Al.TCP_RESTART;break;case Ki.RELAY:e._pcStatsUploadType=Al.RELAY_RESTART;break;default:e._pcStatsUploadType=Al.OLD_RESTART}e._isTryConnecting=!0,i.next(l)}catch(s){var r;(r=i)===null||r===void 0||r.throw(s)}finally{n()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats(),e=this.localTrackMap.get(ot.LocalVideoTrack),n=this.localTrackMap.get(ot.LocalAudioTrack),i=t.videoSend.find(E=>E.ssrc===(e==null?void 0:e.ssrcs[0].ssrcId)),r=t.audioSend.find(E=>E.ssrc===(n==null?void 0:n.ssrcs[0].ssrcId));if(!i||!r)return 1;const s=Ca(this,Mt.NeedSignalRTT),c=i?i.rttMs:void 0,l=r?r.rttMs:void 0,d=c&&l?(c+l)/2:c||l,h=(d&&s?(d+s)/2:d||s)||0,p=100*t.sendPacketLossRate*.7/50+.3*h/1500,m=p<.17?1:p<.36?2:p<.59?3:p<.1?4:5,_=e==null?void 0:e.track;if(_&&_._encoderConfig&&_._hints.indexOf(Ye.SCREEN_TRACK)===-1){const E=_._encoderConfig.bitrateMax,I=t.bitrate.actualEncoded;if(E&&I){const C=(1e3*E-I)/(1e3*E);return Xx[C<.15?0:C<.3?1:C<.45?2:C<.6?3:4][m]}}return m}getDownlinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats();let e=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[i]=n;const r=i._audioSSRC,s=i._videoSSRC,c=t.audioRecv.find(I=>I.ssrc===r),l=t.videoRecv.find(I=>I.ssrc===s);if(!c&&!l)return void(e+=1);const d=Ca(this,Mt.NeedSignalRTT),h=t.rtt,p=(h&&d?(h+d)/2:h||d)||0,m=c?c.jitterMs:void 0,_=t.recvPacketLossRate;let E=.7*_*100/50+.3*p/1500;m&&(E=.6*_*100/50+.2*p/1500+.2*m/400),e+=E<.1?1:E<.17?2:E<.36?3:E<.59?4:5}),this.remoteUserMap.size>0?Math.round(e/this.remoteUserMap.size):e}async muteLocalTrack(t){return new Tt((e,n)=>{this.handleMuteLocalTrack(t,e,n)})}async replaceTrack(t,e){var n;if(T.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(t.getTrackId(),"] to [").concat(e.getTrackId(),"]")),!this.connection||this.state!==Me.Connected)return;const i=Array.from(this.localTrackMap.entries()).find(s=>{let[,{track:c}]=s;return t===c});if(!i)return;const r=i[0];if(t!==e&&(this.unbindLocalTrackEvents([{track:t,type:r}]),this.bindLocalTrackEvents([{track:e,type:r}]),i[1].track=e),await((n=this.connection)===null||n===void 0?void 0:n.replaceTrack(e,i[1].id)),this.isPlanB){const s=i[1];s.id=e._mediaStreamTrack.id,this.localTrackMap.set(r,s)}if(r===ot.LocalVideoTrack&&!k("DISABLE_DUAL_STREAM_USE_ENCODING")&&be().supportDualStreamEncoding){const s=this.localTrackMap.get(ot.LocalVideoLowTrack);if(s){const c=t._mediaStreamTrack.clone();s.track._originMediaStreamTrack.stop(),s.track._mediaStreamTrack=c,s.track._originMediaStreamTrack=c,await new Tt((l,d)=>{this.handleReplaceTrack(s.track,l,d,!0)})}}}filterTobePublishedTracks(t,e,n){const i=[],r=this.getAllTracks();t=sm(t=t.filter(d=>r.indexOf(d)===-1));let s,c=!1;const l=this.localTrackMap.get(ot.LocalAudioTrack);for(const d of t){if(d instanceof sn&&(this.localTrackMap.has(ot.LocalVideoTrack)||c?new Z(P.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(i.push({track:d,type:ot.LocalVideoTrack}),c=!0),e)){const h=this.getLowVideoTrack(d,n);i.push({track:h,type:ot.LocalVideoLowTrack})}if(d instanceof Nn)if(l){const h=l.track;if(h instanceof $n)oI([d]),h.addAudioTrack(d),this.bindLocalAudioTrackEvents(d,!0);else{const p=cI([h,d]);T.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(p.getTrackId(),"]")),this.replaceTrack(h,p)}}else s instanceof $n?(oI([d]),s.addAudioTrack(d)):s||!d._useAudioElement&&be().webAudioMediaStreamDest&&!d._bypassWebAudio?s=cI(s?[d,s]:[d]):s=d}return s&&(T.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(s.getTrackId(),"]")),i.push({track:s,type:ot.LocalAudioTrack})),i}filterTobeUnpublishedTracks(t){const e=[],n=this.getAllTracks();t=sm(t=t.filter(i=>n.indexOf(i)!==-1));for(const i of t){if(i instanceof Nn){const r=this.localTrackMap.get(ot.LocalAudioTrack);if(!r)continue;r.track instanceof $n?(r.track.removeAudioTrack(i),this.unbindLocalAudioTrackEvents(i),r.track.trackList.length===0&&(e.push([ot.LocalAudioTrack,r]),r.track.close())):e.push([ot.LocalAudioTrack,r])}if(i instanceof sn){const r=this.localTrackMap.get(ot.LocalVideoTrack);if(!r)continue;e.push([ot.LocalVideoTrack,r]);const s=this.localTrackMap.get(ot.LocalVideoLowTrack);s&&e.push([ot.LocalVideoLowTrack,s])}}return e}filterTobePublishedDataChannels(t){return t=(t=sm(t)).filter(e=>this.localDataChannels.findIndex(n=>n.id===e.id)===-1)}filterTobeUnpublishedDataChannels(t){return t=(t=(t=sm(t)).filter(e=>this.localDataChannels.indexOf(e)!==-1)).filter(e=>e._originDataChannel)}bindLocalTrackEvents(t){t.forEach(e=>{let{track:n,type:i}=e;switch(i){case ot.LocalVideoTrack:n.addListener(It.GET_STATS,this.handleGetLocalVideoStats),n.addListener(It.GET_RTC_STATS,this.handleGetRTCStats),n.addListener(It.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(It.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(It.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(It.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(It.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(It.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(It.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ot.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case ot.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,e){t instanceof $n?t.trackList.forEach(n=>{n.addListener(It.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(It.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(It.GET_STATS,this.handleGetLocalAudioStats),n.addListener(It.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(It.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(It.GET_STATS,this.handleGetLocalAudioStats),t.addListener(It.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(It.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(It.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(It.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),e||(t.addListener(It.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(It.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(e=>{let[n,{track:i}]=e;return{track:i,type:n}})),t.forEach(e=>{let{track:n,type:i}=e;switch(i){case ot.LocalVideoTrack:n.off(It.GET_STATS,this.handleGetLocalVideoStats),n.off(It.GET_RTC_STATS,this.handleGetRTCStats),n.off(It.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(It.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(It.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(It.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(It.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(It.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(It.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ot.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case ot.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof $n?t.trackList.forEach(e=>{e.off(It.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(It.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(It.GET_STATS,this.handleGetLocalAudioStats),e.off(It.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(It.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(It.GET_STATS,this.handleGetLocalAudioStats),t.off(It.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(It.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(It.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(It.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),t.off(It.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(It.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,e){e instanceof vm&&e.addListener(It.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(t))}),e instanceof Sm&&e.addListener(It.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(It.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,n]=t;n.has(Ct.AUDIO)&&this.unbindRemoteTrackEvents(e._audioTrack),n.has(Ct.VIDEO)&&this.unbindRemoteTrackEvents(e._videoTrack)})}createGatewayPublishMessage(t,e){return t.map((n,i)=>{var r;let s,c,{track:l,type:d}=n;switch(d){case ot.LocalAudioTrack:s=Ve.Audio,c={dtx:l instanceof Vg&&l._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case ot.LocalVideoTrack:s=mt(r=l._hints).call(r,Ye.SCREEN_TRACK)?Ve.Screen:Ve.High,c=Cc(Cc({},uM(l)),{},{codec:this.store.codec,svc_mode:LR()});break;case ot.LocalVideoLowTrack:s=Ve.Low,c=Cc(Cc({},uM(l)),{},{codec:this.store.codec,svc_mode:LR()})}return{stream_type:s,attributes:c,ssrcs:e[i]}})}createGatewayUnpublishMessage(t){return t.map(e=>{var n;let i,[r,{track:s,ssrcs:c,id:l}]=e;switch(r){case ot.LocalVideoTrack:i=mt(n=s._hints).call(n,Ye.SCREEN_TRACK)?Ve.Screen:Ve.High;break;case ot.LocalAudioTrack:i=Ve.Audio;break;case ot.LocalVideoLowTrack:i=Ve.Low}return{stream_type:i,ssrcs:c,mid:l}})}assignLocalTracks(t,e){t.forEach((n,i)=>{let{track:r,type:s}=n;this.localTrackMap.set(s,{track:r,id:e[i].id,ssrcs:e[i].localSSRC})})}withdrawLocalTracks(t){t.forEach(e=>{let[n]=e;this.localTrackMap.delete(n)})}bindConnectionEvents(t){t.onConnectionStateChange=async e=>{if(T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(e,")")),this.emit(Mt.PeerConnectionStateChange,e),e==="connecting"&&t instanceof rs&&!An()&&k("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{e==="connecting"&&t.extendCandidate()},k("FIRST_TCP_CANDIDATE_INTERVAL")),e!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),e==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),t instanceof rs&&s2(t,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=Al.DISCONNECTED_OR_FAILED,Ca(this,Mt.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const n=this.pendingLocalTracks.map(r=>r.getTrackId()),i=this.pendingLocalDataChannels.map(r=>"dc_".concat(r.id));Pt.reportApiInvoke(this.store.sessionId,{name:kn.REPUB_AFTER_PC_CONNECTED,options:n.concat(i),tag:_n.TRACER}).onSuccess(),this.republish()}if(k("NEW_ICE_RESTART")&&t instanceof rs&&!An()&&!this._forceTurn){if(mt(aM).call(aM,e)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const n=r=>{lI(t)&&(T.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(r)),Ca(this,Mt.QueryClientConnectionState)==="CONNECTED"&&this.emit(Mt.RequestRestartICE,r))},i=()=>{lI(t)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),T.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(Mt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{o2(t,n,i)},800))}}else{if(e==="disconnected"&&t.iceConnectionState==="disconnected")return setTimeout(()=>{t.iceConnectionState==="disconnected"&&k("ICE_RESTART")&&Ca(this,Mt.QueryClientConnectionState)==="CONNECTED"&&this.emit(Mt.RequestRestartICE)},800),void setTimeout(()=>{t.peerConnectionState==="disconnected"&&(T.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(Mt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);e==="failed"&&(T.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(Mt.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},t.onICEConnectionStateChange=e=>{e!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),Pt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:_n.TRACER}).onSuccess(),this.emit(Mt.IceConnectionStateChange,e)},t.onICETransportStateChange=e=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},t.onDTLSTransportStateChange=e=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},t.onDTLSTransportError=e=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},t.onFirstAudioDecoded=e=>{var n;const i=Array.from(zr(n=this.remoteUserMap).call(n)).find(s=>s._audioSSRC===e);var r;i&&(this.store.subscribe(i.uid,"audio",void 0,void 0,void 0,Date.now()),(r=i.audioTrack)===null||r===void 0||r.emit(es.FIRST_FRAME_DECODED),Pt.firstRemoteFrame(this.store.sessionId,ai.FIRST_AUDIO_DECODE,pn.FIRST_AUDIO_DECODE,{peer:i._uintid,subscribeElapse:Yi.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=e=>{var n;const i=Array.from(zr(n=this.remoteUserMap).call(n)).find(r=>r._audioSSRC===e);i&&Pt.firstRemoteFrame(this.store.sessionId,ai.FIRST_AUDIO_RECEIVED,pn.FIRST_AUDIO_RECEIVED,{peer:i._uintid,subscribeElapse:Yi.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(e,n,i)=>{var r;const s=Array.from(zr(r=this.remoteUserMap).call(r)).find(c=>c._videoSSRC===e);s&&this.store.firstVideoFrameDecoded(s.uid,{firstDecoded:Date.now()}),this.reportVideoFirstFrameDecoded(e,n,i)},t.onFirstVideoRender=e=>{var n;const i=Array.from(zr(n=this.remoteUserMap).call(n)).find(r=>r._videoSSRC===e);i&&(this.store.firstVideoFrameDecoded(i.uid,{firstPreRender:Date.now()}),this.reportVideoFirstFrameRender(i))},t.onFirstVideoReceived=e=>{var n;const i=Array.from(zr(n=this.remoteUserMap).call(n)).find(r=>r._videoSSRC===e);i&&(this.store.firstVideoFrameDecoded(i.uid,{firstReceived:Date.now()}),Pt.firstRemoteFrame(this.store.sessionId,ai.FIRST_VIDEO_RECEIVED,pn.FIRST_VIDEO_RECEIVED,{peer:i._uintid,subscribeElapse:Yi.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},t.onSelectedLocalCandidateChanged=(e,n)=>{const i=e.candidateType==="relay",r=n.candidateType==="relay";n.candidateType!=="unknown"&&i===r||this.emit(Mt.ConnectionTypeChange,i),T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Yd(n))," -> ").concat(JSON.stringify(Yd(e)),")"))},t.onSelectedRemoteCandidateChanged=(e,n)=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Yd(n))," -> ").concat(JSON.stringify(Yd(e)),")"))},t.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},t.getLocalVideoStats=()=>{const e=this.statsCollector.getLocalVideoTrackStats(),n=this.statsCollector.getRTCStats();return Cc(Cc({},e),n)},t.onICECandidateError=e=>{this._iceError=e}}resetConnection(t){t instanceof rs&&function(e){km.delete(e.id),s2(e)}(t),t.close(),this.emit(Mt.PeerConnectionStateChange,"closed"),function(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.getLocalVideoStats=void 0}(t),this._isWaitPcToRePub=!1}filterTobeMutedTracks(t){const e=[];if(this.getAllTracks().indexOf(t)===-1)return e;const n=this.localTrackMap.get(ot.LocalAudioTrack);if(t instanceof Nn&&(n==null?void 0:n.track)instanceof $n)return n.track.isActive||e.push([ot.LocalAudioTrack,n]),e;const i=Array.from(this.localTrackMap.entries()).find(r=>{let[,{track:s}]=r;return t===s});if(i&&(e.push(i),i[0]===ot.LocalVideoTrack)){const r=this.localTrackMap.get(ot.LocalVideoLowTrack);r&&e.push([ot.LocalVideoLowTrack,r])}return e}filterTobeUnmutedTracks(t){const e=[],n=this.localTrackMap.get(ot.LocalAudioTrack);if(t instanceof Nn&&(n==null?void 0:n.track)instanceof $n)return n.track.isActive&&e.push([ot.LocalAudioTrack,n]),e;const i=Array.from(this.localTrackMap.entries()).find(r=>{let[,{track:s}]=r;return t===s});if(i)if(i[0]===ot.LocalVideoTrack){e.push(i);const r=this.localTrackMap.get(ot.LocalVideoLowTrack);r&&e.push([ot.LocalVideoLowTrack,r])}else e.push(i);return e}createMuteMessage(t){return t.map(e=>{var n;let i,[r,{track:s,ssrcs:c,id:l}]=e;switch(r){case ot.LocalAudioTrack:i=Ve.Audio;break;case ot.LocalVideoTrack:i=mt(n=s._hints).call(n,Ye.SCREEN_TRACK)?Ve.Screen:Ve.High;break;case ot.LocalVideoLowTrack:i=Ve.Low}return{stream_type:i,ssrcs:c,mid:l}})}createUnmuteMessage(t){return t.map(e=>{var n;let i,[r,{track:s,ssrcs:c,id:l}]=e;switch(r){case ot.LocalAudioTrack:i=Ve.Audio;break;case ot.LocalVideoTrack:i=mt(n=s._hints).call(n,Ye.SCREEN_TRACK)?Ve.Screen:Ve.High;break;case ot.LocalVideoLowTrack:i=Ve.Low}return{stream_type:i,ssrcs:c,mid:l}})}filterTobeUnSubscribedTracks(t,e){const n=[],i=this.remoteUserMap.get(t);if(!i)return n;if(e){const r=i.get(e);if(!r)return n;n.push([t,{kind:e,id:r}])}else Array.from(i.entries()).forEach(r=>{let[s,c]=r;n.push([t,{kind:s,id:c}])});return n}filterTobeUnSubscribedDataChannels(t,e){const n=[];return e.forEach(i=>{var r;(r=this.remoteDataChannelMap.get(t))!==null&&r!==void 0&&r.has(i.id)&&n.push(i)}),n}createUnsubscribeMessage(t){const e=[];return t.forEach(n=>{let[i,{kind:r,id:s}]=n;switch(r){case Ct.VIDEO:return void(i._videoSSRC&&e.push({stream_type:Ct.VIDEO,ssrcId:i._videoSSRC}));case Ct.AUDIO:return void(i._audioSSRC&&e.push({stream_type:Ct.AUDIO,ssrcId:i._audioSSRC}))}}),e}createUnsubscribeAllMessage(t){const e=new Map;return t.forEach(n=>{let[i,{kind:r}]=n;if(e.has(i)){let s=e.get(i);r===Ct.VIDEO?s|=ui.Video:s|=ui.Audio,e.set(i,s)}else r===Ct.VIDEO?e.set(i,ui.Video):e.set(i,ui.Audio)}),{users:Array.from(e.entries()).map(n=>{let[i,r]=n;return{stream_id:i.uid,stream_type:r}})}}withdrawRemoteTracks(t){t.forEach(e=>{let[n,{kind:i}]=e;const r=this.remoteUserMap.get(n);r&&(r.delete(i),Array.from(r.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(t){const e=this.localTrackMap.get(ot.LocalVideoTrack),n=this.localTrackMap.get(ot.LocalVideoLowTrack);e&&(await e.track.setBitrateLimit(t.uplink),await new Tt((i,r)=>{this.handleUpdateVideoEncoder(e.track,i,r,!0)})),n&&t.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0}),await new Tt((i,r)=>{this.handleUpdateVideoEncoder(n.track,i,r,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}isPreallocation(){return this.connection instanceof rs&&this.connection.isPreallocation}isPreSub(){return this.connection instanceof rs&&this.connection.isPreSub()}mapPubResToRemoteConfig(t,e,n){return t.map((i,r)=>{var s;let{stream_type:c}=i;const l=(s=e.find(d=>{let{stream_type:h}=d;return c===h}))===null||s===void 0?void 0:s.attributes;if(l&&k("DISABLE_SCREEN_SHARE_REMB")){const d=n[r]._hints;(mt(d).call(d,Ye.SCREEN_TRACK)||mt(d).call(d,Ye.SCREEN_LOW_TRACK))&&(l.remb=!1,T.debug("disable remb for screen share, hints:",d))}return l})}async tryToUnmuteAudio(t){for(let n=0;n<t.length;n++)if(t[n]instanceof Nn){var e;const i=this.filterTobeUnmutedTracks(t[n]);if(i.length===0)continue;await((e=this.connection)===null||e===void 0?void 0:e.unmuteLocal(i.map(s=>{let[,{id:c}]=s;return c})));const r=this.createUnmuteMessage(i);return void await Qe(this,Mt.RequestUnmuteLocal,r)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var e;return!((e=this.connection)===null||e===void 0||!e.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,e)=>this.emit(Mt.RequestUpload,t,e),this.statsUploader.requestUploadStats=t=>this.emit(Mt.RequestUploadStats,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var t;return{connectState:((t=this.connection)===null||t===void 0?void 0:t.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await yi(YA(this.dtlsFailedCount,Xn)),this.emit(Mt.RequestReconnect)}async reconnectP2P(){const t=Array.from(this.localTrackMap.entries()),e=this.createGatewayUnpublishMessage(t);Array.from(this.remoteUserMap.entries()),e.length>0&&await ki(this,Mt.RequestUnpublishForReconnectPC,e),this.disconnectForReconnect(),this.emit(Mt.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(ot.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof sn)}throwIfTrackTypeNotMatch(t){if(t.filter(e=>e instanceof sn).length>1)throw new Z(P.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(e=>e instanceof Nn).length>1&&(t.some(e=>e instanceof Nn&&e._bypassWebAudio)||!be().webAudioMediaStreamDest))throw new Z(P.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const e of t){if(e instanceof sn&&this.pendingLocalTracks.some(n=>n instanceof sn))throw new Z(P.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e instanceof Nn&&this.pendingLocalTracks.some(n=>n instanceof Nn)&&(!be().webAudioMediaStreamDest||e._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof Nn&&n._bypassWebAudio)))throw new Z(P.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,e){var n;const i=!k("DISABLE_DUAL_STREAM_USE_ENCODING")&&be().supportDualStreamEncoding,r=Cc(Cc({},{width:160,height:120,framerate:15,bitrate:50}),e);let s;s=i?t._mediaStreamTrack.clone():dI(t,r);const c=Je(8,"track-low-"),l=new sn(s,Cc(Cc({},i&&{scaleResolutionDownBy:Ww(r,t)}),{},{frameRate:r.framerate,bitrateMax:r.bitrate,bitrateMin:r.bitrate}),void 0,void 0,c);return l.on(Mh.TRANSCEIVER_UPDATED,d=>{t._updateRtpTransceiver(d,pm.LOW_STREAM)}),l._hints.push(Ye.LOW_STREAM),mt(n=t._hints).call(n,Ye.SCREEN_TRACK)&&l._hints.push(Ye.SCREEN_LOW_TRACK),t.on("sei-to-send",d=>{l.emit("sei-to-send",d)}),t.addListener(It.NEED_CLOSE,()=>{l.close()}),l}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(t,e,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof rs){var r,s,c,l;const d=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:h,dtlsTransportState:p,peerConnectionState:m}=this.connection,{local:_,remote:E}=await this.connection.getSelectedCandidatePair();Pt.pcStats(this.store.sessionId,{startTime:d,eventElapse:t-d||0,iceconnectionsate:h,dtlsstate:p,connectionstate:m,intSucc:e?1:2,error:this._iceError||i||"",selectedLocalCandidateProtocol:(r=_==null?void 0:_.protocol)!==null&&r!==void 0?r:"",selectedLocalCandidateType:(s=_.candidateType)!==null&&s!==void 0?s:"",selectedLocalCandidateAddress:"".concat(_.address,":").concat(_.port),selectedRemoteCandidateProtocol:(c=E.protocol)!==null&&c!==void 0?c:"",selectedRemoteCandidateType:(l=E.candidateType)!==null&&l!==void 0?l:"",selectedRemoteCandidateAddress:"".concat(E.address,":").concat(E.port),restartCnt:n,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameRender(t){const e=this.store.keyMetrics,n=e.firstVideoFrameDecoded.find(p=>p.userId===t.uid);if(!n)return;const{isInternalUpload:i,isExternalUpload:r}=n;if(i&&r)return;const{subscribeEnd:s,firstPreRender:c,peerPublishDuration:l,peerPubStatusMs:d}=n;let{firstRender:h=0}=n;if(s&&(h||c)&&l&&d){n.isInternalUpload=!0;const{playEnd:p}=n;p&&(n.isExternalUpload=!0);const{firstPreRender:m=0}=n;h=m||h;const _=t.videoTrack,E={peer:t._uintid,width:(_==null?void 0:_._videoWidth)||0,height:(_==null?void 0:_._videoHeight)||0,ssrc:t._videoSSRC||0,p2pid:this.store.p2pId,peerPublishDuration:l,peerPubStatusMs:d,joinChannelStart:e.joinStart||0,preloadStart:e.preloadStart||0,preloadEnd:e.preloadEnd||0,apStart:e.requestAPStart||0,apEnd:e.requestAPEnd||0,suaEnd:e.requestSUAEnd||0,beforeConnect:e.beforeConnect||0,peerReceiver:e.peerReceiver||0,ice:e.iceConnectionEnd||0,pc:e.peerConnectionEnd||0,signalConnected:e.signalConnected||0,joinReq:e.joinReq||0,joinRes:e.joinRep||0,userJoinNotify:n.userJoinNotify||0,videoAddNotify:n.videoAddNotify||0,subscribeStart:n.subscribeStart||0,subscribeEnd:n.subscribeEnd||0,firstReceived:n.firstReceived||0,firstDecoded:n.firstDecoded||0,firstPreRender:m||0,firstRender:p?Math.max(h,p):Math.max(h,s),playStart:n.playStart||0,playEnd:n.playEnd||0,isPreSub:!(!t._videoSSRC||!this.isPreSubScribe(t._videoSSRC)),isPrePc:this.isPreallocation(),isPreInstantVideo:xL(this.store)};Pt.firstXLAPeerFirstVideoFrame(this.store.sessionId,E)}}reportVideoFirstFrameDecoded(t,e,n,i){var r;const s=Array.from(zr(r=this.remoteUserMap).call(r)).find(c=>c._videoSSRC===t);if(s){i||this.store.subscribe(s.uid,"video",void 0,void 0,void 0,void 0,Date.now());const c=this.store.keyMetrics,l=c.subscribe.find(d=>d.userId===s.uid&&d.type==="video");Pt.firstRemoteVideoDecode(this.store.sessionId,ai.FIRST_VIDEO_DECODE,pn.FIRST_VIDEO_DECODE,{peer:s._uintid,videowidth:e,videoheight:n,subscribeElapse:Yi.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:c.requestAPEnd||0,apStart:c.requestAPStart||0,joinGwEnd:c.joinGatewayEnd||0,joinGwStart:c.joinGatewayStart||0,pcEnd:c.peerConnectionEnd||0,pcStart:c.peerConnectionStart||0,subscriberEnd:(l==null?void 0:l.subscribeEnd)||0,subscriberStart:(l==null?void 0:l.subscribeStart)||0,videoAddNotify:(l==null?void 0:l.streamAdded)||0,state:i?1:0,firstFrame:(l==null?void 0:l.firstFrame)||0})}}async remoteMediaSsrcChanged(t,e,n){if(!this.connection)return!1;const i=this.remoteUserMap.get(t);if(!i)return!1;const r=i.get(e);if(!r)return!1;const s=await this.connection.getRemoteSSRC(r);return s!==void 0&&s!==n}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[e,{track:n}]=t;e===ot.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,pm.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},Dt(de.prototype,"startP2PConnection",[hr],Object.getOwnPropertyDescriptor(de.prototype,"startP2PConnection"),de.prototype),Dt(de.prototype,"connect",[hr],Object.getOwnPropertyDescriptor(de.prototype,"connect"),de.prototype),Dt(de.prototype,"updateRemoteRTPCapabilities",[hr],Object.getOwnPropertyDescriptor(de.prototype,"updateRemoteRTPCapabilities"),de.prototype),Dt(de.prototype,"publishDataChannel",[hr],Object.getOwnPropertyDescriptor(de.prototype,"publishDataChannel"),de.prototype),Dt(de.prototype,"unpublish",[hr],Object.getOwnPropertyDescriptor(de.prototype,"unpublish"),de.prototype),Dt(de.prototype,"unpublishDataChannel",[hr],Object.getOwnPropertyDescriptor(de.prototype,"unpublishDataChannel"),de.prototype),Dt(de.prototype,"unpublishLowStream",[hr],Object.getOwnPropertyDescriptor(de.prototype,"unpublishLowStream"),de.prototype),Dt(de.prototype,"subscribeDataChannel",[hr],Object.getOwnPropertyDescriptor(de.prototype,"subscribeDataChannel"),de.prototype),Dt(de.prototype,"subscribe",[hr],Object.getOwnPropertyDescriptor(de.prototype,"subscribe"),de.prototype),Dt(de.prototype,"massSubscribe",[hr],Object.getOwnPropertyDescriptor(de.prototype,"massSubscribe"),de.prototype),Dt(de.prototype,"unsubscribe",[hr],Object.getOwnPropertyDescriptor(de.prototype,"unsubscribe"),de.prototype),Dt(de.prototype,"unsubscribeDataChannel",[hr],Object.getOwnPropertyDescriptor(de.prototype,"unsubscribeDataChannel"),de.prototype),Dt(de.prototype,"massUnsubscribe",[hr],Object.getOwnPropertyDescriptor(de.prototype,"massUnsubscribe"),de.prototype),Dt(de.prototype,"muteRemote",[hr],Object.getOwnPropertyDescriptor(de.prototype,"muteRemote"),de.prototype),Dt(de.prototype,"unmuteRemote",[hr],Object.getOwnPropertyDescriptor(de.prototype,"unmuteRemote"),de.prototype),Dt(de.prototype,"hasRemoteMediaWithLock",[hr],Object.getOwnPropertyDescriptor(de.prototype,"hasRemoteMediaWithLock"),de.prototype),Dt(de.prototype,"disconnectForReconnect",[hr],Object.getOwnPropertyDescriptor(de.prototype,"disconnectForReconnect"),de.prototype),Dt(de.prototype,"updateBitrateLimit",[hr],Object.getOwnPropertyDescriptor(de.prototype,"updateBitrateLimit"),de.prototype),Dt(de.prototype,"remoteMediaSsrcChanged",[hr],Object.getOwnPropertyDescriptor(de.prototype,"remoteMediaSsrcChanged"),de.prototype),de);function hr(t,e,n){const i=t[e];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const r=this.mutex,s=await r.lock("From P2PChannel.".concat(e));try{for(var c=arguments.length,l=new Array(c),d=0;d<c;d++)l[d]=arguments[d];return await i.apply(this,l)}finally{s()}},n}function d2(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function u2(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?d2(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):d2(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const x8=Date.now(),M8=20,hI=new Map,$R=new Map;async function h2(t){const e=hI.get(t),n=Array.isArray(e)&&e[e.length-1],i=$R.get(t);if(!n)return void(i.isSyncing=!1);const r={uid:n.uid,payload:n.payload};i.firstRecvTs===0&&(i.firstRecvTs=n.recvTs,i.firstSendTs=n.sendTs);const s=n.sendTs-i.firstSendTs,c=s-(Date.now()-i.firstRecvTs);c>0&&(i.firstRecvTs=Date.now()-s);let l=n.mediaDelay+c;l<=0?(e.pop(),p2(n.context,r),l=0):l=Math.min(l,M8),setTimeout(()=>e.length&&h2(t),l)}function p2(t,e){t.safeEmit(he.STREAM_MESSAGE,e.uid,e.payload),t.onStreamMessage&&t.onStreamMessage(e)}function U8(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(!t.syncWithAudio)return p2(n,{uid:t.uid,payload:t.payload});const i="".concat(n.id,"-").concat(t.uid),r=hI.get(i)||[],s=r.findIndex(h=>t.sendTs>=h.sendTs),c=u2(u2({},t),{},{context:n,mediaDelay:e,recvTs:Date.now()});s===-1?r.push(c):r.splice(s,0,c),hI.set(i,r);let l=!1;var d;$R.has(i)?l=!((d=$R.get(i))===null||d===void 0||!d.isSyncing):$R.set(i,{isSyncing:l,firstRecvTs:0,firstSendTs:0}),l||h2(i)}const V8=ve().name;function f2(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function m2(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?f2(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):f2(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const Lm="websdk_ng_cache_parameter",j8=k("MAX_PRELOAD_ASYNC_LENGTH"),B8=1e4,qh=new Map,Kh=[];let pI=null,fI=0,mI=0;const tb=new Map,F8=function(t,e){const n=[];let i=0;const r=async()=>{const s=n.shift();s&&await s(),n.length>0&&i<e?r():i--};return async function(){for(var s=arguments.length,c=new Array(s),l=0;l<s;l++)c[l]=arguments[l];return new Tt(async(d,h)=>{n.push(async()=>{try{const p=await t(...c);d(p)}catch(p){h(p)}}),i<e&&(i++,r())})}}(_2,j8),_I=Ir.CancelToken.source();async function _2(t,e,n,i,r,s){try{if(!k("ENABLE_PRELOAD"))return;if(!be().supportWebCrypto)return void Fd(()=>{T.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!n&&n!==null)throw new Z(P.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&Ti(n,"token",1,2047),Ti(t,"appid",1,2047),IR(e),i&&OR(i);const c=Lh();T.debug("preload channel ".concat(e,", uid is ").concat(i));const l={appId:t,cname:e,token:n||t,uid:typeof i!="string"?i:null,sid:c,proxyServer:r};let d,h;typeof i=="string"?(l.stringUid=i,[h,d]=await Tt.all([b8(i,{sid:c,appId:t},_I.token),GM(m2(m2({},l),{},{token:n||t,uid:0}),_I.token)]),l.uid=h.uid,d.gatewayInfo.uid=l.uid,d.gatewayInfo.res.uid=l.uid):(s&&(l.stringUid=s),d=await GM(l,_I.token));const p={sid:c,appId:t,cname:e,token:n||t,uid:l.stringUid||i,intUid:l.uid||d.gatewayInfo.uid,stringUid:l.stringUid,ts:Date.now(),sua:h,ap:d};await async function(m){let _;try{m.uid&&g2({appId:m.appId,cname:m.cname,token:m.token,uid:m.uid,stringUid:m.stringUid});const E=y2(m),I=await async function(w,D){try{const N=await window.crypto.subtle.importKey("raw",cL(D),"AES-GCM",!1,["encrypt"]),L=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},N,kh(window.btoa(JSON.stringify(w))));return Gd(new Uint8Array(L))}catch{return}}(m,m.token||m.appId);if(!I)return;_=T2(Lm);const C=_?JSON.parse(_):[];C.push({[E]:I}),C.length>k("AP_CACHE_NUM")&&C.shift(),eb(Lm,JSON.stringify(C))}catch(E){T.warn("Error caching server parameters:",E.message),eb(Lm,"")}}(p),fI++}catch(c){throw mI++,function(l){pI||(pI=window.setTimeout(()=>{let h="";tb.forEach((p,m)=>{h+="".concat(m,": ").concat(p," ;")}),Pt.reportApiInvoke(null,{name:kn.PRELOAD,options:{success:fI,failed:mI,err:h}}).onError(l),fI=0,mI=0,tb.clear(),pI=null},B8));const d=tb.get(l.code)||0;tb.set(l.code,d+1)}(c),c}}async function E2(t){try{if(k("AP_REQUEST_DETAIL")||k("ENABLE_ROLE_SELECT_EDGE"))return;const e=g2(t);if(!e||t.cloudProxyServer!=="disabled")return;const n=await async function(i,r){try{const s=await window.crypto.subtle.importKey("raw",cL(r),"AES-GCM",!1,["decrypt"]),c=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},s,kh(i));return JSON.parse(window.atob(Gd(new Uint8Array(c))))}catch{return}}(e,t.token||t.appId);if(!n||!function(i,r){return i.cname===r.cname&&i.appId===r.appId&&i.token===r.token?r.stringUid?i.stringUid===r.stringUid:typeof r.uid=="number"?i.uid===r.uid:i.uid==r.uid:!1}(n,t))return;if(n&&Date.now()-n.ts<k("AP_CACHE_LIFETIME"))return n}catch(e){T.warn("Error get preloadInfo",e.message)}}function g2(t){let e;try{if(e=T2(Lm),!e)return;const n=JSON.parse(e),i=y2(t),r=function(c,l){for(let d=c.length-1;d>=0;d--)if(l(c[d]))return d;return-1}(n,c=>i in c);if(r===-1)return;const s=n.splice(r,1)[0];return eb(Lm,JSON.stringify(n)),s[i]}catch(n){T.warn("Error delete preload info: ".concat(e),n.message),eb(Lm,"")}}function EI(t){if(t){let e=qh.get(t);e&&(window.clearTimeout(e),e=null,qh.delete(t)),mt(Kh).call(Kh,t)||t.cloudProxyServer!=="disabled"||Kh.push(t)}if(qh.size<k("AP_CACHE_NUM")&&Kh.length>0){const e=Kh.shift();qh.set(e,window.setTimeout(async()=>{const{appId:n,cname:i,token:r,stringUid:s,uid:c,proxyServer:l}=e;try{await F8(n,i,r,c,l,s),qh.has(e)&&EI(e)}catch(d){T.warn("update preload failed",d.message),v2(e)}},k("AP_UPDATE_INTERVAL")))}}function v2(t){const e=Kh.indexOf(t);e!==-1&&Kh.splice(e,1);let n=qh.get(t);n&&(window.clearTimeout(n),n=null,qh.delete(t),EI())}function S2(t,e){const n=t.sua,i=t.ap;e&&n&&Pt.reqUserAccount(t.sid,{lts:n.requestTime,elapse:n.elapse,success:!0,serverAddr:n.url,stringUid:e,uid:t.intUid,errorCode:null,extend:n.req}),Pt.reportResourceTiming(t.ap.url,t.sid),Pt.joinWebProxyAP(t.sid,{lts:i.requestTime,elapse:i.elapse,sucess:1,apServerAddr:i.url,turnServerAddrList:i.proxyInfo.addresses.map(r=>r.ip).join(","),eventType:"disabled",unilbsServerIds:[zn.CHOOSE_SERVER,zn.CLOUD_PROXY_FALLBACK].toString()}),Pt.joinChooseServer(t.sid,{lts:i.requestTime,elapse:i.elapse,succ:!0,csAddr:i.url,opid:i.opid,serverList:i.gatewayInfo.gatewayAddrs.map(r=>r.address),ec:null,cid:i.gatewayInfo.cid.toString(),uid:i.gatewayInfo.uid.toString(),csIp:i.gatewayInfo.csIp,unilbsServerIds:[zn.CHOOSE_SERVER].toString(),isHttp3:i.isHttp3})}function T2(t){return window.atob(window.localStorage.getItem(t)||"")}function eb(t,e){window.localStorage.setItem(t,window.btoa(e))}function y2(t){let e="".concat(t.appId,"_").concat(t.cname);return typeof t.uid=="string"&&(e+="_s_".concat(t.uid)),typeof t.uid=="number"&&(e+="_".concat(t.uid)),t.token&&(e+="_".concat(t.token)),mL(e)}function G8(t){let e=function(){const n=z8.pop();return n?(n.offset=n.limit=0,n):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(n,i){let r=n.appId;r!==void 0&&(qn(i,10),eu(i,r));let s=n.cid;s!==void 0&&(qn(i,16),qn(i,s));let c=n.cname;c!==void 0&&(qn(i,26),eu(i,c));let l=n.deviceId;l!==void 0&&(qn(i,34),eu(i,l));let d=n.elapse;d!==void 0&&(qn(i,40),nu(i,d));let h=n.fileSize;h!==void 0&&(qn(i,48),nu(i,xm(h)));let p=n.height;p!==void 0&&(qn(i,56),nu(i,xm(p)));let m=n.jpg;m!==void 0&&(qn(i,66),qn(i,m.length),b2(i,m));let _=n.networkType;_!==void 0&&(qn(i,72),nu(i,xm(_)));let E=n.osType;E!==void 0&&(qn(i,80),nu(i,xm(E)));let I=n.requestId;I!==void 0&&(qn(i,90),eu(i,I));let C=n.sdkVersion;C!==void 0&&(qn(i,98),eu(i,C));let w=n.sequence;w!==void 0&&(qn(i,104),nu(i,xm(w)));let D=n.sid;D!==void 0&&(qn(i,114),eu(i,D));let N=n.timestamp;N!==void 0&&(qn(i,120),nu(i,N));let L=n.uid;L!==void 0&&(qn(i,128),qn(i,L));let W=n.vid;W!==void 0&&(qn(i,136),qn(i,W));let G=n.width;G!==void 0&&(qn(i,144),nu(i,xm(G)));let U=n.service;U!==void 0&&(qn(i,152),qn(i,U));let z=n.callbackData;z!==void 0&&(qn(i,162),qn(i,z.length),b2(i,z));let $=n.ticket;$!==void 0&&(qn(i,170),eu(i,$));let rt=n.vendorConfigs;rt!==void 0&&(qn(i,178),eu(i,rt))}(t,e),function(n){let i=n.bytes,r=n.limit;return i.length===r?i:i.subarray(0,r)}(e)}function H8(t){return function(n){let i={};t:for(;!q8(n);){let r=$g(n);switch(r>>>3){case 0:break t;case 1:i.code=$g(n);break;case 2:i.msg=C2(n,$g(n));break;case 3:i.requestId=C2(n,$g(n));break;case 4:i.timestamp=K8(n,!1);break;default:W8(n,7&r)}}return i}({bytes:e=t,offset:0,limit:e.length});var e}function W8(t,e){switch(e){case 0:for(;128&Vs(t););break;case 2:gI(t,$g(t));break;case 5:gI(t,4);break;case 1:gI(t,8);break;default:throw new Error("Unimplemented type: "+e)}}function xm(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let z8=[];function gI(t,e){if(t.offset+e>t.limit)throw new Error("Skip past limit");t.offset+=e}function q8(t){return t.offset>=t.limit}function nb(t,e){let n=t.bytes,i=t.offset,r=t.limit,s=i+e;if(s>n.length){let c=new Uint8Array(2*s);c.set(n),t.bytes=c}return t.offset=s,s>r&&(t.limit=s),i}function R2(t,e){let n=t.offset;if(n+e>t.limit)throw new Error("Read past limit");return t.offset+=e,n}function b2(t,e){let n=nb(t,e.length);t.bytes.set(e,n)}function C2(t,e){let n=R2(t,e),i=String.fromCharCode,r=t.bytes,s="�",c="";for(let l=0;l<e;l++){let d,h,p,m,_=r[l+n];(128&_)==0?c+=i(_):(224&_)==192?l+1>=e?c+=s:(d=r[l+n+1],(192&d)!=128?c+=s:(m=(31&_)<<6|63&d,m<128?c+=s:(c+=i(m),l++))):(240&_)==224?l+2>=e?c+=s:(d=r[l+n+1],h=r[l+n+2],(49344&(d|h<<8))!=32896?c+=s:(m=(15&_)<<12|(63&d)<<6|63&h,m<2048||m>=55296&&m<=57343?c+=s:(c+=i(m),l+=2))):(248&_)==240?l+3>=e?c+=s:(d=r[l+n+1],h=r[l+n+2],p=r[l+n+3],(12632256&(d|h<<8|p<<16))!=8421504?c+=s:(m=(7&_)<<18|(63&d)<<12|(63&h)<<6|63&p,m<65536||m>1114111?c+=s:(m-=65536,c+=i(55296+(m>>10),56320+(1023&m)),l+=3))):c+=s}return c}function eu(t,e){let n=e.length,i=0;for(let c=0;c<n;c++){let l=e.charCodeAt(c);l>=55296&&l<=56319&&c+1<n&&(l=(l<<10)+e.charCodeAt(++c)-56613888),i+=l<128?1:l<2048?2:l<65536?3:4}qn(t,i);let r=nb(t,i),s=t.bytes;for(let c=0;c<n;c++){let l=e.charCodeAt(c);l>=55296&&l<=56319&&c+1<n&&(l=(l<<10)+e.charCodeAt(++c)-56613888),l<128?s[r++]=l:(l<2048?s[r++]=l>>6&31|192:(l<65536?s[r++]=l>>12&15|224:(s[r++]=l>>18&7|240,s[r++]=l>>12&63|128),s[r++]=l>>6&63|128),s[r++]=63&l|128)}}function Vs(t){return t.bytes[R2(t,1)]}function A2(t,e){let n=nb(t,1);t.bytes[n]=e}function $g(t){let e,n=0,i=0;do e=Vs(t),n<32&&(i|=(127&e)<<n),n+=7;while(128&e);return i}function qn(t,e){for(e>>>=0;e>=128;)A2(t,127&e|128),e>>>=7;A2(t,e)}function K8(t,e){let n,i=0,r=0,s=0;return n=Vs(t),i=127&n,128&n&&(n=Vs(t),i|=(127&n)<<7,128&n&&(n=Vs(t),i|=(127&n)<<14,128&n&&(n=Vs(t),i|=(127&n)<<21,128&n&&(n=Vs(t),r=127&n,128&n&&(n=Vs(t),r|=(127&n)<<7,128&n&&(n=Vs(t),r|=(127&n)<<14,128&n&&(n=Vs(t),r|=(127&n)<<21,128&n&&(n=Vs(t),s=127&n,128&n&&(n=Vs(t),s|=(127&n)<<7))))))))),{low:i|r<<28,high:r>>>4|s<<24,unsigned:e}}function nu(t,e){let n=e.low>>>0,i=(e.low>>>28|e.high<<4)>>>0,r=e.high>>>24,s=r===0?i===0?n<16384?n<128?1:2:n<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:r<128?9:10,c=nb(t,s),l=t.bytes;switch(s){case 10:l[c+9]=r>>>7&1;case 9:l[c+8]=s!==9?128|r:127&r;case 8:l[c+7]=s!==8?i>>>21|128:i>>>21&127;case 7:l[c+6]=s!==7?i>>>14|128:i>>>14&127;case 6:l[c+5]=s!==6?i>>>7|128:i>>>7&127;case 5:l[c+4]=s!==5?128|i:127&i;case 4:l[c+3]=s!==4?n>>>21|128:n>>>21&127;case 3:l[c+2]=s!==3?n>>>14|128:n>>>14&127;case 2:l[c+1]=s!==2?n>>>7|128:n>>>7&127;case 1:l[c]=s!==1?128|n:127&n}}const w2={},I2={},ib=4294967296,Y8=ib*ib,X8=Y8/2;N2(0,!0);const O2=N2(0),Q8=tv(0,-2147483648,!1),J8=tv(-1,2147483647,!1);function N2(t,e){let n,i,r;return e?(r=0<=(t>>>=0)&&t<256)&&(i=I2[t],i)?i:(n=tv(t,0,!0),r&&(I2[t]=n),n):(r=-128<=(t|=0)&&t<128)&&(i=w2[t],i)?i:(n=tv(t,t<0?-1:0,!1),r&&(w2[t]=n),n)}function tv(t,e,n){return{low:0|t,high:0|e,unsigned:!!n}}function D2(t,e){if(isNaN(t))return O2;{if(t<=-9223372036854776e3)return Q8;if(t+1>=X8)return J8}return t<0?O2:tv(t%ib|0,t/ib|0,e)}function P2(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}class vI extends Sn{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;const n=this._connectionState;this._connectionState=e,this.emit(wo.CONNECTION_STATE_CHANGE,e,n)}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(e){var n;super(),O(this,"name","AgoraRTCImageModeration"),O(this,"_connectionState",is.CONNECTING),O(this,"_sequence",0),O(this,"_moderationStartTime",void 0),O(this,"_workerConnection",void 0),O(this,"_workerMessageLengthLimit",void 0),O(this,"_qualityRatio",void 0),O(this,"_connectInfo",void 0),O(this,"_cancelTokenSource",Ir.CancelToken.source()),O(this,"_retryConfig",void 0),O(this,"_moderationInterval",void 0),O(this,"_moderationTimer",null),O(this,"_moderationMode",1),O(this,"_quality",1),O(this,"_qualityTimer",null),O(this,"_ticket",void 0),O(this,"_moderationIntervalMinimum",void 0),O(this,"_uploadFailedNum",0),O(this,"_uploadNum",0),O(this,"_uploadTimer",null),O(this,"_extraInfo",void 0),O(this,"_vendor",""),O(this,"_encoder",new TextEncoder),O(this,"_moderationId",void 0),O(this,"inspectImage",()=>{if(this.connectionState!==is.CONNECTED)throw new K(P.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===is.CONNECTED?this.requestToInspectImage():T.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=Je(5,"image-moderation-"),this._workerMessageLengthLimit=k("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=k("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(n=e.interval)!==null&&n!==void 0?n:1e3,e.extraInfo&&(this._extraInfo=this._encoder.encode(e.extraInfo)),e.vendor&&(this._vendor=e.vendor),this._qualityRatio=k("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new Hg("worker-"+this._moderationId,Xn),this.on(wo.STATE_CHANGE,(i,r)=>{T.debug("[".concat(this._moderationId,"] Moderation operation :").concat(bm[i]," ").concat(r||""))}),this.handleWorkerEvents()}async init(e,n){this.emit(wo.STATE_CHANGE,bm.CONNECT_AP),this._connectInfo=e;const i=this._cancelTokenSource.token;return this._retryConfig=n,new Tt((r,s)=>{this.on(wo.CONNECTION_STATE_CHANGE,(c,l)=>{c===is.CONNECTED&&r()}),this.requestAP(e,i,n).then(c=>{this.connectWorker(c)}).catch(c=>{s(c)})})}updateConfig(e){var n;this._moderationInterval=(n=e.interval)!==null&&n!==void 0?n:1e3,e.extraInfo&&(this._extraInfo=this._encoder.encode(e.extraInfo)),e.vendor&&(this._vendor=e.vendor),T.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(e))),this.connectionState===is.CONNECTED&&this.inspectImage()}async requestAP(e,n,i){const r=k("WEBCS_DOMAIN").map(d=>"https://".concat(d,"/api/v1")),s=await function(d,h,p,m){let{appId:_,areaCode:E,cname:I,sid:C,token:w,uid:D}=h;Nm++;const N="moderation_plugin",L={service_name:N,json_body:JSON.stringify({appId:_,areaCode:E,cname:I,command:"allocateEdge",requestId:Nm,seq:Nm,sid:C,appToken:w,ts:Date.now(),uid:D+""})};let W,G,U=d[0];return Ro(async()=>{W=Date.now();const z=await Io(U,{data:L,cancelToken:p,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(G=Date.now()-W,z.code!==0){const dt=new K(P.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+z.code,{retry:!0,responseTime:G});throw T.error(dt.toString()),dt}const $=JSON.parse(z.json_body);if($.code!==200){const dt=new K(P.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat($.code,", reason: ").concat($.reason),{code:$.code,responseTime:G});throw T.error(dt.toString()),dt}if(!$.servers||!Array.isArray($.servers)||$.servers.length===0){const dt=new K(P.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:$.code,responseTime:G});throw T.error(dt.toString()),dt}if(!$.servers.some(dt=>!!dt.wss)){const dt=new K(P.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:$.code,responseTime:G});throw T.error(dt.toString()),dt}const rt=k("IMAGE_MODERATION_WORKER_HOST");return{addressList:$.servers.map(dt=>{let{address:ae,wss:se}=dt;if(ae&&se)return"wss://".concat(ae.replace(/\./g,"-"),".").concat(rt,":").concat(se,"/moderation")}).filter(dt=>!!dt),workerToken:$.workerToken,vid:$.vid,ticket:$.appTicket,responseTime:G}},(z,$)=>(Pt.apworkerEvent(C,{success:!0,sc:200,serviceName:N,responseDetail:JSON.stringify(z.addressList),firstSuccess:$===0,responseTime:G,serverIp:d[$%d.length]}),!1),(z,$)=>(Pt.apworkerEvent(C,{success:!1,sc:z.data&&z.data.code||200,serviceName:N,responseTime:G,serverIp:d[$%d.length]}),!!(z.code!==P.OPERATION_ABORTED&&z.code!==P.UNEXPECTED_RESPONSE||z.data&&z.data.retry)&&(U=d[($+1)%d.length],!0)),m)}(r,e,n,i);this.emit(wo.STATE_CHANGE,bm.AP_CONNECTED);const{addressList:c,ticket:l}=s;return this._ticket=l,c}async connectWorker(e){this.emit(wo.STATE_CHANGE,bm.CONNECT_WORKER),await this._workerConnection.init(e,1e4)}handleWorkerEvents(){this._workerConnection.on(ee.CONNECTED,async()=>{this.emit(wo.STATE_CHANGE,bm.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=is.CONNECTED}),this._workerConnection.on(ee.CLOSED,()=>{this.connectionState=is.CLOSED}),this._workerConnection.on(ee.FAILED,()=>{this.connectionState=is.CLOSED}),this._workerConnection.on(ee.RECONNECTING,()=>{this.connectionState=this.connectionState===is.CONNECTED?is.RECONNECTING:is.CONNECTING}),this._workerConnection.on(ee.ON_MESSAGE,async e=>{if(e.data instanceof ArrayBuffer){const n=H8(new Uint8Array(e.data));k("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&T.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(n)),this._uploadNum++,n.code===void 0||n.code===0||(this._uploadFailedNum++,T.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(n.code,", msg is ").concat(n.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{Pt.reportApiInvoke(this._connectInfo.sid||null,{name:kn.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,n.code],tag:_n.TRACER}).onError(new K(P.IMAGE_MODERATION_UPLOAD_FAILED,n.msg)),this._uploadTimer=null},k("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else T.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(ee.WILL_RECONNECT,(e,n,i)=>{e==="recover"&&i(e),i("tryNext")}),this._workerConnection.on(ee.REQUEST_NEW_URLS,(e,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(n)})}static intToLong(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}async requestToInspectImage(){const e=Ca(this,wo.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void(k("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&T.debug("Only the track being played can be inspected"));this._sequence++;const i=await this.generateRequestData(e,n);this._workerConnection.sendMessage(i,!0,!0)}else k("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&T.debug("Only the track being published can be inspected")}async generateRequestData(e,n){let{appId:i,cname:r,cid:s,vid:c,sid:l,uid:d}=n;const h=Date.now(),p=await e.getCurrentFrameImage("image/jpeg",this.quality),m=await r1(p,i,r),_=this._sequence+"-"+s+"-"+d+"-"+h+"-"+Je(12,""),E={appId:i,cid:s,cname:r,deviceId:"",elapse:vI.intToLong(Number(h-this._moderationStartTime)),fileSize:p.buffer.byteLength,height:p.height,width:p.width,jpg:m,networkType:6,osType:7,requestId:_,sdkVersion:"4.24.0",sequence:this._sequence,sid:l,timestamp:D2(h),uid:d,vid:c,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete E.callbackData;const I=G8(E);if(I.byteLength<this._workerMessageLengthLimit){if(k("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const C=function(w){for(var D=1;D<arguments.length;D++){var N=arguments[D]!=null?arguments[D]:{};D%2?P2(Object(N),!0).forEach(function(L){O(w,L,N[L])}):Object.getOwnPropertyDescriptors?Object.defineProperties(w,Object.getOwnPropertyDescriptors(N)):P2(Object(N)).forEach(function(L){Object.defineProperty(w,L,Object.getOwnPropertyDescriptor(N,L))})}return w}({},E);delete C.jpg,T.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(C))}return I}{const C=this.quality*this._qualityRatio;return this.quality=C,await this.generateRequestData(e,{appId:i,cname:r,cid:s,vid:c,sid:l,uid:d})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Ir.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=is.CLOSED,this.emit(wo.STATE_CHANGE,bm.CLOSED)}}function k2(t){if(Ke(t.interval,"interval",1e3,1/0),t&&t.extraInfo&&t.extraInfo.length>1024)throw new K(P.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(t&&t.vendor&&t.vendor.length>1024)throw new K(P.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const Z8={name:"ImageModeration",create:function(t){let{config:e}=t;return k2(e),new vI(e)}};var L2,x2,M2,U2,V2,j2,B2,F2,G2,H2,W2,z2,q2,K2,Y2,X2,Q2,J2,Z2,$2,tU,eU,nU,iU,rU,aU,sU,oU,cU,lU,dU,uU,hU,pU,fU,mU,_U,EU,gU,vU,SU,bt;function TU(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function js(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?TU(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):TU(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}Wi.setLogger(T);let $8=(L2=Bt(),x2=Bt({argsMap:(t,e)=>{if(!Array.isArray(e)){if(!(e instanceof _m))return[e];e=[e]}return e.map(n=>n?Object(n).toString():"null")}}),M2=Bt({argsMap:(t,e)=>(e||(e=[]),Array.isArray(e)||e.trackMediaType!==mm.DATA?(Array.isArray(e)||(e=[e]),e.map(n=>n.getTrackId())):[e.getChannelId()])}),U2=Bt({argsMap:(t,e,n,i)=>[typeof e=="object"?e.uid:e,n,i]}),V2=Bt({argsMap:(t,e,n)=>[e,n]}),j2=Bt({argsMap:(t,e)=>e.map(n=>{let{user:i,mediaType:r}=n;return[i==null?void 0:i.uid,r]})}),B2=Bt({argsMap:(t,e,n,i)=>[typeof e=="object"?e.uid:e,n,i]}),F2=Bt({argsMap:(t,e)=>e.map(n=>{let{user:i,mediaType:r}=n;return{uid:i==null?void 0:i.uid,mediaType:r}})}),G2=Bt(),H2=Bt(),W2=Bt(),z2=Bt(),q2=Bt(),K2=Bt(),Y2=Bt(),X2=Bt(),Q2=Bt(),J2=Bt(),Z2=Bt(),$2=Bt(),tU=Bt(),eU=Bt(),nU=Bt(),iU=Bt({argsMap:(t,e)=>[e]}),rU=Bt(),aU=Bt(),sU=Bt(),oU=Bt(),cU=Bt(),lU=Bt(),dU=Bt(),uU=Bt(),hU=Bt({argsMap:(t,e)=>(Array.isArray(e)||(e=[e]),[JSON.stringify(e)])}),pU=Bt(),fU=Bt(),mU=Bt(),_U=Bt(),EU=Bt(),gU=Bt(),vU=Bt({reportResult:!0}),SU=Bt(),bt=class extends Sn{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var t;return((t=this._config)===null||t===void 0?void 0:t.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(t,e){let n;if(super(),O(this,"store",void 0),O(this,"_uid",void 0),O(this,"_channelName",void 0),O(this,"_uintUid",void 0),O(this,"_users",[]),O(this,"_config",void 0),O(this,"_clientId",void 0),O(this,"_appId",void 0),O(this,"_sessionId",null),O(this,"_key",void 0),O(this,"_rtmConfig",{}),O(this,"_joinInfo",void 0),O(this,"_gateway",void 0),O(this,"_statsCollector",void 0),O(this,"_configDistribute",void 0),O(this,"_leaveMutex",void 0),O(this,"_publishMutex",void 0),O(this,"_renewTokenMutex",void 0),O(this,"_subscribeMutex",void 0),O(this,"_encryptionMode","none"),O(this,"_encryptionSecret",null),O(this,"_encryptionSalt",null),O(this,"_encryptDataStream",!1),O(this,"_encryptDataStreamKey",null),O(this,"_encryptDataStreamIv",null),O(this,"_proxyServer",void 0),O(this,"_turnServer",{servers:[],mode:"auto"}),O(this,"_cloudProxyServerMode","disabled"),O(this,"_isDualStreamEnabled",!1),O(this,"_defaultStreamFallbackType",void 0),O(this,"_lowStreamParameter",void 0),O(this,"_streamFallbackTypeCacheMap",new Map),O(this,"_remoteStreamTypeCacheMap",new Map),O(this,"_axiosCancelSource",Ir.CancelToken.source()),O(this,"_audioVolumeIndicationInterval",void 0),O(this,"_networkQualityInterval",void 0),O(this,"_userOfflineTimeout",void 0),O(this,"_streamRemovedTimeout",void 0),O(this,"_liveTranscodeStreamingClient",void 0),O(this,"_liveRawStreamingClient",void 0),O(this,"_channelMediaRelayClient",void 0),O(this,"_networkQualitySensitivity","normal"),O(this,"_p2pChannel",void 0),O(this,"_useLocalAccessPoint",!1),O(this,"_setLocalAPVersion",void 0),O(this,"_joinAndNotLeaveYet",!1),O(this,"_numberOfJoinCount",0),O(this,"_joinResponse",null),O(this,"_remoteDefaultVideoStreamType",void 0),O(this,"_inspect",void 0),O(this,"_moderation",void 0),O(this,"_license",void 0),O(this,"_pendingPublishedUsers",[]),O(this,"ntpAlignErrorCount",0),O(this,"remoteInboundOffset",0),O(this,"_peerConnectionState",void 0),O(this,"_handleLocalTrackEnable",(r,s,c)=>{this.publish(r,!1).then(s).catch(c)}),O(this,"_handleLocalTrackDisable",(r,s,c)=>{this.unpublish(r).then(s).catch(c)}),O(this,"_handleUserOnline",r=>{if(k("BLOCK_LOCAL_CLIENT")&&Gh(r.uid,this.channelName))return void T.debug("[".concat(r.uid,"] will be ignored in local"));this.isStringUID&&typeof r.uid!="string"&&T.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const s=this._users.find(c=>c.uid===r.uid);if(s)s._trust_in_room_=!0,s._is_pre_created&&(s._is_pre_created=!1,this.safeEmit(he.USER_JOINED,s));else{const c=new $d(r.uid,r.uint_id||r.uid);this._users.push(c),T.debug("[".concat(this._clientId,"] user online"),r.uid),this.store.firstVideoFrameDecoded(c.uid,{userJoinNotify:Date.now()}),this.safeEmit(he.USER_JOINED,c)}}),O(this,"_handleUserOffline",r=>{if(k("BLOCK_LOCAL_CLIENT")&&Gh(r.uid,this.channelName))return;const s=this._users.find(c=>c.uid===r.uid);s&&(this._handleRemoveStream(r),this._handleRemoveDataChannels(r),s._audio_pre_subscribed||s._video_pre_subscribed?s._is_pre_created=!0:iR(this._users,s),this._remoteStreamTypeCacheMap.delete(s.uid),this._streamFallbackTypeCacheMap.delete(s.uid),T.debug("[".concat(this._clientId,"] user offline"),r.uid,"reason:",r.reason),this.safeEmit(he.USER_LEAVED,s,r.reason))}),O(this,"_handleAddAudioOrVideoStream",(r,s,c,l,d,h,p,m)=>{if(k("BLOCK_LOCAL_CLIENT")&&Gh(s,this.channelName))return;const _=this._users.find(I=>I.uid===s);if(!_)return void T.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));T.debug("[".concat(this._clientId,"] stream added with uid ").concat(s,", type ").concat(r)),this.store.subscribe(_.uid,r,void 0,void 0,void 0,Date.now()),r==="video"&&this.store.firstVideoFrameDecoded(_.uid,{videoAddNotify:Date.now()});const E=r==="audio"?_.hasAudio:_.hasVideo;if(_._uintid||(_._uintid=h||s),r==="audio"?_._trust_audio_stream_added_state_=!0:_._trust_video_stream_added_state_=!0,r==="audio"?(_._audio_added_=!0,c!==void 0&&(_._audioSSRC=c),l!==void 0&&(_._cname=l),p&&(_._audioOrtc=p)):(_._video_added_=!0,c!==void 0&&(_._videoSSRC=c),l!==void 0&&(_._cname=l),m!==void 0&&(_._rtxSsrcId=m),p&&(_._videoOrtc=p)),(r==="audio"?_.hasAudio:_.hasVideo)&&!E&&(T.info("[".concat(this._clientId,"] remote user ").concat(_.uid," published ").concat(r)),this.safeEmit(he.USER_PUBLISHED,_,r)),r==="video"?Pt.onGatewayStream(this._sessionId,ai.ON_ADD_VIDEO_STREAM,pn.ON_ADD_VIDEO_STREAM,{peer:h||s,ssrc:_._videoSSRC}):Pt.onGatewayStream(this._sessionId,ai.ON_ADD_AUDIO_STREAM,pn.ON_ADD_AUDIO_STREAM,{peer:h||s,ssrc:_._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(_,r,c).then(I=>{if(I&&(T.debug("[".concat(this._clientId,"] resubscribe ").concat(r," for user ").concat(_.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof Zg))return this._p2pChannel.unsubscribe(_,r,!0).then(()=>this._subscribe(_,r,!0).catch(C=>{T.error("[".concat(this._clientId,"] resubscribe error"),C.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(_,r)&&(T.debug("[".concat(this._clientId,"] resubscribe ").concat(r," for user ").concat(_.uid," after reconnect.")),this._subscribe(_,r,!0).catch(I=>{T.error("[".concat(this._clientId,"] resubscribe error"),I.toString())})),r==="video"&&!Di()&&!rr()){const I=this._getEncodingName(d);(I==null?void 0:I.toLocaleLowerCase())==xg.av1&&R8().then(C=>{C||this._gateway.downgradeCodec(I)})}}),O(this,"_handleRemoveStream",r=>{if(k("BLOCK_LOCAL_CLIENT")&&Gh(r.uid,this.channelName))return;const s=this._users.find(l=>l.uid===r.uid);if(!s)return void T.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));T.debug("[".concat(this._clientId,"] stream removed with uid ").concat(r.uid));let c=()=>{};s.hasAudio&&s.hasVideo?c=()=>{T.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished audio track")),this.safeEmit(he.USER_UNPUBLISHED,s,"audio"),T.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished video track")),this.safeEmit(he.USER_UNPUBLISHED,s,"video")}:s.hasVideo?c=()=>{T.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished video track")),this.safeEmit(he.USER_UNPUBLISHED,s,"video")}:s.hasAudio&&(c=()=>{T.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished audio track")),this.safeEmit(he.USER_UNPUBLISHED,s,"audio")}),s._video_pre_subscribed||s._audio_pre_subscribed||(s._trust_audio_stream_added_state_=!0,s._trust_video_stream_added_state_=!0,s._audio_added_=!1,s._video_added_=!1,this._p2pChannel instanceof Zg&&this._p2pChannel.unsubscribe(s).then(l=>{if(l)return this._gateway.unsubscribe(l,s.uid)}),s._audioSSRC=void 0,s._videoSSRC=void 0,s._audioOrtc=void 0,s._videoOrtc=void 0,s._rtxSsrcId=void 0),Pt.onGatewayStream(this._sessionId,ai.ON_REMOVE_STREAM,pn.ON_REMOVE_STREAM,{peer:r.uint_id||r.uid}),c()}),O(this,"_handleSetStreamLocalEnable",(r,s,c)=>{if(k("BLOCK_LOCAL_CLIENT")&&Gh(s,this.channelName))return;const l=this._users.find(p=>p.uid===s);if(!l)return void T.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));T.debug("[".concat(this._clientId,"] local ").concat(r," ").concat(c?"enabled":"disabled"," with uid ").concat(s));const d=r==="audio"?l.hasAudio:l.hasVideo;if(r==="audio"){l._trust_audio_enabled_state_=!0;const p=l._audio_enabled_;if(l._audio_enabled_=c,l._audio_enabled_===p)return;{const m=l._audio_enabled_?"enable-local-audio":"disable-local-audio";T.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(s,", msg: ").concat(m)),this.safeEmit(he.USER_INFO_UPDATED,s,m)}}else{l._trust_video_enabled_state_=!0;const p=l._video_enabled_;if(l._video_enabled_=c,l._video_enabled_===p)return;{const m=l._video_enabled_?"enable-local-video":"disable-local-video";T.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(s,", msg: ").concat(m)),this.safeEmit(he.USER_INFO_UPDATED,s,m)}}const h=r==="audio"?l.hasAudio:l.hasVideo;return d!==h?!d&&h?(T.info("[".concat(this._clientId,"] remote user ").concat(s," published ").concat(r)),void this.safeEmit(he.USER_PUBLISHED,l,r)):(r==="video"&&l._videoTrack&&l._videoTrack._destroy(),r==="audio"&&l._audioTrack,this._p2pChannel.muteRemote(l,r),T.info("[".concat(this._clientId,"] remote user ").concat(s," unpublished ").concat(r)),void this.safeEmit(he.USER_UNPUBLISHED,l,r)):void 0}),O(this,"_handleMuteStream",(r,s,c)=>{if(k("BLOCK_LOCAL_CLIENT")&&Gh(r,this.channelName))return;T.debug("[".concat(this._clientId,"] receive mute message"),r,s,c);const l=this._users.find(p=>p.uid===r);if(!l)return void T.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(r));const d=s==="audio"?l.hasAudio:l.hasVideo;if(s==="audio"){l._trust_audio_mute_state_=!0;const p=l._audio_muted_;if(l._audio_muted_=c,l._audio_muted_===p)return;{const m=l._audio_muted_?"mute-audio":"unmute-audio";T.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(r,", msg: ").concat(m)),this.safeEmit(he.USER_INFO_UPDATED,r,m)}}else{l._trust_video_mute_state_=!0;const p=l._video_muted_;if(l._video_muted_=c,l._video_muted_===p)return;{const m=l._video_muted_?"mute-video":"unmute-video";T.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(r,", msg: ").concat(m)),this.safeEmit(he.USER_INFO_UPDATED,r,m)}}const h=s==="audio"?l.hasAudio:l.hasVideo;if(d!==h){if(!d&&h)return(s==="audio"?l._audioSSRC:l._videoSSRC)?(T.info("[".concat(this._clientId,"] remote user ").concat(r," published ").concat(s)),void this.safeEmit(he.USER_PUBLISHED,l,s)):void T.warning("[".concat(this._clientId,"] remote user ").concat(r," receive ").concat(s," unmute message  before add stream message, ").concat(s," SSRC doesn't exist yet."));s==="video"&&l._videoTrack&&!l._video_pre_subscribed&&l._videoTrack._destroy(),s==="audio"&&l._audioTrack,this._p2pChannel.muteRemote(l,s),T.info("[".concat(this._clientId,"] remote user ").concat(r," unpublished ").concat(s)),this.safeEmit(he.USER_UNPUBLISHED,l,s)}}),O(this,"_handleP2PLost",async r=>{T.debug("[".concat(this._clientId,"] receive p2p lost"),r),parseInt(r.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():T.warning("[".concat(this._clientId,"] P2PLost stream not found"),r)}),O(this,"_handleTokenWillExpire",()=>{T.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(he.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),O(this,"_handleBeforeUnload",r=>{r.type==="beforeunload"&&r.returnValue!==void 0&&r.returnValue!==""||(this.leave(),T.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),O(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(he.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const r={downlinkNetworkQuality:0,uplinkNetworkQuality:0};r.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),r.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(he.NETWORK_QUALITY,r)}),O(this,"_handleP2PAddAudioOrVideoStream",(r,s,c,l)=>{const d=this._users.find(p=>p.uid===s);if(!d)return void T.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));T.debug("[".concat(this._clientId,"] stream added with uid ").concat(s,", type ").concat(r)),this.store.subscribe(d.uid,r,void 0,void 0,void 0,Date.now());const h=r==="audio"?d.hasAudio:d.hasVideo;r==="audio"?d._trust_audio_stream_added_state_=!0:d._trust_video_stream_added_state_=!0,r==="audio"?(d._audio_added_=!0,c!==void 0&&(d._audioSSRC=c),l!==void 0&&(d._audioMid=l)):(d._video_added_=!0,c!==void 0&&(d._videoSSRC=c),l!==void 0&&(d._videoMid=l)),(r==="audio"?d.hasAudio:d.hasVideo)&&!h&&(T.info("[".concat(this._clientId,"] remote user ").concat(d.uid," published ").concat(r)),this.safeEmit(he.USER_PUBLISHED,d,r)),this._p2pChannel.hasPendingRemoteMedia(d,r)&&(T.debug("[".concat(this._clientId,"] resubscribe ").concat(r," for user ").concat(d.uid," after reconnect.")),this._subscribe(d,r,!0).catch(p=>{T.error("[".concat(this._clientId,"] resubscribe error"),p.toString())}))}),this._config=t,this._clientId=e||Je(5,"client-"),this.store=new class{constructor(r,s,c,l){Xt(this,"state",void 0),this.state={codec:r,audioCodec:s,mode:c,clientId:l,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,keyMetrics:{publish:[],subscribe:[],firstVideoFrameDecoded:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:xh.Default,hasStartJoinChannel:!1,isABTestSuccess:!1,autoSubscribe:!1,enableInstantMuteRestore:!1}}dispatch(r){this.state=function(s,c){switch(c.type){case Qt.SET_SESSION_ID:return ut(ut({},s),{},{sessionId:c.sessionId});case Qt.SET_P2P_ID:return ut(ut({},s),{},{p2pId:c.p2pId});case Qt.SET_UID:return ut(ut({},s),{},{uid:c.uid});case Qt.SET_INT_UID:return ut(ut({},s),{},{intUid:c.intUid});case Qt.SET_PUB_ID:return ut(ut({},s),{},{pubId:c.pubId});case Qt.KEY_METRIC_CLIENT_CREATED:return ut(ut({},s),{},{keyMetrics:ut(ut({},s.keyMetrics),{},{clientCreated:c.metric})});case Qt.KEY_METRIC_JOIN_START:return ut(ut({},s),{},{keyMetrics:ut(ut({},s.keyMetrics),{},{joinStart:c.metric})});case Qt.KEY_METRIC_PRELOAD_START:return ut(ut({},s),{},{keyMetrics:ut(ut({},s.keyMetrics),{},{preloadStart:c.metric})});case Qt.KEY_METRIC_PRELOAD_END:return ut(ut({},s),{},{keyMetrics:ut(ut({},s.keyMetrics),{},{preloadEnd:c.metric})});case Qt.KEY_METRIC_JOIN_END:return ut(ut({},s),{},{keyMetrics:ut(ut({},s.keyMetrics),{},{joinEnd:c.metric})});case Qt.KEY_METRIC_REQUEST_AP_START:return ut(ut({},s),{},{keyMetrics:ut(ut({},s.keyMetrics),{},{requestAPStart:c.metric})});case Qt.KEY_METRIC_REQUEST_AP_END:return ut(ut({},s),{},{keyMetrics:ut(ut({},s.keyMetrics),{},{requestAPEnd:c.metric})});case Qt.KEY_METRIC_REQUEST_SUA_END:return ut(ut({},s),{},{keyMetrics:ut(ut({},s.keyMetrics),{},{requestSUAEnd:c.metric})});case Qt.KEY_METRIC_BEFORE_CONNECT:return ut(ut({},s),{},{keyMetrics:ut(ut({},s.keyMetrics),{},{beforeConnect:c.metric})});case Qt.KEY_METRIC_PEER_RECEIVER:return ut(ut({},s),{},{keyMetrics:ut(ut({},s.keyMetrics),{},{peerReceiver:c.metric})});case Qt.KEY_METRIC_SIGNAL_CONNECTED:return ut(ut({},s),{},{keyMetrics:ut(ut({},s.keyMetrics),{},{signalConnected:c.metric})});case Qt.KEY_METRIC_JOIN_REQ:return ut(ut({},s),{},{keyMetrics:ut(ut({},s.keyMetrics),{},{joinReq:c.metric})});case Qt.KEY_METRIC_JOIN_REP:return ut(ut({},s),{},{keyMetrics:ut(ut({},s.keyMetrics),{},{joinRep:c.metric})});case Qt.KEY_METRIC_JOIN_GATEWAY_START:return ut(ut({},s),{},{keyMetrics:ut(ut({},s.keyMetrics),{},{joinGatewayStart:c.metric})});case Qt.KEY_METRIC_JOIN_GATEWAY_END:return ut(ut({},s),{},{keyMetrics:ut(ut({},s.keyMetrics),{},{joinGatewayEnd:c.metric})});case Qt.KEY_METRIC_PEER_CONNECTION_START:return ut(ut({},s),{},{keyMetrics:ut(ut({},s.keyMetrics),{},{peerConnectionStart:c.metric})});case Qt.KEY_METRIC_PEER_CONNECTION_END:return ut(ut({},s),{},{keyMetrics:ut(ut({},s.keyMetrics),{},{peerConnectionEnd:c.metric})});case Qt.KEY_METRIC_DESCRIPTION_START:return ut(ut({},s),{},{keyMetrics:ut(ut({},s.keyMetrics),{},{descriptionStart:c.metric})});case Qt.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return ut(ut({},s),{},{keyMetrics:ut(ut({},s.keyMetrics),{},{signalChannelOpen:c.metric})});case Qt.KEY_METRIC_ICE_CONNECTION_END:return ut(ut({},s),{},{keyMetrics:ut(ut({},s.keyMetrics),{},{iceConnectionEnd:c.metric})});case Qt.KEY_METRIC_PUBLISH:{const l=s.keyMetrics.publish,d=l.findIndex(h=>h.trackId===c.metric.trackId);return d!==-1?(l[d]=ut(ut({},l[d]),c.metric),ut(ut({},s),{},{keyMetrics:ut(ut({},s.keyMetrics),{},{publish:[...l]})})):ut(ut({},s),{},{keyMetrics:ut(ut({},s.keyMetrics),{},{publish:[...s.keyMetrics.publish,c.metric]})})}case Qt.KEY_METRIC_SUBSCRIBE:{const l=s.keyMetrics.subscribe,d=l.findIndex(h=>h.userId===c.metric.userId&&h.type===c.metric.type);return d!==-1?(l[d]=ut(ut({},l[d]),c.metric),ut(ut({},s),{},{keyMetrics:ut(ut({},s.keyMetrics),{},{subscribe:[...l]})})):ut(ut({},s),{},{keyMetrics:ut(ut({},s.keyMetrics),{},{subscribe:[...s.keyMetrics.subscribe,c.metric]})})}case Qt.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED:{const l=s.keyMetrics.firstVideoFrameDecoded,d=l.findIndex(h=>h.userId===c.metric.userId);return d!==-1?(l[d]=ut(ut({},l[d]),c.metric),ut(ut({},s),{},{keyMetrics:ut(ut({},s.keyMetrics),{},{firstVideoFrameDecoded:[...l]})})):ut(ut({},s),{},{keyMetrics:ut(ut({},s.keyMetrics),{},{firstVideoFrameDecoded:[...s.keyMetrics.firstVideoFrameDecoded,c.metric]})})}case Qt.RESET_FIRST_VIDEO_FRAME_DECODED:return s.keyMetrics.firstVideoFrameDecoded=[],s;case Qt.SET_CLOUD_PROXY_SERVER_MODE:return s.cloudProxyServerMode=c.mode,s;case Qt.RECORD_JOIN_CHANNEL_SERVICE:return typeof c.index!="number"?s.joinChannelServiceRecords=[...s.joinChannelServiceRecords,c.record]:(s.joinChannelServiceRecords[c.index]=ut(ut({},s.joinChannelServiceRecords[c.index]),c.record),s.joinChannelServiceRecords=[...s.joinChannelServiceRecords]),s;case Qt.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return s.joinChannelServiceRecords=[],s;case Qt.RESET_KEY_METRICS:return s.keyMetrics={publish:[],subscribe:[],firstVideoFrameDecoded:[]},s;case Qt.SET_USE_P2P:return ut(ut({},s),{},{useP2P:c.val});case Qt.SET_TRANSPORT_TYPE:return ut(ut({},s),{},{p2pTransport:c.val});default:return s}}(this.state,r)}set autoSubscribe(r){this.state.autoSubscribe=r}get autoSubscribe(){return this.state.autoSubscribe}set enableInstantMuteRestore(r){this.state.enableInstantMuteRestore=r}get enableInstantMuteRestore(){return this.state.enableInstantMuteRestore}set sessionId(r){this.dispatch({type:Qt.SET_SESSION_ID,sessionId:r})}get sessionId(){return this.state.sessionId}set cid(r){this.state.cid=r}get cid(){return this.state.cid}set codec(r){this.state.codec=r}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(r){this.dispatch({type:Qt.SET_P2P_ID,p2pId:r})}get p2pId(){return this.state.p2pId}set dcId(r){this.dispatch({type:Qt.SET_DC_ID,dcId:r})}get dcId(){return this.state.dcId}set uid(r){this.dispatch({type:Qt.SET_UID,uid:r})}get uid(){return this.state.uid}set intUid(r){this.dispatch({type:Qt.SET_INT_UID,intUid:r})}get intUid(){return this.state.intUid}set pubId(r){this.dispatch({type:Qt.SET_PUB_ID,pubId:r})}get pubId(){return this.state.pubId}set cloudProxyServerMode(r){this.dispatch({type:Qt.SET_CLOUD_PROXY_SERVER_MODE,mode:r})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(r){this.dispatch({type:Qt.SET_USE_P2P,val:r})}get useP2P(){return this.state.useP2P}set p2pTransport(r){this.dispatch({type:Qt.SET_TRANSPORT_TYPE,val:r})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(r){this.state.hasStartJoinChannel=r}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(r){this.state.isABTestSuccess=r}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:Qt.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:Qt.KEY_METRIC_JOIN_START,metric:Date.now()})}preloadStart(){this.dispatch({type:Qt.KEY_METRIC_PRELOAD_START,metric:Date.now()})}preloadEnd(){this.dispatch({type:Qt.KEY_METRIC_PRELOAD_END,metric:Date.now()})}joinEnd(){this.dispatch({type:Qt.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:Qt.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:Qt.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}requestSUAEnd(){this.dispatch({type:Qt.KEY_METRIC_REQUEST_SUA_END,metric:Date.now()})}beforeConnect(){this.dispatch({type:Qt.KEY_METRIC_BEFORE_CONNECT,metric:Date.now()})}peerReceiver(){this.dispatch({type:Qt.KEY_METRIC_PEER_RECEIVER,metric:Date.now()})}signalConnected(){this.dispatch({type:Qt.KEY_METRIC_SIGNAL_CONNECTED,metric:Date.now()})}joinReq(){this.dispatch({type:Qt.KEY_METRIC_JOIN_REQ,metric:Date.now()})}joinRep(){this.dispatch({type:Qt.KEY_METRIC_JOIN_REP,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:Qt.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:Qt.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:Qt.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:Qt.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}firstVideoFrameDecoded(r,s){this.dispatch({type:Qt.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED,metric:ut({userId:r},s)})}descriptionStart(){this.dispatch({type:Qt.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:Qt.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:Qt.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(r,s,c,l){this.dispatch({type:Qt.KEY_METRIC_PUBLISH,metric:ut(ut({trackId:r,type:s},c&&{publishStart:c}),l&&{publishEnd:l})})}subscribe(r,s,c,l,d,h,p){this.dispatch({type:Qt.KEY_METRIC_SUBSCRIBE,metric:ut(ut(ut(ut(ut({userId:r,type:s},c&&{subscribeStart:c}),l&&{subscribeEnd:l}),d&&{firstFrame:d}),h&&{streamAdded:h}),p&&{firstDecoded:p})})}massSubscribe(r,s,c,l){r.forEach(d=>{this.dispatch({type:Qt.KEY_METRIC_SUBSCRIBE,metric:ut(ut(ut({userId:d.userId,type:d.type},s&&{subscribeStart:s}),c&&{subscribeEnd:c}),l&&{firstFrame:l})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(r,s){r.service==="gateway"&&Array.isArray(r.urls)&&(r.urls=r.urls.map(c=>c.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof s!="number"?(this.dispatch({type:Qt.RECORD_JOIN_CHANNEL_SERVICE,record:ut(ut({},r),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(s<0||s>=this.state.joinChannelServiceRecords.length||this.dispatch({type:Qt.RECORD_JOIN_CHANNEL_SERVICE,record:r,index:s}),s)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:Qt.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:Qt.RESET_KEY_METRICS})}resetFirstVideoFrameDecoded(){this.dispatch({type:Qt.RESET_FIRST_VIDEO_FRAME_DECODED})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}}(t.codec,t.audioCodec,t.mode,this._clientId),this._leaveMutex=new Wi("client-leave",this._clientId),this._publishMutex=new Wi("client-publish",this._clientId),this._renewTokenMutex=new Wi("client-renewtoken",this._clientId),this._subscribeMutex=new Wi("client-subscribe",this._clientId),this.store.clientCreated(),t.proxyServer&&this.setProxyServer(t.proxyServer,!0),t.turnServer&&this.setTurnServer(t.turnServer,!0),T.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat($a," build: ").concat(rw,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),t.clientRoleOptions)try{zA(t.clientRoleOptions),n=Object.assign({},t.clientRoleOptions)}catch(r){T.warning("[".concat(this._clientId,"] ").concat(r.toString()))}var i;this._statsCollector=new Qg(this.store),this._statsCollector.onStatsException=(r,s,c)=>{T.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(r,", msg: ").concat(s,", uid: ").concat(c)),r===iI.VIDEO_ENCODE_FAILED&&this.localTracks.forEach(l=>{l instanceof ER&&k("ENABLE_ENCODE_EXCEPTION")&&l.findClosestProfile()}),this.safeEmit(he.EXCEPTION,{code:r,msg:s,uid:c})},this._statsCollector.onUploadPublishDuration=(r,s,c,l)=>{const d=this._users.find(h=>h.uid===r);d&&(this.store.keyMetrics&&(this.store.firstVideoFrameDecoded(d._uintid,{peerPublishDuration:c,peerPubStatusMs:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(d)),Pt.peerPublishStatus(this._sessionId,{subscribeElapse:l,audioPublishDuration:s,videoPublishDuration:c,peer:d._uintid}))},this._statsCollector.onVideoCodecChanged=r=>{if(k("VIDEO_STANDARD_BITRATE_VERSION")&&(r==="av1"||r==="h265"||r==="h264")){const s=this.localTracks.find(c=>c instanceof sn);s&&s._saveEncodeBitrateRatio!==1&&s.setSaveEncodeBitrateRatio(r==="h264"?k("BASELINE_MORE_H264_BITRATE_RATIO"):void 0)}},this.store.useP2P=t.mode==="p2p",this._gateway=new E8(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:t.websocketRetryConfig||Xn,httpRetryConfig:t.httpRetryConfig||Xn,forceWaitGatewayResponse:t.forceWaitGatewayResponse===void 0||t.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:t.role,clientRoleOptions:n}),this._configDistribute=new I8(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(i={store:this.store,statsCollector:this._statsCollector},wl("P2PChannel").create(i)),this._handleP2PEvents()):this._p2pChannel=new Zg(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(t,e,n,i,r){let s=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],c=arguments.length>6&&arguments[6]!==void 0&&arguments[6];Fe("JOIN_GATEWAY_USE_443PORT_ONLY",s),Fe("JOIN_GATEWAY_USE_DUAL_DOMAIN",c);const l=this._gateway.signal.websocket;return l instanceof Gw&&(l.use443PortOnly=s,l.tryDoubleDomain=c),async function(d,h,p){Zy.get(d)||Zy.set(d,[]),$y.get(d)||$y.set(d,h),Ec.get(d)||Ec.set(d,0);const m=Zy.get(d),_=$y.get(d);if(!m||!_)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(Ec.get(d)===_){const D=Ag();m.push(D),await D.promise}Ec.set(d,Ec.get(d)+1);for(var E=arguments.length,I=new Array(E>3?E-3:0),C=3;C<E;C++)I[C-3]=arguments[C];const w=await p(...I);return Ec.set(d,Ec.get(d)-1),Ec.get(d)===_-1&&m.length>0&&(m[0].resolve(),m.shift()),Ec.get(d)===0&&(Zy.set(d,[]),$y.set(d,0),Ec.set(d,0)),w}("client.join",k("JOIN_MAX_CONCURRENCY"),this.join.bind(this),t,e,n,i,r)}async join(t,e,n,i,r){const s=++this._numberOfJoinCount;this.store.joinStart(),i&&(this.store.uid=i);const c=(sR||sR||(sR=(window.location.protocol.split(":")[0]||"").toUpperCase(),sR))==="HTTPS",l=gL()?window.isSecureContext:"Browser Not Support";(!gL()&&!c||!window.isSecureContext)&&T.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser");let d;Pt.setAppId(t);try{if(!n&&n!==null)throw new K(P.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));if(n&&Ti(n,"token",1,2047),Ti(t,"appid",1,2047),IR(e),i&&OR(i),r)if(typeof r=="string")Ti(r,"optionalInfo",1,256),d=r;else{if(typeof r!="object")throw new K(P.INVALID_PARAMS,"Invalid options: options is not a string or object");{const{autoSubscribe:w,enableInstantMuteRestore:D}=r;w&&(yo(w,"autoSubscribe"),T.info("[".concat(this._clientId,"] join: autoSubscribe: ").concat(w)),this.store.autoSubscribe=w),D&&(yo(D,"enableInstantMuteRestore"),T.info("[".concat(this._clientId,"] join: enableInstantMuteRestore: ").concat(D)),this.store.enableInstantMuteRestore=D)}}}catch(w){throw Pt.reportApiInvoke(Lh(),{name:kn.JOIN,options:[t,e,n,i],states:{isHttps:c,isSecureContext:l},tag:_n.TRACER}).onError(w),w}if(this._leaveMutex.isLocked&&(T.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),T.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const w=new K(P.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw Pt.reportApiInvoke(Lh(),{name:kn.JOIN,options:[t,e,n,i],states:{isHttps:c,isSecureContext:l},tag:_n.TRACER}).onError(w),w}this._gateway.state="CONNECTING",this.store.preloadStart();const h=await E2({appId:t,cname:e,uid:i,stringUid:typeof i=="string"?i:void 0,token:n||t,cloudProxyServer:this._cloudProxyServerMode});if(this.store.preloadEnd(),!this._joinAndNotLeaveYet)throw new K(P.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const p=(h==null?void 0:h.sid)||Lh();T.info("[".concat(this._clientId,"] start join channel ").concat(e,", join number: ").concat(s)),this._sessionId||(this._sessionId=p,this.store.sessionId=this._sessionId);const m=Pt.reportApiInvoke(p,{id:this._clientId,name:kn.JOIN,options:[t,e,n,i],states:{isHttps:c,isSecureContext:l},tag:_n.TRACER}),_=js(js(js({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:t,sid:this._sessionId,cname:e,uid:typeof i!="string"?i:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:n||t,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:d,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!h},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:k("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(_.setLocalAPVersion=this._setLocalAPVersion),typeof i=="string"&&(_.stringUid=i,this._uintUid?(_.uid=this._uintUid,this._uintUid=void 0):_.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(_.aesmode=this._encryptionMode,_.aespassword=await(async w=>{const D=function(G){const U=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),z=new Uint8Array(new ArrayBuffer(U.length));for(let $=0;$<U.length;$+=1)z[$]=U.charCodeAt($);return z}(),N=await window.crypto.subtle.importKey("spki",D,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),L=HA(w),W=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},N,L);return function(G){let U="";for(let z=0;z<G.length;z+=1)U+=String.fromCharCode(G[z]);return window.btoa(U)}(new Uint8Array(W))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new K(P.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(_.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const w=new TextEncoder,D=k("USE_PURE_ENCRYPTION_MASTER_KEY")?w.encode(_.appId+this._encryptionSecret+this._encryptionSecret):w.encode(_.appId+_.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(N,L,W){const G=await window.crypto.subtle.importKey("raw",L,"PBKDF2",!1,["deriveBits","deriveKey"]),U=N==="aes-128-gcm2"?128:256,z=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:IL,hash:"SHA-256",salt:W},G,U+K6);return new Uint8Array(z).subarray(U/8)}(this._encryptionMode,D,kh(this._encryptionSalt)),this._encryptDataStreamKey=await async function(N,L,W){const G=await window.crypto.subtle.importKey("raw",L,"PBKDF2",!1,["deriveBits","deriveKey"]),U=N==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:IL,hash:"SHA-256",salt:W},G,{name:"AES-GCM",length:U},!0,["encrypt","decrypt"])}(this._encryptionMode,D,kh(this._encryptionSalt))}else l?T.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):T.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,T.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:e,appId:t,stringUid:_.stringUid});const E=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&E===this._sessionId&&Pt.joinChannelTimeout(this._sessionId,5)},5e3);try{var I;let w;const D=_.cloudProxyServer;if(mt(I=["proxy3","proxy4","proxy5"]).call(I,D)){const U=k("PROXY_SERVER_TYPE3");Array.isArray(U)?_.proxyServer=U[0]:_.proxyServer=U}if(Pt.setProxyServer(_.proxyServer),T.setProxyServer(_.proxyServer),this.store.requestAPStart(),h){if(T.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(_.stringUid?", ".concat(_.stringUid," => ").concat(h.intUid):""," ")),_.stringUid&&!_.uid&&(_.uid=h.intUid),w={gatewayInfo:h.ap.gatewayInfo},k("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&_.turnServer.mode==="auto")if(h.ap.proxyInfo.addresses.length===0)T.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const U=(await pM(h.ap.proxyInfo,h.ap.gatewayInfo.uid)).map(z=>({turnServerURL:z.address,tcpport:z.tcpport||Li.tcpport,udpport:z.udpport||Li.udpport,username:z.username||Li.username,password:z.password||Li.password,forceturn:!1,security:!0}));_.turnServer={mode:"manual",servers:U}}S2(h,_.stringUid)}else{if(_.stringUid&&!_.uid){let U;[U,w]=await Tt.all([FM(_.stringUid,_,this._axiosCancelSource.token,this._config.httpRetryConfig||Xn,this.store).finally(()=>{this.store.requestSUAEnd()}),BM(_,this._axiosCancelSource.token,this._config.httpRetryConfig||Xn,!0,this.store).finally(()=>{this.store.requestAPEnd()})]),T.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(_.stringUid," => ").concat(U)),_.uid=U,w.gatewayInfo.uid=U,w.gatewayInfo.res.uid=U}else w=await BM(_,this._axiosCancelSource.token,this._config.httpRetryConfig||Xn,!0,this.store);if(!this._joinAndNotLeaveYet)throw new K(P.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(_,this._axiosCancelSource.token),this._configDistribute.on(Fg.UPDATE_BITRATE_LIMIT,U=>{this._p2pChannel.updateBitrateLimit(U)}),this._configDistribute.on(Fg.UPDATE_CLIENT_ROLE_OPTIONS,U=>{this._setClientRoleOptions(U)})},0),this._key=n||t;const N=w.gatewayInfo,L=_.uid?_.uid:N.uid;this._joinInfo=js(js({},_),{},{cid:N.cid,uid:L,vid:N.vid,apResponse:N.res,apGatewayAddress:N.apGatewayAddress,uni_lbs_ip:N.uni_lbs_ip,gatewayAddrs:N.gatewayAddrs}),this.store.intUid=L,this.store.cid=N.cid;const W=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new K(P.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));m.onSuccess(W),this._appId=t,this._channelName=_.cname,this._uid=W,this.store.uid=W,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(Di()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const G=_.stringUid?"string uid: ".concat(_.stringUid,",uid: ").concat(_.uid):"uid: ".concat(this._uid);return T.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(e,",").concat(G)),setTimeout(()=>{T.startUpload()},5e3),this.store.joinEnd(),C=this,mt(Fh).call(Fh,C)||Fh.push(C),this._cloudProxyServerMode==="disabled"&&be().supportWebCrypto&&k("ENABLE_PRELOAD")&&EI(this._joinInfo),W}catch(w){const D=Array.isArray(w)?w[0]:w;throw D&&D.code===P.OPERATION_ABORTED?T.warning("[".concat(this._clientId,"] join number: ").concat(s,", Joining channel failed, rollback"),D):T.error("[".concat(this._clientId,"] join number: ").concat(s,", Joining channel failed, rollback"),D),D.code!==P.OPERATION_ABORTED&&this._numberOfJoinCount===s&&(this._gateway.state="DISCONNECTED",this._reset()),m.onError(D),D}var C}_joinGateway(){if(!this._joinInfo||!this._key)throw new K(P.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!k("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){T.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(Di()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(e){const n=Fh.indexOf(e);n!==-1&&Fh.splice(n,1)}(this),this._statsCollector.stopUpdateStats();const t=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return T.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void t();await this._gateway.leave(this.connectionState!=="CONNECTED",xe.LEAVE),T.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),t()}async publish(t){let e=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(t)){if(!(t instanceof _m))return this._publishDataChannel(t);t=[t]}if(t.length===0)throw new K(P.INVALID_PARAMS,"param list is empty");const n=t;if(this._gateway.role==="audience")throw new K(P.INVALID_OPERATION,"audience can not publish stream");for(const r of n){if(!(r instanceof _m))throw new K(P.INVALID_PARAMS,"parameter is not local track");if(!r._enabled&&e)throw new K(P.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(r.getTrackId()))}T.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(n.map(r=>"".concat(r.getTrackId()," "))));const i=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),e&&n.forEach(r=>{const s=this._configDistribute.getBitrateLimit();r instanceof sn&&s&&r.setBitrateLimit(s.uplink)});try{await this._publishHighStream(n),T.info("[".concat(this._clientId,"] Publish success, id ").concat(n.map(r=>"".concat(r.getTrackId()," "))))}catch(r){throw T.error("[".concat(this._clientId,"] publish error"),r.toString()),r}finally{i()}}async _publishDataChannel(t){if(t==null)throw new K(P.INVALID_PARAMS,"parameter is not local track or datachannel config, config is ".concat(JSON.stringify(t)));Ke(t.id,"id",0,65535,!0),yo(t.ordered,"ordered"),Ti(t.metadata,"metadata",0,512),T.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(t.id));const e=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(r=>r.id===t.id)!==-1)throw new K(P.INVALID_PARAMS,"Invalid id: ".concat(t.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new K(P.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new K(P.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&k("FORCE_TURN")&&!k("TURN_ENABLE_TCP")&&!k("TURN_ENABLE_UDP"))throw new K(P.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const n=function(r){return DM(r,!1)}(t),i=await this._p2pChannel.publishDataChannel([n]);if(i.length>0){if(typeof n._originDataChannelId!="number")throw T.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new K(P.CREATE_DATACHANNEL_ERROR);try{await Tt.all(i.map(r=>this._uid&&this._gateway.publishDataChannel(this._uid,r,!0))),await n._waitTillOpen()}catch(r){if(r.code!==P.DISCONNECT_P2P)throw r}}return T.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(n.id)),n}catch(n){throw T.error("[".concat(this._clientId,"] publish datachannels error"),n.toString()),n}finally{e()}}async unpublish(t){if(!this._joinInfo||this._uid===void 0)throw new K(P.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let e=[];if(t)if(Array.isArray(t))e=t;else{if(!(t instanceof _m))return this._unpublishDataChannel([t]);e=[t]}else this.store.useP2P||await this._unpublishDataChannel(),e=this._p2pChannel.getAllTracks(!0);T.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(e.map(i=>"".concat(i.getTrackId()," "))," "));const n=await this._publishMutex.lock();try{if(this.store.useP2P){const i=await this._p2pChannel.unpublish(e);i&&await this._gateway.sendExtensionMessage(jn.UNPUBLISH,{unpubMsg:i},!0)}else{const i=await this._p2pChannel.unpublish(e);i&&await this._gateway.unpublish(i,this._uid),T.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(e.map(r=>"".concat(r.getTrackId()))))}}catch(i){throw T.error("[".concat(this._clientId,"] unpublish error"),i.toString()),i}finally{n&&n()}}async _unpublishDataChannel(t){t!==void 0&&t.length!==0||(t=this._p2pChannel.getAllDataChannels()),T.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(t.map(n=>"".concat(n.id," "))," "));const e=await this._publishMutex.lock();try{const n=await this._p2pChannel.unpublishDataChannel(t);n&&await this._gateway.unpublishDataChannel(n),T.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(t.map(i=>"".concat(i.id))))}catch(n){throw T.error("[".concat(this._clientId,"] unpublish dataChannel error"),n.toString()),n}finally{e&&e()}}async subscribe(t,e,n){if(!(t instanceof $d)){const i=this.remoteUsers.find(r=>r.uid===t);if(!i)throw new K(P.INVALID_REMOTE_USER,"user is not in the channel");t=i}return e==="datachannel"?this._subscribeDataChannel(t,n):this._subscribe(t,e)}async presubscribe(t,e){if(ri(e,"mediaType",["audio","video"]),this.store.useP2P)throw new K(P.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new K(P.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new K(P.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const n=e===Ct.AUDIO,i=e===Ct.VIDEO,r=await this._subscribeMutex.lock();try{const{ssrcId:s,ortc:c,rtxSsrcId:l,cname:d,uint_id:h}=await this._gateway.presubscribe(t,e,!0);if(s==null)throw new K(P.UNEXPECTED_RESPONSE,"no ssrc id");let p=this._users.find(_=>_.uid===t);p||(p=new $d(t,h||t),p._is_pre_created=!0,this._users.push(p)),d&&(p._cname=d),p._uintid||(p._uintid=h||t),n&&(p._audioSSRC=s,p._audio_pre_subscribed=!0,c&&(p._audioOrtc=c)),i&&(p._videoSSRC=s,p._video_pre_subscribed=!0,c&&(p._videoOrtc=c),l!=null&&(p._rtxSsrcId=l)),T.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(s)),await this._p2pChannel.subscribe(p,e,s,l,c);const m=n?p._audioTrack:p._videoTrack;if(!m)throw new K(P.UNEXPECTED_ERROR,"can not find remote track in user");return n&&(p._trust_audio_stream_added_state_=!0,p._audio_added_=!0),i&&(p._trust_video_stream_added_state_=!0,p._video_added_=!0),m}catch(s){throw T.error("[".concat(this._clientId,"] presub user ").concat(t," error"),s),s}finally{r()}}async _subscribeDataChannel(t,e){var n;if(Ke(e,"channelId",0,65535,!0),!this._joinInfo)throw new K(P.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new K(P.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(l=>l===t))throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),new K(P.INVALID_REMOTE_USER,"user is not in the channel");if(!t.hasAudio&&!t.hasVideo&&t._dataChannels.length===0)throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),new K(P.INVALID_REMOTE_USER,"user is not published");const r=(n=t._dataChannels)===null||n===void 0?void 0:n.find(l=>l.id===e);if(!r)throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, remote datachannel is not published")),new K(P.REMOTE_USER_IS_NOT_PUBLISHED);const s=await this._subscribeMutex.lock();T.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: datachannel"));try{const l=await this._p2pChannel.subscribeDataChannel(t,[r]);if(l&&mt(l).call(l,r.id))try{var c;if(typeof r._originDataChannelId!="number")throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, cannot get RTCDatachannel")),new K(P.CREATE_DATACHANNEL_ERROR);const d={id:r.id,datachannelId:r._originDataChannelId,ordered:r.ordered,maxRetransmits:r.maxRetransmits,metadata:(c=r.metadata)!==null&&c!==void 0?c:""};await this._gateway.subscribeDataChannel(t.uid,d,!0),await r._waitTillOpen()}catch(d){if((d==null?void 0:d.code)!==P.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(t,[r]),d;await this._p2pChannel.unsubscribeDataChannel(t,[r]),this._p2pChannel.setPendingRemoteDataChannel(t,r.id)}return T.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: datachannel")),r}finally{s()}}async _p2pSubscribe(t,e,n){if(ri(e,"mediaType",["audio","video"]),!this._joinInfo)throw new K(P.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new K(P.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(s=>s===t)){const s=new K(P.INVALID_REMOTE_USER,"user is not in the channel");throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),s}if(!t.hasAudio&&!t.hasVideo){const s=new K(P.INVALID_REMOTE_USER,"user is not published");throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),s}if(!n&&(e==="audio"&&!t.hasAudio||e==="video"&&!t.hasVideo)){const s=new K(P.REMOTE_USER_IS_NOT_PUBLISHED);throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(e,", remote track is not published")),s}const r=await this._subscribeMutex.lock();T.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(e));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,e))await this._p2pChannel.unmuteRemote(t,e);else try{const c=e==="audio"?t._audioSSRC:t._videoSSRC,l=e==="audio"?t._audioMid:t._videoMid;this.store.subscribe(t.uid,e,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(t,e,c,l)}catch(c){throw c}T.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(e)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(c=>{T.warning("[".concat(this._clientId,"] auto set fallback failed"),c)});const s=e==="audio"?t._audioTrack:t._videoTrack;if(!s)throw new K(P.UNEXPECTED_ERROR,"can not find remote track in user object");return s}catch(s){throw T.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),s),s}finally{r()}}async _subscribe(t,e,n){if(this.store.useP2P)return this._p2pSubscribe(t,e);if(ri(e,"mediaType",["audio","video"]),!this._joinInfo)throw new K(P.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new K(P.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(h=>h===t)){const h=new K(P.INVALID_REMOTE_USER,"user is not in the channel");throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),h}if(!t.hasAudio&&!t.hasVideo){const h=new K(P.INVALID_REMOTE_USER,"user is not published");throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),h}if(!(n||(e!=="audio"||t.hasAudio&&t._audioSSRC!==void 0)&&(e!=="video"||t.hasVideo&&t._videoSSRC!==void 0))){const h=new K(P.REMOTE_USER_IS_NOT_PUBLISHED);throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(e,", remote track is not published")),h}let r=e==="audio"?t._audioSSRC:t._videoSSRC,s=e==="audio"?t._audioOrtc:t._videoOrtc,c=e==="video"?t._rtxSsrcId:void 0,l={stream_type:e==="audio"?Ct.AUDIO:Ct.VIDEO,ssrcId:r};e==="video"&&this.store.firstVideoFrameDecoded(t.uid,{subscribeStart:Date.now()});const d=await this._subscribeMutex.lock();T.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(e));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,e))await this._p2pChannel.unmuteRemote(t,e);else try{const p=e==="audio"?t._audioSSRC:t._videoSSRC;p!==void 0&&p!==r&&(r=p,s=e==="audio"?t._audioOrtc:t._videoOrtc,c=e==="video"?t._rtxSsrcId:void 0,l={stream_type:e==="audio"?Ct.AUDIO:Ct.VIDEO,ssrcId:r}),Yi.markSubscribeStart(this.store.clientId,r),this.store.subscribe(t.uid,e,Date.now()),await this._p2pChannel.subscribe(t,e,r,c,s);try{this._p2pChannel.isPreSubScribe(r)||await this._gateway.subscribe(t.uid,l,!0)}catch(m){if((m==null?void 0:m.code)!==P.WS_ABORT)throw await this._p2pChannel.unsubscribe(t,e),m;await this._p2pChannel.unsubscribe(t,e,!0),this._p2pChannel.setPendingRemoteMedia(t,e)}this.store.subscribe(t.uid,e,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,t,e)}catch(p){throw this._p2pChannel.reportSubscribeEvent(!1,p==null?void 0:p.code,t,e),p}T.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(e)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(p=>{T.warning("[".concat(this._clientId,"] auto set fallback failed"),p)});const h=e==="audio"?t._audioTrack:t._videoTrack;if(!h)throw new K(P.UNEXPECTED_ERROR,"can not find remote track in user object");return e==="video"&&(this.store.firstVideoFrameDecoded(t.uid,{subscribeEnd:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(t)),h}catch(h){throw T.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),h),h}finally{d()}}async massSubscribe(t){if(Rl(t,"subscribeList"),!this._joinInfo)throw new K(P.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new K(P.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const e=Date.now(),n=new Map,i=await this._subscribeMutex.lock();T.info("[".concat(this._clientId,"]start massSubscribe user ").concat(t.map(l=>{let{user:d,mediaType:h}=l;return"user: ".concat(d==null?void 0:d.uid,", mediaType: ").concat(h)}).join("; ")));const r=(t=[...t]).map(l=>{let{user:d,mediaType:h}=l;return{user:d,mediaType:h}}),s=await this._p2pChannel.globalLock();try{var c;for(let d=t.length-1;d>=0;d--){const h=t[d],{user:p,mediaType:m}=h;if(ri(m,"mediaType",["audio","video"]),!p){const C=new K(P.INVALID_PARAMS,"user property does not exist in subscribeList item");throw T.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),C}if(!this._users.find(C=>C===p)){const C=new K(P.INVALID_REMOTE_USER,"user is not in the channel");T.error("[".concat(this._clientId,"] can not massSubscribe ").concat(p.uid,", this user is not in the channel")),r[d].error=C,t.splice(d,1);continue}if(m==="audio"&&(!p.hasAudio||p._audioSSRC===void 0)||m==="video"&&(!p.hasVideo||p._videoSSRC===void 0)){const C=new K(P.REMOTE_USER_IS_NOT_PUBLISHED);T.error("[".concat(this._clientId,"] can not subscribe ").concat(p.uid," with mediaType ").concat(m,", remote user is not published")),r[d].error=C,t.splice(d,1);continue}const E=ui.Video|ui.LwoVideo,I=n.get(p);if(I){if(m==="video"?I&E:I&ui.Audio){t.splice(d,1),T.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(p.uid,", mediaType:").concat(m," twice"));continue}n.set(p,I|(m==="video"?E:ui.Audio))}else n.set(p,m==="video"?E:ui.Audio)}for(let d=t.length-1;d>=0;d--){const h=t[d],{user:p,mediaType:m}=h,_=ui.Video|ui.LwoVideo;if(this._p2pChannel.hasRemoteMedia(p,m)){await this._p2pChannel.unmuteRemoteNoLock(p,m);const E=n.get(p);n.set(p,m==="video"?E^_:E^ui.Audio),t.splice(d,1)}}this.store.massSubscribe(t.map(d=>({userId:d.user.uid,type:d.mediaType})),e);let l=Vr(c=Array.from(n.entries())).call(c,(d,h)=>{let[p,m]=h;if(m===0)return d;const _={stream_id:p.uid,stream_type:m};return m&ui.Audio&&(_.audio_ssrc=p._audioSSRC),m&ui.Video&&(_.video_ssrc=p._videoSSRC),d.push(_),d},[]);try{t.length>0&&await this._p2pChannel.massSubscribeNoLock(t.map(h=>{let{user:p,mediaType:m}=h;return{user:p,mediaType:m,ssrcId:m===Ct.VIDEO?p._videoSSRC:p._audioSSRC,rtxSsrcId:m===Ct.VIDEO?p._rtxSsrcId:void 0}}));const d=new Map;if(l=l.filter(h=>h.video_ssrc&&!this._p2pChannel.isPreSubScribe(h.video_ssrc)||h.audio_ssrc&&!this._p2pChannel.isPreSubScribe(h.audio_ssrc)||!h.video_ssrc&&!h.audio_ssrc),l.length>0){const h=await this._gateway.subscribeAll(l,!0);((h==null?void 0:h.users)||[]).forEach(p=>{let{stream_id:m,video_error_code:_,audio_error_code:E,error_code:I}=p;(_||E||I)&&d.set(m,{video_error_code:_,audio_error_code:E,error_code:I})})}if(Array.from(d.entries()).length>0){const h=[];Array.from(d.entries()).forEach(p=>{let[m,_]=p;const E=this.remoteUsers.find(I=>I.uid===m);if(E){let I;_.error_code||_.video_error_code&&_.audio_error_code?I=void 0:_.video_error_code?I=Ct.VIDEO:_.audio_error_code&&(I=Ct.AUDIO),h.push({user:E,mediaType:I})}}),h.length>0&&await this._p2pChannel.massUnsubscribeNoLock(h)}for(const h of r){const p=d.get(h.user.uid);if(p){const m=p.error_code||h.mediaType==="audio"&&p.audio_error_code||h.mediaType==="video"&&p.video_error_code;if(m){const _=Gg(m);T.error("user:".concat(h.user.uid," mediaType:").concat(h.mediaType," has massSubscribe error ").concat(_.desc)),h.error=new K(P.SUBSCRIBE_FAILED,"code ".concat(m,": ").concat(_.desc))}}h.error||(h.mediaType==="video"?h.track=h.user.videoTrack:h.track=h.user.audioTrack)}return this.store.massSubscribe(r.filter(h=>!h.error).map(h=>({userId:h.user.uid,type:h.mediaType})),void 0,Date.now()),r.forEach(h=>{var p;Pt.subscribe(this.store.sessionId,{succ:!!h.error,ec:((p=h.error)===null||p===void 0?void 0:p.code)||null,video:h.mediaType===Ct.VIDEO,audio:h.mediaType===Ct.AUDIO,peerid:h.user.uid,subscribeRequestid:h.mediaType===Ct.VIDEO?h.user._videoSSRC:h.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-e),preSsrc:this._p2pChannel.isPreSubScribe(h.user._videoSSRC)},!0)}),T.info("[".concat(this._clientId,"] massSubscribe success ").concat(t.map(h=>{let{user:p,mediaType:m}=h;return"user: ".concat(p==null?void 0:p.uid,", mediaType: ").concat(m)}).join("; "))),r}catch(d){throw await this._p2pChannel.massUnsubscribeNoLock(t),d}}finally{s(),i()}}async unsubscribe(t,e,n){if(!(t instanceof $d)){const s=this.remoteUsers.find(c=>c.uid===t);if(!s)throw new K(P.INVALID_REMOTE_USER,"user is not in the channel");t=s}if(e||this.store.useP2P){if(e==="datachannel")return this._unsubscribeDataChannel(t,n)}else await this._unsubscribeDataChannel(t,n);if(e&&ri(e,"mediaType",["audio","video"]),!this._joinInfo)throw new K(P.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(s=>s===t)){const s=new K(P.INVALID_REMOTE_USER,"user is not in the channel");throw T.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),s}T.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: ").concat(e));const r=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(t,e);else{const s=await this._p2pChannel.unsubscribe(t,e);s&&await this._gateway.unsubscribe(s,t.uid),e&&e!=="audio"||(t._audio_pre_subscribed=!1),e&&e!=="video"||(t._video_pre_subscribed=!1),t._is_pre_created&&iR(this._users,t),T.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(t.uid,", mediaType: ").concat(e))}}catch(s){if(s.code===P.DISCONNECT_P2P)return void T.warning("disconnecting p2p, abort unsubscribe request.");throw T.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),s.toString()),s}finally{r()}}async _unsubscribeDataChannel(t,e){if(e&&Ke(e,"id",0,65535,!0),!this._joinInfo)throw new K(P.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(r=>r===t)){const r=new K(P.INVALID_REMOTE_USER,"user is not in the channel");throw T.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),r}let i;if(typeof e=="number"){const r=t._dataChannels.find(s=>s.id===e);r&&(i=[r])}else i=t._dataChannels;if(i===void 0){const r=new K(P.REMOTE_USER_IS_NOT_PUBLISHED);throw T.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid," with channelId ").concat(e,", remote datachannel is not published")),r}T.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(i.map(r=>r.id)));try{const r=await this._p2pChannel.unsubscribeDataChannel(t,i);r&&await this._gateway.unsubscribeDataChannel(r,t.uid),T.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(r))}catch(r){if(r.code===P.DISCONNECT_P2P)return void T.warning("disconnecting p2p, abort unsubscribe request.");throw T.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),r.toString()),r}}async massUnsubscribe(t){if(Rl(t,"unsubscribeList"),!this._joinInfo)throw new K(P.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");T.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(t.map(n=>{let{user:i,mediaType:r}=n;return"user: ".concat(i==null?void 0:i.uid,", mediaType: ").concat(r,";")}).join())),t=[...t];const e=new Map;for(let n=t.length-1;n>=0;n--){const{user:i,mediaType:r}=t[n];if(!i){const l=new K(P.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw T.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),l}if(ri(r,"mediaType",["video","audio",void 0]),!this._users.find(l=>l===i)){T.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(i.uid,", user is not in the channel")),t.splice(n,1);continue}const c=ui.Video|ui.LwoVideo;if(e.has(i)){const l=e.get(i);let d;switch(r){case"video":d=l&c;break;case"audio":d=l&ui.Audio;break;default:d=l&(ui.Audio|c)}if(d){T.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(i.uid,",mediaType:").concat(r," twice.")),t.splice(n,1);continue}r?r==="audio"?e.set(i,l|ui.Audio):r==="video"&&e.set(i,l|c):e.set(i,l|ui.Audio|c)}else r?r==="audio"?e.set(i,ui.Audio):r==="video"&&e.set(i,c):e.set(i,ui.Audio|c)}try{const n=await this._p2pChannel.massUnsubscribe(t);n&&await this._gateway.massUnsubscribe(n),T.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(t.map(i=>{let{user:r,mediaType:s}=i;return"user: ".concat(r==null?void 0:r.uid,", mediaType: ").concat(s,";")}).join()))}catch(n){if(n.code===P.DISCONNECT_P2P)return void T.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw T.error("[".concat(this._clientId,"] massUnsubscribe error"),n.toString()),n}}async setLowStreamParameter(t){(function(n){if(!n)throw new Z(P.INVALID_PARAMS);wn(n.width)||FA(n.width,"streamParameter.width"),wn(n.height)||FA(n.height,"streamParameter.height"),wn(n.framerate)||FA(n.framerate,"streamParameter.framerate"),wn(n.bitrate)||Ke(n.bitrate,"streamParameter.bitrate")})(t),(!t.width&&t.height||t.width&&!t.height)&&T.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),T.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(t));const e=this._configDistribute.getLowStreamConfigDistribute();if(e&&e.bitrate&&t.bitrate&&e.bitrate<t.bitrate&&(t.bitrate=e.bitrate),this._lowStreamParameter=t,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(t,ot.LocalVideoLowTrack)}async enableDualStream(){if(!be().supportDualStream)throw Pt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new K(P.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new K(P.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(t){throw Pt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),t}this._isDualStreamEnabled=!0,Pt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),T.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new K(P.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(ot.LocalVideoLowTrack))try{const t=await this._p2pChannel.unpublishLowStream();t&&await this._gateway.unpublish(t,this._joinInfo.stringUid||this._joinInfo.uid)}catch(t){throw Pt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),t}this._isDualStreamEnabled=!1,Pt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),T.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(t,e){if(function(i){ri(i,"role",["audience","host"])}(t),e&&zA(e),this.mode==="rtc"||this.mode==="p2p")throw T.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new K(P.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(e&&e.level&&t==="host")throw new K(P.INVALID_OPERATION,"host mode can not set audience latency level");if(t==="audience"&&this._p2pChannel.hasLocalMedia())throw new K(P.INVALID_OPERATION,"can not set client role to audience when publishing stream");const n=this._config.role;this._joinInfo&&(this._joinInfo.role=t),t!==n&&k("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(t,e),this._config.role=t,this._gateway.reconnect("recover",Pi.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(t,e),this._config.role=t),T.info("[".concat(this._clientId,"] set client role to ").concat(t,", level: ").concat(e&&e.level))}async _setClientRoleOptions(t){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let e=!1;try{t&&zA(t),await this._gateway.setClientRole(this._config.role,t),e=!0}catch{}finally{T.info("[".concat(this._clientId,"] set client role options ").concat(e?"succeed":"failed",", options is ").concat(t))}}getRemoteInboundOffset(){var t;const e=(t=this._p2pChannel.getStats())===null||t===void 0?void 0:t.audioSend[0];if(!e||!e.timestamp)return 0;const n=e.timestamp-Date.now();return Math.abs(n)>1e3+e.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?n:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(t,e){if(Ti(t,"proxyServer"),!e){if(this.connectionState!=="DISCONNECTED")throw new K(P.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new K(P.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=t,Pt.setProxyServer(this._proxyServer),T.setProxyServer(this._proxyServer),T.info("[".concat(this._clientId,"] Set proxy server ").concat(e?"by initialize call":""," success."))}setTurnServer(t,e){if(Array.isArray(t)||(t=[t]),!e){if(this.connectionState!=="DISCONNECTED")throw new K(P.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new K(P.INVALID_OPERATION,"You have already set the proxy")}if(Ng(t))return this._turnServer={servers:t,mode:"original-manual"},void T.info("[".concat(this._clientId,"] Set original turnserver ").concat(e?"by initialize call":""," success: ").concat(t.map(n=>n.urls).join(","),"."));t.forEach(n=>sL(n)),this._turnServer={servers:t,mode:"manual"},T.info("[".concat(this._clientId,"] Set turnserver ").concat(e?"by initialize call":""," success."))}setLicense(t){if(this.connectionState!=="DISCONNECTED")throw new K(P.INVALID_OPERATION,"you should set license before join channel");if(Ti(t,"license",32,32),!/^[A-Za-z\d]+$/.test(t))throw new K(P.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=t,T.info("[".concat(this._clientId,"] set license success"),t)}startProxyServer(t){if(this.connectionState!=="DISCONNECTED")throw new K(P.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new K(P.INVALID_OPERATION,"You have already set the proxy");const e=[3,4,5];let n;switch(t===void 0&&(t=3),t){case 1:case 2:throw new K(P.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:n="proxy3";break;case 4:n="proxy4";break;case 5:n="proxy5";break;default:throw new K(P.INVALID_PARAMS,"proxy server mode must be ".concat(e.join("|")))}this._cloudProxyServerMode=n,this.store.cloudProxyServerMode=n,T.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new K(P.INVALID_OPERATION,"Stop proxy server after leave channel");Pt.setProxyServer(),T.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",T.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(t){if(!t.accessPoints)throw new K(P.INVALID_PARAMS,"accessPoints is required.");Rl(t.accessPoints.serverList,"accessPoints.serverList"),Ti(t.accessPoints.domain,"accessPoints.domain");const e=(_,E)=>{Ke(_,E,0,65535,!0)};let n=443;if(t.accessPoints.port&&(e(t.accessPoints.port,"accessPoints.port"),n=t.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new K(P.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");k("CLOSE_AFB_FOR_LOCAL_AP")&&(Fe("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),Fe("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const i=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,r=t.accessPoints.domain,s=t.accessPoints.serverList.map(_=>i.test(_)?"".concat(_.replace(/\./g,"-"),".").concat(r):_),c=s.map(_=>"".concat(_,":").concat(n));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,Fe("WEBCS_DOMAIN",c),Fe("WEBCS_DOMAIN_BACKUP_LIST",c),Fe("GATEWAY_DOMAINS",[r]),t.report&&t.report.hostname&&Array.isArray(t.report.hostname)&&t.report.hostname.length?(Rl(t.report.hostname,"report.hostname"),Fe("EVENT_REPORT_DOMAIN",t.report.hostname[0]),Fe("EVENT_REPORT_BACKUP_DOMAIN",t.report.hostname[1]||t.report.hostname[0])):(Fe("EVENT_REPORT_DOMAIN",s[0]),Fe("EVENT_REPORT_BACKUP_DOMAIN",s[1]||s[0]));let l=6443;t.report&&t.report.port&&(e(t.report.port,"report.port"),l=t.report.port),Fe("STATS_COLLECTOR_PORT",l),t.report?Fe("ENABLE_EVENT_REPORT",!0):Fe("ENABLE_EVENT_REPORT",!1);let d="";t.log&&t.log.hostname&&Array.isArray(t.log.hostname)&&t.log.hostname.length?(Rl(t.log.hostname,"log.hostname"),d=t.log.hostname[0]):d=s[0];let h=6444;t.log&&t.log.port&&(e(t.log.port,"log.port"),h=t.log.port),Fe("LOG_UPLOAD_SERVER","".concat(d,":").concat(h));let p=[];t.cds&&t.cds.hostname&&Array.isArray(t.cds.hostname)&&t.cds.hostname.length?(Rl(t.cds.hostname,"cds.hostname"),p=t.cds.hostname):p=s;let m=443;t.cds&&t.cds.port&&(e(t.cds.port,"cds.port"),m=t.cds.port),Fe("CDS_AP",p.map(_=>"".concat(_,":").concat(m))),t.cds?Fe("ENABLE_CONFIG_DISTRIBUTE",!0):Fe("ENABLE_CONFIG_DISTRIBUTE",!1),T.info("set local access point v2 success")}setLocalAccessPoints(t,e){if(Rl(t,"serverList"),Ti(e,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new K(P.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const n=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;t=t.map(i=>n.test(i)?"".concat(i.replace(/\./g,"-"),".").concat(e):i),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,Fe("WEBCS_DOMAIN",t),Fe("WEBCS_DOMAIN_BACKUP_LIST",t),Fe("GATEWAY_DOMAINS",[e]),Fe("EVENT_REPORT_DOMAIN",t[0]),Fe("EVENT_REPORT_BACKUP_DOMAIN",t[1]||t[0]),Fe("LOG_UPLOAD_SERVER","".concat(t[0],":6444")),T.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(t){if(ri(t,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=t,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(t),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(e){throw T.error("[".concat(this._clientId,"] set default remote video stream type error"),e.toString()),e}else T.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(t))}async setRemoteVideoStreamType(t,e){ri(e,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(t,e),setTimeout(()=>{const n=this._users.find(i=>i.uid===t);n&&n.videoTrack&&n.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(n){throw T.error("[".concat(this._clientId,"] set remote video stream type error"),n.toString()),n}T.info("[".concat(this._clientId,"] set remote ").concat(t," video stream type to ").concat(e)),this._remoteStreamTypeCacheMap.set(t,e)}async setStreamFallbackOption(t,e){ri(e,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(t,e)}catch(n){throw T.error("[".concat(this._clientId,"] set stream fallback option"),n.toString()),n}T.info("[".concat(this._clientId,"] set remote ").concat(t," stream fallback type to ").concat(e)),this._streamFallbackTypeCacheMap.set(t,e)}setEncryptionConfig(t,e,n,i){(function(s){ri(s,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(t),Ti(e,"secret");const r=["aes-128-gcm2","aes-256-gcm2"];if(mt(r).call(r,t)){if(!n||!(n instanceof Uint8Array&&n.length===32))throw new K(P.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(n)throw new K(P.INVALID_PARAMS,"current encrypt mode does not need salt");if(i){if(yo(i,"encryptDataStream"),!mt(r).call(r,t))throw new K(P.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(e)||T.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=t,this._encryptionSecret=e,n&&(this._encryptionSalt=Gd(n))}async renewToken(t){if(Ti(t,"token",1,2047),!this._key||!this._joinInfo)throw new K(P.INVALID_OPERATION,"renewToken should not be called before user join");const e=this._key;this._key=t,this._joinInfo&&(this._joinInfo.token=t);const n=await this._renewTokenMutex.lock();try{if(k("USE_NEW_TOKEN")){T.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const i=await w8(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Xn);T.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:t,ticket:i})}else T.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:t});T.debug("[".concat(this._clientId,"] renewToken success"))}catch(i){throw this._key=e,this._joinInfo.token=e,T.error("[".concat(this._clientId,"] renewToken failed"),i.toString()),i}finally{n()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?T.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const t=this._p2pChannel.getAudioLevels();this.safeEmit(he.VOLUME_INDICATOR,t)},k("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const t=this._statsCollector.getRTCStats(),e=this._gateway.getInChannelInfo();return t.Duration=Math.round(e.duration/1e3),t}async startLiveStreaming(t,e){if(!e){if(this.codec!=="h264")throw new K(P.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new K(P.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(t)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(t))throw new K(P.LIVE_STREAMING_TASK_CONFLICT);const n=e?bl.TRANSCODE:bl.RAW;return this._createLiveStreamingClient(n).startLiveStreamingTask(t,n)}setLiveTranscoding(t){return this._createLiveStreamingClient(bl.TRANSCODE).setTranscodingConfig(t)}async stopLiveStreaming(t){const e=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(n=>n&&n.hasUrl(t));if(!e.length)throw new K(P.INVALID_PARAMS,"can not find live streaming url to stop");await Tt.all(e.map(n=>n&&n.stopLiveStreamingTask(t)))}async startChannelMediaRelay(t){KM(t),await this._createChannelMediaRelayClient().startChannelMediaRelay(t)}async updateChannelMediaRelay(t){KM(t),await this._createChannelMediaRelayClient().updateChannelMediaRelay(t)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(t){this._p2pChannel instanceof Zg&&this._p2pChannel.addAudioMetadata(t)}async sendStreamMessage(t){var e;let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new K(P.INVALID_OPERATION,"can not send data stream, not joined");if((typeof t=="string"||t instanceof Uint8Array)&&(t={payload:t}),typeof t.payload=="string"){const r=new TextEncoder;t.payload=r.encode(t.payload)}let i=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&mt(e=["aes-128-gcm2","aes-256-gcm2"]).call(e,this._encryptionMode)&&(i=!0,t.payload=await async function(r,s,c){var l;const d=Vr(l=Array.from(c)).call(l,(C,w)=>C+w,0),h={serverTs:0,seq:Y6++,length:c.length,checkSum:d},p=new Uint8Array(fL(d,2)),m=new ArrayBuffer(dm),_=new DataView(m);_.setUint32(0,h.serverTs),_.setUint16(4,h.seq),_.setUint16(6,h.length),_.setUint16(8,h.checkSum);const E=16-c.length%16;c=lL(c,new Uint8Array(E));const I=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:r,tagLength:wL,additionalData:p},s,c);return lL(new Uint8Array(m),new Uint8Array(I))}(this._encryptDataStreamIv,this._encryptDataStreamKey,t.payload)),new Blob([t.payload]).size>1024)throw new K(P.INVALID_PARAMS,i?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(Wt.DATA_STREAM,{payload:Gd(t.payload),syncWithAudio:t.syncWithAudio,sendTs:Date.now()-x8},!n)}sendMetadata(t){if(!this._joinInfo)throw new K(P.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([t]).size>1024)throw new K(P.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Wt.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Gd(t)})}async sendCustomReportMessage(t){if(Array.isArray(t)||(t=[t]),t.forEach(iG),!this._joinInfo)throw new K(P.INVALID_OPERATION,"can not send custom report, not joined");await Pt.sendCustomReportMessage(this._joinInfo.sid,t)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){const t=this._statsCollector.getRemoteNetworkQualityStats();if(k("DELETE_NEQ_AFTER_USER_LEAVE")){const e=this._users.map(n=>n.uid+"");Object.keys(t).forEach(n=>{mt(e).call(e,n)||delete t[n]})}return t}async pickSVCLayer(t,e){ri(e.spatialLayer,"spatialLayer",[0,1,2,3]),ri(e.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(t,e)}catch(n){throw T.error("[".concat(this._clientId,"] pick SVC layer failed"),n.toString()),n}}async setRTMConfig(t){const{apRTM:e=!1,rtmFlag:n}=t;if(yo(e,"apRTM"),Ke(n,"rtmFlag",0),this._rtmConfig.apRTM=e,this._rtmConfig.rtmFlag=n,T.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(t)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=e,this._joinInfo.rtmFlag=n,this._gateway.setRTM2Flag(n)}_reset(){if(T.debug("[".concat(this._clientId,"] reset client")),function(t){const e=ym.indexOf(t);e!==-1&&ym.splice(e,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this.store.autoSubscribe=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=Ir.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&v2(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&Pt.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this.store.resetFirstVideoFrameDecoded(),this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(t=>{t._audioTrack&&t._audioTrack._destroy(),t._videoTrack&&t._videoTrack._destroy(),t._dataChannels&&(t._dataChannels.forEach(e=>e._close()),t._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Wi("client-publish",this._clientId),this._subscribeMutex=new Wi("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(t,e){var n;const i=t||Lh();t?T.debug("[".concat(this._clientId,"] new Session ").concat(i)):T.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(i));const r=t?"":this._sessionId||"";this._sessionId=i,this.store.sessionId=i,Pt.addSid(i);const s={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(e==null?void 0:e.stringUid)||((n=this._joinInfo)===null||n===void 0?void 0:n.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:r,clientRole:this.role==="audience"?2:1};Pt.sessionInit(this._sessionId,js({cname:e.channel,appid:e.appId},s)),this._joinInfo&&(this._joinInfo.sid=i),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=i)}async _publishHighStream(t){if(!this._joinInfo||this._uid===void 0)throw new K(P.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new K(P.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&k("FORCE_TURN")&&!k("TURN_ENABLE_TCP")&&!k("TURN_ENABLE_UDP"))throw new K(P.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");T.debug("[".concat(this._clientId,"] publish high stream"));try{const n=await this._p2pChannel.publish(t,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const i=(await n.next()).value;if(i){try{await this._gateway.sendExtensionMessage(jn.PUBLISH,i,!0)}catch(r){throw n.throw(r),r}await n.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const i=(await n.next()).value;if(i){var e;let r;try{r=await this._gateway.publish(this._uid,i,!0)}catch(s){if(s.code!==P.DISCONNECT_P2P)throw n.throw(s),s}await n.next(((e=r)===null||e===void 0?void 0:e.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const r of t)r instanceof sn&&r._encoderConfig&&this._gateway.setVideoProfile(r._encoderConfig).catch(s=>{T.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!r.muted&&r.enabled||await this._p2pChannel.muteLocalTrack(r)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,t),(n==null?void 0:n.code)===P.WS_ABORT)return;throw n}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new K(P.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new K(P.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));T.debug("[".concat(this._clientId,"] publish low stream"));const t=this._configDistribute.getLowStreamConfigDistribute();t&&t.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&t.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=t.bitrate));try{const n=await this._p2pChannel.publishLowStream(this._lowStreamParameter),i=(await n.next()).value;if(i){var e;let r;try{r=await this._gateway.publish(this._uid,i,!0)}catch(s){if(s.code!==P.DISCONNECT_P2P)throw n.throw(s),s}n.next(((e=r)===null||e===void 0?void 0:e.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,void 0,!0),(n==null?void 0:n.code)===P.WS_ABORT)return;throw n}}_createLiveStreamingClient(t){const e=()=>{if(!this._joinInfo||!this._appId)return new K(P.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const n=(i={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},wl("LiveStreaming").create(i));var i;return n.onLiveStreamError=(r,s)=>{Pt.reportApiInvoke(this._sessionId,{name:kn.ON_LIVE_STREAM_ERROR,options:[r,s],tag:_n.TRACER}).onSuccess(),this.safeEmit(he.LIVE_STREAMING_ERROR,r,s)},n.onLiveStreamWarning=(r,s)=>{Pt.reportApiInvoke(this._sessionId,{name:kn.ON_LIVE_STREAM_WARNING,options:[r,s],tag:_n.TRACER}).onSuccess(),this.safeEmit(he.LIVE_STREAMING_WARNING,r,s)},n.on(jw.REQUEST_WORKER_MANAGER_LIST,(r,s,c)=>{if(!this._joinInfo)return c(new K(P.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(l,d,h,p){const m=k("UAP_AP").slice(0,k("AJAX_REQUEST_CONCURRENT")).map(_=>d.proxyServer?"https://".concat(d.proxyServer,"/ap/?url=").concat(_+"/api/v1?action=uap"):"https://".concat(_,"/api/v1?action=uap"));return await S8(m,l,d,h,p)})(r,this._joinInfo,this._axiosCancelSource.token,Xn).then(s).catch(c)}),n};return t===bl.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||e(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||e(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new K(P.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:e,sendResolutionHeight:n}=this.getLocalVideoStats(),i=(t={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:e,height:n}},wl("ChannelMediaRelay").create(t));i.on("state",r=>{r===qr.RELAY_STATE_FAILURE&&i&&i.dispose(),this.safeEmit(he.CHANNEL_MEDIA_RELAY_STATE,r)}),i.on("event",r=>{this.safeEmit(he.CHANNEL_MEDIA_RELAY_EVENT,r)}),this._channelMediaRelayClient=i,this._statsCollector.onStatsChanged=(r,s)=>{var c;r==="resolution"&&((c=this._channelMediaRelayClient)===null||c===void 0||c.setVideoProfile(s))}}var t;return this._channelMediaRelayClient}_handleUpdateDataChannel(t,e){const{added:n,deleted:i}=t,r=[];if(e){const s=[];this._users.forEach(c=>{c._dataChannels.forEach(l=>{n.every(d=>d.uid!==c._uintid||d.stream_id!==l.id)&&s.push({uid:c._uintid,stream_id:l.id,ordered:l.ordered,max_retrans_times:l.maxRetransmits,metadata:l.metadata})})}),s.length>0&&this._handleUpdateDataChannel({added:[],deleted:s})}Array.isArray(n)&&n.length>0&&n.forEach(s=>{const{uid:c,stream_id:l,ordered:d,max_retrans_times:h,metadata:p}=s,m=this._users.find(_=>_._uintid===c);if(!m)return void T.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(T.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(c)),mt(r).call(r,m)||r.push(m),m._uintid||(m._uintid=c),m._dataChannels.findIndex(_=>_.id===s.stream_id)===-1){const _={id:l,ordered:!!d,maxRetransmits:h,metadata:p},E=function(I){return DM(I,!0)}(_);m._dataChannels.push(E),T.info("[".concat(this._clientId,"] remote user ").concat(m.uid," published datachannel")),e||this.safeEmit(he.USER_PUBLISHED,m,"datachannel",_)}this._p2pChannel.hasPendingRemoteDataChannel(m,s.stream_id)&&(T.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(m.uid," after reconnect.")),this._subscribeDataChannel(m,s.stream_id).catch(_=>{T.error("[".concat(this._clientId,"] resubscribe datachannel error"),_.toString())}))}),e&&(this.safeEmit(he.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(i)&&i.length>0&&i.forEach(s=>{const{uid:c,stream_id:l}=s,d=this._users.find(p=>p._uintid===c);if(!d)return void T.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const h=d._dataChannels.find(p=>p.id===s.stream_id);h&&(T.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(c)),this._p2pChannel.unsubscribeDataChannel(d,[h]).then(p=>{if(d._dataChannels=d._dataChannels.filter(m=>m!==h),p)return this._gateway.unsubscribeDataChannel(p,d.uid)}),T.info("[".concat(this._clientId,"] remote user ").concat(c," unpublished datachannel ,id:").concat(h.id)),this.safeEmit(he.USER_UNPUBLISHED,d,"datachannel",h._config))})}_getEncodingName(t){var e;if(!this._joinResponse)return;const n=(e=this._joinResponse.ortc.rtpCapabilities.sendrecv)===null||e===void 0?void 0:e.videoCodecs;if(n)for(const r of n){var i;if(r.payloadType===t)return r==null||(i=r.rtpMap)===null||i===void 0?void 0:i.encodingName}}_handleRemoveDataChannels(t){const e=this._users.find(n=>n.uid===t.uid);if(e){if(e._dataChannels!==void 0&&e._dataChannels.length>0){T.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(t.uid));const n=()=>{T.info("[".concat(this._clientId,"] remote user ").concat(e.uid," unpublished datachannel")),e._dataChannels.forEach(i=>{this.safeEmit(he.USER_UNPUBLISHED,e,"datachannel",i._config)})};this._p2pChannel.unsubscribeDataChannel(e,e._dataChannels).then(i=>{if(i)return this._gateway.unsubscribeDataChannel(i,e.uid)}),n()}}else T.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(fi.UPDATE_GATEWAY_CONFIG,()=>{(function(){let t;try{t=window.localStorage.getItem("websdk_ng_global_parameter")}catch(e){return void T.error("Error loading sdk config",e.message)}if(t)try{const e=JSON.parse(window.atob(t)),n=Date.now();Object.keys(e).forEach(i=>{const{value:r,type:s,expires:c}=e[i];c&&c<=n||s||Pw()||!Object.prototype.hasOwnProperty.call(lR,i)||(bo[i]=r,hn[i]=r,T.debug("Update gateway parameters from config distribute",i,r))})}catch(e){T.error("Error update config from local cache",e.message)}})()}),this._gateway.on(fi.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(fi.CONNECTION_STATE_CHANGE,(t,e,n)=>{var i;if(n===xe.FALLBACK)return;const r=()=>{this.safeEmit(he.CONNECTION_STATE_CHANGE,t,e,n)};if(Pt.reportApiInvoke(this._sessionId||((i=this._gateway.joinInfo)===null||i===void 0?void 0:i.sid)||null,{name:kn.CONNECTION_STATE_CHANGE,options:[t,e,n],tag:_n.TRACER}).onSuccess(JSON.stringify({cur:t,prev:e,reason:n})),T.info("[".concat(this._clientId,"] signal connection state change: ").concat(e," -> ").concat(t)),t==="DISCONNECTED")return this._reset(),void r();if(t==="RECONNECTING")this._users.forEach(c=>{c._trust_in_room_=!1,c._trust_audio_enabled_state_=!1,c._trust_video_enabled_state_=!1,c._trust_audio_mute_state_=!1,c._trust_video_mute_state_=!1,c._trust_audio_stream_added_state_=!1,c._trust_video_stream_added_state_=!1,c._is_pre_created||(c._audio_pre_subscribed||(c._audioSSRC=void 0,c._audioOrtc=void 0),c._video_pre_subscribed||(c._videoSSRC=void 0,c._videoOrtc=void 0,c._rtxSsrcId=void 0),c._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(t==="CONNECTED"){var s;this._streamFallbackTypeCacheMap.forEach((c,l)=>{this._gateway.setStreamFallbackOption(l,c).catch(d=>{T.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),d)})}),this._remoteStreamTypeCacheMap.forEach((c,l)=>{this._gateway.setRemoteVideoStreamType(l,c).catch(d=>{T.warning("[".concat(this._clientId,"] auto set remote stream type failed"),d)})}),this._remoteDefaultVideoStreamType!==void 0&&((s=this._joinInfo)===null||s===void 0?void 0:s.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{T.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(c=>{T.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(c))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(c=>!c._trust_in_room_).forEach(c=>{T.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(c.uid)),this._handleUserOffline({uid:c.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(c=>{c._trust_audio_mute_state_||(T.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(c.uid)),this._handleMuteStream(c.uid,Ct.AUDIO,!1)),c._trust_video_mute_state_||(T.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(c.uid)),this._handleMuteStream(c.uid,Ct.VIDEO,!1)),c._trust_audio_enabled_state_||(T.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(c.uid)),this._handleSetStreamLocalEnable("audio",c.uid,!0)),c._trust_video_enabled_state_||(T.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(c.uid)),this._handleSetStreamLocalEnable("video",c.uid,!0)),c._trust_video_stream_added_state_||(T.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(c.uid)),this._handleResetAddStream(c,"video")),c._trust_audio_stream_added_state_||(T.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(c.uid)),this._handleResetAddStream(c,"audio")),c._video_added_||c._audio_added_||(T.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(c.uid)),this._handleRemoveStream({uid:c.uid,uint_id:c._uintid}))}))},1e3))}r()}),this._gateway.on(fi.REQUEST_NEW_GATEWAY_LIST,async(t,e)=>{if(!this._joinInfo)return e(new K(P.UNEXPECTED_ERROR,"can not recover, no join info"));try{let n;const i=await E2(js(js({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));i?(n=i.ap,S2(i),this._joinInfo.preload=!0):(n=await eI(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Xn,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=n.gatewayInfo.res,this._joinInfo.gatewayAddrs=n.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=n.gatewayInfo.uni_lbs_ip);const r=[];n.gatewayInfo.gatewayAddrs.forEach(s=>{let{address:c}=s;const[l,d]=c.split(":");this._joinInfo&&this._joinInfo.proxyServer?r.push({proxy:this._joinInfo.proxyServer,host:l,port:d}):r.push({host:l,port:d})}),t(r)}catch(n){e(n)}}),this._gateway.on(fi.NETWORK_QUALITY,t=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(he.NETWORK_QUALITY,t)}),this._gateway.on(fi.STREAM_TYPE_CHANGE,(t,e)=>{this.safeEmit(he.STREAM_TYPE_CHANGED,t,e),Pt.reportApiInvoke(this._sessionId,{name:kn.STREAM_TYPE_CHANGE,options:[t,e],tag:_n.TRACER}).onSuccess(JSON.stringify({uid:t,streamType:e}))}),this._gateway.isPreSub=()=>"isPreSub"in this._p2pChannel&&this._p2pChannel.isPreSub(),this._gateway.isPreallocation=()=>"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation(),this._gateway.on(fi.IS_P2P_DISCONNECTED,t=>{this._p2pChannel.isP2PDisconnected()?t(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?t(!1):t(!0)}),this._gateway.on(fi.REQUEST_P2P_CONNECTION_PARAMS,async(t,e,n)=>{try{let i=await this._p2pChannel.getEstablishParams();i&&"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation()||(i=await this._p2pChannel.startP2PConnection(t)),e(i)}catch(i){n(i)}}),this._gateway.on(fi.JOIN_RESPONSE,(t,e)=>{if(this.store.useP2P)return;let n;this._joinResponse=t,t.attributes?n=t.attributes.userAttributes.preSubSsrcs:T.debug("no attributes in joinResponse");const i=vM(t.ortc,e,n);this._p2pChannel.connect(i)}),this._gateway.on(fi.PRE_CONNECT_PC,async t=>{const{candidates:e,fingerprint:n,turnServer:i}=t;if(this._joinInfo&&e.length>0&&!this._p2pChannel.isPlanB){const{cert:s,cid:c}=this._joinInfo.apResponse,l="".concat(c,"_").concat(s);if(l.length<4||l.length>256)return;await this._p2pChannel.startP2PConnection({turnServer:i,cloudProxyServer:this._joinInfo.cloudProxyServer,isPreallocation:!0});try{var r;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(c,"_").concat(s),icePwd:"".concat(c,"_").concat(s)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(r=k("FINGERPRINT"))!==null&&r!==void 0?r:n}]},candidates:e,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}catch(d){d.code&&d.code===P.EXCHANGE_SDP_FAILED&&await this._p2pChannel.startP2PConnection({turnServer:i,cloudProxyServer:this._joinInfo.cloudProxyServer},!0)}}})}_handleGatewaySignalEvents(){this._gateway.signal.on(pe.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(pe.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(pe.ON_ADD_AUDIO_STREAM,t=>this._handleAddAudioOrVideoStream("audio",t.uid,t.ssrcId,t.cname,t.pt,t.uint_id,t.ortc)),this._gateway.signal.on(pe.ON_ADD_VIDEO_STREAM,t=>this._handleAddAudioOrVideoStream("video",t.uid,t.ssrcId,t.cname,t.pt,t.uint_id,t.ortc,t.rtxSsrcId)),this._gateway.signal.on(pe.ON_REMOTE_DATASTREAM_UPDATE,t=>{this._handleUpdateDataChannel(t)}),this._gateway.signal.on(pe.ON_REMOTE_FULL_DATASTREAM_INFO,t=>{this._handleUpdateDataChannel({added:t.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(pe.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(pe.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(pe.MUTE_AUDIO,t=>this._handleMuteStream(t.uid,Ct.AUDIO,!0)),this._gateway.signal.on(pe.UNMUTE_AUDIO,t=>this._handleMuteStream(t.uid,Ct.AUDIO,!1)),this._gateway.signal.on(pe.MUTE_VIDEO,t=>this._handleMuteStream(t.uid,Ct.VIDEO,!0)),this._gateway.signal.on(pe.UNMUTE_VIDEO,t=>this._handleMuteStream(t.uid,Ct.VIDEO,!1)),this._gateway.signal.on(pe.RECEIVE_METADATA,t=>{const e=kh(t.metadata);this.safeEmit(he.RECEIVE_METADATA,t.uid,e)}),this._gateway.signal.on(pe.ON_DATA_STREAM,async t=>{var e;if(!t)return;let n=kh(t.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&mt(e=["aes-128-gcm2","aes-256-gcm2"]).call(e,this._encryptionMode)){if(t.payload.length<dm)throw new K(P.UNEXPECTED_RESPONSE,"payload length ".concat(t.payload.length," is less than header length ").concat(dm));n=await async function(s,c,l){const d=l.subarray(0,dm),h=d.slice(8,dm),p=(h[0]<<8)+h[1],m=(d[6]<<8)+d[7],_=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:s,tagLength:wL,additionalData:new Uint8Array(fL(p,2))},c,l.subarray(dm));return new Uint8Array(_).subarray(0,m)}(this._encryptDataStreamIv,this._encryptDataStreamKey,n)}let i=0;if(t.ordered||t.syncWithAudio){const r=this._p2pChannel.getStats(),s=this.remoteUsers.find(l=>l.uid===t.uid),c=r==null?void 0:r.audioRecv.find(l=>l.ssrc===(s==null?void 0:s._audioSSRC));i=c==null?void 0:c.jitterBufferMs}(i==null||Number.isNaN(i))&&(i=0),U8(js(js({},t),{},{payload:n}),i,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(pe.ON_CRYPT_ERROR,()=>{Fd(()=>{T.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(he.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(pe.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(pe.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{T.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,xe.TOKEN_EXPIRE),this.safeEmit(he.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(pe.ON_STREAM_FALLBACK_UPDATE,t=>{T.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(t.stream_id,", attr: ").concat(t.stream_type)),this.safeEmit(he.STREAM_FALLBACK,t.stream_id,t.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(pe.ON_PUBLISH_STREAM,t=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:t.proxy})),T.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(t))))}),this._gateway.signal.on(pe.ENABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!0)}),this._gateway.signal.on(pe.DISABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!1)}),this._gateway.signal.on(Yt.REQUEST_TIMEOUT,(t,e)=>{if(this._joinInfo)switch(t){case Wt.PUBLISH:{if(!e)return;const r=e.ortc;if(r){var n,i;const s=r.some(d=>{let{stream_type:h}=d;return h===Ve.Audio}),c=r.some(d=>{let{stream_type:h}=d;return h!==Ve.Audio}),l=r.some(d=>{let{stream_type:h}=d;return h===Ve.Screen||h===Ve.ScreenLow});e.state==="offer"&&Pt.publish(this._joinInfo.sid,{eventElapse:Yi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:P.TIMEOUT,audio:s,video:c,p2pid:e.p2p_id,publishRequestid:this.store.pubId,screenshare:l,audioName:s?(n=r.find(d=>{let{stream_type:h}=d;return h===Ve.Audio}))===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId.toString():void 0,videoName:c?(i=r.find(d=>{let{stream_type:h}=d;return h!==Ve.Audio}))===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId.toString():void 0})}break}case Wt.SUBSCRIBE:e&&Pt.subscribe(this._joinInfo.sid,{succ:!1,ec:P.TIMEOUT,audio:e.stream_type===Ct.AUDIO,video:e.stream_type===Ct.VIDEO,peerid:e.stream_id,subscribeRequestid:e.ssrcId,p2pid:this.store.p2pId,eventElapse:Yi.measureFromSubscribeStart(this.store.clientId,e.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(e.ssrcId)})}}),this._gateway.signal.on(pe.ON_P2P_OK,t=>{this.uid,this._uid}),this._gateway.signal.on(pe.ON_PUBLISHED_USER_LIST,t=>{if(t==null||!t.users)return;k("BLOCK_LOCAL_CLIENT")&&(t.users=t.users.filter(i=>!Gh(i.string_id||i.stream_id,this.channelName)));const e=[],n=[];for(const i of t.users){let r=this._users.find(p=>p._uintid===i.stream_id);r?r._trust_in_room_=!0:(r=new $d(i.string_id||i.stream_id,i.stream_id),this._users.push(r),this.store.firstVideoFrameDecoded(r.uid,{userJoinNotify:Date.now()}),this.getListeners(he.PUBLISHED_USER_LIST).length===0&&(T.debug("[".concat(this._clientId,"] user online"),i.stream_id),this.safeEmit(he.USER_JOINED,r)));const s=ui.Audio&i.stream_type,c=(ui.Video|ui.LwoVideo)&i.stream_type,l=(65280&i.stream_type)!=0,d=s&&r.hasAudio,h=c&&r.hasVideo;c&&(r._trust_video_stream_added_state_=!0,r._video_added_=!0,r._videoSSRC=i.video_ssrc,r._rtxSsrcId=i.video_rtx),s&&(r._trust_audio_stream_added_state_=!0,r._audio_added_=!0,r._audioSSRC=i.audio_ssrc),s&&!d&&this.getListeners(he.PUBLISHED_USER_LIST).length===0&&(T.info("[".concat(this._clientId,"] remote user ").concat(r.uid," published audio")),this.safeEmit(he.USER_PUBLISHED,r,"audio")),c&&!h&&this.getListeners(he.PUBLISHED_USER_LIST).length===0&&(T.info("[".concat(this._clientId,"] remote user ").concat(r.uid," published video")),this.safeEmit(he.USER_PUBLISHED,r,"video")),(s&&!d||c&&!h||l)&&e.push(r),c&&this._p2pChannel.hasPendingRemoteMedia(r,"video")&&n.push({user:r,mediaType:"video"}),s&&this._p2pChannel.hasPendingRemoteMedia(r,"audio")&&n.push({user:r,mediaType:"audio"})}n.length>0&&(T.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(n.map(i=>"user: ".concat(i.user.uid,", mediaType: ").concat(i.mediaType)).join("; ")," ")),this.massSubscribe(n).catch(i=>{T.error("[".concat(this._clientId,"] mass resubscribe error"),i.toString())})),this.getListeners(he.PUBLISHED_USER_LIST).length>0?k("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=e:(T.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(e.map(i=>i.uid).join(", "))),this.safeEmit(he.PUBLISHED_USER_LIST,e)):T.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(e.map(i=>i.uid).join(", ")))}),this._gateway.signal.on(pe.ON_RTP_CAPABILITY_CHANGE,t=>{const{video_codec:e}=t;this._p2pChannel instanceof Zg&&this._p2pChannel.updateRemoteRTPCapabilities(e.map(n=>n.toLowerCase()).filter(n=>{var i;return mt(i=Object.keys(xg)).call(i,n)}))})}_handleP2PEvents(){this._gateway.signal.on(pe.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(jn.PUBLISH,(t,e,n)=>{const{uid:i}=t;t.forEach(r=>{const{kind:s,ssrcs:c,mid:l,isMuted:d}=r;this._handleP2PAddAudioOrVideoStream(s,i,c[0].ssrcId,l);const h=this._users.find(p=>p.uid===i);return h&&this.store.useP2P?this._p2pChannel.mockSubscribe(h,s,c[0].ssrcId,l).then(()=>{e()}).catch(n):e(),this._handleMuteStream(i,s,!!d)})}),this._gateway.signal.on(jn.CALL,async(t,e,n)=>{if(this.store.useP2P)try{var i;e(await this._p2pChannel.startP2P({turnServer:(i=this._joinInfo)===null||i===void 0?void 0:i.turnServer},t))}catch(r){n(r)}}),this._gateway.signal.on(Yt.P2P_CONNECTION,async t=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(t)}),this._gateway.signal.on(jn.UNPUBLISH,async(t,e,n)=>{if(this.store.useP2P){const{unpubMsg:i,uid:r}=t,s=this._users.find(c=>c.uid===r);if(!s)return T.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(r)),void e();try{i.forEach(async c=>{let{stream_type:l}=c;const d=l===Ve.Audio?Ct.AUDIO:Ct.VIDEO;await this._p2pChannel.unsubscribe(s,d),this._handleMuteStream(r,d,!0)}),e()}catch(c){n(c)}}}),this._gateway.signal.on(jn.CONTROL,async(t,e)=>{const{action:n}=t;switch(n){case qd.MUTE_LOCAL_VIDEO:this._handleMuteStream(e,Ct.VIDEO,!0);break;case qd.MUTE_LOCAL_AUDIO:this._handleMuteStream(e,Ct.AUDIO,!0);break;case qd.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",e),this._handleMuteStream(e,Ct.VIDEO,!1);break;case qd.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",e),this._handleMuteStream(e,Ct.AUDIO,!1)}}),this._gateway.signal.on(jn.RESTART_ICE,async(t,e,n)=>{if(this.store.useP2P)try{const{direction:i,iceParameter:r}=t;i!==Sr.SEND_ONLY||r?e(await this._p2pChannel.restartICE(i,r)):(this._p2pChannel.handleDisconnect(i),e())}catch(i){n(i)}}),this._gateway.signal.on(jn.CANDIDATE,t=>{if(this.store.useP2P){const{candidate:e,direction:n}=t;this._p2pChannel.addRemoteCandidate(e,n)}}),this._p2pChannel.on(Mt.RequestP2PRestartICE,async(t,e,n)=>{try{const{direction:i}=t;e(await this._gateway.sendExtensionMessage(jn.RESTART_ICE,t,i===Sr.SEND_ONLY))}catch(i){n(i)}}),this._p2pChannel.on(Mt.LocalCandidate,t=>{this._gateway.sendExtensionMessage(jn.CANDIDATE,JSON.stringify(t),!0)}),this._p2pChannel.on(Mt.RequestP2PMuteLocal,async(t,e,n)=>{try{await this._gateway.sendExtensionMessage(jn.CONTROL,t,!0),e()}catch(i){n(i)}}),this._p2pChannel.on(Mt.RequestP2PUnmuteRemote,async(t,e,n)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(i){i.code===P.DISCONNECT_P2P?e():n(i)}else e()}),this._p2pChannel.on(Mt.RequestP2PMuteRemote,async(t,e,n)=>{if(this._joinInfo)try{await this._gateway.muteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(i){i.code===P.DISCONNECT_P2P?e():n(i)}else e()}),this._p2pChannel.on(Mt.StateChange,(t,e)=>{e===Me.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(Mt.PeerConnectionStateChange,t=>{const e=this._peerConnectionState;t!==e&&(this.safeEmit(he.PEERCONNECTION_STATE_CHANGE,t,e),this._peerConnectionState=t)}),this._p2pChannel.on(Mt.RequestMuteLocal,async(t,e,n)=>{if(this._joinInfo)try{await this._gateway.muteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(i){i.code===P.DISCONNECT_P2P?e():n(i)}else e()}),this._p2pChannel.on(Mt.RequestUnmuteLocal,async(t,e,n)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(i){i.code===P.DISCONNECT_P2P?e():n(i)}else e()}),this._p2pChannel.on(Mt.RequestRePublish,(t,e,n)=>{this.publish(t,!1).then(e).catch(n)}),this._p2pChannel.on(Mt.RequestRePublishDataChannel,(t,e,n)=>{Tt.all(t.map(async i=>{const r=await this._p2pChannel.publishDataChannel([i]);try{r.forEach(s=>{this._uid&&this._gateway.publishDataChannel(this._uid,s,!0)})}catch(s){if(s.code!==P.DISCONNECT_P2P)throw s}})).then(e).catch(n)}),this._p2pChannel.on(Mt.RequestReSubscribe,async(t,e,n)=>{try{for(const{user:i,kind:r}of t)r===Ct.VIDEO?await this.subscribe(i,"video"):await this.subscribe(i,"audio");e()}catch(i){n(i)}}),this._p2pChannel.on(Mt.RequestUpload,(t,e)=>{this._gateway.upload(t,e)}),this._p2pChannel.on(Mt.RequestUploadStats,t=>{this._gateway.uploadWRTCStats(t)}),this._p2pChannel.on(Mt.MediaReconnectStart,t=>{this.safeEmit(he.MEDIA_RECONNECT_START,t)}),this._p2pChannel.on(Mt.MediaReconnectEnd,t=>{this.safeEmit(he.MEDIA_RECONNECT_END,t)}),this._p2pChannel.on(Mt.NeedSignalRTT,t=>{t(this._gateway.getSignalRTT())}),this._p2pChannel.on(Mt.RequestRestartICE,async t=>{if(this.store.useP2P)return;const e=await this._p2pChannel.restartICE(t),n=await e.next();if(n.done)return;const i=n.value;let r;try{r=await this._gateway.restartICE({iceParameters:i})}catch(c){return void e.throw(c)}const{iceParameters:s}=function(c){const l=c.iceParameters;return{iceParameters:{iceUfrag:l.iceUfrag,icePwd:l.icePwd}}}(r);await e.next({remoteIceParameters:s})}),this._p2pChannel.on(Mt.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(Mt.RequestReconnectPC,async()=>{var t;const{iceParameters:e,dtlsParameters:n,rtpCapabilities:i}=await this._p2pChannel.startP2PConnection({turnServer:(t=this._joinInfo)===null||t===void 0?void 0:t.turnServer}),{gatewayEstablishParams:r,gatewayAddress:s}=await this._gateway.reconnectPC({iceParameters:e,dtlsParameters:n,rtpCapabilities:i}),c=vM(r,s);await this._p2pChannel.connect(c),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(Mt.RequestUnpublishForReconnectPC,async(t,e,n)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(t,this._uid),e()):n()}),this._p2pChannel.on(Mt.P2PLost,()=>{this.safeEmit(he.P2P_LOST,this.store.uid)}),this._p2pChannel.on(Mt.UpdateVideoEncoder,t=>{t._encoderConfig&&this._gateway.setVideoProfile(t._encoderConfig)}),this._p2pChannel.on(Mt.ConnectionTypeChange,t=>{this.safeEmit(he.IS_USING_CLOUD_PROXY,t)}),this._p2pChannel.on(Mt.RequestLowStreamParameter,t=>{t(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(Mt.QueryClientConnectionState,t=>{t(this.connectionState)}),this._p2pChannel.on(Mt.AudioMetadata,t=>{this.safeEmit(he.AUDIO_METADATA,t)}),this._p2pChannel.on(Mt.AudioPts,t=>{this.safeEmit(he.AUDIO_PTS,Number(t))})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(t){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new K(P.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new K(P.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const n=(e={config:t},wl("ContentInspect").create(e));this._inspect=n,this.handleVideoInspectEvents(n);const{appId:i,cname:r,sid:s,token:c,uid:l,cid:d,vid:h}=this._joinInfo;await n.init({appId:i,areaCode:"",cname:r,sid:s,token:c,uid:l,cid:d,vid:h?Number(h):0},Xn)}catch(n){throw Array.isArray(n)?n[0]:n}var e}handleVideoInspectEvents(t){t.on(mi.CONNECTION_STATE_CHANGE,(e,n)=>{if(this.safeEmit(he.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,e,n),n===xs.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(he.CONTENT_INSPECT_ERROR,new K(P.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));t.inspectImage()}}),t.on(mi.INSPECT_RESULT,(e,n)=>{var i;if((n==null?void 0:n.code)===P.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return T.debug("Stop inspect content because that has left channel"),this==null||(i=this._inspect)===null||i===void 0||i.close(),void(this._inspect=void 0);this.safeEmit(he.CONTENT_INSPECT_RESULT,e,n)}),t.on(mi.CLIENT_LOCAL_VIDEO_TRACK,e=>{e(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new K(P.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(t){throw Array.isArray(t)?t[0]:t}}async setImageModeration(t,e){if(yo(t,"enabled"),t){if(!e)throw new K(P.INVALID_PARAMS,"config is required");if(k2(e),!this._joinInfo)throw new K(P.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(e);else{const i=(n={config:e},wl("ImageModeration").create(n));this._moderation=i,this.handleImageModerationEvents(i);const{appId:r,cname:s,sid:c,token:l,uid:d,cid:h,vid:p}=this._joinInfo;await i.init({appId:r,areaCode:"",cname:s,sid:c,token:l,uid:d,cid:h,vid:p?Number(p):0},Xn)}}catch(i){throw Array.isArray(i)?i[0]:i}}else{var n;if(!this._moderation)throw new K(P.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(i){throw Array.isArray(i)?i[0]:i}}}handleImageModerationEvents(t){t.on(wo.CONNECTION_STATE_CHANGE,(e,n)=>{if(this.safeEmit(he.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,e,n),e===is.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new K(P.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");t.inspectImage()}}),t.on(wo.CLIENT_LOCAL_VIDEO_TRACK,e=>{e(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}setP2PTransport(t){if(function(e){ri(e,"transport",["default","auto","relay","sd-rtn"])}(t),this.mode!=="p2p")throw new K(P.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=t,T.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(t))}getJoinChannelServiceRecords(){return T.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(t){yo(t,"enabled"),Fe("ENABLE_PUBLISH_AUDIO_FILTER",t),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(t)}_handleResetAddStream(t,e){switch(e){case"audio":t._audio_added_=!1,t._trust_audio_stream_added_state_=!0;break;case"video":t._video_added_=!1,t._trust_video_stream_added_state_=!0}}},Dt(bt.prototype,"leave",[L2],Object.getOwnPropertyDescriptor(bt.prototype,"leave"),bt.prototype),Dt(bt.prototype,"publish",[x2],Object.getOwnPropertyDescriptor(bt.prototype,"publish"),bt.prototype),Dt(bt.prototype,"unpublish",[M2],Object.getOwnPropertyDescriptor(bt.prototype,"unpublish"),bt.prototype),Dt(bt.prototype,"subscribe",[U2],Object.getOwnPropertyDescriptor(bt.prototype,"subscribe"),bt.prototype),Dt(bt.prototype,"presubscribe",[V2],Object.getOwnPropertyDescriptor(bt.prototype,"presubscribe"),bt.prototype),Dt(bt.prototype,"massSubscribe",[j2],Object.getOwnPropertyDescriptor(bt.prototype,"massSubscribe"),bt.prototype),Dt(bt.prototype,"unsubscribe",[B2],Object.getOwnPropertyDescriptor(bt.prototype,"unsubscribe"),bt.prototype),Dt(bt.prototype,"massUnsubscribe",[F2],Object.getOwnPropertyDescriptor(bt.prototype,"massUnsubscribe"),bt.prototype),Dt(bt.prototype,"setLowStreamParameter",[G2],Object.getOwnPropertyDescriptor(bt.prototype,"setLowStreamParameter"),bt.prototype),Dt(bt.prototype,"enableDualStream",[H2],Object.getOwnPropertyDescriptor(bt.prototype,"enableDualStream"),bt.prototype),Dt(bt.prototype,"disableDualStream",[W2],Object.getOwnPropertyDescriptor(bt.prototype,"disableDualStream"),bt.prototype),Dt(bt.prototype,"setClientRole",[z2],Object.getOwnPropertyDescriptor(bt.prototype,"setClientRole"),bt.prototype),Dt(bt.prototype,"_setClientRoleOptions",[q2],Object.getOwnPropertyDescriptor(bt.prototype,"_setClientRoleOptions"),bt.prototype),Dt(bt.prototype,"setProxyServer",[K2],Object.getOwnPropertyDescriptor(bt.prototype,"setProxyServer"),bt.prototype),Dt(bt.prototype,"setTurnServer",[Y2],Object.getOwnPropertyDescriptor(bt.prototype,"setTurnServer"),bt.prototype),Dt(bt.prototype,"setLicense",[X2],Object.getOwnPropertyDescriptor(bt.prototype,"setLicense"),bt.prototype),Dt(bt.prototype,"startProxyServer",[Q2],Object.getOwnPropertyDescriptor(bt.prototype,"startProxyServer"),bt.prototype),Dt(bt.prototype,"stopProxyServer",[J2],Object.getOwnPropertyDescriptor(bt.prototype,"stopProxyServer"),bt.prototype),Dt(bt.prototype,"setLocalAccessPointsV2",[Z2],Object.getOwnPropertyDescriptor(bt.prototype,"setLocalAccessPointsV2"),bt.prototype),Dt(bt.prototype,"setLocalAccessPoints",[$2],Object.getOwnPropertyDescriptor(bt.prototype,"setLocalAccessPoints"),bt.prototype),Dt(bt.prototype,"setRemoteDefaultVideoStreamType",[tU],Object.getOwnPropertyDescriptor(bt.prototype,"setRemoteDefaultVideoStreamType"),bt.prototype),Dt(bt.prototype,"setRemoteVideoStreamType",[eU],Object.getOwnPropertyDescriptor(bt.prototype,"setRemoteVideoStreamType"),bt.prototype),Dt(bt.prototype,"setStreamFallbackOption",[nU],Object.getOwnPropertyDescriptor(bt.prototype,"setStreamFallbackOption"),bt.prototype),Dt(bt.prototype,"setEncryptionConfig",[iU],Object.getOwnPropertyDescriptor(bt.prototype,"setEncryptionConfig"),bt.prototype),Dt(bt.prototype,"renewToken",[rU],Object.getOwnPropertyDescriptor(bt.prototype,"renewToken"),bt.prototype),Dt(bt.prototype,"enableAudioVolumeIndicator",[aU],Object.getOwnPropertyDescriptor(bt.prototype,"enableAudioVolumeIndicator"),bt.prototype),Dt(bt.prototype,"startLiveStreaming",[sU],Object.getOwnPropertyDescriptor(bt.prototype,"startLiveStreaming"),bt.prototype),Dt(bt.prototype,"setLiveTranscoding",[oU],Object.getOwnPropertyDescriptor(bt.prototype,"setLiveTranscoding"),bt.prototype),Dt(bt.prototype,"stopLiveStreaming",[cU],Object.getOwnPropertyDescriptor(bt.prototype,"stopLiveStreaming"),bt.prototype),Dt(bt.prototype,"startChannelMediaRelay",[lU],Object.getOwnPropertyDescriptor(bt.prototype,"startChannelMediaRelay"),bt.prototype),Dt(bt.prototype,"updateChannelMediaRelay",[dU],Object.getOwnPropertyDescriptor(bt.prototype,"updateChannelMediaRelay"),bt.prototype),Dt(bt.prototype,"stopChannelMediaRelay",[uU],Object.getOwnPropertyDescriptor(bt.prototype,"stopChannelMediaRelay"),bt.prototype),Dt(bt.prototype,"sendCustomReportMessage",[hU],Object.getOwnPropertyDescriptor(bt.prototype,"sendCustomReportMessage"),bt.prototype),Dt(bt.prototype,"pickSVCLayer",[pU],Object.getOwnPropertyDescriptor(bt.prototype,"pickSVCLayer"),bt.prototype),Dt(bt.prototype,"setRTMConfig",[fU],Object.getOwnPropertyDescriptor(bt.prototype,"setRTMConfig"),bt.prototype),Dt(bt.prototype,"enableContentInspect",[mU],Object.getOwnPropertyDescriptor(bt.prototype,"enableContentInspect"),bt.prototype),Dt(bt.prototype,"disableContentInspect",[_U],Object.getOwnPropertyDescriptor(bt.prototype,"disableContentInspect"),bt.prototype),Dt(bt.prototype,"setImageModeration",[EU],Object.getOwnPropertyDescriptor(bt.prototype,"setImageModeration"),bt.prototype),Dt(bt.prototype,"setP2PTransport",[gU],Object.getOwnPropertyDescriptor(bt.prototype,"setP2PTransport"),bt.prototype),Dt(bt.prototype,"getJoinChannelServiceRecords",[vU],Object.getOwnPropertyDescriptor(bt.prototype,"getJoinChannelServiceRecords"),bt.prototype),Dt(bt.prototype,"setPublishAudioFilterEnabled",[SU],Object.getOwnPropertyDescriptor(bt.prototype,"setPublishAudioFilterEnabled"),bt.prototype),bt);class ev{constructor(e,n){O(this,"id",0),O(this,"element",void 0),O(this,"peerPair",void 0),O(this,"context",void 0),O(this,"audioPlayerElement",void 0),O(this,"audioTrack",void 0),ev.count+=1,this.id=ev.count,this.element=e,this.context=n}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=e=>{const n=document.createElement("audio");n.srcObject=new MediaStream([e.track]),n.play(),this.audioPlayerElement=n}}async switchSdp(){if(!this.peerPair)return;const e=async(i,r)=>{const s=r==="offer"?await i.createOffer():await i.createAnswer();return await i.setLocalDescription(s),i.iceGatheringState==="complete"?i.localDescription:new Tt(c=>{i.onicegatheringstatechange=()=>{i.iceGatheringState==="complete"&&c(i.localDescription)}})},n=async(i,r)=>await i.setRemoteDescription(r);try{const i=await e(this.peerPair[0],"offer");await n(this.peerPair[1],i);const r=await e(this.peerPair[1],"answer");await n(this.peerPair[0],r)}catch(i){throw new K(P.LOCAL_AEC_ERROR,i.toString()).print()}}async getTracksFromMediaElement(e){if(this.audioTrack)return this.audioTrack;let n;try{e instanceof HTMLVideoElement&&(e.captureStream?e.captureStream():e.mozCaptureStream()),n=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(e).connect(n)}catch(r){throw new K(P.LOCAL_AEC_ERROR,r.toString()).print()}if(!n)throw new K(P.LOCAL_AEC_ERROR,"no dest node when local aec").print();const i=n.stream.getAudioTracks()[0];return this.audioTrack=i,i}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const e=this.element,n=await this.getTracksFromMediaElement(e);this.peerPair&&this.peerPair[0].addTrack(n),await this.switchSdp()}close(){T.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(e=>{e.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var yU,rb;O(ev,"count",0);const tH=window.AudioContext||window.webkitAudioContext,eH=new(yU=Bt({report:Pt}),Dt((rb=class{constructor(){O(this,"units",[]),O(this,"context",void 0)}processExternalMediaAEC(t){if(!this._doesEnvironmentNeedAEC())return T.debug("the system does not need to process local aec"),-1;this.context||(this.context=new tH);let e=this.units.find(n=>n&&n.getElement()===t);return e||(e=new ev(t,this.context),this.units.push(e)),e.startEchoCancellation(),T.debug("start processing local audio echo cancellation, id is",e.id),e.id}_doesEnvironmentNeedAEC(){return ve().name!==Ie.SAFARI}}).prototype,"processExternalMediaAEC",[yU],Object.getOwnPropertyDescriptor(rb.prototype,"processExternalMediaAEC"),rb.prototype),rb);function RU(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function bU(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?RU(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):RU(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const SI=window||document;function CU(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!SI)return;const n=Qn._cspEventHandlerPointer;if(n&&e)return void console.error(n,e);const i=r=>{if(!(r&&r.blockedURI&&(Qn.onSecurityPolicyViolation||Qn.getListeners(Rc.SECURITY_POLICY_VIOLATION).length>0)))return;const s=r.blockedURI;k("CSP_DETECTED_HOSTNAME_LIST").some(c=>mt(s).call(s,c))&&(Qn.onSecurityPolicyViolation&&typeof Qn.onSecurityPolicyViolation=="function"&&Qn.onSecurityPolicyViolation(r),Qn.getListeners(Rc.SECURITY_POLICY_VIOLATION).length>0&&Qn.safeEmit(Rc.SECURITY_POLICY_VIOLATION,r))};n&&SI.removeEventListener("securitypolicyviolation",n),(e||t&&typeof t=="function"||Qn.getListeners(Rc.SECURITY_POLICY_VIOLATION).length>0)&&SI.addEventListener("securitypolicyviolation",i),Qn._cspEventHandlerPointer=i}var nH=vt,iH=ok,AU=RegExp.prototype,rH=function(t){return t===AU||nH(AU,t)?iH(t):t.flags},pr=V(rH);function Mm(t){let e=t.length;for(;--e>=0;)t[e]=0}const TI=256,wU=286,nv=30,iv=15,yI=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),ab=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),aH=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),IU=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Ol=new Array(576);Mm(Ol);const rv=new Array(60);Mm(rv);const av=new Array(512);Mm(av);const sv=new Array(256);Mm(sv);const RI=new Array(29);Mm(RI);const sb=new Array(nv);function bI(t,e,n,i,r){this.static_tree=t,this.extra_bits=e,this.extra_base=n,this.elems=i,this.max_length=r,this.has_stree=t&&t.length}let OU,NU,DU;function CI(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}Mm(sb);const PU=t=>t<256?av[t]:av[256+(t>>>7)],ov=(t,e)=>{t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255},xa=(t,e,n)=>{t.bi_valid>16-n?(t.bi_buf|=e<<t.bi_valid&65535,ov(t,t.bi_buf),t.bi_buf=e>>16-t.bi_valid,t.bi_valid+=n-16):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=n)},Ac=(t,e,n)=>{xa(t,n[2*e],n[2*e+1])},kU=(t,e)=>{let n=0;do n|=1&t,t>>>=1,n<<=1;while(--e>0);return n>>>1},LU=(t,e,n)=>{const i=new Array(16);let r,s,c=0;for(r=1;r<=iv;r++)c=c+n[r-1]<<1,i[r]=c;for(s=0;s<=e;s++){let l=t[2*s+1];l!==0&&(t[2*s]=kU(i[l]++,l))}},xU=t=>{let e;for(e=0;e<wU;e++)t.dyn_ltree[2*e]=0;for(e=0;e<nv;e++)t.dyn_dtree[2*e]=0;for(e=0;e<19;e++)t.bl_tree[2*e]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},MU=t=>{t.bi_valid>8?ov(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},UU=(t,e,n,i)=>{const r=2*e,s=2*n;return t[r]<t[s]||t[r]===t[s]&&i[e]<=i[n]},AI=(t,e,n)=>{const i=t.heap[n];let r=n<<1;for(;r<=t.heap_len&&(r<t.heap_len&&UU(e,t.heap[r+1],t.heap[r],t.depth)&&r++,!UU(e,i,t.heap[r],t.depth));)t.heap[n]=t.heap[r],n=r,r<<=1;t.heap[n]=i},VU=(t,e,n)=>{let i,r,s,c,l=0;if(t.sym_next!==0)do i=255&t.pending_buf[t.sym_buf+l++],i+=(255&t.pending_buf[t.sym_buf+l++])<<8,r=t.pending_buf[t.sym_buf+l++],i===0?Ac(t,r,e):(s=sv[r],Ac(t,s+TI+1,e),c=yI[s],c!==0&&(r-=RI[s],xa(t,r,c)),i--,s=PU(i),Ac(t,s,n),c=ab[s],c!==0&&(i-=sb[s],xa(t,i,c)));while(l<t.sym_next);Ac(t,256,e)},wI=(t,e)=>{const n=e.dyn_tree,i=e.stat_desc.static_tree,r=e.stat_desc.has_stree,s=e.stat_desc.elems;let c,l,d,h=-1;for(t.heap_len=0,t.heap_max=573,c=0;c<s;c++)n[2*c]!==0?(t.heap[++t.heap_len]=h=c,t.depth[c]=0):n[2*c+1]=0;for(;t.heap_len<2;)d=t.heap[++t.heap_len]=h<2?++h:0,n[2*d]=1,t.depth[d]=0,t.opt_len--,r&&(t.static_len-=i[2*d+1]);for(e.max_code=h,c=t.heap_len>>1;c>=1;c--)AI(t,n,c);d=s;do c=t.heap[1],t.heap[1]=t.heap[t.heap_len--],AI(t,n,1),l=t.heap[1],t.heap[--t.heap_max]=c,t.heap[--t.heap_max]=l,n[2*d]=n[2*c]+n[2*l],t.depth[d]=(t.depth[c]>=t.depth[l]?t.depth[c]:t.depth[l])+1,n[2*c+1]=n[2*l+1]=d,t.heap[1]=d++,AI(t,n,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],((p,m)=>{const _=m.dyn_tree,E=m.max_code,I=m.stat_desc.static_tree,C=m.stat_desc.has_stree,w=m.stat_desc.extra_bits,D=m.stat_desc.extra_base,N=m.stat_desc.max_length;let L,W,G,U,z,$,rt=0;for(U=0;U<=iv;U++)p.bl_count[U]=0;for(_[2*p.heap[p.heap_max]+1]=0,L=p.heap_max+1;L<573;L++)W=p.heap[L],U=_[2*_[2*W+1]+1]+1,U>N&&(U=N,rt++),_[2*W+1]=U,W>E||(p.bl_count[U]++,z=0,W>=D&&(z=w[W-D]),$=_[2*W],p.opt_len+=$*(U+z),C&&(p.static_len+=$*(I[2*W+1]+z)));if(rt!==0){do{for(U=N-1;p.bl_count[U]===0;)U--;p.bl_count[U]--,p.bl_count[U+1]+=2,p.bl_count[N]--,rt-=2}while(rt>0);for(U=N;U!==0;U--)for(W=p.bl_count[U];W!==0;)G=p.heap[--L],G>E||(_[2*G+1]!==U&&(p.opt_len+=(U-_[2*G+1])*_[2*G],_[2*G+1]=U),W--)}})(t,e),LU(n,h,t.bl_count)},jU=(t,e,n)=>{let i,r,s=-1,c=e[1],l=0,d=7,h=4;for(c===0&&(d=138,h=3),e[2*(n+1)+1]=65535,i=0;i<=n;i++)r=c,c=e[2*(i+1)+1],++l<d&&r===c||(l<h?t.bl_tree[2*r]+=l:r!==0?(r!==s&&t.bl_tree[2*r]++,t.bl_tree[32]++):l<=10?t.bl_tree[34]++:t.bl_tree[36]++,l=0,s=r,c===0?(d=138,h=3):r===c?(d=6,h=3):(d=7,h=4))},BU=(t,e,n)=>{let i,r,s=-1,c=e[1],l=0,d=7,h=4;for(c===0&&(d=138,h=3),i=0;i<=n;i++)if(r=c,c=e[2*(i+1)+1],!(++l<d&&r===c)){if(l<h)do Ac(t,r,t.bl_tree);while(--l!=0);else r!==0?(r!==s&&(Ac(t,r,t.bl_tree),l--),Ac(t,16,t.bl_tree),xa(t,l-3,2)):l<=10?(Ac(t,17,t.bl_tree),xa(t,l-3,3)):(Ac(t,18,t.bl_tree),xa(t,l-11,7));l=0,s=r,c===0?(d=138,h=3):r===c?(d=6,h=3):(d=7,h=4)}};let FU=!1;const GU=(t,e,n,i)=>{xa(t,0+(i?1:0),3),MU(t),ov(t,n),ov(t,~n),n&&t.pending_buf.set(t.window.subarray(e,e+n),t.pending),t.pending+=n};var sH=t=>{FU||((()=>{let e,n,i,r,s;const c=new Array(16);for(i=0,r=0;r<28;r++)for(RI[r]=i,e=0;e<1<<yI[r];e++)sv[i++]=r;for(sv[i-1]=r,s=0,r=0;r<16;r++)for(sb[r]=s,e=0;e<1<<ab[r];e++)av[s++]=r;for(s>>=7;r<nv;r++)for(sb[r]=s<<7,e=0;e<1<<ab[r]-7;e++)av[256+s++]=r;for(n=0;n<=iv;n++)c[n]=0;for(e=0;e<=143;)Ol[2*e+1]=8,e++,c[8]++;for(;e<=255;)Ol[2*e+1]=9,e++,c[9]++;for(;e<=279;)Ol[2*e+1]=7,e++,c[7]++;for(;e<=287;)Ol[2*e+1]=8,e++,c[8]++;for(LU(Ol,287,c),e=0;e<nv;e++)rv[2*e+1]=5,rv[2*e]=kU(e,5);OU=new bI(Ol,yI,257,wU,iv),NU=new bI(rv,ab,0,nv,iv),DU=new bI(new Array(0),aH,0,19,7)})(),FU=!0),t.l_desc=new CI(t.dyn_ltree,OU),t.d_desc=new CI(t.dyn_dtree,NU),t.bl_desc=new CI(t.bl_tree,DU),t.bi_buf=0,t.bi_valid=0,xU(t)},oH=(t,e,n,i)=>{let r,s,c=0;t.level>0?(t.strm.data_type===2&&(t.strm.data_type=(l=>{let d,h=4093624447;for(d=0;d<=31;d++,h>>>=1)if(1&h&&l.dyn_ltree[2*d]!==0)return 0;if(l.dyn_ltree[18]!==0||l.dyn_ltree[20]!==0||l.dyn_ltree[26]!==0)return 1;for(d=32;d<TI;d++)if(l.dyn_ltree[2*d]!==0)return 1;return 0})(t)),wI(t,t.l_desc),wI(t,t.d_desc),c=(l=>{let d;for(jU(l,l.dyn_ltree,l.l_desc.max_code),jU(l,l.dyn_dtree,l.d_desc.max_code),wI(l,l.bl_desc),d=18;d>=3&&l.bl_tree[2*IU[d]+1]===0;d--);return l.opt_len+=3*(d+1)+5+5+4,d})(t),r=t.opt_len+3+7>>>3,s=t.static_len+3+7>>>3,s<=r&&(r=s)):r=s=n+5,n+4<=r&&e!==-1?GU(t,e,n,i):t.strategy===4||s===r?(xa(t,2+(i?1:0),3),VU(t,Ol,rv)):(xa(t,4+(i?1:0),3),((l,d,h,p)=>{let m;for(xa(l,d-257,5),xa(l,h-1,5),xa(l,p-4,4),m=0;m<p;m++)xa(l,l.bl_tree[2*IU[m]+1],3);BU(l,l.dyn_ltree,d-1),BU(l,l.dyn_dtree,h-1)})(t,t.l_desc.max_code+1,t.d_desc.max_code+1,c+1),VU(t,t.dyn_ltree,t.dyn_dtree)),xU(t),i&&MU(t)},cH=(t,e,n)=>(t.pending_buf[t.sym_buf+t.sym_next++]=e,t.pending_buf[t.sym_buf+t.sym_next++]=e>>8,t.pending_buf[t.sym_buf+t.sym_next++]=n,e===0?t.dyn_ltree[2*n]++:(t.matches++,e--,t.dyn_ltree[2*(sv[n]+TI+1)]++,t.dyn_dtree[2*PU(e)]++),t.sym_next===t.sym_end),lH=t=>{xa(t,2,3),Ac(t,256,Ol),(e=>{e.bi_valid===16?(ov(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(t)},dH={_tr_init:sH,_tr_stored_block:GU,_tr_flush_block:oH,_tr_tally:cH,_tr_align:lH},cv=(t,e,n,i)=>{let r=65535&t|0,s=t>>>16&65535|0,c=0;for(;n!==0;){c=n>2e3?2e3:n,n-=c;do r=r+e[i++]|0,s=s+r|0;while(--c);r%=65521,s%=65521}return r|s<<16|0};const uH=new Uint32Array((()=>{let t,e=[];for(var n=0;n<256;n++){t=n;for(var i=0;i<8;i++)t=1&t?3988292384^t>>>1:t>>>1;e[n]=t}return e})());var yr=(t,e,n,i)=>{const r=uH,s=i+n;t^=-1;for(let c=i;c<s;c++)t=t>>>8^r[255&(t^e[c])];return-1^t},Yh={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},ob={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:hH,_tr_stored_block:II,_tr_flush_block:pH,_tr_tally:iu,_tr_align:fH}=dH,{Z_NO_FLUSH:ru,Z_PARTIAL_FLUSH:mH,Z_FULL_FLUSH:_H,Z_FINISH:Bs,Z_BLOCK:HU,Z_OK:Pr,Z_STREAM_END:WU,Z_STREAM_ERROR:wc,Z_DATA_ERROR:EH,Z_BUF_ERROR:OI,Z_DEFAULT_COMPRESSION:gH,Z_FILTERED:vH,Z_HUFFMAN_ONLY:cb,Z_RLE:SH,Z_FIXED:TH,Z_DEFAULT_STRATEGY:yH,Z_UNKNOWN:RH,Z_DEFLATED:lb}=ob,NI=286,bH=30,CH=19,AH=2*NI+1,wH=15,Xh=258,Ic=262,Um=42,Qh=113,lv=666,Jh=(t,e)=>(t.msg=Yh[e],e),zU=t=>2*t-(t>4?9:0),au=t=>{let e=t.length;for(;--e>=0;)t[e]=0},IH=t=>{let e,n,i,r=t.w_size;e=t.hash_size,i=e;do n=t.head[--i],t.head[i]=n>=r?n-r:0;while(--e);e=r,i=e;do n=t.prev[--i],t.prev[i]=n>=r?n-r:0;while(--e)};let su=(t,e,n)=>(e<<t.hash_shift^n)&t.hash_mask;const as=t=>{const e=t.state;let n=e.pending;n>t.avail_out&&(n=t.avail_out),n!==0&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+n),t.next_out),t.next_out+=n,e.pending_out+=n,t.total_out+=n,t.avail_out-=n,e.pending-=n,e.pending===0&&(e.pending_out=0))},ss=(t,e)=>{pH(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,as(t.strm)},Ln=(t,e)=>{t.pending_buf[t.pending++]=e},dv=(t,e)=>{t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e},DI=(t,e,n,i)=>{let r=t.avail_in;return r>i&&(r=i),r===0?0:(t.avail_in-=r,e.set(t.input.subarray(t.next_in,t.next_in+r),n),t.state.wrap===1?t.adler=cv(t.adler,e,r,n):t.state.wrap===2&&(t.adler=yr(t.adler,e,r,n)),t.next_in+=r,t.total_in+=r,r)},qU=(t,e)=>{let n,i,r=t.max_chain_length,s=t.strstart,c=t.prev_length,l=t.nice_match;const d=t.strstart>t.w_size-Ic?t.strstart-(t.w_size-Ic):0,h=t.window,p=t.w_mask,m=t.prev,_=t.strstart+Xh;let E=h[s+c-1],I=h[s+c];t.prev_length>=t.good_match&&(r>>=2),l>t.lookahead&&(l=t.lookahead);do if(n=e,h[n+c]===I&&h[n+c-1]===E&&h[n]===h[s]&&h[++n]===h[s+1]){s+=2,n++;do;while(h[++s]===h[++n]&&h[++s]===h[++n]&&h[++s]===h[++n]&&h[++s]===h[++n]&&h[++s]===h[++n]&&h[++s]===h[++n]&&h[++s]===h[++n]&&h[++s]===h[++n]&&s<_);if(i=Xh-(_-s),s=_-Xh,i>c){if(t.match_start=e,c=i,i>=l)break;E=h[s+c-1],I=h[s+c]}}while((e=m[e&p])>d&&--r!=0);return c<=t.lookahead?c:t.lookahead},Vm=t=>{const e=t.w_size;let n,i,r;do{if(i=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-Ic)&&(t.window.set(t.window.subarray(e,e+e-i),0),t.match_start-=e,t.strstart-=e,t.block_start-=e,t.insert>t.strstart&&(t.insert=t.strstart),IH(t),i+=e),t.strm.avail_in===0)break;if(n=DI(t.strm,t.window,t.strstart+t.lookahead,i),t.lookahead+=n,t.lookahead+t.insert>=3)for(r=t.strstart-t.insert,t.ins_h=t.window[r],t.ins_h=su(t,t.ins_h,t.window[r+1]);t.insert&&(t.ins_h=su(t,t.ins_h,t.window[r+3-1]),t.prev[r&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=r,r++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<Ic&&t.strm.avail_in!==0)},KU=(t,e)=>{let n,i,r,s=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,c=0,l=t.strm.avail_in;do{if(n=65535,r=t.bi_valid+42>>3,t.strm.avail_out<r||(r=t.strm.avail_out-r,i=t.strstart-t.block_start,n>i+t.strm.avail_in&&(n=i+t.strm.avail_in),n>r&&(n=r),n<s&&(n===0&&e!==Bs||e===ru||n!==i+t.strm.avail_in)))break;c=e===Bs&&n===i+t.strm.avail_in?1:0,II(t,0,0,c),t.pending_buf[t.pending-4]=n,t.pending_buf[t.pending-3]=n>>8,t.pending_buf[t.pending-2]=~n,t.pending_buf[t.pending-1]=~n>>8,as(t.strm),i&&(i>n&&(i=n),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+i),t.strm.next_out),t.strm.next_out+=i,t.strm.avail_out-=i,t.strm.total_out+=i,t.block_start+=i,n-=i),n&&(DI(t.strm,t.strm.output,t.strm.next_out,n),t.strm.next_out+=n,t.strm.avail_out-=n,t.strm.total_out+=n)}while(c===0);return l-=t.strm.avail_in,l&&(l>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=l&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-l,t.strm.next_in),t.strstart),t.strstart+=l,t.insert+=l>t.w_size-t.insert?t.w_size-t.insert:l),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),c?4:e!==ru&&e!==Bs&&t.strm.avail_in===0&&t.strstart===t.block_start?2:(r=t.window_size-t.strstart,t.strm.avail_in>r&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,r+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),r>t.strm.avail_in&&(r=t.strm.avail_in),r&&(DI(t.strm,t.window,t.strstart,r),t.strstart+=r,t.insert+=r>t.w_size-t.insert?t.w_size-t.insert:r),t.high_water<t.strstart&&(t.high_water=t.strstart),r=t.bi_valid+42>>3,r=t.pending_buf_size-r>65535?65535:t.pending_buf_size-r,s=r>t.w_size?t.w_size:r,i=t.strstart-t.block_start,(i>=s||(i||e===Bs)&&e!==ru&&t.strm.avail_in===0&&i<=r)&&(n=i>r?r:i,c=e===Bs&&t.strm.avail_in===0&&n===i?1:0,II(t,t.block_start,n,c),t.block_start+=n,as(t.strm)),c?3:1)},PI=(t,e)=>{let n,i;for(;;){if(t.lookahead<Ic){if(Vm(t),t.lookahead<Ic&&e===ru)return 1;if(t.lookahead===0)break}if(n=0,t.lookahead>=3&&(t.ins_h=su(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),n!==0&&t.strstart-n<=t.w_size-Ic&&(t.match_length=qU(t,n)),t.match_length>=3)if(i=iu(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do t.strstart++,t.ins_h=su(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!=0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=su(t,t.ins_h,t.window[t.strstart+1]);else i=iu(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(i&&(ss(t,!1),t.strm.avail_out===0))return 1}return t.insert=t.strstart<2?t.strstart:2,e===Bs?(ss(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&(ss(t,!1),t.strm.avail_out===0)?1:2},jm=(t,e)=>{let n,i,r;for(;;){if(t.lookahead<Ic){if(Vm(t),t.lookahead<Ic&&e===ru)return 1;if(t.lookahead===0)break}if(n=0,t.lookahead>=3&&(t.ins_h=su(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,n!==0&&t.prev_length<t.max_lazy_match&&t.strstart-n<=t.w_size-Ic&&(t.match_length=qU(t,n),t.match_length<=5&&(t.strategy===vH||t.match_length===3&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){r=t.strstart+t.lookahead-3,i=iu(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=r&&(t.ins_h=su(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!=0);if(t.match_available=0,t.match_length=2,t.strstart++,i&&(ss(t,!1),t.strm.avail_out===0))return 1}else if(t.match_available){if(i=iu(t,0,t.window[t.strstart-1]),i&&ss(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(i=iu(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,e===Bs?(ss(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&(ss(t,!1),t.strm.avail_out===0)?1:2};function Oc(t,e,n,i,r){this.good_length=t,this.max_lazy=e,this.nice_length=n,this.max_chain=i,this.func=r}const uv=[new Oc(0,0,0,0,KU),new Oc(4,4,8,4,PI),new Oc(4,5,16,8,PI),new Oc(4,6,32,32,PI),new Oc(4,4,16,16,jm),new Oc(8,16,32,32,jm),new Oc(8,16,128,128,jm),new Oc(8,32,128,256,jm),new Oc(32,128,258,1024,jm),new Oc(32,258,258,4096,jm)];function OH(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=lb,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*AH),this.dyn_dtree=new Uint16Array(2*(2*bH+1)),this.bl_tree=new Uint16Array(2*(2*CH+1)),au(this.dyn_ltree),au(this.dyn_dtree),au(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(wH+1),this.heap=new Uint16Array(2*NI+1),au(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*NI+1),au(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const hv=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.status!==Um&&e.status!==57&&e.status!==69&&e.status!==73&&e.status!==91&&e.status!==103&&e.status!==Qh&&e.status!==lv?1:0},YU=t=>{if(hv(t))return Jh(t,wc);t.total_in=t.total_out=0,t.data_type=RH;const e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap===2?57:e.wrap?Um:Qh,t.adler=e.wrap===2?0:1,e.last_flush=-2,hH(e),Pr},XU=t=>{const e=YU(t);return e===Pr&&(n=>{n.window_size=2*n.w_size,au(n.head),n.max_lazy_match=uv[n.level].max_lazy,n.good_match=uv[n.level].good_length,n.nice_match=uv[n.level].nice_length,n.max_chain_length=uv[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0})(t.state),e},QU=(t,e,n,i,r,s)=>{if(!t)return wc;let c=1;if(e===gH&&(e=6),i<0?(c=0,i=-i):i>15&&(c=2,i-=16),r<1||r>9||n!==lb||i<8||i>15||e<0||e>9||s<0||s>TH||i===8&&c!==1)return Jh(t,wc);i===8&&(i=9);const l=new OH;return t.state=l,l.strm=t,l.status=Um,l.wrap=c,l.gzhead=null,l.w_bits=i,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=r+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+3-1)/3),l.window=new Uint8Array(2*l.w_size),l.head=new Uint16Array(l.hash_size),l.prev=new Uint16Array(l.w_size),l.lit_bufsize=1<<r+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new Uint8Array(l.pending_buf_size),l.sym_buf=l.lit_bufsize,l.sym_end=3*(l.lit_bufsize-1),l.level=e,l.strategy=s,l.method=n,XU(t)};var NH=(t,e)=>{if(hv(t)||e>HU||e<0)return t?Jh(t,wc):wc;const n=t.state;if(!t.output||t.avail_in!==0&&!t.input||n.status===lv&&e!==Bs)return Jh(t,t.avail_out===0?OI:wc);const i=n.last_flush;if(n.last_flush=e,n.pending!==0){if(as(t),t.avail_out===0)return n.last_flush=-1,Pr}else if(t.avail_in===0&&zU(e)<=zU(i)&&e!==Bs)return Jh(t,OI);if(n.status===lv&&t.avail_in!==0)return Jh(t,OI);if(n.status===Um&&n.wrap===0&&(n.status=Qh),n.status===Um){let r=lb+(n.w_bits-8<<4)<<8,s=-1;if(s=n.strategy>=cb||n.level<2?0:n.level<6?1:n.level===6?2:3,r|=s<<6,n.strstart!==0&&(r|=32),r+=31-r%31,dv(n,r),n.strstart!==0&&(dv(n,t.adler>>>16),dv(n,65535&t.adler)),t.adler=1,n.status=Qh,as(t),n.pending!==0)return n.last_flush=-1,Pr}if(n.status===57){if(t.adler=0,Ln(n,31),Ln(n,139),Ln(n,8),n.gzhead)Ln(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),Ln(n,255&n.gzhead.time),Ln(n,n.gzhead.time>>8&255),Ln(n,n.gzhead.time>>16&255),Ln(n,n.gzhead.time>>24&255),Ln(n,n.level===9?2:n.strategy>=cb||n.level<2?4:0),Ln(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(Ln(n,255&n.gzhead.extra.length),Ln(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(t.adler=yr(t.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(Ln(n,0),Ln(n,0),Ln(n,0),Ln(n,0),Ln(n,0),Ln(n,n.level===9?2:n.strategy>=cb||n.level<2?4:0),Ln(n,3),n.status=Qh,as(t),n.pending!==0)return n.last_flush=-1,Pr}if(n.status===69){if(n.gzhead.extra){let r=n.pending,s=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+s>n.pending_buf_size;){let l=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+l),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>r&&(t.adler=yr(t.adler,n.pending_buf,n.pending-r,r)),n.gzindex+=l,as(t),n.pending!==0)return n.last_flush=-1,Pr;r=0,s-=l}let c=new Uint8Array(n.gzhead.extra);n.pending_buf.set(c.subarray(n.gzindex,n.gzindex+s),n.pending),n.pending+=s,n.gzhead.hcrc&&n.pending>r&&(t.adler=yr(t.adler,n.pending_buf,n.pending-r,r)),n.gzindex=0}n.status=73}if(n.status===73){if(n.gzhead.name){let r,s=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>s&&(t.adler=yr(t.adler,n.pending_buf,n.pending-s,s)),as(t),n.pending!==0)return n.last_flush=-1,Pr;s=0}r=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,Ln(n,r)}while(r!==0);n.gzhead.hcrc&&n.pending>s&&(t.adler=yr(t.adler,n.pending_buf,n.pending-s,s)),n.gzindex=0}n.status=91}if(n.status===91){if(n.gzhead.comment){let r,s=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>s&&(t.adler=yr(t.adler,n.pending_buf,n.pending-s,s)),as(t),n.pending!==0)return n.last_flush=-1,Pr;s=0}r=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,Ln(n,r)}while(r!==0);n.gzhead.hcrc&&n.pending>s&&(t.adler=yr(t.adler,n.pending_buf,n.pending-s,s))}n.status=103}if(n.status===103){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(as(t),n.pending!==0))return n.last_flush=-1,Pr;Ln(n,255&t.adler),Ln(n,t.adler>>8&255),t.adler=0}if(n.status=Qh,as(t),n.pending!==0)return n.last_flush=-1,Pr}if(t.avail_in!==0||n.lookahead!==0||e!==ru&&n.status!==lv){let r=n.level===0?KU(n,e):n.strategy===cb?((s,c)=>{let l;for(;;){if(s.lookahead===0&&(Vm(s),s.lookahead===0)){if(c===ru)return 1;break}if(s.match_length=0,l=iu(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++,l&&(ss(s,!1),s.strm.avail_out===0))return 1}return s.insert=0,c===Bs?(ss(s,!0),s.strm.avail_out===0?3:4):s.sym_next&&(ss(s,!1),s.strm.avail_out===0)?1:2})(n,e):n.strategy===SH?((s,c)=>{let l,d,h,p;const m=s.window;for(;;){if(s.lookahead<=Xh){if(Vm(s),s.lookahead<=Xh&&c===ru)return 1;if(s.lookahead===0)break}if(s.match_length=0,s.lookahead>=3&&s.strstart>0&&(h=s.strstart-1,d=m[h],d===m[++h]&&d===m[++h]&&d===m[++h])){p=s.strstart+Xh;do;while(d===m[++h]&&d===m[++h]&&d===m[++h]&&d===m[++h]&&d===m[++h]&&d===m[++h]&&d===m[++h]&&d===m[++h]&&h<p);s.match_length=Xh-(p-h),s.match_length>s.lookahead&&(s.match_length=s.lookahead)}if(s.match_length>=3?(l=iu(s,1,s.match_length-3),s.lookahead-=s.match_length,s.strstart+=s.match_length,s.match_length=0):(l=iu(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++),l&&(ss(s,!1),s.strm.avail_out===0))return 1}return s.insert=0,c===Bs?(ss(s,!0),s.strm.avail_out===0?3:4):s.sym_next&&(ss(s,!1),s.strm.avail_out===0)?1:2})(n,e):uv[n.level].func(n,e);if(r!==3&&r!==4||(n.status=lv),r===1||r===3)return t.avail_out===0&&(n.last_flush=-1),Pr;if(r===2&&(e===mH?fH(n):e!==HU&&(II(n,0,0,!1),e===_H&&(au(n.head),n.lookahead===0&&(n.strstart=0,n.block_start=0,n.insert=0))),as(t),t.avail_out===0))return n.last_flush=-1,Pr}return e!==Bs?Pr:n.wrap<=0?WU:(n.wrap===2?(Ln(n,255&t.adler),Ln(n,t.adler>>8&255),Ln(n,t.adler>>16&255),Ln(n,t.adler>>24&255),Ln(n,255&t.total_in),Ln(n,t.total_in>>8&255),Ln(n,t.total_in>>16&255),Ln(n,t.total_in>>24&255)):(dv(n,t.adler>>>16),dv(n,65535&t.adler)),as(t),n.wrap>0&&(n.wrap=-n.wrap),n.pending!==0?Pr:WU)},DH=(t,e)=>{let n=e.length;if(hv(t))return wc;const i=t.state,r=i.wrap;if(r===2||r===1&&i.status!==Um||i.lookahead)return wc;if(r===1&&(t.adler=cv(t.adler,e,n,0)),i.wrap=0,n>=i.w_size){r===0&&(au(i.head),i.strstart=0,i.block_start=0,i.insert=0);let d=new Uint8Array(i.w_size);d.set(e.subarray(n-i.w_size,n),0),e=d,n=i.w_size}const s=t.avail_in,c=t.next_in,l=t.input;for(t.avail_in=n,t.next_in=0,t.input=e,Vm(i);i.lookahead>=3;){let d=i.strstart,h=i.lookahead-2;do i.ins_h=su(i,i.ins_h,i.window[d+3-1]),i.prev[d&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=d,d++;while(--h);i.strstart=d,i.lookahead=2,Vm(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=2,i.match_available=0,t.next_in=c,t.input=l,t.avail_in=s,i.wrap=r,Pr},pv={deflateInit:(t,e)=>QU(t,e,lb,15,8,yH),deflateInit2:QU,deflateReset:XU,deflateResetKeep:YU,deflateSetHeader:(t,e)=>hv(t)||t.state.wrap!==2?wc:(t.state.gzhead=e,Pr),deflate:NH,deflateEnd:t=>{if(hv(t))return wc;const e=t.state.status;return t.state=null,e===Qh?Jh(t,EH):Pr},deflateSetDictionary:DH,deflateInfo:"pako deflate (from Nodeca project)"};const PH=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var db={assign:function(t){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const n=e.shift();if(n){if(typeof n!="object")throw new TypeError(n+"must be non-object");for(const i in n)PH(n,i)&&(t[i]=n[i])}}return t},flattenChunks:t=>{let e=0;for(let i=0,r=t.length;i<r;i++)e+=t[i].length;const n=new Uint8Array(e);for(let i=0,r=0,s=t.length;i<s;i++){let c=t[i];n.set(c,r),r+=c.length}return n}};let JU=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{JU=!1}const fv=new Uint8Array(256);for(let t=0;t<256;t++)fv[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;fv[254]=fv[254]=1;var mv={string2buf:t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let e,n,i,r,s,c=t.length,l=0;for(r=0;r<c;r++)n=t.charCodeAt(r),(64512&n)==55296&&r+1<c&&(i=t.charCodeAt(r+1),(64512&i)==56320&&(n=65536+(n-55296<<10)+(i-56320),r++)),l+=n<128?1:n<2048?2:n<65536?3:4;for(e=new Uint8Array(l),s=0,r=0;s<l;r++)n=t.charCodeAt(r),(64512&n)==55296&&r+1<c&&(i=t.charCodeAt(r+1),(64512&i)==56320&&(n=65536+(n-55296<<10)+(i-56320),r++)),n<128?e[s++]=n:n<2048?(e[s++]=192|n>>>6,e[s++]=128|63&n):n<65536?(e[s++]=224|n>>>12,e[s++]=128|n>>>6&63,e[s++]=128|63&n):(e[s++]=240|n>>>18,e[s++]=128|n>>>12&63,e[s++]=128|n>>>6&63,e[s++]=128|63&n);return e},buf2string:(t,e)=>{const n=e||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,e));let i,r;const s=new Array(2*n);for(r=0,i=0;i<n;){let c=t[i++];if(c<128){s[r++]=c;continue}let l=fv[c];if(l>4)s[r++]=65533,i+=l-1;else{for(c&=l===2?31:l===3?15:7;l>1&&i<n;)c=c<<6|63&t[i++],l--;l>1?s[r++]=65533:c<65536?s[r++]=c:(c-=65536,s[r++]=55296|c>>10&1023,s[r++]=56320|1023&c)}}return((c,l)=>{if(l<65534&&c.subarray&&JU)return String.fromCharCode.apply(null,c.length===l?c:c.subarray(0,l));let d="";for(let h=0;h<l;h++)d+=String.fromCharCode(c[h]);return d})(s,r)},utf8border:(t,e)=>{(e=e||t.length)>t.length&&(e=t.length);let n=e-1;for(;n>=0&&(192&t[n])==128;)n--;return n<0||n===0?e:n+fv[t[n]]>e?n:e}},ZU=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const $U=Object.prototype.toString,{Z_NO_FLUSH:kH,Z_SYNC_FLUSH:LH,Z_FULL_FLUSH:xH,Z_FINISH:MH,Z_OK:ub,Z_STREAM_END:UH,Z_DEFAULT_COMPRESSION:VH,Z_DEFAULT_STRATEGY:jH,Z_DEFLATED:BH}=ob;function hb(t){this.options=db.assign({level:VH,method:BH,chunkSize:16384,windowBits:15,memLevel:8,strategy:jH},t||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ZU,this.strm.avail_out=0;let n=pv.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(n!==ub)throw new Error(Yh[n]);if(e.header&&pv.deflateSetHeader(this.strm,e.header),e.dictionary){let i;if(i=typeof e.dictionary=="string"?mv.string2buf(e.dictionary):$U.call(e.dictionary)==="[object ArrayBuffer]"?new Uint8Array(e.dictionary):e.dictionary,n=pv.deflateSetDictionary(this.strm,i),n!==ub)throw new Error(Yh[n]);this._dict_set=!0}}function FH(t,e){const n=new hb(e);if(n.push(t,!0),n.err)throw n.msg||Yh[n.err];return n.result}hb.prototype.push=function(t,e){const n=this.strm,i=this.options.chunkSize;let r,s;if(this.ended)return!1;for(s=e===~~e?e:e===!0?MH:kH,typeof t=="string"?n.input=mv.string2buf(t):$U.call(t)==="[object ArrayBuffer]"?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;)if(n.avail_out===0&&(n.output=new Uint8Array(i),n.next_out=0,n.avail_out=i),(s===LH||s===xH)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(r=pv.deflate(n,s),r===UH)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),r=pv.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===ub;if(n.avail_out!==0){if(s>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(n.avail_in===0)break}else this.onData(n.output)}return!0},hb.prototype.onData=function(t){this.chunks.push(t)},hb.prototype.onEnd=function(t){t===ub&&(this.result=db.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var GH={deflate:FH};const pb=16209;var HH=function(t,e){let n,i,r,s,c,l,d,h,p,m,_,E,I,C,w,D,N,L,W,G,U,z,$,rt;const dt=t.state;n=t.next_in,$=t.input,i=n+(t.avail_in-5),r=t.next_out,rt=t.output,s=r-(e-t.avail_out),c=r+(t.avail_out-257),l=dt.dmax,d=dt.wsize,h=dt.whave,p=dt.wnext,m=dt.window,_=dt.hold,E=dt.bits,I=dt.lencode,C=dt.distcode,w=(1<<dt.lenbits)-1,D=(1<<dt.distbits)-1;t:do{E<15&&(_+=$[n++]<<E,E+=8,_+=$[n++]<<E,E+=8),N=I[_&w];e:for(;;){if(L=N>>>24,_>>>=L,E-=L,L=N>>>16&255,L===0)rt[r++]=65535&N;else{if(!(16&L)){if((64&L)==0){N=I[(65535&N)+(_&(1<<L)-1)];continue e}if(32&L){dt.mode=16191;break t}t.msg="invalid literal/length code",dt.mode=pb;break t}W=65535&N,L&=15,L&&(E<L&&(_+=$[n++]<<E,E+=8),W+=_&(1<<L)-1,_>>>=L,E-=L),E<15&&(_+=$[n++]<<E,E+=8,_+=$[n++]<<E,E+=8),N=C[_&D];n:for(;;){if(L=N>>>24,_>>>=L,E-=L,L=N>>>16&255,!(16&L)){if((64&L)==0){N=C[(65535&N)+(_&(1<<L)-1)];continue n}t.msg="invalid distance code",dt.mode=pb;break t}if(G=65535&N,L&=15,E<L&&(_+=$[n++]<<E,E+=8,E<L&&(_+=$[n++]<<E,E+=8)),G+=_&(1<<L)-1,G>l){t.msg="invalid distance too far back",dt.mode=pb;break t}if(_>>>=L,E-=L,L=r-s,G>L){if(L=G-L,L>h&&dt.sane){t.msg="invalid distance too far back",dt.mode=pb;break t}if(U=0,z=m,p===0){if(U+=d-L,L<W){W-=L;do rt[r++]=m[U++];while(--L);U=r-G,z=rt}}else if(p<L){if(U+=d+p-L,L-=p,L<W){W-=L;do rt[r++]=m[U++];while(--L);if(U=0,p<W){L=p,W-=L;do rt[r++]=m[U++];while(--L);U=r-G,z=rt}}}else if(U+=p-L,L<W){W-=L;do rt[r++]=m[U++];while(--L);U=r-G,z=rt}for(;W>2;)rt[r++]=z[U++],rt[r++]=z[U++],rt[r++]=z[U++],W-=3;W&&(rt[r++]=z[U++],W>1&&(rt[r++]=z[U++]))}else{U=r-G;do rt[r++]=rt[U++],rt[r++]=rt[U++],rt[r++]=rt[U++],W-=3;while(W>2);W&&(rt[r++]=rt[U++],W>1&&(rt[r++]=rt[U++]))}break}}break}}while(n<i&&r<c);W=E>>3,n-=W,E-=W<<3,_&=(1<<E)-1,t.next_in=n,t.next_out=r,t.avail_in=n<i?i-n+5:5-(n-i),t.avail_out=r<c?c-r+257:257-(r-c),dt.hold=_,dt.bits=E};const fb=15,WH=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),zH=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),qH=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),KH=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var _v=(t,e,n,i,r,s,c,l)=>{const d=l.bits;let h,p,m,_,E,I,C=0,w=0,D=0,N=0,L=0,W=0,G=0,U=0,z=0,$=0,rt=null;const dt=new Uint16Array(16),ae=new Uint16Array(16);let se,zt,ke,De=null;for(C=0;C<=fb;C++)dt[C]=0;for(w=0;w<i;w++)dt[e[n+w]]++;for(L=d,N=fb;N>=1&&dt[N]===0;N--);if(L>N&&(L=N),N===0)return r[s++]=20971520,r[s++]=20971520,l.bits=1,0;for(D=1;D<N&&dt[D]===0;D++);for(L<D&&(L=D),U=1,C=1;C<=fb;C++)if(U<<=1,U-=dt[C],U<0)return-1;if(U>0&&(t===0||N!==1))return-1;for(ae[1]=0,C=1;C<fb;C++)ae[C+1]=ae[C]+dt[C];for(w=0;w<i;w++)e[n+w]!==0&&(c[ae[e[n+w]]++]=w);if(t===0?(rt=De=c,I=20):t===1?(rt=WH,De=zH,I=257):(rt=qH,De=KH,I=0),$=0,w=0,C=D,E=s,W=L,G=0,m=-1,z=1<<L,_=z-1,t===1&&z>852||t===2&&z>592)return 1;for(;;){se=C-G,c[w]+1<I?(zt=0,ke=c[w]):c[w]>=I?(zt=De[c[w]-I],ke=rt[c[w]-I]):(zt=96,ke=0),h=1<<C-G,p=1<<W,D=p;do p-=h,r[E+($>>G)+p]=se<<24|zt<<16|ke|0;while(p!==0);for(h=1<<C-1;$&h;)h>>=1;if(h!==0?($&=h-1,$+=h):$=0,w++,--dt[C]==0){if(C===N)break;C=e[n+c[w]]}if(C>L&&($&_)!==m){for(G===0&&(G=L),E+=D,W=C-G,U=1<<W;W+G<N&&(U-=dt[W+G],!(U<=0));)W++,U<<=1;if(z+=1<<W,t===1&&z>852||t===2&&z>592)return 1;m=$&_,r[m]=L<<24|W<<16|E-s|0}}return $!==0&&(r[E+$]=C-G<<24|64<<16|0),l.bits=L,0};const{Z_FINISH:tV,Z_BLOCK:YH,Z_TREES:mb,Z_OK:Zh,Z_STREAM_END:XH,Z_NEED_DICT:QH,Z_STREAM_ERROR:Fs,Z_DATA_ERROR:eV,Z_MEM_ERROR:nV,Z_BUF_ERROR:JH,Z_DEFLATED:iV}=ob,_b=16180,Eb=16190,Nl=16191,kI=16192,LI=16194,gb=16199,vb=16200,xI=16206,_i=16209,rV=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function ZH(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const $h=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.mode<_b||e.mode>16211?1:0},aV=t=>{if($h(t))return Fs;const e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=_b,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(852),e.distcode=e.distdyn=new Int32Array(592),e.sane=1,e.back=-1,Zh},sV=t=>{if($h(t))return Fs;const e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,aV(t)},oV=(t,e)=>{let n;if($h(t))return Fs;const i=t.state;return e<0?(n=0,e=-e):(n=5+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?Fs:(i.window!==null&&i.wbits!==e&&(i.window=null),i.wrap=n,i.wbits=e,sV(t))},cV=(t,e)=>{if(!t)return Fs;const n=new ZH;t.state=n,n.strm=t,n.window=null,n.mode=_b;const i=oV(t,e);return i!==Zh&&(t.state=null),i};let MI,UI,lV=!0;const $H=t=>{if(lV){MI=new Int32Array(512),UI=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(_v(1,t.lens,0,288,MI,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;_v(2,t.lens,0,32,UI,0,t.work,{bits:5}),lV=!1}t.lencode=MI,t.lenbits=9,t.distcode=UI,t.distbits=5},dV=(t,e,n,i)=>{let r;const s=t.state;return s.window===null&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),i>=s.wsize?(s.window.set(e.subarray(n-s.wsize,n),0),s.wnext=0,s.whave=s.wsize):(r=s.wsize-s.wnext,r>i&&(r=i),s.window.set(e.subarray(n-i,n-i+r),s.wnext),(i-=r)?(s.window.set(e.subarray(n-i,n),0),s.wnext=i,s.whave=s.wsize):(s.wnext+=r,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=r))),0};var tW=(t,e)=>{let n,i,r,s,c,l,d,h,p,m,_,E,I,C,w,D,N,L,W,G,U,z,$=0;const rt=new Uint8Array(4);let dt,ae;const se=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if($h(t)||!t.output||!t.input&&t.avail_in!==0)return Fs;n=t.state,n.mode===Nl&&(n.mode=kI),c=t.next_out,r=t.output,d=t.avail_out,s=t.next_in,i=t.input,l=t.avail_in,h=n.hold,p=n.bits,m=l,_=d,z=Zh;t:for(;;)switch(n.mode){case _b:if(n.wrap===0){n.mode=kI;break}for(;p<16;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}if(2&n.wrap&&h===35615){n.wbits===0&&(n.wbits=15),n.check=0,rt[0]=255&h,rt[1]=h>>>8&255,n.check=yr(n.check,rt,2,0),h=0,p=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&h)<<8)+(h>>8))%31){t.msg="incorrect header check",n.mode=_i;break}if((15&h)!==iV){t.msg="unknown compression method",n.mode=_i;break}if(h>>>=4,p-=4,U=8+(15&h),n.wbits===0&&(n.wbits=U),U>15||U>n.wbits){t.msg="invalid window size",n.mode=_i;break}n.dmax=1<<n.wbits,n.flags=0,t.adler=n.check=1,n.mode=512&h?16189:Nl,h=0,p=0;break;case 16181:for(;p<16;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}if(n.flags=h,(255&pr(n))!==iV){t.msg="unknown compression method",n.mode=_i;break}if(57344&pr(n)){t.msg="unknown header flags set",n.mode=_i;break}n.head&&(n.head.text=h>>8&1),512&pr(n)&&4&n.wrap&&(rt[0]=255&h,rt[1]=h>>>8&255,n.check=yr(n.check,rt,2,0)),h=0,p=0,n.mode=16182;case 16182:for(;p<32;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}n.head&&(n.head.time=h),512&pr(n)&&4&n.wrap&&(rt[0]=255&h,rt[1]=h>>>8&255,rt[2]=h>>>16&255,rt[3]=h>>>24&255,n.check=yr(n.check,rt,4,0)),h=0,p=0,n.mode=16183;case 16183:for(;p<16;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}n.head&&(n.head.xflags=255&h,n.head.os=h>>8),512&pr(n)&&4&n.wrap&&(rt[0]=255&h,rt[1]=h>>>8&255,n.check=yr(n.check,rt,2,0)),h=0,p=0,n.mode=16184;case 16184:if(1024&pr(n)){for(;p<16;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}n.length=h,n.head&&(n.head.extra_len=h),512&pr(n)&&4&n.wrap&&(rt[0]=255&h,rt[1]=h>>>8&255,n.check=yr(n.check,rt,2,0)),h=0,p=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&pr(n)&&(E=n.length,E>l&&(E=l),E&&(n.head&&(U=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(i.subarray(s,s+E),U)),512&pr(n)&&4&n.wrap&&(n.check=yr(n.check,i,E,s)),l-=E,s+=E,n.length-=E),n.length))break t;n.length=0,n.mode=16186;case 16186:if(2048&pr(n)){if(l===0)break t;E=0;do U=i[s+E++],n.head&&U&&n.length<65536&&(n.head.name+=String.fromCharCode(U));while(U&&E<l);if(512&pr(n)&&4&n.wrap&&(n.check=yr(n.check,i,E,s)),l-=E,s+=E,U)break t}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&pr(n)){if(l===0)break t;E=0;do U=i[s+E++],n.head&&U&&n.length<65536&&(n.head.comment+=String.fromCharCode(U));while(U&&E<l);if(512&pr(n)&&4&n.wrap&&(n.check=yr(n.check,i,E,s)),l-=E,s+=E,U)break t}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&pr(n)){for(;p<16;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}if(4&n.wrap&&h!==(65535&n.check)){t.msg="header crc mismatch",n.mode=_i;break}h=0,p=0}n.head&&(n.head.hcrc=pr(n)>>9&1,n.head.done=!0),t.adler=n.check=0,n.mode=Nl;break;case 16189:for(;p<32;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}t.adler=n.check=rV(h),h=0,p=0,n.mode=Eb;case Eb:if(n.havedict===0)return t.next_out=c,t.avail_out=d,t.next_in=s,t.avail_in=l,n.hold=h,n.bits=p,QH;t.adler=n.check=1,n.mode=Nl;case Nl:if(e===YH||e===mb)break t;case kI:if(n.last){h>>>=7&p,p-=7&p,n.mode=xI;break}for(;p<3;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}switch(n.last=1&h,h>>>=1,p-=1,3&h){case 0:n.mode=16193;break;case 1:if($H(n),n.mode=gb,e===mb){h>>>=2,p-=2;break t}break;case 2:n.mode=16196;break;case 3:t.msg="invalid block type",n.mode=_i}h>>>=2,p-=2;break;case 16193:for(h>>>=7&p,p-=7&p;p<32;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}if((65535&h)!=(h>>>16^65535)){t.msg="invalid stored block lengths",n.mode=_i;break}if(n.length=65535&h,h=0,p=0,n.mode=LI,e===mb)break t;case LI:n.mode=16195;case 16195:if(E=n.length,E){if(E>l&&(E=l),E>d&&(E=d),E===0)break t;r.set(i.subarray(s,s+E),c),l-=E,s+=E,d-=E,c+=E,n.length-=E;break}n.mode=Nl;break;case 16196:for(;p<14;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}if(n.nlen=257+(31&h),h>>>=5,p-=5,n.ndist=1+(31&h),h>>>=5,p-=5,n.ncode=4+(15&h),h>>>=4,p-=4,n.nlen>286||n.ndist>30){t.msg="too many length or distance symbols",n.mode=_i;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;p<3;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}n.lens[se[n.have++]]=7&h,h>>>=3,p-=3}for(;n.have<19;)n.lens[se[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,dt={bits:n.lenbits},z=_v(0,n.lens,0,19,n.lencode,0,n.work,dt),n.lenbits=dt.bits,z){t.msg="invalid code lengths set",n.mode=_i;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;$=n.lencode[h&(1<<n.lenbits)-1],w=$>>>24,D=$>>>16&255,N=65535&$,!(w<=p);){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}if(N<16)h>>>=w,p-=w,n.lens[n.have++]=N;else{if(N===16){for(ae=w+2;p<ae;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}if(h>>>=w,p-=w,n.have===0){t.msg="invalid bit length repeat",n.mode=_i;break}U=n.lens[n.have-1],E=3+(3&h),h>>>=2,p-=2}else if(N===17){for(ae=w+3;p<ae;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}h>>>=w,p-=w,U=0,E=3+(7&h),h>>>=3,p-=3}else{for(ae=w+7;p<ae;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}h>>>=w,p-=w,U=0,E=11+(127&h),h>>>=7,p-=7}if(n.have+E>n.nlen+n.ndist){t.msg="invalid bit length repeat",n.mode=_i;break}for(;E--;)n.lens[n.have++]=U}}if(n.mode===_i)break;if(n.lens[256]===0){t.msg="invalid code -- missing end-of-block",n.mode=_i;break}if(n.lenbits=9,dt={bits:n.lenbits},z=_v(1,n.lens,0,n.nlen,n.lencode,0,n.work,dt),n.lenbits=dt.bits,z){t.msg="invalid literal/lengths set",n.mode=_i;break}if(n.distbits=6,n.distcode=n.distdyn,dt={bits:n.distbits},z=_v(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,dt),n.distbits=dt.bits,z){t.msg="invalid distances set",n.mode=_i;break}if(n.mode=gb,e===mb)break t;case gb:n.mode=vb;case vb:if(l>=6&&d>=258){t.next_out=c,t.avail_out=d,t.next_in=s,t.avail_in=l,n.hold=h,n.bits=p,HH(t,_),c=t.next_out,r=t.output,d=t.avail_out,s=t.next_in,i=t.input,l=t.avail_in,h=n.hold,p=n.bits,n.mode===Nl&&(n.back=-1);break}for(n.back=0;$=n.lencode[h&(1<<n.lenbits)-1],w=$>>>24,D=$>>>16&255,N=65535&$,!(w<=p);){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}if(D&&(240&D)==0){for(L=w,W=D,G=N;$=n.lencode[G+((h&(1<<L+W)-1)>>L)],w=$>>>24,D=$>>>16&255,N=65535&$,!(L+w<=p);){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}h>>>=L,p-=L,n.back+=L}if(h>>>=w,p-=w,n.back+=w,n.length=N,D===0){n.mode=16205;break}if(32&D){n.back=-1,n.mode=Nl;break}if(64&D){t.msg="invalid literal/length code",n.mode=_i;break}n.extra=15&D,n.mode=16201;case 16201:if(n.extra){for(ae=n.extra;p<ae;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}n.length+=h&(1<<n.extra)-1,h>>>=n.extra,p-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;$=n.distcode[h&(1<<n.distbits)-1],w=$>>>24,D=$>>>16&255,N=65535&$,!(w<=p);){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}if((240&D)==0){for(L=w,W=D,G=N;$=n.distcode[G+((h&(1<<L+W)-1)>>L)],w=$>>>24,D=$>>>16&255,N=65535&$,!(L+w<=p);){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}h>>>=L,p-=L,n.back+=L}if(h>>>=w,p-=w,n.back+=w,64&D){t.msg="invalid distance code",n.mode=_i;break}n.offset=N,n.extra=15&D,n.mode=16203;case 16203:if(n.extra){for(ae=n.extra;p<ae;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}n.offset+=h&(1<<n.extra)-1,h>>>=n.extra,p-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){t.msg="invalid distance too far back",n.mode=_i;break}n.mode=16204;case 16204:if(d===0)break t;if(E=_-d,n.offset>E){if(E=n.offset-E,E>n.whave&&n.sane){t.msg="invalid distance too far back",n.mode=_i;break}E>n.wnext?(E-=n.wnext,I=n.wsize-E):I=n.wnext-E,E>n.length&&(E=n.length),C=n.window}else C=r,I=c-n.offset,E=n.length;E>d&&(E=d),d-=E,n.length-=E;do r[c++]=C[I++];while(--E);n.length===0&&(n.mode=vb);break;case 16205:if(d===0)break t;r[c++]=n.length,d--,n.mode=vb;break;case xI:if(n.wrap){for(;p<32;){if(l===0)break t;l--,h|=i[s++]<<p,p+=8}if(_-=d,t.total_out+=_,n.total+=_,4&n.wrap&&_&&(t.adler=n.check=pr(n)?yr(n.check,r,_,c-_):cv(n.check,r,_,c-_)),_=d,4&n.wrap&&(pr(n)?h:rV(h))!==n.check){t.msg="incorrect data check",n.mode=_i;break}h=0,p=0}n.mode=16207;case 16207:if(n.wrap&&pr(n)){for(;p<32;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}if(4&n.wrap&&h!==(4294967295&n.total)){t.msg="incorrect length check",n.mode=_i;break}h=0,p=0}n.mode=16208;case 16208:z=XH;break t;case _i:z=eV;break t;case 16210:return nV;default:return Fs}return t.next_out=c,t.avail_out=d,t.next_in=s,t.avail_in=l,n.hold=h,n.bits=p,(n.wsize||_!==t.avail_out&&n.mode<_i&&(n.mode<xI||e!==tV))&&dV(t,t.output,t.next_out,_-t.avail_out),m-=t.avail_in,_-=t.avail_out,t.total_in+=m,t.total_out+=_,n.total+=_,4&n.wrap&&_&&(t.adler=n.check=pr(n)?yr(n.check,r,_,t.next_out-_):cv(n.check,r,_,t.next_out-_)),t.data_type=n.bits+(n.last?64:0)+(n.mode===Nl?128:0)+(n.mode===gb||n.mode===LI?256:0),(m===0&&_===0||e===tV)&&z===Zh&&(z=JH),z},Dl={inflateReset:sV,inflateReset2:oV,inflateResetKeep:aV,inflateInit:t=>cV(t,15),inflateInit2:cV,inflate:tW,inflateEnd:t=>{if($h(t))return Fs;let e=t.state;return e.window&&(e.window=null),t.state=null,Zh},inflateGetHeader:(t,e)=>{if($h(t))return Fs;const n=t.state;return(2&n.wrap)==0?Fs:(n.head=e,e.done=!1,Zh)},inflateSetDictionary:(t,e)=>{const n=e.length;let i,r,s;return $h(t)?Fs:(i=t.state,i.wrap!==0&&i.mode!==Eb?Fs:i.mode===Eb&&(r=1,r=cv(r,e,n,0),r!==i.check)?eV:(s=dV(t,e,n,n),s?(i.mode=16210,nV):(i.havedict=1,Zh)))},inflateInfo:"pako inflate (from Nodeca project)"},eW=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const uV=Object.prototype.toString,{Z_NO_FLUSH:nW,Z_FINISH:iW,Z_OK:Ev,Z_STREAM_END:VI,Z_NEED_DICT:jI,Z_STREAM_ERROR:rW,Z_DATA_ERROR:hV,Z_MEM_ERROR:aW}=ob;function Sb(t){this.options=db.assign({chunkSize:65536,windowBits:15,to:""},t||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(15&e.windowBits)==0&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ZU,this.strm.avail_out=0;let n=Dl.inflateInit2(this.strm,e.windowBits);if(n!==Ev)throw new Error(Yh[n]);if(this.header=new eW,Dl.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=mv.string2buf(e.dictionary):uV.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(n=Dl.inflateSetDictionary(this.strm,e.dictionary),n!==Ev)))throw new Error(Yh[n])}function sW(t,e){const n=new Sb(e);if(n.push(t),n.err)throw n.msg||Yh[n.err];return n.result}Sb.prototype.push=function(t,e){const n=this.strm,i=this.options.chunkSize,r=this.options.dictionary;let s,c,l;if(this.ended)return!1;for(c=e===~~e?e:e===!0?iW:nW,uV.call(t)==="[object ArrayBuffer]"?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;){for(n.avail_out===0&&(n.output=new Uint8Array(i),n.next_out=0,n.avail_out=i),s=Dl.inflate(n,c),s===jI&&r&&(s=Dl.inflateSetDictionary(n,r),s===Ev?s=Dl.inflate(n,c):s===hV&&(s=jI));n.avail_in>0&&s===VI&&n.state.wrap>0&&t[n.next_in]!==0;)Dl.inflateReset(n),s=Dl.inflate(n,c);switch(s){case rW:case hV:case jI:case aW:return this.onEnd(s),this.ended=!0,!1}if(l=n.avail_out,n.next_out&&(n.avail_out===0||s===VI))if(this.options.to==="string"){let d=mv.utf8border(n.output,n.next_out),h=n.next_out-d,p=mv.buf2string(n.output,d);n.next_out=h,n.avail_out=i-h,h&&n.output.set(n.output.subarray(d,d+h),0),this.onData(p)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(s!==Ev||l!==0){if(s===VI)return s=Dl.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(n.avail_in===0)break}}return!0},Sb.prototype.onData=function(t){this.chunks.push(t)},Sb.prototype.onEnd=function(t){t===Ev&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=db.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var oW={inflate:sW};const{deflate:cW}=GH,{inflate:lW}=oW;var dW=cW,uW=lW,pV=function(t){return t[t.ONE_BYTE=0]="ONE_BYTE",t[t.TWO_BYTE=1]="TWO_BYTE",t}(pV||{});class hW{constructor(){O(this,"_sequence",0),O(this,"_startTime",Date.now()),O(this,"isUseOneByte",!0)}get startTime(){const e=Date.now()-this._startTime;return e<Math.pow(2,16)?e:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(e){const n={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:e};if(e.byteLength>128){const l=new Uint8Array(4);l.set([1,0,0,0]);const d={id:0,length:4,data:l.buffer},h={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[d]};n.commonPacketHeader.extension=1,n.extension=h,n.payload=this.compress(e),n.commonPacketHeader.length=8+(n.extension.length+2)+n.payload.byteLength}else n.commonPacketHeader.length=8+n.payload.byteLength;k("SHOW_DATASTREAM2_LOG")&&T.debug("send data header: ".concat(JSON.stringify(n.commonPacketHeader)));const i=new ArrayBuffer(n.commonPacketHeader.length),r=new Uint8Array(i),s=new DataView(i);let c=0;if(s.setUint16(c,n.commonPacketHeader.extension<<15|n.commonPacketHeader.reserved<<14|n.commonPacketHeader.length,!0),c+=2,s.setUint32(c,n.commonPacketHeader.sequence,!0),c+=4,s.setUint16(c,n.commonStreamHeader,!0),c+=2,n.extension){const l=this.serializeExtension(n.extension);r.set(new Uint8Array(l),c),c+=l.byteLength}if(r.set(new Uint8Array(n.payload),c),c+=n.payload.byteLength,c!==n.commonPacketHeader.length)throw Error("serialize error!");return i}deserialize(e){if(e.byteLength<4)return new ArrayBuffer(0);const n=new DataView(e);let i=0;const r=n.getUint16(i,!0);i+=2;const s={length:16383&r,reserved:(16384&r)>>14,extension:(32768&r)>>15,sequence:n.getUint16(i+2,!0)<<16|n.getUint16(i,!0)};let c,l;if(i+=4,k("SHOW_DATASTREAM2_LOG")&&T.debug("receive data header: ".concat(JSON.stringify(s))),n.getUint16(i,!0),i+=2,s.extension){l=this.deserializeExtension(e.slice(i)),i+=2+l.length,c=e.slice(i);let d=!1;if(l.datas.length>0){const h=l.datas.find(p=>p.id===0);h&&(d=(1&new DataView(h.data).getUint32(0,!0))==1)}c=d?this.decompress(c):c}else c=e.slice(8);return c}serializeExtension(e){const{profile:n,length:i,datas:r}=e,s=new ArrayBuffer(i+2),c=new Uint8Array(s),l=new DataView(s);let d=0;if(l.setUint8(d++,n),l.setUint8(d++,i),r.forEach(h=>{n?(l.setUint8(d++,h.id),l.setUint8(d++,h.length),c.set(new Uint8Array(h.data),d),d+=h.data.byteLength):(l.setUint8(d++,h.id|h.length<<4),c.set(new Uint8Array(h.data),d),d+=h.data.byteLength)}),d!==i+2)throw Error("serialize extension error, is ".concat(d,"!==").concat(i+2));return s}deserializeExtension(e){const n=new DataView(e);let i=0;const r=n.getUint8(i);i++;const s=n.getUint8(i);i++;const c=r===pV.TWO_BYTE,l=[],d=new DataView(e,2);let h=0;for(;h<s;){let p=0,m=0,_=new ArrayBuffer(0);c?(p=d.getUint8(h),h++,m=d.getUint8(h),h++):(p=15&d.getUint8(h),m=d.getUint8(h)>>4,h++),m>0&&(_=d.buffer.slice(h+2,h+2+m),h+=_.byteLength),l.push({id:p,length:m,data:_})}if(h!==s)throw Error("parse error");return{profile:r,length:s,datas:l}}decompress(e){return uW(new Uint8Array(e))}compress(e){return dW(new Uint8Array(e))}}const pW={name:"DataStream",create:(t,e)=>{const n=e?new SG(t):new TG(t);return n.useDataStream(new hW),n}};class fW extends Sn{constructor(e,n,i){super(),O(this,"ws",void 0),O(this,"requestId",1),O(this,"heartBeatTimer",void 0),O(this,"joinInfo",void 0),O(this,"clientId",void 0),O(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),O(this,"onClose",r=>{this.emit("close"),this.dispose()}),O(this,"onMessage",r=>{const s=JSON.parse(r.data);if(!s||s.command!=="serverResponse"||!s.requestId)return s&&s.command==="serverStatus"&&s.serverStatus&&s.serverStatus.command?(this.emit("status",s.serverStatus),void this.emit(s.serverStatus.command,s.serverStatus)):void 0;this.emit("req_".concat(s.requestId),s)}),this.joinInfo=e,this.clientId=n,this.ws=new Hg("cross-channel-".concat(this.clientId),i),this.ws.on(ee.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(ee.CONNECTED,this.onOpen),this.ws.on(ee.ON_MESSAGE,this.onMessage),this.ws.on(ee.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(e){const n=this.requestId++;return e.requestId=n,e.seq=n,this.ws.sendMessage(e),n}waitStatus(e){return new Tt((n,i)=>{const r=window.setTimeout(()=>{i(new K(P.TIMEOUT,"wait status timeout, status: ".concat(e)))},5e3);this.once(e,s=>{window.clearTimeout(r),s.state&&s.state!==0?i(new K(P.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(e))):n(void 0)}),this.once("dispose",()=>{window.clearTimeout(r),i(new K(P.WS_ABORT))})})}async request(e){if(this.ws.state==="closed")throw new K(P.WS_DISCONNECT);const n=()=>new Tt((c,l)=>{this.ws.once(ee.CLOSED,()=>l(new K(P.WS_ABORT))),this.ws.once(ee.CONNECTED,c)});this.ws.state!=="connected"&&await n();const i=this.sendMessage(e),r=new Tt((c,l)=>{const d=()=>{l(new K(P.WS_ABORT))};this.ws.once(ee.RECONNECTING,d),this.ws.once(ee.CLOSED,d),this.once("req_".concat(i),c),yi(3e3).then(()=>{this.removeAllListeners("req_".concat(i)),this.ws.off(ee.RECONNECTING,d),this.ws.off(ee.CLOSED,d),l(new K(P.TIMEOUT,"cross channel ws request timeout"))})}),s=await r;if(!s||s.code!==200)throw new K(P.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(s)));return s}async connect(e){this.ws.removeAllListeners(ee.REQUEST_NEW_URLS),this.ws.on(ee.REQUEST_NEW_URLS,n=>{n(e)}),await this.ws.init(e)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(e){const n=this.requestId++;return e.requestId=n,this.ws.sendMessage(e),n}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class mW extends Sn{set state(e){e!==this._state&&(e!==qr.RELAY_STATE_FAILURE&&(this.errorCode=Rm.RELAY_OK),this.emit("state",e,this.errorCode),this._state=e)}get state(){return this._state}constructor(e,n,i,r,s){super(),O(this,"joinInfo",void 0),O(this,"sid",void 0),O(this,"clientId",void 0),O(this,"cancelToken",Ir.CancelToken.source()),O(this,"workerToken",void 0),O(this,"requestId",0),O(this,"signal",void 0),O(this,"prevChannelMediaConfig",void 0),O(this,"httpRetryConfig",void 0),O(this,"_resolution",void 0),O(this,"_state",qr.RELAY_STATE_IDLE),O(this,"errorCode",Rm.RELAY_OK),O(this,"onStatus",c=>{T.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(c))),c&&c.command&&(c.command==="onAudioPacketReceived"&&this.emit("event",Cl.PACKET_RECEIVED_AUDIO_FROM_SRC),c.command==="onVideoPacketReceived"&&this.emit("event",Cl.PACKET_RECEIVED_VIDEO_FROM_SRC),c.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=Rm.SRC_TOKEN_EXPIRED,this.state=qr.RELAY_STATE_FAILURE),c.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=Rm.DEST_TOKEN_EXPIRED,this.state=qr.RELAY_STATE_FAILURE))}),O(this,"onReconnect",async()=>{T.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",Cl.NETWORK_DISCONNECTED),this.state=qr.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(c=>{this.state!==qr.RELAY_STATE_IDLE&&(T.error("auto restart channel media relay failed",c.toString()),this.errorCode=Rm.SERVER_CONNECTION_LOST,this.state=qr.RELAY_STATE_FAILURE)})}),this.joinInfo=e,this.clientId=n,this.sid=Lh(),this.signal=new fW(this.joinInfo,this.clientId,i),this.httpRetryConfig=r,this._resolution=s}async startChannelMediaRelay(e){if(this.state!==qr.RELAY_STATE_IDLE)throw new K(P.INVALID_OPERATION);this.state=qr.RELAY_STATE_CONNECTING,await this.connect(),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(e)}catch(n){throw n.data&&n.data.serverResponse&&n.data.serverResponse.command==="SetSourceChannel"?new K(P.CROSS_CHANNEL_FAILED_JOIN_SRC):n.data&&n.data.serverResponse&&n.serverResponse.command==="SetDestChannelStatus"?new K(P.CROSS_CHANNEL_FAILED_JOIN_DEST):n.data&&n.data.serverResponse&&n.serverResponse.command==="StartPacketTransfer"?new K(P.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):n}this.prevChannelMediaConfig=e}async updateChannelMediaRelay(e){if(this.state!==qr.RELAY_STATE_RUNNING)throw new K(P.INVALID_OPERATION);await this.sendUpdateMessage(e),this.prevChannelMediaConfig=e}async setVideoProfile(e){if(this._resolution=e,this.state!==qr.RELAY_STATE_RUNNING)throw new K(P.INVALID_OPERATION);const n=this.genMessage(Tr.SetVideoProfile);await this.signal.request(n),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),T.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=qr.RELAY_STATE_IDLE,this.dispose()}dispose(){T.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Ir.CancelToken.source(),this.state=qr.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const e=await A8(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=e.workerToken,await this.signal.connect(e.addressList),this.emit("event",Cl.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(e){const n=this.genMessage(Tr.StopPacketTransfer);await this.signal.request(n),await this.signal.waitStatus("Normal Quit"),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const i=this.genMessage(Tr.SetSdkProfile,e);await this.signal.request(i),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const r=this.genMessage(Tr.SetSourceChannel,e);await this.signal.request(r),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",Cl.PACKET_JOINED_SRC_CHANNEL),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const s=this.genMessage(Tr.SetSourceUserId,e);await this.signal.request(s),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const c=this.genMessage(Tr.SetDestChannel,e);await this.signal.request(c),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",Cl.PACKET_JOINED_DEST_CHANNEL),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const l=this.genMessage(Tr.StartPacketTransfer,e);await this.signal.request(l),this.emit("event",Cl.PACKET_SENT_TO_DEST_CHANNEL),this.state=qr.RELAY_STATE_RUNNING,T.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(e){const n=this.genMessage(Tr.UpdateDestChannel,e);await this.signal.request(n),this.emit("event",Cl.PACKET_UPDATE_DEST_CHANNEL),T.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const e=this.genMessage(Tr.StopPacketTransfer);await this.signal.request(e),T.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(e,n){const i=[],r=[],s=[];this.requestId+=1;const c={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:$a,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};c.sdkVersion==="4.24.0"&&(c.sdkVersion="0.0.1");let l=null,d=null;switch(e){case Tr.SetSdkProfile:return c.clientRequest={command:"SetSdkProfile",type:"multi_channel"},c;case Tr.SetSourceChannel:if(d=n&&n.getSrcChannelMediaInfo(),!d)throw new K(P.UNEXPECTED_ERROR,"can not find source config");return c.clientRequest={command:"SetSourceChannel",uid:"0",channelName:d.channelName,token:d.token||this.joinInfo.appId},c;case Tr.SetSourceUserId:if(d=n&&n.getSrcChannelMediaInfo(),!d)throw new K(P.UNEXPECTED_ERROR,"can not find source config");return c.clientRequest={command:"SetSourceUserId",uid:d.uid+""},c;case Tr.SetDestChannel:if(l=n&&n.getDestChannelMediaInfo(),!l)throw new K(P.UNEXPECTED_ERROR,"can not find dest config");return l.forEach(h=>{i.push(h.channelName),r.push(h.uid+""),s.push(h.token||this.joinInfo.appId)}),c.clientRequest={command:"SetDestChannel",channelName:i,uid:r,token:s},c;case Tr.StartPacketTransfer:return c.clientRequest={command:"StartPacketTransfer"},c;case Tr.Reconnect:return c.clientRequest={command:"Reconnect"},c;case Tr.StopPacketTransfer:return c.clientRequest={command:"StopPacketTransfer"},c;case Tr.UpdateDestChannel:if(l=n&&n.getDestChannelMediaInfo(),!l)throw new K(P.UNEXPECTED_ERROR,"can not find dest config");return l.forEach(h=>{i.push(h.channelName),r.push(h.uid+""),s.push(h.token||this.joinInfo.appId)}),c.clientRequest={command:"UpdateDestChannel",channelName:i,uid:r,token:s},c;case Tr.SetVideoProfile:c.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return c}}const _W={name:"ChannelMediaRelay",create:function(t){return new mW(t.joinInfo,t.clientId,t.websocketRetryConfig||Xn,t.httpRetryConfig||Xn,t.resolution)}};function fV(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function gv(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?fV(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):fV(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}class EW extends Sn{constructor(e,n,i,r){super(),O(this,"spec",void 0),O(this,"token",void 0),O(this,"websocket",void 0),O(this,"pingpongTimer",void 0),O(this,"reconnectMode","retry"),O(this,"serviceMode",void 0),O(this,"reqId",0),O(this,"commandReqId",0),O(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),O(this,"handleWebSocketMessage",s=>{if(!s.data)return;const c=JSON.parse(s.data);c.requestId?this.emit("@".concat(c.requestId,"-").concat(c.sid),c):(Pt.workerEvent(this.spec.sid,{actionType:"status",serverCode:c.code,workerType:this.serviceMode===bl.TRANSCODE?1:2}),this.emit(zd.PUBLISH_STREAM_STATUS,c))}),this.spec=n,this.token=e,this.serviceMode=r,this.websocket=new Hg("live-streaming",i),this.websocket.on(ee.CONNECTED,this.handleWebSocketOpen),this.websocket.on(ee.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(ee.REQUEST_NEW_URLS,(s,c)=>{ki(this,zd.REQUEST_NEW_ADDRESS).then(s).catch(c)}),this.websocket.on(ee.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(e){return this.websocket.init(e)}async request(e,n,i,r){this.reqId+=1,e==="request"&&(this.commandReqId+=1);const s=this.commandReqId,c=this.reqId;if(!c||!this.websocket)throw new K(P.UNEXPECTED_ERROR);const l=gv({command:e,sdkVersion:$a==="4.24.0"?"0.0.1":$a,seq:c,requestId:c,allocate:i,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},n);if(this.websocket.state==="closed")throw new K(P.WS_DISCONNECT);const d=()=>new Tt((_,E)=>{this.websocket.once(ee.CLOSED,()=>E(new K(P.WS_ABORT))),this.websocket.once(ee.CONNECTED,_)});this.websocket.state!=="connected"&&await d(),l.clientRequest&&(l.clientRequest.workerToken=this.token);const h=new Tt((_,E)=>{const I=()=>{E(new K(P.WS_ABORT))};this.websocket.once(ee.RECONNECTING,I),this.websocket.once(ee.CLOSED,I),this.once("@".concat(c,"-").concat(this.spec.sid),C=>{_(C)})});r&&Pt.workerEvent(this.spec.sid,gv(gv({},r),{},{requestId:s,actionType:"request",payload:JSON.stringify(n.clientRequest),serverCode:0,code:0}));const p=Date.now();this.websocket.sendMessage(l);let m=null;try{m=await h}catch(_){if(this.websocket.state==="closed")throw _;return await d(),await this.request(e,n,i)}return r&&Pt.workerEvent(this.spec.sid,gv(gv({},r),{},{requestId:s,actionType:"response",payload:JSON.stringify(m.serverResponse),serverCode:m.code,success:m.code===200,responseTime:Date.now()-p})),m.code!==200&&this.handleResponseError(m),m}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const e=$a==="4.24.0"?"0.0.1":$a;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:e,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(e){switch(e.code){case ti.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void T.warning("live stream response already exists stream");case ti.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case ti.LIVE_STREAM_RESPONSE_BAD_STREAM:case ti.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new K(P.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:e.code}).throw();case ti.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(e.serverResponse.command==="UnpublishStream")return;throw new K(P.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case ti.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new K(P.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:e.code}).throw();case ti.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const n=new K(P.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(zd.WARNING,n,e.serverResponse.url)}case ti.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const n=new K(P.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(zd.WARNING,n,e.serverResponse.url)}case ti.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new K(P.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case ti.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new K(P.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:e.code}).throw();case ti.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const n=new K(P.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(zd.WARNING,n,e.serverResponse.url)}case ti.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new K(P.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code}).throw();case ti.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new K(P.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case ti.LIVE_STREAM_RESPONSE_WORKER_LOST:case ti.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(e.serverResponse.command==="UnpublishStream")return;throw new K(P.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case ti.ERROR_FAIL_SEND_MESSAGE:if(e.serverResponse.command==="UnpublishStream")return;if(e.serverResponse.command==="UpdateTranscoding"||e.serverResponse.command==="ControlStream")return new K(P.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:e.code}).throw();throw new K(P.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case ti.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case ti.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case ti.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case ti.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new K(P.LIVE_STREAMING_CDN_ERROR,"",{code:e.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(aR)},6e3)}}function mV(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Kr(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?mV(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):mV(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}class gW extends Sn{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Xn,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Xn;super(),O(this,"onLiveStreamWarning",void 0),O(this,"onLiveStreamError",void 0),O(this,"spec",void 0),O(this,"retryTimeout",1e4),O(this,"connection",void 0),O(this,"httpRetryConfig",void 0),O(this,"wsRetryConfig",void 0),O(this,"streamingTasks",new Map),O(this,"isStartingStreamingTask",!1),O(this,"taskMutex",new Wi("live-streaming")),O(this,"cancelToken",Ir.CancelToken.source()),O(this,"transcodingConfig",void 0),O(this,"uapResponse",void 0),O(this,"lastTaskId",1),O(this,"statusError",new Map),this.spec=e,this.httpRetryConfig=i,this.wsRetryConfig=n}async setTranscodingConfig(e){const n=Kr(Kr({},r8),e);n.videoCodecProfile!==66&&n.videoCodecProfile!==77&&n.videoCodecProfile!==100&&(T.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(n.videoCodecProfile," -> 100")),n.videoCodecProfile=100),n.transcodingUsers||(n.transcodingUsers=n.userConfigs),n.transcodingUsers&&(n.transcodingUsers=n.transcodingUsers.map(c=>Kr(Kr(Kr({},i8),c),{},{zOrder:c.zOrder?c.zOrder+1:1}))),function(c){wn(c.width)||Ke(c.width,"config.width",0,1e4),wn(c.height)||Ke(c.height,"config.height",0,1e4),wn(c.videoBitrate)||Ke(c.videoBitrate,"config.videoBitrate",1,1e6),wn(c.videoFrameRate)||Ke(c.videoFrameRate,"config.videoFrameRate"),wn(c.lowLatency)||yo(c.lowLatency,"config.lowLatency"),wn(c.audioSampleRate)||ri(c.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),wn(c.audioBitrate)||Ke(c.audioBitrate,"config.audioBitrate",1,128),wn(c.audioChannels)||ri(c.audioChannels,"config.audioChannels",[1,2,3,4,5]),wn(c.videoGop)||Ke(c.videoGop,"config.videoGop"),wn(c.videoCodecProfile)||ri(c.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),wn(c.userCount)||Ke(c.userCount,"config.userCount",0,17),wn(c.backgroundColor)||Ke(c.backgroundColor,"config.backgroundColor",0,16777215),wn(c.userConfigExtraInfo)||Ti(c.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),c.transcodingUsers&&!wn(c.transcodingUsers)&&(Rl(c.transcodingUsers,"config.transcodingUsers"),c.transcodingUsers.forEach((l,d)=>{OR(l.uid),wn(l.x)||Ke(l.x,"transcodingUser[".concat(d,"].x"),0,1e4),wn(l.y)||Ke(l.y,"transcodingUser[".concat(d,"].y"),0,1e4),wn(l.width)||Ke(l.width,"transcodingUser[".concat(d,"].width"),0,1e4),wn(l.height)||Ke(l.height,"transcodingUser[".concat(d,"].height"),0,1e4),wn(l.zOrder)||Ke(l.zOrder-1,"transcodingUser[".concat(d,"].zOrder"),0,100),wn(l.alpha)||Ke(l.alpha,"transcodingUser[".concat(d,"].alpha"),0,1,!1)})),wn(c.watermark)||Vw(c.watermark,"watermark"),wn(c.backgroundImage)||Vw(c.backgroundImage,"backgroundImage"),c.images&&!wn(c.images)&&(Rl(c.images,"config.images"),c.images.forEach((l,d)=>{Vw(l,"images[".concat(d,"]"))}))}(n);const i=[];n.images&&i.push(...n.images.map(c=>Kr(Kr(Kr({},Uw),c),{},{zOrder:255}))),n.backgroundImage&&(i.push(Kr(Kr(Kr({},Uw),n.backgroundImage),{},{zOrder:0})),delete n.backgroundImage),n.watermark&&(i.push(Kr(Kr(Kr({},Uw),n.watermark),{},{zOrder:255})),delete n.watermark),n.images=i,n.transcodingUsers&&(n.userConfigs=n.transcodingUsers.map(c=>Kr({},c)),n.userCount=n.transcodingUsers.length,delete n.transcodingUsers);const r=(n.userConfigs||[]).map(c=>typeof c.uid=="number"?Tt.resolve(c.uid):FM(c.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await Tt.all(r)).forEach((c,l)=>{n.userConfigs&&n.userConfigs[l]&&(n.userConfigs[l].uid=c)}),this.transcodingConfig=n,this.connection)try{var s;const c=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(wr(s=this.streamingTasks).call(s)).map(l=>l.taskId).join("#")});T.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(c.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(c){if(!c.data||!c.data.retry)throw c;c.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(l=>{T.warning("[".concat(this.spec.clientId,"] live streaming receive error"),c.toString(),"try to republish",l.url),this.startLiveStreamingTask(l.url,l.mode,c).then(()=>{T.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(l.url," success"))}).catch(d=>{T.error("[".concat(this.spec.clientId,"] live streaming republish failed"),l.url,d.toString()),this.onLiveStreamError&&this.onLiveStreamError(l.url,d)})})}}async startLiveStreamingTask(e,n,i){if(!this.transcodingConfig&&n===bl.TRANSCODE)throw new K(P.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const r={command:"PublishStream",ts:Date.now(),url:e,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};T.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(e,", mode: ").concat(n));const s=await this.taskMutex.lock();if(!this.connection&&i)return void s();if(this.streamingTasks.get(e)&&!i)return s(),new K(P.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(n))}catch(l){throw s(),l}switch(n){case bl.TRANSCODE:r.transcodingConfig=Kr({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(r.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const c=this.lastTaskId++;try{const l=new Tt((h,p)=>{yi(this.retryTimeout).then(()=>{if(i)return p(i);const m=this.statusError.get(e);return m?(this.statusError.delete(e),p(m)):void 0})}),d=await Tt.race([this.connection.request("request",{clientRequest:r},!0,{url:e,command:"PublishStream",workerType:n===bl.TRANSCODE?1:2,requestByUser:!i,tid:c.toString()}),l]);this.isStartingStreamingTask=!1,T.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(d.code)),this.streamingTasks.set(e,{clientRequest:r,mode:n,url:e,taskId:c}),s()}catch(l){if(s(),this.isStartingStreamingTask=!1,!l.data||!l.data.retry||i)throw l;return l.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(e,n,l)):await this.startLiveStreamingTask(e,n,l)}}stopLiveStreamingTask(e){return new Tt((n,i)=>{const r=this.streamingTasks.get(e);if(!r||!this.connection)return new K(P.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const s=r.mode;r.abortTask=()=>{T.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(e),n()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:r.url}},!1,{url:e,command:"UnPublishStream",workerType:s===bl.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(c=>{T.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(c.code)),this.streamingTasks.delete(e),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),n()}).catch(i)})}resetAllTask(){var e;const n=Array.from(wr(e=this.streamingTasks).call(e));this.terminate();for(const i of n)this.startLiveStreamingTask(i.url,i.mode).catch(r=>{this.onLiveStreamError&&this.onLiveStreamError(i.url,r)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Ir.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(e){if(this.connection)throw new K(P.UNEXPECTED_ERROR,"live streaming connection has already connected");const n=await ki(this,jw.REQUEST_WORKER_MANAGER_LIST,e);return this.uapResponse=n,this.connection=new EW(n.workerToken,this.spec,this.wsRetryConfig,e),this.connection.on(zd.WARNING,(i,r)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(r,i)),this.connection.on(zd.PUBLISH_STREAM_STATUS,i=>this.handlePublishStreamServer(i)),this.connection.on(zd.REQUEST_NEW_ADDRESS,(i,r)=>{if(!this.connection)return r(new K(P.UNEXPECTED_ERROR,"can not get new live streaming address list"));ki(this,jw.REQUEST_WORKER_MANAGER_LIST,e).then(s=>{this.uapResponse=s,i(s.addressList)}).catch(r)}),await this.connection.init(n.addressList),this.connection}handlePublishStreamServer(e){const n=e.serverStatus&&e.serverStatus.url||"empty_url",i=this.streamingTasks.get(n),r=e.reason;switch(e.code){case ti.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case ti.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case ti.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case ti.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const c=new K(P.LIVE_STREAMING_CDN_ERROR,"",{code:e.code});if(i)return T.error(c.toString()),this.onLiveStreamError&&this.onLiveStreamError(n,c);if(!this.isStartingStreamingTask)return;this.statusError.set(n,c)}case ti.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const c=new K(P.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,r);return this.onLiveStreamWarning&&this.onLiveStreamWarning(n,c)}case ti.LIVE_STREAM_RESPONSE_WORKER_LOST:case ti.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var s;if(!this.connection)return;this.connection.tryNextAddress();const c=Array.from(wr(s=this.streamingTasks).call(s));for(const l of c)l.abortTask?l.abortTask():(T.warning("[".concat(this.spec.clientId,"] publish stream status code"),e.code,"try to republish",l.url),this.startLiveStreamingTask(l.url,l.mode,new K(P.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code})).then(()=>{T.debug("[".concat(this.spec.clientId,"] republish live stream success"),l.url)}).catch(d=>{T.error(d.toString()),this.onLiveStreamError&&this.onLiveStreamError(l.url,d)}));return}}}hasUrl(e){return this.streamingTasks.has(e)}}const vW={name:"LiveStreaming",create:function(t){return new gW(t.joinInfo,t.websocketRetryConfig||Xn,t.httpRetryConfig||Xn)}};function SW(t){let e=gV();return function(n,i){let r=n.appId;r!==void 0&&(je(i,10),Nc(i,r));let s=n.cid;s!==void 0&&(je(i,16),je(i,s));let c=n.cname;c!==void 0&&(je(i,26),Nc(i,c));let l=n.deviceId;l!==void 0&&(je(i,34),Nc(i,l));let d=n.elapse;d!==void 0&&(je(i,40),ou(i,d));let h=n.fileSize;h!==void 0&&(je(i,48),ou(i,Bm(h)));let p=n.height;p!==void 0&&(je(i,56),ou(i,Bm(p)));let m=n.jpg;m!==void 0&&(je(i,66),je(i,m.length),function(Xi,it){let ft=Fm(Xi,it.length);Xi.bytes.set(it,ft)}(i,m));let _=n.networkType;_!==void 0&&(je(i,72),ou(i,Bm(_)));let E=n.osType;E!==void 0&&(je(i,80),ou(i,Bm(E)));let I=n.requestId;I!==void 0&&(je(i,90),Nc(i,I));let C=n.sdkVersion;C!==void 0&&(je(i,98),Nc(i,C));let w=n.sequence;w!==void 0&&(je(i,104),ou(i,Bm(w)));let D=n.sid;D!==void 0&&(je(i,114),Nc(i,D));let N=n.timestamp;N!==void 0&&(je(i,120),ou(i,N));let L=n.uid;L!==void 0&&(je(i,128),je(i,L));let W=n.vid;W!==void 0&&(je(i,136),je(i,W));let G=n.width;G!==void 0&&(je(i,144),ou(i,Bm(G)));let U=n.service;U!==void 0&&(je(i,152),je(i,U));let z=n.callbackData;z!==void 0&&(je(i,162),Nc(i,z));let $=n.jpgEncryption;$!==void 0&&(je(i,168),je(i,$));let rt=n.requestType;rt!==void 0&&(je(i,176),je(i,rt));let dt=n.scorePorn;dt!==void 0&&(je(i,185),WI(i,dt));let ae=n.scoreSexy;ae!==void 0&&(je(i,193),WI(i,ae));let se=n.scoreNeutral;se!==void 0&&(je(i,201),WI(i,se));let zt=n.scene;zt!==void 0&&(je(i,208),je(i,zt));let ke=n.ossFilePrefix;ke!==void 0&&(je(i,218),Nc(i,ke));let De=n.serviceVendor;if(De!==void 0)for(let Xi of De){je(i,226);let it=gV();RW(Xi,it),je(i,it.limit),wW(i,it),AW(it)}}(t,e),function(n){let i=n.bytes,r=n.limit;return i.length===r?i:i.subarray(0,r)}(e)}function TW(t){return function(n){let i={};t:for(;!vV(n);){let r=Dc(n);switch(r>>>3){case 0:break t;case 1:i.code=Dc(n);break;case 2:i.msg=SV(n,Dc(n));break;case 3:{let s=bW(n);i.data=yW(n),n.limit=s;break}default:_V(n,7&r)}}return i}({bytes:e=t,offset:0,limit:e.length});var e}function yW(t){let e={};t:for(;!vV(t);){let n=Dc(t);switch(n>>>3){case 0:break t;case 1:e.requestId=SV(t,Dc(t));break;case 2:e.requestType=Dc(t)>>>0;break;case 3:e.scorePorn=HI(t);break;case 4:e.scoreSexy=HI(t);break;case 5:e.scoreNeutral=HI(t);break;case 6:e.requestScene=Dc(t)>>>0;break;case 7:e.scene=Dc(t)>>>0;break;default:_V(t,7&n)}}return e}function RW(t,e){let n=t.service;n!==void 0&&(je(e,8),je(e,n));let i=t.vendor;i!==void 0&&(je(e,16),je(e,i));let r=t.token;r!==void 0&&(je(e,26),Nc(e,r));let s=t.callbackUrl;s!==void 0&&(je(e,34),Nc(e,s))}function bW(t){let e=Dc(t),n=t.limit;return t.limit=t.offset+e,n}function _V(t,e){switch(e){case 0:for(;128&TV(t););break;case 2:FI(t,Dc(t));break;case 5:FI(t,4);break;case 1:FI(t,8);break;default:throw new Error("Unimplemented type: "+e)}}let CW=new Float32Array(1);new Uint8Array(CW.buffer);let BI=new Float64Array(1),Yr=new Uint8Array(BI.buffer);function Bm(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let EV=[];function gV(){const t=EV.pop();return t?(t.offset=t.limit=0,t):{bytes:new Uint8Array(64),offset:0,limit:0}}function AW(t){EV.push(t)}function FI(t,e){if(t.offset+e>t.limit)throw new Error("Skip past limit");t.offset+=e}function vV(t){return t.offset>=t.limit}function Fm(t,e){let n=t.bytes,i=t.offset,r=t.limit,s=i+e;if(s>n.length){let c=new Uint8Array(2*s);c.set(n),t.bytes=c}return t.offset=s,s>r&&(t.limit=s),i}function GI(t,e){let n=t.offset;if(n+e>t.limit)throw new Error("Read past limit");return t.offset+=e,n}function SV(t,e){let n=GI(t,e),i=String.fromCharCode,r=t.bytes,s="�",c="";for(let l=0;l<e;l++){let d,h,p,m,_=r[l+n];(128&_)==0?c+=i(_):(224&_)==192?l+1>=e?c+=s:(d=r[l+n+1],(192&d)!=128?c+=s:(m=(31&_)<<6|63&d,m<128?c+=s:(c+=i(m),l++))):(240&_)==224?l+2>=e?c+=s:(d=r[l+n+1],h=r[l+n+2],(49344&(d|h<<8))!=32896?c+=s:(m=(15&_)<<12|(63&d)<<6|63&h,m<2048||m>=55296&&m<=57343?c+=s:(c+=i(m),l+=2))):(248&_)==240?l+3>=e?c+=s:(d=r[l+n+1],h=r[l+n+2],p=r[l+n+3],(12632256&(d|h<<8|p<<16))!=8421504?c+=s:(m=(7&_)<<18|(63&d)<<12|(63&h)<<6|63&p,m<65536||m>1114111?c+=s:(m-=65536,c+=i(55296+(m>>10),56320+(1023&m)),l+=3))):c+=s}return c}function Nc(t,e){let n=e.length,i=0;for(let c=0;c<n;c++){let l=e.charCodeAt(c);l>=55296&&l<=56319&&c+1<n&&(l=(l<<10)+e.charCodeAt(++c)-56613888),i+=l<128?1:l<2048?2:l<65536?3:4}je(t,i);let r=Fm(t,i),s=t.bytes;for(let c=0;c<n;c++){let l=e.charCodeAt(c);l>=55296&&l<=56319&&c+1<n&&(l=(l<<10)+e.charCodeAt(++c)-56613888),l<128?s[r++]=l:(l<2048?s[r++]=l>>6&31|192:(l<65536?s[r++]=l>>12&15|224:(s[r++]=l>>18&7|240,s[r++]=l>>12&63|128),s[r++]=l>>6&63|128),s[r++]=63&l|128)}}function wW(t,e){let n=Fm(t,e.limit),i=t.bytes,r=e.bytes;for(let s=0,c=e.limit;s<c;s++)i[s+n]=r[s]}function TV(t){return t.bytes[GI(t,1)]}function yV(t,e){let n=Fm(t,1);t.bytes[n]=e}function HI(t){let e=GI(t,8),n=t.bytes;return Yr[0]=n[e++],Yr[1]=n[e++],Yr[2]=n[e++],Yr[3]=n[e++],Yr[4]=n[e++],Yr[5]=n[e++],Yr[6]=n[e++],Yr[7]=n[e++],BI[0]}function WI(t,e){let n=Fm(t,8),i=t.bytes;BI[0]=e,i[n++]=Yr[0],i[n++]=Yr[1],i[n++]=Yr[2],i[n++]=Yr[3],i[n++]=Yr[4],i[n++]=Yr[5],i[n++]=Yr[6],i[n++]=Yr[7]}function Dc(t){let e,n=0,i=0;do e=TV(t),n<32&&(i|=(127&e)<<n),n+=7;while(128&e);return i}function je(t,e){for(e>>>=0;e>=128;)yV(t,127&e|128),e>>>=7;yV(t,e)}function ou(t,e){let n=e.low>>>0,i=(e.low>>>28|e.high<<4)>>>0,r=e.high>>>24,s=r===0?i===0?n<16384?n<128?1:2:n<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:r<128?9:10,c=Fm(t,s),l=t.bytes;switch(s){case 10:l[c+9]=r>>>7&1;case 9:l[c+8]=s!==9?128|r:127&r;case 8:l[c+7]=s!==8?i>>>21|128:i>>>21&127;case 7:l[c+6]=s!==7?i>>>14|128:i>>>14&127;case 6:l[c+5]=s!==6?i>>>7|128:i>>>7&127;case 5:l[c+4]=s!==5?128|i:127&i;case 4:l[c+3]=s!==4?n>>>21|128:n>>>21&127;case 3:l[c+2]=s!==3?n>>>14|128:n>>>14&127;case 2:l[c+1]=s!==2?n>>>7|128:n>>>7&127;case 1:l[c]=s!==1?128|n:127&n}}function RV(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}const IW=new Map([["moderation",1],["supervise",2]]);class OW extends Sn{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;const n=this._connectionState;this._connectionState=e,this.emit(mi.CONNECTION_STATE_CHANGE,n,e)}get inspectType(){return this._inspectType}set inspectType(e){var n;this._inspectMode=Vr(n=e.map(i=>IW.get(i)||0)).call(n,(i,r)=>i+r),this._inspectType=e}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(e){super(),O(this,"name","AgoraRTCVideoContentInspect"),O(this,"_connectionState",xs.CONNECTING),O(this,"_innerConnectionState",void 0),O(this,"sequence",0),O(this,"inspectStartTime",void 0),O(this,"workerManagerConnection",void 0),O(this,"workerConnection",void 0),O(this,"workerMessageLengthLimit",void 0),O(this,"inspectIntervalMinimum",void 0),O(this,"qualityRatio",void 0),O(this,"_connectInfo",void 0),O(this,"_cancelTokenSource",Ir.CancelToken.source()),O(this,"_retryConfig",void 0),O(this,"wmSequence",0),O(this,"inspectInterval",void 0),O(this,"inspectTimer",null),O(this,"ossFilePrefix",void 0),O(this,"extraInfo",void 0),O(this,"_inspectType",void 0),O(this,"_inspectMode",void 0),O(this,"_quality",1),O(this,"qualityTimer",null),O(this,"_inspectId",void 0),O(this,"_needWorkUrlOnly",!1),O(this,"inspectImage",()=>{if(this.connectionState!==xs.CONNECTED)throw new K(P.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===xs.CONNECTED?this.requestToInspectImage():T.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=Je(5,"inspect-"),this.workerMessageLengthLimit=k("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=k("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=k("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=e.interval,this.ossFilePrefix=e.ossFilePrefix,this.extraInfo=e.extraInfo,this.inspectType=e.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new Hg("worker-manager-"+this._inspectId,Xn),this.on(mi.STATE_CHANGE,(n,i)=>{this._innerConnectionState=n,T.debug("[".concat(this._inspectId,"] Inspect operation :").concat(Ms[n]," ").concat(i||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new Hg("worker-"+this._inspectId,Xn),this.handleWorkerEvents()}async init(e,n){this.emit(mi.STATE_CHANGE,Ms.CONNECT_AP),this._connectInfo=e;const i=this._cancelTokenSource.token;return this._retryConfig=n,new Tt((r,s)=>{this.on(mi.CONNECTION_STATE_CHANGE,(c,l)=>{l===xs.CONNECTED&&r()}),this.requestAP(e,i,n).then(c=>{this.connectWorkerManager(c)}).catch(c=>{s(c)})})}async requestAP(e,n,i){const r=k("WEBCS_DOMAIN").map(l=>"https://".concat(l,"/api/v1")),s=await function(l,d,h,p){let{appId:m,areaCode:_,cname:E,sid:I,token:C,uid:w}=d;Nm++;const D="image_moderation_api",N={service_name:D,json_body:JSON.stringify({appId:m,areaCode:_,cname:E,command:"allocateEdge",requestId:Nm,seq:Nm,sid:I,token:C,ts:Date.now(),uid:w+""})};let L,W,G=l[0];return Ro(async()=>{L=Date.now();const U=await Io(G,{data:N,cancelToken:h,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(W=Date.now()-L,U.code!==0){const dt=new K(P.UNEXPECTED_RESPONSE,"image inspect ap error, code"+U.code,{retry:!0,responseTime:W});throw T.error(dt.toString()),dt}const z=JSON.parse(U.json_body);if(z.code!==200){const dt=new K(P.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(z.code,", reason: ").concat(z.reason),{code:z.code,responseTime:W});throw T.error(dt.toString()),dt}if(!z.servers||!Array.isArray(z.servers)||z.servers.length===0){const dt=new K(P.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:z.code,responseTime:W});throw T.error(dt.toString()),dt}const $=k("VIDEO_INSPECT_WORKER_MANAGER_HOST"),rt=k("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:z.servers.map(dt=>{let{address:ae,wss:se}=dt;if(ae&&se)return"wss://".concat(ae.replace(/\./g,"-"),".").concat($,":").concat(rt||se)}).filter(dt=>!!dt),workerToken:z.workerToken,vid:z.vid,responseTime:W}},(U,z)=>(Pt.apworkerEvent(I,{success:!0,sc:200,serviceName:D,responseDetail:JSON.stringify(U.addressList),firstSuccess:z===0,responseTime:W,serverIp:l[z%l.length]}),!1),(U,z)=>(Pt.apworkerEvent(I,{success:!1,sc:U.data&&U.data.code||200,serviceName:D,responseTime:W,serverIp:l[z%l.length]}),!!(U.code!==P.OPERATION_ABORTED&&U.code!==P.UNEXPECTED_RESPONSE||U.data&&U.data.retry)&&(G=l[(z+1)%l.length],!0)),p)}(r,e,n,i);this.emit(mi.STATE_CHANGE,Ms.AP_CONNECTED);const{addressList:c}=s;return this.wmSequence++,c}async connectWorkerManager(e){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=n,this.emit(mi.STATE_CHANGE,Ms.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(e,1e4)}async connectWorker(e){await this.workerConnection.init([e])}handleWorkerManagerEvents(){this.workerManagerConnection.on(ee.CONNECTED,async()=>{this.emit(mi.STATE_CHANGE,Ms.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.24.0",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(ee.CLOSED,()=>{this._innerConnectionState<Ms.GET_WORKER_MANAGER_RESPONSE&&T.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(ee.FAILED,()=>{this._innerConnectionState<Ms.GET_WORKER_MANAGER_RESPONSE&&T.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(ee.RECONNECTING,()=>{this._innerConnectionState<Ms.GET_WORKER_MANAGER_RESPONSE&&T.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(ee.ON_MESSAGE,async e=>{this.emit(mi.STATE_CHANGE,Ms.GET_WORKER_MANAGER_RESPONSE);const n=this.workerManagerConnection.url;this.workerManagerConnection.close();const i=JSON.parse(e.data);if(i.code!==200)throw T.error("[".concat(this._inspectId,"] Unexpected code ").concat(i.code," from worker manager")),new K(P.UNEXPECTED_RESPONSE,"response code of worker is unexpected",i);if(!(i.serverResponse&&i.serverResponse.portWss&&n))throw T.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(i))),new K(P.UNEXPECTED_RESPONSE,"response content of worker is unexpected",i);{const r=k("VIDEO_INSPECT_WORKER_PORT")||i.serverResponse.portWss,s=n.replace(/:\d+\/?$/,":".concat(r));this.emit(mi.STATE_CHANGE,Ms.CONNECT_WORKER,s),this._needWorkUrlOnly?this.emit(mi.REQUEST_NEW_WORKER_URL,s):await this.connectWorker(s)}}),this.workerManagerConnection.on(ee.WILL_RECONNECT,(e,n,i)=>{i(e)}),this.workerManagerConnection.on(ee.REQUEST_NEW_URLS,(e,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(n)})}handleWorkerEvents(){this.workerConnection.on(ee.CONNECTED,async()=>{this.emit(mi.STATE_CHANGE,Ms.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=xs.CONNECTED}),this.workerConnection.on(ee.ON_MESSAGE,async e=>{if(e.data instanceof ArrayBuffer){const i=TW(new Uint8Array(e.data));if(k("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&T.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(i)),i.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(mi.INSPECT_RESULT,void 0,void 0);if(i.data&&i.data.scorePorn&&i.data.scoreSexy&&i.data.scoreNeutral){var n;const r={porn:i.data.scorePorn,sexy:i.data.scoreSexy,neutral:i.data.scoreNeutral},s=Vr(n=Object.keys(r)).call(n,(l,d)=>r[l]>r[d]?l:d,"porn"),c=Object.keys(r).find(l=>l===s);this.emit(mi.INSPECT_RESULT,c)}else this.emit(mi.INSPECT_RESULT,void 0,new K(P.UNEXPECTED_RESPONSE,i.code+"","There is an unexpected data on message"))}else this.emit(mi.INSPECT_RESULT,void 0,new K(P.UNEXPECTED_RESPONSE,i.code+"",i.msg))}else T.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(mi.INSPECT_RESULT,void 0,new K(P.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(ee.CLOSED,()=>{this.connectionState=xs.CLOSED}),this.workerConnection.on(ee.FAILED,()=>{this.connectionState=xs.CLOSED}),this.workerConnection.on(ee.RECONNECTING,()=>{this.connectionState=this.connectionState===xs.CONNECTED?xs.RECONNECTING:xs.CONNECTING}),this.workerConnection.on(ee.WILL_RECONNECT,(e,n,i)=>{e==="recover"&&i(e),i("tryNext")}),this.workerConnection.on(ee.REQUEST_NEW_URLS,(e,n)=>{this.workerManagerConnection.close(),this.once(mi.REQUEST_NEW_WORKER_URL,i=>{e([i])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(i=>{this.connectWorkerManager(i,!0)}).catch(i=>{n(i)})})}async requestToInspectImage(){this.sequence++;const e=Ca(this,mi.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void this.emit(mi.INSPECT_RESULT,void 0,new K(P.INVALID_OPERATION,"Only the track being played can be inspected"));const i=await this.generateRequestData(e,n);this.workerConnection.sendMessage(i,!0,!0)}else this.emit(mi.INSPECT_RESULT,void 0,new K(P.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(e,n){let{appId:i,cname:r,cid:s,vid:c,sid:l,uid:d}=n;const h=Date.now(),p=await e.getCurrentFrameImage("image/jpeg",this.quality),m=await r1(p,i,r),_=this.sequence+"-"+s+"-"+d+"-"+h+"-"+Je(12,""),E={appId:i,cid:s,cname:r,deviceId:"",elapse:(I=Number(h-this.inspectStartTime),{low:I|=0,high:I>>31,unsigned:I>=0}),fileSize:m.byteLength,jpgEncryption:2,height:p.height,width:p.width,jpg:m,networkType:6,osType:7,requestId:_,sdkVersion:"4.24.0",sequence:this.sequence,sid:l,timestamp:D2(h),uid:d,vid:c,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var I;this.extraInfo===void 0&&delete E.callbackData,this.ossFilePrefix===void 0&&delete E.ossFilePrefix;const C=SW(E);if(C.byteLength<this.workerMessageLengthLimit){if(k("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const w=function(D){for(var N=1;N<arguments.length;N++){var L=arguments[N]!=null?arguments[N]:{};N%2?RV(Object(L),!0).forEach(function(W){O(D,W,L[W])}):Object.getOwnPropertyDescriptors?Object.defineProperties(D,Object.getOwnPropertyDescriptors(L)):RV(Object(L)).forEach(function(W){Object.defineProperty(D,W,Object.getOwnPropertyDescriptor(L,W))})}return D}({},E);delete w.jpg,T.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(w))}return C}{const w=this.quality*this.qualityRatio;return this.quality=w,await this.generateRequestData(e,{appId:i,cname:r,cid:s,vid:c,sid:l,uid:d})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Ir.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=xs.CLOSED,this.emit(mi.STATE_CHANGE,Ms.CLOSED)}}const NW={name:"ContentInspect",create:function(t){let{config:e}=t;return function(n){if(!n)throw new K(P.INVALID_PARAMS,"inspectConfig is necessary.");if(!n.inspectType||!Array.isArray(n.inspectType))throw new K(P.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const i=[...new Set(n.inspectType)];i.forEach(r=>{var s;if(!mt(s=["supervise","moderation"]).call(s,r))throw new K(P.INVALID_PARAMS,"".concat(r," is not a valid inspect type."))}),n.inspectType=i}if(n&&n.extraInfo&&n.extraInfo.length>1024)throw new K(P.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(e),new OW(e)}};var bV=V(Ui.Object.getOwnPropertySymbols),DW=Le,PW=Gc.indexOf,kW=Hc,zI=si([].indexOf),CV=!!zI&&1/zI([1],1,-0)<0;DW({target:"Array",proto:!0,forced:CV||!kW("indexOf")},{indexOf:function(t){var e=arguments.length>1?arguments[1]:void 0;return CV?zI(this,t,e)||0:PW(this,t,e)}});var LW=$r("Array","indexOf"),xW=vt,MW=LW,qI=Array.prototype,UW=function(t){var e=t.indexOf;return t===qI||xW(qI,t)&&e===qI.indexOf?MW:e},AV=V(UW);function VW(t,e){if(t==null)return{};var n,i,r=function(c,l){if(c==null)return{};var d={};for(var h in c)if({}.hasOwnProperty.call(c,h)){if(AV(l).call(l,h)!==-1)continue;d[h]=c[h]}return d}(t,e);if(bV){var s=bV(t);for(i=0;i<s.length;i++)n=s[i],AV(e).call(e,n)===-1&&{}.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}let wV=class{get localCapabilities(){return En(this._localCapabilities)}get rtpCapabilities(){return En(this._rtpCapabilities)}get candidates(){return En(this._candidates)}get iceParameters(){return En(this._iceParameters)}get dtlsParameters(){return En(this._dtlsParameters)}constructor(t){O(this,"sessionDesc",void 0),O(this,"_localCapabilities",void 0),O(this,"_rtpCapabilities",void 0),O(this,"_candidates",void 0),O(this,"_iceParameters",void 0),O(this,"_dtlsParameters",void 0),O(this,"setup",void 0),O(this,"currentMidIndex",void 0),O(this,"cname","o/i14u9pJrxRKAsu"),O(this,"firefoxSsrcMidMap",new Map),t=En(t);const{remoteIceParameters:e,remoteDtlsParameters:n,candidates:i,remoteRTPCapabilities:r,localCapabilities:s,direction:c,setup:l,videoCodec:d,audioCodec:h}=t;let p;this.setup=l,p=c===Sr.RECEIVE_ONLY?Wr(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):Wr(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=r,this._candidates=i,this._iceParameters=e,this._dtlsParameters=n,this._localCapabilities=s;const m=c===Sr.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,_=c===Sr.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,E=c===Sr.RECEIVE_ONLY?r.send.videoCodecs:Kg(Ct.VIDEO,m,_,d),I=c===Sr.RECEIVE_ONLY?r.send.audioCodecs:Kg(Ct.AUDIO,m,_,h);for(const C of p.mediaDescriptions)C.attributes.iceUfrag=e.iceUfrag,C.attributes.icePwd=e.icePwd,C.attributes.fingerprints=n.fingerprints,C.attributes.candidates=i,C.attributes.setup=this.setup,C.media.mediaType==="application"&&(C.attributes.sctpPort="5000"),C.media.mediaType==="video"&&(C.media.fmts=E.map(w=>w.payloadType.toString(10)),C.attributes.payloads=E,C.attributes.extmaps=m.videoExtensions),C.media.mediaType==="audio"&&(C.media.fmts=I.map(w=>w.payloadType.toString(10)),C.attributes.payloads=I,C.attributes.extmaps=m.audioExtensions,Om(C));this.sessionDesc=p,this.currentMidIndex=p.mediaDescriptions.length-1}toString(){return Hd(this.sessionDesc)}hasMid(t){return Array.isArray(t)?t.every(e=>this.hasMid(e)):this.sessionDesc.mediaDescriptions.some(e=>e.attributes.mid===t)}send(t,e,n,i,r){n=n.replace(/ /g,"-");const{ssrcs:s,ssrcGroups:c}=qg(e,this.cname,k("SYNC_GROUP")?n:void 0),l=this.findPreloadMediaDesc(s);if(l){if(An()&&this.firefoxSsrcMidMap.set(s[0].ssrcId,l.attributes.mid),r&&(r.twcc||r.remb)){const d=this.sessionDesc.mediaDescriptions.indexOf(l);return this.sessionDesc.mediaDescriptions[d]=this.mungSendMediaDesc(l,r),{mid:l.attributes.mid,needExchangeSDP:!0}}return{mid:l.attributes.mid,needExchangeSDP:!1}}{const d=this.findAvailableMediaIndex(t,s,i);let h;return d===-1?(h=this.createOrRecycleSendMedia(t,s,c,"sendonly",i,r),this.updateBundleMids()):(h=En(this.sessionDesc.mediaDescriptions[d]),h.attributes.direction="sendonly",h.attributes.ssrcs=s,h.attributes.ssrcGroups=c,this.sessionDesc.mediaDescriptions[d]=this.mungSendMediaDesc(h,r)),An()&&this.firefoxSsrcMidMap.set(s[0].ssrcId,h.attributes.mid),{needExchangeSDP:!0,mid:h.attributes.mid}}}stopSending(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>n.attributes.mid&&t.indexOf(n.attributes.mid)!==-1);if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");e.forEach(n=>{n.attributes.ssrcs=[]}),this.updateBundleMids()}receive(t,e,n){const i=[];return t.forEach(r=>{const s=r._mediaStreamTrack.kind,c=this.findAvailableRecvMediaIndex(s);let l,d=!1;c===-1?(d=!0,l=this.createOrRecycleRecvMedia(r,[],"recvonly",e,n),this.updateBundleMids()):(l=En(this.sessionDesc.mediaDescriptions[c]),l.attributes.direction="recvonly"),i.push({mid:l.attributes.mid,needCreateTransceiver:d})}),i}stopReceiving(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>t.indexOf(n.attributes.mid)!==-1);if(e.length!==t.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");e.forEach(n=>{n.media.port="0",n.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(t){const{foundation:e,protocol:n,address:i,port:r,type:s,relatedAddress:c,relatedPort:l,priority:d}=new RTCIceCandidate(t),h={foundation:e??"",componentId:"1",transport:n??"",priority:d?d+"":"",connectionAddress:i??"",port:r?r+"":"",type:s?s+"":"",relAddr:c??"",relPort:l?l+"":"",extension:{}};this.candidates.some(p=>p.priority===h.priority&&p.connectionAddress===h.connectionAddress&&p.port===h.port)||(this._candidates.push(h),this.sessionDesc.mediaDescriptions.forEach(p=>{p.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(t,e,n,i,r){const s=t._mediaStreamTrack.kind,c=this.rtpCapabilities.recv,l=Kg(s,c,this.localCapabilities.send,s===Ct.AUDIO?r:i),d=s===Ct.VIDEO?c.videoExtensions:c.audioExtensions,h="".concat(++this.currentMidIndex);let p={media:{mediaType:s,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:l.map(_=>_.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:d,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:e,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:l,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(h)}};p=this.mungRecvMediaDsec(p,t);const m=this.findFirstClosedMedia(s);if(m){const _=this.sessionDesc.mediaDescriptions.indexOf(m);this.sessionDesc.mediaDescriptions[_]=p}else this.sessionDesc.mediaDescriptions.push(p);return p}muteRemote(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>mt(t).call(t,n.attributes.mid||""));if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");e.forEach(n=>{n.attributes.direction="inactive"})}unmuteRemote(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>mt(t).call(t,n.attributes.mid||""));if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");e.forEach(n=>{n.attributes.direction="recvonly"})}findAvailableMediaIndex(t,e,n){return this.sessionDesc.mediaDescriptions.findIndex(i=>{const r=i.media.mediaType===t&&i.media.port!=="0"&&(i.attributes.direction==="sendonly"||i.attributes.direction==="sendrecv")&&i.attributes.ssrcs.length===0;if(An()){if(r){const s=this.firefoxSsrcMidMap.get(e[0].ssrcId);return!(s||i.attributes.mid!=="0"&&i.attributes.mid!=="1")||!(!s||s!==i.attributes.mid)}return!1}return r&&i.attributes.mid===n})}findAvailableRecvMediaIndex(t){return this.sessionDesc.mediaDescriptions.findIndex(e=>{const n=e.media.mediaType===t&&e.media.port!=="0"&&(e.attributes.direction==="recvonly"||e.attributes.direction==="sendrecv");return e.attributes.mid!=="0"&&e.attributes.mid!=="1"&&n})}predictReceivingMids(t){const e=[];for(let n=0;n<t;n++)e.push((this.currentMidIndex+n+1).toString(10));return e}restartICE(t){t=En(t),this._iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(e=>{e.attributes.iceUfrag=t.iceUfrag,e.attributes.icePwd=t.icePwd})}createOrRecycleSendMedia(t,e,n,i,r,s){const c=this.rtpCapabilities.send,l=t===Ct.VIDEO?c.videoCodecs:c.audioCodecs,d=t===Ct.VIDEO?c.videoExtensions:c.audioExtensions;An()&&(r="".concat(++this.currentMidIndex));let h={media:{mediaType:t,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:l.map(m=>m.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:d,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:e,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:l,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:r}};h=this.mungSendMediaDesc(h,s);const p=this.findFirstClosedMedia(t);if(p){const m=this.sessionDesc.mediaDescriptions.indexOf(p);this.sessionDesc.mediaDescriptions[m]=h}else this.sessionDesc.mediaDescriptions.push(h);return h}mungRecvMediaDsec(t,e,n){const i=En(t);return zw(i),Im(i,e),qw(i,e),TM(i),UR(i,n,this.localCapabilities.send),i}mungSendMediaDesc(t,e){const n=En(t);return UR(n,e,this.localCapabilities.recv),Om(n),n}updateRecvMedia(t,e){const n=this.sessionDesc.mediaDescriptions.findIndex(i=>i.attributes.mid===t);if(n!==-1){const i=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],e);this.sessionDesc.mediaDescriptions[n]=i}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(t=>t.media.port!=="0").map(t=>t.attributes.mid)}findPreloadMediaDesc(t){return this.sessionDesc.mediaDescriptions.find(e=>{var n;return((n=e.attributes)===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId)===t[0].ssrcId})}findFirstClosedMedia(t){return this.sessionDesc.mediaDescriptions.find(e=>An()?e.media.port==="0"&&e.media.mediaType===t:e.media.port==="0")}};const jW=["sdp"];var on;function IV(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function cu(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?IV(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):IV(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}let OV=(on=class Wm extends iM{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,n;return(e=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&e!==void 0?e:null}get localCodecs(){return[]}set isInRestartIce(e){this._isInRestartIce=e}get isInRestartIce(){return this._isInRestartIce}constructor(e,n,i){super(e,n),O(this,"direction",void 0),O(this,"name",void 0),O(this,"store",void 0),O(this,"spec",void 0),O(this,"peerConnection",void 0),O(this,"initialOffer",void 0),O(this,"transport",void 0),O(this,"statsFilter",void 0),O(this,"localCandidateCount",0),O(this,"_isInRestartIce",!1),O(this,"mutex",void 0),O(this,"onLocalCandidate",void 0),O(this,"remoteSDP",void 0),O(this,"pendingCandidates",[]),O(this,"localCapabilities",void 0),O(this,"isReady",!1),O(this,"restartCnt",0),O(this,"curTurnServerIndex",0),this.store=n,this.spec=e,this.mutex=new Wi("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(Wm.resolvePCConfiguration(e,n.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=i??Sr.SEND_ONLY,this.name=this.direction===Sr.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=tw(this.peerConnection,k("STATS_UPDATE_INTERVAL"),void 0,An()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(e){try{const n=await RM();if(this.localCapabilities=VR(n),e){const{sdp:i}=e,r=VW(e,jW),s=function(){const p={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},m=zg(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),_={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},E={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},I={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Us(m,p,"videoExtensions",_,E,I),Us(m,p,"videoCodecs",_,E,I),Us(m,p,"audioExtensions",_,E,I),Us(m,p,"audioCodecs",_,E,I),k("RAISE_H264_BASELINE_PRIORITY")){const C=I.videoCodecs.findIndex(w=>w.rtpMap&&w.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&w.fmtp&&w.fmtp.parameters["profile-level-id"]==="42001f");if(C!==-1){const w=I.videoCodecs.findIndex(D=>D.rtpMap&&D.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(w<C){T.debug("raising H264 baseline profile priority");const D=I.videoCodecs[C];I.videoCodecs.splice(C,1),I.videoCodecs.splice(w,0,D)}w!==-1&&k("FILTER_SEND_H264_BASELINE")&&(_.videoCodecs=_.videoCodecs.filter(D=>!(D.rtpMap&&D.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&D.fmtp&&D.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:_,recv:E,sendrecv:I}}({},{},i);this.remoteSDP=new wV({remoteIceParameters:r.iceParameters,remoteDtlsParameters:r.dtlsParameters,candidates:[],remoteRTPCapabilities:s,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const c=await this.peerConnection.createAnswer();if(!c.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const l=Xd(c.sdp);await this.peerConnection.setLocalDescription(c);const d=await bM({},{},c.sdp);this.localCapabilities=VR(d);const h=this.peerConnection.getTransceivers()[0];return h!=null&&h.receiver&&h.receiver.transport&&this.tryBindTransportEvents(h.receiver.transport),cu(cu({},l),{},{sdp:c.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const i=await this.peerConnection.createOffer();if(!i.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const r=Xd(i.sdp);return this.initialOffer=i,cu(cu({},r),{},{sdp:i.sdp})}}catch(n){throw new Z(P.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:n,iceParameters:i,dtlsParameters:r}=e,s=await bM({},{},n);this.remoteSDP=new wV({remoteIceParameters:i,remoteDtlsParameters:r,candidates:[],remoteRTPCapabilities:s,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const c=this.peerConnection.getTransceivers()[0];c!=null&&c.sender&&c.sender.transport&&this.tryBindTransportEvents(c.sender.transport)}catch(n){throw new Z(P.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async addRemoteCandidate(e){try{e&&this.pendingCandidates.push(e),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(n=>{this.peerConnection.addIceCandidate(n)}),this.pendingCandidates=[])}catch(n){throw new Z(P.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(n.toString()))}}send(e,n,i){var r=this;return Za(function*(){const s=yield Re(r.mutex.lock("From P2PConnection.send"));try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const c=[],l=r.remoteSDP.receive(e,n,i);e.forEach((w,D)=>{if(l[D].needCreateTransceiver){const N=r.peerConnection.addTransceiver(w._mediaStreamTrack,{direction:"sendonly"});c.push(N),w._updateRtpTransceiver(N)}else{const N=r.peerConnection.getTransceivers().find(L=>L.mid===l[D].mid);if(!N)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(l[D].mid));c.push(N),w._updateRtpTransceiver(N)}}),An()&&k("SIMULCAST")===!0&&(yield Re(r.applySimulcastForFirefox(c,e)));const d=l.map(w=>w.mid),h=yield Re(r.peerConnection.createOffer()),p=r.mungSendOfferSDP(h.sdp,e,d),m=Wr(p),_=d.map(w=>{const D=m.mediaDescriptions.find(N=>N.attributes.mid===w);if(!D)throw new Error("Cannot extract ssrc from mediaDescription.");return gM(D,k("USE_PUB_RTX"))}),E=c.map((w,D)=>{const N=d[D];return{localSSRC:_[D],id:N}});yield Re(r.peerConnection.setLocalDescription({type:"offer",sdp:p}));try{yield E}catch(w){const D=r.remoteSDP.toString();throw yield Re(r.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield Re(r.peerConnection.setRemoteDescription({type:"answer",sdp:D})),yield Re(r.stopSending(d,!0)),w}yield Re(r.applySimulcastEncodings(c,e)),yield Re(r.applySendEncodings(c,e));const I=r.remoteSDP.toString(),C=r.logSDPExchange(p,"offer","local","send");return C==null||C(I),yield Re(r.setRemoteDescription({type:"answer",sdp:I})),c.map((w,D)=>{const N=d[D];return{localSSRC:_[D],id:N}})}catch(c){throw c instanceof Z?c:new Z(P.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(c.toString()))}finally{s()}})()}async stopSending(e,n){const i=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const r=this.peerConnection.getTransceivers().filter(d=>e.indexOf(d.mid)!==-1);if(r.length!==e.length)throw new Error("Transceivers' length (".concat(r.length,") doesn't match mids' length (").concat(e.length,") when trying to call P2PConnection.stopSending."));r.map(d=>{var h;d.direction="inactive",(h=d.stop)===null||h===void 0||h.call(d)});const s=await this.peerConnection.createOffer(),c=this.logSDPExchange(s.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(s),this.remoteSDP.stopReceiving(e);const l=this.remoteSDP.toString();c==null||c(l),await this.setRemoteDescription({type:"answer",sdp:l})}catch(r){throw new Z(P.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(r.toString()))}finally{i&&i()}}async receive(e,n,i,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:s,needExchangeSDP:c}=this.remoteSDP.send(e,n,i,r);if(c){const d=this.remoteSDP.toString(),h=this.logSDPExchange(d,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:d});const p=await this.peerConnection.createAnswer(),m=this.mungReceiveAnswerSDP(p.sdp,s,e);h==null||h(m||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:m}),T.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else T.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."));const l=this.peerConnection.getTransceivers().find(d=>d.mid===s);if(!l||l.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:l.receiver.track,mid:l.mid,transceiver:l}}catch(s){throw new Z(P.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async mockReceive(e,n,i,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:s,needExchangeSDP:c}=this.remoteSDP.send(e,n,i,r);if(c){const l=this.remoteSDP.toString(),d=this.logSDPExchange(l,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:l});const h=await this.peerConnection.createAnswer(),p=this.mungReceiveAnswerSDP(h.sdp,s,e);d==null||d(p||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:p}),T.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else T.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."))}catch(s){throw new Z(P.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();i==null||i(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(n){throw new Z(P.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async restartICE(e){try{if(this.store.p2pTransport===xh.Auto&&(this.store.p2pTransport=xh.SdRtn,be().supportPCSetConfiguration&&this.peerConnection.setConfiguration(Wm.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,be().supportPCSetConfiguration&&this.peerConnection.setConfiguration(Wm.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!e){this.restartCnt++,this.isReady=!1;const n=await this.peerConnection.createOffer({iceRestart:!0});if(!n.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:i}=Xd(n.sdp);return this.store.descriptionStart(),this.direction===Sr.SEND_ONLY&&await this.peerConnection.setLocalDescription(n),i}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(e),this.store.descriptionStart(),this.direction===Sr.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const n=await this.peerConnection.createAnswer();if(!n.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:i}=Xd(n.sdp);return await this.peerConnection.setLocalDescription(n),i}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(n){throw new Z(P.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}close(){var e;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),r=this.mungSendOfferSDP(i.sdp,[n],[e]);this.remoteSDP.updateRecvMedia(e,n);const s=this.remoteSDP.toString(),c=this.logSDPExchange(r,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),c==null||c(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(i){throw new Z(P.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(e,n){const i=this.peerConnection.getTransceivers().filter(r=>r.mid===e);i.length===1&&(this.isVP8Simulcast(n)?An()||await this.applySimulcastEncodings(i,[n]):await this.applySendEncodings(i,[n]))}setStatsRemoteVideoIsReady(e,n){this.statsFilter.setVideoIsReady2(e,n)}async replaceTrack(e,n){const i=this.peerConnection.getTransceivers().find(r=>r.mid===n);i&&await i.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){const e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){const n=e[0].transport.iceTransport,{local:i,remote:r}=n.getSelectedCandidatePair();return{local:cu(cu({},vc),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port}),remote:cu(cu({},vc),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e,n;mt(e=["connected","completed"]).call(e,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(n=this.onICEConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=e=>{if(e.candidate){var n;e.candidate.candidate&&((n=this.onLocalCandidate)===null||n===void 0||n.call(this,e.candidate.toJSON())),this.localCandidateCount+=1}else T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const r={iceServers:[]};var s;return e.iceServers?r.iceServers=e.iceServers:e.turnServer&&e.turnServer.mode!=="off"&&(Ng(e.turnServer.servers)?r.iceServers=e.turnServer.servers:(r.iceServers&&r.iceServers.push(...Wm.turnServerConfigToIceServers(e.turnServer.servers,n,i)),k("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&e.turnServer.serversFromGateway&&r.iceServers.push(...Wm.turnServerConfigToIceServers(e.turnServer.serversFromGateway,n,i)),mt(s=[xh.Relay,xh.SdRtn]).call(s,n)&&(r.iceTransportPolicy="relay"),k("FORCE_TURN_TCP")?r.iceTransportPolicy="relay":e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach(c=>{c.forceturn&&(r.iceTransportPolicy="relay")}))),k("ENABLE_ENCODED_TRANSFORM")&&be().supportWebRTCEncodedTransform&&(r.encodedInsertableStreams=!0),T.debug("P2PConnection p2pTransport is ".concat(n)),r}static turnServerConfigToIceServers(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const r=[],s=e.filter(l=>l.tcpport);T.debug("P2PConnection turnServers is ".concat(s,", current index is ").concat(i));const c=s.length>i?s[i]:s[0];switch(n){case xh.SdRtn:const l=e.filter(h=>{var p;return mt(p=h.username).call(p,"glb:")&&h.turnServerURL==h.turnServerURL}),d=l.length>i?l[i]:l[0];d&&(r.push({username:d.username,credential:d.password,credentialType:"password",urls:"turn:".concat(Kd(d.turnServerURL),":").concat(d.tcpport,"?transport=udp")}),r.push({username:d.username,credential:d.password,credentialType:"password",urls:"turns:".concat(Kd(d.turnServerURL),":").concat(d.tcpport,"?transport=tcp")}));break;case xh.Relay:c&&(r.push({username:c.username,credential:c.password,credentialType:"password",urls:"turn:".concat(c.turnServerURL,":").concat(c.tcpport,"?transport=udp")}),r.push({username:c.username,credential:c.password,credentialType:"password",urls:"turns:".concat(Kd(c.turnServerURL),":").concat(c.tcpport,"?transport=tcp")}));break;default:c&&(r.push({username:c.username,credential:c.password,credentialType:"password",urls:"turn:".concat(c.turnServerURL,":").concat(c.tcpport,"?transport=udp")}),r.push({username:c.username,credential:c.password,credentialType:"password",urls:"turns:".concat(Kd(c.turnServerURL),":").concat(c.tcpport,"?transport=tcp")}),r.push({username:c.username,credential:c.password,credentialType:"password",urls:"stun:".concat(c.turnServerURL,":").concat(c.tcpport)}))}return r}tryBindTransportEvents(e){if(e){this.transport=e,e.onstatechange=()=>{var i;e!=null&&e.state&&((i=this.onDTLSTransportStateChange)===null||i===void 0||i.call(this,e.state))},e.onerror=i=>{var r;(r=this.onDTLSTransportError)===null||r===void 0||r.call(this,"error"in i?i.error:i)};const n=e.iceTransport;n&&(n.onstatechange=()=>{const i=e==null?void 0:e.iceTransport.state;var r;i&&((r=this.onICETransportStateChange)===null||r===void 0||r.call(this,i))},n.getSelectedCandidatePair&&(n.onselectedcandidatepairchange=()=>{if(n.getSelectedCandidatePair()){const{local:i,remote:r}=n.getSelectedCandidatePair()||{};if(i&&r){const s=i.address+":"+i.port,c=r.address+":"+r.port;T.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(Hh(s)),", remote ").concat(JSON.stringify(Hh(c))))}}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e,n){var i;if(n||(n=this.peerConnection.getSenders().find(p=>p.track===e._mediaStreamTrack)),!n)return T.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e))return T.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!be().supportSetRtpSenderParameters)return T.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const r={},s={};switch(e._optimizationMode){case"motion":r.degradationPreference="maintain-framerate";break;case"detail":r.degradationPreference="maintain-resolution";break;default:r.degradationPreference="balanced"}if(e._encoderConfig){var c;const{bitrateMax:p,frameRate:m,scaleResolutionDownBy:_}=e._encoderConfig;p&&(s.maxBitrate=1e3*p),mt(c=e._hints).call(c,Ye.LOW_STREAM)&&(m&&(s.maxFramerate=da(m)),_&&_>=1&&(s.scaleResolutionDownBy=_))}if(k("DSCP_TYPE")&&yl()){var l;const p=k("DSCP_TYPE");mt(l=["very-low","low","medium","high"]).call(l,p)&&(s.networkPriority=p)}const d=n.getParameters(),h=(i=d.encodings)===null||i===void 0?void 0:i[0];An()&&!h&&(r.encodings=[s]),h&&Object.assign(h,s),Object.assign(d,r),T.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(d.encodings))),await n.setParameters(d)}async applySendEncodings(e,n){try{if(!be().supportSetRtpSenderParameters||e.length!==n.length)return;for(let i=0;i<e.length;i++){const r=e[i],s=n[i];s instanceof sn&&!this.isVP8Simulcast(s)&&await this.updateRtpSenderEncodings(s,r.sender)}}catch{T.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,n,i){const r=Wr(e);return n.forEach((s,c)=>{const l=i[c],d=r.mediaDescriptions.find(h=>h.attributes.mid===l);d&&(Im(d,s),yM(d,s,this.store.codec))}),Hd(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,n,i)=>{var r;(r=this.onFirstVideoDecoded)===null||r===void 0||r.call(this,e,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(e,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,e,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,e,n)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,n){if(e.length===n.length)for(let d=0;d<e.length;d++){var i,r,s,c,l;const h=e[d],p=n[d];if(p instanceof sn&&!mt(i=p._hints).call(i,Ye.LOW_STREAM)&&(r=p._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((s=p._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(c=p._scalabilityMode)!==null&&c!==void 0&&c.numSpatialLayers&&((l=p._scalabilityMode)===null||l===void 0?void 0:l.numSpatialLayers)>1&&this.store.codec==="vp8"){const m={},_={high:1e3*(p._encoderConfig.bitrateMax-50),medium:5e4};m.encodings=[{rid:"m",active:!0,maxBitrate:_.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:_.high}];const E=h.sender.getParameters();await h.sender.setParameters(Object.assign(E,m))}}}async applySimulcastEncodings(e,n){if(!An()&&e.length===n.length)for(let i=0;i<e.length;i++){const r=n[i];if(r instanceof sn&&this.isVP8Simulcast(r)){const s=e[i],c={},l={high:1e3*(r._encoderConfig.bitrateMax-50),medium:5e4};c.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:l.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:l.medium,scaleResolutionDownBy:4}];const d=s.sender.getParameters();await s.sender.setParameters(Object.assign(d,c))}}}isVP8Simulcast(e){var n,i,r,s,c;return!!(e instanceof sn&&k("SIMULCAST")&&this.store.codec==="vp8"&&!mt(n=e._hints).call(n,Ye.LOW_STREAM)&&(i=e._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((r=e._encoderConfig)===null||r===void 0?void 0:r.bitrateMax)>200&&(s=e._scalabilityMode)!==null&&s!==void 0&&s.numSpatialLayers&&((c=e._scalabilityMode)===null||c===void 0?void 0:c.numSpatialLayers)>1)}logSDPExchange(e,n,i,r){if(k("SDP_LOGGING"))return T.upload("[".concat(this.store.clientId,"] exchanging ").concat(i," ").concat(n," SDP during P2PConnection.").concat(r,`
`),e),n==="offer"?s=>{this.logSDPExchange(s,"answer",i==="local"?"remote":"local",r)}:void 0}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(c=>c.mid&&e.indexOf(c.mid)!==-1);if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(c=>{c.direction="inactive"});const i=await this.peerConnection.createOffer(),r=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(e);const s=this.remoteSDP.toString();r==null||r(s),await this.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new Z(P.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(c=>c.mid&&e.indexOf(c.mid)!==-1);if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async c=>{c.direction="sendonly"});const i=await this.peerConnection.createOffer(),r=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(e);const s=this.remoteSDP.toString();r==null||r(s),await this.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new Z(P.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}async getRemoteSSRC(e,n){var i;if(n=n??((i=this.currentRemoteDescription)===null||i===void 0?void 0:i.sdp)){var r;const s=(r=Wr(n).mediaDescriptions.find(c=>c.attributes.mid===e))===null||r===void 0?void 0:r.attributes.ssrcs;return s==null?void 0:s[0].ssrcId}}async setRemoteDescription(e){var n;await this.peerConnection.setRemoteDescription(e),mt(n=["connected","completed"]).call(n,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(e,n,i){const r=Wr(e),s=r.mediaDescriptions.find(c=>c.attributes.mid===n);return s&&i===Ct.AUDIO&&s.media.mediaType==="audio"&&Om(s),Hd(r)}},Dt(on.prototype,"establish",[Gs],Object.getOwnPropertyDescriptor(on.prototype,"establish"),on.prototype),Dt(on.prototype,"connect",[Gs],Object.getOwnPropertyDescriptor(on.prototype,"connect"),on.prototype),Dt(on.prototype,"receive",[Gs],Object.getOwnPropertyDescriptor(on.prototype,"receive"),on.prototype),Dt(on.prototype,"mockReceive",[Gs],Object.getOwnPropertyDescriptor(on.prototype,"mockReceive"),on.prototype),Dt(on.prototype,"stopReceiving",[Gs],Object.getOwnPropertyDescriptor(on.prototype,"stopReceiving"),on.prototype),Dt(on.prototype,"restartICE",[Gs],Object.getOwnPropertyDescriptor(on.prototype,"restartICE"),on.prototype),Dt(on.prototype,"close",[Gs],Object.getOwnPropertyDescriptor(on.prototype,"close"),on.prototype),Dt(on.prototype,"updateEncoderConfig",[Gs],Object.getOwnPropertyDescriptor(on.prototype,"updateEncoderConfig"),on.prototype),Dt(on.prototype,"updateSendParameters",[Gs],Object.getOwnPropertyDescriptor(on.prototype,"updateSendParameters"),on.prototype),Dt(on.prototype,"replaceTrack",[Gs],Object.getOwnPropertyDescriptor(on.prototype,"replaceTrack"),on.prototype),Dt(on.prototype,"muteLocal",[Gs],Object.getOwnPropertyDescriptor(on.prototype,"muteLocal"),on.prototype),Dt(on.prototype,"unmuteLocal",[Gs],Object.getOwnPropertyDescriptor(on.prototype,"unmuteLocal"),on.prototype),on);function Gs(t,e,n){const i=t[e];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const r=this.mutex,s=await r.lock("From P2PConnection.".concat(e));try{for(var c=arguments.length,l=new Array(c),d=0;d<c;d++)l[d]=arguments[d];return await i.apply(this,l)}finally{s()}},n}let Do=function(t){return t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY",t}({});var NV,DV,PV,kV,LV,xV,MV,UV,VV,jV,BV,gn;function FV(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Tb(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?FV(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):FV(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}let BW=(NV=Po(Do.SEND_ONLY),DV=Po(Do.SEND_ONLY),PV=Po(),kV=Po(Do.RECEIVE_ONLY),LV=Po(Do.RECEIVE_ONLY),xV=Po(Do.RECEIVE_ONLY),MV=Po(Do.RECEIVE_ONLY),UV=Po(Do.RECEIVE_ONLY),VV=Po(Do.RECEIVE_ONLY),jV=Po(),BV=Po(Do.RECEIVE_ONLY),gn=class extends Sn{get state(){return this._state}set state(t){const e=this._state;this._state=t,this.emit(Mt.StateChange,e,this._state)}constructor(t,e){super(),O(this,"isPlanB",!1),O(this,"store",void 0),O(this,"statsUploader",void 0),O(this,"sendConnection",void 0),O(this,"recvConnection",void 0),O(this,"localTrackMap",new Map),O(this,"remoteUserMap",new Map),O(this,"localDataChannels",[]),O(this,"pendingLocalTracks",[]),O(this,"pendingRemoteTracks",[]),O(this,"statsCollector",void 0),O(this,"dtlsFailedCount",0),O(this,"sendMutex",void 0),O(this,"recvMutex",void 0),O(this,"_state",Me.Disconnected),O(this,"_restartStates",["disconnected","failed"]),O(this,"reconnectInterval",void 0),O(this,"uploadUnplinkStarted",!1),O(this,"uploadDownlinkStarted",!1),O(this,"uplinkStateUploadInterval",void 0),O(this,"downlinkStatsUploadInterval",void 0),O(this,"handleMuteLocalTrack",async(n,i,r)=>{const s=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==Me.Connected)return void r(new Z(P.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const d=this.filterTobeMutedTracks(n);if(d.length===0)return void i();const h=d.find(E=>E[0]==="videoLowTrack");h&&h[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(d.map(E=>{let[,{id:I}]=E;return I}));let p=!1;var c,l;n.trackMediaType==="video"?p=!((c=this.localTrackMap.get(ot.LocalAudioTrack))===null||c===void 0||!c.track._muted):p=((l=this.localTrackMap.get(ot.LocalVideoTrack))===null||l===void 0?void 0:l.id)===void 0;const m=this.createMuteMessage(d);await Qe(this,Mt.RequestMuteLocal,m);const _=n.trackMediaType==="video"?qd.MUTE_LOCAL_VIDEO:qd.MUTE_LOCAL_AUDIO;await Qe(this,Mt.RequestP2PMuteLocal,{action:_,message:m,isMuteAll:p}),i()}catch(d){r(d)}finally{s()}}),O(this,"handleUnmuteLocalTrack",async(n,i,r)=>{const s=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==Me.Connected)return void r(new Z(P.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const c=this.filterTobeUnmutedTracks(n);if(c.length===0)return void i();await this.sendConnection.unmuteLocal(c.map(h=>{let[,{id:p}]=h;return p}));const l=this.createUnmuteMessage(c),d=n.trackMediaType==="video"?qd.UNMUTE_LOCAL_VIDEO:qd.UNMUTE_LOCAL_AUDIO;await Qe(this,Mt.RequestP2PMuteLocal,{action:d,message:l}),i()}catch(c){r(c)}finally{s()}}),O(this,"handleUpdateVideoEncoder",async(n,i,r,s)=>{let c;typeof s=="boolean"&&s||(c=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const d=this.localTrackMap.get(ot.LocalVideoTrack);if(!this.sendConnection||!d||d.track!==n||this.state!==Me.Connected)return void i();const{id:h,track:p}=d;h&&(await this.sendConnection.updateSendParameters(h,p),await this.sendConnection.updateEncoderConfig(h,p),this.emit(Mt.UpdateVideoEncoder,p)),i()}catch(d){r(d)}finally{var l;(l=c)===null||l===void 0||l()}}),O(this,"handleUpdateVideoSendParameters",async(n,i,r)=>{const s=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const c=this.localTrackMap.get(ot.LocalVideoTrack);if(!this.sendConnection||!c||c.track!==n||this.state!==Me.Connected)return void i();const{id:l,track:d}=c;l&&await this.sendConnection.updateSendParameters(l,d),i()}catch(c){r(c)}finally{s()}}),O(this,"handleReplaceTrack",async(n,i,r,s)=>{let c;T.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof s=="boolean"&&s||(c=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var l;const h=Array.from(this.localTrackMap.entries()).find(p=>{let[,{track:m}]=p;return n===m});if(!this.sendConnection||!h||h[1].id===void 0||this.state!==Me.Connected)return void i();if(await((l=this.sendConnection)===null||l===void 0?void 0:l.replaceTrack(n,h[1].id)),h[0]===ot.LocalVideoTrack&&be().supportDualStreamEncoding){const p=this.localTrackMap.get(ot.LocalVideoLowTrack);if(p){const m=n._mediaStreamTrack.clone();p.track._originMediaStreamTrack.stop(),p.track._mediaStreamTrack=m,p.track._originMediaStreamTrack=m,await new Tt((_,E)=>{this.handleReplaceTrack(p.track,_,E,!0)})}}i()}catch(h){r(h)}finally{var d;(d=c)===null||d===void 0||d()}}),O(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),O(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),O(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),O(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=t,this.statsCollector=e,this.statsCollector.addP2PChannel(this),this.statsUploader=new a2(t),this.bindStatsUploaderEvents(),this.sendMutex=new Wi("P2PChannel2-send-mutex",t.clientId),this.recvMutex=new Wi("P2PChannel2-recv-mutex",t.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(n=>{n&&(n.iceConnectionState!=="disconnected"&&n.iceConnectionState!=="failed"||this.handleDisconnect(n.direction))})},k("ICE_RESTART_INTERVAL"))}async startP2PConnection(t,e){throw new Z(P.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(t){throw new Z(P.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(t,e){let n;try{if(e){this.recvConnection&&(T.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),n=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new OV(t,this.store,Sr.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const i=await this.recvConnection.establish(e);return{iceParameters:i.iceParameters,dtlsParameters:i.dtlsParameters,sdp:i.sdp}}{this.state=Me.New,this.sendConnection&&(T.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),n=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new OV(t,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const i=await this.sendConnection.establish();return{iceParameters:i.iceParameters,dtlsParameters:i.dtlsParameters,sdp:i.sdp}}}finally{n&&n()}}async p2pConnect(t){if(!this.sendConnection)throw new Z(P.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(t),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Me.Connected}async addRemoteCandidate(t,e){if(e===Sr.RECEIVE_ONLY){if(!this.sendConnection)throw new Z(P.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(t)}else{if(!this.recvConnection)throw new Z(P.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(t)}}publish(t,e,n){var i=this;return Za(function*(){const r=yield Re(i.sendMutex.lock("From P2PChannel.publish"));try{if(!i.sendConnection||i.state!==Me.Connected){i.throwIfTrackTypeNotMatch(t);const h=t.filter(p=>i.pendingLocalTracks.indexOf(p)===-1);return void(i.pendingLocalTracks=i.pendingLocalTracks.concat(h))}i.store.pubId=i.store.pubId+1,Yi.markPublishStart(i.store.clientId,i.store.pubId);const s=i.filterTobePublishedTracks(t,e,n);if(s.length===0)return void(yield Re(i.tryToUnmuteAudio(t)));s.forEach(h=>{let{track:p,type:m}=h;const _=Date.now();i.store.publish(p.getTrackId(),m===ot.LocalAudioTrack?"audio":"video",_)}),i.bindLocalTrackEvents(s);const c=yield Re(i.sendConnection.send(s.map(h=>{let{track:p}=h;return p}),i.store.codec,i.store.audioCodec)),l=(yield Re(c.next())).value,d=i.createGatewayPublishMessage(s,l);try{yield d}catch(h){throw c.throw(h),(h==null?void 0:h.code)===P.WS_ABORT&&s.forEach(p=>{let{track:m}=p;i.pendingLocalTracks.indexOf(m)===-1&&i.pendingLocalTracks.push(m)}),i.unbindLocalTrackEvents(s),h}yield Re(c.next()),s.forEach(h=>{let{type:p}=h;i.statsCollector.addLocalStats(p)}),i.statsUploader.startUploadOutboundStats(),i.assignLocalTracks(s,l),s.forEach(h=>{let{track:p,type:m}=h;const _=Date.now();i.store.publish(p.getTrackId(),m===ot.LocalAudioTrack?"audio":"video",void 0,_)}),i.startUploadUplinkState()}finally{r()}})()}async unpublish(t){if(!this.sendConnection||this.state!==Me.Connected)return void(t.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(r=>!mt(t).call(t,r)));const e=this.filterTobeUnpublishedTracks(t);if(e.length===0)return;const n=e.find(r=>r[0]==="videoLowTrack");n&&n[1].track.close();const i=this.createGatewayUnpublishMessage(e);if(await this.sendConnection.stopSending(e.map(r=>{let[,{id:s}]=r;return s})),this.withdrawLocalTracks(e),this.unbindLocalTrackEvents(e.map(r=>{let[s,{track:c}]=r;return{type:s,track:c}})),e.forEach(r=>{let[s]=r;this.statsCollector.removeLocalStats(s)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===Me.Connected)return n&&n[1].track.close(),i;t.forEach(r=>{const s=this.pendingLocalTracks.indexOf(r);s!==-1&&this.pendingLocalTracks.splice(s,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const t=()=>{const e=[],n=[];Array.from(this.localTrackMap.entries()).forEach(i=>{let[r,{track:s,ssrcs:c}]=i;const l={stream_type:D8(s,r),ssrcs:c};s._muted||!s._enabled?e.push(l):n.push(l)}),e.length>0&&e.forEach(i=>{Qe(this,Mt.RequestMuteLocal,[i])}),n.length>0&&n.forEach(i=>{Qe(this,Mt.RequestUnmuteLocal,[i])})};t(),this.uplinkStateUploadInterval=window.setInterval(()=>{t()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(t){return Za(function*(){throw new Z(P.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(T.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await ki(this,Mt.RequestRePublish,this.pendingLocalTracks),this.emit(Mt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new Z(P.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(t,e,n,i){var r;if(!this.recvConnection)throw new Z(P.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((r=this.remoteUserMap.get(t))!==null&&r!==void 0&&r.has(e))return;const{track:s,mid:c,transceiver:l}=await this.recvConnection.receive(e,[{ssrcId:n}],String(t.uid),i);e===Ct.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(s):(t._audioTrack=new Sm(s,t.uid,t._uintid,this.store),T.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),l&&t._audioTrack._updateRtpTransceiver(l),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoSSRC=n,t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(s):(t._videoTrack=new vm(s,t.uid,t._uintid,this.store),T.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),l&&t._videoTrack._updateRtpTransceiver(l),this.bindRemoteTrackEvents(t,t._videoTrack));const d=this.remoteUserMap.get(t);d?d.set(e,c):this.remoteUserMap.set(t,new Map([[e,c]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const h=this.pendingRemoteTracks.findIndex(p=>{let{user:m,kind:_}=p;return m.uid===t.uid&&e===_});h!==-1&&(this.pendingRemoteTracks.splice(h,1),this.emit(Mt.MediaReconnectEnd,t.uid))}async mockSubscribe(t,e,n,i){if(!this.recvConnection)throw new Z(P.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(e,[{ssrcId:n}],String(t.uid),i)}async unsubscribe(t,e,n){const i=this.pendingRemoteTracks.filter(s=>{let{user:c,kind:l}=s;return e!==void 0?c.uid===t.uid&&e===l:c.uid===t.uid});if(i.forEach(s=>{const c=this.pendingRemoteTracks.indexOf(s);this.pendingRemoteTracks.splice(c,1)}),this.recvConnection||n||i.forEach(s=>{let{kind:c}=s;var l;if(c===Ct.AUDIO)(l=t._audioTrack)===null||l===void 0||l._destroy(),t._audioTrack=void 0;else if(c===Ct.VIDEO){var d;(d=t._videoTrack)===null||d===void 0||d._destroy(),t._videoTrack=void 0}}),!this.recvConnection)return;const r=this.filterTobeUnSubscribedTracks(t,e);r.length!==0&&(await this.recvConnection.stopReceiving(r.map(s=>{let[,{id:c}]=s;return c})),this.withdrawRemoteTracks(r),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),r.forEach(s=>{let[c,{kind:l}]=s;var d,h;if(l===Ct.VIDEO&&c._videoSSRC&&((d=this.recvConnection)===null||d===void 0||d.setStatsRemoteVideoIsReady(c._videoSSRC,!1)),l===Ct.VIDEO)this.unbindRemoteTrackEvents(c._videoTrack),n||((h=c._videoTrack)===null||h===void 0||h._destroy(),c._videoTrack=void 0);else if(l===Ct.AUDIO){var p;this.unbindRemoteTrackEvents(c._audioTrack),!n&&((p=c._audioTrack)===null||p===void 0||p._destroy(),c._audioTrack=void 0)}}),r.forEach(s=>{let[,{kind:c}]=s;Qe(this,Mt.RequestP2PMuteRemote,c)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const t=()=>Array.from(this.remoteUserMap.entries()).forEach(e=>{let[,n]=e;[Ct.VIDEO,Ct.AUDIO].forEach(i=>{n.has(i)?Qe(this,Mt.RequestP2PUnmuteRemote,i):Qe(this,Mt.RequestP2PMuteRemote,i)})});t(),this.downlinkStatsUploadInterval=window.setInterval(()=>{t()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(t){throw new Z(P.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(t){throw new Z(P.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(t){throw new Z(P.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(t){throw new Z(P.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(t,e){if(!this.recvConnection)return;const n=this.remoteUserMap.get(t);if(!n)return void T.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid,"."));if(!n.get(e))return void T.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."));const i=e===Ct.VIDEO?t._videoSSRC:t._audioSSRC;i!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(i,!1)}async unmuteRemote(t,e){return this.unmuteRemoteNoLock(t,e)}async unmuteRemoteNoLock(t,e){if(!this.recvConnection)return;const n=this.remoteUserMap.get(t);if(!n)return void T.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid,"."));n.get(e)||T.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."))}getAllTracks(t){const e=this.localTrackMap.get(ot.LocalAudioTrack);if((e==null?void 0:e.track)instanceof $n){const n=e.track;return Array.from(this.localTrackMap.entries()).filter(i=>{let[r]=i;return r!==ot.LocalAudioTrack}).filter(i=>{let[r]=i;return!(t&&r===ot.LocalVideoLowTrack)}).map(i=>{let[,{track:r}]=i;return r}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[i]=n;return!(t&&i===ot.LocalVideoLowTrack)}).map(n=>{let[,{track:i}]=n;return i})}reportPublishEvent(t,e,n,i,r){if(t){const c=this.localTrackMap.get(ot.LocalAudioTrack),l=i?this.localTrackMap.get(ot.LocalVideoLowTrack):this.localTrackMap.get(ot.LocalVideoTrack);Pt.publish(this.store.sessionId,{eventElapse:Yi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:c==null?void 0:c.track.getTrackLabel(),videoName:l==null?void 0:l.track.getTrackLabel(),screenshare:(l==null?void 0:l.track._hints.indexOf(Ye.SCREEN_TRACK))!==-1,audio:!!c,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}else{var s;n||(n=[]);const c=n.find(d=>d instanceof Nn),l=i?(s=this.localTrackMap.get(ot.LocalVideoTrack))===null||s===void 0?void 0:s.track:n.find(d=>d instanceof sn);Pt.publish(this.store.sessionId,{eventElapse:Yi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:c==null?void 0:c.getTrackLabel(),videoName:l==null?void 0:l.getTrackLabel(),screenshare:(l==null?void 0:l._hints.indexOf(Ye.SCREEN_TRACK))!==-1,audio:!!c,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}}reportSubscribeEvent(t,e,n,i){const r=i===Ct.VIDEO?n._videoSSRC:n._audioSSRC;r&&Pt.subscribe(this.store.sessionId,{succ:t,ec:e,video:i===Ct.VIDEO,audio:i===Ct.AUDIO,peerid:n.uid,subscribeRequestid:i===Ct.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:Yi.measureFromSubscribeStart(this.store.clientId,r)})}reset(){T.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new Wi("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new Wi("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(ot.LocalAudioTrack);if((t==null?void 0:t.track)instanceof $n){if(t.track.trackList.length>0){const e=t.track;t.track.trackList.forEach(n=>{e.removeAudioTrack(n)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=Me.Disconnected}getStats(t){var e,n;return t?(n=this.recvConnection)===null||n===void 0?void 0:n.getStats():(e=this.sendConnection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(t){var e;return((e=this.recvConnection)===null||e===void 0?void 0:e.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(ot.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(ot.LocalVideoTrack);if(t)return{width:t.track.videoWidth||0,height:t.track.videoHeight||0}}getEncoderConfig(t){const e=this.localTrackMap.get(t);return e&&e.track instanceof sn||e&&e.track instanceof Nn?e.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,e){if(!t)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(t);return!!n&&(!e||n.has(e))}async hasRemoteMediaWithLock(t,e){if(!t)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(t);return!!n&&(!e||n.has(e))}getRemoteMedia(t){var e;const n=Array.from(zr(e=this.remoteUserMap).call(e)).find(i=>i.uid===t);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(n=>{let[i]=n;return{uid:i.uid,level:i.audioTrack?100*i.audioTrack._source.getAccurateVolumeLevel():0}});const e=this.localTrackMap.get(ot.LocalAudioTrack);return e&&t.push({level:100*e.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=Zt(t).call(t,(n,i)=>n.level-i.level),t}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(T.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=Me.Reconnecting,k("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e]=t;var n;e._videoTrack&&e._videoTrack._player&&((n=e._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),e._videoTrack._player.isKeepLastFrame=!0,e._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var e;let[n,{track:i}]=t;switch(n){case ot.LocalVideoTrack:mt(e=i._hints).call(e,Ye.LOW_STREAM)?i.close():this.pendingLocalTracks.push(i);break;case ot.LocalAudioTrack:i instanceof $n?this.pendingLocalTracks=this.pendingLocalTracks.concat(i.trackList):this.pendingLocalTracks.push(i);case ot.LocalVideoLowTrack:}}),this.emit(Mt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,n]=t;Array.from(zr(n).call(n)).forEach(i=>{this.setPendingRemoteMedia(e,i)}),this.emit(Mt.MediaReconnectStart,e.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),T.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(t,e){for(const n of this.pendingRemoteTracks){const{user:i,kind:r}=n;if((t instanceof $d?t.uid:t)===i.uid&&e===r)return!0}return!1}setPendingRemoteMedia(t,e){this.hasPendingRemoteMedia(t,e)||this.pendingRemoteTracks.push({user:t,kind:e})}async restartICE(t,e){let n,i;if(t===Sr.SEND_ONLY){if(!this.sendConnection)throw new Z(P.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");n=await this.sendMutex.lock("From P2PChannel.restartICE"),i=this.sendConnection}else{if(!this.recvConnection)throw new Z(P.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");n=await this.recvMutex.lock("From P2PChannel.restartICE"),i=this.recvConnection}try{if(e){const r=await i.restartICE(e);return i.isInRestartIce=!1,r}{const r=await i.restartICE();if(r){const s=await ki(this,Mt.RequestP2PRestartICE,{direction:Sr.RECEIVE_ONLY,iceParameter:r});await i.restartICE(s),i.isInRestartIce=!1}}}finally{n()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const t=this.sendConnection.getStats(),e=this.localTrackMap.get(ot.LocalVideoTrack),n=this.localTrackMap.get(ot.LocalAudioTrack),i=t.videoSend.find(E=>{var I;return E.ssrc===(e==null||(I=e.ssrcs)===null||I===void 0?void 0:I[0].ssrcId)}),r=t.audioSend.find(E=>{var I;return E.ssrc===(n==null||(I=n.ssrcs)===null||I===void 0?void 0:I[0].ssrcId)});if(!i||!r)return 1;const s=Ca(this,Mt.NeedSignalRTT),c=i?i.rttMs:void 0,l=r?r.rttMs:void 0,d=c&&l?(c+l)/2:c||l,h=(d&&s?(d+s)/2:d||s)||0,p=100*t.sendPacketLossRate*.7/50+.3*h/1500,m=p<.17?1:p<.36?2:p<.59?3:p<.1?4:5,_=e==null?void 0:e.track;if(_&&_._encoderConfig&&_._hints.indexOf(Ye.SCREEN_TRACK)===-1){const E=_._encoderConfig.bitrateMax,I=t.bitrate.actualEncoded;if(E&&I){const C=(1e3*E-I)/(1e3*E);return Xx[C<.15?0:C<.3?1:C<.45?2:C<.6?3:4][m]}}return m}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const t=this.recvConnection.getStats();let e=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[i]=n;const r=i._audioSSRC,s=i._videoSSRC,c=t.audioRecv.find(I=>I.ssrc===r),l=t.videoRecv.find(I=>I.ssrc===s);if(!c&&!l)return void(e+=1);const d=Ca(this,Mt.NeedSignalRTT),h=t.rtt,p=(h&&d?(h+d)/2:h||d)||0,m=c?c.jitterMs:void 0,_=t.recvPacketLossRate;let E=.7*_*100/50+.3*p/1500;m&&(E=.6*_*100/50+.2*p/1500+.2*m/400),e+=E<.1?1:E<.17?2:E<.36?3:E<.59?4:5}),this.remoteUserMap.size>0?Math.round(e/this.remoteUserMap.size):e}async muteLocalTrack(t){return new Tt((e,n)=>{this.handleMuteLocalTrack(t,e,n)})}filterTobePublishedTracks(t,e,n){const i=[],r=be(),s=this.getAllTracks();t=sm(t=t.filter(d=>s.indexOf(d)===-1));let c=!1,l=!1;for(const d of t){if(d instanceof sn&&(this.localTrackMap.has(ot.LocalVideoTrack)||c?new Z(P.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(i.push({track:d,type:ot.LocalVideoTrack}),c=!0),e)){const h=this.getLowVideoTrack(d,n);i.push({track:h,type:ot.LocalVideoLowTrack})}if(d instanceof Nn){const h=this.localTrackMap.get(ot.LocalAudioTrack);if(h){if(!(h.track instanceof $n))throw new Z(P.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(d._bypassWebAudio)throw new Z(P.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");h.track.addAudioTrack(d),this.bindLocalAudioTrackEvents(d,!0)}else if(l){const p=i.find(m=>{let{type:_}=m;return _===ot.LocalAudioTrack});if(!(p.track instanceof $n))throw new Z(P.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(d._bypassWebAudio)throw new Z(P.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");p.track.addAudioTrack(d)}else{if(!r.webAudioMediaStreamDest||d instanceof $n||d._bypassWebAudio)i.push({track:d,type:ot.LocalAudioTrack});else{const p=new $n;p.addAudioTrack(d),i.push({track:p,type:ot.LocalAudioTrack})}l=!0}}}return i}filterTobeUnpublishedTracks(t){const e=[],n=this.getAllTracks();t=sm(t=t.filter(i=>n.indexOf(i)!==-1));for(const i of t){if(i instanceof Nn){const r=this.localTrackMap.get(ot.LocalAudioTrack);if(!r)continue;r.track instanceof $n?(r.track.removeAudioTrack(i),this.unbindLocalAudioTrackEvents(i),r.track.trackList.length===0&&(e.push([ot.LocalAudioTrack,r]),r.track.close())):e.push([ot.LocalAudioTrack,r])}if(i instanceof sn){const r=this.localTrackMap.get(ot.LocalVideoTrack);if(!r)continue;e.push([ot.LocalVideoTrack,r]);const s=this.localTrackMap.get(ot.LocalVideoLowTrack);s&&e.push([ot.LocalVideoLowTrack,s])}}return e}bindLocalTrackEvents(t){t.forEach(e=>{let{track:n,type:i}=e;switch(i){case ot.LocalVideoTrack:n.addListener(It.GET_STATS,this.handleGetLocalVideoStats),n.addListener(It.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(It.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(It.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(It.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(It.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(It.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(It.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ot.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case ot.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,e){t instanceof $n?t.trackList.forEach(n=>{n.addListener(It.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(It.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(It.GET_STATS,this.handleGetLocalAudioStats),n.addListener(It.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(It.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(It.GET_STATS,this.handleGetLocalAudioStats),t.addListener(It.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(It.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(It.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(It.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),e||t.addListener(It.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(e=>{let[n,{track:i}]=e;return{track:i,type:n}})),t.forEach(e=>{let{track:n,type:i}=e;switch(i){case ot.LocalVideoTrack:n.off(It.GET_STATS,this.handleGetLocalVideoStats),n.off(It.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(It.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(It.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(It.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(It.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(It.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(It.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ot.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case ot.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof $n?t.trackList.forEach(e=>{e.off(It.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(It.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(It.GET_STATS,this.handleGetLocalAudioStats),e.off(It.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(It.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(It.GET_STATS,this.handleGetLocalAudioStats),t.off(It.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(It.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(It.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(It.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(It.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,e){e instanceof vm&&e.addListener(It.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(t))}),e instanceof Sm&&e.addListener(It.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(It.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,n]=t;n.has(Ct.AUDIO)&&this.unbindRemoteTrackEvents(e._audioTrack),n.has(Ct.VIDEO)&&this.unbindRemoteTrackEvents(e._videoTrack)})}createGatewayPublishMessage(t,e){return t.map((n,i)=>{var r;let s,{track:c,type:l}=n;switch(l){case ot.LocalAudioTrack:s=Ve.Audio;break;case ot.LocalVideoTrack:s=mt(r=c._hints).call(r,Ye.SCREEN_TRACK)?Ve.Screen:Ve.High;break;case ot.LocalVideoLowTrack:s=Ve.Low}return{kind:l===ot.LocalAudioTrack?Ct.AUDIO:Ct.VIDEO,stream_type:s,mid:e[i].id,ssrcs:e[i].localSSRC,isMuted:c.muted||!c.enabled}})}createGatewayUnpublishMessage(t){return t.map(e=>{var n;let i,[r,{track:s,ssrcs:c,id:l}]=e;switch(r){case ot.LocalVideoTrack:i=mt(n=s._hints).call(n,Ye.SCREEN_TRACK)?Ve.Screen:Ve.High;break;case ot.LocalAudioTrack:i=Ve.Audio;break;case ot.LocalVideoLowTrack:i=Ve.Low}return{stream_type:i,ssrcs:c,mid:l}})}assignLocalTracks(t,e){t.forEach((n,i)=>{let{track:r,type:s}=n;this.localTrackMap.set(s,{track:r,id:e[i].id,ssrcs:e[i].localSSRC})})}withdrawLocalTracks(t){t.forEach(e=>{let[n]=e;this.localTrackMap.delete(n)})}bindConnectionEvents(t){t.onConnectionStateChange=async e=>{var n;T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(t.name,".onConnectionStateChange(").concat(e,")")),this.emit(Mt.PeerConnectionStateChange,e),e!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),e==="connected"&&(t.isInRestartIce=!1),mt(n=this._restartStates).call(n,e)&&!t.isInRestartIce&&(e==="disconnected"&&await yi(800),t.iceConnectionState!=="disconnected"&&t.iceConnectionState!=="failed"||this.handleDisconnect(t.direction))},t.onICEConnectionStateChange=e=>{e!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),Pt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:_n.TRACER}).onSuccess(),this.emit(Mt.IceConnectionStateChange,e)},t.onICETransportStateChange=e=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},t.onDTLSTransportStateChange=e=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},t.onDTLSTransportError=e=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},t.onFirstAudioDecoded=e=>{var n;const i=Array.from(zr(n=this.remoteUserMap).call(n)).find(s=>s._audioSSRC===e);var r;i&&(this.store.subscribe(i.uid,"audio",void 0,void 0,void 0,Date.now()),(r=i.audioTrack)===null||r===void 0||r.emit(es.FIRST_FRAME_DECODED),Pt.firstRemoteFrame(this.store.sessionId,ai.FIRST_AUDIO_DECODE,pn.FIRST_AUDIO_DECODE,{peer:i._uintid,subscribeElapse:Yi.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=e=>{var n;const i=Array.from(zr(n=this.remoteUserMap).call(n)).find(r=>r._audioSSRC===e);i&&Pt.firstRemoteFrame(this.store.sessionId,ai.FIRST_AUDIO_RECEIVED,pn.FIRST_AUDIO_RECEIVED,{peer:i._uintid,subscribeElapse:Yi.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(e,n,i)=>{this.reportVideoFirstFrameDecoded(e,n,i)},t.onFirstVideoReceived=e=>{var n;const i=Array.from(zr(n=this.remoteUserMap).call(n)).find(r=>r._videoSSRC===e);i&&Pt.firstRemoteFrame(this.store.sessionId,ai.FIRST_VIDEO_RECEIVED,pn.FIRST_VIDEO_RECEIVED,{peer:i._uintid,subscribeElapse:Yi.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onSelectedLocalCandidateChanged=(e,n)=>{const i=e.candidateType==="relay",r=n.candidateType==="relay";n.candidateType!=="unknown"&&i===r||this.emit(Mt.ConnectionTypeChange,i),T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Yd(n))," -> ").concat(JSON.stringify(Yd(e)),")"))},t.onSelectedRemoteCandidateChanged=(e,n)=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Yd(n))," -> ").concat(JSON.stringify(Yd(e)),")"))},t.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},t.onLocalCandidate=e=>{this.emit(Mt.LocalCandidate,{candidate:e,direction:t.direction})}}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.onLocalCandidate=void 0}async handleDisconnect(t){const e=t===Sr.SEND_ONLY?this.sendConnection:this.recvConnection;e&&!e.isInRestartIce&&(e.isInRestartIce=!0,T.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(e.name,"] start use restartICE")),t===Sr.SEND_ONLY?this.restartICE(t):ki(this,Mt.RequestP2PRestartICE,{direction:Sr.SEND_ONLY}))}filterTobeMutedTracks(t){const e=[];if(this.getAllTracks().indexOf(t)===-1)return e;const n=this.localTrackMap.get(ot.LocalAudioTrack);if(t instanceof Nn&&(n==null?void 0:n.track)instanceof $n)return n.track.isActive||e.push([ot.LocalAudioTrack,n]),e;const i=Array.from(this.localTrackMap.entries()).find(r=>{let[,{track:s}]=r;return t===s});if(i&&(e.push(i),i[0]===ot.LocalVideoTrack)){const r=this.localTrackMap.get(ot.LocalVideoLowTrack);r&&e.push([ot.LocalVideoLowTrack,r])}return e}filterTobeUnmutedTracks(t){const e=[],n=this.localTrackMap.get(ot.LocalAudioTrack);if(t instanceof Nn&&(n==null?void 0:n.track)instanceof $n)return n.track.isActive&&e.push([ot.LocalAudioTrack,n]),e;const i=Array.from(this.localTrackMap.entries()).find(r=>{let[,{track:s}]=r;return t===s});if(i)if(i[0]===ot.LocalVideoTrack){e.push(i);const r=this.localTrackMap.get(ot.LocalVideoLowTrack);r&&e.push([ot.LocalVideoLowTrack,r])}else e.push(i);return e}createMuteMessage(t){return t.map(e=>{var n;let i,[r,{track:s,ssrcs:c,id:l}]=e;switch(r){case ot.LocalAudioTrack:i=Ve.Audio;break;case ot.LocalVideoTrack:i=mt(n=s._hints).call(n,Ye.SCREEN_TRACK)?Ve.Screen:Ve.High;break;case ot.LocalVideoLowTrack:i=Ve.Low}return{stream_type:i,ssrcs:c,mid:l}})}createUnmuteMessage(t){return t.map(e=>{var n;let i,[r,{track:s,ssrcs:c,id:l}]=e;switch(r){case ot.LocalAudioTrack:i=Ve.Audio;break;case ot.LocalVideoTrack:i=mt(n=s._hints).call(n,Ye.SCREEN_TRACK)?Ve.Screen:Ve.High;break;case ot.LocalVideoLowTrack:i=Ve.Low}return{stream_type:i,ssrcs:c,mid:l}})}filterTobeUnSubscribedTracks(t,e){const n=[],i=this.remoteUserMap.get(t);if(!i)return n;if(e){const r=i.get(e);if(!r)return n;n.push([t,{kind:e,id:r}])}else Array.from(i.entries()).forEach(r=>{let[s,c]=r;n.push([t,{kind:s,id:c}])});return n}createUnsubscribeMessage(t){const e=[];return t.forEach(n=>{let[i,{kind:r,id:s}]=n;switch(r){case Ct.VIDEO:return void(i._videoSSRC&&e.push({stream_type:Ct.VIDEO,ssrcId:i._videoSSRC}));case Ct.AUDIO:return void(i._audioSSRC&&e.push({stream_type:Ct.AUDIO,ssrcId:i._audioSSRC}))}}),e}withdrawRemoteTracks(t){t.forEach(e=>{let[n,{kind:i}]=e;const r=this.remoteUserMap.get(n);r&&(r.delete(i),Array.from(r.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(t){const e=this.localTrackMap.get(ot.LocalVideoTrack),n=this.localTrackMap.get(ot.LocalVideoLowTrack);e&&(await e.track.setBitrateLimit(t.uplink),await new Tt((i,r)=>{this.handleUpdateVideoEncoder(e.track,i,r,!0)})),n&&t.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0}),await new Tt((i,r)=>{this.handleUpdateVideoEncoder(n.track,i,r,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const t=this.sendConnection.peerConnectionState,e=this.recvConnection.peerConnectionState;return t!=="connected"&&e!=="connected"}return!0}async tryToUnmuteAudio(t){for(let e=0;e<t.length;e++)if(t[e]instanceof Nn){const n=this.filterTobeUnmutedTracks(t[e]);if(n.length===0)continue;const i=this.createUnmuteMessage(n);return void await Qe(this,Mt.RequestUnmuteLocal,i)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=t=>this.getStats(t),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(t=>{let[,{ssrcs:e}]=t;return!!e}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var e;return!((e=this.recvConnection)===null||e===void 0||!e.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,e)=>this.emit(Mt.RequestUpload,t,e),this.statsUploader.requestUploadStats=t=>this.emit(Mt.RequestUploadStats,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await yi(YA(this.dtlsFailedCount,Xn)),this.emit(Mt.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(ot.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof sn)}throwIfTrackTypeNotMatch(t){if(t.filter(e=>e instanceof sn).length>1)throw new Z(P.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(e=>e instanceof Nn).length>1&&(t.some(e=>e instanceof Nn&&e._bypassWebAudio)||!be().webAudioMediaStreamDest))throw new Z(P.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const e of t){if(e instanceof sn&&this.pendingLocalTracks.some(n=>n instanceof sn))throw new Z(P.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e instanceof Nn&&this.pendingLocalTracks.some(n=>n instanceof Nn)&&(!be().webAudioMediaStreamDest||e._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof Nn&&n._bypassWebAudio)))throw new Z(P.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,e){const n=!k("DISABLE_DUAL_STREAM_USE_ENCODING")&&be().supportDualStreamEncoding,i=Tb(Tb({},{width:160,height:120,framerate:15,bitrate:50}),e);let r;r=n?t._mediaStreamTrack.clone():dI(t,i);const s=Je(8,"track-low-"),c=new sn(r,Tb(Tb({},n&&{scaleResolutionDownBy:Ww(i,t)}),{},{frameRate:i.framerate,bitrateMax:i.bitrate,bitrateMin:i.bitrate}),void 0,void 0,s);return c.on(Mh.TRANSCEIVER_UPDATED,l=>{t._updateRtpTransceiver(l,pm.LOW_STREAM)}),c._hints.push(Ye.LOW_STREAM),t.addListener(It.NEED_CLOSE,()=>{c.close()}),c}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(t,e,n,i){var r;const s=Array.from(zr(r=this.remoteUserMap).call(r)).find(c=>c._videoSSRC===t);if(s){i||this.store.subscribe(s.uid,"video",void 0,void 0,void 0,void 0,Date.now());const c=this.store.keyMetrics,l=c.subscribe.find(d=>d.userId===s.uid&&d.type==="video");Pt.firstRemoteVideoDecode(this.store.sessionId,ai.FIRST_VIDEO_DECODE,pn.FIRST_VIDEO_DECODE,{peer:s._uintid,videowidth:e,videoheight:n,subscribeElapse:Yi.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:c.requestAPEnd||0,apStart:c.requestAPStart||0,joinGwEnd:c.joinGatewayEnd||0,joinGwStart:c.joinGatewayStart||0,pcEnd:c.peerConnectionEnd||0,pcStart:c.peerConnectionStart||0,subscriberEnd:(l==null?void 0:l.subscribeEnd)||0,subscriberStart:(l==null?void 0:l.subscribeStart)||0,videoAddNotify:(l==null?void 0:l.streamAdded)||0,state:i?1:0})}}async remoteMediaSsrcChanged(t,e,n){if(!this.recvConnection)return!1;const i=this.remoteUserMap.get(t);if(!i)return!1;const r=i.get(e);if(!r)return!1;const s=await this.recvConnection.getRemoteSSRC(r);return s!==void 0&&s!==n}isPreSubScribe(t){return!1}async publishDataChannel(t){throw new Z(P.NOT_SUPPORTED)}async unpublishDataChannel(t){throw new Z(P.NOT_SUPPORTED)}async subscribeDataChannel(t,e){throw new Z(P.NOT_SUPPORTED)}async unsubscribeDataChannel(t,e){throw new Z(P.NOT_SUPPORTED)}hasPendingRemoteDataChannel(t,e){throw new Z(P.NOT_SUPPORTED)}setPendingRemoteDataChannel(t,e){throw new Z(P.NOT_SUPPORTED)}async preConnect(t){throw new Z(P.NOT_SUPPORTED)}getEstablishParams(){throw new Z(P.NOT_SUPPORTED)}async reSubscribe(t){throw new Z(P.NOT_SUPPORTED)}reportVideoFirstFrameRender(t){}async updateVideoStreamParameter(t,e){throw new Z(P.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[e,{track:n}]=t;e===ot.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,pm.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},Dt(gn.prototype,"p2pConnect",[NV],Object.getOwnPropertyDescriptor(gn.prototype,"p2pConnect"),gn.prototype),Dt(gn.prototype,"unpublish",[DV],Object.getOwnPropertyDescriptor(gn.prototype,"unpublish"),gn.prototype),Dt(gn.prototype,"unpublishLowStream",[PV],Object.getOwnPropertyDescriptor(gn.prototype,"unpublishLowStream"),gn.prototype),Dt(gn.prototype,"subscribe",[kV],Object.getOwnPropertyDescriptor(gn.prototype,"subscribe"),gn.prototype),Dt(gn.prototype,"mockSubscribe",[LV],Object.getOwnPropertyDescriptor(gn.prototype,"mockSubscribe"),gn.prototype),Dt(gn.prototype,"unsubscribe",[xV],Object.getOwnPropertyDescriptor(gn.prototype,"unsubscribe"),gn.prototype),Dt(gn.prototype,"muteRemote",[MV],Object.getOwnPropertyDescriptor(gn.prototype,"muteRemote"),gn.prototype),Dt(gn.prototype,"unmuteRemote",[UV],Object.getOwnPropertyDescriptor(gn.prototype,"unmuteRemote"),gn.prototype),Dt(gn.prototype,"hasRemoteMediaWithLock",[VV],Object.getOwnPropertyDescriptor(gn.prototype,"hasRemoteMediaWithLock"),gn.prototype),Dt(gn.prototype,"disconnectForReconnect",[jV],Object.getOwnPropertyDescriptor(gn.prototype,"disconnectForReconnect"),gn.prototype),Dt(gn.prototype,"remoteMediaSsrcChanged",[BV],Object.getOwnPropertyDescriptor(gn.prototype,"remoteMediaSsrcChanged"),gn.prototype),gn);function Po(t){return function(e,n,i){const r=e[n];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){for(var s=arguments.length,c=new Array(s),l=0;l<s;l++)c[l]=arguments[l];switch(t){case Do.SEND_ONLY:{const d=await this.sendMutex.lock("From P2PChannel2.".concat(n));try{return await r.apply(this,c)}finally{d()}}case Do.RECEIVE_ONLY:{const d=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await r.apply(this,c)}finally{d()}}default:{const d=await this.sendMutex.lock("From P2PChannel2.".concat(n)),h=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await r.apply(this,c)}finally{d(),h()}}}},i}}class tp extends Sn{constructor(e,n){super(),O(this,"signal",void 0),O(this,"token",void 0),O(this,"tokenTimeout",void 0),O(this,"tokenInterval",void 0),O(this,"_sequence",0),O(this,"userMap",new Map),O(this,"encoder",new TextEncoder),this.signal=e,this.token=n;const i=()=>{this.signal.connectionState===an.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(i,1e3):this.tokenInterval=window.setTimeout(i,3*k("P2P_TOKEN_INTERVAL"))};i()}async send(e,n,i,r,s){var c;if(this.userMap.size===0)return;const l=Array.from(wr(c=this.userMap).call(c))[0].token;typeof n!="string"&&(n=JSON.stringify(n)),r=r??Je(6,""),s=s??this._sequence++;const d={_id:r,_type:e,_seq:s,_message:n,token:"".concat(this.token,"_").concat(l)};k("SHOW_P2P_LOG")&&T.debug("send message",d,"noNeedResponse : ".concat(i)),this.splitMessage(JSON.stringify(d)).forEach(p=>{this.signal.request(Wt.DATA_STREAM,{payload:Gd(this.encoder.encode(p))})});const h=new Tt((p,m)=>{const _=window.setTimeout(()=>{this.off("res-@".concat(r,"_ack"),E),this.off("res-@".concat(r),C),this.off(Cm.ABORT,I),T.debug("[external-signal] request timeout, type: ".concat(e,", requestId: ").concat(r)),this.userMap.size===0?m(new Z(P.INVALID_REMOTE_USER)):m(new Z(P.TIMEOUT))},k("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),E=()=>{_&&window.clearTimeout(_),this.off(Cm.ABORT,I),i&&p()},I=()=>{_&&window.clearTimeout(_),this.off("res-@".concat(r,"_ack"),E),this.off("res-@".concat(r),C),m(new Z(P.EXTERNAL_SIGNAL_ABORT,"type: ".concat(e,", requestId: ").concat(r)))};this.once(Cm.ABORT,I),this.once("res-@".concat(r,"_ack"),E);const C=(D,N)=>{w=!0,_&&window.clearTimeout(_),this.off("res-@".concat(r,"_ack"),E),this.off(Cm.ABORT,I),D==="success"?p(N):m(new Z(P.P2P_MESSAGE_FAILED,"request ".concat(e," failed, requestId: ").concat(r)))};let w=!1;i||(this.once("res-@".concat(r),C),yi(k("SIGNAL_REQUEST_TIMEOUT")).then(()=>{w||T.warning("external_signal request timeout, type: ".concat(e,", requestId: ").concat(r,", ").concat(d))}))});try{return await h}catch(p){if(p.code===P.TIMEOUT)return await this.send(e,n,i,r,s);throw p}}onMessage(e){var n;const{_uid:i}=e;let r,s=this.userMap.get(i);if(s)r=s.splitMessageMap;else{if(this.userMap.size>0||!("_type"in e)||e._type!==jn.CHECK)return;const{token:h}=e;r=new Map,s={uid:i,isStart:!0,token:h,splitMessageMap:r,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(i,s),this.signal.emit(pe.ON_USER_ONLINE,{uid:i}),this.handleUserOnline()}if("id"in e&&"total"in e){var c;const{id:h,total:p}=e,m=(c=r.get(h))!==null&&c!==void 0?c:[];if(m.push(e),r.has(h)||r.set(h,m),m.length!==p)return;{const _=Zt(m).call(m,(E,I)=>E.index-I.index).map(E=>E.payload).join("");r.delete(h),(e=JSON.parse(_))._uid=i}}const{_type:l,token:d}=e;if(mt(n=[jn.ACK,jn.CHECK]).call(n,l))return l===jn.CHECK&&this.handleCheckToken(s,d),void this.receiveMessage(e);d==="".concat(s.token,"_").concat(this.token)?this.handleReceivedMessage(e):T.debug('Receive unexpected message", '.concat(d,", cur_token: ").concat(s.token,"_").concat(this.token),e)}check(){const e={_id:Je(6,""),token:this.token,_type:jn.CHECK};k("SHOW_P2P_LOG")&&T.debug("send message",e),this.signal.request(Wt.DATA_STREAM,{payload:Gd(this.encoder.encode(JSON.stringify(e)))})}ack(e){const n={_id:e,_type:jn.ACK,token:this.token};k("SHOW_P2P_LOG")&&T.debug("send message",n),this.signal.request(Wt.DATA_STREAM,{payload:Gd(this.encoder.encode(JSON.stringify(n)))})}response(e,n,i){this.send(jn.RESPONSE,JSON.stringify({success:!i,message:n}),!0,e)}handleReceivedMessage(e){const n=()=>{this.userMap.forEach(h=>{const{receivedMessagesMap:p,nextExpectedSequenceNumber:m}=h;for(;p.has(m);){const _=p.get(m);p.delete(m),this.receiveMessage(_),h.nextExpectedSequenceNumber++}})};if(!e)return void n();const{_uid:i,_seq:r}=e,s=this.userMap.get(i),{receivedMessagesMap:c,isStart:l,nextExpectedSequenceNumber:d}=s;if(r<d)return this.ack(e._id),void T.debug("[external-signal] receive old message, seq: ".concat(r,", ").concat(e._message));c.set(r,e),l&&r===d&&(this.receiveMessage(e),c.delete(d),s.nextExpectedSequenceNumber++,n())}receiveMessage(e){const{_id:n,_type:i,_message:r,_uid:s}=e;if(k("SHOW_P2P_LOG")&&T.debug("receive message",e),n){let c;switch(e._type!==jn.ACK&&(r&&(c=JSON.parse(r)),this.ack(e._id)),e._type){case jn.CANDIDATE:case jn.CONTROL:this.signal.emit(i,c,s);break;case jn.PUBLISH:case jn.UNPUBLISH:case jn.RESTART_ICE:case jn.CALL:c.uid=s,ki(this.signal,i,c).then(l=>{this.response(e._id,l)}).catch(()=>{this.response(e._id,void 0,!0)});break;case jn.ACK:this.getListeners("res-@".concat(n,"_ack")).length>0&&this.emit("res-@".concat(n,"_ack"));break;case jn.RESPONSE:{const{success:l,message:d}=c;this.emit("res-@".concat(n),l?"success":"failed",d);break}}}}splitMessage(e){if(e.length<tp.MAX_MESSAGE_SIZE)return[e];const n=[],{remoteToken:i}=JSON.parse(e),r=Je(6,"");let s=0,c=800;const l=Math.ceil(e.length/c);for(;e.length>0;){s++;const d={id:r,index:s,total:l,payload:e.slice(0,c),token:"".concat(this.token,"_").concat(i)};JSON.stringify(d).length>tp.MAX_MESSAGE_SIZE?c-=50:(n.push(d),e=e.slice(c))}return n.map(d=>JSON.stringify(d))}handleCheckToken(e,n){return e.token!==n?(T.debug("token changed, from ".concat(e.token," to ").concat(n)),this.reset(e.uid,n),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{T.debug("token timeout, ".concat(n)),this.reset(e.uid)},k("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const e=await ki(this.signal,jn.CALL,void 0),n=await this.send(jn.CALL,e);this.signal.emit(Yt.P2P_CONNECTION,n,!0)}async reset(e,n){const i=this.userMap.get(e);i&&(this.emit(Cm.ABORT),this.signal.emit(pe.ON_USER_OFFLINE,{uid:i.uid,reason:a8.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),n||(T.debug("change local token from ".concat(n," to ").concat(n)),this.token=Je(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(Cm.ABORT)}}O(tp,"MAX_SIZE",1),O(tp,"MAX_MESSAGE_SIZE",1024);class FW extends Sn{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===an.CONNECTED?this.emit(Yt.WS_CONNECTED):e===an.RECONNECTING?this.emit(Yt.WS_RECONNECTING,this._websocketReconnectReason):e===an.CLOSED&&this.emit(Yt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,n){super(),O(this,"_disconnectedReason",void 0),O(this,"_websocketReconnectReason",void 0),O(this,"_connectionState",an.CLOSED),O(this,"reconnectToken",void 0),O(this,"p2pToken",void 0),O(this,"websocket",void 0),O(this,"openConnectionTime",void 0),O(this,"clientId",void 0),O(this,"lastMsgTime",Date.now()),O(this,"uploadCache",[]),O(this,"uploadCacheInterval",void 0),O(this,"rttRolling",new EL(5)),O(this,"pingpongTimer",void 0),O(this,"pingpongTimeoutCount",0),O(this,"joinResponse",void 0),O(this,"multiIpOption",void 0),O(this,"initError",void 0),O(this,"spec",void 0),O(this,"store",void 0),O(this,"_external_signal",void 0),O(this,"onWebsocketMessage",i=>{if(i.data instanceof ArrayBuffer)return void this.emit(Yt.ON_BINARY_DATA,i.data);const r=JSON.parse(i.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(r,"_id")){const s="res-@".concat(r._id);this.emit(s,r._result,r._message)}else if(Object.prototype.hasOwnProperty.call(r,"_type")){switch(r._type){case pe.ON_DATA_STREAM:return void this.handleDataStream(r._message);case pe.MUTE_AUDIO:case pe.MUTE_VIDEO:case pe.ON_P2P_LOST:case pe.ON_USER_ONLINE:return;case pe.ON_USER_OFFLINE:const{uid:s}=r._message;return T.debug("[".concat(this.clientId,"] user-offline uid: ").concat(s)),void this._external_signal.reset(s)}if(this.emit(r._type,r._message),r._type===pe.ON_NOTIFICATION&&this.handleNotification(r._message),r._type===pe.ON_USER_BANNED)switch(r._message.error_code){case 14:this.close(xe.UID_BANNED);break;case 15:this.close(xe.IP_BANNED);break;case 16:this.close(xe.CHANNEL_BANNED)}if(r._type===pe.ON_USER_LICENSE_BANNED)switch(r._message.error_code){case Vt.ERR_LICENSE_MISSING:this.close(xe.LICENSE_MISSING);break;case Vt.ERR_LICENSE_EXPIRED:this.close(xe.LICENSE_EXPIRED);break;case Vt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(xe.LICENSE_MINUTES_EXCEEDED);break;case Vt.ERR_LICENSE_PERIOD_INVALID:this.close(xe.LICENSE_PERIOD_INVALID);break;case Vt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(xe.LICENSE_MULTIPLE_SDK_SERVICE);break;case Vt.ERR_LICENSE_ILLEGAL:this.close(xe.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=e.clientId,this.spec=e,this.store=n,this.websocket=new Gw("gateway-".concat(this.clientId),this.spec.retryConfig,!0,k("JOIN_GATEWAY_USE_DUAL_DOMAIN"),k("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===an.CONNECTED&&this.reconnect("retry",Pi.OFFLINE)}),this.p2pToken=Je(6,""),this._external_signal=new tp(this,this.p2pToken)}async request(e,n,i,r){const s=Je(6,""),c={_id:s,_type:e,_message:n},l=this.websocket.connectionID,d=()=>new Tt((I,C)=>{if(this.connectionState===an.CONNECTED)return I();const w=()=>{this.off(Yt.WS_CLOSED,D),I()},D=()=>{this.off(Yt.WS_CONNECTED,w),C(new Z(P.WS_ABORT))};this.once(Yt.WS_CONNECTED,w),this.once(Yt.WS_CLOSED,D)});if(this.connectionState!==an.CONNECTING&&this.connectionState!==an.RECONNECTING||e===Wt.JOIN||e===Wt.REJOIN||await d(),this.websocket.sendMessage(c,!0),r)return;const h=new Tt((I,C)=>{let w=!1;const D=(L,W)=>{w=!0,I({isSuccess:L==="success",message:W||{}}),this.off(Yt.WS_CLOSED,N),this.off(Yt.WS_RECONNECTING,N),this.emit(Yt.REQUEST_SUCCESS,e,n)};this.once("res-@".concat(s),D);const N=()=>{C(new Z(P.WS_ABORT,"type: ".concat(e))),this.off(Yt.WS_CLOSED,N),this.off(Yt.WS_RECONNECTING,N),this.off("res-@".concat(s),D)};this.once(Yt.WS_CLOSED,N),this.once(Yt.WS_RECONNECTING,N),yi(k("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==l||w||(T.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(Yt.REQUEST_TIMEOUT,e,n))})});let p=null;try{p=await h}catch(I){if(this.connectionState===an.CLOSED||e===Wt.LEAVE)throw new Z(P.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?I.throw():e===Wt.JOIN||e===Wt.REJOIN?null:(await d(),await this.request(e,n))}if(p.isSuccess)return p.message;const m=Number(p.message.error_code||p.message.code),_=Gg(m),E=new Z(P.UNEXPECTED_RESPONSE,"".concat(_.desc,": ").concat(p.message.error_str),{code:m,data:p.message,desc:_.desc});return _.action==="success"?p.message:(T.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(m,", message: ").concat(_.desc,", action: ").concat(_.action)),m===Vt.ERR_TOO_MANY_BROADCASTERS?((e===Wt.JOIN||e===Wt.REJOIN)&&(this.initError=E,this.close()),E.throw()):_.action==="failed"?E.throw():_.action==="quit"?(this.initError=E,this.close(),E.throw()):(m===Vt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=p.message.option,T.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Pi.MULTI_IP)):this.reconnect(_.action,Pi.SERVER_ERROR),e===Wt.JOIN||e===Wt.REJOIN?null:await this.request(e,n)))}waitMessage(e,n){return new Tt(i=>{const r=s=>{(!n||n(s))&&(this.off(e,r),i(s))};this.on(e,r)})}uploadWRTCStats(e){if(!this.store.sessionId)return void T.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(Bg.WRTC_STATS,n)}upload(e,n){const i={_type:e,_message:n};try{this.websocket.sendMessage(i)}catch{const s=k("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>s&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==an.CONNECTED)return;const c=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(c._type,c._message)},k("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,n){const i={_type:e,_message:n};this.websocket.sendMessage(i)}async sendExtensionMessage(e,n,i){return await this._external_signal.send(e,n,i)}init(e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Tt((n,i)=>{this.once(Yt.WS_CONNECTED,()=>n(this.joinResponse)),this.once(Yt.WS_CLOSED,()=>i(this.initError||new Z(P.WS_ABORT))),this.connectionState=an.CONNECTING,this.websocket.init(e).catch(i)})}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=e||xe.LEAVE,this.connectionState=an.CLOSED,T.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=Je(6,""),this._external_signal.clear(),this._external_signal=new tp(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(Yt.ABORT_P2P_EXECUTION);const e=await ki(this,Yt.REQUEST_JOIN_INFO),n=await this.request(Wt.JOIN,e);if(!n)return this.emit(Yt.REPORT_JOIN_GATEWAY,P.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(Yt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=an.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(e,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,n)}async downgradeCodec(e){return!1}handleDataStream(e){try{var n;const i=kh(e.payload),r=new TextDecoder().decode(i),s=JSON.parse(r);"total"in s&&"id"in s||mt(n=Object.values(jn)).call(n,s._type)?(s._uid=e.uid,this._external_signal.onMessage(s)):this.emit(pe.ON_DATA_STREAM,e)}catch{this.emit(pe.ON_DATA_STREAM,e)}}handleNotification(e){T.debug("[".concat(this.clientId,"] receive notification: "),e);const n=Gg(e.code);if(n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(xe.UID_BANNED),void this.close()):void this.reconnect(n.action,Pi.SERVER_ERROR);T.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const e=k("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=e&&(T.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>k("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Pi.TIMEOUT):this.request(Wt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const i=Date.now()-n;this.rttRolling.add(i),k("REPORT_STATS")&&this.send(Wt.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleWebsocketEvents(){this.websocket.on(ee.RECONNECT_CREATE_CONNECTION,e=>{this.emit(Yt.WS_RECONNECT_CREATE_CONNECTION,e)}),this.websocket.on(ee.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(ee.CLOSED,()=>{this.connectionState=an.CLOSED}),this.websocket.on(ee.FAILED,()=>{this._disconnectedReason=xe.NETWORK_ERROR,this.connectionState=an.CLOSED}),this.websocket.on(ee.RECONNECTING,e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===an.CONNECTED?this.connectionState=an.RECONNECTING:this.connectionState=an.CONNECTING}),this.websocket.on(ee.WILL_RECONNECT,(e,n,i)=>{e!=="retry"?(T.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(e)),this.reconnectToken=void 0):T.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),i(e)}),this.websocket.on(ee.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(e=>{if(this.emit(Yt.REPORT_JOIN_GATEWAY,e,this.url||""),e instanceof Z&&e.code===P.UNEXPECTED_RESPONSE&&e.data.code===Vt.ERR_NO_AUTHORIZED)return T.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Pi.SERVER_ERROR);T.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Pi.SERVER_ERROR):(this.initError=e,this.close())})}),this.websocket.on(ee.REQUEST_NEW_URLS,(e,n)=>{ki(this,Yt.REQUEST_RECOVER,this.multiIpOption).then(e).catch(n)}),this.websocket.on(ee.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(pe.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const GW={name:"P2PChannel",create:function(t){let{store:e,statsCollector:n}=t;return new BW(e,n)},createSubmodule:function(t){let{store:e,spec:n}=t;return new FW(n,e)}};function GV(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function HV(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?GV(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):GV(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}class HW{constructor(e){O(this,"sessionDesc",void 0),O(this,"localCapabilities",void 0),O(this,"rtpCapabilities",void 0),O(this,"candidates",void 0),O(this,"_originCandidates",void 0),O(this,"iceParameters",void 0),O(this,"dtlsParameters",void 0),O(this,"setup",void 0),O(this,"currentMidIndex",void 0),O(this,"cname",void 0),e=En(e);const{iceParameters:n,dtlsParameters:i,candidates:r,rtpCapabilities:s,setup:c,localCapabilities:l,sdkCodec:d,cname:h}=e,p=Wr(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=s,this.candidates=r,this._originCandidates=En(r),this.iceParameters=n,this.dtlsParameters=i,this.setup=c,this.localCapabilities=l,this.cname=h;for(let m=0;m<p.mediaDescriptions.length;m++){const _=p.mediaDescriptions[m];if(_.attributes.iceUfrag=n.iceUfrag,_.attributes.icePwd=n.icePwd,_.attributes.fingerprints=i.fingerprints,_.attributes.candidates=r,_.attributes.setup=c,_.media.mediaType==="video"){_.media.fmts=s.videoCodecs.map(C=>C.payloadType.toString(10));const E=s.videoCodecs.filter(C=>{var w,D;return(w=C.rtpMap)===null||w===void 0?void 0:mt(D=w.encodingName.toLowerCase()).call(D,d)}),I=s.videoCodecs.filter(C=>!mt(E).call(E,C));_.attributes.payloads=[...E,...I],_.attributes.extmaps=s.videoExtensions}_.media.mediaType==="audio"&&(_.media.fmts=s.audioCodecs.map(E=>E.payloadType.toString(10)),_.attributes.payloads=s.audioCodecs,_.attributes.extmaps=s.audioExtensions),p.mediaDescriptions[m]=this.mungMediaDesc(_)}this.sessionDesc=p,this.currentMidIndex=p.mediaDescriptions.length-1}toString(){return Hd(this.sessionDesc)}send(e,n,i){const{ssrcs:r,ssrcGroups:s}=qg(n,this.cname),c=this.sessionDesc.mediaDescriptions.find(h=>e===Ct.VIDEO?h.media.mediaType==="video":h.media.mediaType==="audio"),l=r[0].attributes.label,d=r[0].attributes.mslabel;return c.attributes.ssrcs=c.attributes.ssrcs.concat(r),c.attributes.ssrcGroups=c.attributes.ssrcGroups.concat(s),{id:l,mslabel:d}}batchSend(e){return e.map(n=>{let{kind:i,ssrcMsg:r}=n;return this.send(i,r,void 0)})}stopSending(e){this.sessionDesc.mediaDescriptions.forEach(n=>{const i=[],r=[],s=[];n.attributes.ssrcs.forEach(c=>{mt(e).call(e,c.attributes.label||"")?s.push(c):i.push(c)}),n.attributes.ssrcGroups.forEach(c=>{var l;mt(l=s.map(d=>d.ssrcId)).call(l,c.ssrcIds[0])||r.push(c)}),n.attributes.ssrcs=i,n.attributes.ssrcGroups=r})}mute(e){const n=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===e);if(!n)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));n.attributes.direction="inactive"}unmute(e){const n=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===e);if(!n)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));n.attributes.direction="sendonly"}receive(e,n,i){e.forEach((r,s)=>{const c=r._mediaStreamTrack,l=this.sessionDesc.mediaDescriptions.findIndex(h=>h.attributes.mid===c.kind),d=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[l],r);this.sessionDesc.mediaDescriptions[l]=d})}stopReceiving(e){}updateCandidates(e){const n=this._originCandidates.filter(r=>r.transport==="udp"),i=[];if(n.forEach(r=>{i.push(HV(HV({},r),{},{foundation:"tcpcandidate",priority:Number(r.priority)-1+"",transport:"tcp",port:Number(r.port)+90+""}))}),n.length!==0){switch(e){case Ki.TCP_RELAY:this.candidates=i;break;case Ki.UDP_TCP_RELAY:case Ki.RELAY:this.candidates=[...n,...i];break;default:this.candidates=n}for(const r of this.sessionDesc.mediaDescriptions)r.attributes.candidates=this.candidates}}restartICE(e){e=En(e),this.iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(n=>{n.attributes.iceUfrag=e.iceUfrag,n.attributes.icePwd=e.icePwd})}predictReceivingMids(e){const n=[];for(let i=0;i<e;i++)n.push((this.currentMidIndex+i+1).toString(10));return n}mungRecvMediaDsec(e,n){const i=En(e);return Im(i,n),qw(i,n),i}updateRecvMedia(e,n){const i=this.sessionDesc.mediaDescriptions.findIndex(r=>r.attributes.mid===e);if(i!==-1){const r=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],n);this.sessionDesc.mediaDescriptions[i]=r}}bumpMid(e){this.currentMidIndex+=e}updateTrackLabel(e,n,i){const r=this.sessionDesc.mediaDescriptions.find(c=>e===Ct.VIDEO?c.attributes.mid==="video":c.attributes.mid==="audio");if(r){const c=r.attributes.ssrcs.find(l=>l.attributes.label===n);var s;c&&(c.attributes.label=i,(s=c.attributes.msid)===null||s===void 0||s.replace(n,i))}}mungMediaDesc(e){const n=En(e);return zw(n),function(i){const r=i.attributes.extmaps.find(s=>MR(s.extensionName));r&&i.attributes.extmaps.splice(i.attributes.extmaps.indexOf(r),1),i.attributes.payloads.forEach(s=>{const c=s.rtcpFeedbacks.findIndex(l=>l.type==="transport-cc");c!==-1&&s.rtcpFeedbacks.splice(c,1)})}(n),n}getSSRC(e){for(const n of this.sessionDesc.mediaDescriptions)for(const i of n.attributes.ssrcs)if(i.attributes.label===e)return[i]}}var Ze;function WV(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function yb(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?WV(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):WV(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}let WW=(Ze=class Rv extends rM{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").filter(e=>{var n;return mt(n=Object.keys(xg)).call(n,e)}))]}constructor(e,n){super(e,n),O(this,"store",void 0),O(this,"peerConnection",void 0),O(this,"remoteSDP",void 0),O(this,"initialOffer",void 0),O(this,"statsFilter",void 0),O(this,"useRTX",!1),O(this,"localCapabilities",void 0),O(this,"localCandidateCount",0),O(this,"allCandidatesReceived",!1),O(this,"establishPromise",void 0),O(this,"mutex",void 0),this.store=n,this.mutex=new Wi("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(Rv.resolvePCConfiguration(e),{optional:[{googDscp:!0}]}),this.statsFilter=tw(this.peerConnection,k("STATS_UPDATE_INTERVAL"),void 0,An()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const e=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const n=Xd(e.sdp),i=zg(e.sdp,{filterRTX:!this.useRTX,filterVideoFec:k("FILTER_VIDEO_FEC"),filterAudioFec:k("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=i,this.initialOffer=e,yb(yb({},n),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:i},offerSDP:e.sdp})}catch(e){throw new Z(P.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async updateRemoteConnect(){}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new HW(yb(yb({},e),{},{rtpCapabilities:e.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const n=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}catch(n){throw new Z(P.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async updateRemoteRTPCapabilities(e,n){throw new Z(P.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(e){}send(e,n){var i=this;return Za(function*(){const r=yield Re(i.mutex.lock());try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const s=e.map(_=>i.peerConnection.addTrack(_._mediaStreamTrack)),c=yield Re(i.peerConnection.createOffer()),l=Wr(c.sdp),d=e.map(_=>{const E=_._mediaStreamTrack,I=l.mediaDescriptions.find(C=>C.attributes.mid===E.kind);if(!I)throw new Error("Cannot extract ssrc from mediaDescription.");return function(C,w,D){const N=C.attributes.ssrcs.filter(W=>W.attributes.label===w),L=C.attributes.ssrcGroups;if(N.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(L&&N.length>1){const W=L.find(G=>G.ssrcIds.indexOf(N[0].ssrcId)!==-1);return W?[{ssrcId:W.ssrcIds[0],rtx:D?W.ssrcIds[1]:void 0}]:[{ssrcId:N[0].ssrcId}]}return[{ssrcId:N[0].ssrcId}]}(I,E.id,i.useRTX)});let h;try{h=yield d}catch(_){throw s.forEach(E=>{Di()&&E.replaceTrack(null),i.peerConnection.removeTrack(E)}),_}const p=i.mungSendOfferSDP(c.sdp,e);i.remoteSDP.receive(e,n,h);const m=i.remoteSDP.toString();return yield Re(i.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield Re(i.applySendEncodings(s,e)),yield Re(i.peerConnection.setRemoteDescription({type:"answer",sdp:m})),e.map((_,E)=>{const I=_._mediaStreamTrack.id;return{localSSRC:d[E],id:I}})}catch(s){throw new Z(P.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(s.toString()))}finally{r()}})()}async stopSending(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const n=this.peerConnection.getSenders().filter(s=>{var c;return e.indexOf(((c=s.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");n.map(s=>{Di()&&s.replaceTrack(null),this.peerConnection.removeTrack(s)});const i=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(i),this.remoteSDP.stopReceiving(e);const r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(n){throw new Z(P.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(n.toString()))}}async receive(e,n,i,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{id:s,mslabel:c}=this.remoteSDP.send(e,n,r),l=new Tt((p,m)=>{const _=setTimeout(()=>{m(new Error("Cannot receive track, id: ".concat(s)))},1e4),E=I=>{const C=ve();if((C.name==="Safari"&&Number(C.version)===11||rr())&&I.track.id!==s&&I.streams[0].id===c){var w;const D=I.streams[0].getTracks()[0];return(w=this.remoteSDP)===null||w===void 0||w.updateTrackLabel(e,s,I.track.id),this.peerConnection.removeEventListener("track",E),clearTimeout(_),void p(D)}if(I.track.id===s)return this.peerConnection.removeEventListener("track",E),clearTimeout(_),void p(I.track)};this.peerConnection.addEventListener("track",E)}),d=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:d});const h=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(h),{track:await l,id:s}}catch(s){throw new Z(P.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(i)}catch(n){throw new Z(P.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(e){}async unmuteRemote(e){}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(i=>{var r;return e.indexOf(((r=i.track)===null||r===void 0?void 0:r.id)||"")!==-1});if(n.length!==e.length)throw new Error("sender' length doesn't match mids' length.");n.map(i=>{if(Di()&&i.track)i.track.enabled=!1;else{const r=i.getParameters();r.encodings.forEach(s=>s.active=!1),i.setParameters(r)}})}catch(n){throw new Z(P.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(s=>{var c;return e.indexOf(((c=s.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(n.length!==e.length)throw new Error("Senders' length doesn't match mids' length.");n.map(async s=>{if(Di()&&s.track)s.track.enabled=!0;else{const c=s.getParameters();c.encodings.forEach(l=>l.active=!0),await s.setParameters(c)}});const i=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(i);const r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(n){throw new Z(P.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(e){var n=this;return Za(function*(){const i=yield Re(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const r=be().supportPCSetConfiguration;if(e===Ki.RELAY&&!r)return;if(r){const h=n.peerConnection.getConfiguration(),p=e===Ki.RELAY?"relay":"all";h.iceTransportPolicy!==p&&(T.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(h.iceTransportPolicy,"] to [").concat(p,"]")),h.iceTransportPolicy=p,n.peerConnection.setConfiguration(h))}e!==Ki.RELAY&&n.remoteSDP.updateCandidates(e);const s=yield Re(n.peerConnection.createOffer({iceRestart:!0}));if(!s.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const c=Xd(s.sdp),{remoteIceParameters:l}=yield c.iceParameters;n.remoteSDP.restartICE(l);const d=n.remoteSDP.toString();yield Re(n.peerConnection.setLocalDescription(s)),yield Re(n.peerConnection.setRemoteDescription({type:"answer",sdp:d}))}catch(r){T.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),r)}finally{i()}})()}close(){var e;this.peerConnection.close(),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),r=this.mungSendOfferSDP(i.sdp,[n]);this.remoteSDP.updateRecvMedia(n._mediaStreamTrack.kind,n);const s=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(i){throw new Z(P.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(e,n){const i=this.peerConnection.getSenders().filter(r=>{var s;return((s=r.track)===null||s===void 0?void 0:s.id)===e});i.length===1&&await this.applySendEncodings(i,[n])}setStatsRemoteVideoIsReady(e,n){this.statsFilter.setVideoIsReady2(e,n)}async replaceTrack(e,n){const i=this.peerConnection.getSenders().find(r=>{var s;return((s=r.track)===null||s===void 0?void 0:s.id)===n});i&&await i.replaceTrack(e._mediaStreamTrack)}createDataChannels(e,n){throw new Z(P.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(e){throw new Z(P.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;(e=this.onICEConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},k("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e){const n={iceServers:[],sdpSemantics:"plan-b"};return e.iceServers?n.iceServers=e.iceServers:e.turnServer&&e.turnServer.mode!=="off"&&(Ng(e.turnServer.servers)?n.iceServers=e.turnServer.servers:(n.iceServers&&n.iceServers.push(...Rv.turnServerConfigToIceServers(e.turnServer.servers)),k("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&e.turnServer.serversFromGateway&&n.iceServers.push(...Rv.turnServerConfigToIceServers(e.turnServer.serversFromGateway)),e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(n.iceTransportPolicy="relay")}))),n}static turnServerConfigToIceServers(e){const n=[];return e.forEach(i=>{i.security?i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),n}async updateRtpSenderEncodings(e,n){var i;if(n||(n=this.peerConnection.getSenders().find(h=>{var p;return((p=h.track)===null||p===void 0?void 0:p.id)===e._mediaStreamTrack.id})),!n)return T.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(!be().supportSetRtpSenderParameters)return T.warn("Browser not support set rtp-sender parameters");const r={},s={};if(e instanceof sn)switch(e._optimizationMode){case"motion":r.degradationPreference="maintain-framerate";break;case"detail":r.degradationPreference="maintain-resolution";break;default:r.degradationPreference="balanced"}if(k("DSCP_TYPE")&&yl()){var c;const h=k("DSCP_TYPE");mt(c=["very-low","low","medium","high"]).call(c,h)&&(s.networkPriority=h)}const l=n.getParameters(),d=(i=l.encodings)===null||i===void 0?void 0:i[0];d&&Object.assign(d,s),Object.assign(l,r),T.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(l.encodings))),await n.setParameters(l)}async applySendEncodings(e,n){try{if(!be().supportSetRtpSenderParameters||e.length!==n.length)return;for(let i=0;i<e.length;i++){const r=e[i],s=n[i];r&&s&&await this.updateRtpSenderEncodings(s,r)}}catch{T.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,n){const i=Wr(e);return n.forEach((r,s)=>{const c=r._mediaStreamTrack,l=i.mediaDescriptions.find(d=>d.attributes.mid===c.kind);l&&Im(l,r)}),Hd(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,n,i)=>{var r;(r=this.onFirstVideoDecoded)===null||r===void 0||r.call(this,e,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(e,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,e,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,e,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const n=this.remoteSDP.batchSend(e).map((s,c)=>{let{id:l,mslabel:d}=s;const{kind:h}=e[c];return new Tt((p,m)=>{const _=setTimeout(()=>{m(new Error("Cannot receive track, id: ".concat(l)))},1e4),E=I=>{const C=ve();if(C.name==="Safari"&&Number(C.version)===11&&I.track.id!==l&&I.streams[0].id===d){var w;const D=I.streams[0].getTracks()[0];return(w=this.remoteSDP)===null||w===void 0||w.updateTrackLabel(h,l,I.track.id),this.peerConnection.removeEventListener("track",E),clearTimeout(_),void p({track:D,id:l})}if(I.track.id===l)return this.peerConnection.removeEventListener("track",E),clearTimeout(_),void p({track:I.track,id:l})};this.peerConnection.addEventListener("track",E)})}),i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const r=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(r),await Tt.all(n)}catch(n){throw new Z(P.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async getRemoteSSRC(e){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(e);return n==null?void 0:n[0].ssrcId}setConfiguration(e){if(be().supportPCSetConfiguration){const n=Rv.resolvePCConfiguration(e);this.peerConnection.setConfiguration(n)}}},Dt(Ze.prototype,"connect",[os],Object.getOwnPropertyDescriptor(Ze.prototype,"connect"),Ze.prototype),Dt(Ze.prototype,"stopSending",[os],Object.getOwnPropertyDescriptor(Ze.prototype,"stopSending"),Ze.prototype),Dt(Ze.prototype,"receive",[os],Object.getOwnPropertyDescriptor(Ze.prototype,"receive"),Ze.prototype),Dt(Ze.prototype,"stopReceiving",[os],Object.getOwnPropertyDescriptor(Ze.prototype,"stopReceiving"),Ze.prototype),Dt(Ze.prototype,"muteRemote",[os],Object.getOwnPropertyDescriptor(Ze.prototype,"muteRemote"),Ze.prototype),Dt(Ze.prototype,"unmuteRemote",[os],Object.getOwnPropertyDescriptor(Ze.prototype,"unmuteRemote"),Ze.prototype),Dt(Ze.prototype,"muteLocal",[os],Object.getOwnPropertyDescriptor(Ze.prototype,"muteLocal"),Ze.prototype),Dt(Ze.prototype,"unmuteLocal",[os],Object.getOwnPropertyDescriptor(Ze.prototype,"unmuteLocal"),Ze.prototype),Dt(Ze.prototype,"close",[os],Object.getOwnPropertyDescriptor(Ze.prototype,"close"),Ze.prototype),Dt(Ze.prototype,"updateEncoderConfig",[os],Object.getOwnPropertyDescriptor(Ze.prototype,"updateEncoderConfig"),Ze.prototype),Dt(Ze.prototype,"updateSendParameters",[os],Object.getOwnPropertyDescriptor(Ze.prototype,"updateSendParameters"),Ze.prototype),Dt(Ze.prototype,"replaceTrack",[os],Object.getOwnPropertyDescriptor(Ze.prototype,"replaceTrack"),Ze.prototype),Dt(Ze.prototype,"getRemoteSSRC",[os],Object.getOwnPropertyDescriptor(Ze.prototype,"getRemoteSSRC"),Ze.prototype),Ze);function os(t,e,n){const i=t[e];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const r=this.mutex,s=await r.lock("Locking from P2PConnection.".concat(e));try{for(var c=arguments.length,l=new Array(c),d=0;d<c;d++)l[d]=arguments[d];return await i.apply(this,l)}finally{s()}},n}const zW={name:"PlanBConnection",create:function(t){let{store:e,spec:n}=t;return new WW(n,e)}},qW={interceptLocalAudioFrame:async function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!be().supportWebRTCEncodedTransform)return void T.warning("browser not support audio encoded transform");if(vR.has(t)||!t.track)return;const n={track:t.track};if(Tl()){if(!t.createEncodedStreams)return void T.warning("browser not support createEncodedStreams() API");let r=null;try{r=t.createEncodedStreams()}catch(c){return void T.error("create audio-encoded-streams error",c&&c.message)}const s=new TransformStream({transform(c,l){n.controller||(n.controller=l),t.track&&t.track.id!==n.track.id&&(T.debug("audio track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i));const d=e.metadata&&e.metadata();d?function(h,p){const{chunk:m,controller:_}=p,E=Wd.METADATA;m.data=function(I,C,w){const D=w.byteLength,N=D+Cw+Fx,L=Rw+bw+N,W=new ArrayBuffer(I.byteLength+L),G=new DataView(W);G.setUint8(0,Bx),G.setUint16(1,N),G.setUint8(3,C),G.setUint16(4,D);for(let z=0;z<D;z++)G.setUint8(6+z,w[z]);const U=new Uint8Array(G.buffer);return U.set(new Uint8Array(I),L),U.buffer}(m.data,E,h),_.enqueue(m)}(d,{chunk:c,controller:l}):l.enqueue(c)}});r.readable.pipeThrough(s).pipeTo(r.writable)}else if(Di()){if(typeof RTCRtpScriptTransform>"u")return void T.warning("browser not support RTCRtpScriptTransform");const r=gR(),s=new MessageChannel;await new Tt(l=>r.onmessage=d=>{d.data==="registered"&&l(void 0)});const c=new RTCRtpScriptTransform(r,{name:"audio-metadata-tx",port:s.port2},[s.port2]);t.transform=c,await new Tt(l=>r.onmessage=d=>{d.data==="started"&&l(void 0)}),s.port1.onmessage=l=>{var d;if(l.data.transformed&&t.track&&((d=t.track)===null||d===void 0?void 0:d.id)!==n.track.id)T.debug("audio track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i);else if(l.data.getMetadata){const h=e.metadata&&e.metadata();h&&s.port1.postMessage({metadata:h})}},n.worker=r}function i(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",i)}const r=vR.get(t);if(r){vR.delete(t);try{var s,c;(s=r.controller)===null||s===void 0||s.terminate(),(c=r.worker)===null||c===void 0||c.terminate()}catch(l){T.warning(l&&l.message)}}}vR.set(t,n),t.track.addEventListener("ended",i)},interceptRemoteAudioFrame:async function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!be().supportWebRTCEncodedTransform)return void T.warning("browser not support audio encoded transform");if(CR.has(t))return;const n={track:t.track,onMetadata:e.onMetadata,onPts:e.onPts};if(Tl()&&!rr()){if(!t.createEncodedStreams)return void T.warning("browser not support createEncodedStreams() API");LA(Ie.CHROME,87,116)||(e.enableTopn=!1);let r=null;try{r=t.createEncodedStreams()}catch(c){return void T.error("create audio-encoded-streams error",c&&c.message)}const s=new TransformStream({transform(c,l){n.controller||(n.controller=l),t.track&&t.track.id!==n.track.id&&(T.debug("audio track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i)),e.enableTopn?function(d,h,p){var m;const _=Aw(new DataView(h.data));if(!_)return p.enqueue(h);const E=d.track.id;AG.set(E,d.track);const I=(m=_.tlv.find(W=>W.tag===Wd.AUDIO_LEVEL))===null||m===void 0?void 0:m.value;let C=0;typeof I=="number"&&(C=127-I);const w=Math.round(Math.pow(10,C/60)-1),{selected:D,speaker:N}=function(W,G){let U=Tm.get(W);if(U||(U=function(z){const $=new Hx;return Tm.set(z,$),Co||(Co=new bG(k("TOPN_SILENCE_THRESHOLD")||500),Co.on("ActiveSpeakerChanged",rt=>{rt!=null&&(yR=rt)})),Co.addSpeakers([$]),$}(W)),Tm.size<=Wx)return{selected:!0,speaker:U};if(!Co)throw new Error("no active speaker detector");return Co.levelChanged(U.id,G),Bh=Co.loudest.map(z=>z.id),yR&&!mt(Bh).call(Bh,yR)&&Bh.length>=Wx&&Bh.pop(),{selected:mt(Bh).call(Bh,U.id)||U.id===yR,speaker:U}}(d,w),L=function(W,G,U){const z=Ao.get(W)||new CG(W,G);return z.score=U,Ao.set(W,z),function($){if(RR.set($,!0),!bR)return void(bR=Date.now());const rt=Date.now();rt-bR>1e3&&(RR.get($)?RR.set($,!1):(zx($),RR.delete($)),bR=rt)}(W),z}(E,d.track,N.energyScore);L.addSample(D),L.active&&(h.data=_.frame.buffer,p.enqueue(h))}(t,c,l):e.enableMetadata||e.enablePts?function(d,h,p,m){const _=new DataView(d.data),E=_.getUint8(0);let I;if((128&E)!=0&&E!==71){const D=function(N){if(N.byteLength<=0)return[];const L=[];let W=0;for(;W<N.byteLength;){const U=(128&N.getUint8(W))>>7,z=127&N.getUint8(W);if(!(U&&W+4<=N.byteLength)){W++;break}{const $=N.getUint32(W,!1),rt=(16776192&$)>>10,dt=1023&$;L.push({pt:z,ts_offset:rt,length:dt,data:new Uint8Array}),W+=4}}let G=N.byteLength-W;for(const U of L){if(U.length>G)return console.warn("Broken red payload"),[];U.length>0&&(U.data=new Uint8Array(N.buffer,N.byteOffset+W,U.length),W+=U.length,G-=U.length)}if(G>0){const U={pt:L.length>0?L[L.length-1].pt:0,ts_offset:0,length:G,data:new Uint8Array(N.buffer,N.byteOffset+W,G)};L.push(U)}return L}(_);if(D.length>0){const N=function(L){let W=0;for(let z=0;z<L.length;z++)W+=z<L.length-1?4:1,W+=L[z].length;const G=new Uint8Array(W);let U=0;for(let z=0;z<L.length;z++)if(z<L.length-1){const $=(2147483648|(127&L[z].pt)<<24|(262143&L[z].ts_offset)<<10|1023&L[z].length)>>>0;G[U++]=$>>24&255,G[U++]=$>>16&255,G[U++]=$>>8&255,G[U++]=255&$}else G[U++]=127&L[z].pt;for(const z of L)G.set(z.data,U),U+=z.length;return G}(D.map(L=>{const W=new Uint8Array(L.length);W.set(L.data);const G=Aw(new DataView(W.buffer));return G!=null&&G.frame&&(L.data=G==null?void 0:G.frame),I=G,L}));d.data=N.buffer}}else I=Aw(_),I&&(d.data=I.frame.buffer);if(h.enqueue(d),!I)return;const C=I.tlv.find(D=>D.tag===Wd.METADATA);C&&p&&C.value instanceof Uint8Array&&p(C.value);const w=I.tlv.find(D=>D.tag===Wd.AUDIO_64_BIT_PTS);w&&m&&w.value instanceof Uint8Array&&w.value.length==8&&m(new DataView(w.value.buffer).getBigUint64(0,!0))}(c,l,e.onMetadata,e.onPts):l.enqueue(c)}});r.readable.pipeThrough(s).pipeTo(r.writable)}else{if(typeof RTCRtpScriptTransform>"u")return void T.warning("browser not support RTCRtpScriptTransform");const r=gR(),s=new MessageChannel;await new Tt(l=>r.onmessage=d=>{d.data==="registered"&&l(void 0)});const c=new RTCRtpScriptTransform(r,{name:"audio-metadata-rx",port:s.port2},[s.port2]);t.transform=c,await new Tt(l=>r.onmessage=d=>{d.data==="started"&&l(void 0)}),s.port1.onmessage=l=>{var d;l.data.transformed&&t.track&&((d=t.track)===null||d===void 0?void 0:d.id)!==n.track.id?(T.debug("audio track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i)):l.data.metadata&&n.onMetadata?n.onMetadata(l.data.metadata):l.data.pts&&n.onPts&&n.onPts(l.data.pts)},n.worker=r}function i(){t.track.removeEventListener("ended",i),function(r){const s=CR.get(r);if(s){(function(d){const h=Tm.get(d);h&&(Tm.delete(d),Co&&(Co.removeSpeakers([h]),Tm.size===0&&(Co.destroy(),Co=null)))})(r),zx(r.track.id),CR.delete(r);try{var c,l;(c=s.controller)===null||c===void 0||c.terminate(),(l=s.worker)===null||l===void 0||l.terminate()}catch(d){T.warning(d&&d.message)}}}(t)}CR.set(t,n),t.track.addEventListener("ended",i)},interceptLocalVideoFrame:async function(t,e){if(!be().supportWebRTCEncodedTransform)return void T.warning("browser not support video encoded transform");if(AR.has(t)||!t.track)return;const n={track:t.track};if(Tl()){if(!t.createEncodedStreams)return void T.warning("browser not support createEncodedStreams() API");let r=null;try{r=t.createEncodedStreams()}catch(l){return void T.error("create video-encoded-streams error",l&&l.message)}const s=[];e.on("sei-to-send",l=>{s.push(l)});const c=new TransformStream({transform(l,d){n.controller||(n.controller=d),t.track&&t.track.id!==n.track.id&&(T.debug("video track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i));const h=Yx(new Uint8Array(l.data)),p=s.shift();if(p){const m=function(_,E,I){switch(I){case Nw:return function(C,w){const D=Kx(w),N=D.length,L=Math.floor(N/255),W=N%255,G=new Uint8Array(6+L+1+N+C.byteLength);G[0]=0,G[1]=0,G[2]=0,G[3]=1,G[4]=6,G[5]=101;let U=0;for(;U<L;)G[6+U]=255,U++;return G[6+U]=W,U++,G.set(D,6+U),G.set(new Uint8Array(C),6+U+N),G.buffer}(_,E);case Dw:return function(C,w){const D=Kx(w),N=D.length,L=Math.floor(N/255),W=N%255,G=new Uint8Array(7+L+1+N+1+C.byteLength);G[0]=0,G[1]=0,G[2]=0,G[3]=1,G[4]=78,G[5]=1,G[6]=101;let U=0;for(;U<L;)G[7+U]=255,U++;return G[7+U]=W,U++,G.set(D,7+U),U+=N,G[7+U]=128,U++,G.set(new Uint8Array(C),7+U),G.buffer}(_,E);default:return null}}(l.data,p,h);m&&(l.data=m)}d.enqueue(l)}});r.readable.pipeThrough(c).pipeTo(r.writable)}else{if(!Di())return;{if(typeof RTCRtpScriptTransform>"u")return void T.warning("browser not support RTCRtpScriptTransform");const r=gR(),s=new MessageChannel;await new Tt(l=>r.onmessage=d=>{d.data==="registered"&&l(void 0)});const c=new RTCRtpScriptTransform(r,{name:"sei-tx",port:s.port2},[s.port2]);t.transform=c,await new Tt(l=>r.onmessage=d=>{d.data==="started"&&l(void 0)}),e.on("sei-to-send",l=>{s.port1.postMessage({sei:l})}),s.port1.onmessage=l=>{var d;l.data.transformed&&t.track&&((d=t.track)===null||d===void 0?void 0:d.id)!==n.track.id&&(T.debug("video track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i))},n.worker=r}}function i(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",i)}const r=AR.get(t);if(r){AR.delete(t);try{var s,c;(s=r.controller)===null||s===void 0||s.terminate(),(c=r.worker)===null||c===void 0||c.terminate()}catch(l){T.warning(l&&l.message)}}}AR.set(t,n),t.track.addEventListener("ended",i)},interceptRemoteVideoFrame:async function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!be().supportWebRTCEncodedTransform)return void T.warning("browser not support video encoded transform");if(!t.track)return;if(jg.has(t)){const r=jg.get(t);return void(r&&(r.onSei=e.onSei))}const n={track:t.track,onSei:e.onSei};if(Tl()){if(!t.createEncodedStreams)return void T.warning("browser not support createEncodedStreams() API");let r=null;try{r=t.createEncodedStreams()}catch(c){return void T.error("create video-encoded-streams error",c&&c.message)}const s=new TransformStream({transform(c,l){n.controller||(n.controller=l),t.track&&t.track.id!==n.track.id&&(T.debug("video track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i));const d=function(h,p){switch(p){case Nw:return function(m){const _=new DataView(m.data);let E=0;for(;E+4<m.data.byteLength;){if(_.getUint8(E+0)===0&&_.getUint8(E+1)===0&&_.getUint8(E+2)===0&&_.getUint8(E+3)===1&&_.getUint8(E+4)===6){let I=E+6,C=0,w=0;for(;(w=_.getUint8(I++))===255;)C+=255;C+=w;const D=qx(m.data,I,C);return new Uint8Array(D)}E++}return null}(h);case Dw:return function(m){const _=new DataView(m.data);let E=0;for(;E+5<m.data.byteLength;){if(_.getUint8(E+0)===0&&_.getUint8(E+1)===0&&_.getUint8(E+2)===0&&_.getUint8(E+3)===1&&_.getUint8(E+4)===78&&_.getUint8(E+5)===1&&_.getUint8(E+6)===101){let I=E+7,C=0,w=0;for(;(w=_.getUint8(I++))===255;)C+=255;C+=w;const D=qx(m.data,I,C);return new Uint8Array(D)}E++}return null}(h);default:return null}}(c,Yx(new Uint8Array(c.data)));d&&n.onSei&&n.onSei(d),l.enqueue(c)}});r.readable.pipeThrough(s).pipeTo(r.writable)}else if(Di()){if(typeof RTCRtpScriptTransform>"u")return void T.warning("browser not support RTCRtpScriptTransform");const r=gR(),s=new MessageChannel;await new Tt(l=>r.onmessage=d=>{d.data==="registered"&&l(void 0)});const c=new RTCRtpScriptTransform(r,{name:"sei-rx",port:s.port2},[s.port2]);t.transform=c,await new Tt(l=>r.onmessage=d=>{d.data==="started"&&l(void 0)}),s.port1.onmessage=l=>{var d;l.data.transformed&&t.track&&((d=t.track)===null||d===void 0?void 0:d.id)!==n.track.id?(T.debug("video track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i)):l.data.sei&&n.onSei&&n.onSei(l.data.sei)},n.worker=r}function i(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",i)}(function(r){const s=jg.get(r);if(s){jg.delete(r);try{var c,l;(c=s.controller)===null||c===void 0||c.terminate(),(l=s.worker)===null||l===void 0||l.terminate()}catch(d){T.warning(d&&d.message)}}})(t)}jg.set(t,n),t.track.addEventListener("ended",i)}},KW={name:"InterceptFrame",create:()=>qW};ew(),Fe("PROCESS_ID","process-".concat(Je(8,""),"-").concat(Je(4,""),"-").concat(Je(4,""),"-").concat(Je(4,""),"-").concat(Je(12,""))),function(){let t;try{t=window.localStorage.getItem("websdk_ng_global_parameter")}catch(e){return void T.error("Error loading sdk config",e.message)}if(t)try{const e=JSON.parse(window.atob(t)),n=Date.now();T.debug("Loading global parameters from cache",e),Object.keys(e).forEach(i=>{if(Object.prototype.hasOwnProperty.call(hn,i)){const{value:r,expires:s}=e[i];if(s&&s<=n)return;bo[i]=r,hn[i]=r}})}catch(e){T.error("Error loading mutableParamsCache: ".concat(t),e.message)}}(),Array.isArray(bo.AREAS)&&bo.AREAS.length>0&&Qw(bo.AREAS,!0);const zV=(t,e,n)=>{T.debug("setParameter key:".concat(t,", value:").concat(JSON.stringify(e))),Fe(t,e,n)};Zd(_W,!1),Zd(vW,!1),Zd(Z8,!1),Zd(NW,!1),Zd(pW,!1),Zd(GW,!1),Zd(zW,!1),Zd(KW,!1);const Qn=function(t){const e=new Sn,n=t,i={getListeners:e.getListeners.bind(e),on:(r,s)=>(function(c,l){c===Rc.SECURITY_POLICY_VIOLATION&&CU(l,!0)}(r,s),e.on.bind(e)(r,s)),addListener:e.addListener.bind(e),once:e.once.bind(e),off:e.off.bind(e),removeAllListeners:e.removeAllListeners.bind(e),emit:e.emit.bind(e),safeEmit:e.safeEmit.bind(e)};return bU(bU({},n),i)}({__TRACK_LIST__:hm,VERSION:$a,BUILD:rw,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:zV,getParameter:k,getSupportedCodec:async function(){let t={audio:[],video:[]};try{let e=new RTCPeerConnection;const n=await async function(i){let r;return be().supportUnifiedPlan?(i.addTransceiver("video",{direction:"recvonly"}),i.addTransceiver("audio",{direction:"recvonly"}),r=(await i.createOffer()).sdp):r=(await i.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,r}(e);if(!n)return t;e.close(),e=null,t=function(i){const r={video:[],audio:[]};return i.match(/ VP8/i)&&r.video.push("VP8"),i.match(/ VP9/i)&&r.video.push("VP9"),i.match(/ AV1/i)&&r.video.push("AV1"),i.match(/ H264/i)&&r.video.push("H264"),i.match(/ H265/i)&&r.video.push("H265"),i.match(/ opus/i)&&r.audio.push("OPUS"),i.match(/ PCMU/i)&&r.audio.push("PCMU"),i.match(/ PCMA/i)&&r.audio.push("PCMA"),i.match(/ G722/i)&&r.audio.push("G722"),r}(n)}catch(e){throw new K(P.CREATE_OFFER_FAILED,e.toString&&e.toString()).print()}return t},checkSystemRequirements:function(){const t=Pt.reportApiInvoke(null,{name:kn.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:_n.TRACER});let e=!1;try{const s=window.RTCPeerConnection,c=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,l=window.WebSocket;e=!!(s&&c&&l),e&&BA()&&qk(75)&&new s().close()}catch(s){return T.error("check system requirement failed: ",s),!1}let n=!1;const i=ve();i.name===Ie.CHROME&&Number(i.version)>=58&&(To.engine.name!=="WebKit"||function(){const s=ve();if(eR()){if(s.os===di.MAC_OS)return!0;if(s.os===di.IOS){const c=To.os.version&&To.os.version.split(".");if(c&&Number(c[0])===14&&c[1]&&Number(c[1])>=3||c&&Number(c[0])>14)return!0}}return!1}())&&(n=!0),(i.name===Ie.FIREFOX&&Number(i.version)>=56||i.name===Ie.OPERA&&Number(i.version)>=45||i.name===Ie.SAFARI&&Number(i.version)>=11||i.name==="WebKit"&&(rr()||Ns())&&i.osVersion&&Number(i.osVersion.split(".")[0])>=11||Zk()||ve().name===Ie.QQ)&&(n=!0),T.debug("checkSystemRequirements, api:",e,"browser",n);const r=e&&n;return t.onSuccess(r),r},getDevices:function(t){return Da.enumerateDevices(!0,!0,t)},getMicrophones:function(t){return Da.getRecordingDevices(t)},getCameras:function(t){return Da.getCamerasDevices(t)},getElectronScreenSources:qL,getPlaybackDevices:function(t){return Da.getSpeakers(t)},createClient:function(){var t;let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const n=Je(5,"client-"),i=Pt.reportApiInvoke(null,{id:n,name:kn.CREATE_CLIENT,options:[e],tag:_n.TRACER});try{(function(r){ri(r.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),ri(r.mode,"config.mode",["rtc","live","p2p"]),r.audioCodec!==void 0&&ri(r.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),r.proxyServer!==void 0&&Ti(r.proxyServer,"config.proxyServer",1,1e4),r.turnServer!==void 0&&sL(r.turnServer),r.httpRetryConfig!==void 0&&aL(r.httpRetryConfig),r.websocketRetryConfig!==void 0&&aL(r.websocketRetryConfig)})(e)}catch(r){throw i.onError(r),r}return(Xk(16,0)||UA(16,0,!0))&&(e.codec==="vp9"&&(e.codec="vp8",T.debug("browser not support vp9, force use vp8")),Fe("UNSUPPORTED_VIDEO_CODEC",["vp9"])),e.audioCodec===void 0&&(e.audioCodec="opus"),i.onSuccess(),new $8(js(js({forceWaitGatewayResponse:!0},e),{},{role:mt(t=["rtc","p2p"]).call(t,e.mode)?"host":e.role||"audience"}),n)},createCameraVideoTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=k("CAMERA_CAPTURE_CONFIG"),n=Je(8,"track-cam-"),i=Pt.reportApiInvoke(null,{id:n,tag:_n.TRACER,name:kn.CREATE_CAM_VIDEO_TRACK,options:[rn({},t),e]});e&&(t.encoderConfig=e);const r=_R(t);let s=null;T.info("start create camera video track with config",JSON.stringify(t),"trackId",n);try{s=(await Na({video:r},n)).getVideoTracks()[0]||null}catch(l){throw i.onError(l),l}if(!s){const l=new Z(P.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(l),l.throw(T)}if(t.optimizationMode&&yw(n,s,t,ks(t.encoderConfig)),k("USE_STANDARD_BITRATE_DEFAULT")){const l=ks(t.encoderConfig);t.encoderConfig=l,delete l.bitrateMax,delete l.bitrateMin}const c=new ER(s,t,r,t.scalabiltyMode?hR(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,n);return i.onSuccess(c.getTrackId()),T.info("create camera video success, trackId:",n),c},createCustomVideoTrack:function(t){const e=Je(8,"track-cus-"),n=Pt.reportApiInvoke(null,{id:e,tag:_n.TRACER,name:kn.CREATE_CUSTOM_VIDEO_TRACK,options:[t]});k("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin);const i=new sn(t.mediaStreamTrack,{width:t.width,height:t.height,frameRate:t.frameRate,bitrateMax:t.bitrateMax,bitrateMin:t.bitrateMin},t.scalabiltyMode?hR(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,e,[Ye.CUSTOM_TRACK]);return n.onSuccess(i.getTrackId()),T.info("create custom video track success with config",t,"trackId",i.getTrackId()),i},createScreenVideoTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const n=typeof e=="object"?function(_){return n1(_)}(e):void 0;n&&(e="auto");const i=Je(8,"track-scr-v-"),r=Pt.reportApiInvoke(null,{id:i,tag:_n.TRACER,name:kn.CREATE_SCREEN_VIDEO_TRACK,options:[rn({},t),e]});t.encoderConfig?typeof t.encoderConfig=="string"||t.encoderConfig.width&&t.encoderConfig.height||(t.encoderConfig.width={max:1920},t.encoderConfig.height={max:1080}):t.encoderConfig="1080p_2";const s=function(_){const E={};_.screenSourceType&&(E.mediaSource=_.screenSourceType),_.extensionId&&Tl()&&(E.extensionId=_.extensionId);const{displaySurface:I,selfBrowserSurface:C,surfaceSwitching:w,systemAudio:D,preferCurrentTab:N}=_;(im(107)||xA(107)||VA(93))&&(I&&(ri(I,"displaySurface",["browser","window","monitor"]),E.displaySurface=I),C?(ri(C,"selfBrowserSurface",["exclude","include"]),E.selfBrowserSurface=C):E.selfBrowserSurface="include",w&&(ri(w,"surfaceSwitching",["exclude","include"]),E.surfaceSwitching=w)),(im(105)||xA(105)||VA(91))&&D&&(ri(D,"systemAudio",["exclude","include"]),E.systemAudio=D),(im(94)||xA(94)||VA(80))&&N&&(E.preferCurrentTab=!0),_.electronScreenSourceId&&(E.sourceId=_.electronScreenSourceId);const L=_.encoderConfig?dw(_.encoderConfig):null;return E.mandatory={chromeMediaSource:"desktop",maxWidth:L?L.width:void 0,maxHeight:L?L.height:void 0},L&&(L.frameRate&&(typeof L.frameRate=="number"?(E.mandatory.maxFrameRate=L.frameRate,E.mandatory.minFrameRate=L.frameRate):(E.mandatory.maxFrameRate=L.frameRate.max||L.frameRate.ideal||L.frameRate.exact||void 0,E.mandatory.minFrameRate=L.frameRate.min||L.frameRate.ideal||L.frameRate.exact||void 0),E.frameRate=L.frameRate),L.width&&(E.width=L.width),L.height&&(E.height=L.height)),E}(t);let c=null,l=null;const d=be();if(!d.supportShareAudio&&e==="enable"){const _=new Z(P.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return r.onError(_),_.throw(T)}T.info("start create screen video track with config",t,"withAudio",e,"trackId",i);const h=d.supportShareAudio&&e!=="disable";try{const _=await Na({screen:s,screenAudio:h?n||!0:void 0},i);c=_.getVideoTracks()[0]||null,l=_.getAudioTracks()[0]||null}catch(_){throw r.onError(_),_}if(!c){const _=new Z(P.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(_),_.throw(T)}if(!l&&e==="enable"){c&&c.stop();const _=new Z(P.SHARE_AUDIO_NOT_ALLOWED);return r.onError(_),_.throw(T)}t.optimizationMode||(t.optimizationMode="detail"),t.optimizationMode&&(yw(i,c,t,t.encoderConfig&&dw(t.encoderConfig)||void 0),t.encoderConfig&&typeof t.encoderConfig!="string"&&(t.encoderConfig.bitrateMin=t.encoderConfig.bitrateMax));const p=new sn(c,t.encoderConfig?dw(t.encoderConfig):{},t.scalabiltyMode?hR(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,i,[Ye.SCREEN_TRACK]);if(!l)return r.onSuccess(p.getTrackId()),T.info("create screen video track success","video:",p.getTrackId()),p;const m=new Nn(l,void 0,Je(8,"track-scr-a-"),!1);return r.onSuccess([p.getTrackId(),m.getTrackId()]),T.info("create screen video track success","video:",p.getTrackId(),"audio:",m.getTrackId()),[p,m]},createMicrophoneAndCameraTracks:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=k("CAMERA_CAPTURE_CONFIG"),i=Je(8,"track-mic-"),r=Je(8,"track-cam-"),s=Pt.reportApiInvoke(null,{id:"".concat(i,"-").concat(r),tag:_n.TRACER,name:kn.CREATE_MIC_AND_CAM_TRACKS,options:[t,e,n]});n&&(e.encoderConfig=n);const c=_R(e),l=i1(t);let d=null,h=null;T.info("start create camera video track(".concat(r,") and microphone audio track(").concat(i,") with config, audio: ").concat(JSON.stringify(t),", video: ").concat(JSON.stringify(e)));try{const _=await Na({audio:l,video:c},"".concat(i,"-").concat(r));d=_.getAudioTracks()[0],h=_.getVideoTracks()[0]}catch(_){throw s.onError(_),_}if(!d||!h){const _=new Z(P.UNEXPECTED_ERROR,"can not find tracks in media stream");return s.onError(_),_.throw(T)}if(e.optimizationMode&&yw(r,h,e,ks(e.encoderConfig)),k("USE_STANDARD_BITRATE_DEFAULT")){const _=ks(e.encoderConfig);e.encoderConfig=_,delete _.bitrateMax,delete _.bitrateMin}const p=new Vg(d,t,l,i),m=new ER(h,e,c,e.scalabiltyMode?hR(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,r);return s.onSuccess([p.getTrackId(),m.getTrackId()]),T.info("create camera video track(".concat(r,") and microphone audio track(").concat(i,") success")),[p,m]},createMicrophoneAudioTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=Je(8,"track-mic-"),n=Pt.reportApiInvoke(null,{id:e,tag:_n.TRACER,name:kn.CREATE_MIC_AUDIO_TRACK,options:[t]}),i=i1(t);let r=null;T.info("start create microphone audio track with config",JSON.stringify(t),"trackId",e);try{r=(await Na({audio:i},e)).getAudioTracks()[0]||null}catch(c){throw n.onError(c),c}if(!r){const c=new Z(P.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(c),c.throw(T)}const s=new Vg(r,t,i,e);return n.onSuccess(s.getTrackId()),T.info("create microphone audio track success, trackId:",e),s},createCustomAudioTrack:function(t){const e=Je(8,"track-cus-"),n=Pt.reportApiInvoke(null,{id:e,tag:_n.TRACER,name:kn.CREATE_CUSTOM_AUDIO_TRACK,options:[t]}),i=new Nn(t.mediaStreamTrack,t.encoderConfig?pR(t.encoderConfig):{},e,!1);return T.info("create custom audio track success with config",t,"trackId",i.getTrackId()),n.onSuccess(i.getTrackId()),i},createBufferSourceAudioTrack:async function(t){var e;const{cacheOnlineFile:n,encoderConfig:i}=t;let{source:r}=t;const s={source:r instanceof AudioBuffer?"AudioBuffer":r instanceof File?(e=File.name)!==null&&e!==void 0?e:"File":r,cacheOnlineFile:n,encoderConfig:i},c=Je(8,"track-buf-"),l=Pt.reportApiInvoke(null,{id:c,tag:_n.TRACER,name:kn.CREATE_BUFFER_AUDIO_TRACK,options:[s]});if(k("DISABLE_WEBAUDIO"))throw new Z(P.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");T.info("start create buffer source audio track with config",JSON.stringify(s),"trackId",c);const d=r;if(!(r instanceof AudioBuffer))try{r=await async function(m,_){let E=null;if(typeof m=="string"){const C=H1.get(m);if(C)return T.debug("use cached audio resource: ",m),C;try{E=(await Ro(()=>Ir.get(m,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(w){throw new Z(P.FETCH_AUDIO_FILE_FAILED,w.toString())}}else E=await new Tt((w,D)=>{const N=new FileReader;N.onload=L=>{L.target?w(L.target.result):D(new Z(P.READ_LOCAL_AUDIO_FILE_ERROR))},N.onerror=()=>{D(new Z(P.READ_LOCAL_AUDIO_FILE_ERROR))},N.readAsArrayBuffer(m)});const I=await function(C){const w=Em();return new Tt((D,N)=>{w.decodeAudioData(C,L=>{D(L)},L=>{N(new Z(P.DECODE_AUDIO_FILE_FAILED,L.toString()))})})}(E);return typeof m=="string"&&_&&H1.set(m,I),I}(r,n)}catch(m){return l.onError(m),m.throw(T)}const h=new vG(r),p=new gG(d,h,i?pR(i):{},c);return T.info("create buffer source audio track success, trackId:",c),l.onSuccess(p.getTrackId()),p},setAppType:function(t){if(T.debug("setAppType: ".concat(t)),!(Number.isInteger(t)&&t>=0))throw T.debug("Invalid appType"),new K(P.INVALID_PARAMS,"invalid app type",t);Fe("APP_TYPE",Math.floor(t))},setLogLevel:function(t){T.setLogLevel(t)},enableLogUpload:function(){k("USE_NEW_LOG")?Fe("UPLOAD_LOG",!0):T.enableLogUpload()},disableLogUpload:function(){k("USE_NEW_LOG")?Fe("UPLOAD_LOG",!1):T.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new qM},checkAudioTrackIsActive:async function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=Pt.reportApiInvoke(null,{tag:_n.TRACER,name:kn.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[e]});if(!(t instanceof Nn||t instanceof Sm)){const d=new K(P.INVALID_TRACK,"the parameter is not a audio track");return n.onError(d),d.throw()}e&&e<1e3&&(e=1e3);const i=t instanceof Nn?t.getTrackLabel():"remote_track",r=t.getVolumeLevel();let s=r,c=r;const l=Date.now();return new Tt(d=>{const h=setInterval(()=>{const p=t.getVolumeLevel();s=p>s?p:s,c=p<c?p:c;const m=s-c>1e-4,_=Date.now()-l;if(m||_>e){clearInterval(h);const E=m,I={duration:_,deviceLabel:i,maxVolumeLevel:s,result:E};T.info("[track-".concat(t.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(I))),n.onSuccess(I),d(E)}},200)})},checkVideoTrackIsActive:async function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=Pt.reportApiInvoke(null,{tag:_n.TRACER,name:kn.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[e]});if(!(t instanceof sn||t instanceof vm)){const m=new K(P.INVALID_TRACK,"the parameter is not a video track");return n.onError(m),m.throw()}e&&e<1e3&&(e=1e3);const i=t instanceof sn?t.getTrackLabel():"remote_track",r=t.getMediaStreamTrack(!0),s=document.createElement("video");s.style.width="1px",s.style.height="1px",s.setAttribute("muted",""),s.muted=!0,s.setAttribute("playsinline",""),s.controls=!1,(Di()||eR())&&(s.style.opacity="0.01",s.style.position="fixed",s.style.left="0",s.style.top="0",document.body.appendChild(s)),s.srcObject=new MediaStream([r]),s.play();const c=document.createElement("canvas");c.width=160,c.height=120;let l=0,d=0;try{const m=Date.now();l=await function(_,E,I,C){let w,D=0,N=null;return new Tt((L,W)=>{function G(){D>C&&w&&(w(),L(D));const U=I.getContext("2d");if(!U){const rt=new K(P.UNEXPECTED_ERROR,"can not get canvas 2d context.");return T.error(rt.toString()),void W(rt)}U.drawImage(_,0,0,160,120);const z=U.getImageData(0,0,I.width,I.height),$=Math.floor(z.data.length/3);if(N){for(let rt=0;rt<$;rt+=3)if(z.data[rt]!==N[rt])return D+=1,void(N=z.data);N=z.data}else N=z.data}setTimeout(()=>{w&&(w(),L(D))},E),w=mw(()=>{G()},30)})}(s,e,c,4),d=Date.now()-m}catch(m){throw n.onError(m),m}V8===Ie.SAFARI&&(s.pause(),s.remove()),s.srcObject=null;const h=l>4,p={duration:d,changedPicNum:l,deviceLabel:i,result:h};return T.info("[track-".concat(t.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(p))),n.onSuccess(p),h},setArea:Qw,audioElementPlayCenter:Or,resumeAudioContext:function(){Or.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(t){eH.processExternalMediaAEC(t)},registerExtensions:function(t){const e=k("PLUGIN_INFO")||[];t.forEach(n=>{"name"in n&&!mt(e).call(e,n.name)&&e.push(n.name);const i=n;i.__registered__=!0,i.logger.hookLog=T.extLog,i.reporter.hookApiInvoke=Pt.extApiInvoke,i.parameters&&Object.keys(i.parameters).forEach(r=>{i.parameters[r]=k(r)})}),zV("PLUGIN_INFO",e)},ChannelMediaRelayError:Rm,ChannelMediaRelayEvent:Cl,ChannelMediaRelayState:qr,RemoteStreamFallbackType:uG,RemoteStreamType:dG,ConnectionDisconnectedReason:xe,AudienceLatencyLevelType:F6,AREAS:Pe,preload:async function(t,e,n,i){return _2(t,e,n,i)}});return Object.defineProperties(Qn,{onAudioAutoplayFailed:{get:()=>Pa.onAudioAutoplayFailed,set:t=>{Pa.onAudioAutoplayFailed=t}},onAutoplayFailed:{get:()=>Pa.onAutoplayFailed,set:t=>{Pa.onAutoplayFailed=t}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>Qn._onSecurityPolicyViolation,set(t){Qn._onSecurityPolicyViolation=t,CU(t)}},__CLIENT_LIST__:{get:()=>k("SHOW_GLOBAL_CLIENT_LIST")?Fh:[]}}),Da.on(Uh.CAMERA_DEVICE_CHANGED,t=>{T.info("camera device changed",JSON.stringify(t)),Qn.onCameraChanged&&Qn.onCameraChanged(t),Qn.safeEmit(Rc.CAMERA_CHANGED,t)}),Da.on(Uh.RECORDING_DEVICE_CHANGED,t=>{T.info("microphone device changed",JSON.stringify(t)),Qn.onMicrophoneChanged&&Qn.onMicrophoneChanged(t),Qn.safeEmit(Rc.MICROPHONE_CHANGED,t)}),Da.on(Uh.PLAYOUT_DEVICE_CHANGED,t=>{T.debug("playout device changed",JSON.stringify(t)),Qn.onPlaybackDeviceChanged&&Qn.onPlaybackDeviceChanged(t),Qn.safeEmit(Rc.PLAYBACK_DEVICE_CHANGED,t)}),Or.onAutoplayFailed=()=>{T.info("detect audio element autoplay failed"),Pa.onAudioAutoplayFailed&&Pa.onAudioAutoplayFailed()},Ge.on("autoplay-failed",()=>{T.info("detect webaudio autoplay failed"),Pa.onAudioAutoplayFailed&&Pa.onAudioAutoplayFailed(),Qn.safeEmit(Rc.AUTOPLAY_FAILED)}),Ge.on(bi.STATE_CHANGE,(t,e)=>{T.info("audio context state changed: ".concat(e," => ").concat(t)),Qn.onAudioContextStateChanged&&Qn.onAudioContextStateChanged(t,e),Qn.safeEmit(Rc.AUDIO_CONTEXT_STATE_CHANGED,t,e)}),Wn.on(am.NETWORK_STATE_CHANGE,(t,e)=>{T.info("[network-indicator] network state changed, ".concat(e," => ").concat(t))}),window&&(window.__ARTC__=Qn),Qn})}(xb)),xb.exports}var uY=dY();const sB=Fb(uY),hY=(S,v,y,A,V)=>{const[B,Y]=Ot.useState(null),[et,J]=Ot.useState([]),[Q,ht]=Ot.useState(!0),[Et,vt]=Ot.useState(!1),[Ft,xt]=Ot.useState(!1),Oe=Mi(He.rooms.updateSpeakingStatus);return Ot.useEffect(()=>{if(!S||!A||!y)return;const fn=async()=>{if(!Ft){xt(!0);try{await S.join(v,y,A,V);const ue=await sB.createMicrophoneAudioTrack();ue.setMuted(!0),await S.publish([ue]),Y(ue)}catch(ue){console.error("Failed to join Agora channel",ue)}finally{xt(!1)}}},Be=async(ue,ln)=>{var yn;await S.subscribe(ue,ln),ln==="audio"&&((yn=ue.audioTrack)==null||yn.play()),J(si=>[...si,ue])},fe=ue=>{J(ln=>ln.filter(yn=>yn.uid!==ue.uid))},Ae=ue=>{J(ln=>[...ln,ue])},xn=ue=>{J(ln=>ln.filter(yn=>yn.uid!==ue.uid))};return fn(),S.on("user-published",Be),S.on("user-unpublished",fe),S.on("user-joined",Ae),S.on("user-left",xn),()=>{S.off("user-published",Be),S.off("user-unpublished",fe),S.off("user-joined",Ae),S.off("user-left",xn),B==null||B.close(),S.leave()}},[S,A,y,v,V]),{localAudioTrack:B,remoteUsers:et,isMuted:Q,isSpeakersMuted:Et,toggleMute:async()=>{if(!B)return;const fn=!Q;await B.setMuted(fn),ht(fn),Oe({roomId:y,isSpeaking:!fn})},toggleSpeakers:()=>{const fn=!Et;et.forEach(Be=>{var fe;(fe=Be.audioTrack)==null||fe.setVolume(fn?0:100)}),vt(fn)}}};var pY={};const fY=sB.createClient({mode:"rtc",codec:"vp8"});function mY({roomId:S,onBack:v}){var yn,si,wi;const y=Qi(He.rooms.get,{id:S}),A=Qi(He.chat.list,{roomId:S}),V=Qi(He.users.getUserProfile),B=Mi(He.agora.generateToken),Y=Mi(He.rooms.takeSeat),et=Mi(He.chat.send),[J,Q]=Ot.useState(""),[ht,Et]=Ot.useState(null),[vt,Ft]=Ot.useState(!1),[xt,Oe]=Ot.useState(null),Ue=Ot.useRef(null);Ot.useEffect(()=>{S&&V&&B({channelName:S}).then(Oe)},[S,B,V]);const{isMuted:vn,isSpeakersMuted:fn,toggleMute:Be,toggleSpeakers:fe}=hY(fY,pY.VITE_AGORA_APP_ID,S,xt,(V==null?void 0:V.userId)??"");if(Ot.useEffect(()=>{Ue.current&&(Ue.current.scrollTop=Ue.current.scrollHeight)},[A]),!y||!V)return H.jsx("div",{className:"flex justify-center items-center h-screen bg-purple-900",children:H.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-4 border-white"})});const Ae=async qt=>{if(qt.preventDefault(),J.trim()!=="")try{await et({roomId:S,text:J}),Q("")}catch(oe){console.error(oe),alert(oe.message)}},xn=(qt,oe)=>{oe?Et(oe.userId):Y({roomId:S,seatIndex:qt}).catch(Kt=>alert(Kt.message))},ue=((yn=y.seats)==null?void 0:yn.filter(qt=>qt!==null).length)??0,ln=(si=y.seats)==null?void 0:si.some(qt=>(qt==null?void 0:qt.userId)===V.userId);return H.jsxs("div",{className:"h-screen flex flex-col",children:[H.jsx("div",{className:"fixed inset-0 bg-gradient-to-b from-[#3f2a9f] to-[#7a3dbb] -z-10"}),H.jsxs("header",{className:"flex-shrink-0 h-16 bg-[#2a1f6e] flex items-center space-x-3 p-3 z-30",children:[H.jsx("img",{alt:y.name,className:"w-10 h-10 rounded-lg object-cover",src:y.image}),H.jsxs("div",{className:"flex flex-col text-white",children:[H.jsx("span",{className:"text-base font-semibold",children:y.name}),H.jsxs("span",{className:"text-xs font-semibold",children:["ID: ",y.displayId]})]}),H.jsx("button",{onClick:v,className:"absolute right-2 top-1/2 -translate-y-1/2 text-white text-2xl",children:H.jsx("i",{className:"fas fa-arrow-left"})})]}),H.jsxs("main",{className:"flex-1 flex flex-col overflow-hidden",children:[H.jsxs("div",{className:"flex-shrink-0 z-20 bg-gradient-to-b from-[#3f2a9f] to-[#5c33ac] pb-3",children:[H.jsx("div",{className:"flex justify-between px-4 my-4",children:H.jsxs("div",{className:"flex items-center space-x-1 bg-[#2a1f6e] rounded-full px-2 py-0.5 text-base font-semibold min-w-[40px] justify-center text-white",children:[H.jsx("span",{children:ue}),H.jsx("i",{className:"fas fa-user-friends text-lg"})]})}),H.jsx("div",{className:"relative px-6 grid grid-cols-4 gap-x-3 gap-y-4",children:Array.from({length:12}).map((qt,oe)=>{var St;const Kt=(St=y.seats)==null?void 0:St[oe],ne=y.speakingSeatIndex===oe;return H.jsxs("button",{type:"button",className:"flex flex-col items-center space-y-1 focus:outline-none relative text-white",onClick:()=>xn(oe,Kt),children:[H.jsx("div",{className:`w-14 h-14 rounded-full border flex items-center justify-center text-3xl font-light relative ${ne?"border-cyan-400 border-2 animate-pulse":"border-white/40"}`,children:Kt?H.jsxs(H.Fragment,{children:[H.jsx("img",{src:Kt.imageUrl??`https://ui-avatars.com/api/?name=${Kt.name}`,alt:Kt.name??"",className:"w-full h-full rounded-full object-cover"}),ne&&H.jsx("i",{className:"fas fa-microphone absolute -top-2 left-0 text-cyan-400 text-xl z-20"})]}):"+"}),H.jsx("span",{className:"text-white/60 text-xs font-semibold",children:oe+1}),Kt&&H.jsx("span",{className:"text-white text-xs font-semibold truncate max-w-[56px] text-center",children:Kt.name})]},oe)})})]}),H.jsx("div",{ref:Ue,className:"flex-1 overflow-y-auto px-4 space-y-3 py-2",children:A==null?void 0:A.map(qt=>{var oe,Kt,ne,St;return H.jsx("div",{className:"flex items-start space-x-2",children:qt.isSystemMessage?H.jsx("div",{className:"text-center w-full text-purple-300 text-xs italic py-1",children:qt.text}):H.jsxs(H.Fragment,{children:[H.jsx("img",{src:((oe=qt.author)==null?void 0:oe.imageUrl)??`https://ui-avatars.com/api/?name=${(Kt=qt.author)==null?void 0:Kt.name}`,alt:((ne=qt.author)==null?void 0:ne.name)??"",className:"w-8 h-8 rounded-full cursor-pointer",onClick:()=>qt.authorId&&Et(qt.authorId)}),H.jsxs("div",{className:"flex-1",children:[H.jsx("span",{className:"font-semibold text-xs block mb-0.5 text-white",children:(St=qt.author)==null?void 0:St.name}),H.jsxs("div",{className:"bg-[#2a1f6e] rounded-lg py-1.5 px-3 w-max max-w-xs text-xs text-white",children:[qt.text&&H.jsx("p",{children:qt.text}),qt.gift&&H.jsxs("div",{className:"flex items-center gap-1",children:[H.jsx("span",{children:"أرسل"}),H.jsx("img",{src:qt.gift.url,alt:qt.gift.name,className:"w-6 h-6"}),H.jsx("span",{children:qt.gift.name})]})]})]})]})},qt._id)})})]}),H.jsxs("footer",{className:"flex-shrink-0 h-16 bg-[#2a1f6e] py-2 px-3 flex items-center space-x-2 z-30 text-white",children:[H.jsx("button",{className:"w-10 h-10 rounded-full flex items-center justify-center text-lg",children:H.jsx("i",{className:"fas fa-envelope"})}),H.jsx("button",{onClick:()=>Ft(!0),className:"w-10 h-10 rounded-full bg-yellow-400 shadow-[0_0_10px_#facc15] flex items-center justify-center text-lg",children:H.jsx("i",{className:"fas fa-gift"})}),H.jsxs("form",{onSubmit:Ae,className:"flex-1 flex items-center space-x-2",children:[H.jsx("input",{type:"text",value:J,onChange:qt=>Q(qt.target.value),placeholder:"اكتب رسالة",className:"flex-1 rounded-full bg-[#3a2a7a] py-1.5 px-3 placeholder-white/70 focus:outline-none"}),H.jsx("button",{type:"submit",className:"bg-cyan-500 hover:bg-cyan-600 transition-colors rounded-full w-10 h-10 text-lg flex items-center justify-center",children:H.jsx("i",{className:"fas fa-paper-plane"})})]}),ln&&H.jsxs(H.Fragment,{children:[H.jsx("button",{onClick:Be,className:"w-10 h-10 rounded-full flex items-center justify-center text-lg",children:H.jsx("i",{className:`fas ${vn?"fa-microphone-slash text-red-500":"fa-microphone"}`})}),H.jsx("button",{onClick:fe,className:"w-10 h-10 rounded-full flex items-center justify-center text-lg",children:H.jsx("i",{className:`fas ${fn?"fa-volume-mute text-red-500":"fa-volume-up"}`})})]})]}),ht&&H.jsx(oY,{targetUserId:ht,roomId:S,onClose:()=>Et(null)}),vt&&H.jsx(cY,{roomId:S,onClose:()=>Ft(!1),seatedUsers:((wi=y.seats)==null?void 0:wi.filter(qt=>qt!==null))??[]})]})}function _Y({userId:S,onBack:v,onStartConversation:y}){const A=Qi(He.users.getProfileForPage,{userId:S}),V=Mi(He.users.follow),B=Mi(He.users.unfollow),Y=Qi(He.users.getUserProfile);if(!A||!Y)return H.jsx("div",{className:"flex justify-center items-center h-screen",children:H.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-4 border-purple-700"})});const et=Y.userId===S;return H.jsxs("div",{className:"bg-gray-100 min-h-screen",children:[H.jsxs("div",{className:"relative",children:[H.jsx("img",{src:A.backgroundImageUrl??"https://placehold.co/600x200/d8b4fe/3730a3?text=+",alt:"background",className:"w-full h-48 object-cover"}),H.jsx("button",{onClick:v,className:"absolute top-4 left-4 bg-white bg-opacity-70 rounded-full w-8 h-8 flex items-center justify-center",children:H.jsx("i",{className:"fas fa-arrow-left text-purple-800"})}),H.jsx("div",{className:"absolute -bottom-12 left-1/2 -translate-x-1/2",children:H.jsx("img",{src:A.imageUrl??`https://ui-avatars.com/api/?name=${A.name}&background=random`,alt:"profile",className:"w-24 h-24 rounded-full border-4 border-white shadow-lg"})})]}),H.jsxs("div",{className:"pt-16 text-center",children:[H.jsx("h1",{className:"text-2xl font-bold text-purple-900",children:A.name}),H.jsxs("p",{className:"text-sm text-gray-500",children:["ID: ",A.displayId]}),H.jsxs("div",{className:"mt-2 px-4 py-1 bg-purple-200 text-purple-800 rounded-full inline-block",children:["Lv. ",A.level]})]}),H.jsxs("div",{className:"flex justify-around my-4 border-y py-2",children:[H.jsxs("div",{className:"text-center",children:[H.jsx("div",{className:"font-bold",children:A.followers}),H.jsx("div",{className:"text-sm text-gray-600",children:"متابع"})]}),H.jsxs("div",{className:"text-center",children:[H.jsx("div",{className:"font-bold",children:A.following}),H.jsx("div",{className:"text-sm text-gray-600",children:"يتابع"})]})]}),!et&&H.jsxs("div",{className:"flex justify-center gap-4 my-4",children:[A.isFollowing?H.jsx("button",{onClick:()=>B({userId:S}),className:"bg-gray-300 text-black px-6 py-2 rounded-full font-semibold",children:"إلغاء المتابعة"}):H.jsx("button",{onClick:()=>V({userId:S}),className:"bg-purple-600 text-white px-6 py-2 rounded-full font-semibold",children:"متابعة"}),H.jsx("button",{onClick:()=>y(S),className:"border border-purple-600 text-purple-600 px-6 py-2 rounded-full font-semibold",children:"رسالة"})]}),H.jsxs("div",{className:"p-4",children:[H.jsx("h2",{className:"font-bold text-lg mb-2",children:"اللحظات"}),H.jsx("div",{className:"grid grid-cols-3 gap-1",children:A.posts.map(J=>H.jsx("img",{src:J.imageUrl??"https://placehold.co/200x200",alt:"post",className:"w-full aspect-square object-cover rounded"},J._id))})]})]})}function EY({onEnterConversation:S}){const v=Qi(He.messages.listConversations);return H.jsxs("div",{className:"p-4",children:[H.jsxs("div",{className:"space-y-4",children:[H.jsxs("div",{className:"flex items-center p-3 bg-white rounded-lg shadow-sm",children:[H.jsx("i",{className:"fas fa-headset text-purple-600 text-xl"}),H.jsx("span",{className:"mr-4 font-semibold",children:"خدمة العملاء"})]}),H.jsxs("div",{className:"flex items-center p-3 bg-white rounded-lg shadow-sm",children:[H.jsx("i",{className:"fas fa-bell text-purple-600 text-xl"}),H.jsx("span",{className:"mr-4 font-semibold",children:"رسائل النظام"})]})]}),H.jsx("div",{className:"mt-6",children:v==null?void 0:v.map(y=>{var A,V,B,Y,et;return H.jsxs("div",{onClick:()=>S(y._id),className:"flex items-center p-3 bg-white rounded-lg shadow-sm mb-2 cursor-pointer hover:bg-purple-50",children:[H.jsx("img",{src:((A=y.otherUser)==null?void 0:A.image)??`https://ui-avatars.com/api/?name=${(V=y.otherUser)==null?void 0:V.name}`,alt:(B=y.otherUser)==null?void 0:B.name,className:"w-12 h-12 rounded-full"}),H.jsxs("div",{className:"mr-4",children:[H.jsx("div",{className:"font-bold",children:(Y=y.otherUser)==null?void 0:Y.name}),H.jsx("div",{className:"text-sm text-gray-500 truncate",children:(et=y.lastMessage)==null?void 0:et.text})]})]},y._id)})})]})}function Nj({conversationId:S,partnerId:v,onBack:y}){const[A,V]=Ot.useState(S??null),B=Mi(He.messages.createConversation),Y=Mi(He.messages.send);Ot.useEffect(()=>{!A&&v&&(async()=>{const Oe=await B({participantId:v});V(Oe)})()},[A,v,B]);const et=Qi(He.messages.list,A?{conversationId:A}:"skip"),J=Qi(He.users.getProfile,v?{userId:v}:"skip"),Q=Qi(He.users.getUserProfile),[ht,Et]=Ot.useState(""),vt=Ot.useRef(null);Ot.useEffect(()=>{vt.current&&(vt.current.scrollTop=vt.current.scrollHeight)},[et]);const Ft=async xt=>{xt.preventDefault(),ht.trim()!==""&&A&&(await Y({conversationId:A,text:ht}),Et(""))};return!Q||v&&!J?H.jsx("div",{className:"flex justify-center items-center h-screen",children:H.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-4 border-purple-700"})}):H.jsxs("div",{className:"flex flex-col h-screen bg-purple-50 text-gray-800",children:[H.jsxs("header",{className:"flex items-center justify-between p-2 bg-white shadow-md",children:[H.jsx("button",{onClick:y,className:"text-purple-600",children:H.jsx("i",{className:"fas fa-arrow-left"})}),H.jsx("h1",{className:"font-bold text-lg text-purple-800",children:J==null?void 0:J.name}),H.jsx("div",{className:"w-8"})]}),H.jsx("div",{ref:vt,className:"flex-grow p-2 overflow-y-auto",children:et==null?void 0:et.map(xt=>H.jsx("div",{className:`flex items-start gap-2 my-2 ${xt.authorId===Q.userId?"justify-end":""}`,children:H.jsx("div",{className:`p-2 rounded-lg shadow-sm ${xt.authorId===Q.userId?"bg-purple-600 text-white":"bg-white"}`,children:H.jsx("p",{children:xt.text})})},xt._id))}),H.jsx("footer",{className:"p-2 bg-white shadow-t-md",children:H.jsxs("form",{onSubmit:Ft,className:"flex items-center gap-2",children:[H.jsx("input",{type:"text",value:ht,onChange:xt=>Et(xt.target.value),placeholder:"اكتب رسالتك...",className:"flex-grow p-2 rounded-full border border-purple-300 focus:outline-none focus:ring-2 focus:ring-purple-500"}),H.jsx("button",{type:"submit",className:"bg-purple-600 text-white px-4 py-2 rounded-full font-semibold",children:"إرسال"})]})})]})}function gY({level:S,className:v}){let y="fas ",A="";switch(S){case 1:y+="fa-star text-yellow-400",A="مستوى 1";break;case 2:y+="fa-star-half-alt text-yellow-500",A="مستوى 2";break;case 3:y+="fa-star-of-life text-yellow-600",A="مستوى 3";break;case 4:y+="fa-gem text-blue-500",A="مستوى 4";break;case 5:y+="fa-crown text-yellow-600",A="مستوى 5";break;default:y+="fa-star text-gray-400",A="مستوى غير معروف"}return H.jsx("i",{className:`${y} ${v}`,title:A})}function vY(){const S=Qi(He.auth.loggedInUser),v=Qi(He.users.getUserProfile);return!S||v===void 0?H.jsx("div",{className:"flex justify-center items-center h-screen",children:H.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-4 border-purple-700"})}):H.jsxs("main",{className:"flex-grow pt-4 px-4 pb-4",children:[H.jsxs("section",{className:"bg-white rounded-xl shadow-md p-5 flex flex-col items-center space-y-3",children:[H.jsx("img",{alt:"صورة شخصية",className:"w-24 h-24 rounded-full border-4 border-purple-500 object-cover",src:S.image??`https://ui-avatars.com/api/?name=${S.name}`}),H.jsx("h2",{className:"font-extrabold text-purple-700 text-lg truncate max-w-full",children:S.name}),H.jsxs("p",{className:"text-gray-600 text-xs",children:["ID:",H.jsx("span",{className:"font-semibold text-purple-700",children:v==null?void 0:v.displayId})]}),H.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[H.jsx("span",{className:"text-gray-600 text-xs font-semibold",children:"المستوى:"}),H.jsx(gY,{level:(v==null?void 0:v.level)??1,className:"w-6 h-6"}),H.jsx("span",{className:"text-purple-700 font-bold text-sm",children:(v==null?void 0:v.level)??1})]})]}),H.jsxs("section",{className:"mt-8 flex justify-around bg-white rounded-xl shadow-md p-4",children:[H.jsxs("button",{"aria-label":"الشحن",className:"flex flex-col items-center space-y-1 space-y-reverse text-purple-700 hover:text-purple-900 focus:outline-none",children:[H.jsx("i",{className:"fas fa-bolt text-2xl"}),H.jsx("span",{className:"text-xs font-semibold",children:"الشحن"})]}),H.jsxs("button",{"aria-label":"المتاجر",className:"flex flex-col items-center space-y-1 space-y-reverse text-purple-700 hover:text-purple-900 focus:outline-none",children:[H.jsx("i",{className:"fas fa-store text-2xl"}),H.jsx("span",{className:"text-xs font-semibold",children:"المتاجر"})]}),H.jsxs("button",{"aria-label":"الحقيبة",className:"flex flex-col items-center space-y-1 space-y-reverse text-purple-700 hover:text-purple-900 focus:outline-none",children:[H.jsx("i",{className:"fas fa-shopping-bag text-2xl"}),H.jsx("span",{className:"text-xs font-semibold",children:"الحقيبة"})]})]}),H.jsxs("section",{className:"mt-8 grid grid-cols-2 gap-4",children:[H.jsxs("div",{className:"flex items-center space-x-3 space-x-reverse bg-white rounded-xl shadow-md p-4",children:[H.jsx("i",{className:"fas fa-layer-group text-purple-600 text-3xl"}),H.jsxs("div",{children:[H.jsx("h3",{className:"font-extrabold text-purple-700 text-sm",children:"المستوى"}),H.jsx("p",{className:"text-gray-600 text-xs",children:"المستوى الحالي للمستخدم"})]})]}),H.jsxs("div",{className:"flex items-center space-x-3 space-x-reverse bg-white rounded-xl shadow-md p-4",children:[H.jsx("i",{className:"fas fa-crown text-yellow-400 text-3xl"}),H.jsxs("div",{children:[H.jsx("h3",{className:"font-extrabold text-purple-700 text-sm",children:"VIP"}),H.jsx("p",{className:"text-gray-600 text-xs",children:"حالة المستخدم المميزة"})]})]}),H.jsxs("div",{className:"flex items-center space-x-3 space-x-reverse bg-white rounded-xl shadow-md p-4",children:[H.jsx("i",{className:"fas fa-user-shield text-purple-800 text-3xl"}),H.jsxs("div",{children:[H.jsx("h3",{className:"font-extrabold text-purple-700 text-sm",children:"الاستقراطية"}),H.jsx("p",{className:"text-gray-600 text-xs",children:"مستوى النخبة الخاص"})]})]}),H.jsxs("div",{className:"flex items-center space-x-3 space-x-reverse bg-white rounded-xl shadow-md p-4",children:[H.jsx("i",{className:"fas fa-laugh-beam text-green-500 text-3xl"}),H.jsxs("div",{children:[H.jsx("h3",{className:"font-extrabold text-purple-700 text-sm",children:"مزحة PRO"}),H.jsx("p",{className:"text-gray-600 text-xs",children:"الوصول إلى مزحات احترافية"})]})]}),H.jsxs("div",{className:"flex items-center space-x-3 space-x-reverse bg-white rounded-xl shadow-md p-4",children:[H.jsx("i",{className:"fas fa-building text-indigo-600 text-3xl"}),H.jsxs("div",{children:[H.jsx("h3",{className:"font-extrabold text-purple-700 text-sm",children:"الوكالة"}),H.jsx("p",{className:"text-gray-600 text-xs",children:"إدارة الوكالات الخاصة"})]})]}),H.jsxs("div",{className:"flex items-center space-x-3 space-x-reverse bg-white rounded-xl shadow-md p-4",children:[H.jsx("i",{className:"fas fa-cog text-purple-700 text-3xl"}),H.jsxs("div",{children:[H.jsx("h3",{className:"font-extrabold text-purple-700 text-sm",children:"الإعدادات"}),H.jsx("p",{className:"text-gray-600 text-xs",children:"تخصيص حسابك"})]})]})]})]})}function SY(){const S=Qi(He.auth.loggedInUser),v=Qi(He.users.getUserProfile),[y,A]=Ot.useState("rooms"),[V,B]=Ot.useState(null),[Y,et]=Ot.useState(null),[J,Q]=Ot.useState(null),[ht,Et]=Ot.useState(null),[vt,Ft]=Ot.useState(!1),[xt,Oe]=Ot.useState(""),Ue=Qi(He.rooms.searchUsers,xt?{query:xt}:"skip"),vn=fe=>{et(fe),Ft(!1),Oe("")},fn=fe=>{Et(fe),et(null),Q(null),A("messages")},Be=()=>S===void 0||v===void 0?H.jsx("div",{className:"flex justify-center items-center h-screen",children:H.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-4 border-purple-700"})}):S&&v===null?H.jsx(sY,{}):Y?H.jsx(_Y,{userId:Y,onBack:()=>et(null),onStartConversation:fn}):V?H.jsx(mY,{roomId:V,onBack:()=>B(null),onViewProfile:et}):J?H.jsx(Nj,{conversationId:J,onBack:()=>Q(null)}):y==="messages"&&ht?H.jsx(Nj,{partnerId:ht,onBack:()=>Et(null)}):H.jsxs(H.Fragment,{children:[H.jsxs("header",{className:"fixed top-0 left-0 right-0 bg-purple-100 z-50 border-b border-purple-300",children:[H.jsxs("div",{className:"flex justify-between items-center px-3 py-2 text-black font-semibold",children:[H.jsx(aY,{}),H.jsxs("div",{className:"flex items-center space-x-1 space-x-reverse font-extrabold text-purple-700 text-base",children:[y==="rooms"&&"استكشاف",y==="moments"&&"اللحظات",y==="messages"&&"الرسائل",y==="me"&&"أنا"]}),H.jsx("button",{"aria-label":"بحث",className:"text-lg text-black",onClick:()=>Ft(!vt),children:H.jsx("i",{className:"fas fa-search"})})]}),vt&&H.jsxs("div",{className:"px-3 pb-2 relative",children:[H.jsx("input",{type:"text",placeholder:"ابحث عن المستخدمين بالاسم أو المعرف",className:"w-full rounded-md border border-purple-400 px-3 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-purple-600",value:xt,onChange:fe=>Oe(fe.target.value)}),Ue&&xt&&H.jsx("ul",{className:"absolute top-full left-3 right-3 mt-1 max-h-40 overflow-y-auto bg-white rounded-md shadow-md z-10",children:Ue.map(fe=>fe?H.jsxs("li",{onClick:()=>vn(fe.userId),className:"flex items-center space-x-2 space-x-reverse p-2 hover:bg-purple-100 cursor-pointer",children:[H.jsx("img",{src:fe.imageUrl??`https://ui-avatars.com/api/?name=${fe.name}`,alt:`صورة ${fe.name}`,className:"w-6 h-6 rounded-full border border-purple-300"}),H.jsxs("div",{className:"flex flex-col",children:[H.jsx("span",{className:"font-semibold text-gray-900",children:fe.name}),H.jsxs("span",{className:"text-gray-600 text-xs",children:["ID: ",fe.displayId]})]})]},fe._id):null)})]})]}),H.jsxs("div",{className:"flex-grow pt-14 pb-16",children:[y==="rooms"&&H.jsx(nK,{onEnterRoom:B}),y==="moments"&&H.jsx(rY,{}),y==="messages"&&H.jsx(EY,{onEnterConversation:Q}),y==="me"&&H.jsx(vY,{})]}),H.jsxs("nav",{className:"fixed bottom-0 left-0 right-0 bg-gradient-to-t from-purple-300 to-purple-100 border-t border-purple-400 flex justify-around items-center py-1 text-purple-400 text-xs font-semibold z-50",children:[H.jsxs("button",{onClick:()=>A("rooms"),className:`flex flex-col items-center space-y-0.5 space-y-reverse ${y==="rooms"?"text-purple-700 font-extrabold bg-purple-200 rounded-lg px-2 py-1 shadow-lg":"hover:text-purple-700"}`,children:[H.jsx("i",{className:"fas fa-users text-base"}),H.jsx("span",{children:"الغرف"})]}),H.jsxs("button",{onClick:()=>A("moments"),className:`flex flex-col items-center space-y-0.5 space-y-reverse ${y==="moments"?"text-purple-700 font-extrabold bg-purple-200 rounded-lg px-2 py-1 shadow-lg":"hover:text-purple-700"}`,children:[H.jsx("i",{className:"fas fa-clock text-base"}),H.jsx("span",{children:"اللحظات"})]}),H.jsxs("button",{onClick:()=>A("messages"),className:`flex flex-col items-center space-y-0.5 space-y-reverse ${y==="messages"?"text-purple-700 font-extrabold bg-purple-200 rounded-lg px-2 py-1 shadow-lg":"hover:text-purple-700"}`,children:[H.jsx("i",{className:"fas fa-envelope text-base"}),H.jsx("span",{children:"الرسائل"})]}),H.jsxs("button",{onClick:()=>A("me"),className:`flex flex-col items-center space-y-0.5 space-y-reverse ${y==="me"?"text-purple-700 font-extrabold bg-purple-200 rounded-lg px-2 py-1 shadow-lg":"hover:text-purple-700"}`,children:[H.jsx("i",{className:"fas fa-user text-base"}),H.jsx("span",{children:"أنا"})]})]})]});return H.jsxs("div",{className:"bg-gradient-to-b from-purple-300 to-purple-100 min-h-screen flex flex-col text-xs",children:[H.jsx(Vq,{children:H.jsxs("div",{className:"flex flex-col items-center justify-center h-screen p-4 text-center",children:[H.jsx("h1",{className:"text-3xl font-bold text-purple-800 mb-4",children:"أهلاً بك في غرف الدردشة"}),H.jsx("p",{className:"text-lg text-purple-600 mb-8",children:"الرجاء تسجيل الدخول للمتابعة"}),H.jsx(eK,{})]})}),H.jsx(Uq,{children:Be()})]})}const TY=new bq("https://impressive-elephant-816.convex.cloud");az.createRoot(document.getElementById("root")).render(H.jsx(qq,{client:TY,children:H.jsx(SY,{})}));window.addEventListener("message",async S=>{if(S.source!==window.parent||S.data.type!=="chefPreviewRequest")return;await(await QW(()=>import("https://chef.convex.dev/scripts/worker.bundled.mjs"),[])).respondToMessage(S)});
